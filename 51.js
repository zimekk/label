/*! For license information please see 51.js.LICENSE.txt */
(self.webpackChunk_dev_web=self.webpackChunk_dev_web||[]).push([[51],{6953:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>y});var n=a(2784),s=a(9570),r=a(2779),i=a.n(r),l=a(7234),c=a(4427),o=a(9239);const d=o.p_j.sgd(.1),u=o.VD$(o.nGf([5,5,1,8],0,.1)),h=o.VD$(o.nGf([5,5,8,16],0,.1)),f=o.VD$(o.nGf([784,10],0,1/Math.sqrt(784))),m=o.VD$(o.lls([10]));function g(e){const t=e.as4D(-1,28,28,1),a=o.lub((()=>t.conv2d(u,1,"same").relu().maxPool([2,2],2,0)));return o.lub((()=>a.conv2d(h,1,"same").relu().maxPool([2,2],2,0))).as2D(-1,f.shape[0]).matMul(f).add(m)}const p=784,w=10,x=Math.floor(54166.66666666667),b=65e3-x;class I{constructor(){this.shuffledTrainIndex=0,this.shuffledTestIndex=0}async load(){const e=new Image,t=document.createElement("canvas"),a=t.getContext("2d"),n=new Promise(((n,s)=>{e.crossOrigin="",e.onload=()=>{e.width=e.naturalWidth,e.height=e.naturalHeight;const s=new ArrayBuffer(20384e4),r=5e3;t.width=e.width,t.height=r;for(let n=0;n<13;n++){const i=new Float32Array(s,n*p*r*4,392e4);a.drawImage(e,0,n*r,e.width,r,0,0,e.width,r);const l=a.getImageData(0,0,t.width,t.height);for(let e=0;e<l.data.length/4;e++)i[e]=l.data[4*e]/255}this.datasetImages=new Float32Array(s),n()},e.src="https://storage.googleapis.com/learnjs-data/model-builder/mnist_images.png"})),s=fetch("https://storage.googleapis.com/learnjs-data/model-builder/mnist_labels_uint8"),[r,i]=await Promise.all([n,s]);this.datasetLabels=new Uint8Array(await i.arrayBuffer()),this.trainIndices=o.D5U.createShuffledIndices(x),this.testIndices=o.D5U.createShuffledIndices(b),this.trainImages=this.datasetImages.slice(0,p*x),this.testImages=this.datasetImages.slice(p*x),this.trainLabels=this.datasetLabels.slice(0,w*x),this.testLabels=this.datasetLabels.slice(w*x)}nextTrainBatch(e){return this.nextBatch(e,[this.trainImages,this.trainLabels],(()=>(this.shuffledTrainIndex=(this.shuffledTrainIndex+1)%this.trainIndices.length,this.trainIndices[this.shuffledTrainIndex])))}nextTestBatch(e){return this.nextBatch(e,[this.testImages,this.testLabels],(()=>(this.shuffledTestIndex=(this.shuffledTestIndex+1)%this.testIndices.length,this.testIndices[this.shuffledTestIndex])))}nextBatch(e,t,a){const n=new Float32Array(e*p),s=new Uint8Array(e*w);for(let r=0;r<e;r++){const e=a(),i=t[0].slice(e*p,e*p+p);n.set(i,r*p);const l=t[1].slice(e*w,e*w+w);s.set(l,r*w)}return{xs:o.odF(n,[e,p]),labels:o.odF(s,[e,w])}}}function E({children:e}){return n.createElement("div",{className:i()(l.Z.PredContainer)},e)}function T({correct:e,children:t}){return n.createElement("div",{className:i()(l.Z.Pred,e?l.Z.Pred__Correct:l.Z.Pred__Incorrect)},`pred: ${t}`)}function v({children:e,width:t=28,height:a=28}){const s=(0,n.useRef)();return(0,n.useEffect)((()=>{const n=Object.assign(s.current,{width:t,height:a}).getContext("2d"),r=new ImageData(t,a);for(let n=0;n<a*t;++n){const t=4*n;r.data[t+0]=255*e[n],r.data[t+1]=255*e[n],r.data[t+2]=255*e[n],r.data[t+3]=255}n.putImageData(r,0,0)}),[s]),n.createElement("canvas",{ref:s,width:t,height:a})}function y(){const e=(0,n.useRef)(null),[t,a]=(0,n.useState)("Loading data..."),[r,i]=(0,n.useState)(""),[u,h]=(0,n.useState)([]),f=(0,n.useCallback)((()=>e.current.clearCanvas()),[e]),m=(0,n.useCallback)((()=>e.current.exportImage("png").then(console.log).catch(console.error)),[e]);return(0,n.useEffect)((()=>{const e=[],t=function(){a("Training...")},n=function(t,a){i(`loss[${a}]: ${t}`),e.push({x:a,y:t});const n={values:e,series:["loss"]};c.render.linechart({name:"Loss",tab:"Training"},n,{xLabel:"Training Step",yLavel:"Loss"})},s=function(e,t,n){a("Testing...");const s=e.xs.arraySync().map(((e,a)=>{const s=t[a];return{image:e,correct:s===n[a],prediction:s}}));h(s);const r=s.length,l=s.filter((({correct:e})=>e)).length,c=`Accuracy: ${(100*l/r).toFixed(2)}% (${l} / ${r})`;i(`${c}\n`),console.log(c)};let r;!async function(){await async function(){r=new I,await r.load()}(),await async function(){t(),await async function(e,t){for(let a=0;a<100;a++)t(d.minimize((()=>{const t=e.nextTrainBatch(64);return a=t.labels,n=g(t.xs),o.MB5.softmaxCrossEntropy(a,n).mean();var a,n}),!0).dataSync(),a),await o.glt()}(r,n)}(),async function(){const e=r.nextTestBatch(50),t=function(e){const t=o.lub((()=>g(e).argMax(1)));return Array.from(t.dataSync())}(e.xs),a=function(e){const t=e.argMax(1);return Array.from(t.dataSync())}(e.labels);s(e,t,a)}()}()}),[]),n.createElement("section",{className:l.Z.Section},n.createElement("h2",null,"Draw"),n.createElement("button",{onClick:f},"Clear"),n.createElement("button",{onClick:m},"Export"),n.createElement(s.x,{ref:e,className:l.Z.Canvas,width:"100",height:"100",strokeWidth:10,strokeColor:"red"}),n.createElement("section",{className:"title-area"},n.createElement("h1",null,"TensorFlow.js: Train MNIST with the Core API")),n.createElement("section",null,n.createElement("p",{className:"section-head"},"Description"),n.createElement("p",null,"This examples demonstrates training a handwritten digit recognizer using a Convolutional Neural Network implemented with TensorFlow.js' lower level API."),n.createElement("p",null,"The MNIST dataset is used as training data.")),n.createElement("section",null,n.createElement("p",{className:"section-head"},"Status"),n.createElement("div",{id:"status"},t),n.createElement("div",{id:"message"},r)),n.createElement("section",null,n.createElement("p",{className:"section-head"},"Test Samples"),n.createElement("div",{id:"images"},u.map((({correct:e,image:t,prediction:a},s)=>n.createElement(E,{key:s},n.createElement(T,{correct:e},a),n.createElement(v,null,t)))))))}},5995:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var n=a(9601),s=a.n(n),r=a(2609),i=a.n(r)()(s());i.push([e.id,".XimR9tM6ZsT9xHiUSMoX{color:blue}.HJEKkQwJ7Pb7rMrsBN3G{width:640px;height:480px}.gGBM98q7ihMEgCzog38u{display:inline-block;width:100px;margin:10px}.gGBM98q7ihMEgCzog38u canvas{width:100px}.iBzDjPxDp6vNyUOYlxkT{font-size:30px;width:100px}.GmdlGkuFSgLTgtovj2WA{background-color:#00cf00}.SC12yKSKfp8ZMTsnDSbs{background-color:red}",""]),i.locals={Section:"XimR9tM6ZsT9xHiUSMoX",Canvas:"HJEKkQwJ7Pb7rMrsBN3G",PredContainer:"gGBM98q7ihMEgCzog38u",Pred:"iBzDjPxDp6vNyUOYlxkT",Pred__Correct:"GmdlGkuFSgLTgtovj2WA",Pred__Incorrect:"SC12yKSKfp8ZMTsnDSbs"};const l=i},7234:(e,t,a)=>{"use strict";a.d(t,{Z:()=>I});var n=a(6062),s=a.n(n),r=a(4036),i=a.n(r),l=a(6793),c=a.n(l),o=a(7892),d=a.n(o),u=a(1173),h=a.n(u),f=a(2464),m=a.n(f),g=a(5995),p={};p.styleTagTransform=m(),p.setAttributes=d(),p.insert=c().bind(null,"head"),p.domAPI=i(),p.insertStyleElement=h();var w=s()(g.default,p);if(!g.default.locals||e.hot.invalidate){var x=!g.default.locals,b=x?g:g.default.locals;e.hot.accept(5995,(t=>{g=a(5995),function(e,t,a){if(!e&&t||e&&!t)return!1;var n;for(n in e)if((!a||"default"!==n)&&e[n]!==t[n])return!1;for(n in t)if(!(a&&"default"===n||e[n]))return!1;return!0}(b,x?g:g.default.locals,x)?(b=x?g:g.default.locals,w(g.default)):e.hot.invalidate()}))}e.hot.dispose((function(){w()}));const I=g.default&&g.default.locals?g.default.locals:void 0},327:()=>{},6843:()=>{},7796:()=>{},451:()=>{},9182:()=>{},660:()=>{}}]);
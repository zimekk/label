/*! For license information please see 51.js.LICENSE.txt */
(self.webpackChunk_dev_web=self.webpackChunk_dev_web||[]).push([[51],{6953:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>D});var a=n(2784),s=n(9570),r=n(3851),l=n(3833),i=n(2779),c=n.n(i),o=n(7234),d=n(9239),u=n(4427);const h=d.p_j.sgd(.1),m=d.VD$(d.nGf([5,5,1,8],0,.1)),f=d.VD$(d.nGf([5,5,8,16],0,.1)),g=d.VD$(d.nGf([784,10],0,1/Math.sqrt(784))),p=d.VD$(d.lls([10]));function b(e){const t=e.as4D(-1,28,28,1),n=d.lub((()=>t.conv2d(m,1,"same").relu().maxPool([2,2],2,0)));return d.lub((()=>n.conv2d(f,1,"same").relu().maxPool([2,2],2,0))).as2D(-1,g.shape[0]).matMul(g).add(p)}function x(e){const t=d.lub((()=>b(e).argMax(1)));return Array.from(t.dataSync())}const w=784,E=10,I=Math.floor(54166.66666666667),v=65e3-I;class C{constructor(){this.shuffledTrainIndex=0,this.shuffledTestIndex=0}async load(){const e=new Image,t=document.createElement("canvas"),n=t.getContext("2d"),a=new Promise(((a,s)=>{e.crossOrigin="",e.onload=()=>{e.width=e.naturalWidth,e.height=e.naturalHeight;const s=new ArrayBuffer(20384e4),r=5e3;t.width=e.width,t.height=r;for(let a=0;a<13;a++){const l=new Float32Array(s,a*w*r*4,392e4);n.drawImage(e,0,a*r,e.width,r,0,0,e.width,r);const i=n.getImageData(0,0,t.width,t.height);for(let e=0;e<i.data.length/4;e++)l[e]=i.data[4*e]/255}this.datasetImages=new Float32Array(s),a()},e.src="https://storage.googleapis.com/learnjs-data/model-builder/mnist_images.png"})),s=fetch("https://storage.googleapis.com/learnjs-data/model-builder/mnist_labels_uint8"),[r,l]=await Promise.all([a,s]);this.datasetLabels=new Uint8Array(await l.arrayBuffer()),this.trainIndices=d.D5U.createShuffledIndices(I),this.testIndices=d.D5U.createShuffledIndices(v),this.trainImages=this.datasetImages.slice(0,w*I),this.testImages=this.datasetImages.slice(w*I),this.trainLabels=this.datasetLabels.slice(0,E*I),this.testLabels=this.datasetLabels.slice(E*I)}nextTrainBatch(e){return this.nextBatch(e,[this.trainImages,this.trainLabels],(()=>(this.shuffledTrainIndex=(this.shuffledTrainIndex+1)%this.trainIndices.length,this.trainIndices[this.shuffledTrainIndex])))}nextTestBatch(e){return this.nextBatch(e,[this.testImages,this.testLabels],(()=>(this.shuffledTestIndex=(this.shuffledTestIndex+1)%this.testIndices.length,this.testIndices[this.shuffledTestIndex])))}nextBatch(e,t,n){const a=new Float32Array(e*w),s=new Uint8Array(e*E);for(let r=0;r<e;r++){const e=n(),l=t[0].slice(e*w,e*w+w);a.set(l,r*w);const i=t[1].slice(e*E,e*E+E);s.set(i,r*E)}return{xs:d.odF(a,[e,w]),labels:d.odF(s,[e,E])}}}function k({children:e}){return a.createElement("div",{className:c()(o.Z.PredContainer)},e)}function T({correct:e,children:t}){return a.createElement("div",{className:c()(o.Z.Pred,e?o.Z.Pred__Correct:o.Z.Pred__Incorrect)},`pred: ${t}`)}function y(e){return new Promise(((t,n)=>{const a=new Image;a.addEventListener("load",(()=>t(a))),a.addEventListener("error",(e=>n(e))),a.src=e,a.setAttribute("crossorigin","anonymous")}))}function S(e){return x(d.Xhn.fromPixels(e).resizeNearestNeighbor([28,28]).mean(2).expandDims(2).expandDims().toFloat().div(255))[0]}function M({children:e,width:t=28,height:n=28}){const s=(0,a.useRef)();(0,a.useEffect)((()=>{const a=Object.assign(s.current,{width:t,height:n}).getContext("2d"),r=new ImageData(t,n);for(let a=0;a<n*t;++a){const t=4*a;r.data[t+0]=255*e[a],r.data[t+1]=255*e[a],r.data[t+2]=255*e[a],r.data[t+3]=255}a.putImageData(r,0,0)}),[s]);const r=(0,a.useCallback)((()=>S(s.current)),[s]);return a.createElement("canvas",{ref:s,width:t,height:n,onClick:r})}const P=new r.x;function D(){const e=(0,a.useRef)(null),[t,n]=(0,a.useState)("Loading data..."),[r,i]=(0,a.useState)(""),[c,m]=(0,a.useState)([]),[f,g]=(0,a.useState)(null),p=(0,a.useCallback)((()=>(e.current.resetCanvas(),g(null))),[e]),w=(0,a.useCallback)((()=>e.current.undo()),[e]),E=(0,a.useCallback)((()=>e.current.redo()),[e]),I=(0,a.useCallback)((()=>e.current.exportImage("png").then(console.log).catch(console.error)),[e]),v=(0,a.useCallback)((()=>e.current.exportImage("png").then(y).then(S).then(g)),[e]),D=(0,a.useCallback)((()=>console.log(["stroke"])),[e]),N=(0,a.useCallback)((()=>console.log(["change"])||P.next(null)),[e]);return(0,a.useEffect)((()=>P.pipe((0,l.b)(400)).subscribe((()=>{e.current.exportImage("png").then(y).then(S).then((e=>console.log({predicted:e})||e)).then(g)})).unsubscribe),[e]),(0,a.useEffect)((()=>{const e=[],t=function(){n("Training...")},a=function(t,n){i(`loss[${n}]: ${t}`),e.push({x:n,y:t});const a={values:e,series:["loss"]};u.render.linechart({name:"Loss",tab:"Training"},a,{xLabel:"Training Step",yLavel:"Loss"})},s=function(e,t,a){n("Testing...");const s=e.xs.arraySync().map(((e,n)=>{const s=t[n];return{image:e,correct:s===a[n],prediction:s}}));m(s);const r=s.length,l=s.filter((({correct:e})=>e)).length,c=`Accuracy: ${(100*l/r).toFixed(2)}% (${l} / ${r})`;i(`${c}\n`),console.log(c)};let r;!async function(){await async function(){r=new C,await r.load()}(),await async function(){t(),await async function(e,t){for(let n=0;n<100;n++)t(h.minimize((()=>{const t=e.nextTrainBatch(64);return n=t.labels,a=b(t.xs),d.MB5.softmaxCrossEntropy(n,a).mean();var n,a}),!0).dataSync(),n),await d.glt()}(r,a)}(),async function(){const e=r.nextTestBatch(50),t=x(e.xs),n=function(e){const t=e.argMax(1);return Array.from(t.dataSync())}(e.labels);s(e,t,n)}()}()}),[]),a.createElement("section",{className:o.Z.Section},a.createElement("h2",null,"Draw"),a.createElement("button",{onClick:p},"Reset"),a.createElement("button",{onClick:w},"Undo"),a.createElement("button",{onClick:E},"Redo"),a.createElement("button",{onClick:I},"Export"),a.createElement("button",{onClick:v},"Predict"),null!==f&&a.createElement("span",null,"pred: ",f),a.createElement(s.x,{ref:e,className:o.Z.Canvas,width:"100",height:"100",strokeWidth:24,strokeColor:"white",canvasColor:"black",onStroke:D,onChange:N}),a.createElement("section",{className:"title-area"},a.createElement("h1",null,"TensorFlow.js: Train MNIST with the Core API")),a.createElement("section",null,a.createElement("p",{className:"section-head"},"Description"),a.createElement("p",null,"This examples demonstrates training a handwritten digit recognizer using a Convolutional Neural Network implemented with TensorFlow.js' lower level API."),a.createElement("p",null,"The MNIST dataset is used as training data.")),a.createElement("section",null,a.createElement("p",{className:"section-head"},"Status"),a.createElement("div",{id:"status"},t),a.createElement("div",{id:"message"},r)),a.createElement("section",null,a.createElement("p",{className:"section-head"},"Test Samples"),a.createElement("div",{id:"images"},c.map((({correct:e,image:t,prediction:n},s)=>a.createElement(k,{key:s},a.createElement(T,{correct:e},n),a.createElement(M,null,t)))))))}},5995:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var a=n(9601),s=n.n(a),r=n(2609),l=n.n(r)()(s());l.push([e.id,".XimR9tM6ZsT9xHiUSMoX{color:blue}.HJEKkQwJ7Pb7rMrsBN3G{width:640px;height:480px}.gGBM98q7ihMEgCzog38u{display:inline-block;width:100px;margin:10px}.gGBM98q7ihMEgCzog38u canvas{width:100px}.iBzDjPxDp6vNyUOYlxkT{font-size:30px;width:100px}.GmdlGkuFSgLTgtovj2WA{background-color:#00cf00}.SC12yKSKfp8ZMTsnDSbs{background-color:red}",""]),l.locals={Section:"XimR9tM6ZsT9xHiUSMoX",Canvas:"HJEKkQwJ7Pb7rMrsBN3G",PredContainer:"gGBM98q7ihMEgCzog38u",Pred:"iBzDjPxDp6vNyUOYlxkT",Pred__Correct:"GmdlGkuFSgLTgtovj2WA",Pred__Incorrect:"SC12yKSKfp8ZMTsnDSbs"};const i=l},7234:(e,t,n)=>{"use strict";n.d(t,{Z:()=>E});var a=n(6062),s=n.n(a),r=n(4036),l=n.n(r),i=n(6793),c=n.n(i),o=n(7892),d=n.n(o),u=n(1173),h=n.n(u),m=n(2464),f=n.n(m),g=n(5995),p={};p.styleTagTransform=f(),p.setAttributes=d(),p.insert=c().bind(null,"head"),p.domAPI=l(),p.insertStyleElement=h();var b=s()(g.default,p);if(!g.default.locals||e.hot.invalidate){var x=!g.default.locals,w=x?g:g.default.locals;e.hot.accept(5995,(t=>{g=n(5995),function(e,t,n){if(!e&&t||e&&!t)return!1;var a;for(a in e)if((!n||"default"!==a)&&e[a]!==t[a])return!1;for(a in t)if(!(n&&"default"===a||e[a]))return!1;return!0}(w,x?g:g.default.locals,x)?(w=x?g:g.default.locals,b(g.default)):e.hot.invalidate()}))}e.hot.dispose((function(){b()}));const E=g.default&&g.default.locals?g.default.locals:void 0},327:()=>{},6843:()=>{},7796:()=>{},451:()=>{},9182:()=>{},660:()=>{}}]);
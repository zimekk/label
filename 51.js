/*! For license information please see 51.js.LICENSE.txt */
(self.webpackChunk_dev_web=self.webpackChunk_dev_web||[]).push([[51],{6953:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>S});var n=a(2784),s=a(9570),r=a(2779),i=a.n(r),l=a(7234),c=a(9239),o=a(4427);const d=c.p_j.sgd(.1),u=c.VD$(c.nGf([5,5,1,8],0,.1)),h=c.VD$(c.nGf([5,5,8,16],0,.1)),m=c.VD$(c.nGf([784,10],0,1/Math.sqrt(784))),f=c.VD$(c.lls([10]));function g(e){const t=e.as4D(-1,28,28,1),a=c.lub((()=>t.conv2d(u,1,"same").relu().maxPool([2,2],2,0)));return c.lub((()=>a.conv2d(h,1,"same").relu().maxPool([2,2],2,0))).as2D(-1,m.shape[0]).matMul(m).add(f)}function p(e){const t=c.lub((()=>g(e).argMax(1)));return Array.from(t.dataSync())}const x=784,w=10,b=Math.floor(54166.66666666667),E=65e3-b;class I{constructor(){this.shuffledTrainIndex=0,this.shuffledTestIndex=0}async load(){const e=new Image,t=document.createElement("canvas"),a=t.getContext("2d"),n=new Promise(((n,s)=>{e.crossOrigin="",e.onload=()=>{e.width=e.naturalWidth,e.height=e.naturalHeight;const s=new ArrayBuffer(20384e4),r=5e3;t.width=e.width,t.height=r;for(let n=0;n<13;n++){const i=new Float32Array(s,n*x*r*4,392e4);a.drawImage(e,0,n*r,e.width,r,0,0,e.width,r);const l=a.getImageData(0,0,t.width,t.height);for(let e=0;e<l.data.length/4;e++)i[e]=l.data[4*e]/255}this.datasetImages=new Float32Array(s),n()},e.src="https://storage.googleapis.com/learnjs-data/model-builder/mnist_images.png"})),s=fetch("https://storage.googleapis.com/learnjs-data/model-builder/mnist_labels_uint8"),[r,i]=await Promise.all([n,s]);this.datasetLabels=new Uint8Array(await i.arrayBuffer()),this.trainIndices=c.D5U.createShuffledIndices(b),this.testIndices=c.D5U.createShuffledIndices(E),this.trainImages=this.datasetImages.slice(0,x*b),this.testImages=this.datasetImages.slice(x*b),this.trainLabels=this.datasetLabels.slice(0,w*b),this.testLabels=this.datasetLabels.slice(w*b)}nextTrainBatch(e){return this.nextBatch(e,[this.trainImages,this.trainLabels],(()=>(this.shuffledTrainIndex=(this.shuffledTrainIndex+1)%this.trainIndices.length,this.trainIndices[this.shuffledTrainIndex])))}nextTestBatch(e){return this.nextBatch(e,[this.testImages,this.testLabels],(()=>(this.shuffledTestIndex=(this.shuffledTestIndex+1)%this.testIndices.length,this.testIndices[this.shuffledTestIndex])))}nextBatch(e,t,a){const n=new Float32Array(e*x),s=new Uint8Array(e*w);for(let r=0;r<e;r++){const e=a(),i=t[0].slice(e*x,e*x+x);n.set(i,r*x);const l=t[1].slice(e*w,e*w+w);s.set(l,r*w)}return{xs:c.odF(n,[e,x]),labels:c.odF(s,[e,w])}}}function v({children:e}){return n.createElement("div",{className:i()(l.Z.PredContainer)},e)}function T({correct:e,children:t}){return n.createElement("div",{className:i()(l.Z.Pred,e?l.Z.Pred__Correct:l.Z.Pred__Incorrect)},`pred: ${t}`)}function y(e){const t=c.Xhn.fromPixels(e).resizeNearestNeighbor([28,28]).mean(2).expandDims(2).expandDims().toFloat();console.log(p(t.div(255)))}function C({children:e,width:t=28,height:a=28}){const s=(0,n.useRef)();(0,n.useEffect)((()=>{const n=Object.assign(s.current,{width:t,height:a}).getContext("2d"),r=new ImageData(t,a);for(let n=0;n<a*t;++n){const t=4*n;r.data[t+0]=255*e[n],r.data[t+1]=255*e[n],r.data[t+2]=255*e[n],r.data[t+3]=255}n.putImageData(r,0,0)}),[s]);const r=(0,n.useCallback)((()=>y(s.current)),[s]);return n.createElement("canvas",{ref:s,width:t,height:a,onClick:r})}function S(){const e=(0,n.useRef)(null),[t,a]=(0,n.useState)("Loading data..."),[r,i]=(0,n.useState)(""),[u,h]=(0,n.useState)([]),m=(0,n.useCallback)((()=>e.current.clearCanvas()),[e]),f=(0,n.useCallback)((()=>e.current.exportImage("png").then(console.log).catch(console.error)),[e]),x=(0,n.useCallback)((()=>e.current.exportImage("png").then((e=>new Promise(((t,a)=>{const n=new Image;n.addEventListener("load",(()=>t(n))),n.addEventListener("error",(e=>a(e))),n.src=e,n.setAttribute("crossorigin","anonymous")})).then(y)))),[e]);return(0,n.useEffect)((()=>{const e=[],t=function(){a("Training...")},n=function(t,a){i(`loss[${a}]: ${t}`),e.push({x:a,y:t});const n={values:e,series:["loss"]};o.render.linechart({name:"Loss",tab:"Training"},n,{xLabel:"Training Step",yLavel:"Loss"})},s=function(e,t,n){a("Testing...");const s=e.xs.arraySync().map(((e,a)=>{const s=t[a];return{image:e,correct:s===n[a],prediction:s}}));h(s);const r=s.length,l=s.filter((({correct:e})=>e)).length,c=`Accuracy: ${(100*l/r).toFixed(2)}% (${l} / ${r})`;i(`${c}\n`),console.log(c)};let r;!async function(){await async function(){r=new I,await r.load()}(),await async function(){t(),await async function(e,t){for(let a=0;a<100;a++)t(d.minimize((()=>{const t=e.nextTrainBatch(64);return a=t.labels,n=g(t.xs),c.MB5.softmaxCrossEntropy(a,n).mean();var a,n}),!0).dataSync(),a),await c.glt()}(r,n)}(),async function(){const e=r.nextTestBatch(50),t=p(e.xs),a=function(e){const t=e.argMax(1);return Array.from(t.dataSync())}(e.labels);s(e,t,a)}()}()}),[]),n.createElement("section",{className:l.Z.Section},n.createElement("h2",null,"Draw"),n.createElement("button",{onClick:m},"Clear"),n.createElement("button",{onClick:f},"Export"),n.createElement("button",{onClick:x},"Predict"),n.createElement(s.x,{ref:e,className:l.Z.Canvas,width:"100",height:"100",strokeWidth:24,strokeColor:"white",canvasColor:"black"}),n.createElement("section",{className:"title-area"},n.createElement("h1",null,"TensorFlow.js: Train MNIST with the Core API")),n.createElement("section",null,n.createElement("p",{className:"section-head"},"Description"),n.createElement("p",null,"This examples demonstrates training a handwritten digit recognizer using a Convolutional Neural Network implemented with TensorFlow.js' lower level API."),n.createElement("p",null,"The MNIST dataset is used as training data.")),n.createElement("section",null,n.createElement("p",{className:"section-head"},"Status"),n.createElement("div",{id:"status"},t),n.createElement("div",{id:"message"},r)),n.createElement("section",null,n.createElement("p",{className:"section-head"},"Test Samples"),n.createElement("div",{id:"images"},u.map((({correct:e,image:t,prediction:a},s)=>n.createElement(v,{key:s},n.createElement(T,{correct:e},a),n.createElement(C,null,t)))))))}},5995:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var n=a(9601),s=a.n(n),r=a(2609),i=a.n(r)()(s());i.push([e.id,".XimR9tM6ZsT9xHiUSMoX{color:blue}.HJEKkQwJ7Pb7rMrsBN3G{width:640px;height:480px}.gGBM98q7ihMEgCzog38u{display:inline-block;width:100px;margin:10px}.gGBM98q7ihMEgCzog38u canvas{width:100px}.iBzDjPxDp6vNyUOYlxkT{font-size:30px;width:100px}.GmdlGkuFSgLTgtovj2WA{background-color:#00cf00}.SC12yKSKfp8ZMTsnDSbs{background-color:red}",""]),i.locals={Section:"XimR9tM6ZsT9xHiUSMoX",Canvas:"HJEKkQwJ7Pb7rMrsBN3G",PredContainer:"gGBM98q7ihMEgCzog38u",Pred:"iBzDjPxDp6vNyUOYlxkT",Pred__Correct:"GmdlGkuFSgLTgtovj2WA",Pred__Incorrect:"SC12yKSKfp8ZMTsnDSbs"};const l=i},7234:(e,t,a)=>{"use strict";a.d(t,{Z:()=>E});var n=a(6062),s=a.n(n),r=a(4036),i=a.n(r),l=a(6793),c=a.n(l),o=a(7892),d=a.n(o),u=a(1173),h=a.n(u),m=a(2464),f=a.n(m),g=a(5995),p={};p.styleTagTransform=f(),p.setAttributes=d(),p.insert=c().bind(null,"head"),p.domAPI=i(),p.insertStyleElement=h();var x=s()(g.default,p);if(!g.default.locals||e.hot.invalidate){var w=!g.default.locals,b=w?g:g.default.locals;e.hot.accept(5995,(t=>{g=a(5995),function(e,t,a){if(!e&&t||e&&!t)return!1;var n;for(n in e)if((!a||"default"!==n)&&e[n]!==t[n])return!1;for(n in t)if(!(a&&"default"===n||e[n]))return!1;return!0}(b,w?g:g.default.locals,w)?(b=w?g:g.default.locals,x(g.default)):e.hot.invalidate()}))}e.hot.dispose((function(){x()}));const E=g.default&&g.default.locals?g.default.locals:void 0},327:()=>{},6843:()=>{},7796:()=>{},451:()=>{},9182:()=>{},660:()=>{}}]);
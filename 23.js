/*! For license information please see 23.js.LICENSE.txt */
(self.webpackChunk_dev_web=self.webpackChunk_dev_web||[]).push([[23],{4815:(e,t,n)=>{"use strict";n.r(t);var i=n(6720),r=n(1313);(0,r.t3)().prototype.abs=function(){return this.throwIfDisposed(),(0,i.W)(this)};var s=n(8866);(0,r.t3)().prototype.acos=function(){return this.throwIfDisposed(),(0,s.K)(this)};var a=n(6039);(0,r.t3)().prototype.acosh=function(){return this.throwIfDisposed(),(0,a._)(this)};var o=n(7571);(0,r.t3)().prototype.add=function(e){return this.throwIfDisposed(),(0,o.I)(this,e)};var u=n(7590);(0,r.t3)().prototype.all=function(e,t){return this.throwIfDisposed(),(0,u.$)(this,e,t)};var l=n(6298);(0,r.t3)().prototype.any=function(e,t){return this.throwIfDisposed(),(0,l.Y)(this,e,t)};var c=n(1523);(0,r.t3)().prototype.argMax=function(e){return this.throwIfDisposed(),(0,c.N)(this,e)};var d=n(9542);(0,r.t3)().prototype.argMin=function(e){return this.throwIfDisposed(),(0,d.v)(this,e)};var h=n(2673),f=n(9740);(0,r.t3)().prototype.asScalar=function(){return this.throwIfDisposed(),(0,f.hu)(1===this.size,(()=>"The array must have only 1 element.")),(0,h.X)(this,[])};var p=n(5875);(0,r.t3)().prototype.asType=function(e){return this.throwIfDisposed(),(0,p.p)(this,e)},(0,r.t3)().prototype.as1D=function(){return this.throwIfDisposed(),(0,h.X)(this,[this.size])},(0,r.t3)().prototype.as2D=function(e,t){return this.throwIfDisposed(),(0,h.X)(this,[e,t])},(0,r.t3)().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),(0,h.X)(this,[e,t,n])},(0,r.t3)().prototype.as4D=function(e,t,n,i){return this.throwIfDisposed(),(0,h.X)(this,[e,t,n,i])},(0,r.t3)().prototype.as5D=function(e,t,n,i,r){return this.throwIfDisposed(),(0,h.X)(this,[e,t,n,i,r])};var m=n(5492);(0,r.t3)().prototype.asin=function(){return this.throwIfDisposed(),(0,m.Z)(this)};var g=n(3927);(0,r.t3)().prototype.asinh=function(){return this.throwIfDisposed(),(0,g.V)(this)};var y=n(2418);(0,r.t3)().prototype.atan=function(){return this.throwIfDisposed(),(0,y.z)(this)};var v=n(4002);(0,r.t3)().prototype.atan2=function(e){return this.throwIfDisposed(),(0,v.f)(this,e)};var b=n(5602);(0,r.t3)().prototype.atanh=function(){return this.throwIfDisposed(),(0,b.C)(this)};var x=n(9385);(0,r.t3)().prototype.avgPool=function(e,t,n,i){return this.throwIfDisposed(),(0,x.w)(this,e,t,n,i)};var w=n(1141);(0,r.t3)().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),(0,w.E)(this,e,t)};var C=n(8325);(0,r.t3)().prototype.batchNorm=function(e,t,n,i,r){return this.throwIfDisposed(),(0,C.t)(this,e,t,n,i,r)};var k=n(7933);(0,r.t3)().prototype.broadcastTo=function(e){return this.throwIfDisposed(),(0,k.U)(this,e)},(0,r.t3)().prototype.cast=function(e){return this.throwIfDisposed(),(0,p.p)(this,e)};var A=n(8498);(0,r.t3)().prototype.ceil=function(){return this.throwIfDisposed(),(0,A.m)(this)};var _=n(3092);(0,r.t3)().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),(0,_.i)(this,e,t)};var E=n(9134);(0,r.t3)().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof r.es&&(e=[e]),(0,E.z)([this,...e],t)};var S=n(6409);(0,r.t3)().prototype.conv1d=function(e,t,n,i,r,s){return this.throwIfDisposed(),(0,S.P)(this,e,t,n,i,r,s)};var F=n(7905);(0,r.t3)().prototype.conv2dTranspose=function(e,t,n,i,r){return this.throwIfDisposed(),(0,F.b)(this,e,t,n,i,r)};var D=n(9399);(0,r.t3)().prototype.conv2d=function(e,t,n,i,r,s){return this.throwIfDisposed(),(0,D.T)(this,e,t,n,i,r,s)};var $=n(7838);(0,r.t3)().prototype.cos=function(){return this.throwIfDisposed(),(0,$.m)(this)};var O=n(3159);(0,r.t3)().prototype.cosh=function(){return this.throwIfDisposed(),(0,O.f)(this)};var N=n(805);(0,r.t3)().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),(0,N.z)(this,e,t,n)};var I=n(8058);(0,r.t3)().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),(0,I.n)(this,e,t)};var T=n(6581);(0,r.t3)().prototype.depthwiseConv2d=function(e,t,n,i,r,s){return this.throwIfDisposed(),(0,T.B)(this,e,t,n,i,r,s)};var R=n(9605);(0,r.t3)().prototype.dilation2d=function(e,t,n,i,r){return this.throwIfDisposed(),(0,R.W)(this,e,t,n,i,r)};var M=n(2152);(0,r.t3)().prototype.divNoNan=function(e){return this.throwIfDisposed(),(0,M.N)(this,e)};var B=n(2639);(0,r.t3)().prototype.div=function(e){return this.throwIfDisposed(),(0,B.h)(this,e)};var z=n(7465);(0,r.t3)().prototype.dot=function(e){return this.throwIfDisposed(),(0,z.A)(this,e)};var L=n(9673);(0,r.t3)().prototype.elu=function(){return this.throwIfDisposed(),(0,L.p)(this)};var P=n(1966);(0,r.t3)().prototype.equal=function(e){return this.throwIfDisposed(),(0,P.D)(this,e)};var j=n(6352);(0,r.t3)().prototype.erf=function(){return this.throwIfDisposed(),(0,j.q)(this)};var U=n(8575);(0,r.t3)().prototype.exp=function(){return this.throwIfDisposed(),(0,U.Q)(this)};var W=n(1064);(0,r.t3)().prototype.expandDims=function(e){return this.throwIfDisposed(),(0,W.d)(this,e)};var V=n(177);(0,r.t3)().prototype.expm1=function(){return this.throwIfDisposed(),(0,V.t)(this)};var q=n(6991);(0,r.t3)().prototype.fft=function(){return this.throwIfDisposed(),(0,q.k)(this)},(0,r.t3)().prototype.flatten=function(){return this.throwIfDisposed(),(0,h.X)(this,[this.size])};var G=n(7184);(0,r.t3)().prototype.floor=function(){return this.throwIfDisposed(),(0,G.G)(this)};var H=n(6986);(0,r.t3)().prototype.floorDiv=function(e){return this.throwIfDisposed(),(0,H.q)(this,e)};var X=n(5262);(0,r.t3)().prototype.gather=function(e,t){return this.throwIfDisposed(),(0,X.I)(this,e,t)};var Y=n(6731);(0,r.t3)().prototype.greaterEqual=function(e){return this.throwIfDisposed(),(0,Y.b)(this,e)};var K=n(1694);(0,r.t3)().prototype.greater=function(e){return this.throwIfDisposed(),(0,K.p)(this,e)};var J=n(8923);(0,r.t3)().prototype.ifft=function(){return this.throwIfDisposed(),(0,J.S)(this)};var Z=n(8117);(0,r.t3)().prototype.irfft=function(){return this.throwIfDisposed(),(0,Z.w)(this)};var Q=n(8846);(0,r.t3)().prototype.isFinite=function(){return this.throwIfDisposed(),(0,Q.x)(this)};var ee=n(3556);(0,r.t3)().prototype.isInf=function(){return this.throwIfDisposed(),(0,ee.U)(this)};var te=n(1557);(0,r.t3)().prototype.isNaN=function(){return this.throwIfDisposed(),(0,te.i)(this)};var ne=n(7397);(0,r.t3)().prototype.leakyRelu=function(e){return this.throwIfDisposed(),(0,ne.h)(this,e)};var ie=n(5573);(0,r.t3)().prototype.lessEqual=function(e){return this.throwIfDisposed(),(0,ie.z)(this,e)};var re=n(2359);(0,r.t3)().prototype.less=function(e){return this.throwIfDisposed(),(0,re.d)(this,e)};var se=n(734);(0,r.t3)().prototype.localResponseNormalization=function(e,t,n,i){return this.throwIfDisposed(),(0,se.G)(this,e,t,n,i)};var ae=n(2959);(0,r.t3)().prototype.logSigmoid=function(){return this.throwIfDisposed(),(0,ae.e)(this)};var oe=n(2929);(0,r.t3)().prototype.logSoftmax=function(e){return this.throwIfDisposed(),(0,oe.C)(this,e)};var ue=n(2425);(0,r.t3)().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),(0,ue.l)(this,e,t)};var le=n(3102);(0,r.t3)().prototype.log=function(){return this.throwIfDisposed(),(0,le.c)(this)};var ce=n(6883);(0,r.t3)().prototype.log1p=function(){return this.throwIfDisposed(),(0,ce.K)(this)};var de=n(495);(0,r.t3)().prototype.logicalAnd=function(e){return this.throwIfDisposed(),(0,de.H)(this,e)};var he=n(1917);(0,r.t3)().prototype.logicalNot=function(){return this.throwIfDisposed(),(0,he.h)(this)};var fe=n(1634);(0,r.t3)().prototype.logicalOr=function(e){return this.throwIfDisposed(),(0,fe.K)(this,e)};var pe=n(7554);(0,r.t3)().prototype.logicalXor=function(e){return this.throwIfDisposed(),(0,pe.e)(this,e)};var me=n(8249);(0,r.t3)().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),(0,me.O)(this,e,t,n)};var ge=n(4433);(0,r.t3)().prototype.maxPool=function(e,t,n,i){return this.throwIfDisposed(),(0,ge._)(this,e,t,n,i)};var ye=n(4991);(0,r.t3)().prototype.max=function(e,t){return this.throwIfDisposed(),(0,ye.F)(this,e,t)};var ve=n(3171);(0,r.t3)().prototype.maximum=function(e){return this.throwIfDisposed(),(0,ve.g)(this,e)};var be=n(4854);(0,r.t3)().prototype.mean=function(e,t){return this.throwIfDisposed(),(0,be.J)(this,e,t)};var xe=n(6038);(0,r.t3)().prototype.min=function(e,t){return this.throwIfDisposed(),(0,xe.V)(this,e,t)};var we=n(7511);(0,r.t3)().prototype.minimum=function(e){return this.throwIfDisposed(),(0,we.L)(this,e)};var Ce=n(4267);(0,r.t3)().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),(0,Ce.V)(this,e,t)};var ke=n(5475);(0,r.t3)().prototype.mod=function(e){return this.throwIfDisposed(),(0,ke.w)(this,e)};var Ae=n(2805);(0,r.t3)().prototype.mul=function(e){return this.throwIfDisposed(),(0,Ae.d)(this,e)};var _e=n(7211);(0,r.t3)().prototype.neg=function(){return this.throwIfDisposed(),(0,_e.W)(this)};var Ee=n(1458);(0,r.t3)().prototype.norm=function(e,t,n){return this.throwIfDisposed(),(0,Ee.K)(this,e,t,n)};var Se=n(1576);(0,r.t3)().prototype.notEqual=function(e){return this.throwIfDisposed(),(0,Se.Q)(this,e)};var Fe=n(7910);(0,r.t3)().prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),(0,Fe.l)(this,e,t,n)};var De=n(9622);(0,r.t3)().prototype.onesLike=function(){return this.throwIfDisposed(),(0,De.J)(this)};var $e=n(7039);(0,r.t3)().prototype.pad=function(e,t){return this.throwIfDisposed(),(0,$e.v)(this,e,t)};var Oe=n(4349);(0,r.t3)().prototype.pool=function(e,t,n,i,r){return this.throwIfDisposed(),(0,Oe.d)(this,e,t,n,i,r)};var Ne=n(3788);(0,r.t3)().prototype.pow=function(e){return this.throwIfDisposed(),(0,Ne.s)(this,e)};var Ie=n(1224);(0,r.t3)().prototype.prelu=function(e){return this.throwIfDisposed(),(0,Ie.A)(this,e)};var Te=n(3610);(0,r.t3)().prototype.prod=function(e,t){return this.throwIfDisposed(),(0,Te.W)(this,e,t)};var Re=n(3217);(0,r.t3)().prototype.reciprocal=function(){return this.throwIfDisposed(),(0,Re.M)(this)};var Me=n(8536);(0,r.t3)().prototype.relu=function(){return this.throwIfDisposed(),(0,Me.U)(this)};var Be=n(9902);(0,r.t3)().prototype.relu6=function(){return this.throwIfDisposed(),(0,Be.b)(this)},(0,r.t3)().prototype.reshapeAs=function(e){return this.throwIfDisposed(),(0,h.X)(this,e.shape)},(0,r.t3)().prototype.reshape=function(e){return this.throwIfDisposed(),(0,h.X)(this,e)};var ze=n(4284);(0,r.t3)().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),(0,ze.I)(this,e,t,n)};var Le=n(739);(0,r.t3)().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),(0,Le.j)(this,e,t,n)};var Pe=n(4330);(0,r.t3)().prototype.reverse=function(e){return this.throwIfDisposed(),(0,Pe.G)(this,e)};var je=n(1411);(0,r.t3)().prototype.rfft=function(){return this.throwIfDisposed(),(0,je.Q)(this)};var Ue=n(4520);(0,r.t3)().prototype.round=function(){return this.throwIfDisposed(),(0,Ue.N)(this)};var We=n(5829);(0,r.t3)().prototype.rsqrt=function(){return this.throwIfDisposed(),(0,We.b)(this)};var Ve=n(2899);(0,r.t3)().prototype.selu=function(){return this.throwIfDisposed(),(0,Ve.U)(this)};var qe=n(1438);(0,r.t3)().prototype.separableConv2d=function(e,t,n,i,r,s){return this.throwIfDisposed(),(0,qe.U)(this,e,t,n,i,r,s)};var Ge=n(5808);(0,r.t3)().prototype.sigmoid=function(){return this.throwIfDisposed(),(0,Ge.X)(this)};var He=n(2399);(0,r.t3)().prototype.sign=function(){return this.throwIfDisposed(),(0,He.X)(this)};var Xe=n(221);(0,r.t3)().prototype.sin=function(){return this.throwIfDisposed(),(0,Xe.O)(this)};var Ye=n(1671);(0,r.t3)().prototype.sinh=function(){return this.throwIfDisposed(),(0,Ye.R)(this)};var Ke=n(2565);(0,r.t3)().prototype.slice=function(e,t){return this.throwIfDisposed(),(0,Ke.t)(this,e,t)};var Je=n(5301);(0,r.t3)().prototype.softmax=function(e){return this.throwIfDisposed(),(0,Je.X)(this,e)};var Ze=n(9876);(0,r.t3)().prototype.softplus=function(){return this.throwIfDisposed(),(0,Ze.W)(this)};var Qe=n(1639);(0,r.t3)().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),(0,Qe.f)(this,e,t)};var et=n(1381);(0,r.t3)().prototype.split=function(e,t){return this.throwIfDisposed(),(0,et.V)(this,e,t)};var tt=n(7346);(0,r.t3)().prototype.sqrt=function(){return this.throwIfDisposed(),(0,tt._)(this)};var nt=n(6966);(0,r.t3)().prototype.square=function(){return this.throwIfDisposed(),(0,nt.h)(this)};var it=n(8774);(0,r.t3)().prototype.squaredDifference=function(e){return this.throwIfDisposed(),(0,it.$)(this,e)};var rt=n(5920);(0,r.t3)().prototype.squeeze=function(e){return this.throwIfDisposed(),(0,rt.L)(this,e)};var st=n(2235);(0,r.t3)().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof r.es?[this,e]:[this,...e];return(0,st.k)(n,t)};var at=n(3863);(0,r.t3)().prototype.step=function(e){return this.throwIfDisposed(),(0,at.N)(this,e)};var ot=n(8333);(0,r.t3)().prototype.stridedSlice=function(e,t,n,i,r,s,a,o){return this.throwIfDisposed(),(0,ot.N)(this,e,t,n,i,r,s,a,o)};var ut=n(6885);(0,r.t3)().prototype.sub=function(e){return this.throwIfDisposed(),(0,ut.l)(this,e)};var lt=n(4786);(0,r.t3)().prototype.sum=function(e,t){return this.throwIfDisposed(),(0,lt.S)(this,e,t)};var ct=n(7088);(0,r.t3)().prototype.tan=function(){return this.throwIfDisposed(),(0,ct.O)(this)};var dt=n(1871);(0,r.t3)().prototype.tanh=function(){return this.throwIfDisposed(),(0,dt.A)(this)};var ht=n(3239);(0,r.t3)().prototype.tile=function(e){return this.throwIfDisposed(),(0,ht.G)(this,e)},(0,r.t3)().prototype.toBool=function(){return this.throwIfDisposed(),(0,p.p)(this,"bool")},(0,r.t3)().prototype.toFloat=function(){return this.throwIfDisposed(),(0,p.p)(this,"float32")},(0,r.t3)().prototype.toInt=function(){return this.throwIfDisposed(),(0,p.p)(this,"int32")};var ft=n(9090);(0,r.t3)().prototype.topk=function(e,t){return this.throwIfDisposed(),(0,ft.h)(this,e,t)};var pt=n(6336);(0,r.t3)().prototype.transpose=function(e){return this.throwIfDisposed(),(0,pt.p)(this,e)};var mt=n(3447);(0,r.t3)().prototype.unique=function(e){return this.throwIfDisposed(),(0,mt.T)(this,e)};var gt=n(3644);(0,r.t3)().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),(0,gt.p)(this,e,t)};var yt=n(7690);(0,r.t3)().prototype.unstack=function(e){return this.throwIfDisposed(),(0,yt.H)(this,e)};var vt=n(1203);(0,r.t3)().prototype.where=function(e,t){return this.throwIfDisposed(),(0,vt.a)(e,this,t)};var bt=n(9635);(0,r.t3)().prototype.zerosLike=function(){return this.throwIfDisposed(),(0,bt.P)(this)}},4402:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(2427),r=n(1978);class s extends i.Component{componentDidMount(){const{name:e,tab:t}=this.props;this.props.registerSurface(e,t,this)}componentDidUpdate(){return!1}render(){const{name:e,visible:t,styles:n}=this.props,a=Object.assign({},s.defaultStyles,n),{width:o,height:u}=a;let{maxHeight:l,maxWidth:c}=a;l=u===s.defaultStyles.height?l:u,c=o===s.defaultStyles.width?c:o;const d=r.css({display:t?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:u,width:o,maxHeight:l,maxWidth:c,overflow:"auto"}),h=r.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),f=r.css({boxSizing:"border-box"});return i.h("div",{className:`${d} tf-surface`,ref:e=>this.container=e,"data-visible":t},i.h("div",{className:`${h} tf-label`,ref:e=>this.label=e},e),i.h("div",{className:`${f} tf-draw-area`,ref:e=>this.drawArea=e}))}}s.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"},t.SurfaceComponent=s},4816:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(2427),r=n(1978);class s extends i.Component{render(){const{tabNames:e,activeTab:t,handleClick:n}=this.props,s=e.length>0?e.map((e=>i.h(a,{key:e,id:e,handleClick:n,isActive:e===t},e))):null,o=r.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return i.h("div",{className:`${o} visor-tabs`},s)}}t.Tabs=s;class a extends i.Component{render(){const{children:e,isActive:t,handleClick:n,id:s}=this.props,a=r.css({borderBottomColor:t?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return i.h("a",{className:`${a} tf-tab`,"data-isactive":t,onClick:()=>n(s)},e)}}},8420:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(2427),r=n(1978),s=n(4402),a=n(4816);class o extends i.Component{static render(e,t,n){return i.render(i.h(o,Object.assign({},n)),e,t)}constructor(e){super(e),this.surfaces=new Map;const t=null==e.startOpen||e.startOpen;this.state={isOpen:t,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(e,t){const n=this.surfaceId(e,t);let i;if(!this.surfaces.has(n))throw Error(`Surface not found with id: ${n}`);return i=this.surfaces.get(n),{container:i.container,label:i.label,drawArea:i.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(e,t){return e+t}setTabs(e){const t=e.map((e=>e.tab)),n=this.state.tabs;let i;for(const e of t)n.has(e)||(n.add(e),i=e);null!=i&&this.setState({tabs:n,activeTab:i})}getTabs(){return this.state.tabs}registerSurface(e,t,n){const i=this.surfaceId(e,t);this.surfaces.set(i,n)}keyHandler(e){192===e.keyCode&&(e.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(e){this.setState({activeTab:e})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(e){this.setTabs(e.surfaceList)}render(){const{isOpen:e,isFullscreen:t,activeTab:n}=this.state,{surfaceList:o}=this.props,l=Array.from(this.getTabs().values()),c=t?"90vw":"550px",d=r.css({width:c,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),h=r.css({right:"0"}),f=r.css({right:`calc(-${c} - 10px)`}),p=e?h:f,m=r.css({});return i.h("div",{className:`${d} ${p} visor`,"data-isopen":e,"data-isfullscreen":t},i.h(u,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:t}),i.h(a.Tabs,{tabNames:l,activeTab:n,handleClick:this.setActiveTab.bind(this)}),i.h("div",{className:`${m} visor-surfaces`},o.map((e=>i.h(s.SurfaceComponent,{key:e.name+e.tab,name:e.name,tab:e.tab,styles:e.styles,registerSurface:this.registerSurface.bind(this),visible:n===e.tab})))))}}function u(e){const{isFullScreen:t,fullScreenHandler:n,closeHandler:s}=e,a=r.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),o=r.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),u=r.css({marginLeft:"auto"});return i.h("div",{className:`${a} visor-controls`},i.h("button",{className:`${o}`,onClick:n},t?"Minimize":"Maximize"),i.h("button",{className:`${o} ${u}`,onClick:s},"Hide"))}t.VisorComponent=o},4427:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(8397),n(4815);const i=n(9403),r=n(8650),s=n(3557),a=n(3095),o=n(3373),u=n(9437),l=n(3254),c=n(6999),d=n(3808),h=n(1147),f=n(2053),p=n(9066),m=n(4417);t.version_vis=m.version;const g={barchart:i.barchart,table:l.table,histogram:a.histogram,linechart:o.linechart,scatterplot:u.scatterplot,confusionMatrix:r.confusionMatrix,heatmap:s.heatmap};t.render=g;const y={accuracy:p.accuracy,perClassAccuracy:p.perClassAccuracy,confusionMatrix:p.confusionMatrix};t.metrics=y;const v={history:c.history,fitCallbacks:c.fitCallbacks,perClassAccuracy:h.perClassAccuracy,valuesDistribution:f.valuesDistribution,layer:d.layer,modelSummary:d.modelSummary};t.show=v;var b=n(8769);t.visor=b.visor,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(3145))},9403:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}u((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(4731)),a=n(9326),o=n(7798);t.barchart=function(e,t,n={}){return i(this,void 0,void 0,(function*(){const i=o.getDrawArea(e),r=t,c=Object.assign({},u,n);if(l.has(i)){const e=l.get(i);if(o.shallowEquals(c,e.lastOptions)){yield o.nextFrame();const t=e.view,n=t.changeset().remove((()=>!0)).insert(r);return void(yield t.change("values",n).runAsync())}}const{xLabel:d,yLabel:h,xType:f,yType:p}=c;let m=null;null!=d&&(m={title:d});let g,y=null;null!=h&&(y={title:h}),g=null!=c.color?Array.isArray(c.color)?{field:"index",type:"nominal",scale:{range:c.color}}:{value:c.color}:{value:"#4C78A0"};const v={width:c.width||a.getDefaultWidth(i),height:c.height||a.getDefaultHeight(i),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:c.fontSize,titleFontSize:c.fontSize},text:{fontSize:c.fontSize},legend:{labelFontSize:c.fontSize,titleFontSize:c.fontSize}},data:{values:r,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:f,axis:m},y:{field:"value",type:p,axis:y},color:g}};yield o.nextFrame();const b=yield s.default(i,v,{actions:!1,mode:"vega-lite",defaultStyle:!1});l.set(i,{view:b.view,lastOptions:c})}))};const u={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},l=new Map},8650:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}u((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(4731)),a=n(9326),o=n(7798);t.confusionMatrix=function(e,t,n={}){return i(this,void 0,void 0,(function*(){const i=Object.assign({},u,n),r=o.getDrawArea(e),l=[],c=t.values,d=t.tickLabels||[],h=0===d.length;let f=!0;for(let e=0;e<c.length;e++){const t=h?`Class ${e}`:d[e];h&&d.push(t);for(let n=0;n<c[e].length;n++){const r=h?`Class ${n}`:d[n],s=c[e][n];e!==n||i.shadeDiagonal?(l.push({label:t,prediction:r,count:s,scaleCount:s}),0!==s&&(f=!1)):l.push({label:t,prediction:r,count:s,noFill:!0})}}if(!i.shadeDiagonal&&f)for(const e of l)!0===e.noFill&&(e.noFill=!1,e.scaleCount=e.count);const p={width:i.width||a.getDefaultWidth(r),height:i.height||a.getDefaultHeight(r),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize}},data:{values:l},encoding:{x:{field:"prediction",type:"ordinal",title:i.xLabel||"prediction",scale:{domain:d}},y:{field:"label",type:"ordinal",title:i.yLabel||"label",scale:{domain:d}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:i.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};!1===i.shadeDiagonal&&p.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),i.showTextOverlay&&p.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const m="string"==typeof i.colorMap?{scheme:i.colorMap}:i.colorMap;p.layer[0].encoding.color.scale.range=m,yield s.default(r,p,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))};const u={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]}},3557:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}u((i=i.apply(e,t||[])).next())}))},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(8397)),o=s(n(4731)),u=n(9326),l=n(7425),c=n(7798);function d(e,t,n){const i=e instanceof a.Tensor?e.shape:[e.length,e[0].length];0===n?l.assert(i[0]===t.length,`Length of xTickLabels (${t.length}) must match number of rows (${i[0]})`):1===n&&l.assert(i[1]===t.length,`Length of yTickLabels (${t.length}) must match number of columns (${i[1]})`)}t.heatmap=function(e,t,n={}){return i(this,void 0,void 0,(function*(){const r=Object.assign({},h,n),s=c.getDrawArea(e);let f=t.values;r.rowMajor&&(f=yield function(e){return i(this,void 0,void 0,(function*(){let t,n;e instanceof a.Tensor?(t=e.shape,n=e.transpose()):(t=[e.length,e[0].length],n=a.tidy((()=>a.tensor2d(e).transpose()))),l.assert(2===n.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const i=yield n.array();n.dispose();const r=[i.length,i[0].length];return l.assert(t[0]===r[1]&&t[1]===r[0],`Unexpected transposed shape. Original ${t} : Transposed ${r}`),i}))}(t.values));const{xTickLabels:p,yTickLabels:m}=t;null!=p&&d(f,p,0),null!=m&&d(f,m,1);const g=[];if(f instanceof a.Tensor){l.assert(2===f.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const e=yield f.data(),[t,n]=f.shape;for(let i=0;i<t;i++){const t=p?`${p[i]}@tfidx@${i}`:i;for(let r=0;r<n;r++){const s=m?`${m[r]}@tfidx@${r}`:r,a=e[i*n+r];g.push({x:t,y:s,value:a})}}}else{const e=f;for(let t=0;t<e.length;t++){const n=p?`${p[t]}@tfidx@${t}`:t;for(let i=0;i<e[t].length;i++){const r=m?`${m[i]}@tfidx@${i}`:i,s=e[t][i];g.push({x:n,y:r,value:s})}}}const y={actions:!1,mode:"vega-lite",defaultStyle:!1},v={width:r.width||u.getDefaultWidth(s),height:r.height||u.getDefaultHeight(s),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:g},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:r.xType,title:r.xLabel,sort:!1},y:{field:"y",type:r.yType,title:r.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},b=new RegExp("@tfidx@\\d+$");let x;switch(p&&(v.encoding.x.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),m&&(v.encoding.y.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),(p||m)&&(y.tooltip={sanitize:e=>String(e).replace(b,"")}),r.colorMap){case"blues":x=["#f7fbff","#4292c6"];break;case"greyscale":x=["#000000","#ffffff"];break;case"viridis":default:x="viridis"}if("viridis"!==x&&(v.encoding.fill.scale={range:x}),r.domain){const e=v.encoding.fill;null!=e.scale?e.scale=Object.assign({},e.scale,{domain:r.domain}):e.scale={domain:r.domain}}yield o.default(s,v,y)}))};const h={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1}},3095:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}u((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(2869),a=r(n(4731)),o=n(9326),u=n(9066),l=n(3254),c={maxBins:12,fontSize:11};t.histogram=function(e,t,n={}){return i(this,void 0,void 0,(function*(){const i=function(e){if(null==e.length)throw new Error("input data must be an array");if(0===e.length)return[];if("object"==typeof e[0]){if(null==e[0].value)throw new Error("input data must have a value field");return e}{const t=Array(e.length);for(let n=0;n<e.length;n++)t[n]={value:e[n]};return t}}(t),r=Object.assign({},c,n),d=o.subSurface(e,"histogram");if(!1!==n.stats){const t=o.subSurface(e,"stats",{prepend:!0});let a;a=n.stats?n.stats:u.arrayStats(i.map((e=>e.value))),function(e,t,n){const i=s.format(",.4~f"),r=s.format(".4~p"),a=[],o=[];if(null!=e.numVals&&(a.push("Num Vals"),o.push(i(e.numVals))),null!=e.min&&(a.push("Min"),o.push(i(e.min))),null!=e.max&&(a.push("Max"),o.push(i(e.max))),null!=e.numZeros){a.push("# Zeros");let t="";e.numVals&&(t=e.numZeros>0?`(${r(e.numZeros/e.numVals)})`:""),o.push(`${i(e.numZeros)} ${t}`)}if(null!=e.numNans){a.push("# NaNs");let t="";e.numVals&&(t=e.numNans>0?`(${r(e.numNans/e.numVals)})`:""),o.push(`${i(e.numNans)} ${t}`)}if(null!=e.numInfs){a.push("# Infinity");let t="";e.numVals&&(t=e.numInfs>0?`(${r(e.numInfs/e.numVals)})`:""),o.push(`${i(e.numInfs)} ${t}`)}l.table(t,{headers:a,values:[o]},n)}(a,t,{fontSize:r.fontSize})}if(0===i.length)return;const h=[];for(let e=0;e<i.length;e++){const t=i[e].value;null!=t&&isFinite(t)&&h.push(i[e])}const f={width:r.width||o.getDefaultWidth(d),height:r.height||o.getDefaultHeight(d),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:h},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize}},encoding:{x:{bin:{maxbins:r.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:r.color||"#001B44"}}};return a.default(d,f,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))}},3373:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}u((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(4731)),a=n(9326),o=n(7425),u=n(7798);t.linechart=function(e,t,n={}){return i(this,void 0,void 0,(function*(){const i=Array.isArray(t.values[0])?t.values:[t.values],r=i[0].length,c=t.series?t.series:i.map(((e,t)=>`Series ${t+1}`));o.assert(c.length===i.length,"Must have an equal number of series labels as there are data series"),null!=n.seriesColors&&o.assert(n.seriesColors.length===i.length,"Must have an equal number of series colors as there are data series");const d=[];for(let e=0;e<r;e++){const t={x:e};c.forEach(((n,r)=>{const s=i[r][e].y;t[n]=s,t[`${n}-name`]=n})),d.push(t)}const h=Object.assign({},l,n),f={x:{field:"x",type:h.xType,title:h.xLabel},tooltip:[{field:"x",type:"quantitative"},...c.map((e=>({field:e,type:"quantitative"})))]},p=c.map((e=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:e,type:h.yType,title:h.yLabel,scale:h.zoomToFit?{zero:!1}:null!=h.yAxisDomain?{domain:h.yAxisDomain}:void 0},color:{field:`${e}-name`,type:"nominal",legend:{values:c,title:null},scale:{range:h.seriesColors}}}}))),m=u.getDrawArea(e),g={width:h.width||a.getDefaultWidth(m),height:h.height||a.getDefaultHeight(m),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:h.fontSize,titleFontSize:h.fontSize},text:{fontSize:h.fontSize},legend:{labelFontSize:h.fontSize,titleFontSize:h.fontSize}},data:{values:d},encoding:f,layer:[...p,{mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}}]};return yield s.default(m,g,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const l={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},7798:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3145),s=n(8769);t.getDrawArea=function(e){if(e instanceof HTMLElement)return e;if(r.isSurface(e))return e.drawArea;if(r.isSurfaceInfo(e))return s.visor().surface({name:e.name,tab:e.tab,styles:e.styles}).drawArea;throw new Error("Not a drawable")},t.shallowEquals=function(e,t){const n=Object.getOwnPropertyNames(e),i=Object.getOwnPropertyNames(t);if(n.length!==i.length)return!1;for(let i=0;i<n.length;i++){const r=n[i];if(e[r]!==t[r])return!1}return!0},t.nextFrame=function(){return i(this,void 0,void 0,(function*(){yield new Promise((e=>requestAnimationFrame(e)))}))}},9437:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}u((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(4731)),a=n(9326),o=n(7425),u=n(7798);t.scatterplot=function(e,t,n={}){return i(this,void 0,void 0,(function*(){let i=t.values;const r=null==t.series?[]:t.series;i=Array.isArray(i[0])?i:[i];const c=[];i.forEach(((e,t)=>{const n=null!=r[t]?r[t]:`Series ${t+1}`,i=e.map((e=>Object.assign({},e,{series:n})));c.push(...i)})),null!=n.seriesColors&&o.assert(n.seriesColors.length===i.length,"Must have an equal number of series colors as there are data series");const d=u.getDrawArea(e),h=Object.assign({},l,n),f={width:h.width||a.getDefaultWidth(d),height:h.height||a.getDefaultHeight(d),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:h.fontSize,titleFontSize:h.fontSize},text:{fontSize:h.fontSize},legend:{labelFontSize:h.fontSize,titleFontSize:h.fontSize}},data:{values:c},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:h.xType,title:h.xLabel,scale:h.zoomToFit?{zero:!1}:null!=h.xAxisDomain?{domain:h.xAxisDomain}:void 0},y:{field:"y",type:h.yType,title:h.yLabel,scale:h.zoomToFit?{zero:!1}:null!=h.yAxisDomain?{domain:h.yAxisDomain}:void 0},color:{field:"series",type:"nominal",scale:{range:h.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield s.default(d,f,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const l={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},3254:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(2869),r=n(9735),s=n(1978),a=n(7798);t.table=function(e,t,n={}){if(t&&null==t.headers)throw new Error('Data to render must have a "headers" property');if(t&&null==t.values)throw new Error('Data to render must have a "values" property');const u=a.getDrawArea(e),l=Object.assign({},o,n);let c=r.select(u).select("table.tf-table");const d=s.css({fontSize:l.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(0===c.size()&&(c=r.select(u).append("table"),c.attr("class",` ${d} tf-table`),c.append("thead").append("tr"),c.append("tbody")),1!==c.size())throw new Error("Error inserting table");const h=s.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),f=c.select("thead").select("tr").selectAll("th").data(t.headers),p=f.enter().append("th").attr("class",`${h}`);f.merge(p).html((e=>e)),f.exit().remove();const m=i.format(",.4~f"),g=c.select("tbody").selectAll("tr").data(t.values),y=g.enter().append("tr"),v=s.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),b=g.merge(y).selectAll("td").data((e=>e)),x=b.enter().append("td").attr("class",`${v}`);b.merge(x).html((e=>"number"==typeof e?m(e):e)),b.exit().remove(),g.exit().remove()};const o={fontSize:14}},6999:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3373),s=n(7798),a=n(9326);function o(e,t,n,o={}){return i(this,void 0,void 0,(function*(){const i=s.getDrawArea(e),c={};for(const e of n)if(/val_/.test(e)){const i=e.replace("val_","");u(c,i);const r=l(t,e,n.indexOf(e));c[i].series.push(e),c[i].values.push(r)}else{const i=l(t,e,n.indexOf(e));u(c,e),c[e].series.push(e),c[e].values.push(i)}const d=Object.keys(c),h=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},o),f=[];for(const e of d){const t=a.subSurface(i,e),n=c[e].series,s=c[e].values;n.every((e=>Boolean(e.match("acc"))))&&(h.zoomToFitAccuracy?h.zoomToFit=!0:(h.yAxisDomain=[0,1],delete h.zoomToFit));const o=r.linechart(t,{values:s,series:n},h);f.push(o)}yield Promise.all(f)}))}function u(e,t){null==e[t]&&(e[t]={series:[],values:[]})}function l(e,t,n){if(Array.isArray(e)){const i=Array.isArray(e[0])?e[n]:e,r=[];for(let e=0;e<i.length;e++){const n=i[e];r.push({x:e,y:n[t]})}return r}return e.history[t].map(((e,t)=>({x:t,y:e})))}function c(e,t,n){return null==e[t]&&(e[t]={}),null==e[t][n]&&(e[t][n]=[]),e[t][n]}t.history=o,t.fitCallbacks=function(e,t,n={}){const r={},u=n.callbacks||["onEpochEnd","onBatchEnd"],l=s.getDrawArea(e),d=Object.assign({},n);delete d.callbacks;const h={};return u.forEach((e=>{h[e]=function(e){return(n,u)=>i(this,void 0,void 0,(function*(){/batch/i.test(e)?d.xLabel="Batch":/epoch/i.test(e)&&(d.xLabel="Epoch");const n=[],i=[];for(const s of t)if(null!=u[s]){i.push(s);const t=c(r,e,s);t.push({[s]:u[s]}),n.push(t)}o(a.subSurface(l,e,{title:e}),n,i,d),yield s.nextFrame()}))}(e)})),h}},3808:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3095),s=n(7798),a=n(3254),o=n(9326),u=n(9066);function l(e){let t;return t=Array.isArray(e.outputShape[0])?`[${e.outputShape.map((e=>c(e))).join(", ")}]`:c(e.outputShape),{name:e.name,trainable:e.trainable,parameters:e.countParams(),outputShape:t}}function c(e){const t=e.slice();return 0===t.length?"Scalar":(null===t[0]&&(t[0]="batch"),`[${t.join(",")}]`)}t.modelSummary=function(e,t){return i(this,void 0,void 0,(function*(){const n=s.getDrawArea(e),i=function(e){return{layers:e.layers.map(l)}}(t).layers.map((e=>[e.name,e.outputShape,e.parameters,e.trainable]));a.table(n,{headers:["Layer Name","Output Shape","# Of Params","Trainable"],values:i})}))},t.layer=function(e,t){return i(this,void 0,void 0,(function*(){const n=s.getDrawArea(e),l=yield function(e){return i(this,void 0,void 0,(function*(){const t=e.getWeights(),n=e.weights,i=t.map(u.tensorStats),r=yield Promise.all(i),s=t.map((e=>e.shape));return t.map(((e,t)=>({name:n[t].name,stats:r[t],shape:c(s[t]),weight:e})))}))}(t),d=o.subSurface(n,"layer-weights-info"),h=l.map((e=>[e.name,e.shape,e.stats.min,e.stats.max,e.weight.size,e.stats.numZeros,e.stats.numNans,e.stats.numInfs]));a.table(d,{headers:["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],values:h});const f=o.subSurface(n,"select-layer"),p=o.subSurface(n,"param-distribution");!function(e,t,n){const i=`<div><button>Show Values Distribution for:</button>${`\n    <select>\n      ${e.map((e=>`<option value=${e}>${e}</option>`))}\n    </select>\n  `}</div>`;t.innerHTML=i;const r=t.querySelector("button"),s=t.querySelector("select");r.addEventListener("click",(()=>{n(s.selectedOptions[0].label)}))}(l.map((e=>e.name)),f,(e=>i(this,void 0,void 0,(function*(){const t=l.filter((t=>t.name===e))[0],n=yield t.weight.data();r.histogram(p,n,{height:150,width:460,stats:!1})}))))}))}},1147:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(7798),s=n(3254);t.perClassAccuracy=function(e,t,n){return i(this,void 0,void 0,(function*(){const i=r.getDrawArea(e),a=[];for(let e=0;e<t.length;e++){const i=n?n[e]:e.toString(),r=t[e];a.push([i,r.accuracy,r.count])}return s.table(i,{headers:["Class","Accuracy","# Samples"],values:a})}))}},2053:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3095),s=n(7798),a=n(9066);t.valuesDistribution=function(e,t){return i(this,void 0,void 0,(function*(){const n=s.getDrawArea(e),i=yield a.tensorStats(t),o=yield t.data();r.histogram(n,o,{height:150,stats:i})}))}},3145:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSurfaceInfo=function(e){return null!=e.name},t.isSurface=function(e){return e.drawArea instanceof HTMLElement}},9326:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1978),r=n(7798),s={prepend:!1};t.subSurface=function(e,t,n={}){const a=r.getDrawArea(e),o=i.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),u=i.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),l=Object.assign({},s,n);let c=a.querySelector(`div[data-name=${t}]`);if(!c){if(c=document.createElement("div"),c.setAttribute("class",`${o}`),c.dataset.name=t,l.title){const e=document.createElement("div");e.setAttribute("class",`subsurface-title ${u}`),e.innerText=l.title,c.appendChild(e)}l.prepend?a.insertBefore(c,a.firstChild):a.appendChild(c)}return c},t.getDefaultWidth=function(e){let t=0,n=e;for(;n&&0===n.clientWidth;)n=n.parentElement,t=50;return n.clientWidth-t},t.getDefaultHeight=function(e){return 0===e.clientHeight?200:e.clientHeight}},9066:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(8397),s=n(7425);t.arrayStats=function(e){if(!Array.isArray(e))throw new Error("input must be an array");if(0===e.length)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const t=e.length;let n=-1/0,i=1/0,r=0,s=0,a=0;for(let o=0;o<t;o++){const t=e[o];t>n&&(n=t),t<i&&(i=t),0===t&&(r+=1),isNaN(t)?s+=1:isFinite(t)||(a+=1)}const o={numVals:t,numZeros:r,numNans:s,max:n,min:i,numInfs:a};return o.max===-1/0&&(o.max=NaN),o.min===1/0&&(o.min=NaN),o},t.tensorStats=function(e){return i(this,void 0,void 0,(function*(){const[t,n,i]=r.tidy((()=>{const t=r.scalar(0,e.dtype);return[e.min(),e.max(),e.equal(t).sum()]}));return Promise.all([e.data(),t.data(),n.data(),i.data()]).then((([e,t,n,i])=>{const r=e.length;let s=0,a=0;for(let t=0;t<r;t++){const n=e[t];isNaN(n)?s+=1:isFinite(n)||(a+=1)}let o=t[0],u=n[0];return s===r&&(o=NaN,u=NaN),{numVals:r,numZeros:i[0],numNans:s,min:o,max:u,numInfs:a}}))}))},t.confusionMatrix=function(e,t,n,a){return i(this,void 0,void 0,(function*(){s.assert(1===e.rank,"labels must be a 1D tensor"),s.assert(1===t.rank,"predictions must be a 1D tensor"),s.assert(e.size===t.size,"labels and predictions must be the same length"),null!=a&&s.assert(a.size===t.size,"labels and predictions must be the same length");const i=e.cast("int32"),o=t.cast("int32");null==n&&(n=r.tidy((()=>r.maximum(i.max(),o.max()).cast("int32").dataSync()[0]+1)));let u=Promise.resolve(null);return null!=a&&(u=a.data()),Promise.all([i.data(),o.data(),u]).then((([e,t,i])=>{const r=Array(n).fill(0);for(let e=0;e<n;e++)r[e]=Array(n).fill(0);for(let n=0;n<e.length;n++){const s=e[n],a=t[n];r[s][a]+=null!=i?i[n]:1}return r}))}))},t.accuracy=function(e,t){return i(this,void 0,void 0,(function*(){s.assertShapesMatch(e.shape,t.shape,"Error computing accuracy.");const n=e.equal(t),i=n.mean(),a=(yield i.data())[0];return r.dispose([n,i]),a}))},t.perClassAccuracy=function(e,t,n){return i(this,void 0,void 0,(function*(){return s.assert(1===e.rank,"labels must be a 1D tensor"),s.assert(1===t.rank,"predictions must be a 1D tensor"),s.assert(e.size===t.size,"labels and predictions must be the same length"),null==n&&(n=r.tidy((()=>r.maximum(e.max(),t.max()).dataSync()[0]+1))),Promise.all([e.data(),t.data()]).then((([e,t])=>{const i=Array(n).fill(0),r=Array(n).fill(0);for(let n=0;n<e.length;n++){const s=e[n],a=t[n];i[s]+=1,s===a&&(r[s]+=1)}const s=[];for(let e=0;e<i.length;e++)s.push({count:i[e],accuracy:0===i[e]?0:r[e]/i[e]});return s}))}))}},7425:(e,t)=>{"use strict";function n(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function i(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.assert=n,t.assertShapesMatch=function(e,t,r=""){n(i(e,t),r+` Shapes ${e} and ${t} must match`)},t.arraysEqual=i,t.DECIMAL_PLACES_TO_CHECK=4},4417:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="1.5.1"},8769:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(8420);let r;const s="tfjs-visor-container";t.visor=function(){if("undefined"==typeof document)throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(s)&&null!=r)return r;let e,t=document.getElementById(s);function n(t,n){let r=null;return e=i.VisorComponent.render(t,e,{ref:e=>r=e,surfaceList:Array.from(n.values())}),r}null==t&&(t=document.createElement("div"),t.id=s,document.body.appendChild(t));const o=new Map,u=n(t,o);return r=new a(u,t,o,n),r};class a{constructor(e,t,n,i){this.visorComponent=e,this.el=t,this.surfaceList=n,this.renderVisor=i}surface(e){const{name:t}=e,n=null==e.tab?"Visor":e.tab;if(null==t||!("string"==typeof t||t instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const i=Object.assign({},e,{tab:n}),r=`${t}-${n}`;return this.surfaceList.has(r)||this.surfaceList.set(r,i),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(t,n)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(e){if(!this.visorComponent.state.tabs.has(e))throw new Error(`Tab '${e}' does not exist`);this.visorComponent.setState({activeTab:e})}}t.Visor=a},2869:(e,t,n)=>{"use strict";function i(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function r(e){return(e=i(Math.abs(e)))?e[1]:NaN}n.r(t),n.d(t,{format:()=>f,formatDefaultLocale:()=>y,formatLocale:()=>g,formatPrefix:()=>p,formatSpecifier:()=>o,precisionFixed:()=>v,precisionPrefix:()=>b,precisionRound:()=>x});var s,a=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function o(e){return new u(e)}function u(e){if(!(t=a.exec(e)))throw new Error("invalid format: "+e);var t;this.fill=t[1]||" ",this.align=t[2]||">",this.sign=t[3]||"-",this.symbol=t[4]||"",this.zero=!!t[5],this.width=t[6]&&+t[6],this.comma=!!t[7],this.precision=t[8]&&+t[8].slice(1),this.trim=!!t[9],this.type=t[10]||""}function l(e,t){var n=i(e,t);if(!n)return e+"";var r=n[0],s=n[1];return s<0?"0."+new Array(-s).join("0")+r:r.length>s+1?r.slice(0,s+1)+"."+r.slice(s+1):r+new Array(s-r.length+2).join("0")}o.prototype=u.prototype,u.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const c={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return l(100*e,t)},r:l,s:function(e,t){var n=i(e,t);if(!n)return e+"";var r=n[0],a=n[1],o=a-(s=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,u=r.length;return o===u?r:o>u?r+new Array(o-u+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+i(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function d(e){return e}var h,f,p,m=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function g(e){var t,n,i=e.grouping&&e.thousands?(t=e.grouping,n=e.thousands,function(e,i){for(var r=e.length,s=[],a=0,o=t[0],u=0;r>0&&o>0&&(u+o+1>i&&(o=Math.max(1,i-u)),s.push(e.substring(r-=o,r+o)),!((u+=o+1)>i));)o=t[a=(a+1)%t.length];return s.reverse().join(n)}):d,a=e.currency,u=e.decimal,l=e.numerals?function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(e.numerals):d,h=e.percent||"%";function f(e){var t=(e=o(e)).fill,n=e.align,r=e.sign,d=e.symbol,f=e.zero,p=e.width,g=e.comma,y=e.precision,v=e.trim,b=e.type;"n"===b?(g=!0,b="g"):c[b]||(null==y&&(y=12),v=!0,b="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var x="$"===d?a[0]:"#"===d&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",w="$"===d?a[1]:/[%p]/.test(b)?h:"",C=c[b],k=/[defgprs%]/.test(b);function A(e){var a,o,c,d=x,h=w;if("c"===b)h=C(e)+h,e="";else{var A=(e=+e)<0;if(e=C(Math.abs(e),y),v&&(e=function(e){e:for(var t,n=e.length,i=1,r=-1;i<n;++i)switch(e[i]){case".":r=t=i;break;case"0":0===r&&(r=i),t=i;break;default:if(r>0){if(!+e[i])break e;r=0}}return r>0?e.slice(0,r)+e.slice(t+1):e}(e)),A&&0==+e&&(A=!1),d=(A?"("===r?r:"-":"-"===r||"("===r?"":r)+d,h=("s"===b?m[8+s/3]:"")+h+(A&&"("===r?")":""),k)for(a=-1,o=e.length;++a<o;)if(48>(c=e.charCodeAt(a))||c>57){h=(46===c?u+e.slice(a+1):e.slice(a))+h,e=e.slice(0,a);break}}g&&!f&&(e=i(e,1/0));var _=d.length+e.length+h.length,E=_<p?new Array(p-_+1).join(t):"";switch(g&&f&&(e=i(E+e,E.length?p-h.length:1/0),E=""),n){case"<":e=d+e+h+E;break;case"=":e=d+E+e+h;break;case"^":e=E.slice(0,_=E.length>>1)+d+e+h+E.slice(_);break;default:e=E+d+e+h}return l(e)}return y=null==y?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),A.toString=function(){return e+""},A}return{format:f,formatPrefix:function(e,t){var n=f(((e=o(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor(r(t)/3))),s=Math.pow(10,-i),a=m[8+i/3];return function(e){return n(s*e)+a}}}}function y(e){return h=g(e),f=h.format,p=h.formatPrefix,h}function v(e){return Math.max(0,-r(Math.abs(e)))}function b(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(r(t)/3)))-r(Math.abs(e)))}function x(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,r(t)-r(e))+1}y({decimal:".",thousands:",",grouping:[3],currency:["$",""]})},9239:(e,t,n)=>{"use strict";n.d(t,{MB5:()=>r.losses,glt:()=>r.nextFrame,nGf:()=>r.randomNormal,odF:()=>r.tensor2d,lub:()=>r.tidy,p_j:()=>r.train,D5U:()=>r.util,VD$:()=>r.variable,lls:()=>r.zeros});var i={};n.r(i),n.d(i,{addImpl:()=>Il.EH,bincountImpl:()=>Tl.W,bincountReduceImpl:()=>Tl.i,ceilImpl:()=>Rl.__,concatImpl:()=>Ml.j,equalImpl:()=>Bl.tW,expImpl:()=>zl.Ro,expm1Impl:()=>Ll.OF,floorImpl:()=>Pl.r6,gatherNdImpl:()=>jl.m,gatherV2Impl:()=>Ul.i,greaterEqualImpl:()=>Vl.HL,greaterImpl:()=>Wl.o,lessEqualImpl:()=>Gl.lx,lessImpl:()=>ql.rO,linSpaceImpl:()=>Hl.b,logImpl:()=>Xl.vX,maxImpl:()=>Yl.B,maximumImpl:()=>Kl.wS,minimumImpl:()=>Jl.vP,multiplyImpl:()=>Zl.$3,negImpl:()=>Ql.uC,notEqualImpl:()=>ec.Gj,prodImpl:()=>tc.Qg,rangeImpl:()=>nc.b,rsqrtImpl:()=>ic.zd,sigmoidImpl:()=>rc.VY,simpleAbsImpl:()=>Nl.bk,sliceImpl:()=>sc.rT,sparseFillEmptyRowsImpl:()=>ac.c,sparseReshapeImpl:()=>oc.U,sparseSegmentReductionImpl:()=>uc.V,sqrtImpl:()=>lc.zT,squaredDifferenceImpl:()=>cc.Hz,stridedSliceImpl:()=>dc.t,stringNGramsImpl:()=>hc.A,stringSplitImpl:()=>fc.Q,stringToHashBucketFastImpl:()=>pc.h,subImpl:()=>mc.VY,tileImpl:()=>gc.R,topKImpl:()=>yc.W,transposeImpl:()=>vc.H,uniqueImpl:()=>bc.S});var r=n(8397),s=n(5202),a=n(5875),o=n(2805),u=n(3863);const l={kernelName:s.SY,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,o.d)(e,(0,u.N)((0,a.p)(n,"float32"),-1))}}};var c=n(2639),d=n(7211),h=n(2502),f=n(7346),p=n(6966),m=n(6885);const g={kernelName:s.VG,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=(0,p.h)((0,a.p)(n,"float32")),i=(0,f._)((0,m.l)((0,h.i)(1),t));return(0,d.W)((0,c.h)(e,i))}}}},y={kernelName:s.Sp,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=(0,f._)((0,m.l)((0,p.h)((0,a.p)(n,"float32")),1));return(0,c.h)(e,t)}}}};var v=n(2011),b=n(2673),x=n(4786);const w={kernelName:s.mm,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=v.$N(n.shape,i.shape);return{a:()=>{let t=e;const i=v.RR(n.shape,r);return i.length>0&&(t=(0,x.S)(t,i)),(0,b.X)(t,n.shape)},b:()=>{let t=e;const n=v.RR(i.shape,r);return n.length>0&&(t=(0,x.S)(t,n)),(0,b.X)(t,i.shape)}}}},C={kernelName:s.Xz,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach(((t,i)=>{n[i]=()=>e.clone()})),n}};var k=n(9635);const A={kernelName:s.sJ,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,k.P)(n)}}},_={kernelName:s.aJ,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,k.P)(n)}}},E={kernelName:s.M2,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,c.h)(e,(0,f._)((0,m.l)((0,h.i)(1),(0,p.h)((0,a.p)(n,"float32")))))}}};var S=n(7571);const F={kernelName:s.qw,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=(0,f._)((0,S.I)((0,h.i)(1),(0,p.h)((0,a.p)(n,"float32"))));return(0,c.h)(e,t)}}}},D={kernelName:s.QC,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=(0,v.$N)(n.shape,i.shape);return{a:()=>{const t=(0,S.I)((0,p.h)(n),(0,p.h)(i));let s=(0,o.d)(e,(0,c.h)(i,t));const a=(0,v.RR)(n.shape,r);return a.length>0&&(s=(0,x.S)(s,a)),(0,b.X)(s,n.shape)},b:()=>{const t=(0,S.I)((0,p.h)(n),(0,p.h)(i));let s=(0,d.W)((0,o.d)(e,(0,c.h)(n,t)));const a=(0,v.RR)(i.shape,r);return a.length>0&&(s=(0,x.S)(s,a)),(0,b.X)(s,i.shape)}}}},$={kernelName:s.jM,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,c.h)(e,(0,S.I)((0,p.h)((0,a.p)(n,"float32")),1))}}},O={kernelName:s.Oy,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,c.h)(e,(0,m.l)((0,h.i)(1),(0,p.h)((0,a.p)(n,"float32"))))}}};var N=n(3421),I=n(8516),T=n(9740),R=n(128);const M=(0,R.op)({avgPool3dGrad_:function(e,t,n,i,r,a){const o=(0,I._1)(e,"dy","avgPool3dGrad"),u=(0,I._1)(t,"input","avgPool3dGrad");let l=o,c=u,d=!1;4===u.rank&&(d=!0,l=(0,b.X)(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=(0,b.X)(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),T.hu(5===l.rank,(()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`)),T.hu(5===c.rank,(()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`)),null!=a&&T.hu(T.GN(r),(()=>`Error in avgPool3dGrad: pad must be an integer when using, dimRoundingMode ${a} but got pad ${r}.`));const h={dy:l,input:c},f={filterSize:n,strides:i,pad:r,dimRoundingMode:a},p=N.BV.runKernel(s.IM,h,f);return d?(0,b.X)(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),B={kernelName:s._k,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{filterSize:r,strides:s,pad:a,dimRoundingMode:o}=n;return{x:()=>M(e,i,r,s,a,o)}}},z=(0,R.op)({avgPoolGrad_:function(e,t,n,i,r){const a=(0,I._1)(e,"dy","avgPoolGrad"),o=(0,I._1)(t,"input","avgPoolGrad");T.hu(o.rank===a.rank,(()=>`Rank of input (${o.rank}) does not match rank of dy (${a.rank})`));let u=o,l=a,c=!1;3===o.rank&&(c=!0,u=(0,b.X)(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=(0,b.X)(a,[1,a.shape[0],a.shape[1],a.shape[2]])),T.hu(4===l.rank,(()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`)),T.hu(4===u.rank,(()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${u.rank}.`));const d={dy:l,input:u},h={filterSize:n,strides:i,pad:r},f=N.BV.runKernel(s.RO,d,h);return c?(0,b.X)(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),L={kernelName:s.Jh,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{filterSize:r,strides:s,pad:a}=n;return{x:()=>z(e,i,r,s,a)}}};var P=n(8249);const j={kernelName:s.XL,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[i,r]=t,{transposeA:s,transposeB:a}=n;return s||a?!s&&a?{a:()=>(0,P.O)(e,r,!1,!1),b:()=>(0,P.O)(e,i,!0,!1)}:s&&!a?{a:()=>(0,P.O)(r,e,!1,!0),b:()=>(0,P.O)(i,e,!1,!1)}:{a:()=>(0,P.O)(r,e,!0,!0),b:()=>(0,P.O)(e,i,!0,!0)}:{a:()=>(0,P.O)(e,r,!1,!0),b:()=>(0,P.O)(i,e,!0,!1)}}};var U=n(1639);const W={kernelName:s.zw,gradFunc:(e,t,n)=>{const{blockShape:i,crops:r}=n;return{x:()=>(0,U.f)(e,i,r)}}},V={kernelName:s.Ly,gradFunc:(e,t,n)=>{const i=n,r=i.inputShape,s=i.shape,a=Array.from(s);for(let e=r.length-1;e>=0;e--)if(r[e]===s[e])a[e]=1;else if(1!==r[e])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${s}].`);const o=[];for(let e=0;e<a.length;e++)a[e]>1&&o.push(e);return{x:()=>(0,x.S)(e,o,!0)}}},q={kernelName:s.RF,gradFunc:e=>({x:()=>e.clone()})},G={kernelName:s.gJ,gradFunc:e=>({x:()=>(0,k.P)(e)})};var H=n(6731),X=n(5573),Y=n(495),K=n(1203);const J={kernelName:s.xn,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{clipValueMin:r,clipValueMax:s}=n;return{x:()=>(0,K.a)((0,Y.H)((0,H.b)(i,r),(0,X.z)(i,s)),e,(0,k.P)(e))}}},Z={kernelName:s.yj,inputsToSave:["x"],gradFunc:l.gradFunc};var Q=n(1381);const ee={kernelName:s.Eh,saveAllInputs:!0,gradFunc:(e,t,n)=>{const i=t.map((e=>e.shape)),{axis:r}=n,s=(0,T.EC)(r,t[0].shape)[0],a=i.map((e=>e[s]));return(0,Q.V)(e,a,s).map((e=>()=>e))}};var te=n(1885),ne=n(6858),ie=n(1129);const re={kernelName:s.mh,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[i,r]=t,{dilations:s,strides:a,pad:o,dataFormat:u}=n;return T.hu(ie.I0(s),(()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`)),{x:()=>(0,ne._)(i.shape,e,r,a,o,u),filter:()=>(0,te.p)(i,e,r.shape,a,o,u)}}};var se=n(9399);const ae={kernelName:s.wm,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[i,r]=t,{strides:s,pad:a,dataFormat:o,dimRoundingMode:u}=n;return{dy:()=>(0,se.T)(e,r,s,a,o,1,u),filter:()=>(0,te.p)(e,i,r.shape,s,a,o,u)}}},oe=(0,R.op)({conv3DBackpropFilter_:function(e,t,n,i,r){let a=e;4===e.rank&&(a=(0,b.X)(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let o=t;4===o.rank&&(o=(0,b.X)(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),T.hu(5===a.rank,(()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${a.shape}.`)),T.hu(5===o.rank,(()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`)),T.hu(5===n.length,(()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`)),T.hu(a.shape[4]===n[3],(()=>`Error in conv3dDerFilter: depth of input ${a.shape[4]}) must match input depth in filter (${n[3]}.`)),T.hu(o.shape[4]===n[4],(()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`));const u={x:a,dy:o},l={strides:i,pad:r,filterShape:n};return N.BV.runKernel(s.o2,u,l)}});var ue=n(2833);const le={kernelName:s.x1,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:i,strides:r,pad:s}=n;T.hu((0,ie.I0)(i),(()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`));const[a,o]=t;return{x:()=>(0,ue._)(a.shape,e,o,r,s),filter:()=>oe(a,e,o.shape,r,s)}}};var ce=n(221);const de={kernelName:s.mc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,o.d)((0,d.W)((0,ce.O)((0,a.p)(n,"float32"))),e)}}};var he=n(1671);const fe={kernelName:s.TR,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,o.d)((0,he.R)((0,a.p)(n,"float32")),e)}}};var pe=n(7704),me=n(805),ge=n(6336);const ye={kernelName:s.iH,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{axis:r,exclusive:s,reverse:a}=n;return{x:()=>{const t=(0,pe.Q3)([r],i.rank);let n=(0,me.z)(e,r,s,!a);return null!=t&&(n=(0,ge.p)(n,t)),n}}}};var ve=n(2806),be=n(5039);const xe={kernelName:s.ci,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:i,strides:r,pad:s,dimRoundingMode:a}=n,o=null==i?[1,1]:i;T.hu(ie.I0(o),(()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[u,l]=t;return T.hu(4===u.rank,(()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`)),T.hu(4===l.rank,(()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`)),T.hu(u.shape[3]===l.shape[2],(()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`)),T.hu(ie.jT(r,o),(()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${o}'.`)),null!=a&&T.hu(T.GN(s),(()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${a} but got pad ${s}.`)),{x:()=>(0,be.v)(u.shape,e,l,r,s,o,a),filter:()=>(0,ve.z)(u,e,l.shape,r,s,o,a)}}},we={kernelName:s.p4,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[i,r]=t,a={x:i,filter:r,dy:e},o={x:i,filter:r,dy:e};return{x:()=>N.BV.runKernel(s.ek,a,n),filter:()=>N.BV.runKernel(s.Vn,o,n)}}},Ce={kernelName:s.SX,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,i={dy:e,y:n};return{x:()=>N.BV.runKernel(s.HE,i)}}};var ke=n(8575);const Ae={kernelName:s.Om,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,i=(0,o.d)((0,ke.Q)((0,d.W)((0,p.h)(n))),2/Math.sqrt(Math.PI));return{x:()=>(0,o.d)(e,i)}}},_e={kernelName:s.NE,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,o.d)(e,n)}}},Ee={kernelName:s.YF,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>(0,b.X)(e,n.shape)}}},Se={kernelName:s.Y0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,o.d)(e,(0,ke.Q)(n))}}},Fe={kernelName:s.OR,gradFunc:e=>({x:()=>(0,k.P)(e)})},De={kernelName:s.je,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=(0,v.$N)(n.shape,i.shape);return{a:()=>{const t=(0,c.h)(e,(0,a.p)(i,"float32")),s=(0,v.RR)(n.shape,r);return s.length>0?(0,b.X)((0,x.S)(t,s),n.shape):t},b:()=>{let t=(0,o.d)(e,(0,a.p)(n,"float32"));const s=(0,v.RR)(i.shape,r);s.length>0&&(t=(0,b.X)((0,x.S)(t,s),i.shape));const u=(0,p.h)(i);return(0,d.W)((0,c.h)(t,(0,a.p)(u,"float32")))}}}};var $e=n(5829),Oe=n(3239);const Ne={kernelName:s.sH,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:i}=n,[r,s,a,u]=t,l=null==u?(0,h.i)(1):u,c=(0,v.RR)(s.shape,r.shape),d=[];if(1===s.rank){for(let e=0;e<r.shape.length-1;++e)d.push(r.shape[e]);d.push(1)}const f=(0,m.l)(r,s),p=(0,o.d)(e,l),g=(0,$e.b)((0,S.I)(a,(0,h.i)(i))),y=(0,o.d)((0,o.d)((0,o.d)(g,g),g),(0,h.i)(-.5));return{x:()=>1===s.rank?(0,b.X)((0,o.d)((0,o.d)(e,(0,Oe.G)((0,b.X)(g,[1,1,1,s.shape[0]]),d)),l),r.shape):(0,b.X)((0,o.d)((0,o.d)(e,g),l),r.shape),mean:()=>{let e=(0,o.d)((0,o.d)(g,(0,h.i)(-1)),p);return 1===s.rank&&(e=(0,x.S)(e,c)),(0,b.X)(e,s.shape)},variance:()=>{let e=(0,o.d)((0,o.d)(y,f),p);return 1===s.rank&&(e=(0,x.S)(e,c)),(0,b.X)(e,s.shape)},scale:()=>{const t=(0,o.d)(f,g);let n=(0,o.d)(e,t);return 1===s.rank&&(n=(0,x.S)(n,c)),(0,b.X)(n,s.shape)},offset:()=>{let t=e;return 1===s.rank&&(t=(0,x.S)(t,c)),(0,b.X)(t,s.shape)}}}};var Ie=n(3644);const Te={kernelName:s.qi,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[i,r]=t,{axis:s}=n,a=(0,T.EC)(s,i.shape)[0];return{x:()=>{const t=i.shape,n=r.size,o=t.slice(0,a),u=o.length,l=t.slice(s,t.length).slice(1),c=l.length,d=Re(0,u),h=Re(u+1,u+1+c),f=Me([o,[n],l]),p=(0,b.X)(e,f),m=(0,b.X)(r,[n]),g=Me([[u],d,h]),y=(0,ge.p)(p,g);let v=(0,Ie.p)(y,m,i.shape[a]);const x=(0,pe.LJ)(g);return v=(0,ge.p)(v,x),v},indices:()=>r}}};function Re(e,t){const n=[];for(let i=e;i<t;++i)n.push(i);return n}function Me(e){const t=[];for(let n=0;n<e.length;++n)for(let i=0;i<e[n].length;++i)t.push(e[n][i]);return t}const Be={kernelName:s.Ac,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t;return{a:()=>(0,k.P)(n),b:()=>(0,k.P)(i)}}},ze={kernelName:s.iJ,gradFunc:e=>({x:()=>(0,a.p)(e,"float32")})},Le={kernelName:s.av,gradFunc:e=>({x:()=>(0,k.P)(e)})},Pe={kernelName:s.iW,gradFunc:e=>({x:()=>(0,k.P)(e)})},je={kernelName:s.r7,gradFunc:e=>({x:()=>(0,k.P)(e)})};var Ue=n(1694);const We={kernelName:s.J$,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{alpha:r}=n,s=(0,Ue.p)(i,0);return{x:()=>(0,K.a)(s,e,(0,o.d)(e,r))}}},Ve={kernelName:s.kU,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,c.h)(e,(0,S.I)(n,1))}}},qe={kernelName:s.Zb,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,c.h)(e,(0,a.p)(n,"float32"))}}},Ge={kernelName:s.qC,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i]=t,{axis:r}=n;return{logits:()=>{const t=(0,ke.Q)(i);return(0,m.l)(e,(0,o.d)((0,x.S)(e,r,!0),t))}}}},He=(0,R.op)({localResponseNormalizationBackprop_:function(e,t,n,i=5,r=1,a=1,o=.5){const u={x:e,y:t,dy:n},l={depthRadius:i,bias:r,alpha:a,beta:o};return N.BV.runKernel(s.Hh,u,l)}}),Xe={kernelName:s.eZ,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i,r]=t,{depthRadius:s,bias:a,alpha:o,beta:u}=n;return{x:()=>He(i,r,e,s,a,o,u)}}};var Ye=n(1966);function Ke(e,t,n,i){return t.rank<n.rank&&(t=(0,b.X)(t,pe.rv(t.shape,i))),e.rank<n.rank&&(e=(0,b.X)(e,pe.rv(e.shape,i))),{x:()=>(0,o.d)(e,(0,a.p)((0,Ye.D)(n,t),e.dtype))}}const Je={kernelName:s.Yo,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const i=n,{reductionIndices:r}=i,s=t[0],a=Ke(e,t[1],s,T.EC(r,s.shape));return{x:()=>a.x()}}};var Ze=n(2359);const Qe={kernelName:s.BM,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t;return{a:()=>(0,o.d)(e,(0,a.p)((0,H.b)(n,i),"float32")),b:()=>(0,o.d)(e,(0,a.p)((0,Ze.d)(n,i),"float32"))}}},et=(0,R.op)({maxPool3dGrad_:function(e,t,n,i,r,a,o){const u=(0,I._1)(e,"dy","maxPool3dGrad"),l=(0,I._1)(t,"input","maxPool3dGrad"),c=(0,I._1)(n,"output","maxPool3dGrad");let d=u,h=l,f=c,p=!1;4===l.rank&&(p=!0,d=(0,b.X)(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=(0,b.X)(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=(0,b.X)(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),T.hu(5===d.rank,(()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`)),T.hu(5===h.rank,(()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`)),T.hu(5===f.rank,(()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`)),null!=o&&T.hu(T.GN(a),(()=>`Error in maxPool3dGrad: pad must be an integer when using, dimRoundingMode ${o} but got pad ${a}.`));const m={dy:d,input:h,output:f},g={filterSize:i,strides:r,pad:a,dimRoundingMode:o},y=N.BV.runKernel(s.OU,m,g);return p?(0,b.X)(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}}),tt={kernelName:s.OA,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i,r]=t,{filterSize:s,strides:a,pad:o,dimRoundingMode:u}=n;return{x:()=>et(e,i,r,s,a,o,u)}}},nt=(0,R.op)({maxPoolGrad_:function(e,t,n,i,r,a,o){const u=(0,I._1)(e,"dy","maxPoolGrad"),l=(0,I._1)(t,"input","maxPoolGrad"),c=(0,I._1)(n,"output","maxPoolGrad");T.hu(l.rank===u.rank,(()=>`Rank of input (${l.rank}) does not match rank of dy (${u.rank})`)),T.hu(4===u.rank,(()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${u.rank}.`)),T.hu(4===l.rank,(()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`)),null!=o&&T.hu(T.GN(a),(()=>`Error in maxPoolGrad: pad must be an integer when using, dimRoundingMode ${o} but got pad ${a}.`));const d={dy:u,input:l,output:c},h={filterSize:i,strides:r,pad:a,dimRoundingMode:o};return N.BV.runKernel(s.OV,d,h)}}),it={kernelName:s.mT,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i,r]=t,{filterSize:s,strides:a,pad:o}=n;return{x:()=>nt(e,i,r,s,a,o)}}};var rt=n(8074);const st={kernelName:s.q2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{axis:r}=n,s=T.EC(r,i.shape),a=(0,pe.kz)(i.shape,s)[1],u=T.NA(a);return{x:()=>{const t=i.shape.slice();s.forEach((e=>{t[e]=1}));const n=(0,b.X)(e,t);return(0,c.h)((0,o.d)(n,(0,rt.i)(i.shape,"float32")),u)}}}},at={kernelName:s.c1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const i=n,{axis:r}=i,[s,a]=t,o=Ke(e,a,s,T.EC(r,s.shape));return{x:()=>o.x()}}},ot={kernelName:s.q8,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t;return{a:()=>(0,o.d)(e,(0,a.p)((0,X.z)(n,i),"float32")),b:()=>(0,o.d)(e,(0,a.p)((0,Ue.p)(n,i),"float32"))}}};var ut=n(2565);const lt={kernelName:s.jQ,inputsToSave:["x"],gradFunc:(e,t,n)=>{const i=t[0],{paddings:r}=n,s=r.map((e=>e[0]));return{x:()=>(0,ut.t)(e,s,i.shape)}}};var ct=n(7184);const dt={kernelName:s.Vb,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=(0,v.$N)(n.shape,i.shape);return{a:()=>{const t=(0,v.RR)(n.shape,r);return t.length>0?(0,b.X)((0,x.S)(e,t),n.shape):e},b:()=>{const t=(0,o.d)(e,(0,d.W)((0,ct.G)((0,c.h)(n,i)))),s=(0,v.RR)(i.shape,r);return s.length>0?(0,b.X)((0,x.S)(t,s),i.shape):t}}}},ht={kernelName:s.wY,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=(0,v.$N)(n.shape,i.shape);return{a:()=>{const t=(0,o.d)(e,(0,a.p)(i,"float32")),s=(0,v.RR)(n.shape,r);return s.length>0?(0,b.X)((0,x.S)(t,s),n.shape):t},b:()=>{const t=(0,o.d)(e,(0,a.p)(n,"float32")),s=(0,v.RR)(i.shape,r);return s.length>0?(0,b.X)((0,x.S)(t,s),i.shape):t}}}},ft={kernelName:s.ku,gradFunc:e=>({x:()=>(0,d.W)(e)})};var pt=n(1434);const mt={kernelName:s.we,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>(0,pt.l)(n.shape,"float32")}}},gt={kernelName:s.qW,gradFunc:e=>({x:()=>(0,k.P)(e)})};var yt=n(7690);const vt={kernelName:s.Qi,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:i}=n;return(0,yt.H)(e,i).map((e=>()=>e))}},bt={kernelName:s.ly,inputsToSave:["x"],gradFunc:(e,t,n)=>{const i=t[0],{paddings:r}=n,s=r.map((e=>e[0]));return{x:()=>(0,ut.t)(e,s,i.shape)}}};var xt=n(3102),wt=n(3788);const Ct={kernelName:s.pe,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,i,r]=t,s=n,u=i,l=v.$N(s.shape,u.shape);return{a:()=>{const t=(0,a.p)(u,"float32");let n=(0,o.d)(e,(0,o.d)(t,(0,wt.s)(s,(0,m.l)(t,(0,h.i)(1)))));const i=v.RR(s.shape,l);return i.length>0&&(n=(0,x.S)(n,i)),(0,b.X)(n,s.shape)},b:()=>{const t=(0,Ue.p)(s,0),n=(0,K.a)(t,(0,xt.c)(s),(0,k.P)(s));let i=(0,o.d)(e,(0,o.d)(r,n));const a=v.RR(u.shape,l);return a.length>0&&(i=(0,x.S)(i,a)),(0,b.X)(i,u.shape)}}}},kt={kernelName:s.o0,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,i]=t,r=(0,Ue.p)(n,0);return{x:()=>(0,K.a)(r,e,(0,o.d)(e,i)),alpha:()=>{let t=(0,K.a)(r,(0,k.P)(e),(0,o.d)(e,n));const s=(0,v.RR)(i.shape,e.shape);return s.length>0&&(t=(0,x.S)(t,s)),(0,b.X)(t,i.shape)}}}},At={kernelName:s.oH,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=v.$N(n.shape,i.shape);return{a:()=>{const t=(0,c.h)(e,(0,a.p)(i,"float32")),s=v.RR(n.shape,r);return s.length>0?(0,b.X)((0,x.S)(t,s),n.shape):t},b:()=>{let t=(0,o.d)(e,(0,a.p)(n,"float32"));const s=v.RR(i.shape,r);s.length>0&&(t=(0,b.X)((0,x.S)(t,s),i.shape));const u=(0,p.h)(i);return(0,d.W)((0,c.h)(t,(0,a.p)(u,"float32")))}}}},_t={kernelName:s.$H,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,c.h)(e,(0,d.W)((0,p.h)(n)))}}},Et={kernelName:s.Sb,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,i=(0,o.d)((0,X.z)(n,6),(0,u.N)(n));return{x:()=>(0,o.d)(e,(0,a.p)(i,"float32"))}}},St={kernelName:s.qk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,o.d)(e,(0,a.p)((0,u.N)(n),"float32"))}}},Ft={kernelName:s.HZ,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,b.X)(e,n.shape)}}},Dt={kernelName:s._Y,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[i]=t,r={dy:e,images:i};return{images:()=>N.BV.runKernel(s.zb,r,n)}}},$t={kernelName:s.dp,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[i]=t,r={dy:e,images:i};return{images:()=>N.BV.runKernel(s.Hm,r,n)}}};var Ot=n(4330);const Nt={kernelName:s.mK,gradFunc:(e,t,n)=>{const{dims:i}=n,r=(0,T.EC)(i,e.shape);return{x:()=>(0,Ot.G)(e,r)}}},It={kernelName:s.e0,gradFunc:e=>({x:()=>(0,k.P)(e)})},Tt={kernelName:s.bV,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,d.W)((0,c.h)(e,(0,o.d)((0,wt.s)(n,1.5),2)))}}};var Rt=n(1917);const Mt={kernelName:s.Ph,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>(0,a.p)((0,k.P)(n),"float32"),t:()=>(0,o.d)(e,(0,a.p)(n,e.dtype)),e:()=>(0,o.d)(e,(0,a.p)((0,Rt.h)(n),e.dtype))}}};var Bt=n(141);const zt={kernelName:s.oF,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=(0,Ue.p)(n,(0,h.i)(0)),i=(0,h.i)(Bt.y),r=(0,h.i)(Bt.$),s=(0,o.d)(e,r),u=(0,o.d)((0,o.d)(e,i),(0,ke.Q)((0,a.p)(n,"float32")));return(0,K.a)(t,s,u)}}}},Lt={kernelName:s.a5,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,o.d)(e,(0,o.d)(n,(0,m.l)((0,h.i)(1),n)))}}},Pt={kernelName:s.i5,gradFunc:e=>({x:()=>(0,k.P)(e)})};var jt=n(7838);const Ut={kernelName:s.RQ,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,o.d)((0,jt.m)((0,a.p)(n,"float32")),e)}}};var Wt=n(3159);const Vt={kernelName:s.w3,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,o.d)((0,Wt.f)((0,a.p)(n,"float32")),e)}}};var qt=n(7039),Gt=n(1269);const Ht={kernelName:s.p2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{begin:r,size:s}=n,a=i.shape,[o,u]=(0,Gt.parseSliceParams)(i,r,s),l=[];for(let t=0;t<e.rank;t++)l.push([o[t],a[t]-o[t]-u[t]]);return{x:()=>(0,qt.v)(e,l)}}},Xt={kernelName:s.Gc,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[i]=t,{dim:r}=n,s=(0,o.d)(e,i);return{logits:()=>(0,m.l)(s,(0,o.d)((0,x.S)(s,[r],!0),i))}}};var Yt=n(5808);const Kt={kernelName:s.MR,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,o.d)(e,(0,Yt.X)(n))}}};var Jt=n(1141);const Zt={kernelName:s.TQ,gradFunc:(e,t,n)=>{const{blockShape:i,paddings:r}=n;return{x:()=>(0,Jt.E)(e,i,r)}}};var Qt=n(9134);const en={kernelName:s.L8,gradFunc:(e,t,n)=>{const{axis:i}=n;return{x:()=>(0,Qt.z)(e,i)}}},tn={kernelName:s.FK,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,c.h)(e,(0,o.d)((0,f._)((0,a.p)(n,"float32")),2))}}},nn={kernelName:s.bK,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,o.d)(e,(0,o.d)((0,a.p)(n,"float32"),2))}}},rn={kernelName:s._t,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=(0,h.i)(2);return{a:()=>(0,o.d)(e,(0,o.d)(r,(0,m.l)(n,i))),b:()=>(0,o.d)(e,(0,o.d)(r,(0,m.l)(i,n)))}}},sn={kernelName:s.h8,gradFunc:e=>({x:()=>(0,k.P)(e)})},an={kernelName:s.Tr,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,i]=t,r=v.$N(n.shape,i.shape);return{a:()=>{let t=e;const i=v.RR(n.shape,r);return i.length>0&&(t=(0,x.S)(t,i)),(0,b.X)(t,n.shape)},b:()=>{let t=e;const n=v.RR(i.shape,r);return n.length>0&&(t=(0,x.S)(t,n)),(0,b.X)((0,d.W)(t),i.shape)}}}},on={kernelName:s.GB,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,r=i.shape.slice(),{axis:s}=n;(0,T.EC)(s,i.shape).forEach((e=>{r[e]=1}));const a=(0,b.X)(e,r),u=(0,o.d)(a,(0,rt.i)(i.shape,"float32"));return{x:()=>u}}},un={kernelName:s.sE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,c.h)(e,(0,p.h)((0,jt.m)(n)))}}},ln={kernelName:s.MI,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,o.d)((0,m.l)((0,h.i)(1),(0,p.h)(n)),e)}}},cn={kernelName:s.n9,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[i]=t,{reps:r}=n;return{x:()=>{let t=(0,k.P)(i);if(1===i.rank)for(let n=0;n<r[0];++n)t=(0,S.I)(t,(0,ut.t)(e,[n*i.shape[0]],[i.shape[0]]));else if(2===i.rank)for(let n=0;n<r[0];++n)for(let s=0;s<r[1];++s)t=(0,S.I)(t,(0,ut.t)(e,[n*i.shape[0],s*i.shape[1]],[i.shape[0],i.shape[1]]));else if(3===i.rank)for(let n=0;n<r[0];++n)for(let s=0;s<r[1];++s)for(let a=0;a<r[2];++a)t=(0,S.I)(t,(0,ut.t)(e,[n*i.shape[0],s*i.shape[1],a*i.shape[2]],[i.shape[0],i.shape[1],i.shape[2]]));else{if(4!==i.rank)throw new Error(`Gradient for tile operation is not implemented for rank-${i.rank} tensors yet.`);for(let n=0;n<r[0];++n)for(let s=0;s<r[1];++s)for(let a=0;a<r[2];++a)for(let o=0;o<r[3];++o)t=(0,S.I)(t,(0,ut.t)(e,[n*i.shape[0],s*i.shape[1],a*i.shape[2],o*i.shape[3]],[i.shape[0],i.shape[1],i.shape[2],i.shape[3]]))}return t}}}},dn={kernelName:s.G3,gradFunc:(e,t,n)=>{const i=n,{perm:r}=i,s=pe.LJ(r);return{x:()=>(0,ge.p)(e,s)}}};var hn=n(2235);const fn={kernelName:s.To,gradFunc:(e,t,n)=>{const i=n,{axis:r}=i;return{value:()=>(0,hn.k)(e,r)}}};var pn=n(1064),mn=n(5262),gn=n(3171);const yn={kernelName:s.Qv,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>function(e,t){const n=(0,gn.g)(t,(0,k.P)(t)),i=(0,mn.I)(e,n);let r=(0,H.b)(t,(0,h.i)(0,"int32"));const s=i.rank-r.rank;for(let e=0;e<s;++e)r=(0,pn.d)(r,e+1);r=(0,Y.H)(r,(0,rt.i)(i.shape,"bool"));const a=(0,k.P)(i);return(0,K.a)(r,i,a)}(e,n)}}},vn={kernelName:s.Ru,gradFunc:e=>({x:()=>(0,k.P)(e)})};var bn=n(8307);const xn=[l,g,y,w,C,A,_,E,F,D,$,O,B,L,j,W,V,q,G,J,Z,ee,ae,re,le,de,fe,ye,xe,we,At,Ce,Ae,_e,Ee,Se,De,Fe,Ne,Te,Be,ze,Le,Pe,je,We,Ve,qe,Ge,Xe,Je,Je,Qe,tt,it,st,at,ot,lt,dt,ht,ft,mt,gt,vt,bt,bt,Ct,kt,_t,Et,St,Ft,Dt,$t,Nt,It,Tt,Mt,zt,Lt,Pt,Ut,Vt,Ht,Xt,Kt,Zt,Zt,en,en,tn,rn,nn,sn,an,on,un,ln,cn,dn,fn,yn,vn];for(const e of xn)(0,bn.Li)(e);let wn;function Cn(){return null==wn&&(wn=(0,r.backend)().epsilon()),wn}n(4815);class kn extends Error{constructor(e){super(e),Object.setPrototypeOf(this,kn.prototype)}}class An extends Error{constructor(e){super(e),Object.setPrototypeOf(this,An.prototype)}}class _n extends Error{constructor(e){super(e),Object.setPrototypeOf(this,_n.prototype)}}class En extends Error{constructor(e){super(e),Object.setPrototypeOf(this,En.prototype)}}class Sn extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Sn.prototype)}}function Fn(e,t){if(Array.isArray(e)){let n=[];for(let i=0;i<t;i++)n=n.concat(e);return n}{const n=new Array(t);return n.fill(e),n}}function Dn(e,t){if(!e)throw new Sn(t)}function $n(e,t){let n=0;for(const i of e)i===t&&n++;return n}function On(e){return 1===e.length?e[0]:e}function Nn(e){return Array.isArray(e)?e:[e]}function In(e){const t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function Tn(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,((e,t)=>t.toUpperCase()))}Error;let Rn={};function Mn(e){if(null==e)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function Bn(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach((e=>Bn(e)));else{const t=Object.keys(e);for(const n of t){const t=e[n];null!=t&&"object"==typeof t&&(Array.isArray(t)||"ndarray"!==t.type||"number"!=typeof t.value?Bn(t):e[n]=t.value)}}}function zn(e,t={},n={},i="object",r=!1){if("string"==typeof e){const r=e;let s;if(r in n)s=n[r];else if(r in Rn)s=Rn[r];else if(s=t[r],null==s)throw new _n(`Unknown ${i}: ${e}. This may be due to one of the following reasons:\n1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}{const s=e;if(null==s.className||null==s.config)throw new _n(`${i}: Improper config format: ${JSON.stringify(s)}.\n'className' and 'config' must set.`);const a=s.className;let o,u;if(a in n?[o,u]=n[a]:a in Rn?[o,u]=Rn.className:a in t&&([o,u]=t[a]),null==o)throw new _n(`Unknown ${i}: ${a}. This may be due to one of the following reasons:\n1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=u){const e={};for(const t of Object.keys(Rn))e[t]=Rn[t];for(const t of Object.keys(n))e[t]=n[t];s.config.customObjects=e;const t=Object.assign({},Rn);for(const e of Object.keys(n))Rn[e]=n[e];Bn(s.config);const i=u(o,s.config,n,r);return Rn=Object.assign({},t),i}{const e=Object.assign({},Rn);for(const e of Object.keys(n))Rn[e]=n[e];const t=new o(s.config);return Rn=Object.assign({},e),t}}}function Ln(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function Pn(e){if(null==e)return e;const t=[];for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function jn(e){if(null==e)throw new _n(`Invalid value in obj: ${JSON.stringify(e)}`);for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function Un(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new _n(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function Wn(e,t,n=0,i=1/0){return Dn(n>=0),Dn(i>=n),Array.isArray(e)&&e.length>=n&&e.length<=i&&e.every((e=>typeof e===t))}function Vn(e,t){Array.isArray(e)?(r.util.assert(e.length>0,(()=>`${t} is unexpectedly an empty array.`)),e.forEach(((e,n)=>Vn(e,`element ${n+1} of ${t}`)))):r.util.assert(Number.isInteger(e)&&e>0,(()=>`Expected ${t} to be a positive integer, but got ${qn(e)}.`))}function qn(e){return null===e?"null":Array.isArray(e)?"["+e.map((e=>qn(e))).join(",")+"]":"string"==typeof e?`"${e}"`:`${e}`}function Gn(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function Hn(e,t){return(0,r.tidy)((()=>r.sqrt(r.sum(r.mul(e,e),t,!0))))}class Xn extends r.serialization.Serializable{getConfig(){return{}}}class Yn extends Xn{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return(0,r.tidy)((()=>{const t=Hn(e,this.axis),n=r.clipByValue(t,0,this.maxValue);return r.mul(e,r.div(n,r.add(Cn(),t)))}))}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Yn.className="MaxNorm",r.serialization.registerClass(Yn);class Kn extends Xn{constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return(0,r.tidy)((()=>r.div(e,r.add(Cn(),Hn(e,this.axis)))))}getConfig(){return{axis:this.axis}}}Kn.className="UnitNorm",r.serialization.registerClass(Kn);class Jn extends Xn{apply(e){return r.relu(e)}}Jn.className="NonNeg",r.serialization.registerClass(Jn);class Zn extends Xn{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return(0,r.tidy)((()=>{const t=Hn(e,this.axis),n=r.add(r.mul(this.rate,r.clipByValue(t,this.minValue,this.maxValue)),r.mul(1-this.rate,t));return r.mul(e,r.div(n,r.add(Cn(),t)))}))}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}Zn.className="MinMaxNorm",r.serialization.registerClass(Zn);const Qn={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function ei(e){return Mn(e)}function ti(e,t={}){return zn(e,r.serialization.SerializationMap.getMap().classNameMap,t,"constraint")}function ni(e){return null==e?null:"string"==typeof e?ti({className:e in Qn?Qn[e]:e,config:{}}):e instanceof Xn?e:ti(e)}const ii=["channelsFirst","channelsLast"],ri=["nearest","bilinear"],si=["valid","same","causal"],ai=["max","avg"],oi=["sum","mul","concat","ave"],ui=new Map;function li(e){Un(ii,"DataFormat",e)}function ci(e){Un(si,"PaddingMode",e)}function di(e){Un(ai,"PoolMode",e)}const hi=[];function fi(e,t){hi.push(e);try{const e=t();return hi.pop(),e}catch(e){throw hi.pop(),e}}function pi(e){if(!yi(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===hi.length?"":hi.join("/")+"/")+e}function mi(e){if(!yi(e))throw new Error("Not a valid tensor name: '"+e+"'");ui.has(e)||ui.set(e,0);const t=ui.get(e);if(ui.set(e,ui.get(e)+1),t>0){const n=`${e}_${t}`;return ui.set(n,1),n}return e}const gi=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function yi(e){return!!e.match(gi)}function vi(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let i=1;for(let r=t;r<n;++r)i*=e[r];return i}function bi(e){if(0===e.length)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const i=e[n];i<t&&(t=i)}return t}function xi(e){if(0===e.length)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const i=e[n];i>t&&(t=i)}return t}function wi(e,t){if(t<e)throw new _n(`end (${t}) < begin (${e}) is forbidden.`);const n=[];for(let i=e;i<t;++i)n.push(i);return n}function Ci(e,t){return r.cast(e,t)}function ki(e,t=-1){const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),r.reshape(e,n)}function Ai(e,t,n){return(0,r.tidy)((()=>{switch(e.rank){case 1:return r.slice1d(e,t,n);case 2:return r.slice2d(e,[t,0],[n,e.shape[1]]);case 3:return r.slice3d(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return r.slice4d(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return r.slice(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return r.slice(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new _n(`sliceAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}))}function _i(e,t,n){return(0,r.tidy)((()=>{switch(e.rank){case 1:return r.slice1d(e,t,n);case 2:return r.slice2d(e,[0,t],[e.shape[0],n]);case 3:return r.slice3d(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return r.slice4d(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new _n(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}}))}function Ei(e,t,n,i){return(0,r.tidy)((()=>{switch(e.rank){case 1:return r.slice1d(e,t,n);case 2:switch(i){case 1:return Ai(e,t,n);case 2:return _i(e,t,n);default:throw new _n(`The axis is not within the rank of the tensor ${i}`)}case 3:switch(i){case 1:return Ai(e,t,n);case 2:return r.slice3d(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return _i(e,t,n);default:throw new _n(`The axis is not within the rank of the tensor ${i}`)}case 4:switch(i){case 1:return Ai(e,t,n);case 2:return r.slice4d(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return r.slice4d(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return _i(e,t,n);default:throw new _n(`The axis is not within the rank of the tensor ${i}`)}default:throw new _n(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}}))}function Si(e,t=-1){let n;return t<0&&(n=e[0].rank,t=0!==n?n:0),t===e[0].rank&&(t=-1),r.concat(e,t)}function Fi(e,t){switch(e.rank){case 1:return r.concat1d([e,t]);case 2:return r.concat2d([e,t],0);case 3:return r.concat3d([e,t],0);case 4:return r.concat4d([e,t],0);default:throw new _n(`concatAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}function Di(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new _n(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return r.tile(e,t)}function $i(e,t=0,n=1,i,s){return r.randomNormal(e,t,n,i,s)}function Oi(e,t,n,i){if(e.rank<2||t.rank<2)throw new En(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new En(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = ${t.shape}`);if(2===e.rank&&2===t.rank){const s=!1,a=!1;return r.fused.matMul({a:e,b:t,transposeA:s,transposeB:a,bias:i?Ti(e.rank,i,"channelsLast"):null,activation:n})}{const s=e.shape.slice(),a=s.pop();e=r.reshape(e,[-1,a]);const o=t.shape.slice(),u=o.pop(),l=o.pop(),c=[...o,u],d=Array.from({length:t.rank},((e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n));t=r.reshape(r.transpose(t,d),[l,-1]);const h=[...s,...c],f=!1,p=!1;return r.reshape(r.fused.matMul({a:e,b:t,transposeA:f,transposeB:p,bias:i?Ti(e.rank,i,"channelsLast"):null,activation:n}),h)}}function Ni(e,t,n){return(0,r.tidy)((()=>(t=Array.isArray(t)?(0,r.tensor1d)(t,"int32"):r.cast(t,"int32"),r.gather(e,t,n))))}function Ii(e){return r.mul(e,e)}function Ti(e,t,n){const i=t.shape;if(1!==t.rank&&t.rank!==e)throw new _n(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${e}`);if(5===e){if("channelsFirst"===n)return 1===i.length?r.reshape(t,[1,i[0],1,1,1]):r.reshape(t,[1,i[3],i[0],i[1],i[2]]);if("channelsLast"===n)return 1===i.length?r.reshape(t,[1,1,1,1,i[0]]):r.reshape(t,[1].concat(i))}else if(4===e){if("channelsFirst"===n)return 1===i.length?r.reshape(t,[1,i[0],1,1]):r.reshape(t,[1,i[2],i[0],i[1]]);if("channelsLast"===n)return 1===i.length?r.reshape(t,[1,1,1,i[0]]):r.reshape(t,[1].concat(i))}else if(3===e){if("channelsFirst"===n)return 1===i.length?r.reshape(t,[1,i[0],1]):r.reshape(t,[1,i[1],i[0]]);if("channelsLast"===n)return 1===i.length?r.reshape(t,[1,1,i[0]]):r.reshape(t,[1].concat(i))}else if(e<3)return t;throw new _n(`Unsupported input rank by biasAdd: ${t.rank}`)}function Ri(e,t,n){return(0,r.tidy)((()=>(null==n&&(n="channelsLast"),li(n),r.add(e,Ti(e.rank,t,n)))))}function Mi(e,t,n,i){return(0,r.tidy)((()=>r.dropout(e,t,n,i)))}function Bi(e,t,n=!1){return n?e():t()}const zi=["fanIn","fanOut","fanAvg"],Li=["normal","uniform","truncatedNormal"];class Pi extends r.serialization.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class ji extends Pi{apply(e,t){return(0,r.zeros)(e,t)}}ji.className="Zeros",r.serialization.registerClass(ji);class Ui extends Pi{apply(e,t){return(0,r.ones)(e,t)}}Ui.className="Ones",r.serialization.registerClass(Ui);class Wi extends Pi{constructor(e){if(super(),"object"!=typeof e)throw new _n(`Expected argument of type ConstantConfig but got ${e}`);if(void 0===e.value)throw new _n(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return(0,r.tidy)((()=>(0,r.mul)((0,r.scalar)(this.value),(0,r.ones)(e,t))))}getConfig(){return{value:this.value}}}Wi.className="Constant",r.serialization.registerClass(Wi);class Vi extends Pi{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return(0,r.randomUniform)(e,this.minval,this.maxval,t)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}Vi.className="RandomUniform",r.serialization.registerClass(Vi);class qi extends Pi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new En(`randomNormal does not support dType ${t}.`);return $i(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}qi.className="RandomNormal",r.serialization.registerClass(qi);class Gi extends Pi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new En(`truncatedNormal does not support dType ${t}.`);return(0,r.truncatedNormal)(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Gi.className="TruncatedNormal",r.serialization.registerClass(Gi);class Hi extends Pi{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return(0,r.tidy)((()=>{if(2!==e.length||e[0]!==e[1])throw new _n("Identity matrix initializer can only be used for 2D square matrices.");return(0,r.mul)(this.gain,(0,r.eye)(e[0]))}))}getConfig(){return{gain:this.gain}}}Hi.className="Identity",r.serialization.registerClass(Hi);class Xi extends Pi{constructor(e){if(super(),e.scale<0)throw new _n(`scale must be a positive float. Got: ${e.scale}`);var t;this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,t=this.mode,Un(zi,"FanMode",t),this.distribution=null==e.distribution?"normal":e.distribution,function(e){Un(Li,"Distribution",e)}(this.distribution),this.seed=e.seed}apply(e,t){const n=function(e,t="channelsLast"){let n,i;if(li(t),2===e.length)n=e[0],i=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===t){const t=vi(e,2);n=e[1]*t,i=e[0]*t}else if("channelsLast"===t){const t=vi(e,0,e.length-2);n=e[e.length-2]*t,i=e[e.length-1]*t}}else{const t=vi(e);n=Math.sqrt(t),i=Math.sqrt(t)}return[n,i]}(e),i=n[0],s=n[1];let a=this.scale;if("fanIn"===this.mode?a/=Math.max(1,i):"fanOut"===this.mode?a/=Math.max(1,s):a/=Math.max(1,(i+s)/2),"normal"===this.distribution){const n=Math.sqrt(a);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new En(`${this.getClassName()} does not support dType ${t}.`);return(0,r.truncatedNormal)(e,0,n,t,this.seed)}{const n=Math.sqrt(3*a);return(0,r.randomUniform)(e,-n,n,t)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Xi.className="VarianceScaling",r.serialization.registerClass(Xi);class Yi extends Xi{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return Xi.className}}Yi.className="GlorotUniform",r.serialization.registerClass(Yi);class Ki extends Xi{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return Xi.className}}Ki.className="GlorotNormal",r.serialization.registerClass(Ki);class Ji extends Xi{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return Xi.className}}Ji.className="HeNormal",r.serialization.registerClass(Ji);class Zi extends Xi{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return Xi.className}}Zi.className="HeUniform",r.serialization.registerClass(Zi);class Qi extends Xi{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return Xi.className}}Qi.className="LeCunNormal",r.serialization.registerClass(Qi);class er extends Xi{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return Xi.className}}er.className="LeCunNormal",r.serialization.registerClass(er);class tr extends Pi{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,null!=this.seed)throw new En("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,t){return(0,r.tidy)((()=>{if(e.length<2)throw new En("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);const t=$i(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32");let n=r.linalg.gramSchmidt(t);return e[0]>e[1]&&(n=(0,r.transpose)(n)),(0,r.mul)(this.gain,n)}))}getConfig(){return{gain:this.gain,seed:this.seed}}}tr.className="Orthogonal",r.serialization.registerClass(tr);const nr={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function ir(e,t={}){return zn(e,r.serialization.SerializationMap.getMap().classNameMap,t,"initializer")}function rr(e){return Mn(e)}function sr(e){if("string"==typeof e){const t=e in nr?nr[e]:e;if("GlorotNormal"===t)return new Ki;if("GlorotUniform"===t)return new Yi;if("HeNormal"===t)return new Ji;if("HeUniform"===t)return new Zi;if("LeCunNormal"===t)return new Qi;if("LeCunUniform"===t)return new er;{const e={};return e.className=t,e.config={},ir(e)}}return e instanceof Pi?e:ir(e)}let ar=0;function or(){return ar++}const ur={};function lr(e=""){return e in ur||(ur[e]=0),ur[e]+=1,e+ur[e].toString()}function cr(e){return Array.isArray(e)&&Array.isArray(e[0])}function dr(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function hr(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new _n(`Expected Tensor length to be 1; got ${e.length}`);t=e[0]}else t=e;return t}function fr(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new _n(`Expected exactly 1 Shape; got ${e.length}`)}return e}function pr(e){let t=0;for(const n of e)0===n.shape.length?t+=1:t+=n.shape.reduce(((e,t)=>e*t));return t}class mr{constructor(e,t="float32",n="Variable",i=!0,s=null){this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=or(),n=null==n?"Variable":n,this.originalName=pi(n),this.name=mi(this.originalName),this.trainable_=i,this.constraint=s,this.val=r.variable(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function gr(e){return e.map((e=>e.read()))}function yr(e){e.forEach((e=>{e[0].write(e[1])}))}class vr{constructor(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class br{constructor(e,t,n,i,r,s,a){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=i,this.callArgs=r,this.outputTensorIndex=a,this.id=or(),null!=s&&(this.originalName=pi(s),this.name=mi(this.originalName)),this.rank=t.length}}let xr=0;class wr{constructor(e,t){this.callArgs=t,this.id=xr++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const t of e.inboundLayers)null!=t&&t.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)null!=t?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let Cr=0;class kr extends r.serialization.Serializable{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Cr++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const e=this.getClassName();t=In(e)+"_"+lr(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}null!=e.weights?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new An(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new _n(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return On(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return On(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new kn(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(0===this.inboundNodes.length)throw new kn(`Layer ${this.name} is not connected, no input to return.`);return On(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new kn(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new kn(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return On(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map((e=>e()))}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach((t=>t.trainable=e)),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter((e=>e.trainable)):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter((e=>!e.trainable)).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){if(e=Nn(e),null==this.inputSpec||0===this.inputSpec.length)return;const t=Nn(this.inputSpec);if(e.length!==t.length)throw new _n(`Layer ${this.name} expects ${t.length} inputs, but it received ${e.length} input tensors. Input received: ${e}`);for(let n=0;n<e.length;n++){const i=e[n],r=t[n];if(null==r)continue;const s=i.rank;if(null!=r.ndim&&s!==r.ndim)throw new _n(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${r.ndim}, found ndim=${s}`);if(null!=r.maxNDim&&s>r.maxNDim)throw new _n(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${r.maxNDim}, found ndim=${s}`);if(null!=r.minNDim&&s<r.minNDim)throw new _n(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${r.minNDim}, found ndim=${s}.`);if(null!=r.dtype&&i.dtype!==r.dtype)throw new _n(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${r.dtype}, found dtype=${i.dtype}.`);if(r.axes){const e=i.shape;for(const t in r.axes){const i=Number(t),s=r.axes[t],a=i>=0?e[i]:e[e.length+i];if(null!=s&&-1===[s,null].indexOf(a))throw new _n(`Input ${n} is incompatible with layer ${this.name}: expected axis ${i} of input shape to have value ${s} but got shape ${e}.`)}}if(null!=r.shape)for(let e=0;e<r.shape.length;++e){const t=r.shape[e],s=i.shape[e];if(null!=t&&null!=s&&t!==s)throw new _n(`Input ${n} is incompatible with layer ${this.name}: expected shape=${r.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const n=Nn(e);let i=!0;for(const e of n)if(!(e instanceof br)){i=!1;break}let r=!0;for(const e of n)if(e instanceof br){r=!1;break}if(i===r)throw new _n("Arguments to apply() must be all SymbolicTensors or all Tensors");return fi(this.name,(()=>{if(!this.built){this.assertInputCompatibility(e);const t=[];for(const n of Nn(e))t.push(n.shape);this.build(On(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&r&&(this._refCount=1)}if(this.assertInputCompatibility(e),r){let i=this.call(e,t);const r=Nn(i),s=[];for(let e of r)-1!==n.indexOf(e)&&(e=e.clone()),s.push(e);if(i=On(s),null!=this.activityRegularizer)throw new En("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}{const n=function(e){e=Nn(e);const t=[];for(const n of e)t.push(n.shape);return On(t)}(e),i=this.computeOutputShape(n);let r;const s="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(e)?n[0]:n),r=null!=i&&i.length>0&&Array.isArray(i[0])?i.map(((n,i)=>new br(s,n,this,Nn(e),t,this.name,i))):new br(s,i,this,Nn(e),t,this.name),this.addInboundNode(e,r,null,null,n,i,t),this._refCount++,null!=this.activityRegularizer)throw new En("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}}))}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach(((n,i)=>{null!=n&&null!=e[i]&&e[i]!==n&&(t=!0)})),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new kn(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new kn(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new An(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return pr(this.weights)}build(e){this.built=!0}getWeights(e=!1){return gr(e?this.trainableWeights:this.weights)}setWeights(e){(0,r.tidy)((()=>{const t=this.weights;if(t.length!==e.length)throw new _n(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(0===t.length)return;const n=[],i=gr(t);for(let s=0;s<i.length;++s){const a=i[s],o=t[s],u=e[s];if(!r.util.arraysEqual(a.shape,u.shape))throw new _n(`Layer weight shape ${a.shape} not compatible with provided weight shape ${u.shape}`);n.push([o,u])}yr(n)}))}addWeight(e,t,n,i,r,s,a,o){if(-1!==this._addedWeightNames.indexOf(e))throw new _n(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(i=null!=o?o():sr("zeros"));const u=i.apply(t,n),l=new mr(u,n,e,s,a);return u.dispose(),null!=r&&this.addLoss((()=>r.apply(l.read()))),null==s&&(s=!0),s?this._trainableWeights.push(l):this._nonTrainableWeights.push(l),l}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=Nn(e),void 0!==this._losses&&null!==this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);t.forEach((e=>{if(null!=e)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)}))}return null}return t}addInboundNode(e,t,n,i,r,s,a=null){const o=Nn(e);t=Nn(t),n=Nn(n),i=Nn(i),r=dr(r),s=dr(s);const u=[],l=[],c=[];for(const e of o)u.push(e.sourceLayer),l.push(e.nodeIndex),c.push(e.tensorIndex);new wr({outboundLayer:this,inboundLayers:u,nodeIndices:l,tensorIndices:c,inputTensors:o,outputTensors:t,inputMasks:n,outputMasks:i,inputShapes:r,outputShapes:s},a);for(let e=0;e<t.length;e++)t[e].sourceLayer=this,t[e].nodeIndex=this.inboundNodes.length-1,t[e].tensorIndex=e}getConfig(){const e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach((e=>e.dispose())),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function Ar(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];{const e=t.inboundNodes[n];if(0===e.inboundLayers.length)return e.inputTensors;{const t=[];for(let n=0;n<e.inboundLayers.length;n++){const i=Ar(e.inputTensors[n],e.inboundLayers[n],e.nodeIndices[n]);for(const e of i)-1===t.indexOf(e)&&t.push(e)}return t}}}class _r extends kr{constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:lr("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new _n("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new _n("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new _n("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];const i=new br(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new wr({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new _n(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}async function Er(e){if(null==e)return;const t=[],n=[],i=[];for(const r in e){const s=e[r];if("number"!=typeof s){const e=s;t.push(e.data()),n.push(r),i.push(e)}}if(t.length>0){const s=await Promise.all(t);for(let t=0;t<s.length;++t)e[n[t]]=s[t][0];(0,r.dispose)(i)}}function Sr(e){if(null!=e)for(const t in e){const n=e[t];"number"!=typeof n&&n.dispose()}}var Fr;_r.className="InputLayer",r.serialization.registerClass(_r),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(Fr||(Fr={}));class Dr{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class $r{constructor(e,t=10){null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class Or extends Dr{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});const n=null==t.size?0:t.size;this.seen+=n;for(const e in t){const i=t[e];if("number"==typeof i)this.totals.hasOwnProperty(e)||(this.totals[e]=0),this.totals[e]=this.totals[e]+i*n;else{let t;e in this.totals?t=this.totals[e]:this.totals[e]=0;const s=(0,r.tidy)((()=>(0,r.add)(this.totals[e],(0,r.mul)(i,n))));this.totals[e]=s,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(const e of this.params.metrics)null!=this.totals[e]&&("number"==typeof this.totals[e]?t[e]=this.totals[e]/this.seen:(0,r.tidy)((()=>{const n=(0,r.mul)((0,r.div)(1,this.seen),this.totals[e]);t[e]=n,this.totals[e].dispose(),(0,r.keep)(t[e])})))}}class Nr extends Dr{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){null==t&&(t={}),this.epoch.push(e);for(const e in t)null==this.history[e]&&(this.history[e]=[]),this.history[e].push(t[e])}async syncData(){const e=[],t=[],n=[];for(const i in this.history){const r=this.history[i];for(let s=0;s<r.length;++s)if("number"!=typeof r[s]){const a=r[s];e.push(a.data()),t.push(i),n.push(s)}}const i=await Promise.all(e);for(let e=0;e<i.length;++e)this.history[t[e]][n[e]].dispose(),this.history[t[e]][n[e]]=i[e][0]}}class Ir extends Dr{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||r.nextFrame,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");r.util.isNumber(this.yieldEvery)&&(this.maybeWait=function(e,t,n){let i,s=null!=n?n():r.util.now();return(...a)=>{const o=null!=n?n():r.util.now();return o-s<t||(s=o,i=e(...a)),i}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){const i=[];null!=this.yield&&(await Er(n),i.push(this.yield(e,t,n))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await Er(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const n=[];null!=this.epochEnd&&(await Er(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await Er(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const n=[];null!=this.batchEnd&&(await Er(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):r.util.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await Er(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await Er(e),await this.trainEnd(e))}}function Tr(e,t){return null==e&&(e={}),e instanceof Dr?[e]:Array.isArray(e)&&e[0]instanceof Dr?e:Nn(e).map((e=>new Ir(e,t)))}class Rr{constructor(){}static registerCallbackConstructor(e,t){r.util.assert(e>=0&&Number.isInteger(e),(()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`)),Rr.checkForDuplicate(t),null==Rr.constructors[e]&&(Rr.constructors[e]=[]),Rr.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Rr.constructors)Rr.constructors[+t].forEach((t=>{if(t===e)throw new _n("Duplicate callback constructor.")}))}static clear(){Rr.constructors={}}static createCallbacks(e){const t=[];for(const n in Rr.constructors){const i=+n;e>=i&&t.push(...Rr.constructors[i])}return t.map((e=>new e))}}function Mr(e,t,n,i,r,s,a,o,u){const l=new Nr,c=[new Or,...Rr.createCallbacks(t)];null!=e&&c.push(...e),c.push(l);const d=new $r(c);return d.setParams({epochs:n,initialEpoch:i,samples:r,steps:s,batchSize:a,verbose:t,doValidation:o,metrics:u}),{callbackList:d,history:l}}function Br(e,t={},n=!1){return zn(e,r.serialization.SerializationMap.getMap().classNameMap,t,"layer",n)}function zr(e,t){return(0,r.tidy)((()=>{"float32"!==e.dtype&&(e=r.cast(e,"float32"));const n=r.sum(Ii(e),t,!0),i=r.fill(n.shape,Cn()),s=r.sqrt(r.maximum(n,i));return r.div(e,s)}))}function Lr(e,t){return(0,r.tidy)((()=>r.mean(Ii(r.sub(t,e)),-1)))}function Pr(e,t){return(0,r.tidy)((()=>r.mean(r.abs(r.sub(t,e)),-1)))}function jr(e,t){return(0,r.tidy)((()=>{const n=r.sub(e,t),i=r.clipByValue(r.abs(e),Cn(),Number.MAX_VALUE),s=r.abs(r.div(n,i));return r.mul(100,r.mean(s,-1))}))}function Ur(e,t,n=!1){return(0,r.tidy)((()=>{if(n)t=r.softmax(t);else{const e=r.sum(t,t.shape.length-1,!0);t=r.div(t,e)}return t=r.clipByValue(t,Cn(),1-Cn()),r.neg(r.sum(r.mul(r.cast(e,"float32"),r.log(t)),t.shape.length-1))}))}function Wr(e,t,n=!1){return(0,r.tidy)((()=>{const i=r.cast(r.floor(function(e){const t=[vi(e.shape)];return r.reshape(e,t)}(e)),"int32"),s=(t=r.clipByValue(t,Cn(),1-Cn())).shape;return Ur(r.reshape(r.oneHot(i,s[s.length-1]),s),t,n)}))}function Vr(e,t){return(0,r.tidy)((()=>{let n;return n=r.clipByValue(t,Cn(),1-Cn()),n=r.log(r.div(n,r.sub(1,n))),r.mean(function(e,t){if(!r.util.arraysEqual(e.shape,t.shape))throw new _n(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return(0,r.tidy)((()=>{const n=r.relu(t),i=r.neg(r.abs(t));return r.add(r.sub(n,r.mul(t,e)),r.log1p(r.exp(i)))}))}(e,n),-1)}))}function qr(e,t){return(0,r.tidy)((()=>{const n=zr(e,-1),i=zr(t,-1),s=r.mul(n,i);return r.neg(r.sum(s,-1))}))}Rr.constructors={};const Gr={meanSquaredError:Lr,meanAbsoluteError:Pr,meanAbsolutePercentageError:jr,meanSquaredLogarithmicError:function(e,t){return(0,r.tidy)((()=>{const n=r.clipByValue(t,Cn(),Number.MAX_VALUE),i=r.log(r.add(1,n)),s=r.clipByValue(e,Cn(),Number.MAX_VALUE),a=r.log(r.add(1,s));return r.mean(Ii(r.sub(i,a)),-1)}))},squaredHinge:function(e,t){return(0,r.tidy)((()=>{const n=r.maximum(0,r.sub(1,r.mul(e,t)));return r.mean(Ii(n),-1)}))},hinge:function(e,t){return(0,r.tidy)((()=>{const n=r.maximum(0,r.sub(1,r.mul(e,t)));return r.mean(n,-1)}))},categoricalHinge:function(e,t){return(0,r.tidy)((()=>{const n=r.sum(r.mul(e,t),-1),i=r.max(r.mul(r.sub(1,e),t),-1);return r.maximum(0,r.add(1,r.sub(i,n)))}))},logcosh:function(e,t){return(0,r.tidy)((()=>{const n=Math.log(2),i=r.sub(t,e),s=r.sub(r.add(i,r.softplus(r.mul(-2,i))),n);return r.mean(s,-1)}))},categoricalCrossentropy:Ur,sparseCategoricalCrossentropy:Wr,binaryCrossentropy:Vr,kullbackLeiblerDivergence:function(e,t){return(0,r.tidy)((()=>{const n=r.clipByValue(e,Cn(),1),i=r.clipByValue(t,Cn(),1);return r.sum(r.mul(e,r.log(r.div(n,i))),-1)}))},poisson:function(e,t){return(0,r.tidy)((()=>{const n=r.log(r.add(Cn(),t));return r.mean(r.sub(t,r.mul(e,n)),-1)}))},cosineProximity:qr};function Hr(e){if("string"==typeof e){if(e in Gr)return Gr[e];let t=`Unknown loss ${e}`;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new _n(t)}return e}function Xr(e,t){return(0,r.tidy)((()=>{const n=r.mul(.5,r.onesLike(t)),i=Ci(r.greater(t,n),e.dtype);return r.mean(r.equal(e,i),-1)}))}function Yr(e,t){return(0,r.tidy)((()=>Ci(r.equal(r.argMax(e,-1),r.argMax(t,-1)),"float32")))}function Kr(e,t){return Vr(e,t)}function Jr(e,t){return e.rank===t.rank&&(e=r.squeeze(e,[e.rank-1])),(t=r.argMax(t,-1)).dtype!==e.dtype&&(t=r.cast(t,e.dtype)),r.cast(r.equal(e,t),"float32")}const Zr=Ur,Qr=Wr,es={binaryAccuracy:Xr,categoricalAccuracy:Yr,precision:function(e,t){return(0,r.tidy)((()=>{const n=function(e,t){return(0,r.tidy)((()=>r.cast(r.sum(r.logicalAnd(r.equal(e,1),r.equal(t,1))),"float32")))}(e,t),i=function(e,t){return(0,r.tidy)((()=>r.cast(r.sum(r.logicalAnd(r.equal(e,0),r.equal(t,1))),"float32")))}(e,t),s=r.add(n,i);return r.cast(r.where(r.greater(s,0),r.div(n,s),0),"float32")}))},categoricalCrossentropy:Zr,sparseCategoricalCrossentropy:Qr,mse:Lr,MSE:Lr,mae:Pr,MAE:Pr,mape:jr,MAPE:jr,cosine:qr};function ts(e){if("string"==typeof e&&e in es)return es[e];if("string"!=typeof e&&null!=e)return e;throw new _n(`Unknown metric ${e}`)}function ns(e){if(Dn(null!==e,`Unknown LossOrMetricFn ${e}`),"string"==typeof e)return e;{let t;for(const n of Object.keys(Gr))if(Gr[n]===e){t=n;break}if(void 0!==t)return t;for(const n of Object.keys(es))if(es[n]===e){t=n;break}return void 0!==t?t:e.name}}function is(e,t,n=!1){if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!rs(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(e);n.length>1048576&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function rs(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t){if("string"!=typeof n)return!1;if(!rs(e[n]))return!1}return!0}if(Array.isArray(e)){for(const t of e)if(!rs(t))return!1;return!0}return!1}{const t=typeof e;return"string"===t||"number"===t||"boolean"===t}}function ss(e,t,n=console.log){let i="";for(let n=0;n<e.length;++n)n>0&&(i=i.slice(0,i.length-1)+" "),i+=e[n],i=i.slice(0,t[n]),i+=" ".repeat(t[n]-i.length);n(i)}function as(e,t,n){let i;try{i=JSON.stringify(e.outputShape)}catch(e){i="multiple"}ss([`${e.name} (${e.getClassName()})`,i,e.countParams().toString()],t,n)}function os(e,t,n,i){let r;try{r=JSON.stringify(e.outputShape)}catch(e){r="multiple"}const s=[];for(const t of e.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(t)))for(let e=0;e<t.inboundLayers.length;++e){const n=t.inboundLayers[e].name,i=t.nodeIndices[e],r=t.tensorIndices[e];s.push(`${n}[${i}][${r}]`)}const a=e.name,o=e.getClassName(),u=0===s.length?"":s[0];ss([`${a} (${o})`,r,e.countParams().toString(),u],t,i);for(let e=1;e<s.length;++e)ss(["","","",s[e]],t,i)}function us(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function ls(e,t){if(null===e)return null;if("string"==typeof e)return Tn(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){const n=[],i=e.length;for(let r=0;r<i;++r){const i=e[r];us(t,r,i)?n.push(i):n.push(ls(i,t))}return n}{const t={};for(const n of Object.keys(e)){const i=e[n];if("name"===n&&"string"==typeof i)t[n]=i;else{const e=Tn(n);t[e]=ls(i,e)}}return t}}function cs(e,t){if(null==e)return null;if("string"==typeof e)return In(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){const n=[],i=e.length;for(let r=0;r<i;++r){const i=e[r];us(t,r,i)?n.push(i):n.push(cs(i,t))}return n}{const t={};for(const n of Object.keys(e)){const i=e[n];t[In(n)]="name"!==n&&"className"!==n||"string"!=typeof i?cs(i,n):i}return t}}class ds{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof ds)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,n){if(null!=this.id2Value[e.id])throw new _n(`Duplicate key: name=${e.name}, id=${e.id}`);return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return(0,r.cast)(t,e.dtype)}catch(n){throw new _n(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof br){if(null==this.id2Value[e.id])throw new _n(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}{const t=this.name2Id[e];if(null==t)throw new _n(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof br){if(null==this.id2Value[e.id])throw new _n(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}{const t=this.name2Id[e];if(null==t)throw new _n(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&(0,r.dispose)(this.id2Mask)}}const hs={},fs={};function ps(e,t,n,i){const s=null!=n&&n.training,a=Array.isArray(e),o=a?e:[e],u=o.map((e=>e.name)),l=[],c=t.names();for(const e of u)-1!==c.indexOf(e)?l.push(t.getValue(e)):l.push(null);null!=i&&(i.maxNumTensors=-1/0,i.minNumTensors=1/0);const d=u.join(",")+"|"+t.names().join(",");let h,f;if(null==hs[d]){const e=function(e,t){r.util.assert(null!=e&&e.length>0,(()=>"Expected at least one fetch, got none"));let n=[],i={};if(1===e.length){const r=gs(e[0],t);n=r.sorted,i=r.recipientMap}else{const r=new Set;for(const s of e){const{sorted:e,recipientMap:a}=gs(s,t);for(const t of e)r.has(t.name)||(n.push(t),r.add(t.name));for(const e in a)null==i[e]&&(i[e]=new Set),a[e].forEach((t=>i[e].add(t)))}}return{sorted:n,recipientCounts:ms(i)}}(o,t);h=e.sorted,f=e.recipientCounts,hs[d]=h,fs[d]=f}h=hs[d],f={},s||Object.assign(f,fs[d]);const p=new ds(t);for(let e=0;e<h.length;++e){if(null!=i){const e=(0,r.memory)().numTensors;e>i.maxNumTensors&&(i.maxNumTensors=e),e<i.minNumTensors&&(i.minNumTensors=e)}const a=h[e],o=a.sourceLayer;if(o instanceof _r)continue;const c=[],d=[],m=[];let g=!1;for(const e of a.inputs){const n=p.getValue(e),i=p.getMask(e);c.push(n),d.push(i),null!=i&&(g=!0),s||(f[e.name]--,0!==f[e.name]||t.hasKey(e)||-1!==u.indexOf(e.name)||n.isDisposed||!0===e.sourceLayer.stateful||m.push(n))}g&&((n=n||{}).mask=d[0]);const y=Nn(o.apply(c,n));let v=null;o.supportsMasking&&(v=o.computeMask(c,d));const b=ys(a),x=Array.isArray(b)?b:[b];for(let e=0;e<x.length;++e){p.hasKey(x[e])||p.add(x[e],y[e],Array.isArray(v)?v[0]:v);const t=u.indexOf(x[e].name);-1!==t&&(l[t]=y[e])}s||(0,r.dispose)(m)}return p.disposeMasks(),a?l:l[0]}function ms(e){const t={};for(const n in e)t[n]=e[n].size;return t}function gs(e,t){const n=new Set,i=[],r={};for(const e of t.names())n.add(e);const s=[],a=[];for(s.push(e);s.length>0;){const e=s[s.length-1];if(n.has(e.name)){s.pop();continue}const t=a[a.length-1]===s.length-1;if(0===e.inputs.length||t)s.pop(),i.push(e),n.add(e.name),t&&a.pop();else{a.push(s.length-1);for(const t of e.inputs)null==r[t.name]&&(r[t.name]=new Set),r[t.name].add(e.name),n.has(t.name)||s.push(t)}}return{sorted:i,recipientMap:r}}function ys(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(const i of e.sourceLayer.inboundNodes[t].outputTensors)if(i.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}class vs extends kr{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){const e=this.getClassName().toLowerCase();this.name=lr(e)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Pn(this.inputs).length!==this.inputs.length)throw new _n(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map((e=>e.name))}`);Pn(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map((e=>e.name))}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const e of this.outputs){const t=e.sourceLayer,n=e.nodeIndex,i=e.tensorIndex;this.outputLayers.push(t),this.outputLayersNodeIndices.push(n),this.outputLayersTensorIndices.push(i)}for(const e of this.inputs){const t=e.sourceLayer,n=e.nodeIndex,i=e.tensorIndex;Dn(0===n,"input layer has >1 nodes"),Dn(0===i,"input layer has >1 tensors"),this.inputLayers.push(t),this.inputLayersNodeIndices.push(n),this.inputLayersTensorIndices.push(i)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let t=0;t<this.inputLayers.length;t++){const n=this.inputLayers[t];if(!(n instanceof _r))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${t} (0-based) originates from layer type ${n.getClassName()}.`);this.inputNames.push(n.name),this.feedInputShapes.push(n.batchInputShape),this.feedInputNames.push(n.name)}for(const e of this.outputLayers)this.outputNames.push(e.name);this.internalInputShapes=this.inputs.map((e=>e.shape)),this.internalOutputShapes=this.outputs.map((e=>e.shape));const t={},n={},i={},r={},s={},a=[],o=(e,t,n,i,r,u)=>{null!=i&&null!=r&&null!=u||(i=e.sourceLayer,r=e.nodeIndex,u=e.tensorIndex);const l=i.inboundNodes[r];if(-1!==n.indexOf(l))throw new An(`The tensor ${e.name} at layer "${i.name}" is part of a cycle.`);if(-1!==t.indexOf(l))return;this.containerNodes.add(vs.nodeKey(i,r)),i.id in s||(s[i.id]=Object.keys(s).length),-1===n.indexOf(l)&&n.push(l);const c=l.inboundLayers.length;for(let e=0;e<c;e++){const i=l.inputTensors[e],r=l.inboundLayers[e],s=l.nodeIndices[e],a=l.tensorIndices[e];o(i,t,n,r,s,a)}for(t.push(l);n.indexOf(l)>=0;)n.splice(n.indexOf(l),1);a.push(l)},u=[],l=[];for(const e of this.outputs)o(e,u,l);const c=a.slice().reverse();for(const e of c){n[e.id]=e,e.id in t||(t[e.id]=0);let s=t[e.id];const a=null==i[e.outboundLayer.id]?0:i[e.outboundLayer.id];s=Math.max(s,a),i[e.outboundLayer.id]=s,r[e.outboundLayer.id]=e.outboundLayer,t[e.id]=s;for(let i=0;i<e.inboundLayers.length;i++){const r=e.inboundLayers[i],a=e.nodeIndices[i],o=r.inboundNodes[a],u=null==t[o.id]?0:t[o.id];t[o.id]=Math.max(s+1,u),n[o.id]=o}}const d={};for(const e in t){const i=t[e];i in d||(d[i]=[]),d[i].push(n[e])}const h={};for(const e in i){const t=i[e];t in h||(h[t]=[]),h[t].push(r[e])}let f=Object.keys(h).map((e=>parseInt(e,10))).sort(Ln);this.layers=[];for(const e of f){const t=h[e];t.sort(((e,t)=>{const n=s[e.id],i=s[t.id];return n<i?-1:n>i?1:0}));for(const e of t)e instanceof vs&&this.internalContainerRefs.push(e),this.layers.push(e)}this.layersByDepth=h,f=Object.keys(d).map((e=>parseInt(e,10))).sort(Ln);const p=this.inputs.slice(),m=[];for(const e of f)for(const t of d[e]){const e=t.outboundLayer;if(null!=e){for(const n of t.inputTensors)if(-1===p.indexOf(n))throw new An(`Graph disconnected: cannot obtain value for tensor ${n} at layer "${e.name}". The following previous layers were accessed without issue: ${m}`);for(const e of t.outputTensors)p.push(e);m.push(e.name)}}this.nodesByDepth=d;const g=this.layers.map((e=>e.name));for(const e of g){const t=g.filter((t=>t===e)).length;if(1!==t)throw new An(`The name "${e}" is used ${t} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new wr({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map((e=>null)),outputMasks:this.outputs.map((e=>null)),inputShapes:this.inputs.map((e=>e.shape)),outputShapes:this.outputs.map((e=>e.shape))}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach((t=>{t._trainableWeights.forEach((t=>t.trainable=e))})),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new _n("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const n={};let i=0;for(const e of this.layers)for(const t of e.weights){if(null!=n[t.originalName])throw new _n(`Duplicate weight name: ${t.originalName}`);n[t.originalName]=t,i++}const r=[];for(const i in e){let s=i;if(null==n[i]){const e=i.split("/");s=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[s])r.push([n[s],e[i]]);else if(t)throw new _n(`Provided weight data has no target variable: ${i}`);delete n[s]}if(t){const e=[];for(const t in n)e.push(t);if(e.length>0)throw new _n(`${e.length} of ${i} weights are not set: ${e}`)}yr(r)}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers 3.11.0",t.backend="TensorFlow.js",t}toJSON(e,t=!0){const n=cs(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return(0,r.tidy)((()=>{e=Nn(e);const n=new ds;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return ps(this.outputs,n,t)}))}computeMask(e,t){return(0,r.tidy)((()=>{let n;return e=Nn(e),n=null==t?Fn(null,e.length):Nn(t),this.runInternalGraph(e,n)[1]}))}computeOutputShape(e){const t=dr(e);if(t.length!==this.inputLayers.length)throw new _n(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let e=0;e<t.length;e++){const i=this.inputLayers[e],r=t[e];n[i.name+"_0_0"]=r}const i=Object.keys(this.nodesByDepth).map((e=>parseInt(e,10))).sort(Ln);if(i.length>1)for(const e of i){const t=this.nodesByDepth[e];for(const e of t){const t=e.outboundLayer;if(-1!==this.inputLayers.map((e=>e.id)).indexOf(t.id))continue;const i=[];for(let t=0;t<e.inboundLayers.length;t++){const r=e.inboundLayers[t],s=e.nodeIndices[t],a=e.tensorIndices[t],o=n[`${r.name}_${s}_${a}`];i.push(o)}const r=dr(t.computeOutputShape(On(i))),s=t.inboundNodes.indexOf(e);for(let e=0;e<r.length;e++)n[`${t.name}_${s}_${e}`]=r[e]}}const r=[],s=[];for(let e=0;e<this.outputLayers.length;e++){const t=this.outputLayers[e],n=this.outputLayersNodeIndices[e],i=this.outputLayersTensorIndices[e],r=`${t.name}_${n}_${i}`;s.push(r)}for(let e=0;e<s.length;e++){const t=s[e];Dn(t in n),r.push(n[t])}return On(r)}runInternalGraph(e,t){null==t&&(t=Fn(null,e.length));const n={};for(let i=0;i<this.inputs.length;++i){const r=this.inputs[i],s=e[i],a=t[i];n[r.id]=[s,a]}const i=Object.keys(this.nodesByDepth).map((e=>parseInt(e,10))).sort(Ln);for(const e of i){const t=this.nodesByDepth[e];for(const e of t){const t=e.outboundLayer,i=e.inputTensors,r=e.outputTensors,s=new Array;for(const e of i)e.id in n&&s.push(n[e.id]);if(s.length===i.length){let i,a,o,u,l={};if(null!=e.callArgs&&(l=e.callArgs),1===s.length){const[e,n]=s[0];null==l.mask&&(l.mask=n),o=Nn(t.call(e,l)),u=Nn(t.computeMask(e,n)),i=[e],a=[n]}else i=s.map((e=>e[0])),a=s.map((e=>e[1])),null==l.mask&&(l.mask=a),o=Nn(t.call(i,l)),u=Nn(t.computeMask(i,a));if(t.activityRegularizer)throw new En("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<r.length;++e){const t=r[e],i=o[e],s=u[e];n[t.id]=[i,s]}}}}const r=[],s=[],a=[];for(const e of this.outputs){Dn(e.id in n,`Could not compute output ${e.name} : ${e.id}`);const[t,i]=n[e.id];a.push(t.shape),r.push(t),s.push(i)}return[r,s,a]}buildNodeConversionMap(e){const t={};let n;for(const e of this.layers){n=e instanceof vs?1:0;for(let i=0;i<e.inboundNodes.length;i++){const r=vs.nodeKey(e,i);this.containerNodes.has(r)&&(t[r]=n,n+=1)}}return t}getLayer(e,t){if(null!=t){if(this.layers.length<=t)throw new _n(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}if(null==e)throw new _n("Provide either a layer name or layer index");for(const t of this.layers)if(t.name===e)return t;throw new _n(`No such layer: ${e}`)}calculateLosses(){return(0,r.tidy)((()=>{const e=[];for(const t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){const i=vs.nodeKey(t,n);this.containerNodes.has(i)&&e.push(...t.calculateLosses())}return e}))}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(const e of this.layers){const i=e.getClassName(),r=e.getConfig(),s=[];for(let n=0;n<e.inboundNodes.length;n++){const i=e.inboundNodes[n],r=vs.nodeKey(e,n);let a={};if(this.containerNodes.has(r)){if(i.callArgs)try{JSON.stringify(i.callArgs),a=i.callArgs}catch(t){console.warn(`Layer ${e.name} was passed non-serializable keyword arguments: ${i.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),a={}}if(i.inboundLayers.length>0){const e=[];for(let n=0;n<i.inboundLayers.length;n++){const r=i.inboundLayers[n],s=i.nodeIndices[n],o=i.tensorIndices[n];let u=t[vs.nodeKey(r,s)];null==u&&(u=0),e.push([r.name,u,o,a])}s.push(e)}}}const a={};a.name=e.name,a.className=i,a.config=r,a.inboundNodes=s,n.push(a)}e.layers=n;const i=[];for(let e=0;e<this.inputLayers.length;e++){const n=this.inputLayers[e],r=this.inputLayersNodeIndices[e],s=vs.nodeKey(n,r);if(!this.containerNodes.has(s))continue;let a=t[s];null==a&&(a=0);const o=this.inputLayersTensorIndices[e];i.push([n.name,a,o])}e.inputLayers=i;const r=[];for(let e=0;e<this.outputLayers.length;e++){const n=this.outputLayers[e],i=this.outputLayersNodeIndices[e],s=vs.nodeKey(n,i);if(!this.containerNodes.has(s))continue;let a=t[s];null==a&&(a=0);const o=this.outputLayersTensorIndices[e];r.push([n.name,a,o])}return e.outputLayers=r,e}static fromConfig(e,t,n={},i=!1){const r={},s={};function a(e,t){e.name in s?s[e.name].push(t):s[e.name]=[t]}function o(e,t){const n=[];let i;for(const s of t){const o=s[0],u=s[1],l=s[2];if(i=null==s[3]?{}:s[3],!(o in r))return void a(e,t);const c=r[o];if(c.inboundNodes.length<=u)return void a(e,t);const d=c.inboundNodes[u];n.push(d.outputTensors[l])}n.length>0&&e.apply(On(n),i)}function u(e){const n=e.name,s=Br(e,null!=t.customObjects?t.customObjects:{});s.setFastWeightInitDuringBuild(i),r[n]=s,e.inboundNodes.forEach((e=>{if(!(e instanceof Array))throw new _n(`Corrupted configuration, expected array for nodeData: ${e}`);a(s,e)}))}const l=t.name,c=t.layers;for(const e of c)u(e);for(;!jn(s);)for(const e of c){const t=r[e.name];if(t.name in s){const e=s[t.name];delete s[t.name];for(const n of e)o(t,n)}}const d=[],h=[],f=t.inputLayers;for(const e of f){const t=e[0],n=e[1],i=e[2];Dn(t in r);const s=r[t].inboundNodes[n].outputTensors;d.push(s[i])}const p=t.outputLayers;for(const e of p){const t=e[0],n=e[1],i=e[2];Dn(t in r);const s=r[t].inboundNodes[n].outputTensors;h.push(s[i])}return new e({inputs:d,outputs:h,name:l})}get stateful(){if(this._stateful)throw new _n("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){(0,r.tidy)((()=>{this.layers.forEach((e=>{e.stateful&&e.resetStates()}))}))}}function bs(e,t){return function(e,t,n){const i=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((e=>null));if(1===i)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==i)throw new Error(`Provided ${n} is an array of ${e.length} element(s), but the model has ${i} outputs. Make sure a set of weights is provided for each model output.`);return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){const n=[];return t.forEach((t=>{t in e?n.push(e[t]):n.push(null)})),n}throw new Error(`The model has multiple (${i}) outputs, so ${n} must be either an array with ${i} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(e)}`)}(e,t,"classWeight")}async function xs(e,t,n,i){if(null!=t||null!=i)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const t=(0,r.tidy)((()=>{if(1===e.shape.length)return(0,r.clone)(e);if(2===e.shape.length){if(e.shape[1]>1){const t=1;return(0,r.argMax)(e,t)}if(1===e.shape[1])return(0,r.reshape)(e,[e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)})),i=Array.from(await t.data());(0,r.dispose)(t);const s=[];return i.forEach((e=>{if(null==n[e])throw new Error(`classWeight must contain all classes in the training data. The class ${e} exists in the data but not in classWeight`);s.push(n[e])})),(0,r.tensor1d)(s,"float32")}return null}function ws(e,t){return(0,r.mul)(e,t)}function Cs(e,t){let n,i;const s=t;n=s.xs,i=s.ys,r.util.assert(null!=n&&null!=i,(()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`));const a=ks("input",e.inputNames,n),o=ks("output",e.outputNames,i),u=a[0].shape[0];r.util.assert(a.length===e.inputs.length,(()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${a.length} inputs.  (Expected input keys: ${JSON.stringify(e.inputNames)})`)),r.util.assert(o.length===e.outputs.length,(()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(e.outputNames)})`));for(let t=0;t<a.length;t++)r.util.assert(a[t].shape[0]===u,(()=>`Batch size mismatch: input ${e.inputNames[t]} has ${a[t].shape[0]}; expected  ${u} based on input ${e.inputNames[0]}.`));for(let t=0;t<o.length;t++)r.util.assert(o[t].shape[0]===u,(()=>`Batch size mismatch: output ${e.outputNames[t]} has ${o[t].shape[0]}; expected  ${u} based on input ${e.inputNames[0]}.`));return{xs:a,ys:o}}function ks(e,t,n){if(n instanceof r.Tensor)return[n];if(Array.isArray(n))return r.util.assert(n.length===t.length,(()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`)),n;{const i=[];for(const r of t){if(null==n[r])throw new _n(`The feature data generated by the dataset lacks the required ${e} key '${r}'.`);i.push(n[r])}return i}}function As(e){return"function"==typeof e.iterator}function _s(e){r.util.assert(e>0&&Number.isInteger(e),(()=>`batchSize is required to be a positive integer, but got ${e}`))}function Es(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((e=>Ai(e,t,n-t))):Ai(e,t,n-t)}function Ss(e,t){return r.tidy((()=>null==e?null:Array.isArray(e)?e.map((e=>Ss(e,t))):Ni(e,"int32"===t.dtype?t:r.cast(t,"int32"))))}function Fs(e,t){const n=[];let i=0,r=null;for(;i<e;)r=i+t,r>=e&&(r=e),n.push([i,r]),i=r;return n}function Ds(e){const t=[];e instanceof r.Tensor&&(e=[e]);for(let n=0;n<e.length;++n){const i=e[n];if(1===i.rank)t.push(ki(i,1));else{if(0===i.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(i)}}return t}function $s(e,t){if(null==e)return;const n=[];if(t instanceof r.Tensor)n.push(t.id);else if(Array.isArray(t))t.forEach((e=>n.push(e.id)));else if(null!=t)for(const e in t){const i=t[e];n.push(i.id)}const i=[];if(e instanceof r.Tensor)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((e=>{-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(const t in e){const r=e[t];-1===n.indexOf(r.id)&&i.push(r)}i.forEach((e=>{e.isDisposed||e.dispose()}))}function Os(e){return Array.isArray(e)}function Ns(e){return!function(e){return e instanceof r.Tensor}(e)&&!Os(e)}function Is(e,t,n,i=!0,r=""){if(null==t||0===t.length){if(null!=e){let t=!1;if(Os(e)&&e.length>0)t=!0;else if(Ns(e)){for(const n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new _n(`Error when checking model ${r} expected no data, but got ${e}`)}return[]}if(null==e)return t.map((e=>null));let s;if(Ns(e)){e=e,s=[];for(const n of t){if(null==e[n])throw new _n(`No data provided for "${n}". Need data for each key in: ${t}`);s.push(e[n])}}else if(Os(e)){if((e=e).length!==t.length)throw new _n(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${e}`);s=e}else{if(e=e,t.length>1)throw new _n(`The model ${r} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${e.shape}`);s=[e]}if(s=Ds(s),null!=n)for(let e=0;e<t.length;++e){if(null==n[e])continue;const a=s[e];if(a.shape.length!==n[e].length)throw new _n(`Error when checking ${r}: expected ${t[e]} to have ${n[e].length} dimension(s). but got array with shape ${a.shape}`);for(let t=0;t<n[e].length;++t){if(0===t&&!i)continue;const s=a.shape[t],o=n[e][t];if(null!=o&&o>=0&&s!==o)throw new _n(`${r} expected a batch of elements where each example has shape [${n[e].slice(1,n[e].length)}] (i.e.,tensor shape [*,${n[e].slice(1,n[e].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return s}function Ts(e,t,n,i=!0,r=""){let s;if(Array.isArray(e)){if(e.length!==t.length)throw new _n(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);s=e}else{if(t.length>1)throw new _n(`The model expects ${t.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(e.shape)}.`);s=[e]}if(null!=n)for(let e=0;e<t.length;++e){if(null==n[e])continue;const a=s[e];if(a.shape.length!==n[e].length)throw new _n(`Error when checking ${r}: expected ${t[e]} to have ${n[e].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let s=0;s<n[e].length;++s){if(0===s&&!i)continue;const o=a.shape[s],u=n[e][s];if(null!=u&&u!==o)throw new _n(`Error when checking ${r}: expected ${t[e]} to have shape ${JSON.stringify(n[e])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}class Rs extends vs{constructor(e){super(e),this.isTraining=!1}summary(e,t,n=console.log){if(!this.built)throw new _n("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(e,t,n,i=console.log){const r=function(e){let t=!0;const n=[],i=[];for(const t in e.nodesByDepth)n.push(e.nodesByDepth[t]);for(const e of n){if(e.length>1||1===e.length&&e[0].inboundLayers.length>1){t=!1;break}i.push(...e)}if(t)for(const n of e.layers){let e=!1;for(const r of n.inboundNodes)if(-1!==i.indexOf(r)){if(e){t=!1;break}e=!0}if(!t)break}return t}(e),s=["Layer (type)","Output shape","Param #"];let a;if(r?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map((e=>Math.floor(t*e)))),!r){s.push("Receives inputs"),a=[];for(const t in e.nodesByDepth)a.push(...e.nodesByDepth[t])}i("_".repeat(t)),ss(s,n,i),i("=".repeat(t));const o=e.layers;for(let e=0;e<o.length;++e)r?as(o[e],n,i):os(o[e],n,a,i),i((e===o.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const u=function(e){let t;return t=null!=e.collectedTrainableWeights?pr(e.collectedTrainableWeights):pr(e.trainableWeights),t}(e),l=pr(e.nonTrainableWeights);i(`Total params: ${u+l}`),i(`Trainable params: ${u}`),i(`Non-trainable params: ${l}`),i("_".repeat(t))}(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){const t={Adagrad:()=>r.train.adagrad(.01),Adadelta:()=>r.train.adadelta(1,.95,Cn()),Adam:()=>r.train.adam(.001,.9,.999,Cn()),Adamax:()=>r.train.adamax(.002,.9,.999,Cn(),0),RMSProp:()=>r.train.rmsprop(.001,.9,0,Cn()),SGD:()=>r.train.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new _n(`Unknown Optimizer ${e}`)}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof r.Optimizer))throw new _n("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new _n(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);const n=e.loss;t=n.map((e=>Hr(e)))}else{const n=Hr(e.loss);this.outputs.forEach((e=>{t.push(n)}))}else{e.loss=e.loss;for(const t in e.loss)if(-1===this.outputNames.indexOf(t))throw new _n(`Unknown entry in loss dictionary: "${t}". Only expected the following keys: ${this.outputNames}`);for(const n of this.outputNames)null==e.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),t.push(Hr(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let e=0;e<this.outputs.length;++e){const t=this.internalOutputShapes[e],n=this.outputNames[e];this.feedOutputNames.push(n),this.feedOutputShapes.push(t),this.feedLossFns.push(this.lossFunctions[e])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],fi("loss",(()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;const t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}}));const i=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((e=>[]));let n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${e}`);n=e}if(Array.isArray(n))return t.map((e=>n));{const e=[];for(const i of t){let t=n.hasOwnProperty(i)?n[i]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}(e.metrics,this.outputNames),s=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};fi("metric",(()=>{for(let e=0;e<this.outputs.length;++e)-1===n.indexOf(e)&&(t=>{let n,i,r;for(const a of t){if("string"==typeof a&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(a)){const t=this.internalOutputShapes[e];let s;1===t[t.length-1]||this.lossFunctions[e]===Vr?-1!==["accuracy","acc"].indexOf(a)?i=Xr:-1!==["crossentropy","ce"].indexOf(a)&&(i=Kr):this.lossFunctions[e]===Wr?-1!==["accuracy","acc"].indexOf(a)?i=Jr:-1!==["crossentropy","ce"].indexOf(a)&&(i=Qr):-1!==["accuracy","acc"].indexOf(a)?i=Yr:-1!==["crossentropy","ce"].indexOf(a)&&(i=Zr),-1!==["accuracy","acc"].indexOf(a)?s="acc":-1!==["crossentropy","ce"].indexOf(a)&&(s="ce"),r=i,n=""+s}else{const e=ts(a);r=e,n=""+ns(a)}let t;fi(n,(()=>{t=r})),s(e,n,t)}})(i[e])})),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,n={}){const i=null==n.batchSize?32:n.batchSize;_s(i);const r=this.standardizeUserDataXY(e,t,!0,i);try{const s=r[0].concat(r[1]);this.makeTestFunction();const a=this.testFunction;return On(this.testLoop(a,s,i,n.verbose,n.steps))}finally{$s(r[0],e),$s(r[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),async function(e,t,n){const i=null!=(n=n||{}).batches,s=e.testFunction;let a=[];if(n.verbose>0)throw new En("Verbose mode is not implemented yet.");r.util.assert(!i||n.batches>0&&Number.isInteger(n.batches),(()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`));const o="function"==typeof t.next?t:await t.iterator();let u=0,l=0;for(;!i||l<n.batches;){const t=await o.next();if(a=r.tidy((()=>{if(t.value){const{xs:n,ys:i}=Cs(e,t.value),o=n.concat(i),c=r.tidy((()=>s(o)));if(r.dispose(o),0===l)for(let e=0;e<c.length;++e)a.push((0,r.scalar)(0));const d=o[0].shape[0];for(let e=0;e<c.length;++e){const t=c[e],n=a[e];a[e]=r.tidy((()=>r.add(a[e],r.mul(d,t)))),l>0&&r.dispose(n)}r.dispose(c),u+=d,++l}return a})),t.done){i&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let e=0;e<a.length;++e){const t=a[e];a[e]=r.div(a[e],u),r.dispose(t)}return On(a)}(this,e,t)}checkNumSamples(e,t,n,i="steps"){let r;if(null!=n){if(r=null,null!=t)throw new _n(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else{if(null==e)throw new _n(`Either the input data should have a defined shape, or ${i} shoud be specified.`);r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new _n("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(t),i=n?t:[t],s=this.retrieveSymbolicTensors(i),a=new ds;if(e instanceof r.Tensor&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new _n(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let t=0;t<this.inputs.length;++t)a.add(this.inputs[t],e[t])}else for(const t of this.inputs){const n=e[t.name];if(null==n)throw new _n(`No value is provided for the model's input ${t.name}`);a.add(t,n)}const o=ps(s,a);return n?o:o[0]}retrieveSymbolicTensors(e){const t=Fn(null,e.length);let n=e.length;for(const i of this.layers){const r=Array.isArray(i.output)?i.output:[i.output],s=r.map((e=>e.name));for(let i=0;i<e.length;++i){const a=s.indexOf(e[i]);if(-1!==a&&(t[i]=r[a],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw t.forEach(((t,i)=>{null==t&&n.push(e[i])})),new _n(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(n)}`)}return t}predictLoop(e,t=32,n=!1){return r.tidy((()=>{const i=this.checkNumSamples(e);if(n)throw new En("Verbose predictLoop() is not implemented yet.");const s=Fs(i,t),a=this.outputs.map((e=>[]));for(let t=0;t<s.length;++t)r.tidy((()=>{const n=s[t][0],i=s[t][1],r=Es(e,n,i),a=[];if(Array.isArray(r))for(let e=0;e<r.length;++e)a.push({key:this.inputs[e],value:r[e]});else a.push({key:this.inputs[0],value:r});const o=new ds(a);return ps(this.outputs,o)})).forEach(((e,t)=>a[t].push(e)));return On(a.map((e=>r.concat(e,0))))}))}predict(e,t={}){const n=Ds(e);Ts(n,this.inputNames,this.feedInputShapes,!1);try{const i=null==t.batchSize?32:t.batchSize;return _s(i),this.predictLoop(n,i)}finally{$s(n,e)}}predictOnBatch(e){Ts(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,n=!0,i){if(null==this.optimizer_)throw new An("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const s=[];for(let e=0;e<this.feedOutputShapes.length;++e){const t=this.feedOutputShapes[e];this.feedLossFns[e]===Wr?s.push(t.slice(0,t.length-1).concat([1])):s.push(t)}if(function(e,t,n){const i=Pn(e.map((e=>e.shape[0])));i.sort();const s=Pn(t.map((e=>e.shape[0])));if(s.sort(),i.length>1)throw new _n(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map((e=>e.shape)))}`);if(s.length>1)throw new _n(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map((e=>e.shape)))}`);if(i.length>0&&s.length>0&&!r.util.arraysEqual(i,s))throw new _n(`Input Tensors should have the same number of samples as target Tensors. Found ${i[0]} input sample(s) and ${s[0]} target sample(s).`)}(e=Is(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=Is(t,this.feedOutputNames,s,!1,"target")),function(e,t,n){const i=[Lr,Vr,Ur];for(let r=0;r<e.length;++r){const s=e[r],a=t[r],o=n[r];if(null!=a){if(a===Ur&&1===s.shape[s.shape.length-1])throw new _n(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==i.indexOf(a)){const e=s.shape.slice(1),t=o.slice(1);for(let n=0;n<e.length;++n){const i=e[n],r=t[n];if(null!=r&&i!==r)throw new _n(`A target Tensor with shape ${s.shape} was passed for an output of shape ${o}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=i&&i>0&&e[0].shape[0]%i!=0)throw new _n(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,n,i,r=!0,s){const[a,o]=this.standardizeUserDataXY(e,t,r,s);if(null!=n)throw new Error("sample weight is not supported yet.");let u=null;if(null!=i){const e=bs(i,this.outputNames);u=[];for(let t=0;t<e.length;++t)u.push(await xs(o[t],null,e[t]))}return[a,o,u]}testLoop(e,t,n,i=0,s){return r.tidy((()=>{const a=this.checkNumSamples(t,n,s,"steps"),o=[];if(i>0)throw new En("Verbose mode is not implemented yet.");if(null!=s)throw new En("steps mode in testLoop() is not implemented yet");{const i=Fs(a,n),s=(0,r.tensor1d)(wi(0,a));for(let n=0;n<i.length;++n){const a=i[n][0],u=i[n][1],l=Ai(s,a,u-a),c=Ss(t,l),d=e(c);if(0===n)for(let e=0;e<d.length;++e)o.push((0,r.scalar)(0));for(let e=0;e<d.length;++e){const t=d[e];o[e]=r.add(o[e],r.mul(u-a,t))}}for(let e=0;e<o.length;++e)o[e]=r.div(o[e],a)}return o}))}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){const i=e[n];let r=i;$n(e,i)>1&&(r+=`_${$n(e.slice(0,n),i)}`),t.push(r)}return t}makeTrainFunction(){return e=>{const t=[],n=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),a=[],o=this.collectedTrainableWeights.map((e=>e.read()));return[this.optimizer_.minimize((()=>{const e=[];for(let t=0;t<this.inputs.length;++t)e.push({key:this.inputs[t],value:n[t]});const o=new ds(e),u=ps(this.outputs,o,{training:!0});let l;for(let e=0;e<this.lossFunctions.length;++e){let n=(0,this.lossFunctions[e])(i[e],u[e]);null!=s[e]&&(n=ws(n,s[e]));const a=r.mean(n);t.push(a),l=0===e?n:r.add(l,n)}for(let e=0;e<this.metricsTensors.length;++e){let n;if(this.outputs.length>1&&e<this.outputs.length)n=t[e];else{const t=this.metricsTensors[e][0],s=this.metricsTensors[e][1];n=r.mean(t(i[s],u[s]))}r.keep(n),a.push(n)}return l=r.mean(l),this.calculateLosses().forEach((e=>{l=r.add(l,e)})),l}),!0,o)].concat(a)}}makeTestFunction(){this.testFunction=e=>r.tidy((()=>{const t=[];let n;const i=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let e=0;e<this.inputs.length;++e)a.push({key:this.inputs[e],value:i[e]});const o=new ds(a),u=ps(this.outputs,o);for(let e=0;e<this.lossFunctions.length;++e){const i=this.lossFunctions[e],a=r.mean(i(s[e],u[e]));n=0===e?a:r.add(n,a),t.push(n)}for(let e=0;e<this.metricsTensors.length;++e){const n=this.metricsTensors[e][0],i=this.metricsTensors[e][1],a=r.mean(n(s[i],u[i]));t.push(a)}return t}))}async fit(e,t,n={}){return async function(e,t,n,i={}){if(e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let s,a,o,u,l,c,d;e.isTraining=!0;try{const h=null==i.batchSize?32:i.batchSize;_s(h);const f=!1,p=await e.standardizeUserData(t,n,i.sampleWeight,i.classWeight,f,h);s=p[0],a=p[1],d=p[2];let m,g=!1;if(null!=i.validationData&&i.validationData.length>0){if(g=!0,2!==i.validationData.length)throw 3===i.validationData.length?new En("validationData including sample weights is not supported yet."):new _n(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${i.validationData} is invalid.`);o=i.validationData[0],u=i.validationData[1];const t=!0,n=await e.standardizeUserData(o,u,null,null,t,h);l=n[0],c=n[1],m=l.concat(c)}else if(null!=i.validationSplit&&i.validationSplit>0&&i.validationSplit<1){g=!0;const e=Math.floor(s[0].shape[0]*(1-i.validationSplit)),t=s[0].shape[0];l=Es(s,e,t),s=Es(s,0,e),c=Es(a,e,t),a=Es(a,0,e),m=l.concat(c)}else null!=i.validationSteps&&(g=!0);const y=s.concat(a).concat(d);e.checkTrainableWeightsConsistency();const v=e.makeTrainFunction(),b=e.getDedupedMetricsNames();let x,w;g?(e.makeTestFunction(),x=e.testFunction,w=b.slice().concat(b.map((e=>"val_"+e)))):(x=null,m=[],w=b.slice());const C=Tr(i.callbacks,i.yieldEvery);return await async function(e,t,n,i,s,a,o,u,l,c,d,h,f,p,m){null==s&&(s=32),null==a&&(a=1),null==d&&(d=!0),null==f&&(f=0);let g=!1;null!=l&&null!=c&&(g=!0);const y=e.checkNumSamples(n,s,p,"steps_per_epoch");let v;null!=y&&(v=wi(0,y)),null==o&&(o=1);const{callbackList:b,history:x}=Mr(u,o,a,f,y,p,s,g,h);b.setModel(e),e.history=x,await b.onTrainBegin(),e.stopTraining_=!1;for(let o=f;o<a;++o){await b.onEpochBegin(o);const a={};{if("batch"===d)throw new En("batch shuffling is not implemneted yet");d&&r.util.shuffle(v);const o=(0,r.tensor1d)(v),u=Fs(y,s);for(let d=0;d<u.length;++d){const h={};if(await b.onBatchBegin(d,h),r.tidy((()=>{const f=u[d][0],p=u[d][1],m=Ai(o,f,p-f);h.batch=d,h.size=p-f;const y=Ss(n,m),v=t(y);for(let e=0;e<i.length;++e){const t=i[e],n=v[e];h[t]=n,r.keep(n)}if(d===u.length-1&&g){const t=e.testLoop(l,c,s);for(let e=0;e<i.length;++e){const n=i[e],s=t[e];r.keep(s),a["val_"+n]=s}}})),await b.onBatchEnd(d,h),Sr(h),e.stopTraining_)break}o.dispose()}if(await b.onEpochEnd(o,a),e.stopTraining_)break}return await b.onTrainEnd(),await e.history.syncData(),e.history}(e,v,y,b,h,i.epochs,i.verbose,C,x,m,i.shuffle,w,i.initialEpoch,null)}finally{e.isTraining=!1,$s(s,t),$s(a,n),$s(l,o),$s(c,u),null!=d&&r.dispose(d)}}(this,e,t,n)}async fitDataset(e,t){return async function(e,t,n){const i=null!=n.batchesPerEpoch;if(r.util.assert(null!=e.optimizer,(()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig).")),r.util.assert(null!=n,(()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call.")),r.util.assert(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`)),r.util.assert(!i||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`)),r.util.assert(null==n.validationSplit,(()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead.")),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const s=null!=n.validationData;let a,o;if(s)if(As(n.validationData))r.util.assert(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`));else{const e=function(e){if(3===e.length)throw new En("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData);a=e.xs,o=e.ys}const u=e.makeTrainFunction(),l=e.getDedupedMetricsNames();let c;c=s?l.slice().concat(l.map((e=>"val_"+e))):l.slice();const d=Tr(n.callbacks,n.yieldEvery),h=null==n.verbose?1:n.verbose,{callbackList:f,history:p}=Mr(d,h,n.epochs,null,null,function(e,t){let n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}(t,n),null,s,c);f.setModel(e),e.history=p,await f.onTrainBegin(),e.stopTraining_=!1;let m=null==n.initialEpoch?0:n.initialEpoch,g=await t.iterator();for(;m<n.epochs;){const c={};await f.onEpochBegin(m);let d=0,h=0;for(i||(g=await t.iterator());!i||d<n.batchesPerEpoch;){const t=await g.next();if(i&&t.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${d} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, `+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset.");break}if(null!=t.value){const{xs:i,ys:s}=Cs(e,t.value),a={};a.batch=h,a.size=i[0].shape[0],await f.onBatchBegin(h,a);const o=[];if(null!=n.classWeight){const t=bs(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)o.push(await xs(s[e],null,t[e]))}const c=i.concat(s).concat(o),p=u(c);r.dispose(c);for(let e=0;e<l.length;++e){const t=l[e],n=p[e];a[t]=n,r.keep(n)}await f.onBatchEnd(h,a),Sr(a),h++,d++}if(i?d>=n.batchesPerEpoch:t.done){if(s){let t;t=As(n.validationData)?Nn(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):Nn(e.evaluate(a,o,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)c[`val_${e.metricsNames[n]}`]=t[n]}break}if(e.stopTraining_)break}if(await f.onEpochEnd(m,c),m++,e.stopTraining_)break}return await f.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}(this,e,t)}async trainOnBatch(e,t){const n=await this.standardizeUserData(e,t),i=n[0],s=n[1],a=this.makeTrainFunction()(i.concat(s)),o=[];for(const e of a){const t=await e.data();o.push(t[0])}return r.dispose(a),On(o)}getNamedWeights(e){const t=[],n=null!=e&&e.trainableOnly,i=n?this.trainableWeights:this.weights,r=this.getWeights(n);for(let e=0;e<i.length;++e)n&&!i[e].trainable||t.push({name:i[e].originalName,tensor:r[e]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const t=r.memory().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-r.memory().numTensors}return e}getLossIdentifiers(){let e;if("string"==typeof this.loss)e=In(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if("string"!=typeof e)throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map((e=>In(e)))}else{const t=Object.keys(this.loss);e={};const n=this.loss;for(const i of t){if("string"!=typeof n[i])throw new Error("Serialization of non-string loss is not supported.");e[i]=In(n[i])}}return e}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[In(ns(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((e=>In(ns(e))));{const e={};for(const t in this.metrics)e[t]=In(ns(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const t=Br(ls(e.optimizer_config));let n,i;if("string"==typeof e.loss)n=Tn(e.loss);else if(Array.isArray(e.loss))n=e.loss.map((e=>Tn(e)));else if(null!=e.loss){n={};for(const t in e.loss)n[t]=Tn(e.loss[t])}if(Array.isArray(e.metrics))i=e.metrics.map((e=>Tn(e)));else if(null!=e.metrics){i={};for(const t in e.metrics)i[t]=Tn(e.metrics[t])}this.compile({loss:n,metrics:i,optimizer:t})}async save(e,t){if("string"==typeof e){const t=r.io.getSaveHandlers(e);if(0===t.length)throw new _n(`Cannot find any save handlers for URL '${e}'`);if(t.length>1)throw new _n(`Found more than one (${t.length}) save handlers for URL '${e}'`);e=t[0]}if(null==e.save)throw new _n("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await r.io.encodeWeights(this.getNamedWeights(t)),i={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v3.11.0",convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){i.trainingConfig=this.getTrainingConfig();const e="optimizer",{data:t,specs:s}=await r.io.encodeWeights(await this.optimizer.getWeights(),e);n.specs.push(...s),n.data=r.io.concatenateArrayBuffers([n.data,t])}if(null!=this.userDefinedMetadata){const e=!0;is(this.userDefinedMetadata,this.name,e),i.userDefinedMetadata=this.userDefinedMetadata}return i.weightData=n.data,i.weightSpecs=n.specs,e.save(i)}setUserDefinedMetadata(e){is(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Rs.className="Model",r.serialization.registerClass(Rs);class Ms extends Rs{}Ms.className="Functional",r.serialization.registerClass(Ms);class Bs extends Rs{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:lr("sequential_"),null!=e.layers)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some((e=>e<0)))throw new _n(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof Bs||e instanceof Rs;let n;if(t){if(n=e,1!==n.outputs.length)throw new _n("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new _n("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new _n("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const t=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new _n("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;return null==n&&(n="float32"),new _r({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(t)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new _n(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(1!==e.inboundNodes[0].outputTensors.length)throw new _n("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=Ar(this.outputs[0])}this.inboundNodes=[],new wr({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Fn(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((e=>e.shape)),outputShapes:this.outputs[0].shape})}else{const t=e.apply(this.outputs[0]);if(Array.isArray(t))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if(fr(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Rs({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,n=console.log){this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t,n={}){if(!this.built)throw new An("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new An("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,n={}){if(!this.built)throw new An("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new An("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,n={},i=!1){let s,a={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new _n("Legacy serialization format not supported yet.");s=t}else r.util.assert(null!=t.layers,(()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field.")),s=t.layers,delete t.layers,a=t;const o=new e(a);if(!(o instanceof Bs))throw new En(`Sequential.fromConfig called on non-Sequential input: ${o}`);for(const e of s){const t=Br(e,void 0,i);i&&t.setFastWeightInitDuringBuild(!0),o.add(t)}return o}set stopTraining(e){if(null==this.model)throw new _n("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new _n("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}Bs.className="Sequential",r.serialization.registerClass(Bs);class zs extends r.serialization.Serializable{getConfig(){return{}}}class Ls extends zs{apply(e,t=1){return function(e,t=1){if(1!==t)throw new En(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return r.elu(e)}(e,t)}}Ls.className="elu",r.serialization.registerClass(Ls);class Ps extends zs{apply(e){return r.selu(e)}}Ps.className="selu",r.serialization.registerClass(Ps);class js extends zs{apply(e){return r.relu(e)}}js.className="relu",r.serialization.registerClass(js);class Us extends zs{apply(e){return(0,r.tidy)((()=>r.minimum(6,r.relu(e))))}}Us.className="relu6",r.serialization.registerClass(Us);class Ws extends zs{apply(e){return e}}Ws.className="linear",r.serialization.registerClass(Ws);class Vs extends zs{apply(e){return r.sigmoid(e)}}Vs.className="sigmoid",r.serialization.registerClass(Vs);class qs extends zs{apply(e){return function(e){return(0,r.tidy)((()=>{const t=r.add(.5,r.mul(.2,e));return r.clipByValue(t,0,1)}))}(e)}}qs.className="hardSigmoid",r.serialization.registerClass(qs);class Gs extends zs{apply(e){return r.softplus(e)}}Gs.className="softplus",r.serialization.registerClass(Gs);class Hs extends zs{apply(e){return function(e){return(0,r.tidy)((()=>r.div(e,r.add(r.abs(e),1))))}(e)}}Hs.className="softsign",r.serialization.registerClass(Hs);class Xs extends zs{apply(e){return r.tanh(e)}}Xs.className="tanh",r.serialization.registerClass(Xs);class Ys extends zs{apply(e,t=-1){return r.softmax(e,t)}}Ys.className="softmax",r.serialization.registerClass(Ys);class Ks extends zs{apply(e,t=-1){return r.logSoftmax(e,t)}}Ks.className="logSoftmax",r.serialization.registerClass(Ks);class Js extends zs{apply(e,t=1){return(0,r.tidy)((()=>r.mul(r.sigmoid(r.mul(e,t)),e)))}}Js.className="swish",r.serialization.registerClass(Js);class Zs extends zs{apply(e){return(0,r.tidy)((()=>r.mul(e,r.tanh(r.softplus(e)))))}}function Qs(e){return e.getClassName()}function ea(e,t={}){return zn(e,r.serialization.SerializationMap.getMap().classNameMap,t,"activation")}function ta(e){if(null==e){return ea({className:"linear",config:{}})}if("string"==typeof e){const t={};return t.className=e,t.config={},ea(t)}return e instanceof zs?e:ea(e)}Zs.className="mish",r.serialization.registerClass(Zs);class na extends r.serialization.Serializable{}class ia extends na{constructor(e){super(),function(e){if(null!=e&&"object"!=typeof e)throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${e}`)}(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return(0,r.tidy)((()=>{let t=(0,r.zeros)([1]);return this.hasL1&&(t=(0,r.add)(t,(0,r.sum)(r.mul(this.l1,(0,r.abs)(e))))),this.hasL2&&(t=(0,r.add)(t,(0,r.sum)(r.mul(this.l2,Ii(e))))),r.reshape(t,[])}))}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}ia.className="L1L2",r.serialization.registerClass(ia);const ra={l1l2:"L1L2"};function sa(e){return Mn(e)}function aa(e,t={}){return zn(e,r.serialization.SerializationMap.getMap().classNameMap,t,"regularizer")}function oa(e){return null==e?null:"string"==typeof e?aa({className:e in ra?ra[e]:e,config:{}}):e instanceof na?e:aa(e)}class ua extends kr{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){e=hr(e);let n=(0,r.relu)(e);return null!=this.maxValue&&(n=(0,r.clipByValue)(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}ua.className="ReLU",r.serialization.registerClass(ua);class la extends kr{constructor(e){super(null==e?{}:e),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=hr(e);return(0,r.leakyRelu)(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}la.className="LeakyReLU",r.serialization.registerClass(la);class ca extends kr{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=sr(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=oa(e.alphaRegularizer),this.alphaConstraint=ni(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new _n(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`);this.sharedAxes=[e.sharedAxes]}}build(e){const t=(e=fr(e)).slice(1);if(null!=this.sharedAxes)for(const e of this.sharedAxes)t[e-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let t=1;t<e.length;++t)n[t]=e[t];this.inputSpec=[new vr({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=hr(e),(0,r.prelu)(e,this.alpha.read())}getConfig(){const e={alphaInitializer:rr(this.alphaInitializer),alphaRegularizer:sa(this.alphaRegularizer),alphaConstraint:ei(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}ca.className="PReLU",r.serialization.registerClass(ca);class da extends kr{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new En(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=hr(e);return(0,r.elu)(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}da.className="ELU",r.serialization.registerClass(da);class ha extends kr{constructor(e){super(null==e?{}:e),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){const n=hr(e);return(0,r.mul)(n,(0,r.cast)((0,r.greater)(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}ha.className="ThresholdedReLU",r.serialization.registerClass(ha);class fa extends kr{constructor(e){super(null==e?{}:e),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=(new Ys).apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){const n=hr(e);return this.softmax(n,this.axis)}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function pa(e,t,n){if("number"==typeof e)return Fn(e,t);if(e.length!==t)throw new _n(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let r=0;r<t;++r){const s=e[r];if((i=s)!==parseInt(i.toString(),10))throw new _n(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number ${s}`)}return e;var i}function ma(e,t,n,i,r=1){if(null==e)return e;let s;return s="same"===n?e:e-(t+(t-1)*(r-1))+1,Math.floor((s+i-1)/i)}function ga(e,t,n,i){if(null==e)return null;if("valid"===i)e=e*t+xi([n-t,0]);else{if("same"!==i)throw new _n(`Unsupport padding mode: ${i}.`);e*=t}return e}function ya(e,t){return(0,r.tidy)((()=>(li(t),"channelsFirst"===t?r.transpose(e,[0,2,3,1]):e)))}function va(e,t){return(0,r.tidy)((()=>(li(t),"channelsFirst"===t?r.transpose(e,[0,2,3,4,1]):e)))}function ba(e,t,n,i=[1,1],s="valid",a,o,u=null){return(0,r.tidy)((()=>{if(null==a&&(a="channelsLast"),li(a),3!==e.rank&&4!==e.rank)throw new _n(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(3!==t.rank&&4!==t.rank)throw new _n(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let l=ya(e,a);if("causal"===s)throw new En("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=r.fused.conv2d({x:l,filter:t,strides:i,pad:"same"===s?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:u}),"channelsFirst"===a&&(l=r.transpose(l,[0,3,1,2])),l}))}fa.className="Softmax",r.serialization.registerClass(fa);class xa extends kr{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",xa.verifyArgs(t),this.rank=e,Vn(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new En(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=pa(t.kernelSize,e,"kernelSize"),this.strides=pa(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,ci(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,li(this.dataFormat),this.activation=ta(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=sr(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=ni(t.biasConstraint),this.biasRegularizer=oa(t.biasRegularizer),this.activityRegularizer=oa(t.activityRegularizer),this.dilationRate=pa(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new _n(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new _n(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new _n(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}static verifyArgs(e){if(Dn("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!Wn(e.kernelSize,"number",1,3))throw new _n(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Qs(this.activation),useBias:this.useBias,biasInitializer:rr(this.biasInitializer),biasRegularizer:sa(this.biasRegularizer),activityRegularizer:sa(this.activityRegularizer),biasConstraint:ei(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class wa extends xa{constructor(e,t){super(e,t),this.kernel=null,wa.verifyArgs(t),this.filters=t.filters,Vn(this.filters,"filters"),this.kernelInitializer=sr(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=ni(t.kernelConstraint),this.kernelRegularizer=oa(t.kernelRegularizer)}build(e){e=fr(e);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new _n(`The channel dimension of the input should be defined. Found ${e[t]}`);const n=e[t],i=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return(0,r.tidy)((()=>{let t;e=hr(e);const n=null==this.bias?null:this.bias.read(),i=Gn(this.activation.getClassName());if(null!=i&&2===this.rank)t=ba(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(1===this.rank)t=function(e,t,n,i=1,s="valid",a,o=1){return(0,r.tidy)((()=>{if(null==a&&(a="channelsLast"),li(a),3!==e.shape.length)throw new _n(`The input of a conv1dWithBias operation should be 3, but is ${e.shape.length} instead.`);if(3!==t.shape.length)throw new _n(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(null!=n&&1!==n.shape.length)throw new _n(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if("channelsFirst"===a&&(e=r.transpose(e,[0,2,1])),"causal"===s)throw new En("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let u=r.conv1d(e,t,i,"same"===s?"same":"valid","NWC",o);return null!=n&&(u=Ri(u,n)),u}))}(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=ba(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new En("convolutions greater than 3D are not implemented yet.");t=function(e,t,n,i=[1,1,1],s="valid",a,o){return(0,r.tidy)((()=>{if(null==a&&(a="channelsLast"),li(a),4!==e.rank&&5!==e.rank)throw new _n(`conv3dWithBias expects input to be of rank 4 or 5, but received ${e.rank}.`);if(4!==t.rank&&5!==t.rank)throw new _n(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${e.rank}.`);let u=va(e,a);if("causal"===s)throw new En("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return u=r.conv3d(u,t,i,"same"===s?"same":"valid","NDHWC",o),null!=n&&(u=Ri(u,n)),"channelsFirst"===a&&(u=r.transpose(u,[0,4,1,2,3])),u}))}(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(t=this.activation.apply(t))}return t}))}computeOutputShape(e){e=fr(e);const t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let e=0;e<n.length;++e){const i=ma(n[e],this.kernelSize[e],this.padding,this.strides[e],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[e]);t.push(i)}let i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t),i.push(this.filters)):(i.push(this.filters),i=i.concat(t)),i}getConfig(){const e={filters:this.filters,kernelInitializer:rr(this.kernelInitializer),kernelRegularizer:sa(this.kernelRegularizer),kernelConstraint:ei(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new _n(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Ca extends wa{constructor(e){super(2,e),Ca.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!Wn(e.kernelSize,"number",1,2))throw new _n(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Ca.className="Conv2D",r.serialization.registerClass(Ca);class ka extends wa{constructor(e){super(3,e),ka.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new _n(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}ka.className="Conv3D",r.serialization.registerClass(ka);class Aa extends Ca{constructor(e){if(super(e),this.inputSpec=[new vr({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new _n(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(4!==(e=fr(e)).length)throw new _n("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new _n("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],i=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new vr({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return r.tidy((()=>{let t=hr(e);if(4!==t.shape.length)throw new _n(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${t.shape.length}`);const n=t.shape,i=n[0];let s,a;"channelsFirst"===this.dataFormat?(s=2,a=3):(s=1,a=2);const o=n[s],u=n[a],l=this.kernelSize[0],c=this.kernelSize[1],d=this.strides[0],h=this.strides[1],f=[i,ga(o,d,l,this.padding),ga(u,h,c,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=r.transpose(t,[0,2,3,1]));let p=r.conv2dTranspose(t,this.kernel.read(),f,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(p=r.transpose(p,[0,3,1,2])),null!=this.bias&&(p=Ri(p,this.bias.read(),this.dataFormat)),null!=this.activation&&(p=this.activation.apply(p)),p}))}computeOutputShape(e){const t=(e=fr(e)).slice();let n,i,r;"channelsFirst"===this.dataFormat?(n=1,i=2,r=3):(n=3,i=1,r=2);const s=this.kernelSize[0],a=this.kernelSize[1],o=this.strides[0],u=this.strides[1];return t[n]=this.filters,t[i]=ga(t[i],o,s,this.padding),t[r]=ga(t[r],u,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Aa.className="Conv2DTranspose",r.serialization.registerClass(Aa);class _a extends ka{constructor(e){if(super(e),this.inputSpec=[new vr({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new _n(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(5!==(e=fr(e)).length)throw new _n("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new _n("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],i=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new vr({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return r.tidy((()=>{let t=hr(e);if(5!==t.shape.length)throw new _n(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${t.shape.length}`);const n=t.shape,i=n[0];let s,a,o;"channelsFirst"===this.dataFormat?(o=2,s=3,a=4):(o=1,s=2,a=3);const u=n[o],l=n[s],c=n[a],d=this.kernelSize[0],h=this.kernelSize[1],f=this.kernelSize[2],p=this.strides[0],m=this.strides[1],g=this.strides[2],y=[i,ga(u,p,d,this.padding),ga(l,m,h,this.padding),ga(c,g,f,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=r.transpose(t,[0,2,3,4,1]));let v=r.conv3dTranspose(t,this.kernel.read(),y,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(v=r.transpose(v,[0,4,1,2,3])),null!==this.bias&&(v=Ri(v,this.bias.read(),this.dataFormat)),null!==this.activation&&(v=this.activation.apply(v)),v}))}computeOutputShape(e){const t=(e=fr(e)).slice();let n,i,r,s;"channelsFirst"===this.dataFormat?(n=1,i=2,r=3,s=4):(n=4,i=1,r=2,s=3);const a=this.kernelSize[0],o=this.kernelSize[1],u=this.kernelSize[2],l=this.strides[0],c=this.strides[1],d=this.strides[2];return t[n]=this.filters,t[i]=ga(t[i],l,a,this.padding),t[r]=ga(t[r],c,o,this.padding),t[s]=ga(t[s],d,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}_a.className="Conv3DTranspose",r.serialization.registerClass(_a);class Ea extends wa{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new _n("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new _n("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new _n(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=sr(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=oa(t.depthwiseRegularizer),this.depthwiseConstraint=ni(t.depthwiseConstraint),this.pointwiseInitializer=sr(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=oa(t.pointwiseRegularizer),this.pointwiseConstraint=ni(t.pointwiseConstraint)}build(e){if((e=fr(e)).length<this.rank+2)throw new _n(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new _n(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const n=e[t],i=this.kernelSize.concat([n,this.depthMultiplier]),r=[];for(let e=0;e<this.rank;++e)r.push(1);r.push(n*this.depthMultiplier,this.filters);const s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",r,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new vr({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return(0,r.tidy)((()=>{let t;if(e=hr(e),1===this.rank)throw new En("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=r.transpose(e,[0,2,3,1])),t=r.separableConv2d(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=Ri(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=r.transpose(t,[0,3,1,2])),t}))}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=rr(this.depthwiseInitializer),e.pointwiseInitializer=rr(this.pointwiseInitializer),e.depthwiseRegularizer=sa(this.depthwiseRegularizer),e.pointwiseRegularizer=sa(this.pointwiseRegularizer),e.depthwiseConstraint=ei(this.depthwiseConstraint),e.pointwiseConstraint=ei(this.pointwiseConstraint),e}}Ea.className="SeparableConv";class Sa extends Ea{constructor(e){super(2,e)}}Sa.className="SeparableConv2D",r.serialization.registerClass(Sa);class Fa extends wa{constructor(e){super(1,e),Fa.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!Wn(e.kernelSize,"number",1,1))throw new _n(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Fa.className="Conv1D",r.serialization.registerClass(Fa);class Da extends kr{constructor(e){super(e),"number"==typeof e.cropping?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return(0,r.tidy)((()=>{if(e=hr(e),"channelsLast"===this.dataFormat){const t=Ei(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Ei(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const t=Ei(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Ei(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}}))}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}Da.className="Cropping2D",r.serialization.registerClass(Da);class $a extends kr{constructor(e){var t;super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,li(this.dataFormat),this.interpolation=null==e.interpolation?"nearest":e.interpolation,t=this.interpolation,Un(ri,"InterpolationFormat",t)}computeOutputShape(e){if("channelsFirst"===this.dataFormat){const t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}{const t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return r.tidy((()=>{let t=hr(e);const n=t.shape;if("channelsFirst"===this.dataFormat){t=r.transpose(t,[0,2,3,1]);const e=this.size[0]*n[2],i=this.size[1]*n[3],s="nearest"===this.interpolation?r.image.resizeNearestNeighbor(t,[e,i]):r.image.resizeBilinear(t,[e,i]);return r.transpose(s,[0,3,1,2])}{const e=this.size[0]*n[1],i=this.size[1]*n[2];return"nearest"===this.interpolation?r.image.resizeNearestNeighbor(t,[e,i]):r.image.resizeBilinear(t,[e,i])}}))}getConfig(){const e={size:this.size,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}$a.className="UpSampling2D",r.serialization.registerClass($a);class Oa extends xa{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=sr(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=ni(e.depthwiseConstraint),this.depthwiseRegularizer=oa(e.depthwiseRegularizer)}build(e){if((e=fr(e)).length<4)throw new _n(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new _n(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const n=e[t],i=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return(0,r.tidy)((()=>{let t=function(e,t,n=[1,1],i="valid",s,a){return(0,r.tidy)((()=>{null==s&&(s="channelsLast"),li(s);let o=ya(e,s);if(4!==e.rank)throw new _n(`Input for depthwiseConv2d is required to be 4-D, but is instead ${e.rank}-D`);if(4!==t.rank)throw new _n(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return o=r.depthwiseConv2d(o,t,n,"same"===i?"same":"valid","NHWC",a),"channelsFirst"===s&&(o=r.transpose(o,[0,3,1,2])),o}))}(e=hr(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=Ri(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t}))}computeOutputShape(e){e=fr(e);const t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],i="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=ma(t,this.kernelSize[0],this.padding,this.strides[0]),s=ma(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],i,r,s]:[e[0],r,s,i]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=rr(this.depthwiseInitializer),e.depthwiseRegularizer=sa(this.depthwiseRegularizer),e.depthwiseConstraint=ei(this.depthwiseRegularizer),e}}function Na(e,t,n,i){if(Array.isArray(e)){if(null!=t||null!=n)throw new _n("When inputs is an array, neither initialState or constants should be provided");null!=i&&(n=e.slice(e.length-i,e.length),e=e.slice(0,e.length-i)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function r(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=r(t),constants:n=r(n)}}function Ia(e,t,n,i=!1,s,a,o=!1,u=!1){return r.tidy((()=>{const l=t.shape.length;if(l<3)throw new _n(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(wi(2,l));if(t=r.transpose(t,c),null!=a)throw new En("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=s&&((s=r.cast(r.cast(s,"bool"),"float32")).rank===l-1&&(s=r.expandDims(s,-1)),s=r.transpose(s,c)),i&&(t=r.reverse(t,0),null!=s&&(s=r.reverse(s,0)));const d=[];let h,f=n;const p=t.shape[0],m=r.unstack(t);let g,y;null!=s&&(g=r.unstack(s));for(let t=0;t<p;++t){const n=m[t],i=r.tidy((()=>e(n,f)));if(null==s)h=i[0],f=i[1];else{const e=r.tidy((()=>{const e=g[t],n=r.sub(r.onesLike(e),e);return{output:r.add(r.mul(i[0],e),r.mul(f[0],n)),newStates:f.map(((t,s)=>r.add(r.mul(i[1][s],e),r.mul(t,n))))}}));h=e.output,f=e.newStates}u&&d.push(h)}if(u){const e=1;y=r.stack(d,e)}return[h,y,f]}))}Oa.className="DepthwiseConv2D",r.serialization.registerClass(Oa);class Ta extends kr{constructor(e){let t;if(super(e),null==e.cell)throw new _n("cell property is missing for the constructor of RNN.");if(t=Array.isArray(e.cell)?new Ua({cells:e.cell}):e.cell,null==t.stateSize)throw new _n("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new vr({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){return null==this.states_?wi(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((e=>null)):this.states_}setStates(e){this.states_=e}computeOutputShape(e){cr(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const n=t[0];let i;if(i=this.returnSequences?[e[0],e[1],n]:[e[0],n],this.returnState){const n=[];for(const i of t)n.push([e[0],i]);return[i].concat(n)}return i}computeMask(e,t){return r.tidy((()=>{Array.isArray(t)&&(t=t[0]);const e=this.returnSequences?t:null;if(this.returnState){const t=this.states.map((e=>null));return[e].concat(t)}return e}))}get states(){if(null==this.states_){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}return this.states_}set states(e){this.states_=e}build(e){if(null!=this.numConstants)throw new En("Constants support is not implemented in RNN yet.");cr(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new vr({shape:[t,null,...n]});const i=[e[0]].concat(e.slice(2));let s;if(this.cell.build(i),s=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!r.util.arraysEqual(this.stateSpec.map((e=>e.shape[e.shape.length-1])),s))throw new _n(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=s.map((e=>new vr({shape:[null,e]})));this.stateful&&this.resetStates()}resetStates(e,t=!1){(0,r.tidy)((()=>{if(!this.stateful)throw new kn("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new _n("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((e=>r.zeros([n,e]))):this.states_=[r.zeros([n,this.cell.stateSize])];else if(null==e)r.dispose(this.states_),null!=this.keptStates&&(r.dispose(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((e=>r.zeros([n,e]))):this.states_[0]=r.zeros([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new _n(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);!0===t?this.keptStates.push(this.states_.slice()):r.dispose(this.states_);for(let t=0;t<this.states_.length;++t){const i=e[t],s=Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize,a=[n,s];if(!r.util.arraysEqual(i.shape,a))throw new _n(`State ${t} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[t]=i}}this.states_=this.states_.map((e=>r.keep(e.clone())))}))}apply(e,t){let n=null==t?null:t.initialState,i=null==t?null:t.constants;null==t&&(t={});const r=Na(e,n,i,this.numConstants);e=r.inputs,n=r.initialState,i=r.constants;let s=[],a=[];if(null!=n){t.initialState=n,s=s.concat(n),this.stateSpec=[];for(const e of n)this.stateSpec.push(new vr({shape:e.shape}));a=a.concat(this.stateSpec)}if(null!=i&&(t.constants=i,s=s.concat(i),this.numConstants=i.length),s[0]instanceof br){const n=[e].concat(s),i=this.inputSpec.concat(a),r=this.inputSpec;this.inputSpec=i;const o=super.apply(n,t);return this.inputSpec=r,o}return super.apply(e,t)}call(e,t){return(0,r.tidy)((()=>{const n=null==t?null:t.mask,i=null==t?null:t.training;let r=null==t?null:t.initialState;e=hr(e),null==r&&(r=this.stateful?this.states_:this.getInitialState(e));const s=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(r.length!==s)throw new _n(`RNN Layer has ${s} state(s) but was passed ${r.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:i},o=Ia(((e,t)=>{const n=this.cell.call([e].concat(t),a);return[n[0],n.slice(1)]}),e,r,this.goBackwards,n,null,this.unroll,this.returnSequences),u=o[0],l=o[1],c=o[2];this.stateful&&this.resetStates(c,i);const d=this.returnSequences?l:u;return this.returnState?[d].concat(c):d}))}getInitialState(e){return(0,r.tidy)((()=>{let t=r.zeros(e.shape);return t=r.sum(t,[1,2]),t=ki(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map((e=>e>1?Di(t,[1,e]):t)):this.cell.stateSize>1?[Di(t,[1,this.cell.stateSize])]:[t]}))}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===Ta.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign({},n,e,t)}static fromConfig(e,t,n={}){const i=Br(t.cell,n);return new e(Object.assign(t,{cell:i}))}}Ta.className="RNN",r.serialization.registerClass(Ta);class Ra extends kr{}class Ma extends Ra{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Vn(this.units,"units"),this.activation=ta(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=sr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=sr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=sr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=oa(e.kernelRegularizer),this.recurrentRegularizer=oa(e.recurrentRegularizer),this.biasRegularizer=oa(e.biasRegularizer),this.kernelConstraint=ni(e.kernelConstraint),this.recurrentConstraint=ni(e.recurrentConstraint),this.biasConstraint=ni(e.biasConstraint),this.dropout=bi([1,xi([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=bi([1,xi([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=fr(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return(0,r.tidy)((()=>{if(2!==(e=e).length)throw new _n(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let n=e[1];e=e[0];const i=null!=t.training&&t.training;let s;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Wa({ones:()=>r.onesLike(e),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Wa({ones:()=>r.onesLike(n),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,o=this.recurrentDropoutMask;s=Oi(null!=a?r.mul(e,a):e,this.kernel.read()),null!=this.bias&&(s=Ri(s,this.bias.read())),null!=o&&(n=r.mul(n,o));let u=r.add(s,Oi(n,this.recurrentKernel.read()));return null!=this.activation&&(u=this.activation.apply(u)),[u,u]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Qs(this.activation),useBias:this.useBias,kernelInitializer:rr(this.kernelInitializer),recurrentInitializer:rr(this.recurrentInitializer),biasInitializer:rr(this.biasInitializer),kernelRegularizer:sa(this.kernelRegularizer),recurrentRegularizer:sa(this.recurrentRegularizer),biasRegularizer:sa(this.biasRegularizer),activityRegularizer:sa(this.activityRegularizer),kernelConstraint:ei(this.kernelConstraint),recurrentConstraint:ei(this.recurrentConstraint),biasConstraint:ei(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}Ma.className="SimpleRNNCell",r.serialization.registerClass(Ma);class Ba extends Ta{constructor(e){e.cell=new Ma(e),super(e)}call(e,t){return(0,r.tidy)((()=>{null!=this.cell.dropoutMask&&(r.dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(r.dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,i=null==t?null:t.training,s=null==t?null:t.initialState;return super.call(e,{mask:n,training:i,initialState:s})}))}static fromConfig(e,t){return new e(t)}}Ba.className="SimpleRNN",r.serialization.registerClass(Ba);class za extends Ra{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new _n("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Vn(this.units,"units"),this.activation=ta(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ta(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=sr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=sr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=sr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=oa(e.kernelRegularizer),this.recurrentRegularizer=oa(e.recurrentRegularizer),this.biasRegularizer=oa(e.biasRegularizer),this.kernelConstraint=ni(e.kernelConstraint),this.recurrentConstraint=ni(e.recurrentConstraint),this.biasConstraint=ni(e.biasConstraint),this.dropout=bi([1,xi([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=bi([1,xi([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){const t=(e=fr(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return(0,r.tidy)((()=>{if(2!==(e=e).length)throw new _n(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const n=null!=t.training&&t.training;let i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Wa({ones:()=>r.onesLike(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Wa({ones:()=>r.onesLike(i),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,a=this.recurrentDropoutMask;let o,u,l;0<this.dropout&&this.dropout<1&&(e=r.mul(e,s[0]));let c=Oi(e,this.kernel.read());this.useBias&&(c=Ri(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=r.mul(i,a[0]));const d=this.recurrentKernel.read(),[h,f]=r.split(d,[2*this.units,this.units],d.rank-1),p=Oi(i,h),[m,g,y]=r.split(c,3,c.rank-1),[v,b]=r.split(p,2,p.rank-1);o=this.recurrentActivation.apply(r.add(m,v)),u=this.recurrentActivation.apply(r.add(g,b));const x=Oi(r.mul(u,i),f);l=this.activation.apply(r.add(y,x));const w=r.add(r.mul(o,i),r.mul(r.add(1,r.neg(o)),l));return[w,w]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Qs(this.activation),recurrentActivation:Qs(this.recurrentActivation),useBias:this.useBias,kernelInitializer:rr(this.kernelInitializer),recurrentInitializer:rr(this.recurrentInitializer),biasInitializer:rr(this.biasInitializer),kernelRegularizer:sa(this.kernelRegularizer),recurrentRegularizer:sa(this.recurrentRegularizer),biasRegularizer:sa(this.biasRegularizer),activityRegularizer:sa(this.activityRegularizer),kernelConstraint:ei(this.kernelConstraint),recurrentConstraint:ei(this.recurrentConstraint),biasConstraint:ei(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}za.className="GRUCell",r.serialization.registerClass(za);class La extends Ta{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new za(e),super(e)}call(e,t){return(0,r.tidy)((()=>{null!=this.cell.dropoutMask&&(r.dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(r.dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,i=null==t?null:t.training,s=null==t?null:t.initialState;return super.call(e,{mask:n,training:i,initialState:s})}))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}La.className="GRU",r.serialization.registerClass(La);class Pa extends Ra{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Vn(this.units,"units"),this.activation=ta(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ta(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=sr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=sr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=sr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=oa(e.kernelRegularizer),this.recurrentRegularizer=oa(e.recurrentRegularizer),this.biasRegularizer=oa(e.biasRegularizer),this.kernelConstraint=ni(e.kernelConstraint),this.recurrentConstraint=ni(e.recurrentConstraint),this.biasConstraint=ni(e.biasConstraint),this.dropout=bi([1,xi([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=bi([1,xi([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;const n=(e=fr(e))[e.length-1];let i;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const e=this.biasInitializer,n=this.units;i=new((t=class extends Pi{apply(t,i){const r=e.apply([n]),s=(new Ui).apply([n]),a=e.apply([2*n]);return Fi(Fi(r,s),a)}}).className="CustomInit",t)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return(0,r.tidy)((()=>{const n=null!=t.training&&t.training;if(3!==(e=e).length)throw new _n(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let i=e[1];const s=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Wa({ones:()=>r.onesLike(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Wa({ones:()=>r.onesLike(i),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,o=this.recurrentDropoutMask;let u,l,c,d;0<this.dropout&&this.dropout<1&&(e=r.mul(e,a[0]));let h=Oi(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=r.mul(i,o[0])),h=r.add(h,Oi(i,this.recurrentKernel.read())),this.useBias&&(h=Ri(h,this.bias.read()));const[f,p,m,g]=r.split(h,4,h.rank-1);u=this.recurrentActivation.apply(f),l=this.recurrentActivation.apply(p),c=r.add(r.mul(l,s),r.mul(u,this.activation.apply(m))),d=this.recurrentActivation.apply(g);const y=r.mul(d,this.activation.apply(c));return[y,y,c]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Qs(this.activation),recurrentActivation:Qs(this.recurrentActivation),useBias:this.useBias,kernelInitializer:rr(this.kernelInitializer),recurrentInitializer:rr(this.recurrentInitializer),biasInitializer:rr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:sa(this.kernelRegularizer),recurrentRegularizer:sa(this.recurrentRegularizer),biasRegularizer:sa(this.biasRegularizer),activityRegularizer:sa(this.activityRegularizer),kernelConstraint:ei(this.kernelConstraint),recurrentConstraint:ei(this.recurrentConstraint),biasConstraint:ei(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}Pa.className="LSTMCell",r.serialization.registerClass(Pa);class ja extends Ta{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Pa(e),super(e)}call(e,t){return(0,r.tidy)((()=>{null!=this.cell.dropoutMask&&(r.dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(r.dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,i=null==t?null:t.training,s=null==t?null:t.initialState;return super.call(e,{mask:n,training:i,initialState:s})}))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}ja.className="LSTM",r.serialization.registerClass(ja);class Ua extends Ra{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return(0,r.tidy)((()=>{let n=(e=e).slice(1);const i=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?i.push(n.splice(0,e.stateSize.length)):i.push(n.splice(0,1));i.reverse();const r=[];let s;for(let a=0;a<this.cells.length;++a){const o=this.cells[a];n=i[a],s=0===a?[e[0]].concat(n):[s[0]].concat(n),s=o.call(s,t),r.push(s.slice(1))}n=[];for(const e of r.slice().reverse())n.push(...e);return[s[0]].concat(n)}))}build(e){let t;cr(e)&&(e=e[0]),e=e,this.cells.forEach(((n,i)=>{fi(`RNNCell_${i}`,(()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}getConfig(){const e=super.getConfig(),t={cells:this.cells.map((e=>({className:e.getClassName(),config:e.getConfig()})))};return Object.assign({},e,t)}static fromConfig(e,t,n={}){const i=[];for(const e of t.cells)i.push(Br(e,n));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return gr(e)}setWeights(e){const t=[];for(const n of this.cells){const i=n.weights.length,r=e.splice(i);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],r[e]])}yr(t)}}function Wa(e){const{ones:t,rate:n,training:i=!1,count:s=1,dropoutFunc:a}=e,o=()=>null!=a?a(t(),n):Mi(t(),n),u=()=>Bi(o,t,i);return!s||s<=1?r.keep(u().clone()):Array(s).fill(void 0).map(u).map((e=>r.keep(e.clone())))}Ua.className="StackedRNNCells",r.serialization.registerClass(Ua);class Va extends Ta{constructor(e){if(e.unroll)throw new En("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new En("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new vr({ndim:5})]}call(e,t){return r.tidy((()=>{if(null!=this.cell.dropoutMask&&(r.dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(r.dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new _n("ConvRNN2D cell does not support constants");const n=null==t?null:t.mask,i=null==t?null:t.training,s=null==t?null:t.initialState;return super.call(e,{mask:n,training:i,initialState:s})}))}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return r.tidy((()=>{const{stateSize:t}=this.cell,n=e.shape,i=this.computeSingleOutputShape(n),s=[i[0],...i.slice(2)],a=r.zeros(s);return Array.isArray(t)?Array(t.length).fill(a):[a]}))}resetStates(e,t=!1){r.tidy((()=>{if(!this.stateful)throw new kn("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,i=this.computeSingleOutputShape(n),s=[i[0],...i.slice(2)];if(null==n[0])throw new _n("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>r.zeros(s))):this.states_=[r.zeros(s)];else if(null==e)r.dispose(this.states_),null!=this.keptStates&&(r.dispose(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>r.zeros(s))):this.states_[0]=r.zeros(s);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new _n(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):r.dispose(this.states_);for(let t=0;t<this.states_.length;++t){const n=e[t],i=s;if(!r.util.arraysEqual(n.shape,i))throw new _n(`State ${t} is incompatible with layer ${this.name}: expected shape=${i}, received shape=${n.shape}`);this.states_[t]=n}}this.states_=this.states_.map((e=>r.keep(e.clone())))}))}computeSingleOutputShape(e){const{dataFormat:t,filters:n,kernelSize:i,padding:r,strides:s,dilationRate:a}=this.cell,o="channelsFirst"===t,u=e[o?3:2],l=e[o?4:3],c=ma(u,i[0],r,s[0],a[0]),d=ma(l,i[1],r,s[1],a[1]);return[...e.slice(0,2),...o?[n,c,d]:[c,d,n]]}}Va.className="ConvRNN2D";class qa extends Pa{constructor(e){const{filters:t,kernelSize:n,strides:i,padding:r,dataFormat:s,dilationRate:a}=e;super(Object.assign({},e,{units:t})),this.filters=t,Vn(this.filters,"filters"),this.kernelSize=pa(n,2,"kernelSize"),this.kernelSize.forEach((e=>Vn(e,"kernelSize"))),this.strides=pa(i||1,2,"strides"),this.strides.forEach((e=>Vn(e,"strides"))),this.padding=r||"valid",ci(this.padding),this.dataFormat=s||"channelsLast",li(this.dataFormat),this.dilationRate=pa(a||1,2,"dilationRate"),this.dilationRate.forEach((e=>Vn(e,"dilationRate")))}build(e){var t;e=fr(e);const n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new _n(`The channel dimension of the input should be defined. Found ${e[n]}`);const i=e[n],s=this.kernelSize.concat([i,4*this.filters]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){const n=this.biasInitializer,i=this.filters;e=new((t=class extends Pi{apply(e,t){return Si([n.apply([i]),r.ones([i]),n.apply([2*i])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return r.tidy((()=>{if(3!==e.length)throw new _n(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const n=t.training||!1,i=e[0],s=e[1],a=e[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Wa({ones:()=>r.onesLike(i),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,u=(e,t,n)=>t&&t[n]?r.mul(t[n],e):e;let l=u(i,o,0),c=u(i,o,1),d=u(i,o,2),h=u(i,o,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Wa({ones:()=>r.onesLike(s),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const f=this.recurrentDropoutMask;let p=u(s,f,0),m=u(s,f,1),g=u(s,f,2),y=u(s,f,3);const[v,b,x,w]=r.split(this.kernel.read(),4,3),[C,k,A,_]=this.useBias?r.split(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,v,C,this.padding),c=this.inputConv(c,b,k,this.padding),d=this.inputConv(d,x,A,this.padding),h=this.inputConv(h,w,_,this.padding);const[E,S,F,D]=r.split(this.recurrentKernel.read(),4,3);p=this.recurrentConv(p,E),m=this.recurrentConv(m,S),g=this.recurrentConv(g,F),y=this.recurrentConv(y,D);const $=this.recurrentActivation.apply(r.add(l,p)),O=this.recurrentActivation.apply(r.add(c,m)),N=r.add(r.mul(O,a),r.mul($,this.activation.apply(r.add(d,g)))),I=r.mul(this.recurrentActivation.apply(r.add(h,y)),this.activation.apply(N));return[I,I,N]}))}getConfig(){const e=super.getConfig(),{units:t}=e,n=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},n,i)}inputConv(e,t,n,i){const s=r.conv2d(e,t,this.strides,i||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?Ri(s,n,this.dataFormat):s}recurrentConv(e,t){return r.conv2d(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}qa.className="ConvLSTM2DCell",r.serialization.registerClass(qa);class Ga extends Va{constructor(e){const t=new qa(e);super(Object.assign({},e,{cell:t}))}static fromConfig(e,t){return new e(t)}}Ga.className="ConvLSTM2D",r.serialization.registerClass(Ga);class Ha extends kr{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;const t=e.shape,n=[];for(let e=0;e<this.noiseShape.length;++e)n.push(null==this.noiseShape[e]?t[e]:this.noiseShape[e]);return n}call(e,t){return(0,r.tidy)((()=>{this.invokeCallHook(e,t);const n=hr(e);if(0<this.rate&&this.rate<1){const e=null!=t.training&&t.training,i=this.getNoiseShape(n);return Bi((()=>Mi(n,this.rate,i,this.seed)),(()=>n),e)}return e}))}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Ha.className="Dropout",r.serialization.registerClass(Ha);class Xa extends Ha{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}Xa.className="SpatialDropout1D",r.serialization.registerClass(Xa);class Ya extends kr{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Vn(this.units,"units"),this.activation=ta(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=sr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=sr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=ni(e.kernelConstraint),this.biasConstraint=ni(e.biasConstraint),this.kernelRegularizer=oa(e.kernelRegularizer),this.biasRegularizer=oa(e.biasRegularizer),this.activityRegularizer=oa(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){const t=(e=fr(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){const t=(e=fr(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return(0,r.tidy)((()=>{this.invokeCallHook(e,t);const n=hr(e),i=Gn(this.activation.getClassName());let r;return null!=i?r=Oi(n,this.kernel.read(),i,this.bias?this.bias.read():null):(r=Oi(n,this.kernel.read()),null!=this.bias&&(r=Ri(r,this.bias.read())),null!=this.activation&&(r=this.activation.apply(r))),r}))}getConfig(){const e={units:this.units,activation:Qs(this.activation),useBias:this.useBias,kernelInitializer:rr(this.kernelInitializer),biasInitializer:rr(this.biasInitializer),kernelRegularizer:sa(this.kernelRegularizer),biasRegularizer:sa(this.biasRegularizer),activityRegularizer:sa(this.activityRegularizer),kernelConstraint:ei(this.kernelConstraint),biasConstraint:ei(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Ya.className="Dense",r.serialization.registerClass(Ya);class Ka extends kr{constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=fr(e);for(const t of e.slice(1))if(null==t)throw new _n(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],vi(e,1)]}call(e,t){return(0,r.tidy)((()=>{this.invokeCallHook(e,t);let n=hr(e);if("channelsFirst"===this.dataFormat&&n.rank>1){const e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=(0,r.transpose)(n,e)}return function(e){if(e.rank<=1)throw new _n(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);const t=[e.shape[0],vi(e.shape,1)];return r.reshape(e,t)}(n)}))}getConfig(){const e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}Ka.className="Flatten",r.serialization.registerClass(Ka);class Ja extends kr{constructor(e){super(e),this.supportsMasking=!0,this.activation=ta(e.activation)}call(e,t){return(0,r.tidy)((()=>{this.invokeCallHook(e,t);const n=hr(e);return this.activation.apply(n)}))}getConfig(){const e={activation:Qs(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}Ja.className="Activation",r.serialization.registerClass(Ja);class Za extends kr{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return(0,r.tidy)((()=>{return e=hr(e),t=e,n=this.n,(0,r.tidy)((()=>{if(2!==t.shape.length)throw new _n(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);return Di(ki(t,1),[1,n,1])}));var t,n}))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}Za.className="RepeatVector",r.serialization.registerClass(Za);class Qa extends kr{constructor(e){super(e),this.targetShape=e.targetShape;for(let e=0;e<this.targetShape.length;++e)this.isUnknown(this.targetShape[e])&&(this.targetShape[e]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){const n="Total size of new array must be unchanged.",i=t.slice();let r=1,s=null;for(let e=0;e<i.length;++e){const t=i[e];if(this.isUnknown(t)){if(null!==s)throw new _n("Can only specifiy one unknown dimension.");s=e}else r*=t}const a=vi(e);if(null!==s){if(0===r||a%r!=0)throw new _n(n);i[s]=a/r}else if(a!==r)throw new _n(n);return i}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return(0,r.tidy)((()=>{this.invokeCallHook(e,t);const n=hr(e),i=n.shape,s=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return(0,r.reshape)(n,s)}))}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}Qa.className="Reshape",r.serialization.registerClass(Qa);class eo extends kr{constructor(e){if(super(e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=wi(1,e.dims.length+1);if(!r.util.arraysEqual(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new vr({ndim:this.dims.length+1})]}computeOutputShape(e){const t=(e=fr(e)).slice();return this.dims.forEach(((n,i)=>{t[i+1]=e[n]})),t}call(e,t){return(0,r.transpose)(hr(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}eo.className="Permute",r.serialization.registerClass(eo);class to extends kr{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,this.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const n=hr(e);return(0,r.any)((0,r.notEqual)(n,this.maskValue),-1)}call(e,t){return(0,r.tidy)((()=>{this.invokeCallHook(e,t);const n=hr(e),i=(0,r.any)((0,r.notEqual)(n,this.maskValue),-1,!0);return(0,r.mul)(n,(0,r.cast)(i,n.dtype))}))}}to.className="Masking",r.serialization.registerClass(to);class no extends kr{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),null==e.inputLength?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(Nn(e.inputLength))}this.inputDim=e.inputDim,Vn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Vn(this.outputDim,"outputDim"),this.embeddingsInitializer=sr(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=oa(e.embeddingsRegularizer),this.activityRegularizer=oa(e.activityRegularizer),this.embeddingsConstraint=ni(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return(0,r.tidy)((()=>this.maskZero?(e=hr(e),(0,r.notEqual)(e,(0,r.zerosLike)(e))):null))}computeOutputShape(e){if(e=fr(e),null==this.inputLength)return[...e,this.outputDim];const t=Nn(this.inputLength);if(t.length!==e.length-1)throw new _n(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let n=0;for(let i=0;i<t.length;++i){const r=t[i],s=e[i+1];if(null!=r&&null!=s&&r!==s)throw new _n(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);null==r&&(t[n]=s),n++}}return[e[0],...t,this.outputDim]}call(e,t){return(0,r.tidy)((()=>{this.invokeCallHook(e,t);let n=hr(e);"int32"!==n.dtype&&(n=Ci(n,"int32"));const i=Ni(this.embeddings.read(),(0,r.reshape)(n,[n.size]));return(0,r.reshape)(i,fr(this.computeOutputShape(n.shape)))}))}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:rr(this.embeddingsInitializer),embeddingsRegularizer:sa(this.embeddingsRegularizer),activityRegularizer:sa(this.activityRegularizer),embeddingsConstraint:ei(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}no.className="Embedding",r.serialization.registerClass(no);class io extends kr{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new En}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;const n=e.slice(0,e.length-t.length);for(let i=0;i<t.length;++i){const r=e[e.length-t.length+i],s=t[i];if(null==r||null==s||r<0||s<0)n.push(null);else if(1===r)n.push(s);else if(1===s)n.push(r);else{if(r!==s)throw new _n("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(r)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[fr(e)]),(e=e).length<2)throw new _n(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const n of e)null!=n&&null!==n[0]&&t.push(n[0]);if(t=Pn(t),t.length>1)throw new _n(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=null==e[0]?null:e[0].slice(1);for(let t=1;t<e.length;++t){const i=null==e[t]?null:e[t].slice(1);n=this.computeElementwiseOpOutputShape(n,i)}const i=e.map((e=>e.length));-1===e.indexOf(null)&&1===Pn(i).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return(0,r.tidy)((()=>{if(e=e,this.reshapeRequired){const t=[],n=e.map((e=>e.rank));if(-1===n.indexOf(null)){const i=xi(n);for(let n of e){const e=n.rank;for(let t=0;t<i-e;++t)n=ki(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(const i of e){const e=i.rank;if(null==e){const e=i.shape,s=e[0],a=e.slice(1).concat([s]);let o=r.reshape(i,[s].concat(vi(e.slice(1))));o=r.transpose(o,[1,0]),o=r.reshape(o,a),t.push(o),n=!0}else if(e>1){const s=wi(1,e).concat([0]);t.push(r.transpose(i,s)),n=!0}else t.push(i)}let i=this.mergeFunction(t);const s=i.rank;if(n)if(null==s){const e=i.shape,t=e[e.length-1],n=[t].concat(e.slice(0,e.length-1));i=r.reshape(r.transpose(r.reshape(i,[-1,t]),[1,0]),n)}else if(s>1){const e=[s-1].concat(wi(0,s-1));i=r.transpose(i,e)}return i}}return this.mergeFunction(e)}))}computeOutputShape(e){let t;t=null==(e=e)[0]?null:e[0].slice(1);for(let n=1;n<e.length;++n){const i=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let n=[];for(const t of e)null!=t&&null!==t[0]&&n.push(t[0]);return n=Pn(n),t=1===n.length?n.concat(t):[null].concat(t),t}computeMask(e,t){return r.tidy((()=>{if(null==t)return null;if(!Array.isArray(t))throw new _n("`mask` should be an Array");if(!Array.isArray(e))throw new _n("`inputs` should be an Array");if(t.length!==e.length)throw new _n(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every((e=>null==e)))return null;let n=(t=t.map((e=>null==e?e:r.expandDims(e,0))))[0];for(let e=1;e<t.length-1;++e)n=r.logicalAnd(n,t[e]);return n}))}}class ro extends io{constructor(e){super(e)}mergeFunction(e){return(0,r.tidy)((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=r.add(t,e[n]);return t}))}}ro.className="Add",r.serialization.registerClass(ro);class so extends io{constructor(e){super(e)}mergeFunction(e){return(0,r.tidy)((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=r.mul(t,e[n]);return t}))}}so.className="Multiply",r.serialization.registerClass(so);class ao extends io{constructor(e){super(e)}mergeFunction(e){return(0,r.tidy)((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=r.add(t,e[n]);return r.mul(1/e.length,t)}))}}ao.className="Average",r.serialization.registerClass(ao);class oo extends io{constructor(e){super(e)}mergeFunction(e){return(0,r.tidy)((()=>{let t=e[0];for(let n=1;n<e.length;++n)t=r.maximum(t,e[n]);return t}))}}oo.className="Maximum",r.serialization.registerClass(oo);class uo extends io{constructor(e){super(e)}mergeFunction(e){return(0,r.tidy)((()=>{let t=e[0];for(let n=1;n<e.length;++n)t=r.minimum(t,e[n]);return t}))}}uo.className="Minimum",r.serialization.registerClass(uo);class lo extends io{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new _n("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const n of e)if(null!=n){t=!1;break}if(t)return;const n=[];for(let t=0;t<e.length;++t){const i=e[t].slice();i.splice(this.axis,1);let s=!1;for(const e of n)if(r.util.arraysEqual(e,i)){s=!0;break}s||n.push(i)}if(n.length>1)throw new _n("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return(0,r.tidy)((()=>Si(e,this.axis)))}computeOutputShape(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new _n("A `Concatenate` layer should be called on a list of inputs.");const t=e,n=t[0].slice(),i=this.axis<0?n.length+this.axis:this.axis;for(const e of t.slice(1)){if(null==n[i]||null==e[i]){n[i]=null;break}n[i]+=e[i]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new _n("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new _n("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new _n(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return r.tidy((()=>{let n=!0;if(t.forEach((e=>{null==e||(n=!1)})),n)return null;const i=[];for(let n=0;n<e.length;++n)null==t[n]?i.push(r.cast(r.onesLike(e[n]),"bool")):t[n].rank<e[n].rank?i.push(r.expandDims(t[n],-1)):i.push(t[n]);const s=r.concat(i,this.axis);return r.all(s,-1,!1)}))}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function co(e,t){for(;e<0;)e+=t;return e}lo.className="Concatenate",r.serialization.registerClass(lo);class ho extends io{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){r.util.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const t=e[0],n=e[1];if(t.length>3||n.length>3)throw new En("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(t,n);if(t[i[0]]!==n[i[1]])throw new _n(`Dimension incompatibility: ${t[i[0]]} !== ${n[i[1]]}`)}mergeFunction(e){if(2!==e.length)throw new _n(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t,n=e[0],i=e[1];return t=Array.isArray(this.axes)?this.axes.map(((t,n)=>co(t,e[n].shape.length))):[co(this.axes,n.shape.length),co(this.axes,i.shape.length)],this.normalize&&(n=zr(n,t[0]),i=zr(i,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new En("batchDot is not implemented for tensors of 4D or higher rank yet");if(r.util.assert(e.shape.length>=2,(()=>`batchDot requires the rank of x to be >= 2, but got ${e.shape.length}`)),r.util.assert(e.shape.length>=2,(()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`)),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new En("batchDot is not implemented for complex64-type Tensors yet.");const i=e.shape.length,s=t.shape.length;null==n&&(n=[i-1,s-2]);const a=n;return r.tidy((()=>{let n,o;if(i>s){n=i-s;const e=[];for(let t=0;t<n;++t)e.push(1);t=r.reshape(t,t.shape.concat(e))}else if(s>i){n=s-i;const t=[];for(let e=0;e<n;++e)t.push(1);e=r.reshape(e,e.shape.concat(t))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=a[0]===a[1]?r.sum(r.mul(e,t),a[0]):r.sum(r.mul(r.transpose(e,[1,0]),t),a[1]);else{const n=a[0]!==e.shape.length-1,i=a[1]===t.shape.length-1;o=r.matMul(e,t,n,i)}if(n>0){let e;e=i>s?i+s-3:i-1;const t=[];for(let i=e;i<e+n;++i)t.push(i);o=r.squeeze(o,t)}return 1===o.shape.length&&(o=r.expandDims(o,1)),o}))}(n,i,t)}interpretAxes(e,t){let n;return n=Array.isArray(this.axes)?this.axes:[co(this.axes,e.length),co(this.axes,t.length)],n}computeOutputShape(e){r.util.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new En("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(t,n);t.splice(i[0],1),n.splice(i[1],1),n.splice(0,1);const s=t.concat(n);return 1===s.length&&s.push(1),s}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}ho.className="Dot",r.serialization.registerClass(ho);class fo extends kr{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return(0,r.tidy)((()=>{this.invokeCallHook(e,t);const n=hr(e);return Bi((()=>(0,r.add)($i(n.shape,0,this.stddev),n)),(()=>n),t.training||!1)}))}}fo.className="GaussianNoise",r.serialization.registerClass(fo);class po extends kr{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return(0,r.tidy)((()=>{this.invokeCallHook(e,t);const n=hr(e);return this.rate>0&&this.rate<1?Bi((()=>{const e=Math.sqrt(this.rate/(1-this.rate));return(0,r.mul)(n,$i(n.shape,1,e))}),(()=>n),t.training||!1):n}))}}po.className="GaussianDropout",r.serialization.registerClass(po);class mo extends kr{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||hr(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return(0,r.tidy)((()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e);return Bi((()=>{const t=hr(e),i=-1.7580993408473766;let s=(0,r.greaterEqual)((0,r.randomUniform)(n),this.rate);s=Ci(s,"float32");const a=((1-this.rate)*(1+this.rate*i**2))**-.5,o=-a*i*this.rate,u=(0,r.add)((0,r.mul)(t,s),(0,r.mul)((0,r.add)(s,-1),i));return(0,r.add)((0,r.mul)(u,a),o)}),(()=>hr(e)),t.training||!1)}return e}))}}function go(e,t,n,i,s,a=.001){let o;if(2===e.rank)o=r.batchNorm2d(e,t,n,i,s,a);else if(3===e.rank)o=r.batchNorm3d(e,t,n,i,s,a);else{if(4!==e.rank)throw new En(`batchNormalization is not implemented for array of rank ${e.rank} yet`);o=r.batchNorm4d(e,t,n,i,s,a)}return o}mo.className="AlphaDropout",r.serialization.registerClass(mo);class yo extends kr{constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=sr(e.betaInitializer||"zeros"),this.gammaInitializer=sr(e.gammaInitializer||"ones"),this.movingMeanInitializer=sr(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=sr(e.movingVarianceInitializer||"ones"),this.betaConstraint=ni(e.betaConstraint),this.gammaConstraint=ni(e.gammaConstraint),this.betaRegularizer=oa(e.betaRegularizer),this.gammaRegularizer=oa(e.gammaRegularizer)}build(e){e=fr(e);const t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new _n(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new vr({ndim:e.length,axes:{[t]:n}})];const i=[n];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return(0,r.tidy)((()=>{const n=null!=t.training&&t.training,i=hr(e),s=i.shape,a=s.length,o=wi(0,a),u=this.axis>=0?this.axis:this.axis+a;o.splice(u,1);const l=Fn(1,a);l[u]=s[u];const c=o.slice();c.sort();const d=!r.util.arraysEqual(c,wi(0,a).slice(0,a-1));if(!n)return(()=>{if(d){const e=(0,r.reshape)(this.movingMean.read(),l),t=(0,r.reshape)(this.movingVariance.read(),l),n=this.center?(0,r.reshape)(this.beta.read(),l):null,s=this.scale?(0,r.reshape)(this.gamma.read(),l):null;return go(i,e,t,n,s,this.epsilon)}return go(i,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[h,f,p]=function(e,t,n,i,s=.001){return r.util.arraysEqual(i.slice().sort(),wi(0,e.rank-1))?function(e,t,n,i,s=.001){return(0,r.tidy)((()=>{const a=r.moments(e,i),o=a.mean,u=a.variance;return[go(e,o,u,n,t,s),o,u]}))}(e,t,n,i,s):function(e,t,n,i,s=.001){return(0,r.tidy)((()=>{const a=r.moments(e,i),o=a.mean,u=a.variance,l=[];for(const t of wi(0,e.rank))-1!==i.indexOf(t)?l.push(1):l.push(e.shape[t]);const c=(0,r.reshape)(o,l),d=(0,r.reshape)(u,l),h=null==t?null:(0,r.reshape)(t,l),f=null==n?null:(0,r.reshape)(n,l);return[go(e,c,d,f,h,s),o,u]}))}(e,t,n,i,s)}(i,this.gamma.read(),this.beta.read(),o,this.epsilon),m=(e,t,n)=>{r.tidy((()=>{const i=1-n,s=e.read(),a=r.mul(r.sub(s,t),i);e.write(r.sub(s,a))}))};return(()=>{m(this.movingMean,f,this.momentum),m(this.movingVariance,p,this.momentum)})(),h}))}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:rr(this.betaInitializer),gammaInitializer:rr(this.gammaInitializer),movingMeanInitializer:rr(this.movingMeanInitializer),movingVarianceInitializer:rr(this.movingVarianceInitializer),betaRegularizer:sa(this.betaRegularizer),gammaRegularizer:sa(this.gammaRegularizer),betaConstraint:ei(this.betaConstraint),gammaConstraint:ei(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}yo.className="BatchNormalization",r.serialization.registerClass(yo);class vo extends kr{constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else{if(!Array.isArray(this.axis))throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);for(const e of this.axis)if(!Number.isInteger(e))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=sr(e.betaInitializer||"zeros"),this.gammaInitializer=sr(e.gammaInitializer||"ones"),this.betaRegularizer=oa(e.betaRegularizer),this.gammaRegularizer=oa(e.gammaRegularizer),this.supportsMasking=!0}build(e){const t=(e=fr(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let e=0;e<this.axis.length;++e)this.axis[e]<0&&(this.axis[e]+=t);for(const e of this.axis)if(e<0||e>=t)throw new Error(`Invalid axis: ${e}`);if(this.axis.length!==Pn(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const n=this.axis.map((t=>e[t]));this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0}call(e,t){const n=hr(e),i=n.shape,s=i.length;return(0,r.tidy)((()=>{let{mean:e,variance:t}=(0,r.moments)(n,this.axis,!0);const a=Fn(1,s);for(const e of this.axis)a[e]=i[e];const o=e=>null!=e&&e.shape.length!==s?r.reshape(e,a):e;let u=o(this.gamma.read()),l=o(this.beta.read());const c=[],d=[];for(let e=0;e<s;++e)-1!==this.axis.indexOf(e)?(c.push(i[e]),d.push(1)):(c.push(1),d.push(i[e]));return e=r.tile(e,c),t=r.tile(t,c),u=r.tile(u,d),l=r.tile(l,d),go(n,e,t,l,u,this.epsilon)}))}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:rr(this.betaInitializer),gammaInitializer:rr(this.gammaInitializer),betaRegularizer:sa(this.betaRegularizer),gammaRegularizer:sa(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}vo.className="LayerNormalization",r.serialization.registerClass(vo);class bo extends kr{constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new _n(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,n;if("number"==typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new _n(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],2!==e.padding[1].length)throw new _n(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new vr({ndim:4})]}computeOutputShape(e){let t,n;return e=fr(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return(0,r.tidy)((()=>{return t=hr(e),n=this.padding,i=this.dataFormat,(0,r.tidy)((()=>{if(4!==t.rank)throw new _n(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new _n("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==i&&(i="channelsLast"),"channelsLast"!==i&&"channelsFirst"!==i)throw new _n(`Unknown data format: ${i}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let e;return e="channelsFirst"===i?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],r.pad(t,e)}));var t,n,i}))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}function xo(e,t,n,i,s,a){return(0,r.tidy)((()=>{let o;li(s),di(a),ci(i),null==n&&(n=[1,1]),null==i&&(i="valid"),null==s&&(s="channelsLast"),null==a&&(a="max"),e=ya(e,s);const u="same"===i?"same":"valid";return o="max"===a?r.maxPool(e,t,n,u):r.avgPool(e,t,n,u),"channelsFirst"===s&&(o=r.transpose(o,[0,3,1,2])),o}))}function wo(e,t,n,i,s,a){return(0,r.tidy)((()=>{let o;li(s),di(a),ci(i),null==n&&(n=[1,1,1]),null==i&&(i="valid"),null==s&&(s="channelsLast"),null==a&&(a="max"),e=va(e,s);const u="same"===i?"same":"valid";return o="max"===a?r.maxPool3d(e,t,n,u):r.avgPool3d(e,t,n,u),"channelsFirst"===s&&(o=r.transpose(o,[0,4,1,2,3])),o}))}bo.className="ZeroPadding2D",r.serialization.registerClass(bo);class Co extends kr{constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"==typeof e.poolSize)this.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new _n(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);this.poolSize=e.poolSize}if(Vn(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"==typeof e.strides)this.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new _n(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);this.strides=e.strides}Vn(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,ci(this.padding),this.inputSpec=[new vr({ndim:3})]}computeOutputShape(e){const t=ma((e=fr(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return(0,r.tidy)((()=>{this.invokeCallHook(e,t),e=ki(hr(e),2);const n=this.poolingFunction(hr(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return r.squeeze(n,[2])}))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class ko extends Co{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return li(r),ci(i),xo(e,t,n,i,r,"max")}}ko.className="MaxPooling1D",r.serialization.registerClass(ko);class Ao extends Co{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return li(r),ci(i),xo(e,t,n,i,r,"avg")}}Ao.className="AveragePooling1D",r.serialization.registerClass(Ao);class _o extends kr{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new _n(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Vn(this.poolSize,"poolSize"),Vn(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,li(this.dataFormat),ci(this.padding),this.inputSpec=[new vr({ndim:4})]}computeOutputShape(e){e=fr(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=ma(t,this.poolSize[0],this.padding,this.strides[0]),n=ma(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return(0,r.tidy)((()=>(this.invokeCallHook(e,t),this.poolingFunction(hr(e),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class Eo extends _o{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return li(r),ci(i),xo(e,t,n,i,r,"max")}}Eo.className="MaxPooling2D",r.serialization.registerClass(Eo);class So extends _o{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return li(r),ci(i),xo(e,t,n,i,r,"avg")}}So.className="AveragePooling2D",r.serialization.registerClass(So);class Fo extends kr{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new _n(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Vn(this.poolSize,"poolSize"),Vn(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,li(this.dataFormat),ci(this.padding),this.inputSpec=[new vr({ndim:5})]}computeOutputShape(e){e=fr(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],i="channelsFirst"===this.dataFormat?e[4]:e[3];return t=ma(t,this.poolSize[0],this.padding,this.strides[0]),n=ma(n,this.poolSize[1],this.padding,this.strides[1]),i=ma(i,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,i]:[e[0],t,n,i,e[4]]}call(e,t){return(0,r.tidy)((()=>(this.invokeCallHook(e,t),this.poolingFunction(hr(e),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class Do extends Fo{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return li(r),ci(i),wo(e,t,n,i,r,"max")}}Do.className="MaxPooling3D",r.serialization.registerClass(Do);class $o extends Fo{constructor(e){super(e)}poolingFunction(e,t,n,i,r){return li(r),ci(i),wo(e,t,n,i,r,"avg")}}$o.className="AveragePooling3D",r.serialization.registerClass($o);class Oo extends kr{constructor(e){super(e),this.inputSpec=[new vr({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new En}}class No extends Oo{constructor(e){super(e||{})}call(e,t){return(0,r.tidy)((()=>{const t=hr(e);return r.mean(t,1)}))}}No.className="GlobalAveragePooling1D",r.serialization.registerClass(No);class Io extends Oo{constructor(e){super(e||{})}call(e,t){return(0,r.tidy)((()=>{const t=hr(e);return r.max(t,1)}))}}Io.className="GlobalMaxPooling1D",r.serialization.registerClass(Io);class To extends kr{constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,li(this.dataFormat),this.inputSpec=[new vr({ndim:4})]}computeOutputShape(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new En}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class Ro extends To{call(e,t){return(0,r.tidy)((()=>{const t=hr(e);return"channelsLast"===this.dataFormat?r.mean(t,[1,2]):r.mean(t,[2,3])}))}}Ro.className="GlobalAveragePooling2D",r.serialization.registerClass(Ro);class Mo extends To{call(e,t){return(0,r.tidy)((()=>{const t=hr(e);return"channelsLast"===this.dataFormat?r.max(t,[1,2]):r.max(t,[2,3])}))}}Mo.className="GlobalMaxPooling2D",r.serialization.registerClass(Mo);class Bo extends kr{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,n={}){const i=Br(t.layer,n);delete t.layer;const r={layer:i};return Object.assign(r,t),new e(r)}}class zo extends Bo{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=fr(e)).length<3)throw new _n(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){const t=[(e=fr(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),i=e[1];return[n[0],i].concat(n.slice(1))}call(e,t){return(0,r.tidy)((()=>Ia(((e,n)=>[hr(this.layer.call(e,t)),[]]),e=hr(e),[],!1,null,null,!1,!0)[1]))}}zo.className="TimeDistributed",r.serialization.registerClass(zo);class Lo extends Bo{constructor(e){super(e);const t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=Br(n),t.goBackwards=!0!==t.goBackwards;const i={};var r;if(i.className=e.layer.getClassName(),i.config=t,this.backwardLayer=Br(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,r=this.mergeMode,Un(oi,"BidirectionalMergeMode",r),e.weights)throw new En("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t,n,i,r=this.forwardLayer.computeOutputShape(e);return Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r,this.returnState?(i=r.slice(1),t=r[0]):t=r[0],t=t,"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(i).concat(i.slice()):[t].concat(i).concat(i.slice()):On(n)}apply(e,t){let n=null==t?null:t.initialState,i=null==t?null:t.constants;null==t&&(t={});const r=Na(e,n,i,this.numConstants);if(e=r.inputs,n=r.initialState,i=r.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==i)return super.apply(e,t);const s=[],a=[];if(null!=n){const e=n.length;if(e%2>0)throw new _n("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,s.push(...n);const i=n.map((e=>new vr({shape:e.shape})));this.forwardLayer.stateSpec=i.slice(0,e/2),this.backwardLayer.stateSpec=i.slice(e/2),a.push(...i)}if(null!=i)throw new En("Support for constants in Bidirectional layers is not implemented yet.");const o=s[0]instanceof br;for(const e of s)if(e instanceof br!==o)throw new _n("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(o){const n=[e].concat(s),i=this.inputSpec.concat(a),r=this.inputSpec;this.inputSpec=i;const o=super.apply(n,t);return this.inputSpec=r,o}return super.apply(e,t)}call(e,t){return(0,r.tidy)((()=>{const n=t.initialState;let i,s,a,o;if(null==n)i=this.forwardLayer.call(e,t),s=this.backwardLayer.call(e,t);else{const r=n.slice(0,n.length/2),a=n.slice(n.length/2);i=this.forwardLayer.call(e,Object.assign(t,{initialState:r})),s=this.backwardLayer.call(e,Object.assign(t,{initialState:a}))}return this.returnState&&(Array.isArray(i)&&(a=i.slice(1).concat(s.slice(1))),i=i[0],s=s[0]),this.returnSequences&&(s=r.reverse(s,1)),"concat"===this.mergeMode?o=Si([i,s]):"sum"===this.mergeMode?o=r.add(i,s):"ave"===this.mergeMode?o=r.mul(.5,r.add(i,s)):"mul"===this.mergeMode?o=r.mul(i,s):null==this.mergeMode&&(o=[i,s]),this.returnState?null==this.mergeMode?o.concat(a):[o].concat(a):o}))}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){fi(this.forwardLayer.name,(()=>{this.forwardLayer.build(e)})),fi(this.backwardLayer.name,(()=>{this.backwardLayer.build(e)})),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){const e=this.forwardLayer.states.map((e=>null));return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const n=Br(t.layer);if(delete t.layer,null!=t.numConstants)throw new En("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=t;return i.layer=n,new e(i)}}Lo.className="Bidirectional",r.serialization.registerClass(Lo);var Po,jo,Uo=n(4355),Wo=n(521);function Vo(e,t,n=new Map,i=new Set){if(null==e)return null;if("function"==typeof Blob&&e instanceof Blob)return e.slice();if(i.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);const r=t(e);if(r.recurse&&null!==r.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(r.recurse){if(Xo(e)){const r=Array.isArray(e)?[]:{};i.add(e);for(const s in e){const a=Vo(e[s],t,n,i);r[s]=a}return i.delete(e),e.__proto__&&(r.__proto__=e.__proto__),r}throw new Error(`Can't recurse into non-iterable type: ${e}`)}return n.set(e,r.value),r.value}function qo(e,t=Ho){return Go(e,t)}function Go(e,t,n=new Set){const i=e[0];if(n.has(i))throw new Error("Circular references are not supported.");const r=t(e);if(r.recurse&&null!==r.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(r.recurse){if(Xo(i)){const r=Array.isArray(i)?[]:{};n.add(i);for(const s in i){const i=Go(e.map((e=>e[s])),t,n);r[s]=i}return n.delete(i),r}throw new Error(`Can't recurse into non-iterable type: ${i}`)}return r.value}function Ho(e){return null===e?null:Xo(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function Xo(e){let t=!1;if(r.env().get("IS_BROWSER"))t=e instanceof TextDecoder;else{const{StringDecoder:i}=n(9182);t=e instanceof i}return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof r.Tensor)&&!(e instanceof Promise)&&!t)}function Yo(e){return Vo(e,Ko)}function Ko(e){return e instanceof r.Tensor?{value:e.clone(),recurse:!1}:Xo(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}class Jo{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}class Zo extends Jo{constructor(){super(Zo.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=2*this.capacity,t=new Array(e),n=this.length();for(let e=0;e<n;e++)t[e]=this.get(this.wrap(this.begin+e));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}Zo.INITIAL_CAPACITY=32;class Qo{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new uu(this,e)}filter(e){return new au(this,e)}map(e){return new ou(this,e)}mapAsync(e){return new lu(this,e)}serialMapAsync(e){return new lu(this,e).serial()}flatmap(e){return new du(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile((e=>!0===e))}rowMajorBatch(e,t=!0){return new su(this,e,t)}columnMajorBatch(e,t=!0,n=Ho){return this.rowMajorBatch(e,t).map((e=>qo(e,n)))}concatenate(e,t){return new hu(new eu([this,e]),t)}take(e){return e<0||null==e?this:new ru(this,e)}skip(e){return e<0||null==e?this:new iu(this,e)}prefetch(e){return new fu(this,e)}shuffle(e,t){return new pu(this,e,t)}serial(){return new nu(this)}}class eu extends Qo{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:Yo(e),done:!1}}}class tu extends Qo{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}}class nu extends Qo{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){return this.upstream.next()}}class iu extends Qo{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;r.dispose(e.value)}return this.upstream.next()}}class ru extends Qo{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class su extends Qo{constructor(e,t,n=!0){super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class au extends Qo{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;r.dispose(e.value)}}}class ou extends Qo{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Map`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=r.tensor_util.getTensorsInContainer(e.value),n=this.transform(e.value),i=r.tensor_util.getTensorsInContainer(n);for(const e of t)r.tensor_util.isTensorInList(e,i)||e.dispose();return{value:n,done:!1}}}class uu extends Qo{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class lu extends Qo{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=r.tensor_util.getTensorsInContainer(e.value),n=await this.transform(e.value),i=r.tensor_util.getTensorsInContainer(n);for(const e of t)r.tensor_util.isTensorInList(e,i)||e.dispose();return{value:n,done:!1}}}class cu extends Qo{constructor(){super(),this.outputQueue=new Zo,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class du extends cu{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=r.tensor_util.getTensorsInContainer(e.value),n=this.transform(e.value),i=r.tensor_util.getTensorsInContainer(n);this.outputQueue.pushAll(n);for(const e of t)r.tensor_util.isTensorInList(e,i)||e.dispose();return!0}}class hu extends Qo{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,null==this.iterator){const e=await this.moreIterators.next();if(e.done)return{value:null,done:!0};this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}(jo=Po||(Po={}))[jo.FAIL=0]="FAIL",jo[jo.SHORTEST=1]="SHORTEST",jo[jo.LONGEST=2]="LONGEST";class fu extends Qo{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new Jo(t)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class pu extends fu{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=Wo.alea(n||r.util.now().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(!t.done)return this.refill(),t;this.upstreamExhausted=!0}return{value:null,done:!0}}}class mu{constructor(){this.size=null}batch(e,t=!0){const n=this;let i;return r.util.assert(e>0,(()=>`batchSize needs to be positive, but it is\n      ${e}`)),i=this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e),gu((async()=>(await n.iterator()).columnMajorBatch(e,t,yu)),i)}concatenate(e){const t=this;let n;return n=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,gu((async()=>(await t.iterator()).concatenate(await e.iterator())),n)}filter(e){const t=this;let n;return n=this.size===1/0?1/0:null,gu((async()=>(await t.iterator()).filter((t=>r.tidy((()=>e(t)))))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return gu((async()=>(await t.iterator()).map((t=>r.tidy((()=>e(t)))))),this.size)}mapAsync(e){const t=this;return gu((async()=>(await t.iterator()).mapAsync(e)),this.size)}prefetch(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return gu((async()=>(await t.iterator()).prefetch(e)),this.size)}repeat(e){const t=this;let n;return n=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,gu((async()=>{return n=(r=async()=>({value:await t.iterator(),done:!1}),new tu(r)).take(e),new hu(n,i);var n,i,r}),n)}skip(e){const t=this;let n;return n=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,gu((async()=>(await t.iterator()).skip(e)),n)}shuffle(e,t,n=!0){if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const i=this,s=Wo.alea(t||r.util.now().toString());return gu((async()=>{let t=s.int32();return n&&(t+=s.int32()),(await i.iterator()).shuffle(e,t.toString())}),this.size)}take(e){const t=this;let n;return n=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,gu((async()=>(await t.iterator()).take(e)),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function gu(e,t=null){return new class extends mu{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function yu(e){if(null===e)return null;return null==(t=e[0])||null===(n=t)||"object"!=typeof n&&"function"!=typeof n||Array.isArray(t)||"object"==typeof t&&t instanceof r.Tensor||r.util.isTypedArray(t)?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof r.Tensor?r.stack(e):r.tensor(e)}(e),recurse:!1}:{value:null,recurse:!0};var t,n}mu.MAX_BUFFER_SIZE=1e4,Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote"),n(8834).Buffer;var vu=n(9914);const bu={},xu={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function wu(e){if(!(e in bu)){const t=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(t=>{t.preventDefault(),delete bu[e]}),!1),1===e?t.getContext("webgl",xu)||t.getContext("experimental-webgl",xu):t.getContext("webgl2",xu)}(e);if(null===t)return console.log("Could not get context for WebGL version",e),null;bu[e]=t}const t=bu[e];return t.isContextLost()?(delete bu[e],wu(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),bu[e])}var Cu,ku,Au;function _u(e,t){return[t,e]}function Eu(e){const t=r.util.sizeFromShape(e),n=Math.ceil(t/4);return r.util.sizeToSquarishShape(n)}function Su(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Fu(e,t){const n=e;let i,s,a,o,u,l,c,d,h,f;return 2===(0,r.env)().getNumber("WEBGL_VERSION")?(i=n.R32F,s=n.R16F,a=n.RGBA16F,o=n.RGBA32F,u=n.RED,c=4,d=1,h=n.HALF_FLOAT,f=n.FLOAT):(i=e.RGBA,s=e.RGBA,a=e.RGBA,o=n.RGBA,u=e.RGBA,c=4,d=4,h=null!=t?t.HALF_FLOAT_OES:null,f=e.FLOAT),l=e.RGBA,{internalFormatFloat:i,internalFormatHalfFloat:s,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:o,textureFormatFloat:u,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:d,textureTypeHalfFloat:h,textureTypeFloat:f}}function Du(e,t){const n=t();return(0,r.env)().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}(e,t))}(e),n}function $u(e){return!!((0,r.env)().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Ou(e,t){return Lu(e,(()=>e.getExtension(t)),'Extension "'+t+'" not supported on this browser.')}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Cu||(Cu={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(ku||(ku={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Au||(Au={}));const Nu=/ERROR: [0-9]+:([0-9]+):/g;function Iu(e,t){if(Du(e,(()=>e.validateProgram(t))),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function Tu(e,t,n,i,r,s,a){const o=e.getAttribLocation(t,n);return-1!==o&&(Du(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,i))),Du(e,(()=>e.vertexAttribPointer(o,r,e.FLOAT,!1,s,a))),Du(e,(()=>e.enableVertexAttribArray(o))),!0)}function Ru(e,t,n,i){Du(e,(()=>function(e,t,n){(function(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,i=t+e.TEXTURE0;if(i<e.TEXTURE0||i>n)throw new Error(`textureUnit must be in [gl.TEXTURE0, gl.TEXTURE${n}].`)})(e,n),Du(e,(()=>e.activeTexture(e.TEXTURE0+n))),Du(e,(()=>e.bindTexture(e.TEXTURE_2D,t)))}(e,t,i))),Du(e,(()=>e.uniform1i(n,i)))}function Mu(e,t,n){Du(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,n))),Du(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)))}function Bu(e,t){Du(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,t))),Du(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)))}function zu(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}(e,t))}function Lu(e,t,n){const i=Du(e,(()=>t()));if(null==i)throw new Error(n);return i}function Pu(e,t=2){return r.util.sizeFromShape(e.slice(0,e.length-t))}function ju(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Uu(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Pu(e),...ju(e)]),t}function Wu(e){return e%2==0}function Vu(e,t){if(e=e.slice(-2),t=t.slice(-2),r.util.arraysEqual(e,t))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e.slice(-1)[0],i=t.slice(-1)[0];if(n===i)return!0;if(Wu(n)&&Wu(i)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Wu(e[0])&&Wu(t[0])}let qu,Gu;function Hu(e,t){return null!=e.getExtension(t)}function Xu(e){try{if(null!=wu(e))return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function Yu(e){const t=Fu(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const r=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(i),r}function Ku(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&r.util.assert("complex64"!==e.dtype,(()=>`${t} does not support complex64 tensors in the WebGL backend.`))}))}const Ju=(0,r.env)();function Zu(){let e,t,n,i,s,a,o,u,l,c;return 2===(0,r.env)().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",i="in",s="texture",a="outputColor",o="out vec4 outputColor;",u="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",l="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",i="varying",s="texture2D",a="gl_FragColor",o="",u="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:i,texture2D:s,output:a,defineOutput:o,defineSpecialNaN:u,defineSpecialInf:l,defineRound:c}}function Qu(e,t,n="index"){const i=r.util.computeStrides(t);return i.map(((t,r)=>`int ${e[r]} = ${n} / ${t}; ${r===i.length-1?`int ${e[r+1]} = ${n} - ${e[r]} * ${t}`:`index -= ${e[r]} * ${t}`};`)).join("")}function el(e,t,n="index"){const i=r.util.computeStrides(t);return i.map(((t,r)=>`int ${e[r]} = ${n} / outShapeStrides[${r}]; ${r===i.length-1?`int ${e[r+1]} = ${n} - ${e[r]} * outShapeStrides[${r}]`:`index -= ${e[r]} * outShapeStrides[${r}]`};`)).join("")}function tl(e){const t=r.util.computeStrides(e).map((e=>e.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;\n  }\n`}Ju.registerFlag("HAS_WEBGL",(()=>Ju.getNumber("WEBGL_VERSION")>0)),Ju.registerFlag("WEBGL_VERSION",(()=>Xu(2)?2:Xu(1)?1:0)),Ju.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),Ju.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===Ju.get("WEBGL_VERSION"))),Ju.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),Ju.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),Ju.registerFlag("WEBGL_PACK",(()=>Ju.getBool("HAS_WEBGL"))),Ju.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>Ju.getBool("WEBGL_PACK"))),Ju.registerFlag("WEBGL_PACK_CLIP",(()=>Ju.getBool("WEBGL_PACK"))),Ju.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>Ju.getBool("WEBGL_PACK"))),Ju.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>Ju.getBool("WEBGL_PACK"))),Ju.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>Ju.getBool("WEBGL_PACK"))),Ju.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>Ju.getBool("WEBGL_PACK"))),Ju.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>Ju.getBool("WEBGL_PACK"))),Ju.registerFlag("WEBGL_PACK_REDUCE",(()=>Ju.getBool("WEBGL_PACK"))),Ju.registerFlag("WEBGL_LAZILY_UNPACK",(()=>Ju.getBool("WEBGL_PACK"))),Ju.registerFlag("WEBGL_CONV_IM2COL",(()=>Ju.getBool("WEBGL_PACK"))),Ju.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>function(e){if(null==qu){const t=wu(e);qu=t.getParameter(t.MAX_TEXTURE_SIZE)}return qu}(Ju.getNumber("WEBGL_VERSION")))),Ju.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>function(e){if(null==Gu){const t=wu(e);Gu=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Gu)}(Ju.getNumber("WEBGL_VERSION")))),Ju.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const e=Ju.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;let t;const n=wu(e);return t=Hu(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Hu(n,"EXT_disjoint_timer_query")?1:0,t}(e)})),Ju.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>Ju.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!r.device_util.isMobile())),Ju.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>function(e){if(0===e)return!1;const t=wu(e);if(1===e){if(!Hu(t,"OES_texture_float"))return!1}else if(!Hu(t,"EXT_color_buffer_float"))return!1;return Yu(t)}(Ju.getNumber("WEBGL_VERSION")))),Ju.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!Ju.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ju.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),Ju.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>function(e){if(0===e)return!1;const t=wu(e);if(1!==e){if(Hu(t,"EXT_color_buffer_float"))return Yu(t);const e="EXT_color_buffer_half_float";if(Hu(t,e)){const n=t.getExtension(e);return function(e,t){const n=Fu(e,t),i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0);const s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(i),e.deleteFramebuffer(r),s}(t,n)}return!1}return!!Hu(t,"OES_texture_float")&&!!Hu(t,"WEBGL_color_buffer_float")&&Yu(t)}(Ju.getNumber("WEBGL_VERSION")))),Ju.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>{return 2===(e=Ju.getNumber("WEBGL_VERSION"))&&null!=wu(e).fenceSync;var e})),Ju.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>Ju.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),Ju.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)})),Ju.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>r.device_util.isMobile()?1:-1),(e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)})),Ju.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),Ju.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),Ju.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),Ju.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128));const nl="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:il}=r.backend_util;function rl(e,t,n){const i=[];if(e.forEach((e=>{const t=r.util.sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?i.push(`uniform float ${e.name}${t>1?`[${t}]`:""};`):(i.push(`uniform sampler2D ${e.name};`),i.push(`uniform int offset${e.name};`)),n.enableShapeUniforms){const{uniformShape:t}=pl(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:i.push(`uniform int ${e.name}Shape;`);break;case 2:i.push(`uniform ivec2 ${e.name}Shape;`);break;case 3:i.push(`uniform ivec3 ${e.name}Shape;`);break;case 4:i.push(`uniform ivec4 ${e.name}Shape;`)}i.push(`uniform ivec2 ${e.name}TexShape;`)}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:i.push("uniform int outShape;");break;case 2:i.push("uniform ivec2 outShape;"),i.push("uniform int outShapeStrides;");break;case 3:i.push("uniform ivec3 outShape;"),i.push("uniform ivec2 outShapeStrides;");break;case 4:i.push("uniform ivec4 outShape;"),i.push("uniform ivec3 outShapeStrides;")}i.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((e=>{i.push(`uniform ${e.type} ${e.name}${e.arrayIndex?`[${e.arrayIndex}]`:""};`)}));const s=i.join("\n"),a=e.map((e=>function(e,t,n=!1,i){let s="";s+=n?al(e,i):sl(e,i);const a=e.shapeInfo.logicalShape,o=t.logicalShape;return a.length<=o.length&&(s+=n?function(e,t){const n=e.name,i=n.charAt(0).toUpperCase()+n.slice(1),s="get"+i+"AtOutCoords",a=e.shapeInfo.logicalShape.length,o=t.logicalShape.length,u=il(e.shapeInfo.logicalShape,t.logicalShape),l=fl(o),c=o-a;let d;const h=["x","y","z","w","u","v"];d=0===a?"":o<2&&u.length>=1?"coords = 0;":u.map((e=>`coords.${h[e+c]} = 0;`)).join("\n");let f="";f=o<2&&a>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>`coords.${h[t+c]}`)).join(", ");let p="return outputValue;";const m=1===r.util.sizeFromShape(e.shapeInfo.logicalShape),g=1===r.util.sizeFromShape(t.logicalShape);if(1!==a||m||g){if(m&&!g)p=1===o?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){const e=a-2,t=a-1;u.indexOf(e)>-1&&u.indexOf(t)>-1?p="return vec4(outputValue.x);":u.indexOf(e)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(t)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${s}() {\n      ${l} coords = getOutputCoords();\n      ${d}\n      vec4 outputValue = get${i}(${f});\n      ${p}\n    }\n  `}(e,t):function(e,t){const n=e.name,i=n.charAt(0).toUpperCase()+n.slice(1),s="get"+i+"AtOutCoords",a=t.texShape,o=e.shapeInfo.texShape,u=e.shapeInfo.logicalShape.length,l=t.logicalShape.length;if(!e.shapeInfo.isUniform&&u===l&&null==e.shapeInfo.flatOffset&&r.util.arraysEqual(o,a))return`\n      float ${s}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const c=fl(l),d=il(e.shapeInfo.logicalShape,t.logicalShape),h=l-u;let f;const p=["x","y","z","w","u","v"];f=0===u?"":l<2&&d.length>=1?"coords = 0;":d.map((e=>`coords.${p[e+h]} = 0;`)).join("\n");let m="";return m=l<2&&u>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>`coords.${p[t+h]}`)).join(", "),`\n    float ${s}() {\n      ${c} coords = getOutputCoords();\n      ${f}\n      return get${i}(${m});\n    }\n  `}(e,t)),s}(e,t,n.packedInputs,n.enableShapeUniforms))).join("\n"),o=t.texShape,u=Zu(),l=function(e){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${e.texture2D}(textureSampler, uv).r;\n    }\n  `}(u);let c,d,h=function(e){return`${e.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${e.varyingFs} vec2 resultUV;\n    ${e.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${e.defineSpecialNaN}\n    ${e.defineSpecialInf}\n    ${e.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${ol}\n    ${ul}\n    ${ll}\n  `}(u);return t.isPacked?(c=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===i[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${i[1]}.0);\n      }\n    `:1===i[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${i[0]}.0);\n      }\n    `:n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${i[0]}, ${i[1]}));\n      return 2 * (resTexRC.x * ${i[1]} + resTexRC.y);\n    }\n  `}(0,t,n);case 2:return function(e,t,n){const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(r.util.arraysEqual(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${i[0]}, ${i[1]}));\n      }\n    `;const s=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${i[0]}, ${i[1]}));\n\n      int index = resTexRC.x * ${i[1]} + resTexRC.y;\n      int r = 2 * (index / ${s});\n      int c = imod(index, ${s}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),s=r*Math.ceil(e[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${i[0]}, ${i[1]}));\n      int index = resTexRC.x * ${i[1]} + resTexRC.y;\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${r});\n      int c = imod(index, ${r}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),s=r*Math.ceil(e[e.length-2]/2);let a=s,o="",u="b, r, c";for(let t=2;t<e.length-1;t++)a*=e[e.length-t-1],o=`\n      int b${t} = index / ${a};\n      index -= b${t} * ${a};\n    `+o,u=`b${t}, `+u;return`\n    ivec${e.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${i[0]}, ${i[1]}));\n      int index = resTexRC.x * ${i[1]} + resTexRC.y;\n\n      ${o}\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${r});\n      int c = imod(index, ${r}) * 2;\n\n      return ivec${e.length}(${u});\n    }\n  `}(e,t,n)}}(t.logicalShape,o,n.enableShapeUniforms),d=function(e){return`\n    void setOutput(vec4 val) {\n      ${e.output} = val;\n    }\n  `}(u)):(c=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.x * ${t[1]}.0);\n      }\n    `:1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.y * ${t[0]}.0);\n      }\n    `:n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      return resTexRC.x * ${t[1]} + resTexRC.y;\n    }\n  `}(0,t,n);case 2:return function(e,t,n){return r.util.arraysEqual(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));\n      }\n    `:1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `:1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `:n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      int r = index / ${e[1]};\n      int c = index - r * ${e[1]};\n      return ivec2(r, c);\n    }\n  `}(e,t,n);case 3:return function(e,t,n){if(n)return`\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ${el(["r","c","d"],e)}\n    return ivec3(r, c, d);\n  }\n`;const i=Qu(["r","c","d"],e);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${i}\n      return ivec3(r, c, d);\n    }\n  `}(e,t,n);case 4:return function(e,t,n){if(n)return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ${el(["r","c","d","d2"],e)}\n      return ivec4(r, c, d, d2);\n    }\n  `;const i=Qu(["r","c","d","d2"],e);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${i}\n      return ivec4(r, c, d, d2);\n    }\n  `}(e,t,n);case 5:return function(e,t){const n=Qu(["r","c","d","d2","d3"],e);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},\n                             ${t[1]}));\n\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(e,t);case 6:return function(e,t){const n=Qu(["r","c","d","d2","d3","d4"],e);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}(t.logicalShape,o,n.enableShapeUniforms),d=function(e){return`\n    void setOutput(float val) {\n      ${e.output} = vec4(val, 0, 0, 0);\n    }\n  `}(u)),n.packedInputs&&(h+=cl),[h,l,d,s,c,a,n.userCode].join("\n")}function sl(e,t=!1){const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){const n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${i}() {return ${n};}`;const[r,s]=e.shapeInfo.texShape;if(1===r&&1===s)return`\n      float ${i}() {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const a=dl(n);if(t)return`\n    float ${i}() {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `;const[o,u]=e.shapeInfo.texShape;return`\n    float ${i}() {\n      vec2 uv = uvFromFlat(${o}, ${u}, ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `}(e,t);case 1:return function(e,t){const n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`\n      float ${i}(int index) {\n        ${hl(e)}\n      }\n    `;const r=e.shapeInfo.texShape,s=r[0],a=r[1];if(1===a&&1===s)return`\n      float ${i}(int index) {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const o=dl(n);return 1===a?t?`\n      float ${i}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / float(${n}TexShape[0]));\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${i}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${s}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:1===s?t?`\n      float ${i}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / float(${n}TexShape[1]), 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${i}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${a}.0, 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:t?`\n    float ${i}(int index) {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `:`\n    float ${i}(int index) {\n      vec2 uv = uvFromFlat(${s}, ${a}, index + ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),a=e.shapeInfo.texShape;if(null!=a&&r.util.arraysEqual(n,a)){if(t)return`\n      float ${s}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);\n        return sampleTexture(${i}, uv);\n      }\n    `;const e=a[0];return`\n    float ${s}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${a[1]}.0, ${e}.0);\n      return sampleTexture(${i}, uv);\n    }\n  `}const{newShape:o,keptDims:u}=r.util.squeezeShape(n),l=o;if(l.length<n.length){const n=["row","col"];return`\n      ${sl(ml(e,l),t)}\n      float ${s}(int row, int col) {\n        return ${s}(${gl(n,u)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${s}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${hl(e)}\n      }\n    `;const c=a[0],d=a[1],h=dl(i);return 1===d?t?`\n      float ${s}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${i}Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(${i}TexShape[0]));\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n    float ${s}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);\n      return sampleTexture(${i}, uv);\n    }\n  `:1===c?t?`\n      float ${s}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${i}Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(${i}TexShape[1]), 0.5);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n    float ${s}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);\n      return sampleTexture(${i}, uv);\n    }\n  `:t?`\n      float ${s}(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${i}Shape[1] + col + ${h};\n        vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n  float ${s}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${h};\n    vec2 uv = uvFromFlat(${c}, ${d}, index);\n    return sampleTexture(${i}, uv);\n  }\n`}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[1]*n[2],o=n[2],{newShape:u,keptDims:l}=r.util.squeezeShape(n),c=u;if(c.length<n.length){const n=["row","col","depth"];return`\n        ${sl(ml(e,c),t)}\n        float ${s}(int row, int col, int depth) {\n          return ${s}(${gl(n,l)});\n        }\n      `}if(e.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${a}, ${o}, 1)));\n        ${hl(e)}\n      }\n    `;const d=e.shapeInfo.texShape,h=d[0],f=d[1],p=e.shapeInfo.flatOffset;if(f===a&&null==p)return t?`\n      float ${s}(int row, int col, int depth) {\n        int stride1 = ${i}Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${i}TexShape[1], ${i}TexShape[0]);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n        float ${s}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${o}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${f}.0, ${h}.0);\n          return sampleTexture(${i}, uv);\n        }\n      `;if(f===o&&null==p)return t?`\n      float ${s}(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(${i}Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n    float ${s}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${h}.0);\n      return sampleTexture(${i}, uv);\n    }\n  `;const m=dl(i);return t?`\n    float ${s}(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ${i}Shape[1] * ${i}Shape[2];\n      int stride1 = ${i}Shape[2];\n      int index = row * ${a} + col * ${o} + depth + ${m};\n      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);\n      return sampleTexture(${i}, uv);\n    }\n    `:`\n      float ${s}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${a} + col * ${o} + depth + ${m};\n        vec2 uv = uvFromFlat(${h}, ${f}, index);\n        return sampleTexture(${i}, uv);\n      }\n  `}(e,t);case 4:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[3],o=n[2]*a,u=n[1]*o,{newShape:l,keptDims:c}=r.util.squeezeShape(n);if(l.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${sl(ml(e,l),t)}\n      float ${s}(int row, int col, int depth, int depth2) {\n        return ${s}(${gl(n,c)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${u}, ${o}, ${a}, 1)));\n        ${hl(e)}\n      }\n    `;const d=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,f=h[0],p=h[1],m=`int stride2 = ${i}Shape[3];`,g=`int stride1 = ${i}Shape[2] * stride2;`,y=`int stride0 = ${i}Shape[1] * stride1;`;if(p===u&&null==d)return t?`\n      float ${s}(int row, int col, int depth, int depth2) {\n        ${m}\n        ${g}\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${i}TexShape[1], ${i}TexShape[0]);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n      float ${s}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${o}, ${a}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${f}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `;if(p===a&&null==d)return t?`\n      float ${s}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${i}Shape[1] * ${i}Shape[2], ${i}Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${i}TexShape[1], ${i}TexShape[0]);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n      float ${s}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${f}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `;const v=dl(i);return t?`\n    float ${s}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ${m}\n      ${g}\n      ${y}\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index + ${v});\n      return sampleTexture(${i}, uv);\n    }\n  `:`\n    float ${s}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${u} + col * ${o} +\n          depth * ${a} + depth2;\n      vec2 uv = uvFromFlat(${f}, ${p}, index + ${v});\n      return sampleTexture(${i}, uv);\n    }\n  `}(e,t);case 5:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t[4],a=t[3]*s,o=t[2]*a,u=t[1]*o,{newShape:l,keptDims:c}=r.util.squeezeShape(t);if(l.length<t.length){const t=["row","col","depth","depth2","depth3"];return`\n      ${sl(ml(e,l))}\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        return ${i}(${gl(t,c)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${u}, ${o}, ${a}, ${s})) +\n          depth3;\n        ${hl(e)}\n      }\n    `;const d=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,f=h[0],p=h[1];if(p===u&&null==d)return`\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${o}, ${a}, ${s}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${f}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(p===s&&null==d)return`\n      float ${i}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]},\n               ${t[2]*t[3]}, ${t[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${f}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;return`\n    float ${i}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${u} + col * ${o} + depth * ${a} +\n          depth2 * ${s} + depth3 + ${dl(n)};\n      vec2 uv = uvFromFlat(${f}, ${p}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(e);case 6:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:s,keptDims:a}=r.util.squeezeShape(t);if(s.length<t.length){const t=["row","col","depth","depth2","depth3","depth4"];return`\n      ${sl(ml(e,s))}\n      float ${i}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${i}(${gl(t,a)});\n      }\n    `}const o=t[5],u=t[4]*o,l=t[3]*u,c=t[2]*l,d=t[1]*c;if(e.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${d}, ${c}, ${l}, ${u})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${o}, 1)));\n        ${hl(e)}\n      }\n    `;const h=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,p=f[0],m=f[1];if(m===d&&null==h)return`\n      float ${i}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${c}, ${l}, ${u}, ${o})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${m}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(m===o&&null==h)return`\n      float ${i}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]*t[4]},\n               ${t[2]*t[3]*t[4]},\n               ${t[3]*t[4]},\n               ${t[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${m}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;return`\n    float ${i}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${d} + col * ${c} + depth * ${l} +\n          depth2 * ${u} + depth3 * ${o} + depth4 + ${dl(n)};\n      vec2 uv = uvFromFlat(${p}, ${m}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function al(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name;return`\n    vec4 ${"get"+t.charAt(0).toUpperCase()+t.slice(1)}() {\n      return ${Zu().texture2D}(${t}, halfCR);\n    }\n  `}(e);case 1:return function(e,t){const n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e.shapeInfo.texShape,s=Zu();if(t)return`\n    vec4 ${i}(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `;const a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`\n    vec4 ${i}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${a[0]}, ${a[1]}, index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),a=e.shapeInfo.texShape,o=a[0],u=a[1],l=Zu();if(null!=a&&r.util.arraysEqual(n,a))return t?`\n      vec4 ${s}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);\n\n        return ${l.texture2D}(${i}, uv);\n      }\n    `:`\n      vec4 ${s}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${u}.0, ${o}.0);\n\n        return ${l.texture2D}(${i}, uv);\n      }\n    `;if(t)return`\n    vec4 ${s}(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${i}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ${l.texture2D}(${i}, uv);\n    }\n  `;const c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`\n    vec4 ${s}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${Math.ceil(n[1]/2)}, ${c[0]}, ${c[1]}, row, col);\n      return ${l.texture2D}(${i}, uv);\n    }\n  `}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,i=e.name,r="get"+i.charAt(0).toUpperCase()+i.slice(1),s=e.shapeInfo.texShape,a=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(1===n[0]){const i=[1,2],s=["b","row","col"];return`\n        ${al(ml(e,n.slice(1)),t)}\n        vec4 ${r}(int b, int row, int col) {\n          return ${r}(${gl(s,i)});\n        }\n      `}const o=Zu();if(t)return`\n    vec4 ${r}(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${i}Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${i}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ${o.texture2D}(${i}, uv);\n    }\n  `;const u=a[0],l=a[1],c=Math.ceil(n[2]/2);return`\n    vec4 ${r}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${u}, ${l}, ${c*Math.ceil(n[1]/2)}, ${c}, b, row, col);\n      return ${o.texture2D}(${i}, uv);\n    }\n  `}(e,t);default:return function(e,t){const n=e.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),r=Zu();if(t)return`\n    vec4 ${i}(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ${n}Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);\n    }\n  `;const s=e.shapeInfo.logicalShape,a=s.length,o=e.shapeInfo.texShape,u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],l=u[0],c=u[1],d=Math.ceil(s[a-1]/2);let h=d*Math.ceil(s[a-2]/2),f="int b, int row, int col",p=`b * ${h} + (row / 2) * ${d} + (col / 2)`;for(let e=2;e<a-1;e++)f=`int b${e}, `+f,h*=s[a-e-1],p=`b${e} * ${h} + `+p;return`\n    vec4 ${i}(${f}) {\n      int index = ${p};\n      int texR = index / ${c};\n      int texC = index - texR * ${c};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${l});\n      return ${r.texture2D}(${n}, uv);\n    }\n  `}(e,t)}}const ol="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ul="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ll="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",cl="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function dl(e){return`offset${e}`}function hl(e){const t=e.name,n=r.util.sizeFromShape(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${t}[i];\n      }\n    }\n  `}function fl(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function pl(e,t,n){const{newShape:i,keptDims:s}=r.util.squeezeShape(t),a=t.length,o=e&&3===a&&1===t[0],u=o?t.slice(1):i,l=!e&&a>1&&!r.util.arraysEqual(t,n)&&i.length<a||o;return{useSqueezeShape:l,uniformShape:l?u:t,keptDims:s}}function ml(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function gl(e,t){return t.map((t=>e[t])).join(", ")}function yl(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach(((e,n)=>{const i=e.logicalShape,s=t[n],a=s.shape;if(!r.util.arraysEqual(i,a))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${a} must match`);if(e.isUniform&&s.isUniform)return;const o=e.texShape,u=s.isUniform?null:s.texData.texShape;if(!r.util.arraysEqual(o,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${o} and ${u} must match`)}))}function vl(e){return(0,r.env)().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}class bl{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Cu.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Zu();this.outputShape=e,this.enableShapeUniforms=vl(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?el(["r","c","d"],e):Qu(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${t.output} = result;\n      }\n    `}}class xl{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Cu.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Zu();this.outputShape=e,this.enableShapeUniforms=vl(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?el(["r","c","d"],e):Qu(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${t.output} = result;\n      }\n    `}}class wl{constructor(e){this.variableNames=["A"],this.outTexUsage=ku.DOWNLOAD;const t=Zu();this.outputShape=e,this.userCode=`\n      ${nl}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${t.output} = encode_float(x);\n      }\n    `}}class Cl{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ku.DOWNLOAD;const t=Zu();this.outputShape=e,this.userCode=`\n      ${nl}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${t.output} = encode_float(x);\n      }\n    `}}class kl{constructor(e,t=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Zu();this.outputShape=e,this.enableShapeUniforms=vl(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)"),this.userCode=`\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":tl(e)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ${n.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${n.output} = vec4(${i}, 0., 0., 0.);\n      }\n    `}}class Al{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Zu();this.outputShape=e,this.enableShapeUniforms=vl(this.outputShape.length);let i="",r="result";t&&(r="floor(result * 255. + 0.5)");for(let t=0;t<=1;t++)for(let r=0;r<=1;r++){const s=2*t+r;i+=`\n          localCoords = coords;\n          if(localCoords[2] + ${r} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {\n          localCoords[2] += ${r};\n          if (localCoords[1] + ${t} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {\n            localCoords[1] += ${t};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${s}] = values[0];\n            } else if (offset == 1) {\n              result[${s}] = values[1];\n            } else if (offset == 2) {\n              result[${s}] = values[2];\n            } else {\n              result[${s}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":tl(e)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${i}\n\n          ${n.output} = ${r};\n        }\n    `}}function _l(e,t,n,i,s,a){!function(e,t){const n=(0,r.env)().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error(`Requested texture size [${e}x${t}] is invalid.`);if(e>n||t>n)throw new Error(`Requested texture size [${e}x${t}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(t,n);const o=function(e){return Lu(e,(()=>e.createTexture()),"Unable to create WebGLTexture.")}(e),u=e.TEXTURE_2D;return Du(e,(()=>e.bindTexture(u,o))),Du(e,(()=>e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE))),Du(e,(()=>e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))),Du(e,(()=>e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST))),Du(e,(()=>e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST))),Du(e,(()=>e.texImage2D(u,0,i,t,n,0,s,a,null))),Du(e,(()=>e.bindTexture(e.TEXTURE_2D,null))),o}function El(e){return e.internalFormatFloat}function Sl(e){return e.internalFormatHalfFloat}function Fl(e){return e.downloadTextureFormat}function Dl(e){return e.internalFormatPackedFloat}function $l(e){return e.internalFormatPackedHalfFloat}class Ol{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const t=(0,r.env)().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,function(e,t){bu[e]=t}(t,e)):this.gl=wu(t);let n="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(1===(0,r.env)().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=Ou(this.gl,e),Hu(this.gl,t))this.textureHalfFloatExtension=Ou(this.gl,t);else if((0,r.env)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Hu(this.gl,i))this.colorBufferHalfFloatExtension=Ou(this.gl,i);else if((0,r.env)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Hu(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Hu(this.gl,i))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(i)}this.vertexBuffer=function(e){return function(e,t){const n=Lu(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return Du(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),Du(e,(()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW))),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function(e){return function(e,t){const n=Lu(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return Du(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n))),Du(e,(()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW))),n}(e,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(e){return Lu(e,(()=>e.createFramebuffer()),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=Fu(this.gl,this.textureHalfFloatExtension)}get debug(){return(0,r.env)().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Du(e,(()=>e.finish())),Du(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,null))),Du(e,(()=>e.deleteFramebuffer(this.framebuffer))),Du(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,null))),Du(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null))),Du(e,(()=>e.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=_u(t,n);return _l(e,r,s,El(i),i.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=_u(t,n);return _l(e,r,s,Sl(i),i.textureFormatFloat,i.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=_u(t,n);return _l(e,r,s,Fl(i),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){Du(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),n.data instanceof Uint8Array?Du(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data))):Du(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n))),Du(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,i){this.throwIfDisposed(),function(e,t,n,i,r,s){let a,o,u;Du(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),r instanceof Uint8Array?(a=new Uint8Array(n*i*4),o=e.UNSIGNED_BYTE,u=e.RGBA):(a=new Float32Array(n*i*4),o=e.FLOAT,u=s.internalFormatPackedFloat),a.set(r),Du(e,(()=>e.texImage2D(e.TEXTURE_2D,0,u,n,i,0,e.RGBA,o,a))),Du(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}(this.gl,e,t,n,i,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=Su(t,n);return _l(e,r,s,$l(i),e.RGBA,i.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,i){const[r,s]=Su(t,n);return _l(e,r,s,Dl(i),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(Bu(this.gl,this.framebuffer),this.outputTexture=null),Du(this.gl,(()=>this.gl.deleteTexture(e)))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>function(e,t,n,i){const[r,s]=_u(t,n),a=new Uint8Array(t*n*4);return Du(e,(()=>e.readPixels(0,0,r,s,i.downloadTextureFormat,e.UNSIGNED_BYTE,a))),new Float32Array(a.buffer)}(this.gl,t,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(e,t,n,i,r,s){return function(e,t,n,i,r,s,a,o){const u=e,l=new Float32Array(function(e,t){const[n,i]=Su(e,t);return n*i*4}(s,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}(this.gl,e,0,0,0,r,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){const i=e,r=new Float32Array(n);return i.bindBuffer(i.PIXEL_PACK_BUFFER,t),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,r),i.bindBuffer(i.PIXEL_PACK_BUFFER,null),r}(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const i=function(e,t,n,i){const r=e.createBuffer();Du(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,r)));const s=16*t*n;return Du(e,(()=>e.bufferData(e.PIXEL_PACK_BUFFER,s,e.STREAM_READ))),Du(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0))),Du(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null))),r}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if((0,r.env)().getBool("WEBGL_FENCE_API_ENABLED")){const i=e,r=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=i.clientWaitSync(r,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=r}else(0,r.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,(0,r.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>function(e,t,n){const i=new Float32Array(t*n*4);return Du(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,i))),i}(this.gl,t,n)))}createProgram(e){this.throwIfDisposed();const t=this.gl,n=function(e,t){const n=Lu(e,(()=>e.createShader(e.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(Du(e,(()=>e.shaderSource(n,t))),Du(e,(()=>e.compileShader(n))),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){const n=Nu.exec(t);if(null==n)return console.log(`Couldn't parse line number in error: ${t}`),void console.log(e);const i=+n[1],s=e.split("\n"),a=s.length.toString().length+2,o=s.map(((e,t)=>r.util.rightPad((t+1).toString(),a)+e));let u=0;for(let e=0;e<o.length;e++)u=Math.max(o[e].length,u);const l=o.slice(0,i-1),c=o.slice(i-1,i),d=o.slice(i);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log(`%c ${r.util.rightPad(c[0],u)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(t,e);null==this.vertexShader&&(this.vertexShader=function(e){const t=Zu();return function(e,t){const n=Lu(e,(()=>e.createShader(e.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(Du(e,(()=>e.shaderSource(n,t))),Du(e,(()=>e.compileShader(n))),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,`${t.version}\n    precision highp float;\n    ${t.attribute} vec3 clipSpacePos;\n    ${t.attribute} vec2 uv;\n    ${t.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}(t));const i=function(e){return Lu(e,(()=>e.createProgram()),"Unable to create WebGLProgram.")}(t);return Du(t,(()=>t.attachShader(i,this.vertexShader))),Du(t,(()=>t.attachShader(i,n))),function(e,t){if(Du(e,(()=>e.linkProgram(t))),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,i),this.debug&&Iu(t,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=function(e,t,n){return Du(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),Tu(e,t,"clipSpacePos",n,3,20,0)&&Tu(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),i}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Du(this.gl,(()=>this.gl.deleteProgram(e)))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&Iu(this.gl,this.program),Du(this.gl,(()=>this.gl.useProgram(e)))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?function(e,t,n){return Lu(e,(()=>e.getUniformLocation(t,n)),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Du(this.gl,(()=>this.gl.getAttribLocation(e,t)))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),Ru(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[i,r]=Su(t,n);this.setOutputMatrixTextureDriver(e,i,r)}setOutputMatrixWriteRegion(e,t,n,i){this.setOutputMatrixWriteRegionDriver(n,e,i,t)}setOutputPackedMatrixWriteRegion(e,t,n,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&Iu(this.gl,this.program),zu(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;this.debug&&this.debugValidate(),Du(e,(()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Du(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Ou(this.gl,2===(0,r.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===(0,r.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===(0,r.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await r.util.repeatedTry((()=>this.disposed||this.isQueryAvailable(e,(0,r.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(e,(0,r.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),i=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),i&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise((t=>{this.addItemToPoll((()=>e.isFencePassed()),(()=>t()))}))}pollItems(){const e=function(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((e=>e.isDoneFn)));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||r.util.repeatedTry((()=>(this.pollItems(),0===this.itemsToPoll.length)))}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Mu(this.gl,e,this.framebuffer),this.debug&&zu(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(Mu(this.gl,this.outputTexture,this.framebuffer),this.debug&&zu(this.gl)):Bu(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const i=this.gl;Mu(i,e,this.framebuffer),this.debug&&zu(i),this.outputTexture=e,Du(i,(()=>i.viewport(0,0,t,n))),Du(i,(()=>i.scissor(0,0,t,n)))}setOutputMatrixWriteRegionDriver(e,t,n,i){this.throwIfDisposed(),Du(this.gl,(()=>this.gl.scissor(e,t,n,i)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}var Nl=n(3526),Il=n(3862),Tl=n(6301),Rl=n(2646),Ml=n(796),Bl=n(3721),zl=n(840),Ll=n(2550),Pl=n(6152),jl=n(6645),Ul=n(2595),Wl=n(1826),Vl=n(2680),ql=n(3629),Gl=n(8288),Hl=n(8269),Xl=n(8956),Yl=n(6727),Kl=n(9223),Jl=n(2563),Zl=n(2820),Ql=n(2376),ec=n(2874),tc=n(6914),nc=n(9318),ic=n(6989),rc=n(4790),sc=n(9162),ac=n(1041),oc=n(3541),uc=n(7917),lc=n(3911),cc=n(3670),dc=n(1442),hc=n(5741),fc=n(659),pc=n(8259),mc=n(2916),gc=n(7594),yc=n(3407),vc=n(1355),bc=n(5366);const{addImpl:xc,bincountImpl:wc,bincountReduceImpl:Cc,ceilImpl:kc,concatImpl:Ac,equalImpl:_c,expImpl:Ec,expm1Impl:Sc,floorImpl:Fc,gatherNdImpl:Dc,gatherV2Impl:$c,greaterImpl:Oc,greaterEqualImpl:Nc,lessImpl:Ic,lessEqualImpl:Tc,linSpaceImpl:Rc,logImpl:Mc,maxImpl:Bc,maximumImpl:zc,minimumImpl:Lc,multiplyImpl:Pc,negImpl:jc,notEqualImpl:Uc,prodImpl:Wc,rangeImpl:Vc,rsqrtImpl:qc,sigmoidImpl:Gc,simpleAbsImpl:Hc,sliceImpl:Xc,sparseFillEmptyRowsImpl:Yc,sparseReshapeImpl:Kc,sparseSegmentReductionImpl:Jc,sqrtImpl:Zc,stridedSliceImpl:Qc,stringNGramsImpl:ed,stringSplitImpl:td,stringToHashBucketFastImpl:nd,subImpl:id,tileImpl:rd,topKImpl:sd,transposeImpl:ad,uniqueImpl:od}=i;function ud(e,t){return["x","y","z","w","u","v"].slice(0,t).map((t=>`${e}.${t}`))}function ld(e,t){return 1===t?[e]:ud(e,t)}class cd{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;const t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const n=ld("rc",t),i=fl(t),r=function(e,t,n){if(1===e)return`rc > ${t[0]}`;let i="";for(let r=e-2;r<e;r++)i+=`${n[r]} >= ${t[r]}`,r<e-1&&(i+="||");return i}(t,e,n),s=function(e,t,n,i){if(1===e)return"";const r=i.slice(-2);return`\n    int r = ${r[0]};\n    int c = ${r[1]};\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ${t};\n    bool rEdge = rp1 >= ${n};\n  `}(t,e[e.length-1],e[e.length-2],n),a=function(e,t){const n=e.length,i=function(e,t){const n=[];for(let i=0;i<=1;i++)for(let r=0;r<=1;r++){let s=`${0===i?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let n=2;n<e;n++)s=`${t[t.length-1-n]},`+s;n.push(s)}return n}(n,t);return 1===n?`getA(rc),\n            rc + 1 >= ${e[0]} ? 0. : getA(rc + 1),\n            0, 0`:`getA(${i[0]}),\n          cEdge ? 0. : getA(${i[1]}),\n          rEdge ? 0. : getA(${i[2]}),\n          rEdge || cEdge ? 0. : getA(${i[3]})`}(e,n);this.userCode=`\n        void main() {\n          ${i} rc = getOutputCoords();\n\n          if(${r}) {\n            setOutput(vec4(0));\n          } else {\n            ${s}\n\n            setOutput(vec4(${a}));\n          }\n        }\n      `}}}class dd{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=vl(this.outputShape.length);let n="";for(let e=0;e<4;e++){let t="thisRC = rc;";e%2==1&&(t+="thisRC.z += 1;"),e>1&&(t+="thisRC.y += 1;"),n+=`\n        ${t}\n        ${e>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${e}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${e>0?"}":""}\n      `}var i,r;this.userCode=`\n      ${i=t,r=this.enableShapeUniforms,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${r?function(e,t,n="index"){const i=function(e,t){const n=e.length,i=e.map((e=>`${t}[${e}]`)),r=new Array(n-1);r[n-2]=i[n-1];for(let e=n-3;e>=0;--e)r[e]=`(${r[e+1]} * ${i[e+1]})`;return r}(e.map(((e,t)=>t)),t);return i.map(((t,r)=>`int ${e[r]} = ${n} / ${i[r]}; ${r===i.length-1?`int ${e[r+1]} = ${n} - ${e[r]} * ${i[r]}`:`index -= ${e[r]} * ${i[r]}`};`)).join("")}(["r","c","d"],"inputShape"):Qu(["r","c","d"],i)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":tl(e)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};\n        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class hd{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,t,n){const i=pd(t,n),r=md(e,i,n);r in this.freeTextures||(this.freeTextures[r]=[]),r in this.usedTextures||(this.usedTextures[r]=[]);const s=fd(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[r].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();const e=this.freeTextures[r].shift();return this.usedTextures[r].push(e),e}let a;return i===Au.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===Au.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===Au.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===Au.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===Au.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[r].push(a),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),a}releaseTexture(e,t,n,i){if(null==this.freeTextures)return;const s=pd(n,i),a=md(t,s,i);a in this.freeTextures||(this.freeTextures[a]=[]);const o=fd(t,s,this.gpgpu.gl,this.gpgpu.textureConfig,i),u=(0,r.env)().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==u&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e),this._numBytesAllocated-=o):(this.freeTextures[a].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;const l=this.usedTextures[a],c=l.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(c,1),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e)}));for(const e in this.usedTextures)this.usedTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function fd(e,t,n,i,r){const s=function(e,t){switch(e){case Au.PACKED_2X2_FLOAT32:return Dl(t);case Au.PACKED_2X2_FLOAT16:return $l(t);case Au.UNPACKED_FLOAT32:return El(t);case Au.UNPACKED_FLOAT16:return Sl(t);case Au.PACKED_4X1_UNSIGNED_BYTE:return Fl(t);default:throw new Error(`Unknown physical texture type ${e}`)}}(t,i);let a;if(r){const[t,n]=Su(e[0],e[1]);a=t*n}else{const[t,n]=_u(e[0],e[1]);a=t*n}return a*function(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;throw new Error(`Unknown internal format ${t}`)}(n,s)}function pd(e,t){if(e===ku.UPLOAD)return Au.PACKED_2X2_FLOAT32;if(e===ku.RENDER||null==e)return function(e){return(0,r.env)().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Au.PACKED_2X2_FLOAT32:Au.UNPACKED_FLOAT32:e?Au.PACKED_2X2_FLOAT16:Au.UNPACKED_FLOAT16}(t);if(e===ku.DOWNLOAD||e===ku.PIXELS)return Au.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function md(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}class gd{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=vl(this.outputShape.length),this.userCode=`\n      float unaryOperation(float x) {\n        ${t}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const yd="return abs(x);",vd="return x;";class bd{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=vl(this.outputShape.length),this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${t}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}class xd{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;const t=e.length,n=ld("rc",t),i=fl(t),r=function(e,t){if(1===e)return"rc";let n="";for(let i=0;i<e;i++)n+=t[i],i<e-1&&(n+=",");return n}(t,n),s=n.slice(-2),a=t<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`\n      void main() {\n        ${i} rc = getOutputCoords();\n        vec4 packedInput = getA(${r});\n\n        setOutput(getChannel(packedInput, ${a}));\n      }\n    `}}const wd=r.kernel_impls.whereImpl,Cd={},kd=(0,r.env)().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class Ad extends r.KernelBackend{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!(0,r.env)().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){const e=wu((0,r.env)().getNumber("WEBGL_VERSION"));this.binaryCache=((t=(0,r.env)().getNumber("WEBGL_VERSION"))in Cd||(Cd[t]={}),Cd[t]),this.gpgpu=new Ol(e),this.canvas=e.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=e,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;var t;this.textureManager=new hd(this.gpgpu),this.numMBBeforeWarning=null==(0,r.env)().global.screen?1024:(0,r.env)().global.screen.height*(0,r.env)().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new r.DataStorage(this,(0,r.engine)())}nextDataId(){return Ad.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,t,n){if(((0,r.env)().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||(0,r.env)().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:t,dtype:n,values:e,usage:ku.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){this.texData.get(e).refCount++}decRef(e){this.texData.has(e)&&this.texData.get(e).refCount--}move(e,t,n,i,s){if((0,r.env)().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===i)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:i,values:t,usage:ku.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:n,dtype:i,complexTensorInfos:s,slice:a,shape:o,isPacked:u}=t;if(null!=a){let t;t=u?new bd(o,vd):new gd(o,vd);const n=this.runWebGLProgram(t,[{dataId:e,shape:o,dtype:i}],i),r=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===i)return n;const l=null!=this.activeTimers;let c,d;if(l&&(c=r.util.now()),"complex64"===i){const e=this.readSync(s.real.dataId),t=this.readSync(s.imag.dataId);d=r.backend_util.mergeRealAndImagArrays(e,t)}else d=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=r.util.now()-c),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise((e=>t.push(e)))}const t=this.texData.get(e),{values:n,shape:i,slice:s,dtype:a,complexTensorInfos:o,isPacked:u}=t;if(null!=s){let t;t=u?new bd(i,vd):new gd(i,vd);const n=this.runWebGLProgram(t,[{dataId:e,shape:i,dtype:a}],a),r=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(e);if(!(0,r.env)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===(0,r.env)().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l,c,d=null;if("complex64"!==a&&(0,r.env)().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(e);const t=this.texData.get(l.dataId);d=this.gpgpu.createBufferFromTexture(t.texture,...Eu(i))}if(this.pendingRead.set(e,[]),"complex64"!==a&&await this.gpgpu.createAndWaitForFence(),"complex64"===a){const e=await Promise.all([this.read(o.real.dataId),this.read(o.imag.dataId)]),t=e[0],n=e[1];c=r.backend_util.mergeRealAndImagArrays(t,n)}else if(null==d)c=this.getValuesFromTexture(e);else{const e=r.util.sizeFromShape(i);c=this.gpgpu.downloadFloat32MatrixFromBuffer(d,e)}if(null!=l&&this.disposeIntermediateTensorInfo(l),null!=d){const e=this.gpgpu.gl;Du(e,(()=>e.deleteBuffer(d)))}const h=this.convertAndCacheOnCPU(e,c),f=this.pendingRead.get(e);return this.pendingRead.delete(e),f.forEach((e=>e(h))),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&(0,r.engine)().removeDataId(e,this),this.pendingDeletes--),h}bufferSync(e){const t=this.readSync(e.dataId);let n=t;if("string"===e.dtype)try{n=t.map((e=>r.util.decodeString(e)))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return(0,r.buffer)(e.shape,e.dtype,n)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!$u(n)){if((0,r.env)().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:i}=this.texData.get(e),s=r.util.sizeFromShape(t);if((0,r.env)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),i=this.texData.get(n.dataId),r=this.gpgpu.downloadMatrixFromPackedTexture(i.texture,...Eu(t)).subarray(0,s);return this.disposeIntermediateTensorInfo(n),r}const a=(0,r.env)().getBool("WEBGL_PACK")&&!0===i,o=a?Uu(t):t,u=a?new Cl(o):new wl(o),l=this.runWebGLProgram(u,[{shape:o,dtype:n,dataId:e}],"float32"),c=this.texData.get(l.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture,c.texShape[0],c.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(l),d}timerAvailable(){return(0,r.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}async time(e){const t=this.activeTimers,n=[];let i=!1;null==this.programTimersStack?(this.programTimersStack=n,i=!0):this.activeTimers.push(n),this.activeTimers=n,e();const s=r.util.flatten(this.activeTimers.map((e=>e.query))).filter((e=>null!=e)),a=r.util.flatten(this.activeTimers.map((e=>e.name))).filter((e=>null!=e));this.activeTimers=t,i&&(this.programTimersStack=null);const o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if((0,r.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(s);o.kernelMs=r.util.sum(e),o.getExtraProfileInfo=()=>e.map(((e,t)=>({name:a[t],ms:e}))).map((e=>`${e.name}: ${e.ms}`)).join(", ")}else o.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,o}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return(0,r.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:r.util.now(),endMs:null}}endTimer(e){return(0,r.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=r.util.now(),e)}async getQueryTime(e){if((0,r.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:n,texShape:i,usage:r,isPacked:s,slice:a}=this.texData.get(e),o=a&&a.origDataId||e,u=this.dataRefCount.get(o);u>1?this.dataRefCount.set(o,u-1):(this.dataRefCount.delete(o),null!=t&&(this.numBytesInGPU-=this.computeBytes(i,n),this.textureManager.releaseTexture(t,i,r,s)));const l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=kd){return(0,r.env)().getBool("WEBGL_CPU_FORWARD")&&e.every((e=>null==this.texData.get(e.dataId).texture&&r.util.sizeFromShape(e.shape)<t))}getGPGPUContext(){return this.gpgpu}where(e){r.backend_util.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return wd(e.shape,t)}packedUnaryOp(e,t,n){const i=new bd(e.shape,t),s=this.compileAndRun(i,[e],n);return(0,r.engine)().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=Hc(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if((0,r.env)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,yd,e.dtype);const t=new gd(e.shape,yd),n=this.compileAndRun(t,[e]);return(0,r.engine)().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}makeTensorInfo(e,t,n){let i;if("string"===t&&null!=n&&n.length>0&&r.util.isString(n[0])){const s=n.map((e=>r.util.encodeString(e)));i=this.write(s,e,t)}else i=this.write(n,e,t);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:t}}makeOutput(e,t,n){const{dataId:i}=this.makeTensorInfo(e,t,n);return(0,r.engine)().makeTensorFromDataId(i,e,t,this)}unpackTensor(e){const t=new xd(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new cd(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[Pu(e.shape),...ju(e.shape)],i={dtype:e.dtype,shape:n,dataId:e.dataId},r=[Pu(t),...ju(t)],s=new dd(r,n),a=[n],o=this.runWebGLProgram(s,[i],e.dtype,a,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}decode(e){const t=this.texData.get(e),{isPacked:n,shape:i,dtype:r}=t,s=Uu(i);let a;const o=Eu(s);a=n?new xl(s):new bl(s);const u=[o];return{dtype:r,shape:i,dataId:this.runWebGLProgram(a,[{shape:s,dtype:r,dataId:e}],r,u,!0).dataId}}runWebGLProgram(e,t,n,i,s=!1){const a=this.makeTensorInfo(e.outputShape,n),o=this.texData.get(a.dataId);if(e.packedOutput&&(o.isPacked=!0),e.outPackingScheme===Cu.DENSE){const t=Eu(e.outputShape);o.texShape=t.map((e=>2*e))}if(null!=e.outTexUsage&&(o.usage=e.outTexUsage),0===r.util.sizeFromShape(a.shape))return o.values=r.util.getTypedArrayFromDType(a.dtype,0),a;const u=[],l=t.map((t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&r.util.sizeFromShape(t.shape)<=(0,r.env)().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),u.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!Vu(n.shape,t.shape)){const e=t,i=t.shape;t.shape=n.shape,t=this.packedReshape(t,i),u.push(t),n=this.texData.get(t.dataId),e.shape=i}return this.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(a.dataId);const c={shape:a.shape,texData:o,isUniform:!1},d=function(e,t,n){let i="";t.concat(n).forEach((t=>{const s=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const a=t.texData.texShape,{useSqueezeShape:o,uniformShape:u,keptDims:l}=pl(e.packedInputs,t.shape,a);let c="",d="",h="";if(1===u.length&&e.packedInputs){const e=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];c=`${e[0]>1}_${e[1]>1}`}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){const e=r.util.computeStrides(u);h=`${e[0]===a[1]}_${e[e.length-1]===a[1]}`}}else d=`${u[0]>1}_${u[1]>1}`;const f=t.shape.length,p=2===u.length&&r.util.arraysEqual(t.shape,a),m=1===r.util.sizeFromShape(t.shape),g=r.backend_util.getBroadcastDims(t.shape,n.shape),y=!e.packedInputs&&f===n.shape.length&&r.util.arraysEqual(a,n.texData.texShape),v=e.packedInputs||u.length>2?"":`${a[0]>1}_${a[1]>1}`;i+=`${f}_${y}_${o?l:""}_${u.length}_${m}_${g}_${p}_${c}_${d}_${h}_${v}_${s}`}else{const e=t.isUniform?"uniform":t.texData.texShape;i+=`${t.shape}_${e}_${s}`}}));const s=e.userCode;let a=e.constructor.name;return a+="_"+i+"_"+s+`${(0,r.env)().getNumber("WEBGL_VERSION")}`,a}(e,l,c),h=this.getAndSaveBinary(d,(()=>function(e,t,n,i){const s=n.map(((e,n)=>{const i={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(i.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:i}})),a=s.map((e=>e.shapeInfo)),o={logicalShape:i.shape,texShape:i.texData.texShape,isUniform:!1,isPacked:i.texData.isPacked,flatOffset:null},u=rl(s,o,t),l=e.createProgram(u);let c=null;const d=e.getUniformLocation(l,"NAN",!1);1===(0,r.env)().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(l,"INFINITY",!1));const h=!1,f={},p={},m={};for(let n=0;n<t.variableNames.length;n++){const i=t.variableNames[n];f[i]=e.getUniformLocation(l,i,h),f[`offset${i}`]=e.getUniformLocation(l,`offset${i}`,h),t.enableShapeUniforms&&(p[`${i}Shape`]=e.getUniformLocation(l,`${i}Shape`,h),m[`${i}TexShape`]=e.getUniformLocation(l,`${i}TexShape`,h))}let g,y,v;t.enableShapeUniforms&&(g=e.getUniformLocation(l,"outShape",h),v=e.getUniformLocation(l,"outShapeStrides",h),y=e.getUniformLocation(l,"outTexShape",h));const b=[];return t.customUniforms&&t.customUniforms.forEach(((t,n)=>{b[n]=e.getUniformLocation(l,t.name,h)})),{program:t,source:u,webGLProgram:l,uniformLocations:f,customUniformLocations:b,inShapeInfos:a,outShapeInfo:o,infLoc:c,nanLoc:d,inShapesLocations:p,inTexShapesLocations:m,outShapeLocation:g,outShapeStridesLocation:v,outTexShapeLocation:y}}(this.gpgpu,e,l,c))),f=null!=this.activeTimers;let p;f&&(p=this.startTimer()),function(e,t,n,i,s){t.program.enableShapeUniforms||(yl(t.inShapeInfos,n),yl([t.outShapeInfo],[i]));const a=i.texData.texture,o=i.texData.texShape;i.texData.isPacked?e.setOutputPackedMatrixTexture(a,o[0],o[1]):e.setOutputMatrixTexture(a,o[0],o[1]),e.setProgram(t.webGLProgram),1===(0,r.env)().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(((n,i)=>{const s=t.program.variableNames[i],a=t.uniformLocations[s],o=t.uniformLocations[`offset${s}`],u=t.inShapesLocations[`${s}Shape`],l=t.inTexShapesLocations[`${s}TexShape`];if(u){const{uniformShape:i}=pl(t.program.packedInputs,n.shape,n.texData.texShape);switch(i.length){case 1:e.gl.uniform1iv(u,new Int32Array(i));break;case 2:e.gl.uniform2iv(u,new Int32Array(i));break;case 3:e.gl.uniform3iv(u,new Int32Array(i));break;case 4:e.gl.uniform4iv(u,new Int32Array(i))}}if(l&&e.gl.uniform2i(l,n.texData.texShape[0],n.texData.texShape[1]),null!=a)if(n.isUniform)if(r.util.sizeFromShape(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{let t=n.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(a,t)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,i)}));const u=t.outShapeLocation;if(u)switch(i.shape.length){case 1:e.gl.uniform1iv(u,new Int32Array(i.shape));break;case 2:e.gl.uniform2iv(u,new Int32Array(i.shape));break;case 3:e.gl.uniform3iv(u,new Int32Array(i.shape));break;case 4:e.gl.uniform4iv(u,new Int32Array(i.shape))}if(t.outShapeStridesLocation){const n=r.util.computeStrides(i.shape);switch(i.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,i.texData.texShape[0],i.texData.texShape[1]),t.program.customUniforms&&s&&t.program.customUniforms.forEach(((n,i)=>{const r=t.customUniformLocations[i],a=s[i];if("float"===n.type)e.gl.uniform1fv(r,a);else if("vec2"===n.type)e.gl.uniform2fv(r,a);else if("vec3"===n.type)e.gl.uniform3fv(r,a);else if("vec4"===n.type)e.gl.uniform4fv(r,a);else if("int"===n.type)e.gl.uniform1iv(r,a);else if("ivec2"===n.type)e.gl.uniform2iv(r,a);else if("ivec3"===n.type)e.gl.uniform3iv(r,a);else{if("ivec4"!==n.type)throw Error(`uniform type ${n.type} is not supported yet.`);e.gl.uniform4iv(r,a)}})),e.executeProgram()}(this.gpgpu,h,l,c,i),u.forEach((e=>this.disposeIntermediateTensorInfo(e))),f&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)}));const m=(0,r.env)().get("WEBGL_FLUSH_THRESHOLD");if(m>0){const e=r.util.now();e-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!(0,r.env)().getBool("WEBGL_LAZILY_UNPACK")&&o.isPacked&&!1===s){const e=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),e}return a}compileAndRun(e,t,n,i,r=!1){return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,i,r)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||((0,r.env)().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=(0,r.tidy)((()=>{if(!(0,r.env)().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=(0,r.env)().getBool("DEBUG");(0,r.env)().set("DEBUG",!1);const t=this.abs((0,r.scalar)(1e-8)).dataSync()[0];if((0,r.env)().set("DEBUG",e),t>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:i,values:s,texture:a,usage:o,isPacked:u}=t;if(null!=a)return;const l=null!=this.activeTimers;let c;l&&(c=r.util.now());let d=t.texShape;if(null==d&&(d=function(e,t=!1){let n=(0,r.env)().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,1===(e=e.map(((t,n)=>n>=e.length-2?r.util.nearestLargerEven(e[n]):e[n]))).length&&(e=[2,e[0]])),2!==e.length){const t=r.util.squeezeShape(e);e=t.newShape}let i=r.util.sizeFromShape(e);if(e.length<=1&&i<=n)return[1,i];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){const t=Pu(e);let n=2,s=2;return e.length&&([n,s]=ju(e)),i=t*(n/2)*(s/2),r.util.sizeToSquarishShape(i).map((e=>2*e))}return r.util.sizeToSquarishShape(i)}(n,u),t.texShape=d),null!=s){const e=Uu(n);let a,o=d[1],h=d[0];const f=s instanceof Uint8Array||s instanceof Uint8ClampedArray;u?([o,h]=Su(d[0],d[1]),a=new Al(e,f)):a=new kl(e,f);const p=this.makeTensorInfo([h,o],i);this.texData.get(p.dataId).usage=f?ku.PIXELS:ku.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(p.dataId),o,h,s);const m=[[h,o]],g=!0,y=this.runWebGLProgram(a,[p],i,m,g),v=this.texData.get(y.dataId);t.texture=v.texture,t.texShape=v.texShape,t.isPacked=v.isPacked,t.usage=v.usage,this.disposeIntermediateTensorInfo(p),this.texData.delete(y.dataId),t.values=null,l&&(this.uploadWaitMs+=r.util.now()-c)}else{const e=this.acquireTexture(d,o,i,u);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:i}=n;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error(`Unknown dtype ${t}`)}(t,i)),n.values}acquireTexture(e,t,n,i){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${e} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,i)}computeBytes(e,t){return e[0]*e[1]*r.util.bytesPerElement(t)}}Ad.nextDataId=0,r.device_util.isBrowser()&&(0,r.registerBackend)("webgl",(()=>new Ad),2);class _d{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=r.backend_util.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=vl(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${e}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}class Ed{constructor(e,t,n,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.backend_util.assertAndGetBroadcastShape(t,n);const s=this.outputShape.length;this.enableShapeUniforms=vl(s);let a="";if(i)if(0===s||1===r.util.sizeFromShape(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a=`\n          ${fl(s)} coords = getOutputCoords();\n        `,1===s)this.enableShapeUniforms?a+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":a+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const e=ld("coords",s);this.enableShapeUniforms?a+=`\n            bool nextRowOutOfBounds =\n              (${e[s-2]} + 1) >= outShape[${s} - 2];\n            bool nextColOutOfBounds =\n              (${e[s-1]} + 1) >= outShape[${s} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:a+=`\n            bool nextRowOutOfBounds =\n              (${e[s-2]} + 1) >= ${this.outputShape[s-2]};\n            bool nextColOutOfBounds =\n              (${e[s-1]} + 1) >= ${this.outputShape[s-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${e}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${a}\n\n        setOutput(result);\n      }\n    `}}function Sd(e){const{inputs:t,backend:n}=e,{x:i}=t;return n.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const Fd={kernelName:r.Identity,backendName:"webgl",kernelFunc:Sd};function Dd(e){const{inputs:t,backend:n}=e,{real:i,imag:r}=t,s=n.makeTensorInfo(i.shape,"complex64"),a=n.texData.get(s.dataId),o=Sd({inputs:{x:i},backend:n}),u=Sd({inputs:{x:r},backend:n});return a.complexTensorInfos={real:o,imag:u},s}const $d={kernelName:r.Complex,backendName:"webgl",kernelFunc:Dd},Od="return (a < 0.) ? b * a : a;",Nd="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Id={kernelName:r.LeakyRelu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{alpha:a}=i,o=n.makeTensorInfo([],"float32",r.util.createScalarValue(a,"float32")),u=(0,r.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ed(Nd,s.shape,o.shape):new _d(Od,s.shape,o.shape),l=n.runWebGLProgram(u,[s,o],"float32");return n.disposeIntermediateTensorInfo(o),l}},Td="return (a < 0.) ? b * a : a;",Rd="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Md={kernelName:r.Prelu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i,alpha:s}=t,a=(0,r.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ed(Rd,i.shape,s.shape):new _d(Td,i.shape,s.shape);return n.runWebGLProgram(a,[i,s],"float32")}};function Bd({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:i}){return({inputs:s,backend:a})=>{const{x:o}=s,u=a,l=i||o.dtype;if(u.shouldExecuteOnCPU([o])&&null!=n){const e=u.texData.get(o.dataId),t=n(e.values,l);return u.makeTensorInfo(o.shape,l,t)}let c;return c=(0,r.env)().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=t?new bd(o.shape,t):new gd(o.shape,e),u.runWebGLProgram(c,[o],l)}}function zd({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:i=!1,cpuKernelImpl:s,dtype:a}){return({inputs:o,backend:u})=>{const{a:l,b:c}=o,d=u;if(i&&"complex64"===l.dtype){const t=d.texData.get(l.dataId),n=d.texData.get(c.dataId),[i,s]=[[t.complexTensorInfos.real,n.complexTensorInfos.real],[t.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((t=>{const[n,i]=t,s={dataId:n.dataId,dtype:n.dtype,shape:l.shape},a={dataId:i.dataId,dtype:i.dtype,shape:c.shape},o=new _d(e,l.shape,c.shape);return d.runWebGLProgram(o,[s,a],(0,r.upcastType)(n.dtype,i.dtype))})),a=Dd({inputs:{real:i,imag:s},backend:d});return d.disposeIntermediateTensorInfo(i),d.disposeIntermediateTensorInfo(s),a}const h=a||(0,r.upcastType)(l.dtype,c.dtype);if(("string"===l.dtype||"string"===c.dtype||d.shouldExecuteOnCPU([l,c]))&&null!=s){const e=d.texData.get(l.dataId).values,t=d.texData.get(c.dataId).values,n="string"===l.dtype?r.backend_util.fromUint8ToStringArray(e):e,i="string"===l.dtype?r.backend_util.fromUint8ToStringArray(t):t,[a,o]=s(l.shape,c.shape,n,i,h),u=d.makeTensorInfo(o,h);return d.texData.get(u.dataId).values=a,u}let f;return f=(0,r.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=t?new Ed(t,l.shape,c.shape,n):new _d(e,l.shape,c.shape),d.runWebGLProgram(f,[l,c],h)}}function Ld(e,t=!1){if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===e)return t?Rd:Td;if("leakyrelu"===e)return t?Nd:Od;if("sigmoid"===e)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}class Pd{constructor(e,t,n,i=!1,r=!1,s=!1,a=null,o=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=vl(this.outputShape.length);const l=i?e[1]:e[2],c=Math.ceil(l/2),d=i?"i * 2, rc.y":"rc.y, i * 2",h=r?"rc.z, i * 2":"i * 2, rc.z",f=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",g="";a&&(m=o?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${a}\n        }`:u?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${a}\n        }`:`vec4 activation(vec4 x) {\n          ${a}\n        }`,g="result = activation(result);");const y=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let v="rc.x",b="rc.x";e[0]<t[0]?v=`int(min(float(rc.x), ${e[0]-1}.))`:t[0]<e[0]&&(b=`int(min(float(rc.x), ${t[0]-1}.))`),this.userCode=`\n      ${m}\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ${c}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${c}; i++) {\n          int batchA = ${v};\n          int batchB = ${b};\n          vec4 a = getMatrixA(batchA, ${d});\n          vec4 b = getMatrixB(batchB, ${h});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${f[0]} * ${p[0]});\n          result += (${f[1]} * ${p[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${y}\n\n        ${g}\n\n        setOutput(result);\n      }\n    `}}class jd{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=r.backend_util.assertAndGetBroadcastShape(t,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${e}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}const Ud="return a * b;";function Wd(e){const{inputs:t,backend:n}=e,{a:i,b:s}=t,a=r.backend_util.upcastType(i.dtype,s.dtype);if("complex64"===i.dtype){const e=n.texData.get(i.dataId),t=n.texData.get(s.dataId),r=new jd("return areal * breal - aimag * bimag;",i.shape,s.shape),a=new jd("return areal * bimag + aimag * breal;",i.shape,s.shape),o=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:i.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:i.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:s.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:s.shape}],u=n.runWebGLProgram(r,o,"float32"),l=n.runWebGLProgram(a,o,"float32"),c=Dd({inputs:{real:u,imag:l},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(l),c}if(n.shouldExecuteOnCPU([i,s])){const e=n.texData.get(i.dataId),t=n.texData.get(s.dataId),[r,o]=Pc(i.shape,s.shape,e.values,t.values,a),u=n.makeTensorInfo(o,a);return n.texData.get(u.dataId).values=r,u}let o;return o=(0,r.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ed(Ud,i.shape,s.shape):new _d(Ud,i.shape,s.shape),n.runWebGLProgram(o,[i,s],a)}const Vd={kernelName:r.Multiply,backendName:"webgl",kernelFunc:Wd};function qd(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{shape:a}=i,o=n,u=r.util.sizeFromShape(s.shape),l=r.util.inferFromImplicitShape(a,u),c=r.util.sizeFromShape(l);r.util.assert(u===c,(()=>`The new shape (${l}) has ${c} elements and the old shape (${s.shape}) has ${u} elements. The new shape and old shape must have the same number of elements.`));const d=o.texData.get(s.dataId);return!d.isPacked||Vu(s.shape,l)||null!==d.texture&&Vu(d.shape,l)?(o.incRef(s.dataId),{dataId:s.dataId,shape:l,dtype:s.dtype}):function(e,t,n){const i=[Pu(e.shape),...ju(e.shape)],r={dtype:e.dtype,shape:i,dataId:e.dataId},s=[Pu(t),...ju(t)],a=new dd(s,i),o=[i],u=n.runWebGLProgram(a,[r],e.dtype,o,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(s,l,o)}const Gd={kernelName:r.Reshape,backendName:"webgl",kernelFunc:qd};class Hd{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:i,inSize:s,outSize:a}=e;this.outputShape=[i,a];const o=4*Math.floor(n/4),u=n%4;let l="sumValue += dot(values, ones);";if(null!=t){const e=1/t;l=`sumValue += dot(values * ${r.util.isInt(e)?e.toPrecision(2):e}, ones);`}let c="";s%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${s}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${o}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${l}\n        }\n\n        int inIdx = inOffset + ${o};\n        if (${1===u}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${l}\n        } else if (${2===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${l}\n        } else if (${3===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${l}\n        }\n        setOutput(sumValue);\n      }\n    `}}class Xd{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:i,inSize:r,outSize:s}=e;this.outputShape=[i,s];let a="0.0",o="";"prod"===t?a="1.0":"min"===t?(a="1.0 / 1e-20",o="min"):"max"===t&&(a="-1.0 / 1e-20",o="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");const l=4*Math.floor(n/4),c=n%4;let d=`\n      if (${"sum"===t}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===t}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${o}(values, minMaxValue);\n        if (${"min"===t} || ${"max"===t}) {\n          minMaxValue = ${o}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,h="vec4";"all"===t?(a="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===t&&(a="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");let f="";r%n>0&&(f=`\n        if (inIdx < 0 || inIdx >= ${r}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${a};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${f}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${a});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${l}; i += 4) {\n          int inIdx = inOffset + i;\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${d}\n        }\n\n        int inIdx = inOffset + ${l};\n        if (${1===c}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${d}\n        } else if (${2===c}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${d}\n        } else if (${3===c}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${d}\n        }\n        setOutput(${u});\n      }\n    `}}function Yd(e,t,n,i){const s=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],i=r.backend_util.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:i,outSize:Math.ceil(n/i)})}return t}(e.shape);let a=e;for(let r=0;r<s.length;r++){const{inSize:o,windowSize:u,outSize:l}=s[r];let c,d;c="mean"===n?0===r?new Hd({windowSize:u,inSize:o,batchSize:e.shape[0],outSize:l},o):new Hd({windowSize:u,inSize:o,batchSize:e.shape[0],outSize:l}):new Xd({windowSize:u,inSize:o,batchSize:e.shape[0],outSize:l},n),d=a,a=i.runWebGLProgram(c,[a],t),d.dataId!==e.dataId&&i.disposeIntermediateTensorInfo(d)}return a}class Kd{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[t[i]];this.outputShape=n,this.rank=n.length;const i=fl(this.rank),r=function(e){const t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],i=new Array(t);for(let t=0;t<e.length;t++)i[e[t]]=n[t];return i.join()}(t);this.userCode=`\n    void main() {\n      ${i} resRC = getOutputCoords();\n      setOutput(getA(${r}));\n    }\n    `}}class Jd{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[t[i]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=fl(this.rank),r=ud("rc",this.rank),s=new Array(this.rank);for(let e=0;e<t.length;e++)s[t[e]]=r[e];const a=`vec2(${s.slice(-2).join()})`,o=`++${r[this.rank-1]} < ${n[this.rank-1]}`,u=`getChannel(getA(${s.join()}), ${a})`;this.userCode=`\n    void main() {\n      ${i} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${u};\n      if(${o}) {\n        result[1] = ${u};\n      }\n      --${r[this.rank-1]};\n      if(++${r[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${u};\n        if(${o}) {\n          result[3] = ${u};\n        }\n      }\n      setOutput(result);\n    }\n    `}}function Zd(e,t,n){const i=(0,r.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Jd(e.shape,t):new Kd(e.shape,t);return n.runWebGLProgram(i,[e],e.dtype)}function Qd(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{axis:a,keepDims:o}=i;return function(e,t,n,i){const s=t,a=e.shape.length,o=r.util.parseAxisParam(s,e.shape);let u=o;const l=r.backend_util.getAxesPermutation(u,a),c=null!=l;let d=e;c&&(d=Zd(e,l,i),u=r.backend_util.getInnerMostAxes(u.length,a)),r.backend_util.assertAxesAreInnerMostDims("sum",u,a);const[h,f]=r.backend_util.computeOutAndReduceShapes(d.shape,u);let p=h;n&&(p=r.backend_util.expandShapeToKeepDim(h,o));const m=r.util.sizeFromShape(f),g=qd({inputs:{x:d},attrs:{shape:[r.util.sizeFromShape(e.shape)/m,m]},backend:i}),y=Yd(g,(0,r.sumOutType)(e.dtype),"sum",i),v=qd({inputs:{x:y},attrs:{shape:p},backend:i});return i.disposeIntermediateTensorInfo(g),i.disposeIntermediateTensorInfo(y),c&&i.disposeIntermediateTensorInfo(d),v}(s,a,o,n)}const eh={kernelName:r.Sum,backendName:"webgl",kernelFunc:Qd};function th(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{perm:s}=i,a=n,o=r.shape.length,u=new Array(o);for(let e=0;e<u.length;e++)u[e]=r.shape[s[e]];let l;if(a.shouldExecuteOnCPU([r])){const e=a.texData.get(r.dataId).values,t=ad(e,r.shape,r.dtype,s,u);l=a.makeTensorInfo(u,r.dtype),a.texData.get(l.dataId).values=t}else l=Zd(r,s,a);return l}const nh={kernelName:r.Transpose,backendName:"webgl",kernelFunc:th};function ih({a:e,b:t,transposeA:n,transposeB:i,backend:s,bias:a=null,preluActivationWeights:o=null,leakyreluAlpha:u=0,activation:l=null}){const c=e.shape.length,d=t.shape.length,h=n?e.shape[c-2]:e.shape[c-1],f=i?t.shape[d-1]:t.shape[d-2],p=n?e.shape[c-1]:e.shape[c-2],m=i?t.shape[d-2]:t.shape[d-1],g=e.shape.slice(0,-2),y=t.shape.slice(0,-2),v=r.util.sizeFromShape(g),b=r.util.sizeFromShape(y),x=v===b||1===v||1===b;r.util.assert(c>=2&&d>=2&&x,(()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${g}) and (${y}).`));const w=(v>b?e.shape.slice(0,-2):t.shape.slice(0,-2)).concat([p,m]);r.util.assert(h===f,(()=>`Error in matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${i} must match.`));const C=n?[v,h,p]:[v,p,h],k=i?[b,m,f]:[b,f,m],A=qd({inputs:{x:e},backend:s,attrs:{shape:C}}),_=qd({inputs:{x:t},backend:s,attrs:{shape:k}}),E=[A,_],S=Math.max(v,b),F=n?A.shape[1]:A.shape[2],D=null!=a,$=null!=o,O="leakyrelu"===l,N=null!=l?Ld(l,!0):null;let I;if((1===p||1===m)&&F>1e3&&!1===(D||$||O||null!=N)){let e=A,t=_;n&&(e=th({inputs:{x:A},backend:s,attrs:{perm:[0,2,1]}}),E.push(e)),i&&(t=th({inputs:{x:_},backend:s,attrs:{perm:[0,2,1]}}),E.push(t));const r=1===m;let a=e;1!==m&&(a=qd({inputs:{x:e},backend:s,attrs:{shape:[S,F,1]}}),E.push(a));const o=1===m?2:1;let u=t;r&&(u=qd({inputs:{x:t},backend:s,attrs:{shape:[S,1,F]}}),E.push(u));const l=Wd({inputs:{a,b:u},backend:s});I=Qd({inputs:{x:l},backend:s,attrs:{axis:o,keepDims:!0}}),E.push(l)}else{const l=(0,r.upcastType)(e.dtype,t.dtype),c=new Pd(C,k,[S,p,m],n,i,D,N,$,O),d=[A,_];if(null!=a&&d.push(a),$&&d.push(o),O){const e=s.makeTensorInfo([],"float32",r.util.createScalarValue(u,"float32"));d.push(e),E.push(e)}I=s.runWebGLProgram(c,d,l)}const T=qd({inputs:{x:I},backend:s,attrs:{shape:w}});E.push(I);for(const e of E)s.disposeIntermediateTensorInfo(e);return T}const rh={kernelName:r._FusedMatMul,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{a:r,b:s,bias:a,preluActivationWeights:o}=t,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:d}=i;return ih({a:r,b:s,transposeA:u,transposeB:l,backend:n,bias:a,preluActivationWeights:o,leakyreluAlpha:d,activation:c})}},sh="return abs(x);",ah={kernelName:r.Abs,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t;if(n.shouldExecuteOnCPU([i])&&"complex64"!==i.dtype){const e=n.texData.get(i.dataId),t=Hc(e.values);return n.makeTensorInfo(i.shape,i.dtype,t)}let s;return s=(0,r.env)().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new bd(i.shape,sh):new gd(i.shape,sh),n.runWebGLProgram(s,[i],i.dtype)}},oh=Bd({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),uh={kernelName:r.Acos,backendName:"webgl",kernelFunc:oh},lh=Bd({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),ch={kernelName:r.Acosh,backendName:"webgl",kernelFunc:lh},dh="return a + b;",hh=zd({opSnippet:dh,packedOpSnippet:dh,supportsComplex:!0,cpuKernelImpl:xc}),fh={kernelName:r.Add,backendName:"webgl",kernelFunc:hh};class ph{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(((e,t)=>`T${t}`));const n=[];this.variableNames.forEach((e=>{n.push(`float v${e} = get${e}AtOutCoords();`)}));const i=this.variableNames.map((e=>`v${e}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${i};\n        setOutput(result);\n      }\n    `}}class mh{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(((e,t)=>`T${t}`));const n=[];this.variableNames.forEach((e=>{n.push(`vec4 v${e} = get${e}AtOutCoords();`)}));const i=this.variableNames.map((e=>`v${e}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${i};\n        setOutput(result);\n      }\n    `}}const gh={kernelName:r.AddN,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:i}=t,s=n;if(1===s.length)return Sd({inputs:{x:s[0]},backend:i});if(s.length>(0,r.env)().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const t=Math.floor(s.length/2),n=e({inputs:s.slice(0,t),backend:i}),r=e({inputs:s.slice(t),backend:i});return e({inputs:[n,r],backend:i})}const a=s.map((e=>e.dtype)).reduce(((e,t)=>(0,r.upcastType)(e,t))),o=s.map((e=>e.shape)),u=(0,r.env)().getBool("WEBGL_PACK")?new mh(s[0].shape,o):new ph(s[0].shape,o);return i.runWebGLProgram(u,s,a)}},yh={kernelName:r.All,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{axis:a,keepDims:o}=i,u=s.shape.length,l=r.util.parseAxisParam(a,s.shape);let c=l;const d=r.backend_util.getAxesPermutation(c,u);let h=s;null!=d&&(h=th({inputs:{x:s},backend:n,attrs:{perm:d}}),c=r.backend_util.getInnerMostAxes(c.length,u)),r.backend_util.assertAxesAreInnerMostDims("all",c,u);const[f,p]=r.backend_util.computeOutAndReduceShapes(h.shape,c),m=qd({inputs:{x:h},backend:n,attrs:{shape:[-1,r.util.sizeFromShape(p)]}}),g=Yd(m,m.dtype,"all",n);let y;return y=qd(o?{inputs:{x:g},backend:n,attrs:{shape:r.backend_util.expandShapeToKeepDim(f,l)}}:{inputs:{x:g},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=d&&n.disposeIntermediateTensorInfo(h),y}},vh={kernelName:r.Any,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{axis:a,keepDims:o}=i,u=s.shape.length,l=r.util.parseAxisParam(a,s.shape);let c=l;const d=r.backend_util.getAxesPermutation(c,u);let h=s;null!=d&&(h=th({inputs:{x:s},backend:n,attrs:{perm:d}}),c=r.backend_util.getInnerMostAxes(c.length,u)),r.backend_util.assertAxesAreInnerMostDims("any",c,u);const[f,p]=r.backend_util.computeOutAndReduceShapes(h.shape,c),m=qd({inputs:{x:h},backend:n,attrs:{shape:[-1,r.util.sizeFromShape(p)]}}),g=Yd(m,m.dtype,"any",n);let y;return y=qd(o?{inputs:{x:g},backend:n,attrs:{shape:r.backend_util.expandShapeToKeepDim(f,l)}}:{inputs:{x:g},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=d&&n.disposeIntermediateTensorInfo(h),y}};class bh{constructor(e,t,n){this.variableNames=["A"];const{windowSize:i,batchSize:r,outSize:s}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[r,s];const a="max"===t?">":"<",o=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${i};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${i}; i++) {\n          int inIdx = ${o};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${a} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}class xh{constructor(e,t,n,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,r.util.assert(e.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const s=e[e.length-1],a=Math.ceil(s/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),i||this.variableNames.push("bestIndicesA");const o=this.outputShape,u=o.length,l=fl(u),c=ld("coords",u);let d,h;if(1===a){h=u+1;const e=fl(h);d=`\n        ${e} sourceLocR = ${e}(${c.join()}, 0);\n        ++${c[u-1]};\n        ${e} sourceLocG = ${e}(${c.join()}, 0);\n        ++${c[u-2]};\n        ${e} sourceLocA = ${e}(${c.join()}, 0);\n        --${c[u-1]};\n        ${e} sourceLocB = ${e}(${c.join()}, 0);\n        --${c[u-2]};`}else h=u,d=`\n        ${l} sourceLocR = coords;\n        ++${c[u-1]};\n        ${l} sourceLocG = coords;\n        ++${c[u-2]};\n        ${l} sourceLocA = coords;\n        --${c[u-1]};\n        ${l} sourceLocB = coords;\n        --${c[u-2]};`;const f=["x","y","z","w","u","v"].slice(0,h),p="."+f[h-1],m=f.map((e=>"int "+e)),g=ld("sourceLocR",h-1).concat("inIdx.r"),y=ld("sourceLocG",h-1).concat("inIdx.g"),v=ld("sourceLocB",h-1).concat("inIdx.b"),b=ld("sourceLocA",h-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=i?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${v.join()}),\n                             getBestIndicesAChannel(${b.join()})));`,C=`vec4(\n            getAChannel(${g.join()}),\n            hasNextCol ? getAChannel(${y.join()}) : 0.,\n            hasNextRow ? getAChannel(${v.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,k=i?"":`\n      float getBestIndicesAChannel(${m.join()}) {\n        return getChannel(getBestIndicesA(${f.join()}),\n                                          vec2(${f.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${m.join()}) {\n        return getChannel(getA(${f.join()}),\n                               vec2(${f.slice(-2).join()}));\n      }\n      ${k}\n      void main() {\n        ${l} coords = getOutputCoords();\n        bool hasNextCol = ${c[u-1]} < ${o[u-1]-1};\n        bool hasNextRow = ${c[u-2]} < ${o[u-2]-1};\n        ${d}\n        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},\n          sourceLocB${p}, sourceLocA${p}) * ${t};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${C};\n\n        for (int i = 0; i < ${t}; i++) {\n          inIdx = srcIdx;\n          ${w}\n          vec4 candidate = ${C};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${x}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}function wh(e,t,n,i=null){let s=t.shape[0],a=t.shape[1];null!=i&&(s=i.shape[0],a=i.shape[1]);const o=r.backend_util.computeOptimalWindowSize(a),u={windowSize:o,inSize:a,batchSize:s,outSize:Math.ceil(a/o)},l=new bh(u,n,null==i),c=[t];null!=i&&c.push(i);const d=e.runWebGLProgram(l,c,"int32");if(1===d.shape[1])return d;const h=wh(e,t,n,d);return e.disposeIntermediateTensorInfo(d),h}function Ch(e,t,n,i=null){const s=null!=i?i.shape:t.shape,a=s[s.length-1],o=r.backend_util.computeOptimalWindowSize(a),u=new xh(s,o,n,null==i),l=null==i?[t]:[t,i],c=e.runWebGLProgram(u,l,"int32");if(c.shape.length===t.shape.length){const i=Ch(e,t,n,c);return e.disposeIntermediateTensorInfo(c),i}return c}function kh(e,t,n,i){const s=[n];if(r.backend_util.assertAxesAreInnerMostDims("arg"+i.charAt(0).toUpperCase()+i.slice(1),s,t.shape.length),!(0,r.env)().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],a=e.texData.get(t.dataId);let o=t;null!==a&&a.isPacked&&(o=e.unpackTensor(t),n.push(o));const[u,l]=r.backend_util.computeOutAndReduceShapes(o.shape,s),c=r.util.sizeFromShape(l),d=qd({inputs:{x:o},backend:e,attrs:{shape:[-1,c]}});n.push(d);const h=wh(e,d,i);n.push(h);const f=qd({inputs:{x:h},backend:e,attrs:{shape:u}});return n.forEach((t=>e.disposeIntermediateTensorInfo(t))),f}return Ch(e,t,i)}const Ah={kernelName:r.ArgMax,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{axis:a}=i;let o=r.util.parseAxisParam(a,s.shape);const u=r.backend_util.getAxesPermutation(o,s.shape.length);let l=s;const c=[];null!=u&&(l=th({inputs:{x:s},backend:n,attrs:{perm:u}}),c.push(l),o=r.backend_util.getInnerMostAxes(o.length,l.shape.length)),r.backend_util.assertAxesAreInnerMostDims("argMax",[o[0]],l.shape.length);const d=kh(n,l,o[0],"max");return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),d}},_h={kernelName:r.ArgMin,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{axis:a}=i;let o=r.util.parseAxisParam(a,s.shape);const u=r.backend_util.getAxesPermutation(o,s.shape.length);let l=s;const c=[];null!=u&&(l=th({inputs:{x:s},backend:n,attrs:{perm:u}}),c.push(l),o=r.backend_util.getInnerMostAxes(o.length,l.shape.length)),r.backend_util.assertAxesAreInnerMostDims("argMin",[o[0]],l.shape.length);const d=kh(n,l,o[0],"min");return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),d}},Eh=Bd({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),Sh={kernelName:r.Asin,backendName:"webgl",kernelFunc:Eh},Fh=Bd({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),Dh={kernelName:r.Asinh,backendName:"webgl",kernelFunc:Fh},$h=Bd({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),Oh={kernelName:r.Atan,backendName:"webgl",kernelFunc:$h},Nh=zd({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),Ih={kernelName:r.Atan2,backendName:"webgl",kernelFunc:Nh},Th=Bd({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),Rh={kernelName:r.Atanh,backendName:"webgl",kernelFunc:Th};class Mh{constructor(e,t,n,i=!1,r=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const s=e.filterWidth,a=e.strideHeight,o=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;const p="avg"===t,m=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,g=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let y="0.0";if(p||(y="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${a}, ${o});\n        const ivec2 pads = ivec2(${h}, ${f});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${c};\n              wR += ${u}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${d};\n                wC += ${l}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${t} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${i?r?m:g:`wR * ${d} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let v=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(v="avgValue / count");const b=4*Math.floor(s/4),x=s%4,w=`\n      if (${p}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${a}, ${o});\n      const ivec2 pads = ivec2(${h}, ${f});\n      const float initializationValue = ${y};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${y});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${c};\n            wR += ${u}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${b}; wC += 4) {\n            int xC = xCCorner + wC * ${l};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              getValue(batch, xR, xC + 2 * ${l}, d),\n              getValue(batch, xR, xC + 3 * ${l}, d)\n            );\n\n            ${w}\n          }\n\n          int xC = xCCorner + ${b};\n          if (${1===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${2===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${3===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              getValue(batch, xR, xC + 2 * ${l}, d),\n              initializationValue\n            );\n\n            ${w}\n          }\n        }\n        setOutput(${v});\n      }\n    `}}class Bh{constructor(e,t,n,i=!1,r=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const s=e.filterWidth,a=e.strideDepth,o=e.strideHeight,u=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const v="avg"===t;let b="0.0";if(v||(b="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${a}, ${o}, ${u});\n        const ivec3 pads = ivec3(${m}, ${g}, ${y});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${h};\n              wD += ${l}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${f};\n                wR += ${c}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${p};\n                  wC += ${d}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ${t} currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${i?r?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${f} * ${p} +\n                      wR * ${p} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let x=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(x="avgValue / count");const w=4*Math.floor(s/4),C=s%4,k=`\n      if (${v}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${a}, ${o}, ${u});\n      const ivec3 pads = ivec3(${m}, ${g}, ${y});\n      const float initializationValue = ${b};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${b});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${h};\n            wD += ${l}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${f};\n            wR += ${c}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${w}; wC += 4) {\n              int xC = xCCorner + wC * ${d};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${d}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${d}, ch)\n              );\n\n              ${k}\n            }\n\n            int xC = xCCorner + ${w};\n            if (${1===C}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${k}\n            } else if (${2===C}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${k}\n            } else if (${3===C}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${d}, ch),\n                initializationValue\n              );\n\n              ${k}\n            }\n          }\n          setOutput(${x});\n        }\n      }\n    `}}const zh={kernelName:r.AvgPool,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t;Ku(s,"avgPool");const{filterSize:a,strides:o,pad:u,dimRoundingMode:l}=i;r.util.assert(r.backend_util.eitherStridesOrDilationsAreOne(o,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const c=r.backend_util.computePool2DInfo(s.shape,a,o,1,u,l);if(1===c.filterWidth&&1===c.filterHeight&&r.util.arraysEqual(c.inShape,c.outShape))return Sd({inputs:{x:s},backend:n});const d=new Mh(c,"avg",!1);return n.runWebGLProgram(d,[s],"float32")}},Lh={kernelName:r.AvgPool3D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{filterSize:a,strides:o,pad:u,dimRoundingMode:l,dataFormat:c}=i,d=r.backend_util.computePool3DInfo(s.shape,a,o,[1,1,1],u,l,c),h=new Bh(d,"avg",!1);return n.runWebGLProgram(h,[s],"float32")}};class Ph{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,i=e.strideHeight,r=e.strideWidth,s=e.dilationHeight,a=e.dilationWidth,o=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=o-1-e.padInfo.top,c=u-1-e.padInfo.left,d=1/(t*n);this.userCode=`\n      const ivec2 pads = ivec2(${l}, ${c});\n      const float avgMultiplier = float(${d});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${o};\n            wR += ${s}) {\n          float dyR = float(dyRCorner + wR) / ${i}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${u};\n            wC+= ${a}) {\n            float dyC = float(dyCCorner + wC) / ${r}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class jh{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,i=e.filterWidth,r=e.strideDepth,s=e.strideHeight,a=e.strideWidth,o=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=c-1-e.padInfo.front,p=d-1-e.padInfo.top,m=h-1-e.padInfo.left,g=1/(t*n*i);this.userCode=`\n      const ivec3 pads = ivec3(${f}, ${p}, ${m});\n      const float avgMultiplier = float(${g});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${c};\n            wD += ${o}) {\n          float dyD = float(dyDCorner + wD) / ${r}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${d};\n              wR += ${u}) {\n            float dyR = float(dyRCorner + wR) / ${s}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${h};\n                wC += ${l}) {\n              float dyC = float(dyCCorner + wC) / ${a}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const Uh={kernelName:r.AvgPool3DGrad,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:s,input:a}=t,o=a,{filterSize:u,strides:l,pad:c,dimRoundingMode:d}=i,h=r.backend_util.computePool3DInfo(o.shape,u,l,[1,1,1],c,d),f=new jh(h);return n.runWebGLProgram(f,[s],o.dtype)}},Wh={kernelName:r.AvgPoolGrad,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:s,input:a}=t,o=a;Ku([s,a],"avgPoolGrad");const{filterSize:u,strides:l,pad:c}=i,d=r.backend_util.computePool2DInfo(o.shape,u,l,1,c),h=new Ph(d);return n.runWebGLProgram(h,[s],o.dtype)}},Vh={kernelName:r.BatchMatMul,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{a:r,b:s}=t,{transposeA:a,transposeB:o}=i;return ih({a:r,b:s,transposeA:a,transposeB:o,backend:n})}};class qh{constructor(e,t,n,i,s,a){this.outputShape=[],this.variableNames=["x","mean","variance"],r.backend_util.assertAndGetBroadcastShape(e,t),r.backend_util.assertAndGetBroadcastShape(e,n);let o="0.0";null!=i&&(r.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let u="1.0";null!=s&&(r.backend_util.assertAndGetBroadcastShape(e,s),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${o};\n        float scale = ${u};\n        float inv = scale * inversesqrt(variance + float(${a}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}class Gh{constructor(e,t,n,i,s,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],r.backend_util.assertAndGetBroadcastShape(e,t),r.backend_util.assertAndGetBroadcastShape(e,n);let o="vec4(0.0)";null!=i&&(r.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let u="vec4(1.0)";null!=s&&(r.backend_util.assertAndGetBroadcastShape(e,s),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        vec4 offset = ${o};\n        vec4 scale = ${u};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${a}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}const Hh={kernelName:r.FusedBatchNorm,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:i,mean:s,variance:a,offset:o,scale:u}=e;r.util.assert(s.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),r.util.assert(null==o||s.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),r.util.assert(null==u||s.shape.length===u.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:l}=n;null==l&&(l=.001);const c=[i,s,a];let d=null;null!=o&&(d=o.shape,c.push(o));let h=null;null!=u&&(h=u.shape,c.push(u));const f=(0,r.env)().getBool("WEBGL_PACK_NORMALIZATION")?new Gh(i.shape,s.shape,a.shape,d,h,l):new qh(i.shape,s.shape,a.shape,d,h,l);return t.runWebGLProgram(f,c,c[0].dtype)}};class Xh{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=fl(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(e){if(1===e)return"sourceLoc";if(e<=6)return Yh.slice(0,e).map((e=>"sourceLoc."+e)).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}(this.rank);let i;i=`\n        ${t} sourceLoc;\n        ${t} coords = getOutputCoords();\n        ${e.map(((e,t)=>`sourceLoc.${Yh[t]} = start[${t}] + coords.${Yh[t]};`)).join("\n")}\n      `,this.userCode=`\n      void main() {\n        ${i}\n        setOutput(getSource(${n}));\n      }\n    `}}const Yh=["x","y","z","w","u","v"];class Kh{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=fl(this.rank),n=ld("coords",this.rank),i=ld("sourceLoc",this.rank),r=1===this.rank?"sourceLoc":`vec2(${i.slice(-2).join()})`,s=`getChannel(getSource(${i.join()}), ${r})`,a=`\n      result.x = ${s};\n      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n        ++${i[this.rank-1]};\n        result.y = ${s};\n        --${i[this.rank-1]};\n      }\n    `,o=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {\n        ++${i[this.rank-2]};\n        result.z = ${s};\n        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n          ++${i[this.rank-1]};\n          result.w = ${s};\n        }\n      }\n    `,u=this.rank<=4?`sourceLoc = coords +\n            ${t}(${e.map(((e,t)=>`start[${t}]`)).join()});`:e.map(((e,t)=>`${i[t]} = ${n[t]} + start[${t}];`)).join("\n");this.userCode=`\n      void main() {\n        ${t} coords = getOutputCoords();\n        ${t} sourceLoc;\n        ${u}\n        vec4 result = vec4(0.);\n        ${a}\n        ${o}\n        setOutput(result);\n      }\n    `}}function Jh(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{begin:a,size:o}=i,[u,l]=r.slice_util.parseSliceParams(s,a,o);if(r.slice_util.assertParamsValid(s,u,l),0===r.util.sizeFromShape(l))return n.makeTensorInfo(l,s.dtype,[]);if(n.shouldExecuteOnCPU([s])||"string"===s.dtype){const e=n.texData.get(s.dataId),t=Xc(e.values,u,l,s.shape,s.dtype);return n.makeTensorInfo(l,s.dtype,t)}const{isPacked:c}=n.texData.get(s.dataId),d=r.slice_util.isSliceContinous(s.shape,u,l);if(c||!d){const e=(0,r.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Kh(l):new Xh(l),t=[u];return n.runWebGLProgram(e,[s],s.dtype,t)}return n.uploadToGPU(s.dataId),function(e,t,n,i){const s=i.texData.get(e.dataId),a=i.makeTensorInfo(n,e.dtype),o=i.texData.get(a.dataId);Object.assign(o,s),o.refCount=1,o.shape=n,o.dtype=e.dtype;let u=r.slice_util.computeFlatOffset(t,r.util.computeStrides(e.shape));s.slice&&(u+=s.slice.flatOffset),o.slice={flatOffset:u,origDataId:s.slice&&s.slice.origDataId||e.dataId};const l=i.dataRefCount.get(o.slice.origDataId)||1;return i.dataRefCount.set(o.slice.origDataId,l+1),a}(s,u,l,n)}const Zh={kernelName:r.Slice,backendName:"webgl",kernelFunc:Jh},Qh={kernelName:r.BatchToSpaceND,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{blockShape:a,crops:o}=i;r.util.assert(s.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const u=a.reduce(((e,t)=>e*t)),l=r.backend_util.getReshaped(s.shape,a,u),c=r.backend_util.getPermuted(l.length,a.length),d=r.backend_util.getReshapedPermuted(s.shape,a,u),h=r.backend_util.getSliceBeginCoords(o,a.length),f=r.backend_util.getSliceSize(d,o,a.length),p=[],m=qd({inputs:{x:s},backend:n,attrs:{shape:l}}),g=th({inputs:{x:m},backend:n,attrs:{perm:c}}),y=qd({inputs:{x:g},backend:n,attrs:{shape:d}}),v=Jh({inputs:{x:y},backend:n,attrs:{begin:h,size:f}});return p.push(m),p.push(g),p.push(y),p.forEach((e=>n.disposeIntermediateTensorInfo(e))),v}},ef={kernelName:r.Bincount,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,weights:s}=t,{size:a}=i,o=n.readSync(r.dataId),u=n.readSync(s.dataId),l=wc(o,u,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,l)}},tf={kernelName:r.BroadcastArgs,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:i,s1:s}=t,a=n.readSync(i.dataId),o=n.readSync(s.dataId),u=r.backend_util.assertAndGetBroadcastShape(Array.from(a),Array.from(o));return n.makeTensorInfo([u.length],"int32",Int32Array.from(u))}},nf=zd({opSnippet:"return float(a != b);",cpuKernelImpl:Uc,dtype:"bool"}),rf={kernelName:r.NotEqual,backendName:"webgl",kernelFunc:nf};function sf(e){const{inputs:t,backend:n}=e,{input:i}=t;return Sd({inputs:{x:n.texData.get(i.dataId).complexTensorInfos.real},backend:n})}const af={kernelName:r.Real,backendName:"webgl",kernelFunc:sf},of={kernelName:r.Cast,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:i,attrs:s}=t,{x:a}=n,{dtype:o}=s;if("complex64"===o){if("complex64"===a.dtype)return Sd({inputs:{x:a},backend:i});const t=r.zeros(a.shape),n=e({inputs:{x:a},backend:i,attrs:{dtype:"float32"}}),s=Dd({inputs:{real:n,imag:t},backend:i});return t.dispose(),i.disposeIntermediateTensorInfo(n),s}if("complex64"===a.dtype){const t=sf({inputs:{input:a},backend:i}),n=e({inputs:{x:t},backend:i,attrs:{dtype:o}});return i.disposeIntermediateTensorInfo(t),n}if(!r.util.hasEncodingLoss(a.dtype,o)){const e=Sd({inputs:{x:a},backend:i});return{dataId:e.dataId,shape:e.shape,dtype:o}}if("int32"===o)return function(e,t){const n=new gd(e.shape,"return float(int(x));"),i=t.runWebGLProgram(n,[e],"int32");return{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}(a,i);if("bool"===o){const e=i.makeTensorInfo([],"bool",r.util.getTypedArrayFromDType("bool",1)),t=nf({inputs:{a,b:e},backend:i});return i.disposeIntermediateTensorInfo(e),t}throw new Error(`Error in Cast: failed to cast ${a.dtype} to ${o}`)}},uf="return ceil(x);",lf=Bd({opSnippet:uf,packedOpSnippet:uf,cpuKernelImpl:kc}),cf={kernelName:r.Ceil,backendName:"webgl",kernelFunc:lf};class df{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}class hf{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}const ff={kernelName:r.ClipByValue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{clipValueMin:a,clipValueMax:o}=i;let u;u=(0,r.env)().getBool("WEBGL_PACK_CLIP")?new hf(s.shape):new df(s.shape);const l=[[a],[o]];return n.runWebGLProgram(u,[s],s.dtype,l)}};class pf{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}function mf(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}const gf={kernelName:r.ComplexAbs,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t,r=n.texData.get(i.dataId),s=new pf(i.shape),a=[mf(i,r.complexTensorInfos.real),mf(i,r.complexTensorInfos.imag)];return n.runWebGLProgram(s,a,a[0].dtype)}};class yf{constructor(e){this.outputShape=[],this.outputShape=r.backend_util.computeOutShape(e,1),this.variableNames=e.map(((e,t)=>`T${t}`));const t=new Array(e.length-1);t[0]=e[0][1];for(let n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];const n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let e=1;e<t.length;e++){const i=t[e-1];n.push(`else if (yC < ${t[e]}) setOutput(getT${e}(yR, yC-${i}));`)}const i=t.length,s=t[t.length-1];n.push(`else setOutput(getT${i}(yR, yC-${s}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}class vf{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=r.backend_util.computeOutShape(e,t);const n=this.outputShape,i=n.length,s=fl(i),a=ld("coords",i),o=["x","y","z","w","u","v"].slice(0,i);this.variableNames=e.map(((e,t)=>`T${t}`));const u=new Array(e.length-1);u[0]=e[0][t];for(let n=1;n<u.length;n++)u[n]=u[n-1]+e[n][t];const l=o[t],c=o.slice(-2),d=o.join();let h=`if (${l} < ${u[0]}) {\n        return getChannel(\n            getT0(${d}), vec2(${c.join()}));\n        }`;for(let e=1;e<u.length;e++){const t=u[e-1];h+=`\n        if (${l} < ${u[e]}  && ${l} >= ${u[e-1]}) {\n          return getChannel(\n            getT${e}(${bf(o,l,t)}),\n            vec2(${bf(c,l,t)}));\n        }`}const f=u.length,p=u[u.length-1];h+=`\n        return getChannel(\n          getT${f}(${bf(o,l,p)}),\n          vec2(${bf(c,l,p)}));`,this.userCode=`\n      float getValue(${o.map((e=>"int "+e))}) {\n        ${h}\n      }\n\n      void main() {\n        ${s} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${a}), 0., 0., 0.);\n\n        ${a[i-1]} = ${a[i-1]} + 1;\n        if (${a[i-1]} < ${n[i-1]}) {\n          result.g = getValue(${a});\n        }\n\n        ${a[i-2]} = ${a[i-2]} + 1;\n        if (${a[i-2]} < ${n[i-2]}) {\n          result.a = getValue(${a});\n        }\n\n        ${a[i-1]} = ${a[i-1]} - 1;\n        if (${a[i-2]} < ${n[i-2]} &&\n            ${a[i-1]} < ${n[i-1]}) {\n          result.b = getValue(${a});\n        }\n        setOutput(result);\n      }\n    `}}function bf(e,t,n){const i=e.indexOf(t);return e.map(((e,t)=>t===i?`${e} - ${n}`:e)).join()}function xf(e){const{inputs:t,backend:n}=e,{input:i}=t;return Sd({inputs:{x:n.texData.get(i.dataId).complexTensorInfos.imag},backend:n})}const wf={kernelName:r.Imag,backendName:"webgl",kernelFunc:xf};function Cf(e,t,n){const i=e[0].dtype;if("complex64"===i){const i=e.map((e=>sf({inputs:{input:e},backend:n}))),r=e.map((e=>xf({inputs:{input:e},backend:n}))),s=Cf(i,t,n),a=Cf(r,t,n),o=Dd({inputs:{real:s,imag:a},backend:n});return i.forEach((e=>n.disposeIntermediateTensorInfo(e))),r.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(a),o}let s=n.shouldExecuteOnCPU(e);if("string"===i&&(s=!0),s){const s=e.map((e=>{const i=r.util.sizeFromShape(e.shape.slice(t));return qd({inputs:{x:e},backend:n,attrs:{shape:[-1,i]}})})),a=s.map((e=>({vals:n.readSync(e.dataId),shape:e.shape}))),o=r.backend_util.computeOutShape(s.map((e=>e.shape)),1),u=1===s[0].shape[0],l=Ac(a,o,i,u),c=r.backend_util.computeOutShape(e.map((e=>e.shape)),t),d=n.makeTensorInfo(c,i,l);return s.forEach((e=>n.disposeIntermediateTensorInfo(e))),d}if(e.length>(0,r.env)().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const i=Math.floor(e.length/2),r=Cf(e.slice(0,i),t,n),s=Cf(e.slice(i),t,n),a=Cf([r,s],t,n);return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(s),a}if((0,r.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){const r=new vf(e.map((e=>e.shape)),t);return n.runWebGLProgram(r,e,i)}const{tensors2D:a,outShape:o}=function(e,t,n){const i=r.backend_util.computeOutShape(e.map((e=>e.shape)),t);return{tensors2D:e.map((e=>qd({inputs:{x:e},attrs:{shape:[-1,r.util.sizeFromShape(e.shape.slice(t))]},backend:n}))),outShape:i}}(e,t,n),u=new yf(a.map((e=>e.shape))),l=n.runWebGLProgram(u,a,i);a.forEach((e=>n.disposeIntermediateTensorInfo(e)));const c=qd({inputs:{x:l},attrs:{shape:o},backend:n});return n.disposeIntermediateTensorInfo(l),c}function kf(e){const{inputs:t,backend:n,attrs:i}=e,{axis:s}=i,a=r.util.parseAxisParam(s,t[0].shape)[0],o=r.backend_util.computeOutShape(t.map((e=>e.shape)),a);if(0===r.util.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);const u=t.filter((e=>r.util.sizeFromShape(e.shape)>0));if(1===u.length)return Sd({inputs:{x:u[0]},backend:n});const l=u.map((e=>e.shape));return r.backend_util.assertParamsConsistent(l,a),Cf(u,a,n)}const Af={kernelName:r.Concat,backendName:"webgl",kernelFunc:kf};class _f{constructor(e,t=!1,n=null,i=!1,r=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const s=e.padInfo.top,a=e.padInfo.left,o=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4,m="channelsLast"===e.dataFormat,g=m?1:2,y=m?2:3,v=m?3:1;let b="",x="";n&&(b=i?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:r?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,x="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${b}\n\n      const ivec2 strides = ivec2(${o}, ${u});\n      const ivec2 pads = ivec2(${s}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${v}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${g}], coords[${y}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${d}; wR++) {\n          int xR = xRCorner + wR * ${l};\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${h}; wC++) {\n            int xC = xCCorner + wC * ${c};\n\n            if (xC < 0 || xC >= ${e.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${f}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${m}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===p}) {\n\n              if (${m}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${f}) *\n                    getW(wR, wC, ${f}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${f}, xR, xC) *\n                    getW(wR, wC, ${f}, d2);\n              }\n\n            } else if (${2===p}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2)\n              );\n\n              if (${m}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===p}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2),\n                getW(wR, wC, ${f} + 2, d2)\n              );\n\n              if (${m}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1),\n                  getX(batch, xR, xC, ${f} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC),\n                  getX(batch, ${f} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${w}\n        ${x}\n        setOutput(result);\n      }\n    `}}class Ef{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,i=e.padInfo.left,r=e.strideDepth,s=e.strideHeight,a=e.strideWidth,o=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,d=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${r}, ${s}, ${a});\n      const ivec3 pads = ivec3(${t}, ${n}, ${i});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${c}; wF++) {\n          int xF = xFCorner + wF * ${o};\n\n          if (xF < 0 || xF >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${d}; wR++) {\n            int xR = xRCorner + wR * ${u};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h}; wC++) {\n              int xC = xCCorner + wC * ${l};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${f}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===p}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${f}) *\n                  getW(wF, wR, wC, ${f}, d2);\n              } else if (${2===p}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===p}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1),\n                  getX(batch, xF, xR, xC, ${f} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2),\n                  getW(wF, wR, wC, ${f} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Sf{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=vl(this.outputShape.length);const{dataFormat:n}=t,i=Zu(),r="channelsLast"===n,s=r?0:1,a=r?1:2,o=this.enableShapeUniforms?"if(blockIndex < outShape[1] && pos < outShape[0]) {":`if(blockIndex < ${e[1]} && pos < ${e[0]}) {`;let u="";for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)u+=`\n          blockIndex = rc.y + ${t};\n          pos = rc.x + ${e};\n\n          ${o}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${s}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${a}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${r}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*e+t}] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*e+t}] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${u}\n\n        ${i.output} = result;\n      }\n    `}}function Ff({x:e,filter:t,convInfo:n,backend:i,bias:s=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:u=null}){const l=e.shape,c=i.texData.get(e.dataId),d=n.inChannels,h=l[0]*l[1]*l[2],f=n.outChannels,p="channelsLast"===n.dataFormat;let m;const g=[];if((1!==h&&1!==f||!(d>1e3))&&c.isPacked&&p&&null!=c.texture&&l[2]%2!=0&&r.util.arraysEqual(c.shape.slice(-3),l.slice(-3))){const d=l[0]*l[1]*(l[2]+1),h={dataId:e.dataId,shape:[1,d,n.inChannels],dtype:e.dtype},f=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,r.util.assert(Vu(c.shape,h.shape),(()=>`packed reshape ${c.shape} to ${h.shape} isn't free`));const p=qd({inputs:{x:t},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}});g.push(p);const y=ih({a:h,b:p,backend:i,transposeA:!1,transposeB:!1,bias:s,activation:u,preluActivationWeights:a,leakyreluAlpha:o}),v=i.texData.get(y.dataId);r.util.assert(v.isPacked,(()=>"batchMatMul result is expected to be packed")),c.shape=f,v.shape=n.outShape,m=Sd({inputs:{x:y},backend:i}),m.shape=n.outShape,g.push(y)}else{const r=qd({inputs:{x:e},backend:i,attrs:{shape:[1,p?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],n.inChannels]}}),c=qd({inputs:{x:t},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}}),d=ih({a:r,b:c,transposeA:!1,transposeB:!1,backend:i,bias:s,activation:u,preluActivationWeights:a,leakyreluAlpha:o});m=qd({inputs:{x:d},backend:i,attrs:{shape:n.outShape}}),g.push(r),g.push(c),g.push(d)}for(const e of g)i.disposeIntermediateTensorInfo(e);return m}function Df({x:e,filter:t,convInfo:n,backend:i,bias:s=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:u=null}){const{filterWidth:l,filterHeight:c,inChannels:d,outWidth:h,outHeight:f,dataFormat:p}=n,m="channelsLast"===p,g=l*c*d,y=f*h,v=[g,y],b=[],x=qd({inputs:{x:e},backend:i,attrs:{shape:e.shape.slice(1)}}),w=qd({inputs:{x:t},backend:i,attrs:{shape:[1,g,r.util.sizeFromShape(t.shape)/g]}});b.push(x),b.push(w);const C=new Sf(v,n),k=[x.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],A=i.runWebGLProgram(C,[x],"float32",k),_=qd({inputs:{x:A},backend:i,attrs:{shape:[1,v[0],v[1]]}});b.push(A),b.push(_);const E=null!=s,S=null!=a,F="leakyrelu"===u,D=u?Ld(u,!0):null,$=new Pd(_.shape,w.shape,[1,y,n.outChannels],!0,!1,E,D,S,F),O=[_,w];if(s&&O.push(s),S&&O.push(a),F){const e=i.makeTensorInfo([],"float32",r.util.createScalarValue(o,"float32"));O.push(e),b.push(e)}const N=i.runWebGLProgram($,O,"float32"),I=qd({inputs:{x:N},backend:i,attrs:{shape:m?[1,f,h,n.outChannels]:[1,n.outChannels,f,h]}});b.push(N);for(const e of b)i.disposeIntermediateTensorInfo(e);return I}const $f={kernelName:r.Conv2D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s,filter:a}=t,{strides:o,pad:u,dataFormat:l,dilations:c,dimRoundingMode:d}=i,h=r.backend_util.convertConv2DDataFormat(l),f=r.backend_util.computeConv2DInfo(s.shape,a.shape,o,c,u,d,!1,h);let p;if(1!==f.filterHeight||1!==f.filterWidth||1!==f.dilationHeight||1!==f.dilationWidth||1!==f.strideHeight||1!==f.strideWidth||"SAME"!==f.padInfo.type&&"VALID"!==f.padInfo.type)if((0,r.env)().getBool("WEBGL_CONV_IM2COL")&&1===s.shape[0])p=Df({x:s,filter:a,convInfo:f,backend:n});else{const e=new _f(f);p=n.runWebGLProgram(e,[s,a],"float32")}else p=Ff({x:s,filter:a,convInfo:f,backend:n});const m=qd({inputs:{x:p},backend:n,attrs:{shape:f.outShape}});return n.disposeIntermediateTensorInfo(p),m}};class Of{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,i=e.padInfo.top,r=e.padInfo.left,s="channelsLast"===e.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${t} - ${i};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${r};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              if (${s}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Nf{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,i=e.strideHeight,r=e.strideWidth,s="channelsLast"===e.dataFormat,a=t-1-e.padInfo.top,o=n-1-e.padInfo.left,u=s?1:2,l=s?2:3,c=s?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${a}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${c}];\n\n        ivec2 dyCorner = ivec2(coords[${u}], coords[${l}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${i}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${r}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n\n              if (${s}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class If{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,n=e.strideHeight,i=e.strideWidth,r=e.padInfo.front,s=e.padInfo.top,a=e.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yF = 0; yF < ${e.outDepth}; yF++) {\n            int xF = wF + yF * ${t} - ${r};\n\n            if (xF < 0 || xF >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${e.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${s};\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${e.outWidth}; yC++) {\n                int xC = wC + yC * ${i} - ${a};\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Tf{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,i=e.filterWidth,r=e.strideDepth,s=e.strideHeight,a=e.strideWidth,o=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=i-1-e.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${o}, ${u}, ${l});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${t}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${r}.0;\n\n          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${t} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${s}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${i}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${a}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${i} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const Rf={kernelName:r.Conv2DBackpropFilter,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s,dy:a}=t,{strides:o,pad:u,dataFormat:l,dimRoundingMode:c,filterShape:d}=i,h=r.backend_util.convertConv2DDataFormat(l),f=r.backend_util.computeConv2DInfo(s.shape,d,o,1,u,c,!1,h),p=new Of(f);return n.runWebGLProgram(p,[s,a],"float32")}},Mf={kernelName:r.Conv2DBackpropInput,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:s,filter:a}=t,{inputShape:o,strides:u,pad:l,dataFormat:c,dimRoundingMode:d}=i,h=r.backend_util.convertConv2DDataFormat(c),f=r.backend_util.computeConv2DInfo(o,a.shape,u,1,l,d,!1,h),p=new Nf(f);return n.runWebGLProgram(p,[s,a],"float32")}},Bf={kernelName:r.Conv3D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s,filter:a}=t,{strides:o,pad:u,dilations:l}=i,c=r.backend_util.computeConv3DInfo(s.shape,a.shape,o,l,u),d=new Ef(c);return n.runWebGLProgram(d,[s,a],"float32")}},zf={kernelName:r.Conv3DBackpropFilterV2,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s,dy:a}=t,{strides:o,pad:u,filterShape:l}=i,c=r.backend_util.computeConv3DInfo(s.shape,l,o,1,u),d=new If(c);return n.runWebGLProgram(d,[s,a],"float32")}},Lf={kernelName:r.Conv3DBackpropInputV2,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:s,filter:a}=t,{pad:o,strides:u,inputShape:l}=i,c=r.backend_util.computeConv3DInfo(l,a.shape,u,1,o),d=new Tf(c);return n.runWebGLProgram(d,[s,a],"float32")}},Pf=Bd({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),jf={kernelName:r.Cos,backendName:"webgl",kernelFunc:Pf},Uf=Bd({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),Wf={kernelName:r.Cosh,backendName:"webgl",kernelFunc:Uf};class Vf{constructor(e,t,n,i,r){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[s,a,o,u]=e,[l]=t,[c,d]=n;this.outputShape=[l,c,d,u];const h="bilinear"===i?1:0,[f,p]=[a-1+".0",o-1+".0"],[m,g,y]=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${f}`],[v,b,x]=d>1?[""+(o-1)/(d-1),"(x2-x1) * width_ratio",`x1*${p} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${p}`];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${v});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${s}) {\n          return;\n        }\n\n        float height_scale = ${g};\n        float width_scale = ${b};\n\n        float in_y = ${y};\n        if( in_y < 0.0 || in_y > ${f} ) {\n          setOutput(float(${r}));\n          return;\n        }\n        float in_x = ${x};\n        if( in_x < 0.0 || in_x > ${p} ) {\n          setOutput(float(${r}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${h} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}const qf={kernelName:r.CropAndResize,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{image:r,boxes:s,boxInd:a}=t,{cropSize:o,method:u,extrapolationValue:l}=i,c=new Vf(r.shape,s.shape,o,u,l);return n.runWebGLProgram(c,[r,s,a],"float32")}};class Gf{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}],this.outputShape=e;const i=e.length,r=t?"0.0":`getX(${Hf(i,"coords")})`,s=e[e.length-1];let a="",o="";t?(a=n?"end != "+(s-1):"end != 0",o=n?"end + 1":"end - 1"):(a=n?`end + pow2 < ${s}`:"end >= pow2",o=n?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${fl(i)} coords = getOutputCoords();\n        int end = ${Xf(i,"coords")};\n        float val = ${r};\n        int pow2 = int(pow(2.0, index));\n        if (${a}) {\n          int idx = ${o};\n          ${Xf(i,"coords")} = idx;\n          val += getX(${Hf(i,"coords")});\n        }\n        setOutput(val);\n      }\n    `}}function Hf(e,t){if(1===e)return`${t}`;if(2===e)return`${t}.x, ${t}.y`;if(3===e)return`${t}.x, ${t}.y, ${t}.z`;if(4===e)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw Error(`Cumulative sum for rank ${e} is not yet supported`)}function Xf(e,t){if(1===e)return`${t}`;if(2===e)return`${t}.y`;if(3===e)return`${t}.z`;if(4===e)return`${t}.w`;throw Error(`Cumulative sum for rank ${e} is not yet supported`)}const Yf={kernelName:r.Cumsum,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{axis:a,exclusive:o,reverse:u}=i,l=s.shape.length,c=r.backend_util.getAxesPermutation([a],l);let d=s;null!=c&&(d=th({inputs:{x:s},backend:n,attrs:{perm:c}}));const h=r.backend_util.getInnerMostAxes(1,l)[0];if(h!==l-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${s.shape.length-1} but got axis=${a}`);const f=d.shape[h];let p=Sd({inputs:{x:d},backend:n});for(let e=0;e<=Math.ceil(Math.log2(f))-1;e++){const t=new Gf(d.shape,!1,u),i=[[e]],r=p;p=n.runWebGLProgram(t,[p],p.dtype,i),n.disposeIntermediateTensorInfo(r)}if(o){const e=new Gf(d.shape,o,u),t=p;p=n.runWebGLProgram(e,[p],p.dtype),n.disposeIntermediateTensorInfo(t)}if(null!=c){const e=th({inputs:{x:p},backend:n,attrs:{perm:r.backend_util.getUndoAxesPermutation(c)}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),e}return p}},Kf={kernelName:r.DenseBincount,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r,weights:s}=t,{size:a,binaryOutput:o}=i;if(1===r.shape.length){const e=n.readSync(r.dataId),t=n.readSync(s.dataId),i=wc(e,t,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,i)}if(2===r.shape.length){const e=n.bufferSync(r),t=n.bufferSync(s),i=Cc(e,t,a,o);return n.makeTensorInfo(i.shape,s.dtype,i.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}};class Jf{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${t};\n      int offset_h = imod(h, ${t});\n      int in_w = w / ${t};\n      int offset_w = imod(w, ${t});\n      int offset_d = (offset_h * ${t} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}const Zf={kernelName:r.DepthToSpace,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:r}=t,{blockSize:s,dataFormat:a}=i,o=r.shape[0],u=("NHWC"===a?r.shape[1]:r.shape[2])*s,l=("NHWC"===a?r.shape[2]:r.shape[3])*s,c=("NHWC"===a?r.shape[3]:r.shape[1])/(s*s),d=new Jf("NHWC"===a?[o,u,l,c]:[o,c,u,l],s,a);return n.runWebGLProgram(d,[r],r.dtype)}};class Qf{constructor(e,t=!1,n=null,i=!1,r=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=vl(this.outputShape.length);const s=e.filterHeight,a=e.filterWidth,o=e.outChannels/e.inChannels;let u="",l="";n&&(u=i?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:r?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,l="result = activation(result);");const c=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${u}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${o};\n        int q = d2 - d1 * ${o};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${s}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${a}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${c}\n        ${l}\n        setOutput(result);\n      }\n    `}}class ep{constructor(e,t=!1,n=null,i=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=vl(this.outputShape.length);const a=e.outChannels/e.inChannels,o=e.padInfo.left,u=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,d=e.filterWidth,h=d;let f="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let e=0;e<d;e++)f+=`\n          vec4 xTexelC${2*e};\n          int xTexelC${2*e}Ready;\n          vec4 xTexelC${2*e+1};\n          int xTexelC${2*e+1}Ready;\n          vec4 xC${e};`;f+=`\n    for (int r = 0; r < ${c}; r++) {\n      `;for(let e=0;e<d;e++)f+=`\n          xTexelC${2*e} = vec4(0.0);\n          xTexelC${2*e}Ready = 0;\n          xTexelC${2*e+1} = vec4(0.0);\n          xTexelC${2*e+1}Ready = 0;\n          xC${e} = vec4(0.0);`;f+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let e=0;e<(h+1)/2;e++){const t=2*e;if(f+=`\n          xC = xCCorner + ${t*l};\n          `,1===u){if(t<d&&(o%2==1?(f+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n              `,f+=1===l&&t>0?`\n                xC${t} = vec4(xTexelC${t-2}.zw, xTexelC${t}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${t} = vec4(previous.zw, xTexelC${t}.xy);\n                  } else {\n                    xC${t} = vec4(0.0, 0.0, xTexelC${t}.xy);\n                  }\n                  `):f+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xC${t} = xTexelC${t};\n                `,t+1<d)){const e=o%2==0?r.util.nearestLargerEven(l):l;l%2==0&&o%2==1||l%2!=0&&o%2!=1?(f+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${e};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                    xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${t+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${t+1}Ready = 1;\n                  }\n                  `,l>1&&(f+=`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                      xTexelC${t} = getX(batch, xR, xCOffset, d1);\n                      xTexelC${t}Ready = 1;\n                    }\n                    `),f+=`\n                  xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.xy);\n                  `):f+=1===e?`\n                    xC${t+1} = xTexelC${t};\n                    `:`\n                    xCOffset = xC + ${e};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                      xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${t+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${t+1}Ready = 1;\n                    }\n\n                    xC${t+1} = xTexelC${t+1};\n                    `}}else t<d&&(o%2==1?(f+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n              `,t+1<d&&(f+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${t+1} = vec4(xTexelC${t+1}.xy, final.xy);\n                `)):(f+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(\n                  xTexelC${t}.xy, xTexelC${t+1}.xy);\n              `,t+1<d&&(f+=`\n                  xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n                `)));t<d&&(f+=`\n            wTexel = getW(r, ${t}, d1, q);\n            dotProd += xC${t} * vec4(wTexel.xz, wTexel.xz);\n          `,t+1<d&&(f+=`\n              wTexel = getW(r, ${t+1}, d1, q);\n              dotProd += xC${t+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}f+="\n    }\n  ",f+="\n      }\n    ";let p="",m="";n&&(p=i?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:s?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,m="result = activation(result);");const g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${p}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${a};\n        int q = d2 - d1 * ${a};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${f}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${g}\n        ${m}\n        setOutput(result);\n      }\n    `}}const tp={kernelName:r.DepthwiseConv2dNative,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s,filter:a}=t,{strides:o,pad:u,dilations:l,dimRoundingMode:c}=i;let d=l;null==d&&(d=[1,1]),r.util.assert(r.backend_util.eitherStridesOrDilationsAreOne(o,d),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`));const h=r.backend_util.computeConv2DInfo(s.shape,a.shape,o,d,u,c,!0);let f;f=(0,r.env)().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels==1?new ep(h):new Qf(h);const p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(f,[s,a],"float32",p)}};class np{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,i=e.padInfo.top,r=e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${s} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${t} - ${i};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${r};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class ip{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,i=e.strideHeight,r=e.strideWidth,s=t-1-e.padInfo.top,a=n-1-e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${s}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${i}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${r}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${o}; dm++) {\n              int d2 = d1 * ${o} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const rp={kernelName:r.DepthwiseConv2dNativeBackpropFilter,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s,dy:a}=t,{strides:o,dilations:u,pad:l,dimRoundingMode:c,filterShape:d}=i,h=r.backend_util.computeConv2DInfo(s.shape,d,o,u,l,c,!0),f=new np(h);return n.runWebGLProgram(f,[s,a],"float32")}},sp={kernelName:r.DepthwiseConv2dNativeBackpropInput,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:s,filter:a}=t,{strides:o,dilations:u,pad:l,dimRoundingMode:c,inputShape:d}=i,h=r.backend_util.computeConv2DInfo(d,a.shape,o,u,l,c,!0),f=new ip(h);return n.runWebGLProgram(f,[s,a],"float32")}};class ap{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}const op={kernelName:r.Diag,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t,s=[...i.shape,...i.shape],a=r.util.sizeFromShape(i.shape),o=qd({inputs:{x:i},backend:n,attrs:{shape:[a]}}),u=new ap(a),l=n.runWebGLProgram(u,[o],o.dtype),c=qd({inputs:{x:l},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}};class up{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:n,padInfo:i,strideHeight:r,strideWidth:s,filterHeight:a,filterWidth:o,dilationHeight:u,dilationWidth:l}=e,{top:c,left:d}=i;this.userCode=`\n      const ivec2 strides = ivec2(${r}, ${s});\n      const ivec2 pads = ivec2(${c}, ${d});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${a}; h++) {\n          int hIn = hBeg + h * ${u};\n\n          if (hIn >= 0 && hIn < ${t}) {\n            for (int w = 0; w < ${o}; w++) {\n              int wIn = wBeg + w * ${l};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}const lp={kernelName:r.Dilation2D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s,filter:a}=t,{strides:o,pad:u,dilations:l}=i,c=r.backend_util.computeDilation2DInfo(s.shape,a.shape,o,u,"NHWC",l);let d;const h=new up(c);d=n.runWebGLProgram(h,[s,a],"float32");const f=qd({inputs:{x:d},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(d),f}},cp={kernelName:r.Einsum,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{equation:s}=i,a=t,{allDims:o,summedDims:u,idDims:l}=r.backend_util.decodeEinsumEquation(s,a.length);r.backend_util.checkEinsumDimSizes(o.length,l,a);const{path:c,steps:d}=r.backend_util.getEinsumComputePath(u,l),h=d.length;let f=null,p=o.length;const m=[];for(let e=0;e<h;++e){for(const t of d[e]){const{permutationIndices:e,expandDims:i}=r.backend_util.getEinsumPermutation(p,l[t]);let s;r.backend_util.isIdentityPermutation(e)?s=a[t]:(s=th({inputs:{x:a[t]},backend:n,attrs:{perm:e}}),m.push(s));const o=s.shape.slice();for(let e=0;e<i.length;++e)o.splice(i[e],0,1);r.util.arraysEqual(s.shape,o)||(s=qd({inputs:{x:s},backend:n,attrs:{shape:o}}),m.push(s)),null===f?f=s:(f=Wd({inputs:{a:s,b:f},backend:n}),m.push(f))}e<h-1&&(c[e]>=0&&(f=Qd({inputs:{x:f},backend:n,attrs:{axis:c[e]-(o.length-p),keepDims:!1}}),m.push(f)),p--)}for(const e of m)e!==f&&n.disposeIntermediateTensorInfo(e);return f}},dp=Bd({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),hp={kernelName:r.Elu,backendName:"webgl",kernelFunc:dp},fp={kernelName:r.EluGrad,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n}=e,{dy:i,y:s}=t,a=(0,r.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ed("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",i.shape,s.shape):new _d("return (b >= 1.0) ? a : a * (b + 1.0);",i.shape,s.shape);return n.runWebGLProgram(a,[i,s],i.dtype)}},pp=zd({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:_c}),mp={kernelName:r.Equal,backendName:"webgl",kernelFunc:pp},gp=Bd({opSnippet:`\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = ${r.backend_util.ERF_P};\n  float a1 = ${r.backend_util.ERF_A1};\n  float a2 = ${r.backend_util.ERF_A2};\n  float a3 = ${r.backend_util.ERF_A3};\n  float a4 = ${r.backend_util.ERF_A4};\n  float a5 = ${r.backend_util.ERF_A5};\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n`}),yp={kernelName:r.Erf,backendName:"webgl",kernelFunc:gp},vp="return exp(x);",bp=Bd({opSnippet:vp,packedOpSnippet:vp,cpuKernelImpl:Ec,dtype:"float32"}),xp={kernelName:r.Exp,backendName:"webgl",kernelFunc:bp};function wp(e){const{inputs:t,attrs:n,backend:i}=e,{dim:s}=n,{input:a}=t,o=a.shape.length,u=a.shape.slice();let l=s;return s<0&&(r.util.assert(-(o+1)<=s,(()=>`Axis must be in the interval [${-(o+1)}, ${o}]`)),l=o+s+1),u.splice(l,0,1),qd({inputs:{x:a},backend:i,attrs:{shape:u}})}const Cp={kernelName:r.ExpandDims,backendName:"webgl",kernelFunc:wp},kp="return exp(x) - 1.0;",Ap=Bd({opSnippet:kp,packedOpSnippet:kp,cpuKernelImpl:Sc}),_p={kernelName:r.Expm1,backendName:"webgl",kernelFunc:Ap};class Ep{constructor(e,t,n){this.variableNames=["real","imag"];const i=t[1];this.outputShape=t;const r=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=n?`${i}.0`:"1.0";let a;if("real"===e)a="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);a="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${r};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${a}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${i});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${i}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${s};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}function Sp(e,t,n){const i=n.texData.get(e.dataId),s=r.util.sizeFromShape(e.shape),a=e.shape[e.shape.length-1],o=qd({inputs:{x:e},backend:n,attrs:{shape:[s/a,a]}}),u=o.shape,l=new Ep("real",u,t),c=new Ep("imag",u,t),d=[{dataId:i.complexTensorInfos.real.dataId,dtype:i.complexTensorInfos.real.dtype,shape:u},{dataId:i.complexTensorInfos.imag.dataId,dtype:i.complexTensorInfos.imag.dtype,shape:u}],h=n.runWebGLProgram(l,d,"float32"),f=n.runWebGLProgram(c,d,"float32"),p=Dd({inputs:{real:h,imag:f},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f);const m=qd({inputs:{x:p},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(p),m}const Fp={kernelName:r.FFT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:i}=t;return Sp(i,!1,n)}};class Dp{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}function $p(e){const{backend:t,attrs:n}=e,{shape:i,value:s}=n;let{dtype:a}=n;if(a=a||r.util.inferDtype(s),"string"===a){const e=r.util.getArrayFromDType(a,r.util.sizeFromShape(i));return e.fill(s),t.makeTensorInfo(i,a,e)}{const e=new Dp(i,s),n=[[s]];return t.runWebGLProgram(e,[],a,n)}}const Op={kernelName:r.Fill,backendName:"webgl",kernelFunc:$p};class Np{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${t} - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${t}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}const Ip={kernelName:r.FlipLeftRight,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{const{image:n}=e,i=t,r=new Np(n.shape);return i.runWebGLProgram(r,[n],n.dtype)}},Tp="return floor(x);",Rp=Bd({opSnippet:Tp,packedOpSnippet:Tp,cpuKernelImpl:Fc}),Mp={kernelName:r.Floor,backendName:"webgl",kernelFunc:Rp},Bp=zd({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),zp={kernelName:r.FloorDiv,backendName:"webgl",kernelFunc:Bp};class Lp{constructor(e){this.variableNames=["A"];const t=Zu(),[n,i]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${n}.0);\n\n        vec4 values = ${t.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}class Pp{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Zu(),[n,i]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${i}.0, ${n}.0);\n            vec4 values = ${t.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${t.output} = result;\n      }\n    `}}const jp={kernelName:r.FromPixels,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e;let{pixels:s}=t;const{numChannels:a}=i,o="undefined"!=typeof HTMLVideoElement&&s instanceof HTMLVideoElement,u="undefined"!=typeof HTMLImageElement&&s instanceof HTMLImageElement,[l,c]=o?[s.videoWidth,s.videoHeight]:[s.width,s.height],d=[c,l],h=[c,l,a];(u||o)&&(null==Up&&(Up=document.createElement("canvas").getContext("2d")),Up.canvas.width=l,Up.canvas.height=c,Up.drawImage(s,0,0,l,c),s=Up.canvas);const f=n.makeTensorInfo(d,"int32");n.texData.get(f.dataId).usage=ku.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),s);const p=(0,r.env)().getBool("WEBGL_PACK")?new Pp(h):new Lp(h),m=n.runWebGLProgram(p,[f],"int32");return n.disposeData(f.dataId),m}};let Up;const Wp={kernelName:r.FusedConv2D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s,filter:a,bias:o,preluActivationWeights:u}=t,{strides:l,pad:c,dataFormat:d,dilations:h,dimRoundingMode:f,activation:p,leakyreluAlpha:m}=i,g=r.backend_util.convertConv2DDataFormat(d),y=r.backend_util.computeConv2DInfo(s.shape,a.shape,l,h,c,f,!1,g);let v;const b=[];if(1!==y.filterHeight||1!==y.filterWidth||1!==y.dilationHeight||1!==y.dilationWidth||1!==y.strideHeight||1!==y.strideWidth||"SAME"!==y.padInfo.type&&"VALID"!==y.padInfo.type)if((0,r.env)().getBool("WEBGL_CONV_IM2COL")&&1===s.shape[0])v=Df({x:s,filter:a,convInfo:y,backend:n,bias:o,activation:p,preluActivationWeights:u,leakyreluAlpha:m});else{const e=null!=o,t=null!=u,i="leakyrelu"===p,l=p?Ld(p,!1):null,c=new _f(y,e,l,t,i),d=[s,a];if(o&&d.push(o),u&&d.push(u),i){const e=n.makeTensorInfo([],"float32",r.util.createScalarValue(m,"float32"));d.push(e),b.push(e)}v=n.runWebGLProgram(c,d,"float32")}else v=Ff({x:s,filter:a,convInfo:y,backend:n,bias:o,activation:p,preluActivationWeights:u,leakyreluAlpha:m});const x=qd({inputs:{x:v},backend:n,attrs:{shape:y.outShape}});return b.push(v),b.forEach((e=>n.disposeIntermediateTensorInfo(e))),x}},Vp={kernelName:r.FusedDepthwiseConv2D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s,filter:a,bias:o,preluActivationWeights:u}=t,{strides:l,pad:c,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=i,m=[];let g=d;null==g&&(g=[1,1]),r.util.assert(r.backend_util.eitherStridesOrDilationsAreOne(l,g),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${g}'`));const y=r.backend_util.computeConv2DInfo(s.shape,a.shape,l,g,c,h,!0),v=(0,r.env)().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels==1,b=f?Ld(f,v):null,x=[s,a],w=null!=o,C=null!=u,k="leakyrelu"===f;if(w&&x.push(o),C&&x.push(u),k){const e=n.makeTensorInfo([],"float32",r.util.createScalarValue(p,"float32"));x.push(e),m.push(e)}let A;A=v?new ep(y,w,b,C,k):new Qf(y,w,b,C,k);const _=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],E=n.runWebGLProgram(A,x,"float32",_);return m.forEach((e=>n.disposeIntermediateTensorInfo(e))),E}};class qp{constructor(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;const i=fl(t.length),r=fl(n.length),s=this.sliceDim>1?"strides[j]":"strides";this.userCode=`\n        ${i} strides = ${i}(${this.strides});\n         void main() {\n          ${r} coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ${this.sliceDim}; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ${s};\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      `}}const Gp={kernelName:r.GatherNd,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:i,indices:s}=t,a=s.shape,o=a[a.length-1],u=r.util.sizeFromShape(i.shape),[l,c,d,h]=r.backend_util.prepareAndValidate(i,s),f=qd({inputs:{x:s},backend:n,attrs:{shape:[c,o]}}),p=qd({inputs:{x:i},backend:n,attrs:{shape:[r.util.sizeFromShape(i.shape)/d,d]}});if(n.shouldExecuteOnCPU([i,s])||"string"===i.dtype){const e=n.readSync(s.dataId),t=n.bufferSync(i),r=Dc(e,t,i.dtype,c,o,d,h,i.shape,u);return n.makeTensorInfo(l,i.dtype,r.values)}const m=new qp(o,h,[c,d]),g=n.runWebGLProgram(m,[p,f],p.dtype),y=qd({inputs:{x:g},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),y}};class Hp{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const n=fl(this.rank),i=function(e,t){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[];for(let t=0;t<e.length;t++)2===t?i.push("int(getIndices(resRC.x, resRC.z))"):i.push(`${n[t]}`);return i.join()}(e);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        setOutput(getA(${i}));\n      }\n    `}}function Xp(e){const{inputs:t,backend:n,attrs:i}=e,{x:s,indices:a}=t,{axis:o,batchDims:u}=i,l=r.util.parseAxisParam(o,s.shape)[0],c=n.readSync(a.dataId),d=s.shape[l];for(let e=0;e<c.length;++e){const t=c[e];r.util.assert(t<=d-1&&t>=0,(()=>`GatherV2: the index value ${t} is not in [0, ${d-1}]`))}const h=r.backend_util.segment_util.collectGatherOpShapeInfo(s,a,l,u),f=r.util.sizeFromShape(a.shape),p=[],m=qd({inputs:{x:s},backend:n,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),g=qd({inputs:{x:a},backend:n,attrs:{shape:[h.batchSize,f/h.batchSize]}});p.push(m),p.push(g);const y=[h.batchSize,h.outerSize,f/h.batchSize,h.sliceSize];if(n.shouldExecuteOnCPU([s,a])||"string"===s.dtype){const e=n.bufferSync(g),t=n.bufferSync(m),i=$c(t,e,y);return p.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(h.outputShape,i.dtype,i.values)}const v=new Hp(m.shape,y),b=n.runWebGLProgram(v,[m,g],m.dtype);p.push(b);const x=qd({inputs:{x:b},backend:n,attrs:{shape:h.outputShape}});return p.forEach((e=>n.disposeIntermediateTensorInfo(e))),x}const Yp={kernelName:r.GatherV2,backendName:"webgl",kernelFunc:Xp},Kp=zd({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:Oc,dtype:"bool"}),Jp={kernelName:r.Greater,backendName:"webgl",kernelFunc:Kp},Zp=zd({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:Nc}),Qp={kernelName:r.GreaterEqual,backendName:"webgl",kernelFunc:Zp},em={kernelName:r.IFFT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:i}=t;return Sp(i,!0,n)}},tm=Bd({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),nm={kernelName:r.IsFinite,backendName:"webgl",kernelFunc:tm},im=Bd({opSnippet:"return float(isinf(x));",dtype:"bool"}),rm={kernelName:r.IsInf,backendName:"webgl",kernelFunc:im},sm=Bd({opSnippet:"return float(isnan(x));",dtype:"bool"}),am={kernelName:r.IsNan,backendName:"webgl",kernelFunc:sm},om=zd({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:Ic,dtype:"bool"}),um={kernelName:r.Less,backendName:"webgl",kernelFunc:om},lm=zd({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:Tc,dtype:"bool"}),cm={kernelName:r.LessEqual,backendName:"webgl",kernelFunc:lm},dm={kernelName:r.LinSpace,backendName:"webgl",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:i,stop:r,num:s}=n,a=Rc(i,r,s);return t.makeTensorInfo([a.length],"float32",a)}},hm=Bd({opSnippet:"if (x < 0.0) return NAN;\n  return log(x);",packedOpSnippet:"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Mc}),fm={kernelName:r.Log,backendName:"webgl",kernelFunc:hm},pm=Bd({opSnippet:"return log(1.0 + x);"}),mm={kernelName:r.Log1p,backendName:"webgl",kernelFunc:pm},gm=zd({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),ym={kernelName:r.LogicalAnd,backendName:"webgl",kernelFunc:gm},vm=Bd({opSnippet:"return float(!(x >= 1.0));"}),bm={kernelName:r.LogicalNot,backendName:"webgl",kernelFunc:vm},xm=zd({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),wm={kernelName:r.LogicalOr,backendName:"webgl",kernelFunc:xm};class Cm{constructor(e,t,n,i,r){this.variableNames=["x"],this.outputShape=[];const s=t,a=e[3]-1;let o;this.outputShape=e;const u=`float(${n}) + float(${i}) * sum`;o=.5===r?`inversesqrt(${u})`:1===r?`1.0/(${u})`:`exp(log(${u}) * float(-${r}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${s}; j <= ${s}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${a}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${o};\n        setOutput(val);\n      }\n    `}}class km{constructor(e,t,n,i,r){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const s=t,a=e[3]-1;let o;this.outputShape=e;const u=`float(${n}) + float(${i}) * sum`;o=.5===r?`inversesqrt(${u})`:1===r?`1.0/(${u})`:`exp(log(${u}) * float(-${r}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${s};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${s}; j <= ${s}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${o};\n        setOutput(result);\n      }\n    `}}const Am={kernelName:r.LRN,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{depthRadius:a,bias:o,alpha:u,beta:l}=i,c=(0,r.env)().getBool("WEBGL_PACK_NORMALIZATION")?new km(s.shape,a,o,u,l):new Cm(s.shape,a,o,u,l);return n.runWebGLProgram(c,[s],s.dtype)}};class _m{constructor(e,t,n,i,r){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=i,this.beta=r,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${t})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${t} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${i}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${i})\n                * float(${r})\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${r});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}const Em={kernelName:r.LRNGrad,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{x:r,y:s,dy:a}=t,{depthRadius:o,bias:u,alpha:l,beta:c}=i,d=new _m(r.shape,o,u,l,c);return n.runWebGLProgram(d,[r,s,a],r.dtype)}};function Sm(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{reductionIndices:a,keepDims:o}=i,u=s.shape.length,l=r.util.parseAxisParam(a,s.shape);let c=l;const d=r.backend_util.getAxesPermutation(c,u),h=null!=d,f=n.shouldExecuteOnCPU([s]);let p=s;if(h){if(f){const e=n.texData.get(p.dataId).values,t=new Array(u);for(let e=0;e<t.length;e++)t[e]=s.shape[d[e]];const i=ad(e,s.shape,s.dtype,d,t);p=n.makeTensorInfo(t,s.dtype),n.texData.get(p.dataId).values=i}else p=Zd(s,d,n);c=r.backend_util.getInnerMostAxes(c.length,u)}r.backend_util.assertAxesAreInnerMostDims("max",c,u);const[m,g]=r.backend_util.computeOutAndReduceShapes(p.shape,c);let y,v=m;if(o&&(v=r.backend_util.expandShapeToKeepDim(m,l)),f){const e=n.texData.get(p.dataId).values,t=Bc(e,r.util.sizeFromShape(g),v,s.dtype);y=n.makeTensorInfo(v,s.dtype),n.texData.get(y.dataId).values=t}else y=function(e,t,n,i){const s=r.util.sizeFromShape(t),a=qd({inputs:{x:e},attrs:{shape:[r.util.sizeFromShape(e.shape)/s,s]},backend:i}),o=Yd(a,e.dtype,"max",i),u=qd({inputs:{x:o},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(a),i.disposeIntermediateTensorInfo(o),u}(p,g,v,n);return h&&n.disposeIntermediateTensorInfo(p),y}const Fm={kernelName:r.Max,backendName:"webgl",kernelFunc:Sm},Dm=zd({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:zc}),$m={kernelName:r.Maximum,backendName:"webgl",kernelFunc:Dm},Om={kernelName:r.MaxPool,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t;Ku(s,"maxPool");const{filterSize:a,strides:o,pad:u,dimRoundingMode:l}=i;r.util.assert(r.backend_util.eitherStridesOrDilationsAreOne(o,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const c=r.backend_util.computePool2DInfo(s.shape,a,o,1,u,l);if(1===c.filterWidth&&1===c.filterHeight&&r.util.arraysEqual(c.inShape,c.outShape))return Sd({inputs:{x:s},backend:n});const d=new Mh(c,"max",!1);return n.runWebGLProgram(d,[s],s.dtype)}},Nm={kernelName:r.MaxPool3D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{filterSize:a,strides:o,pad:u,dataFormat:l,dimRoundingMode:c}=i,d=r.backend_util.computePool3DInfo(s.shape,a,o,[1,1,1],u,c,l),h=new Bh(d,"max",!1);return n.runWebGLProgram(h,[s],s.dtype)}};class Im{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,n=e.strideWidth,i=e.dilationHeight,r=e.effectiveFilterHeight,s=e.effectiveFilterWidth,a=r-1-e.padInfo.top,o=s-1-e.padInfo.left,u=r*s-1;this.userCode=`\n      const ivec2 pads = ivec2(${a}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${r};\n          wR += ${i}) {\n          float dyR = float(dyRCorner + wR) / ${t}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${s}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${n}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${s} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Tm{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,n=e.strideHeight,i=e.strideWidth,r=e.dilationDepth,s=e.dilationHeight,a=e.dilationWidth,o=e.effectiveFilterDepth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=o-1-e.padInfo.front,d=u-1-e.padInfo.top,h=l-1-e.padInfo.left,f=o*u*l-1;this.userCode=`\n      const ivec3 pads = ivec3(${c}, ${d}, ${h});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${o};\n           wD += ${r}) {\n          float dyD = float(dyDCorner + wD) / ${t}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${u};\n              wR += ${s}) {\n            float dyR = float(dyRCorner + wR) / ${n}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${l};\n                wC += ${a}) {\n              float dyC = float(dyCCorner + wC) / ${i}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${f} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${u} * ${l} +\n                  wR * ${l} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const Rm={kernelName:r.MaxPool3DGrad,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:s,input:a}=t,o=a,{filterSize:u,strides:l,pad:c,dimRoundingMode:d}=i,h=r.backend_util.computePool3DInfo(o.shape,u,l,[1,1,1],c,d),f=new Bh(h,"max",!0),p=n.runWebGLProgram(f,[o],o.dtype),m=new Tm(h),g=n.runWebGLProgram(m,[s,p],o.dtype);return n.disposeIntermediateTensorInfo(p),g}},Mm={kernelName:r.MaxPoolGrad,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{dy:s,input:a,output:o}=t,u=a;Ku([a,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:d,dimRoundingMode:h}=i,f=r.backend_util.computePool2DInfo(u.shape,l,c,1,d,h),p=new Mh(f,"max",!0),m=n.runWebGLProgram(p,[u],u.dtype),g=new Im(f),y=n.runWebGLProgram(g,[s,m],u.dtype);return n.disposeIntermediateTensorInfo(m),y}},Bm={kernelName:r.MaxPoolWithArgmax,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:i}=e,{filterSize:s,strides:a,pad:o,includeBatchInIndex:u}=t,l=n;r.util.assert(4===i.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${i.shape.length}.`));const c=[1,1];r.util.assert(r.backend_util.eitherStridesOrDilationsAreOne(a,c),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${c}'`));const d=r.backend_util.computePool2DInfo(i.shape,s,a,c,o),[h,f]=function(e,t,n,i){let r=new Mh(n,"max",!1);const s=i.runWebGLProgram(r,[e],"float32");return r=new Mh(n,"max",!0,!0,t),[s,i.runWebGLProgram(r,[e],"float32")]}(i,u,d,l);return[h,f]}},zm={kernelName:r.Mean,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:i}=e,{keepDims:s,axis:a}=t,o=n,u=i.shape.length,l=r.util.parseAxisParam(a,i.shape);let c=l;const d=r.backend_util.getAxesPermutation(c,u),h=null!=d,f=o.shouldExecuteOnCPU([i]),p=[];let m=i;if(h){if(f){const e=o.texData.get(m.dataId).values,t=new Array(u);for(let e=0;e<t.length;e++)t[e]=i.shape[d[e]];const n=ad(e,i.shape,i.dtype,d,t);m=o.makeTensorInfo(t,i.dtype),o.texData.get(m.dataId).values=n}else m=Zd(i,d,o);p.push(m),c=r.backend_util.getInnerMostAxes(c.length,u)}r.backend_util.assertAxesAreInnerMostDims("sum",c,u);const[g,y]=r.backend_util.computeOutAndReduceShapes(m.shape,c);let v=g;s&&(v=r.backend_util.expandShapeToKeepDim(g,l));const b=function(e,t,n,i){const s=r.util.sizeFromShape(t),a=qd({inputs:{x:e},attrs:{shape:[r.util.sizeFromShape(e.shape)/s,s]},backend:i}),o=Yd(a,"float32","mean",i),u=qd({inputs:{x:o},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(a),i.disposeIntermediateTensorInfo(o),u}(m,y,v,o);for(const e of p)o.disposeIntermediateTensorInfo(e);return b}},Lm={kernelName:r.Min,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{axis:a,keepDims:o}=i,u=s.shape.length,l=r.util.parseAxisParam(a,s.shape);let c=l;const d=r.backend_util.getAxesPermutation(c,u);let h=s;null!=d&&(h=th({inputs:{x:s},backend:n,attrs:{perm:d}}),c=r.backend_util.getInnerMostAxes(c.length,s.shape.length)),r.backend_util.assertAxesAreInnerMostDims("min",c,u);const[f,p]=r.backend_util.computeOutAndReduceShapes(h.shape,c),m=qd({inputs:{x:h},backend:n,attrs:{shape:[-1,r.util.sizeFromShape(p)]}}),g=Yd(m,m.dtype,"min",n);let y;return y=qd(o?{inputs:{x:g},backend:n,attrs:{shape:r.backend_util.expandShapeToKeepDim(f,l)}}:{inputs:{x:g},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=d&&n.disposeIntermediateTensorInfo(h),y}},Pm=zd({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Lc}),jm={kernelName:r.Minimum,backendName:"webgl",kernelFunc:Pm};class Um{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const i=e.length,r=fl(i),s=t.map((e=>e[0])).join(","),a=t.map(((t,n)=>t[0]+e[n])).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),u="reflect"===n?0:1;this.userCode=1!==i?`\n      ${r} start = ${r}(${s});\n      ${r} end = ${r}(${a});\n\n      void main() {\n        ${r} outC = getOutputCoords();\n        for (int i = 0; i < ${i}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${u};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};\n          }\n        }\n        ${r} coords = outC - start;\n        setOutput(getX(${o}));\n      }\n    `:`\n        int start = ${s};\n        int end = ${a};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${u};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${u};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}class Wm{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const i=e.length,r=fl(i),s=t.map((e=>e[0])).join(","),a=t.map(((t,n)=>t[0]+e[n])).join(","),o=ld("rc",i),u=ld("source",i),l=`${o[i-1]} < ${this.outputShape[i-1]}`,c=1===i?"source":`vec2(${u.slice(-2).join()})`,d="reflect"===n?0:1;let h="";if(1===i){const e=`\n        ${r} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${d};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${d};\n        }\n        source -= start;\n      `;h=`\n        ${r} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${u.join()}), ${c});\n        ${o[i-1]} += 1;\n        if(${l}) {\n          ${e}\n          result[1] = getChannel(getX(${u.join()}), ${c});\n        }\n      `}else{const e=`\n        ${r} source = rc;\n        ${r} lt = ${r}(lessThan(source, start));\n        ${r} gte = ${r}(greaterThanEqual(source, end));\n        ${r} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${d}) +\n                gte * ((end - 1) * 2 - source + ${d});\n        source -= start;\n      `;h=`\n        ${r} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${u.join()}), ${c});\n        ${o[i-1]} += 1;\n        if(${l}) {\n          ${e}\n          result[1] = getChannel(getX(${u.join()}), ${c});\n        }\n        rc = outputLoc;\n        ${o[i-2]} += 1;\n        if(${o[i-2]} < ${this.outputShape[i-2]}) {\n          ${e}\n          result[2] = getChannel(getX(${u.join()}), ${c});\n          ${o[i-1]} += 1;\n          if(${l}) {\n            ${e}\n            result[3] = getChannel(getX(${u.join()}), ${c});\n          }\n        }\n      `}this.userCode=`\n      const ${r} start = ${r}(${s});\n      const ${r} end = ${r}(${a});\n\n      void main() {\n        ${r} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${h}\n        setOutput(result);\n      }\n    `}}const Vm={kernelName:r.MirrorPad,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:i}=e,{paddings:s,mode:a}=n,o=(0,r.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Wm(i.shape,s,a):new Um(i.shape,s,a);return t.runWebGLProgram(o,[i],i.dtype)}},qm=zd({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),Gm={kernelName:r.Mod,backendName:"webgl",kernelFunc:qm};class Hm{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${t-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${t-1}));\n      }\n    `}}const Xm=zd({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),Ym={kernelName:r.RealDiv,backendName:"webgl",kernelFunc:Xm},Km="return a - b;",Jm=zd({opSnippet:Km,packedOpSnippet:Km,supportsComplex:!0,cpuKernelImpl:id}),Zm={kernelName:r.Sub,backendName:"webgl",kernelFunc:Jm};function Qm(e){const{inputs:t,backend:n,attrs:i}=e,{logits:s}=t,{dim:a}=i,o=r.util.parseAxisParam([a],s.shape),u=Sm({inputs:{x:s},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=r.backend_util.expandShapeToKeepDim(u.shape,o),c=qd({inputs:{x:u},backend:n,attrs:{shape:l}}),d=Jm({inputs:{a:s,b:c},backend:n}),h=bp({inputs:{x:d},backend:n}),f=Qd({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),p=qd({inputs:{x:f},backend:n,attrs:{shape:l}}),m=Xm({inputs:{a:h,b:p},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),m}const eg={kernelName:r.Softmax,backendName:"webgl",kernelFunc:Qm},tg={kernelName:r.Multinomial,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{logits:r}=t,{numSamples:s,seed:a,normalized:o}=i,u=o?r:Qm({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),l=u.shape[0],c=u.shape[1],d=new Hm(l,c,s),h=[[a]],f=n.runWebGLProgram(d,[u],"int32",h);return o||n.disposeIntermediateTensorInfo(u),f}},ng="return -x;",ig={kernelName:r.Neg,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:i}=t;if(n.shouldExecuteOnCPU([i])){const e=n.texData.get(i.dataId),[t,r]=jc(e.values,i.shape,i.dtype);return n.makeTensorInfo(r,i.dtype,t)}let s;return s=(0,r.env)().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new bd(i.shape,ng):new gd(i.shape,ng),n.runWebGLProgram(s,[i],i.dtype)}},rg=r.kernel_impls.nonMaxSuppressionV3Impl,sg={kernelName:r.NonMaxSuppressionV3,backendName:"webgl",kernelFunc:function(e){r.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:i}=e,{boxes:s,scores:a}=t,{maxOutputSize:o,iouThreshold:u,scoreThreshold:l}=i,c=n.readSync(s.dataId),d=n.readSync(a.dataId),{selectedIndices:h}=rg(c,d,o,u,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},ag=r.kernel_impls.nonMaxSuppressionV4Impl,og={kernelName:r.NonMaxSuppressionV4,backendName:"webgl",kernelFunc:function(e){r.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:i}=e,{boxes:s,scores:a}=t,{maxOutputSize:o,iouThreshold:u,scoreThreshold:l,padToMaxOutputSize:c}=i,d=n.readSync(s.dataId),h=n.readSync(a.dataId),{selectedIndices:f,validOutputs:p}=ag(d,h,o,u,l,c);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},ug=r.kernel_impls.nonMaxSuppressionV5Impl,lg={kernelName:r.NonMaxSuppressionV5,backendName:"webgl",kernelFunc:function(e){r.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:i}=e,{boxes:s,scores:a}=t,{maxOutputSize:o,iouThreshold:u,scoreThreshold:l,softNmsSigma:c}=i,d=n.readSync(s.dataId),h=n.readSync(a.dataId),f=o,p=u,m=l,g=c,{selectedIndices:y,selectedScores:v}=ug(d,h,f,p,m,g);return[n.makeTensorInfo([y.length],"int32",new Int32Array(y)),n.makeTensorInfo([v.length],"float32",new Float32Array(v))]}};class cg{constructor(e,t,n,i){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${i}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}const dg={kernelName:r.OneHot,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{indices:s}=t,{depth:a,onValue:o,offValue:u}=i,l=r.util.sizeFromShape(s.shape),c=new cg(l,a,o,u),d=qd({inputs:{x:s},backend:n,attrs:{shape:[l]}}),h=n.runWebGLProgram(c,[d],s.dtype);n.disposeIntermediateTensorInfo(d);const f=qd({inputs:{x:h},backend:n,attrs:{shape:[...s.shape,a]}});return n.disposeIntermediateTensorInfo(h),f}};function hg(e){const{inputs:t,backend:n}=e,{x:i}=t;if("complex64"===i.dtype){const e=sf({inputs:{input:i},backend:n}),t=hg({inputs:{x:e},backend:n}),r=xf({inputs:{input:i},backend:n}),s=hg({inputs:{x:r},backend:n}),a=Dd({inputs:{real:t,imag:s},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(s),a}return $p({attrs:{shape:i.shape,dtype:i.dtype,value:"string"===i.dtype?"":0},backend:n})}const fg={kernelName:r.ZerosLike,backendName:"webgl",kernelFunc:hg},pg={kernelName:r.OnesLike,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:i}=t,{x:r}=n;if("string"===r.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===r.dtype){const t=sf({inputs:{input:r},backend:i}),n=e({inputs:{x:t},backend:i}),s=xf({inputs:{input:r},backend:i}),a=hg({inputs:{x:s},backend:i}),o=Dd({inputs:{real:n,imag:a},backend:i});return i.disposeIntermediateTensorInfo(t),i.disposeIntermediateTensorInfo(n),i.disposeIntermediateTensorInfo(s),i.disposeIntermediateTensorInfo(a),o}return $p({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:i})}},mg={kernelName:r.Pack,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{axis:s}=i;if(1===t.length)return wp({inputs:{input:t[0]},backend:n,attrs:{dim:s}});const a=t[0].shape,o=t[0].dtype;t.forEach((e=>{r.util.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),r.util.assert(o===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const u=[],l=kf({inputs:t.map((e=>{const t=wp({inputs:{input:e},backend:n,attrs:{dim:s}});return u.push(t),t})),backend:n,attrs:{axis:s}});return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),l}};class gg{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const i=e.length,r=fl(i),s=t.map((e=>e[0])).join(","),a=t.map(((t,n)=>t[0]+e[n])).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);this.userCode=1!==i?`\n      ${r} start = ${r}(${s});\n      ${r} end = ${r}(${a});\n\n      void main() {\n        ${r} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${r} coords = outC - start;\n          setOutput(getX(${o}));\n        }\n      }\n    `:`\n        int start = ${s};\n        int end = ${a};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}class yg{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const i=e.length,r=fl(i),s=t.map((e=>e[0])).join(","),a=t.map(((t,n)=>t[0]+e[n])).join(","),o=ld("rc",i),u=ld("source",i),l=`${o[i-1]} < ${this.outputShape[i-1]}`,c=1===i?"source":`vec2(${u.slice(-2).join()})`,d=[`${r} rc = outputLoc;`,`${o[i-1]} += 1;\n       if(${l}) {\n      `,1===i?"":`}\n       rc = outputLoc;\n       ${o[i-2]} += 1;\n       if(${o[i-2]} < ${this.outputShape[i-2]}) {`,1===i?"":`  ${o[i-1]} += 1;\n         if(${l}) {`],h=1===i?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let e=0,t=1===i?2:4;e<t;e++)f+=`\n        ${d[e]}\n        if (${h}) {\n          result[${e}] = float(value);\n        } else {\n          ${r} source = rc - start;\n          result[${e}] = getChannel(getX(${u.join()}), ${c});\n        }\n      `;f+=1===i?"} ":"}}",this.userCode=`\n      const ${r} start = ${r}(${s});\n      const ${r} end = ${r}(${a});\n\n      void main() {\n        ${r} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${f}\n        setOutput(result);\n      }\n    `}}const vg=e=>{const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{paddings:a,constantValue:o}=i;if(0===r.util.sizeFromShape(s.shape))return $p({backend:n,attrs:{shape:a.map(((e,t)=>e[0]+s.shape[t]+e[1])),value:o,dtype:s.dtype}});const u=(0,r.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yg(s.shape,a,o):new gg(s.shape,a,o),l=[[o]];return n.runWebGLProgram(u,[s],s.dtype,l)},bg={kernelName:r.PadV2,backendName:"webgl",kernelFunc:vg},xg=zd({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),wg={kernelName:r.Pow,backendName:"webgl",kernelFunc:xg},Cg={kernelName:r.Prod,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{axis:a,keepDims:o}=i,u=s.shape.length,l=[],c=r.util.parseAxisParam(a,s.shape);let d=c;const h=r.backend_util.getAxesPermutation(d,u);let f,p=s;if(null!=h&&(p=th({inputs:{x:s},backend:n,attrs:{perm:h}}),d=r.backend_util.getInnerMostAxes(d.length,u),l.push(p)),r.backend_util.assertAxesAreInnerMostDims("prod",d,u),n.shouldExecuteOnCPU([p])){const e=n.texData.get(p.dataId).values,{outVals:t,outShape:i,outDtype:r}=Wc(p.shape,p.dtype,e,d);f=n.makeTensorInfo(i,r,t)}else{const[e,t]=r.backend_util.computeOutAndReduceShapes(p.shape,d),i=r.util.sizeFromShape(t),a=qd({inputs:{x:p},backend:n,attrs:{shape:[-1,i]}}),o=Yd(a,(0,r.sumOutType)(s.dtype),"prod",n);f=qd({inputs:{x:o},backend:n,attrs:{shape:e}}),l.push(a),l.push(o)}if(o){l.push(f);const e=r.backend_util.expandShapeToKeepDim(f.shape,c);f=qd({inputs:{x:f},backend:n,attrs:{shape:e}})}return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),f}},kg=e=>{const{backend:t,attrs:n}=e,{start:i,stop:r,step:s,dtype:a}=n,o=Vc(i,r,s,a);return t.makeTensorInfo([o.length],a,o)},Ag={kernelName:r.Range,backendName:"webgl",kernelFunc:kg},_g=Bd({opSnippet:"return 1.0 / x;"}),Eg={kernelName:r.Reciprocal,backendName:"webgl",kernelFunc:_g},Sg=Bd({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Fg={kernelName:r.Relu,backendName:"webgl",kernelFunc:Sg},Dg=Bd({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),$g={kernelName:r.Relu6,backendName:"webgl",kernelFunc:Dg};class Og{constructor(e,t,n,i,r){this.variableNames=["A"],this.outputShape=[];const[s,a,o,u]=e;this.outputShape=[s,t,n,u];const l=[i&&t>1?a-1:a,i&&n>1?o-1:o],c=[i&&t>1?t-1:t,i&&n>1?n-1:n];let d;d=r?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${a}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${d};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}class Ng{constructor(e,t,n,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,a,o,u]=e;this.outputShape=[s,t,n,u];const l=[i&&t>1?a-1:a,i&&n>1?o-1:o],c=[i&&t>1?t-1:t,i&&n>1?n-1:n];let d;d=r?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]},\n          ${l[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${a}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${d};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${u-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}const Ig={kernelName:r.ResizeBilinear,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:s}=t,{alignCorners:a,halfPixelCenters:o,size:u}=i,[l,c]=u,d=(0,r.env)().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Ng(s.shape,l,c,a,o):new Og(s.shape,l,c,a,o);return n.runWebGLProgram(d,[s],"float32")}};class Tg{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,i,r]=t,[,s,a]=e,o=[n&&s>1?i-1:i,n&&a>1?r-1:r],u=[n&&s>1?s-1:s,n&&a>1?a-1:a],l=o[0]/u[0],c=o[1]/u[1],d=1/l,h=1/c,f=2*Math.ceil(d)+2,p=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${l});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${d});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${f});\n        const int winWidth = int(${p});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${a}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${r-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}const Rg={kernelName:r.ResizeBilinearGrad,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r,dy:s}=t,{alignCorners:a}=i,o=new Tg(s.shape,r.shape,a);return n.runWebGLProgram(o,[s],s.dtype)}};class Mg{constructor(e,t,n,i,r){this.variableNames=["A"],this.outputShape=[];const[s,a,o,u]=e;this.outputShape=[s,t,n,u];const l=[i&&t>1?a-1:a,i&&n>1?o-1:o],c=[i&&t>1?t-1:t,i&&n>1?n-1:n],d=i?"0.5":"0.0";let h;h=r?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${a}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${h};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}class Bg{constructor(e,t,n,i,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,a,o,u]=e;this.outputShape=[s,t,n,u];const l=[i&&t>1?a-1:a,i&&n>1?o-1:o],c=[i&&t>1?t-1:t,i&&n>1?n-1:n],d=i?"0.5":"0.0";let h;h=r?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]},\n          ${l[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${a}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${h};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${u-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    `}}const zg={kernelName:r.ResizeNearestNeighbor,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:s}=t,{alignCorners:a,halfPixelCenters:o,size:u}=i,[l,c]=u,d=(0,r.env)().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Bg(s.shape,l,c,a,o):new Mg(s.shape,l,c,a,o);return n.runWebGLProgram(d,[s],s.dtype)}};class Lg{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,i,r]=t,[,s,a]=e,o=[n&&s>1?i-1:i,n&&a>1?r-1:r],u=[n&&s>1?s-1:s,n&&a>1?a-1:a],l=o[0]/u[0],c=o[1]/u[1],d=1/l,h=1/c,f=2*Math.ceil(d)+2,p=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${l});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${d});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${f});\n        const int winWidth = int(${p});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${a}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${o[0]}) *\n                (float(dyR) / float(${u[0]}));\n\n            float sourceFracCol =\n                float(${o[1]}) *\n                  (float(dyC) / float(${u[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${i}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}const Pg={kernelName:r.ResizeNearestNeighborGrad,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{images:r,dy:s}=t,{alignCorners:a}=i,o=new Lg(s.shape,r.shape,a);return n.runWebGLProgram(o,[s],s.dtype)}};class jg{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${e[0]} - coord - 1));\n        }\n      `);const i=e.map(((n,i)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - coords[${n}] - 1`:`coords[${n}]`)(i))).join(","),r=fl(n);this.userCode=`\n      void main() {\n        ${r} coords = getOutputCoords();\n        setOutput(getX(${i}));\n      }\n    `}}class Ug{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;const i=ld("rc",n),r=`${i[n-1]} + 1 < ${this.outputShape[n-1]}`,s=`${i[n-2]} + 1 < ${this.outputShape[n-2]}`,a=fl(n);function o(n){const i=e.map(((i,r)=>function(n,i){return-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - ${i[n]} - 1`:`${i[n]}`}(r,n)));return`getChannel(getX(${i.join(",")}), vec2(${i.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${e[0]} - rc - 1),\n            ${e[0]} - rc - 1);\n          if(${r}){\n              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),\n                ${e[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${a} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${function(e){return o(e)}(i.slice())};\n          if(${r}){\n            result.g = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",o(e)}(i.slice())};\n          }\n          if(${s}) {\n            result.b = ${function(e){return e[n-2]="("+e[n-2]+" + 1)",o(e)}(i.slice())};\n            if(${r}) {\n              result.a = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",o(e)}(i.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}const Wg={kernelName:r.Reverse,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{dims:a}=i,o=s.shape.length,u=r.util.parseAxisParam(a,s.shape);if(0===o)return Sd({inputs:{x:s},backend:n});const l=(0,r.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ug(s.shape,u):new jg(s.shape,u);return n.runWebGLProgram(l,[s],s.dtype)}};class Vg{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=e[1],i=e[2];this.outputShape=e;let r="";r="number"==typeof t?`float outputValue = ${t.toFixed(2)};`:`\n        vec3 fill = vec3(${t.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ${r}\n          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${n}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}const qg={kernelName:r.RotateWithOffset,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:i}=e,{radians:s,fillValue:a,center:o}=t,u=n,l=new Vg(i.shape,a),[c,d]=r.backend_util.getImageCenter(o,i.shape[1],i.shape[2]),h=[[c,d,Math.sin(s),Math.cos(s)]];return u.runWebGLProgram(l,[i],i.dtype,h)}},Gg=Bd({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),Hg={kernelName:r.Round,backendName:"webgl",kernelFunc:Gg},Xg=Bd({opSnippet:"return inversesqrt(x);",cpuKernelImpl:qc}),Yg={kernelName:r.Rsqrt,backendName:"webgl",kernelFunc:Xg};class Kg{constructor(e,t,n,i,r,s,a=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;const o=fl(r.length),u=fl(s.length);let l="";1===n?l="i":2===n&&(l="i, j");const c=`getIndices(${l})`;let d="";1===i?d="i":2===i&&(d="i, coords[1]");const h=`getUpdates(${d})`,f=t>1?"strides[j]":"strides";this.userCode=`\n        ${o} strides = ${o}(${r});\n\n        void main() {\n          ${u} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${e}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${t}; j++) {\n              int index = round(${c});\n              flattenedIndex += index * ${f};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${h};\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      `}}const Jg={kernelName:r.ScatterNd,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{indices:s,updates:a}=t,{shape:o}=i,{sliceRank:u,numUpdates:l,sliceSize:c,strides:d,outputSize:h}=r.backend_util.calculateShapes(a,s,o),f=[h/c,c];if(0===h)return n.makeTensorInfo(o,s.dtype);const p=qd({inputs:{x:s},backend:n,attrs:{shape:[l,u]}}),m=qd({inputs:{x:a},backend:n,attrs:{shape:[l,c]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0])),y=new Kg(l,u,p.shape.length,m.shape.length,d,f),v=n.runWebGLProgram(y,[m,p,g],m.dtype),b=qd({inputs:{x:v},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),b}};class Zg{constructor(e,t,n){let i,r;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)r="resRC",i="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[];for(let i=0;i<t.length;i++)a.push(`${n[i]}`),i<e&&s.push(`${n[i]}`);i=s.join(),r=a.join()}const s=fl(n);this.userCode=`\n      void main() {\n        ${s} resRC = getOutputCoords();\n        float cVal = getC(${i});\n        if (cVal >= 1.0) {\n          setOutput(getA(${r}));\n        } else {\n          setOutput(getB(${r}));\n        }\n      }\n    `}}const Qg={kernelName:r.Select,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:i,t:s,e:a}=t,o=new Zg(i.shape.length,s.shape,s.shape.length);return n.runWebGLProgram(o,[i,s,a],(0,r.upcastType)(s.dtype,a.dtype))}},ey=Bd({opSnippet:`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ${r.backend_util.SELU_SCALEALPHA};\n  float scale = ${r.backend_util.SELU_SCALE};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`}),ty={kernelName:r.Selu,backendName:"webgl",kernelFunc:ey},ny="return 1.0 / (1.0 + exp(-1.0 * x));",iy=Bd({opSnippet:ny,packedOpSnippet:ny,cpuKernelImpl:Gc}),ry={kernelName:r.Sigmoid,backendName:"webgl",kernelFunc:iy},sy=Bd({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),ay={kernelName:r.Sign,backendName:"webgl",kernelFunc:sy},oy=Bd({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),uy={kernelName:r.Sin,backendName:"webgl",kernelFunc:oy},ly=Bd({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),cy={kernelName:r.Sinh,backendName:"webgl",kernelFunc:ly},dy=Bd({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),hy={kernelName:r.Softplus,backendName:"webgl",kernelFunc:dy},fy={kernelName:r.SpaceToBatchND,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{blockShape:a,paddings:o}=i;r.util.assert(s.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const u=a.reduce(((e,t)=>e*t)),l=[[0,0]];l.push(...o);for(let e=1+a.length;e<s.shape.length;++e)l.push([0,0]);const c=[],d=vg({inputs:{x:s},backend:n,attrs:{paddings:l,constantValue:0}}),h=r.backend_util.getReshaped(d.shape,a,u,!1),f=r.backend_util.getPermuted(h.length,a.length,!1),p=r.backend_util.getReshapedPermuted(d.shape,a,u,!1),m=qd({inputs:{x:d},backend:n,attrs:{shape:h}}),g=th({inputs:{x:m},backend:n,attrs:{perm:f}}),y=qd({inputs:{x:g},backend:n,attrs:{shape:p}});return c.push(d),c.push(m),c.push(g),c.forEach((e=>n.disposeIntermediateTensorInfo(e))),y}},py={kernelName:r.SparseFillEmptyRows,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:i,values:r,denseShape:s,defaultValue:a}=t;if(1!==s.shape.length)throw new Error(`Dense shape must be a vector, saw:\n         ${s.shape}`);if(2!==i.shape.length)throw new Error(`Indices must be a matrix, saw:\n         ${i.shape}`);if(1!==r.shape.length)throw new Error(`Values must be a vector, saw:\n         ${r.shape}`);if(0!==a.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${a.shape}`);const o=n.readSync(i.dataId),u=n.readSync(r.dataId),l=n.readSync(s.dataId),c=n.readSync(a.dataId)[0],[d,h,f,p,m]=Yc(o,i.shape,i.dtype,u,r.dtype,l,c);return[n.makeTensorInfo(h,i.dtype,d),n.makeTensorInfo([h[0]],r.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map((e=>Number(e))))),n.makeTensorInfo([m.length],i.dtype,new Int32Array(m))]}},my={kernelName:r.SparseReshape,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:i,inputShape:r,newShape:s}=t;if(2!==i.shape.length)throw new Error(`Input indices should be a matrix but received shape ${i.shape}`);if(1!==r.shape.length)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(1!==s.shape.length)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const a=Array.from(n.readSync(r.dataId)),o=n.readSync(i.dataId),u=Array.from(n.readSync(s.dataId)),[l,c,d]=Kc(o,i.shape,i.dtype,a,u);return[n.makeTensorInfo(c,i.dtype,l),n.makeTensorInfo([d.length],s.dtype,new Int32Array(d))]}},gy={kernelName:r.SparseSegmentMean,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:i,indices:r,segmentIds:s}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error(`Indices should be a vector but received shape\n              ${r.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n              ${s.shape}`);const a=n.readSync(i.dataId),o=n.readSync(r.dataId),u=n.readSync(s.dataId),[l,c]=Jc(a,i.shape,i.dtype,o,u,!0);return n.makeTensorInfo(c,i.dtype,l)}},yy={kernelName:r.SparseSegmentSum,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:i,indices:r,segmentIds:s}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==r.shape.length)throw new Error(`Indices should be a vector but received shape\n             ${r.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n             ${s.shape}`);const a=n.readSync(i.dataId),o=n.readSync(r.dataId),u=n.readSync(s.dataId),[l,c]=Jc(a,i.shape,i.dtype,o,u);return n.makeTensorInfo(c,i.dtype,l)}},vy={kernelName:r.SparseToDense,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{sparseIndices:s,sparseValues:a,defaultValue:o}=t,{outputShape:u}=i,{sliceRank:l,numUpdates:c,strides:d,outputSize:h}=r.backend_util.calculateShapes(a,s,u),f=new Kg(c,l,s.shape.length,a.shape.length,d,[h,1],!1),p=n.runWebGLProgram(f,[a,s,o],a.dtype),m=qd({inputs:{x:p},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(p),m}},by={kernelName:r.SplitV,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{numOrSizeSplits:a,axis:o}=i,u=r.util.parseAxisParam(o,s.shape)[0],l=r.backend_util.prepareSplitSize(s,a,u),c=s.shape.length,d=new Array(c).fill(0),h=s.shape.slice();return l.map((e=>{const t=[...h];t[u]=e;const i=Jh({inputs:{x:s},backend:n,attrs:{begin:d,size:t}});return d[u]+=e,i}))}},xy="return sqrt(x);",wy=Bd({opSnippet:xy,packedOpSnippet:xy,cpuKernelImpl:Zc}),Cy={kernelName:r.Sqrt,backendName:"webgl",kernelFunc:wy},ky=Bd({opSnippet:"return x * x;"}),Ay={kernelName:r.Square,backendName:"webgl",kernelFunc:ky},_y="return (a - b) * (a - b);",Ey=zd({opSnippet:_y,packedOpSnippet:_y}),Sy={kernelName:r.SquaredDifference,backendName:"webgl",kernelFunc:Ey},Fy={kernelName:r.Step,backendName:"webgl",kernelFunc:function({inputs:e,attrs:t,backend:n}){const{x:i}=e,r=`if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(${t.alpha});\n  `,s=new gd(i.shape,r);return n.runWebGLProgram(s,[i],i.dtype)}};class Dy{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const i=n.length,r=fl(n.length),s=fl(n.length);let a="";if(1===i)a="coords * strides + begin";else{let e=0;a=n.map(((t,i)=>(e++,1===n.length?`coords * strides[${i}] + begin[${i}]`:`coords[${e-1}] * strides[${i}] + begin[${i}]`))).join(",")}this.userCode=`\n      ${r} begin = ${r}(${e});\n      ${r} strides = ${r}(${t});\n\n      void main() {\n        ${s} coords = getOutputCoords();\n        setOutput(getX(${a}));\n      }\n    `}}const $y={kernelName:r.StridedSlice,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{begin:a,end:o,strides:u,beginMask:l,endMask:c,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:f}=i,{finalShapeSparse:p,finalShape:m,isIdentity:g,sliceDim0:y,isSimpleSlice:v,begin:b,end:x,strides:w}=r.slice_util.sliceInfo(s.shape,a,o,u,l,c,d,h,f);let C;if(g)C=qd({inputs:{x:s},backend:n,attrs:{shape:m}});else if(y||v){r.util.assert(s.shape.length>=1,(()=>`Input must have rank at least 1, got: ${s.shape.length}`));const e=r.slice_util.computeOutShape(b,x,w),t=Jh({inputs:{x:s},backend:n,attrs:{begin:b,size:e}});C=qd({inputs:{x:t},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(t)}else if(n.shouldExecuteOnCPU([s])){const e=n.readSync(s.dataId),t=(0,r.buffer)(s.shape,s.dtype,e),i=Qc(p,t,w,b);C=n.makeTensorInfo(m,s.dtype,i.values)}else{const e=new Dy(b,w,p);C=n.runWebGLProgram(e,[s],s.dtype)}const k=qd({inputs:{x:C},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(C),k}},Oy={kernelName:r.StringNGrams,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{separator:r,nGramWidths:s,leftPad:a,rightPad:o,padWidth:u,preserveShortSequences:l}=i,{data:c,dataSplits:d}=t,h=n.readSync(c.dataId),f=n.readSync(d.dataId),[p,m]=ed(h,f,r,s,a,o,u,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",m)]}},Ny={kernelName:r.StringSplit,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{skipEmpty:r}=i,{input:s,delimiter:a}=t;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(1!==s.shape.length)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(0!==a.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${a.shape}`);const o=n.readSync(s.dataId),u=n.readSync(a.dataId)[0],[l,c,d]=td(o,u,r),h=c.length;return[n.makeTensorInfo([h,2],"int32",l),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(d))]}},Iy={kernelName:r.StringToHashBucketFast,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{numBuckets:r}=i,{input:s}=t;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const a=n.readSync(s.dataId),o=nd(a,r);return n.makeTensorInfo(s.shape,"int32",o)}},Ty=Bd({opSnippet:"return tan(x);"}),Ry={kernelName:r.Tan,backendName:"webgl",kernelFunc:Ty},My=Bd({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),By={kernelName:r.Tanh,backendName:"webgl",kernelFunc:My};class zy{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[i]*t[i];this.outputShape=n,this.rank=n.length;const i=fl(this.rank),r=function(e){const t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(1===t)return`imod(resRC, ${e[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],i=[];for(let t=0;t<e.length;t++)i.push(`imod(${n[t]}, ${e[t]})`);return i.join()}(e);this.userCode=`\n      void main() {\n        ${i} resRC = getOutputCoords();\n        setOutput(getA(${r}));\n      }\n    `}}function Ly(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{reps:a}=i;if("string"===s.dtype||s.shape.length>5){const e=n.readSync(s.dataId),t="string"===s.dtype?e.map((e=>r.util.decodeString(e))):e,i=(0,r.buffer)(s.shape,s.dtype,t),o=rd(i,a);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const o=new zy(s.shape,a);return n.runWebGLProgram(o,[s],s.dtype)}const Py={kernelName:r.Tile,backendName:"webgl",kernelFunc:Ly};class jy{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class Uy{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}function Wy(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function Vy(e){let t=1;for(;t<e;)t*=2;return t}const qy={kernelName:r.TopK,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s}=t,{k:a,sorted:o}=i,u=(0,r.env)().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=(0,r.env)().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=s.shape,d=c[c.length-1];if(n.shouldExecuteOnCPU([s])||d<u||a>l){const e=n.readSync(s.dataId),[t,i]=sd(e,c,s.dtype,a,o);return[n.makeTensorInfo(t.shape,t.dtype,t.values),n.makeTensorInfo(i.shape,i.dtype,i.values)]}if(0===a)return c[c.length-1]=0,[n.makeTensorInfo(c,s.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===d)return[s,$p({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const h=n.texData.get(s.dataId),f=null!==h&&h.isPacked,p=f?n.unpackTensor(s):s,m=r.util.sizeFromShape(c)/d,g=qd({inputs:{x:p},attrs:{shape:[m,d]},backend:n});f&&Wy(n,p);const y=Vy(a),v=Vy(d);let b=null;const x=()=>null===b?[g,g]:[g,b],w=(e,t,i)=>{const r=x(),s=new jy(i),a=[[d],[null===b?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],o=b;b=n.runWebGLProgram(s,r,"int32",a),Wy(n,o)};for(let e=1;e<y;e*=2){const t=2*e;for(let n=e;n>=1;n/=2)w(t,n,[m,v])}for(let e=v;e>y;e/=2){const t=x(),i=new Uy([m,e/2]),r=[[d],[null===b?1:0],[y]],s=b;b=n.runWebGLProgram(i,t,"int32",r),Wy(n,s);const a=y/2,o=2*a;for(let e=a;e>=1;e/=2)w(o,e,b.shape)}let C=b;b=Jh({inputs:{x:b},backend:n,attrs:{begin:0,size:[m,a]}}),Wy(n,C);let k=Xp({inputs:{x:g,indices:b},backend:n,attrs:{axis:1,batchDims:1}});Wy(n,g);const A=c.slice(0,-1);A.push(a),C=b,b=qd({inputs:{x:b},attrs:{shape:A},backend:n}),Wy(n,C);const _=k;return k=qd({inputs:{x:k},attrs:{shape:A},backend:n}),Wy(n,_),[k,b]}};class Gy{constructor(e,t,n,i,r,s){this.variableNames=["Image","Transforms"],this.outputShape=s;const a="nearest"===n?1:2;let o;switch(i){case"constant":o=1;break;case"reflect":o=2;break;case"wrap":o=3;break;case"nearest":o=4;break;default:o=1}this.userCode=`\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(${o} == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${o} == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${o} == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(${r});\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(${r});\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(${t}));\n                float mapY = mapCoord(inY, float(${e}));\n\n                if (${a} == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        `}}const Hy={kernelName:r.Transform,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{image:r,transforms:s}=t,{interpolation:a,fillMode:o,fillValue:u,outputShape:l}=i,[c,d,h,f]=r.shape,[p,m]=null!=l?l:[d,h],g=new Gy(d,h,a,o,u,[c,p,m,f]);return n.runWebGLProgram(g,[r,s],"float32")}},Xy={kernelName:r.Unique,backendName:"webgl",kernelFunc:function(e){const{inputs:t,attrs:n,backend:i}=e,{axis:r}=n,{x:s}=t;Ku(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const a=i.readSync(s.dataId),{outputValues:o,outputShape:u,indices:l}=od(a,r,s.shape,s.dtype);return[i.makeTensorInfo(u,s.dtype,o),i.makeTensorInfo([l.length],"int32",l)]}},Yy={kernelName:r.Unpack,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{value:r}=t;let{axis:s}=i;s<0&&(s+=r.shape.length);const a=r,o=a.shape.length,u=r.shape[s],l=new Array(o-1);let c=0;for(let e=0;e<o;e++)e!==s&&(l[c++]=a.shape[e]);const d=[],h=new Array(o).fill(0),f=a.shape.slice();f[s]=1;const p=new Array(u);for(let e=0;e<p.length;e++){h[s]=e;const t=Jh({inputs:{x:a},backend:n,attrs:{begin:h,size:f}}),i=qd({inputs:{x:t},backend:n,attrs:{shape:l}});p[e]=i,d.push(t)}return d.forEach((e=>n.disposeIntermediateTensorInfo(e))),p}};class Ky{constructor(e,t){this.variableNames=["x","segmentIds"];const n=e.windowSize,i=e.batchSize,r=e.inSize,s=e.numSegments,a=s*Math.ceil(r/n);this.outputShape=[i,a];const o=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ";let c="";r%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${r}) {\n          return initializationValue;\n        }\n      `);let d="";r%n>0&&(d=`\n        if (inIdx < 0 || inIdx >= ${r}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${d}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${s})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${s})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${o}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${l}\n        }\n\n        int inIdx = inOffset + ${o};\n        if (${1===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${l}\n        } else if (${2===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${l}\n        } else if (${3===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${l}\n        }\n        setOutput(sumValue);\n      }\n    `}}const Jy=[Am,Em,rh,ah,uh,ch,fh,gh,yh,vh,Ah,_h,Sh,Dh,Ih,Oh,Rh,Lh,zh,Uh,Wh,Vh,Hh,Qh,ef,tf,of,cf,ff,gf,$d,Af,Rf,Mf,$f,zf,Lf,Bf,jf,Wf,qf,Yf,Kf,Zf,rp,sp,tp,op,lp,cp,hp,fp,mp,yp,xp,Cp,_p,Fp,Op,Ip,Mp,zp,jp,Wp,Vp,Gp,Yp,Jp,Qp,Fd,em,wf,nm,rm,am,Id,um,cm,dm,mm,fm,ym,bm,wm,Fm,Nm,Om,Rm,Mm,Bm,$m,zm,Lm,jm,Vm,Gm,tg,Vd,ig,sg,og,lg,rf,dg,pg,mg,bg,wg,Md,Cg,Ag,af,Ym,Eg,$g,Fg,Gd,Ig,Rg,zg,Pg,Wg,qg,Hg,Yg,Jg,Qg,ty,ry,ay,uy,cy,Zh,eg,hy,fy,py,my,gy,yy,vy,by,Cy,Ay,Sy,Fy,$y,Oy,Ny,Iy,Zm,eh,Ry,By,Py,qy,Hy,nh,Xy,Yy,{kernelName:r.UnsortedSegmentSum,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:i}=e,{x:s,segmentIds:a}=t,{numSegments:o}=i,u=s.shape.length,l=[];let c=0;const d=r.backend_util.getAxesPermutation([c],u);let h=s;null!=d&&(h=th({inputs:{x:s},backend:n,attrs:{perm:d}}),l.push(h),c=r.backend_util.getInnerMostAxes(1,u)[0]);const f=r.backend_util.segment_util.computeOutShape(h.shape,c,o),p=r.util.sizeFromShape([h.shape[c]]),m=qd({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}});l.push(m);const g=(0,r.sumOutType)(s.dtype),y=(e,t,i,s,a)=>{const o=e.shape[0],u=e.shape[1],c=r.backend_util.segment_util.segOpComputeOptimalWindowSize(u,a),d=new Ky({windowSize:c,inSize:u,batchSize:o,numSegments:a},t),h=n.compileAndRun(d,[e,i],s);if(l.push(h),h.shape[1]===a)return h;const f=kg({backend:n,attrs:{start:0,stop:a,step:1,dtype:"float32"}}),p=Ly({inputs:{x:f},backend:n,attrs:{reps:[u/c]}});return l.push(f),l.push(p),y(h,t,p,s,a)},v=qd({inputs:{x:y(m,"unsortedSegmentSum",a,g,o)},backend:n,attrs:{shape:f}});let b=v;if(null!=d){l.push(v);const e=r.backend_util.getUndoAxesPermutation(d);b=th({inputs:{x:b},backend:n,attrs:{perm:e}})}return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),b}},fg];for(const e of Jy)(0,r.registerKernel)(e);r.version_core,vu.P6,Uo.version_converter},2779:(e,t)=>{var n;!function(){"use strict";var i={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var s=typeof n;if("string"===s||"number"===s)e.push(n);else if(Array.isArray(n)){if(n.length){var a=r.apply(null,n);a&&e.push(a)}}else if("object"===s)if(n.toString===Object.prototype.toString)for(var o in n)i.call(n,o)&&n[o]&&e.push(o);else e.push(n.toString())}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(n=function(){return r}.apply(t,[]))||(e.exports=n)}()},8138:(e,t,n)=>{var i=n(8834).Buffer,r=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var t,n,r;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{r=Promise}catch(e){r=function(){}}function s(a,u,l,c,d){"object"==typeof u&&(l=u.depth,c=u.prototype,d=u.includeNonEnumerable,u=u.circular);var h=[],f=[],p=void 0!==i;return void 0===u&&(u=!0),void 0===l&&(l=1/0),function a(l,m){if(null===l)return null;if(0===m)return l;var g,y;if("object"!=typeof l)return l;if(e(l,t))g=new t;else if(e(l,n))g=new n;else if(e(l,r))g=new r((function(e,t){l.then((function(t){e(a(t,m-1))}),(function(e){t(a(e,m-1))}))}));else if(s.__isArray(l))g=[];else if(s.__isRegExp(l))g=new RegExp(l.source,o(l)),l.lastIndex&&(g.lastIndex=l.lastIndex);else if(s.__isDate(l))g=new Date(l.getTime());else{if(p&&i.isBuffer(l))return g=i.allocUnsafe?i.allocUnsafe(l.length):new i(l.length),l.copy(g),g;e(l,Error)?g=Object.create(l):void 0===c?(y=Object.getPrototypeOf(l),g=Object.create(y)):(g=Object.create(c),y=c)}if(u){var v=h.indexOf(l);if(-1!=v)return f[v];h.push(l),f.push(g)}for(var b in e(l,t)&&l.forEach((function(e,t){var n=a(t,m-1),i=a(e,m-1);g.set(n,i)})),e(l,n)&&l.forEach((function(e){var t=a(e,m-1);g.add(t)})),l){var x;y&&(x=Object.getOwnPropertyDescriptor(y,b)),x&&null==x.set||(g[b]=a(l[b],m-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(l);for(b=0;b<w.length;b++){var C=w[b];(!(A=Object.getOwnPropertyDescriptor(l,C))||A.enumerable||d)&&(g[C]=a(l[C],m-1),A.enumerable||Object.defineProperty(g,C,{enumerable:!1}))}}if(d){var k=Object.getOwnPropertyNames(l);for(b=0;b<k.length;b++){var A,_=k[b];(A=Object.getOwnPropertyDescriptor(l,_))&&A.enumerable||(g[_]=a(l[_],m-1),Object.defineProperty(g,_,{enumerable:!1}))}}return g}(a,l)}function a(e){return Object.prototype.toString.call(e)}function o(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return s.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},s.__objToStr=a,s.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},s.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},s.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},s.__getRegExpFlags=o,s}();e.exports&&(e.exports=r)},9977:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,r.default)(e)};var i,r=(i=n(3603))&&i.__esModule?i:{default:i};e.exports=t.default},522:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return"string"==typeof e&&n.test(e)};var n=/-webkit-|-moz-|-ms-/;e.exports=t.default},9735:(e,t,n)=>{"use strict";n.r(t),n.d(t,{clientPoint:()=>ke,create:()=>ve,creator:()=>u,customEvent:()=>le,event:()=>ie,local:()=>xe,matcher:()=>g,mouse:()=>Ae,namespace:()=>s,namespaces:()=>r,select:()=>ye,selectAll:()=>_e,selection:()=>ge,selector:()=>c,selectorAll:()=>h,style:()=>N,touch:()=>Ee,touches:()=>Se,window:()=>F});var i="http://www.w3.org/1999/xhtml";const r={svg:"http://www.w3.org/2000/svg",xhtml:i,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function s(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),r.hasOwnProperty(t)?{space:r[t],local:e}:e}function a(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===i&&t.documentElement.namespaceURI===i?t.createElement(e):t.createElementNS(n,e)}}function o(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function u(e){var t=s(e);return(t.local?o:a)(t)}function l(){}function c(e){return null==e?l:function(){return this.querySelector(e)}}function d(){return[]}function h(e){return null==e?d:function(){return this.querySelectorAll(e)}}var f=function(e){return function(){return this.matches(e)}};if("undefined"!=typeof document){var p=document.documentElement;if(!p.matches){var m=p.webkitMatchesSelector||p.msMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector;f=function(e){return function(){return m.call(this,e)}}}}const g=f;function y(e){return new Array(e.length)}function v(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function b(e,t,n,i,r,s){for(var a,o=0,u=t.length,l=s.length;o<l;++o)(a=t[o])?(a.__data__=s[o],i[o]=a):n[o]=new v(e,s[o]);for(;o<u;++o)(a=t[o])&&(r[o]=a)}function x(e,t,n,i,r,s,a){var o,u,l,c={},d=t.length,h=s.length,f=new Array(d);for(o=0;o<d;++o)(u=t[o])&&(f[o]=l="$"+a.call(u,u.__data__,o,t),l in c?r[o]=u:c[l]=u);for(o=0;o<h;++o)(u=c[l="$"+a.call(e,s[o],o,s)])?(i[o]=u,u.__data__=s[o],c[l]=null):n[o]=new v(e,s[o]);for(o=0;o<d;++o)(u=t[o])&&c[f[o]]===u&&(r[o]=u)}function w(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function C(e){return function(){this.removeAttribute(e)}}function k(e){return function(){this.removeAttributeNS(e.space,e.local)}}function A(e,t){return function(){this.setAttribute(e,t)}}function _(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function E(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function S(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function F(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function D(e){return function(){this.style.removeProperty(e)}}function $(e,t,n){return function(){this.style.setProperty(e,t,n)}}function O(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function N(e,t){return e.style.getPropertyValue(t)||F(e).getComputedStyle(e,null).getPropertyValue(t)}function I(e){return function(){delete this[e]}}function T(e,t){return function(){this[e]=t}}function R(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function M(e){return e.trim().split(/^|\s+/)}function B(e){return e.classList||new z(e)}function z(e){this._node=e,this._names=M(e.getAttribute("class")||"")}function L(e,t){for(var n=B(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function P(e,t){for(var n=B(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function j(e){return function(){L(this,e)}}function U(e){return function(){P(this,e)}}function W(e,t){return function(){(t.apply(this,arguments)?L:P)(this,e)}}function V(){this.textContent=""}function q(e){return function(){this.textContent=e}}function G(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function H(){this.innerHTML=""}function X(e){return function(){this.innerHTML=e}}function Y(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function K(){this.nextSibling&&this.parentNode.appendChild(this)}function J(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Z(){return null}function Q(){var e=this.parentNode;e&&e.removeChild(this)}function ee(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function te(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}v.prototype={constructor:v,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},z.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var ne={},ie=null;function re(e,t,n){return e=se(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function se(e,t,n){return function(i){var r=ie;ie=i;try{e.call(this,this.__data__,t,n)}finally{ie=r}}}function ae(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}function oe(e){return function(){var t=this.__on;if(t){for(var n,i=0,r=-1,s=t.length;i<s;++i)n=t[i],e.type&&n.type!==e.type||n.name!==e.name?t[++r]=n:this.removeEventListener(n.type,n.listener,n.capture);++r?t.length=r:delete this.__on}}}function ue(e,t,n){var i=ne.hasOwnProperty(e.type)?re:se;return function(r,s,a){var o,u=this.__on,l=i(t,s,a);if(u)for(var c=0,d=u.length;c<d;++c)if((o=u[c]).type===e.type&&o.name===e.name)return this.removeEventListener(o.type,o.listener,o.capture),this.addEventListener(o.type,o.listener=l,o.capture=n),void(o.value=t);this.addEventListener(e.type,l,n),o={type:e.type,name:e.name,value:t,listener:l,capture:n},u?u.push(o):this.__on=[o]}}function le(e,t,n,i){var r=ie;e.sourceEvent=ie,ie=e;try{return t.apply(n,i)}finally{ie=r}}function ce(e,t,n){var i=F(e),r=i.CustomEvent;"function"==typeof r?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function de(e,t){return function(){return ce(this,e,t)}}function he(e,t){return function(){return ce(this,e,t.apply(this,arguments))}}"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(ne={mouseenter:"mouseover",mouseleave:"mouseout"}));var fe=[null];function pe(e,t){this._groups=e,this._parents=t}function me(){return new pe([[document.documentElement]],fe)}pe.prototype=me.prototype={constructor:pe,select:function(e){"function"!=typeof e&&(e=c(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s,a,o=t[r],u=o.length,l=i[r]=new Array(u),d=0;d<u;++d)(s=o[d])&&(a=e.call(s,s.__data__,d,o))&&("__data__"in s&&(a.__data__=s.__data__),l[d]=a);return new pe(i,this._parents)},selectAll:function(e){"function"!=typeof e&&(e=h(e));for(var t=this._groups,n=t.length,i=[],r=[],s=0;s<n;++s)for(var a,o=t[s],u=o.length,l=0;l<u;++l)(a=o[l])&&(i.push(e.call(a,a.__data__,l,o)),r.push(a));return new pe(i,r)},filter:function(e){"function"!=typeof e&&(e=g(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s,a=t[r],o=a.length,u=i[r]=[],l=0;l<o;++l)(s=a[l])&&e.call(s,s.__data__,l,a)&&u.push(s);return new pe(i,this._parents)},data:function(e,t){if(!e)return p=new Array(this.size()),c=-1,this.each((function(e){p[++c]=e})),p;var n,i=t?x:b,r=this._parents,s=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var a=s.length,o=new Array(a),u=new Array(a),l=new Array(a),c=0;c<a;++c){var d=r[c],h=s[c],f=h.length,p=e.call(d,d&&d.__data__,c,r),m=p.length,g=u[c]=new Array(m),y=o[c]=new Array(m);i(d,h,g,y,l[c]=new Array(f),p,t);for(var v,w,C=0,k=0;C<m;++C)if(v=g[C]){for(C>=k&&(k=C+1);!(w=y[k])&&++k<m;);v._next=w||null}}return(o=new pe(o,r))._enter=u,o._exit=l,o},enter:function(){return new pe(this._enter||this._groups.map(y),this._parents)},exit:function(){return new pe(this._exit||this._groups.map(y),this._parents)},merge:function(e){for(var t=this._groups,n=e._groups,i=t.length,r=n.length,s=Math.min(i,r),a=new Array(i),o=0;o<s;++o)for(var u,l=t[o],c=n[o],d=l.length,h=a[o]=new Array(d),f=0;f<d;++f)(u=l[f]||c[f])&&(h[f]=u);for(;o<i;++o)a[o]=t[o];return new pe(a,this._parents)},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i,r=e[t],s=r.length-1,a=r[s];--s>=0;)(i=r[s])&&(a&&a!==i.nextSibling&&a.parentNode.insertBefore(i,a),a=i);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=w);for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var a,o=n[s],u=o.length,l=r[s]=new Array(u),c=0;c<u;++c)(a=o[c])&&(l[c]=a);l.sort(t)}return new pe(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){var e=new Array(this.size()),t=-1;return this.each((function(){e[++t]=this})),e},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length;r<s;++r){var a=i[r];if(a)return a}return null},size:function(){var e=0;return this.each((function(){++e})),e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r,s=t[n],a=0,o=s.length;a<o;++a)(r=s[a])&&e.call(r,r.__data__,a,s);return this},attr:function(e,t){var n=s(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?k:C:"function"==typeof t?n.local?S:E:n.local?_:A)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?D:"function"==typeof t?O:$)(e,t,null==n?"":n)):N(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?I:"function"==typeof t?R:T)(e,t)):this.node()[e]},classed:function(e,t){var n=M(e+"");if(arguments.length<2){for(var i=B(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof t?W:t?j:U)(n,t))},text:function(e){return arguments.length?this.each(null==e?V:("function"==typeof e?G:q)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?H:("function"==typeof e?Y:X)(e)):this.node().innerHTML},raise:function(){return this.each(K)},lower:function(){return this.each(J)},append:function(e){var t="function"==typeof e?e:u(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"==typeof e?e:u(e),i=null==t?Z:"function"==typeof t?t:c(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(Q)},clone:function(e){return this.select(e?te:ee)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var i,r,s=ae(e+""),a=s.length;if(!(arguments.length<2)){for(o=t?ue:oe,null==n&&(n=!1),i=0;i<a;++i)this.each(o(s[i],t,n));return this}var o=this.node().__on;if(o)for(var u,l=0,c=o.length;l<c;++l)for(i=0,u=o[l];i<a;++i)if((r=s[i]).type===u.type&&r.name===u.name)return u.value},dispatch:function(e,t){return this.each(("function"==typeof t?he:de)(e,t))}};const ge=me;function ye(e){return"string"==typeof e?new pe([[document.querySelector(e)]],[document.documentElement]):new pe([[e]],fe)}function ve(e){return ye(u(e).call(document.documentElement))}var be=0;function xe(){return new we}function we(){this._="@"+(++be).toString(36)}function Ce(){for(var e,t=ie;e=t.sourceEvent;)t=e;return t}function ke(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,[(i=i.matrixTransform(e.getScreenCTM().inverse())).x,i.y]}var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}function Ae(e){var t=Ce();return t.changedTouches&&(t=t.changedTouches[0]),ke(e,t)}function _e(e){return"string"==typeof e?new pe([document.querySelectorAll(e)],[document.documentElement]):new pe([null==e?[]:e],fe)}function Ee(e,t,n){arguments.length<3&&(n=t,t=Ce().changedTouches);for(var i,r=0,s=t?t.length:0;r<s;++r)if((i=t[r]).identifier===n)return ke(e,i);return null}function Se(e,t){null==t&&(t=Ce().touches);for(var n=0,i=t?t.length:0,r=new Array(i);n<i;++n)r[n]=ke(e,t[n]);return r}we.prototype=xe.prototype={constructor:we,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}}},9378:e=>{"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var i,r,s;if(Array.isArray(t)){if((i=t.length)!=n.length)return!1;for(r=i;0!=r--;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((i=(s=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(r=i;0!=r--;)if(!Object.prototype.hasOwnProperty.call(n,s[r]))return!1;for(r=i;0!=r--;){var a=s[r];if(!e(t[a],n[a]))return!1}return!0}return t!=t&&n!=n}},5695:e=>{"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,i="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(n=t.cmp,function(e){return function(t,i){var r={key:t,value:e[t]},s={key:i,value:e[i]};return n(r,s)}}),s=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,a;if(Array.isArray(t)){for(a="[",n=0;n<t.length;n++)n&&(a+=","),a+=e(t[n])||"null";return a+"]"}if(null===t)return"null";if(-1!==s.indexOf(t)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var o=s.push(t)-1,u=Object.keys(t).sort(r&&r(t));for(a="",n=0;n<u.length;n++){var l=u[n],c=e(t[l]);c&&(a&&(a+=","),a+=JSON.stringify(l)+":"+c)}return s.splice(o,1),"{"+a+"}"}}(e)}},3594:e=>{"use strict";var t=/-(.)/g;e.exports=function(e){return e.replace(t,(function(e,t){return t.toUpperCase()}))}},6542:(e,t,n)=>{"use strict";var i=n(3594),r=/^-ms-/;e.exports=function(e){return i(e.replace(r,"ms-"))}},7201:e=>{"use strict";function t(e){return function(){return e}}var n=function(){};n.thatReturns=t,n.thatReturnsFalse=t(!1),n.thatReturnsTrue=t(!0),n.thatReturnsNull=t(null),n.thatReturnsThis=function(){return this},n.thatReturnsArgument=function(e){return e},e.exports=n},2501:e=>{"use strict";var t=/([A-Z])/g;e.exports=function(e){return e.replace(t,"-$1").toLowerCase()}},5901:(e,t,n)=>{"use strict";var i=n(2501),r=/^ms-/;e.exports=function(e){return i(e).replace(r,"-ms-")}},9846:e=>{"use strict";e.exports=function(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}},6590:(e,t,n)=>{"use strict";var i=n(7201);e.exports=i},4079:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},i=["Webkit","ms","Moz","O"];Object.keys(n).forEach((function(e){i.forEach((function(t){n[function(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}(t,e)]=n[e]}))}));var r={isUnitlessNumber:n,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}};t.default=r},9291:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(4079));function r(e){return e&&e.__esModule?e:{default:e}}r(n(6590));var s=i.default.isUnitlessNumber;t.default=function(e,t,n){return null==t||"boolean"==typeof t||""===t?"":isNaN(t)||0===t||s.hasOwnProperty(e)&&s[e]?""+t:("string"==typeof t&&(t=t.trim()),t+"px")}},787:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.processStyleName=void 0,t.createMarkupForStyles=function(e,t){var n="";for(var r in e){var s=0===r.indexOf("--");if(e.hasOwnProperty(r)&&"label"!==r){var a=e[r];null!=a&&(s?n+=r+":"+a+";":(n+=o(r)+":",n+=(0,i.default)(r,a,t)+";"))}}return n||null},a(n(6542));var i=a(n(9291)),r=a(n(5901)),s=a(n(9846));function a(e){return e&&e.__esModule?e:{default:e}}a(n(6590));var o=t.processStyleName=(0,s.default)(r.default)},5096:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e){return Array.isArray(e)?(r=!1,s=[],(t=e).forEach((function(e){var t=i(e);null!==t&&t===e||(r=!0),null!==t&&s.push(t)})),0==s.length?null:r?s:t):function(e){if(function(e){return null==e||!1===e||"object"===(void 0===e?"undefined":n(e))&&0===Object.keys(e).length}(e))return null;if("object"!==(void 0===e?"undefined":n(e)))return e;for(var t={},r=Object.keys(e),s=!1,a=0;a<r.length;a++){var o=e[r[a]],u=i(o);null!==u&&u===o||(s=!0),null!==u&&(t[r[a]]=u)}return 0===Object.keys(t).length?null:s?t:e}(e);var t,r,s}t.default=i},5902:(e,t)=>{"use strict";function n(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)+(e.charCodeAt(t++)<<16)+(e.charCodeAt(t)<<24)}function i(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)}function r(e,t){return(65535&(e|=0))*(t|=0)+(((e>>>16)*t&65535)<<16)|0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var s=1540483477,a=t^e.length,o=e.length,u=0;o>=4;){var l=n(e,u);l=r(l,s),l=r(l^=l>>>24,s),a=r(a,s),a^=l,u+=4,o-=4}switch(o){case 3:a^=i(e,u),a=r(a^=e.charCodeAt(u+2)<<16,s);break;case 2:a=r(a^=i(e,u),s);break;case 1:a=r(a^=e.charCodeAt(u),s)}return a=r(a^=a>>>13,s),(a^=a>>>15)>>>0}},1978:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compose=t.merge=t.$=t.style=t.presets=t.keyframes=t.fontFace=t.insertGlobal=t.insertRule=t.plugins=t.styleSheet=void 0,t.speedy=function(e){return d.speedy(e)},t.simulations=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];p=!!e},t.simulate=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(t=(0,a.default)(t))?p?t.reduce((function(e,t){return e["data-simulate-"+v(t)]="",e}),{}):(m||(console.warn("can't simulate without once calling simulations(true)"),m=!0),g||(console.warn("don't use simulation outside dev"),g=!0),{}):{}},t.cssLabels=function(e){y=!!e},t.isLikeRule=x,t.idFor=w,t.css=U,t.rehydrate=function(e){(0,i.default)(F,e.reduce((function(e,t){return e[t]=!0,e}),{}))},t.flush=function(){F=d.inserted={},D=d.registered={},O={},d.flush(),d.inject()},t.select=V,t.parent=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return U(c({},e+" &",n))},t.media=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return U(c({},"@media "+e,n))},t.pseudo=q,t.active=function(e){return q(":active",e)},t.any=function(e){return q(":any",e)},t.checked=function(e){return q(":checked",e)},t.disabled=function(e){return q(":disabled",e)},t.empty=function(e){return q(":empty",e)},t.enabled=function(e){return q(":enabled",e)},t._default=function(e){return q(":default",e)},t.first=function(e){return q(":first",e)},t.firstChild=function(e){return q(":first-child",e)},t.firstOfType=function(e){return q(":first-of-type",e)},t.fullscreen=function(e){return q(":fullscreen",e)},t.focus=function(e){return q(":focus",e)},t.hover=function(e){return q(":hover",e)},t.indeterminate=function(e){return q(":indeterminate",e)},t.inRange=function(e){return q(":in-range",e)},t.invalid=function(e){return q(":invalid",e)},t.lastChild=function(e){return q(":last-child",e)},t.lastOfType=function(e){return q(":last-of-type",e)},t.left=function(e){return q(":left",e)},t.link=function(e){return q(":link",e)},t.onlyChild=function(e){return q(":only-child",e)},t.onlyOfType=function(e){return q(":only-of-type",e)},t.optional=function(e){return q(":optional",e)},t.outOfRange=function(e){return q(":out-of-range",e)},t.readOnly=function(e){return q(":read-only",e)},t.readWrite=function(e){return q(":read-write",e)},t.required=function(e){return q(":required",e)},t.right=function(e){return q(":right",e)},t.root=function(e){return q(":root",e)},t.scope=function(e){return q(":scope",e)},t.target=function(e){return q(":target",e)},t.valid=function(e){return q(":valid",e)},t.visited=function(e){return q(":visited",e)},t.dir=function(e,t){return q(":dir("+e+")",t)},t.lang=function(e,t){return q(":lang("+e+")",t)},t.not=function(e,t){var n=e.split(",").map((function(e){return e.trim()})).map((function(e){return":not("+e+")"}));return 1===n.length?q(":not("+e+")",t):V(n.join(""),t)},t.nthChild=function(e,t){return q(":nth-child("+e+")",t)},t.nthLastChild=function(e,t){return q(":nth-last-child("+e+")",t)},t.nthLastOfType=function(e,t){return q(":nth-last-of-type("+e+")",t)},t.nthOfType=function(e,t){return q(":nth-of-type("+e+")",t)},t.after=function(e){return q("::after",e)},t.before=function(e){return q("::before",e)},t.firstLetter=function(e){return q("::first-letter",e)},t.firstLine=function(e){return q("::first-line",e)},t.selection=function(e){return q("::selection",e)},t.backdrop=function(e){return q("::backdrop",e)},t.placeholder=function(e){return U({"::placeholder":e})},t.cssFor=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(t=(0,a.default)(t))?t.map((function(e){var t={label:[]};return M(t,{src:e}),S(b(t),E(t)).join("")})).join(""):""},t.attribsFor=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=(t=(0,a.default)(t))?t.map((function(e){w(e);var t=Object.keys(e)[0];return t+'="'+(e[t]||"")+'"'})).join(" "):"";return i};var i=l(n(7320)),r=n(3873),s=n(787),a=l(n(5096)),o=n(7543),u=l(n(5902));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=t.styleSheet=new r.StyleSheet;d.inject();var h=t.plugins=d.plugins=new o.PluginSet([o.prefixes,o.contentWrap,o.fallbacks]);h.media=new o.PluginSet,h.fontFace=new o.PluginSet,h.keyframes=new o.PluginSet([o.prefixes,o.fallbacks]);var f="undefined"!=typeof window,p=false,m=!1,g=!1,y=false;function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.toLowerCase().replace(/[^a-z0-9]/g,t)}function b(e){var t=JSON.stringify(e),n=(0,u.default)(t).toString(36);return e.label&&e.label.length,n}function x(e){var t=Object.keys(e).filter((function(e){return"toString"!==e}));return 1===t.length&&!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(t[0])}function w(e){var t=Object.keys(e).filter((function(e){return"toString"!==e}));if(1!==t.length)throw new Error("not a rule");var n=/data\-css\-([a-zA-Z0-9\-_]+)/.exec(t[0]);if(!n)throw new Error("not a rule");return n[1]}var C=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function k(e){if(-1===e.indexOf(","))return[e];for(var t,n=[],i=[],r=0;t=C.exec(e);)switch(t[0]){case"(":r++;break;case")":r--;break;case",":if(r)break;n.push(t.index)}for(t=n.length;t--;)i.unshift(e.slice(n[t]+1)),e=e.slice(0,n[t]);return i.unshift(e),i}function A(e,t){if(!e)return t.replace(/\&/g,"");if(!t)return".css-"+e+",[data-css-"+e+"]";var n=k(t).map((function(t){return t.indexOf("&")>=0?[t.replace(/\&/gm,".css-"+e),t.replace(/\&/gm,"[data-css-"+e+"]")].join(","):".css-"+e+t+",[data-css-"+e+"]"+t})).join(",");return p&&/^\&\:/.exec(t)&&!/\s/.exec(t)&&(n+=",.css-"+e+"[data-simulate-"+v(t)+"],[data-css-"+e+"][data-simulate-"+v(t)+"]"),n}function _(e){var t=e.selector,n=e.style,i=h.transform({selector:t,style:n});return i.selector+"{"+(0,s.createMarkupForStyles)(i.style)+"}"}function E(e){var t=void 0,n=void 0,i=void 0,r=void 0;return Object.keys(e).forEach((function(s){s.indexOf("&")>=0?(n=n||{})[s]=e[s]:0===s.indexOf("@media")?(i=i||{})[s]=E(e[s]):0===s.indexOf("@supports")?(r=r||{})[s]=E(e[s]):"label"===s?e.label.length>0&&((t=t||{}).label=y?e.label.join("."):""):(t=t||{})[s]=e[s]})),{plain:t,selects:n,medias:i,supports:r}}function S(e,t){var n=[],i=t.plain,r=t.selects,s=t.medias,a=t.supports;return i&&n.push(_({style:i,selector:A(e)})),r&&Object.keys(r).forEach((function(t){return n.push(_({style:r[t],selector:A(e,t)}))})),s&&Object.keys(s).forEach((function(t){return n.push(t+"{"+S(e,s[t]).join("")+"}")})),a&&Object.keys(a).forEach((function(t){return n.push(t+"{"+S(e,a[t]).join("")+"}")})),n}var F=d.inserted={},D=d.registered={};function $(e){D[e.id]||(D[e.id]=e)}var O={};function N(e,t){var n=k(e).map((function(e){return e.indexOf("&")>=0?e:"&"+e}));return k(t).map((function(e){return e.indexOf("&")>=0?e:"&"+e})).reduce((function(e,t){return e.concat(n.map((function(e){return t.replace(/\&/g,e)})))}),[]).join(",")}function I(e,t){return e?"@supports "+e.substring(9)+" and "+t.substring(9):t}function T(e){for(var t=[],n=0;n<e.length;n++)t=Array.isArray(e[n])?t.concat(T(e[n])):t.concat(e[n]);return t}var R={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function M(e,t){var n=t.selector,i=void 0===n?"":n,r=t.mq,s=void 0===r?"":r,o=t.supp,u=void 0===o?"":o,l=t.src,c=void 0===l?{}:l;Array.isArray(c)||(c=[c]),(c=T(c)).forEach((function(t){if(x(t)){var n=function(e){if(x(e)){var t=D[w(e)];if(null==t)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return t}return e}(t);if("css"!==n.type)throw new Error("cannot merge this rule");t=n.style}(t=(0,a.default)(t))&&t.composes&&M(e,{selector:i,mq:s,supp:u,src:t.composes}),Object.keys(t||{}).forEach((function(n){if(function(e){for(var t=[":",".","[",">"," "],n=!1,i=e.charAt(0),r=0;r<t.length;r++)if(i===t[r]){n=!0;break}return n||e.indexOf("&")>=0}(n))R[n]&&R[n].forEach((function(r){return M(e,{selector:N(i,r),mq:s,supp:u,src:t[n]})})),M(e,{selector:N(i,n),mq:s,supp:u,src:t[n]});else if(function(e){return 0===e.indexOf("@media")}(n))M(e,{selector:i,mq:(a=s,o=n,a?"@media "+a.substring(6)+" and "+o.substring(6):o),supp:u,src:t[n]});else if(function(e){return 0===e.indexOf("@supports")}(n))M(e,{selector:i,mq:s,supp:I(u,n),src:t[n]});else if("composes"===n);else{var r=e;u&&(r[u]=r[u]||{},r=r[u]),s&&(r[s]=r[s]||{},r=r[s]),i&&(r[i]=r[i]||{},r=r[i]),"label"===n?y&&(e.label=e.label.concat(t.label)):r[n]=t[n]}var a,o}))}))}function B(e){var t={label:[]};return M(t,{src:e}),function(e){if($(e),function(e){if(!F[e.id]){F[e.id]=!0;var t=E(e.style),n=S(e.id,t);F[e.id]=!!f||n,n.forEach((function(e){return d.insert(e)}))}}(e),O[e.id])return O[e.id];var t=c({},"data-css-"+e.id,y&&e.label||"");return Object.defineProperty(t,"toString",{enumerable:!1,value:function(){return"css-"+e.id}}),O[e.id]=t,t}({id:b(t),style:t,label:y?t.label.join("."):"",type:"css"})}var z={};Object.defineProperty(z,"toString",{enumerable:!1,value:function(){return"css-nil"}});var L,P="undefined"!=typeof WeakMap?[z,new WeakMap,new WeakMap,new WeakMap]:[z],j="undefined"!=typeof WeakMap?(L=B,function(e){if(P[e.length]){for(var t=P[e.length],n=0;n<e.length-1;)t.has(e[n])||t.set(e[n],new WeakMap),t=t.get(e[n]),n++;if(t.has(e[e.length-1])){var i=t.get(e[n]);if(D[i.toString().substring(4)])return i}}var r=L(e);if(P[e.length]){for(var s=0,a=P[e.length];s<e.length-1;)a=a.get(e[s]),s++;try{a.set(e[s],r)}catch(e){}}return r}):B;function U(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t[0]&&t[0].length&&t[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return(t=(0,a.default)(t))?j(t):z}U.insert=function(e){var t={id:b(e),css:e,type:"raw"};$(t),F[t.id]||(d.insert(t.css),F[t.id]=!!f||[t.css])},t.insertRule=U.insert,U.global=function(e,t){if(t=(0,a.default)(t))return U.insert(_({selector:e,style:t}))},t.insertGlobal=U.global,U.keyframes=function(e,t){t||(t=e,e="animation");var n={id:b({name:e,kfs:t=(0,a.default)(t)||{}}),type:"keyframes",name:e,keyframes:t};return $(n),function(e){if(!F[e.id]){var t=Object.keys(e.keyframes).map((function(t){var n=h.keyframes.transform({id:e.id,name:t,style:e.keyframes[t]});return n.name+"{"+(0,s.createMarkupForStyles)(n.style)+"}"})).join(""),n=["-webkit-","-moz-","-o-",""].map((function(n){return"@"+n+"keyframes "+e.name+"_"+e.id+"{"+t+"}"}));n.forEach((function(e){return d.insert(e)})),F[e.id]=!!f||n}}(n),e+"_"+n.id},U.fontFace=function(e){var t={id:b(e=(0,a.default)(e)),type:"font-face",font:e};return $(t),function(e){if(!F[e.id]){var t="@font-face{"+(0,s.createMarkupForStyles)(e.font)+"}";d.insert(t),F[e.id]=!!f||[t]}}(t),e.fontFamily},t.fontFace=U.fontFace,t.keyframes=U.keyframes,t.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var W=t.style=U;function V(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e?U(c({},e,n)):W(n)}function q(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return U(c({},e,n))}t.$=V,t.merge=U,t.compose=U},7543:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};t.PluginSet=u,t.fallbacks=function(e){if(Object.keys(e.style).map((function(t){return Array.isArray(e.style[t])})).indexOf(!0)>=0){var t=e.style,n=Object.keys(t).reduce((function(e,n){return e[n]=Array.isArray(t[n])?t[n].join("; "+(0,s.processStyleName)(n)+": "):t[n],e}),{});return(0,r.default)({},e,{style:n})}return e},t.contentWrap=function(e){if(e.style.content){var t=e.style.content;return l.indexOf(t)>=0||/^(attr|calc|counters?|url)\(/.test(t)?e:t.charAt(0)!==t.charAt(t.length-1)||'"'!==t.charAt(0)&&"'"!==t.charAt(0)?i({},e,{style:i({},e.style,{content:'"'+t+'"'})}):e}return e},t.prefixes=function(e){return(0,r.default)({},e,{style:(0,a.default)(i({},e.style))})};var r=o(n(7320)),s=n(787),a=o(n(6626));function o(e){return e&&e.__esModule?e:{default:e}}function u(e){this.fns=e||[]}(0,r.default)(u.prototype,{add:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];n.forEach((function(t){e.fns.indexOf(t)>=0||(e.fns=[t].concat(e.fns))}))},remove:function(e){this.fns=this.fns.filter((function(t){return t!==e}))},clear:function(){this.fns=[]},transform:function(e){return this.fns.reduce((function(e,t){return t(e)}),e)}});var l=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"]},6626:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t in e){var n=e[t],i=(0,s.default)(y,t,n,e,v);i&&(e[t]=i),(0,r.default)(v,t,e)}return e};var i=g(n(6218)),r=g(n(3720)),s=g(n(1408)),a=g(n(6139)),o=g(n(7237)),u=g(n(7451)),l=g(n(487)),c=g(n(9806)),d=g(n(8480)),h=g(n(1727)),f=g(n(7670)),p=g(n(6849)),m=g(n(5633));function g(e){return e&&e.__esModule?e:{default:e}}var y=[o.default,a.default,u.default,c.default,d.default,h.default,f.default,p.default,m.default,l.default],v=i.default.prefixMap},3873:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StyleSheet=c;var i,r=(i=n(7320))&&i.__esModule?i:{default:i};function s(e){return e[e.length-1]}function a(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}var o="undefined"!=typeof window,u=function(){if(o){var e=document.createElement("div");return e.innerHTML="\x3c!--[if lt IE 10]><i></i><![endif]--\x3e",1===e.getElementsByTagName("i").length}}();function l(){var e=document.createElement("style");return e.type="text/css",e.setAttribute("data-glamor",""),e.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(e),e}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.speedy,n=void 0===t||t,i=e.maxLength,r=void 0===i?o&&u?4e3:65e3:i;this.isSpeedy=n,this.sheet=void 0,this.tags=[],this.maxLength=r,this.ctr=0}(0,r.default)(c.prototype,{getSheet:function(){return a(s(this.tags))},inject:function(){var e=this;if(this.injected)throw new Error("already injected stylesheet!");o?this.tags[0]=l():this.sheet={cssRules:[],insertRule:function(t){e.sheet.cssRules.push({cssText:t})}},this.injected=!0},speedy:function(e){if(0!==this.ctr)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+e+") earlier in your app, or call flush() before speedy("+e+")");this.isSpeedy=!!e},_insert:function(e){try{var t=this.getSheet();t.insertRule(e,-1!==e.indexOf("@import")?0:t.cssRules.length)}catch(e){}},insert:function(e){if(o)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(e);else if(-1!==e.indexOf("@import")){var t=s(this.tags);t.insertBefore(document.createTextNode(e),t.firstChild)}else s(this.tags).appendChild(document.createTextNode(e));else this.sheet.insertRule(e,-1!==e.indexOf("@import")?0:this.sheet.cssRules.length);return this.ctr++,o&&this.ctr%this.maxLength==0&&this.tags.push(l()),this.ctr-1},delete:function(e){return this.replace(e,"")},flush:function(){o?(this.tags.forEach((function(e){return e.parentNode.removeChild(e)})),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!o)return this.sheet.cssRules;var e=[];return this.tags.forEach((function(t){return e.splice.apply(e,[e.length,0].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Array.from(a(t).cssRules))))})),e}})},3603:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var i=/[A-Z]/g,r=/^ms-/,s={};function a(e){return"-"+e.toLowerCase()}const o=function(e){if(s.hasOwnProperty(e))return s[e];var t=e.replace(i,a);return s[e]=r.test(t)?"-"+t:t}},7237:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,r.default)(t)&&t.indexOf("cross-fade(")>-1)return s.map((function(e){return t.replace(/cross-fade\(/g,e+"cross-fade(")}))};var i,r=(i=n(522))&&i.__esModule?i:{default:i},s=["-webkit-",""];e.exports=t.default},6139:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("cursor"===e&&i.hasOwnProperty(t))return n.map((function(e){return e+t}))};var n=["-webkit-","-moz-",""],i={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};e.exports=t.default},7451:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,r.default)(t)&&t.indexOf("filter(")>-1)return s.map((function(e){return t.replace(/filter\(/g,e+"filter(")}))};var i,r=(i=n(522))&&i.__esModule?i:{default:i},s=["-webkit-",""];e.exports=t.default},487:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("display"===e&&n.hasOwnProperty(t))return n[t]};var n={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};e.exports=t.default},9806:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){"flexDirection"===e&&"string"==typeof t&&(t.indexOf("column")>-1?r.WebkitBoxOrient="vertical":r.WebkitBoxOrient="horizontal",t.indexOf("reverse")>-1?r.WebkitBoxDirection="reverse":r.WebkitBoxDirection="normal"),i.hasOwnProperty(e)&&(r[i[e]]=n[t]||t)};var n={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},i={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};e.exports=t.default},8480:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,r.default)(t)&&a.test(t))return s.map((function(e){return e+t}))};var i,r=(i=n(522))&&i.__esModule?i:{default:i},s=["-webkit-","-moz-",""],a=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;e.exports=t.default},1727:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,r.default)(t)&&t.indexOf("image-set(")>-1)return s.map((function(e){return t.replace(/image-set\(/g,e+"image-set(")}))};var i,r=(i=n(522))&&i.__esModule?i:{default:i},s=["-webkit-",""];e.exports=t.default},7670:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("position"===e&&"sticky"===t)return["-webkit-sticky","sticky"]},e.exports=t.default},6849:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(i.hasOwnProperty(e)&&r.hasOwnProperty(t))return n.map((function(e){return e+t}))};var n=["-webkit-","-moz-",""],i={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},r={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};e.exports=t.default},5633:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a){if("string"==typeof t&&o.hasOwnProperty(e)){var l=function(e,t){if((0,r.default)(e))return e;for(var n=e.split(/,(?![^()]*(?:\([^()]*\))?\))/g),s=0,a=n.length;s<a;++s){var o=n[s],l=[o];for(var c in t){var d=(0,i.default)(c);if(o.indexOf(d)>-1&&"order"!==d)for(var h=t[c],f=0,p=h.length;f<p;++f)l.unshift(o.replace(d,u[h[f]]+d))}n[s]=l.join(",")}return n.join(",")}(t,a),c=l.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(e){return!/-moz-|-ms-/.test(e)})).join(",");if(e.indexOf("Webkit")>-1)return c;var d=l.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(e){return!/-webkit-|-ms-/.test(e)})).join(",");return e.indexOf("Moz")>-1?d:(n["Webkit"+(0,s.default)(e)]=c,n["Moz"+(0,s.default)(e)]=d,l)}};var i=a(n(9977)),r=a(n(522)),s=a(n(3741));function a(e){return e&&e.__esModule?e:{default:e}}var o={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},u={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};e.exports=t.default},6218:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=["Webkit"],i=["Moz"],r=["ms"],s=["Webkit","Moz"],a=["Webkit","ms"],o=["Webkit","Moz","ms"];t.default={plugins:[],prefixMap:{appearance:s,userSelect:o,textEmphasisPosition:n,textEmphasis:n,textEmphasisStyle:n,textEmphasisColor:n,boxDecorationBreak:n,clipPath:n,maskImage:n,maskMode:n,maskRepeat:n,maskPosition:n,maskClip:n,maskOrigin:n,maskSize:n,maskComposite:n,mask:n,maskBorderSource:n,maskBorderMode:n,maskBorderSlice:n,maskBorderWidth:n,maskBorderOutset:n,maskBorderRepeat:n,maskBorder:n,maskType:n,textDecorationStyle:n,textDecorationSkip:n,textDecorationLine:n,textDecorationColor:n,filter:n,fontFeatureSettings:n,breakAfter:o,breakBefore:o,breakInside:o,columnCount:s,columnFill:s,columnGap:s,columnRule:s,columnRuleColor:s,columnRuleStyle:s,columnRuleWidth:s,columns:s,columnSpan:s,columnWidth:s,writingMode:a,flex:n,flexBasis:n,flexDirection:n,flexGrow:n,flexFlow:n,flexShrink:n,flexWrap:n,alignContent:n,alignItems:n,alignSelf:n,justifyContent:n,order:n,transform:n,transformOrigin:n,transformOriginX:n,transformOriginY:n,backfaceVisibility:n,perspective:n,perspectiveOrigin:n,transformStyle:n,transformOriginZ:n,animation:n,animationDelay:n,animationDirection:n,animationFillMode:n,animationDuration:n,animationIterationCount:n,animationName:n,animationPlayState:n,animationTimingFunction:n,backdropFilter:n,fontKerning:n,scrollSnapType:a,scrollSnapPointsX:a,scrollSnapPointsY:a,scrollSnapDestination:a,scrollSnapCoordinate:a,shapeImageThreshold:n,shapeImageMargin:n,shapeImageOutside:n,hyphens:o,flowInto:a,flowFrom:a,regionFragment:a,textAlignLast:i,tabSize:i,wrapFlow:r,wrapThrough:r,wrapMargin:r,gridTemplateColumns:r,gridTemplateRows:r,gridTemplateAreas:r,gridTemplate:r,gridAutoColumns:r,gridAutoRows:r,gridAutoFlow:r,grid:r,gridRowStart:r,gridColumnStart:r,gridRowEnd:r,gridRow:r,gridColumn:r,gridColumnEnd:r,gridColumnGap:r,gridRowGap:r,gridArea:r,gridGap:r,textSizeAdjust:a,borderImage:n,borderImageOutset:n,borderImageRepeat:n,borderImageSlice:n,borderImageSource:n,borderImageWidth:n,transitionDelay:n,transitionDuration:n,transitionProperty:n,transitionTimingFunction:n}},e.exports=t.default},3741:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},e.exports=t.default},3720:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(e.hasOwnProperty(t))for(var i=e[t],s=0,a=i.length;s<a;++s)n[i[s]+(0,r.default)(t)]=n[t]};var i,r=(i=n(3741))&&i.__esModule?i:{default:i};e.exports=t.default},1408:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i,r){for(var s=0,a=e.length;s<a;++s){var o=e[s](t,n,i,r);if(o)return o}},e.exports=t.default},7105:(e,t,n)=>{"use strict";const i=n(8006),r=Symbol("max"),s=Symbol("length"),a=Symbol("lengthCalculator"),o=Symbol("allowStale"),u=Symbol("maxAge"),l=Symbol("dispose"),c=Symbol("noDisposeOnSet"),d=Symbol("lruList"),h=Symbol("cache"),f=Symbol("updateAgeOnGet"),p=()=>1,m=(e,t,n)=>{const i=e[h].get(t);if(i){const t=i.value;if(g(e,t)){if(v(e,i),!e[o])return}else n&&(e[f]&&(i.value.now=Date.now()),e[d].unshiftNode(i));return t.value}},g=(e,t)=>{if(!t||!t.maxAge&&!e[u])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[u]&&n>e[u]},y=e=>{if(e[s]>e[r])for(let t=e[d].tail;e[s]>e[r]&&null!==t;){const n=t.prev;v(e,t),t=n}},v=(e,t)=>{if(t){const n=t.value;e[l]&&e[l](n.key,n.value),e[s]-=n.length,e[h].delete(n.key),e[d].removeNode(t)}};class b{constructor(e,t,n,i,r){this.key=e,this.value=t,this.length=n,this.now=i,this.maxAge=r||0}}const x=(e,t,n,i)=>{let r=n.value;g(e,r)&&(v(e,n),e[o]||(r=void 0)),r&&t.call(i,r.value,r.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[r]=e.max||1/0;const t=e.length||p;if(this[a]="function"!=typeof t?p:t,this[o]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[u]=e.maxAge||0,this[l]=e.dispose,this[c]=e.noDisposeOnSet||!1,this[f]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[r]=e||1/0,y(this)}get max(){return this[r]}set allowStale(e){this[o]=!!e}get allowStale(){return this[o]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[u]=e,y(this)}get maxAge(){return this[u]}set lengthCalculator(e){"function"!=typeof e&&(e=p),e!==this[a]&&(this[a]=e,this[s]=0,this[d].forEach((e=>{e.length=this[a](e.value,e.key),this[s]+=e.length}))),y(this)}get lengthCalculator(){return this[a]}get length(){return this[s]}get itemCount(){return this[d].length}rforEach(e,t){t=t||this;for(let n=this[d].tail;null!==n;){const i=n.prev;x(this,e,n,t),n=i}}forEach(e,t){t=t||this;for(let n=this[d].head;null!==n;){const i=n.next;x(this,e,n,t),n=i}}keys(){return this[d].toArray().map((e=>e.key))}values(){return this[d].toArray().map((e=>e.value))}reset(){this[l]&&this[d]&&this[d].length&&this[d].forEach((e=>this[l](e.key,e.value))),this[h]=new Map,this[d]=new i,this[s]=0}dump(){return this[d].map((e=>!g(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[d]}set(e,t,n){if((n=n||this[u])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const i=n?Date.now():0,o=this[a](t,e);if(this[h].has(e)){if(o>this[r])return v(this,this[h].get(e)),!1;const a=this[h].get(e).value;return this[l]&&(this[c]||this[l](e,a.value)),a.now=i,a.maxAge=n,a.value=t,this[s]+=o-a.length,a.length=o,this.get(e),y(this),!0}const f=new b(e,t,o,i,n);return f.length>this[r]?(this[l]&&this[l](e,t),!1):(this[s]+=f.length,this[d].unshift(f),this[h].set(e,this[d].head),y(this),!0)}has(e){if(!this[h].has(e))return!1;const t=this[h].get(e).value;return!g(this,t)}get(e){return m(this,e,!0)}peek(e){return m(this,e,!1)}pop(){const e=this[d].tail;return e?(v(this,e),e.value):null}del(e){v(this,this[h].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const i=e[n],r=i.e||0;if(0===r)this.set(i.k,i.v);else{const e=r-t;e>0&&this.set(i.k,i.v,e)}}}prune(){this[h].forEach(((e,t)=>m(this,t,!1)))}}},2427:(e,t,n)=>{"use strict";function i(){}n.r(t),n.d(t,{default:()=>z,h:()=>o,createElement:()=>o,cloneElement:()=>c,Component:()=>M,render:()=>B,rerender:()=>p,options:()=>r});var r={},s=[],a=[];function o(e,t){var n,o,u,l,c=a;for(l=arguments.length;l-- >2;)s.push(arguments[l]);for(t&&null!=t.children&&(s.length||s.push(t.children),delete t.children);s.length;)if((o=s.pop())&&void 0!==o.pop)for(l=o.length;l--;)s.push(o[l]);else"boolean"==typeof o&&(o=null),(u="function"!=typeof e)&&(null==o?o="":"number"==typeof o?o=String(o):"string"!=typeof o&&(u=!1)),u&&n?c[c.length-1]+=o:c===a?c=[o]:c.push(o),n=u;var d=new i;return d.nodeName=e,d.children=c,d.attributes=null==t?void 0:t,d.key=null==t?void 0:t.key,void 0!==r.vnode&&r.vnode(d),d}function u(e,t){for(var n in t)e[n]=t[n];return e}var l="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function c(e,t){return o(e.nodeName,u(u({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var d=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,h=[];function f(e){!e._dirty&&(e._dirty=!0)&&1==h.push(e)&&(r.debounceRendering||l)(p)}function p(){var e,t=h;for(h=[];e=t.pop();)e._dirty&&T(e)}function m(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&g(e,t.nodeName):n||e._componentConstructor===t.nodeName}function g(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function y(e){var t=u({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var i in n)void 0===t[i]&&(t[i]=n[i]);return t}function v(e){var t=e.parentNode;t&&t.removeChild(e)}function b(e,t,n,i,r){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n&&n(null),i&&i(e);else if("class"!==t||r)if("style"===t){if(i&&"string"!=typeof i&&"string"!=typeof n||(e.style.cssText=i||""),i&&"object"==typeof i){if("string"!=typeof n)for(var s in n)s in i||(e.style[s]="");for(var s in i)e.style[s]="number"==typeof i[s]&&!1===d.test(s)?i[s]+"px":i[s]}}else if("dangerouslySetInnerHTML"===t)i&&(e.innerHTML=i.__html||"");else if("o"==t[0]&&"n"==t[1]){var a=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),i?n||e.addEventListener(t,x,a):e.removeEventListener(t,x,a),(e._listeners||(e._listeners={}))[t]=i}else if("list"!==t&&"type"!==t&&!r&&t in e)!function(e,t,n){try{e[t]=n}catch(e){}}(e,t,null==i?"":i),null!=i&&!1!==i||e.removeAttribute(t);else{var o=r&&t!==(t=t.replace(/^xlink:?/,""));null==i||!1===i?o?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof i&&(o?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),i):e.setAttribute(t,i))}else e.className=i||""}function x(e){return this._listeners[e.type](r.event&&r.event(e)||e)}var w=[],C=0,k=!1,A=!1;function _(){for(var e;e=w.pop();)r.afterMount&&r.afterMount(e),e.componentDidMount&&e.componentDidMount()}function E(e,t,n,i,r,s){C++||(k=null!=r&&void 0!==r.ownerSVGElement,A=null!=e&&!("__preactattr_"in e));var a=S(e,t,n,i,s);return r&&a.parentNode!==r&&r.appendChild(a),--C||(A=!1,s||_()),a}function S(e,t,n,i,r){var s=e,a=k;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(s=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(s,e),F(e,!0))),s.__preactattr_=!0,s;var o,u,l=t.nodeName;if("function"==typeof l)return function(e,t,n,i){for(var r=e&&e._component,s=r,a=e,o=r&&e._componentConstructor===t.nodeName,u=o,l=y(t);r&&!u&&(r=r._parentComponent);)u=r.constructor===t.nodeName;return r&&u&&(!i||r._component)?(I(r,l,3,n,i),e=r.base):(s&&!o&&(R(s),e=a=null),r=O(t.nodeName,l,n),e&&!r.nextBase&&(r.nextBase=e,a=null),I(r,l,1,n,i),e=r.base,a&&e!==a&&(a._component=null,F(a,!1))),e}(e,t,n,i);if(k="svg"===l||"foreignObject"!==l&&k,l=String(l),(!e||!g(e,l))&&(o=l,(u=k?document.createElementNS("http://www.w3.org/2000/svg",o):document.createElement(o)).normalizedNodeName=o,s=u,e)){for(;e.firstChild;)s.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(s,e),F(e,!0)}var c=s.firstChild,d=s.__preactattr_,h=t.children;if(null==d){d=s.__preactattr_={};for(var f=s.attributes,p=f.length;p--;)d[f[p].name]=f[p].value}return!A&&h&&1===h.length&&"string"==typeof h[0]&&null!=c&&void 0!==c.splitText&&null==c.nextSibling?c.nodeValue!=h[0]&&(c.nodeValue=h[0]):(h&&h.length||null!=c)&&function(e,t,n,i,r){var s,a,o,u,l,c=e.childNodes,d=[],h={},f=0,p=0,g=c.length,y=0,b=t?t.length:0;if(0!==g)for(var x=0;x<g;x++){var w=c[x],C=w.__preactattr_;null!=(k=b&&C?w._component?w._component.__key:C.key:null)?(f++,h[k]=w):(C||(void 0!==w.splitText?!r||w.nodeValue.trim():r))&&(d[y++]=w)}if(0!==b)for(x=0;x<b;x++){var k;if(l=null,null!=(k=(u=t[x]).key))f&&void 0!==h[k]&&(l=h[k],h[k]=void 0,f--);else if(!l&&p<y)for(s=p;s<y;s++)if(void 0!==d[s]&&m(a=d[s],u,r)){l=a,d[s]=void 0,s===y-1&&y--,s===p&&p++;break}l=S(l,u,n,i),o=c[x],l&&l!==e&&l!==o&&(null==o?e.appendChild(l):l===o.nextSibling?v(o):e.insertBefore(l,o))}if(f)for(var x in h)void 0!==h[x]&&F(h[x],!1);for(;p<=y;)void 0!==(l=d[y--])&&F(l,!1)}(s,h,n,i,A||null!=d.dangerouslySetInnerHTML),function(e,t,n){var i;for(i in n)t&&null!=t[i]||null==n[i]||b(e,i,n[i],n[i]=void 0,k);for(i in t)"children"===i||"innerHTML"===i||i in n&&t[i]===("value"===i||"checked"===i?e[i]:n[i])||b(e,i,n[i],n[i]=t[i],k)}(s,t.attributes,d),k=a,s}function F(e,t){var n=e._component;n?R(n):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==t&&null!=e.__preactattr_||v(e),D(e))}function D(e){for(e=e.lastChild;e;){var t=e.previousSibling;F(e,!0),e=t}}var $={};function O(e,t,n){var i,r=$[e.name];if(e.prototype&&e.prototype.render?(i=new e(t,n),M.call(i,t,n)):((i=new M(t,n)).constructor=e,i.render=N),r)for(var s=r.length;s--;)if(r[s].constructor===e){i.nextBase=r[s].nextBase,r.splice(s,1);break}return i}function N(e,t,n){return this.constructor(e,n)}function I(e,t,n,i,s){e._disable||(e._disable=!0,(e.__ref=t.ref)&&delete t.ref,(e.__key=t.key)&&delete t.key,!e.base||s?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,i),i&&i!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=i),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==n&&(1!==n&&!1===r.syncComponentUpdates&&e.base?f(e):T(e,1,s)),e.__ref&&e.__ref(e))}function T(e,t,n,i){if(!e._disable){var s,a,o,l=e.props,c=e.state,d=e.context,h=e.prevProps||l,f=e.prevState||c,p=e.prevContext||d,m=e.base,g=e.nextBase,v=m||g,b=e._component,x=!1;if(m&&(e.props=h,e.state=f,e.context=p,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(l,c,d)?x=!0:e.componentWillUpdate&&e.componentWillUpdate(l,c,d),e.props=l,e.state=c,e.context=d),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!x){s=e.render(l,c,d),e.getChildContext&&(d=u(u({},d),e.getChildContext()));var k,A,S=s&&s.nodeName;if("function"==typeof S){var D=y(s);(a=b)&&a.constructor===S&&D.key==a.__key?I(a,D,1,d,!1):(k=a,e._component=a=O(S,D,d),a.nextBase=a.nextBase||g,a._parentComponent=e,I(a,D,0,d,!1),T(a,1,n,!0)),A=a.base}else o=v,(k=b)&&(o=e._component=null),(v||1===t)&&(o&&(o._component=null),A=E(o,s,d,n||!m,v&&v.parentNode,!0));if(v&&A!==v&&a!==b){var $=v.parentNode;$&&A!==$&&($.replaceChild(A,v),k||(v._component=null,F(v,!1)))}if(k&&R(k),e.base=A,A&&!i){for(var N=e,M=e;M=M._parentComponent;)(N=M).base=A;A._component=N,A._componentConstructor=N.constructor}}if(!m||n?w.unshift(e):x||(e.componentDidUpdate&&e.componentDidUpdate(h,f,p),r.afterUpdate&&r.afterUpdate(e)),null!=e._renderCallbacks)for(;e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);C||i||_()}}function R(e){r.beforeUnmount&&r.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?R(n):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),e.nextBase=t,v(t),function(e){var t=e.constructor.name;($[t]||($[t]=[])).push(e)}(e),D(t)),e.__ref&&e.__ref(null)}function M(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{}}function B(e,t,n){return E(n,e,{},!1,t,!1)}u(M.prototype,{setState:function(e,t){var n=this.state;this.prevState||(this.prevState=u({},n)),u(n,"function"==typeof e?e(n,this.props):e),t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),f(this)},forceUpdate:function(e){e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),T(this,2)},render:function(){}});const z={h:o,createElement:o,cloneElement:c,Component:M,render:B,rerender:p,options:r}},9570:(e,t,n)=>{"use strict";n.d(t,{x:()=>v});var i=n(2784);function r(e,t,n,i,r,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(i,r)}function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var a={exports:{}};!function(e){var t=function(e){var t,n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var r=t&&t.prototype instanceof g?t:g,s=Object.create(r.prototype),a=new F(i||[]);return s._invoke=function(e,t,n){var i=d;return function(r,s){if(i===f)throw new Error("Generator is already running");if(i===p){if("throw"===r)throw s;return $()}for(n.method=r,n.arg=s;;){var a=n.delegate;if(a){var o=_(a,n);if(o){if(o===m)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===d)throw i=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var u=c(e,t,n);if("normal"===u.type){if(i=n.done?p:h,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=p,n.method="throw",n.arg=u.arg)}}}(e,n,a),s}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var d="suspendedStart",h="suspendedYield",f="executing",p="completed",m={};function g(){}function y(){}function v(){}var b={};u(b,s,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(D([])));w&&w!==n&&i.call(w,s)&&(b=w);var C=v.prototype=g.prototype=Object.create(b);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function n(r,s,a,o){var u=c(e[r],e,s);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==typeof d&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,o)}),(function(e){n("throw",e,a,o)})):t.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,o)}))}o(u.arg)}var r;this._invoke=function(e,i){function s(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(s,s):s()}}function _(e,n){var i=e.iterator[n.method];if(i===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,_(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var r=c(i,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,m;var s=r.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function F(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function D(e){if(e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:$}}function $(){return{value:t,done:!0}}return y.prototype=v,u(C,"constructor",v),u(v,"constructor",y),y.displayName=u(v,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,o,"GeneratorFunction")),e.prototype=Object.create(C),e},e.awrap=function(e){return{__await:e}},k(A.prototype),u(A.prototype,a,(function(){return this})),e.AsyncIterator=A,e.async=function(t,n,i,r,s){void 0===s&&(s=Promise);var a=new A(l(t,n,i,r),s);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(C),u(C,o,"Generator"),u(C,s,(function(){return this})),u(C,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=D,F.prototype={constructor:F,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return o.type="throw",o.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;S(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:D(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(a);var o=a.exports;function u(){var e="/home/vinoth/projects/react-sketch-canvas/src/Paths/index.tsx",t=new Function("return this")(),n="__coverage__",i=t[n]||(t[n]={});i[e]&&"80c4a162af9ff11419db7b7c460ec352bdae34fe"===i[e].hash||(i[e]={path:"/home/vinoth/projects/react-sketch-canvas/src/Paths/index.tsx",statementMap:{0:{start:{line:5,column:23},end:{line:13,column:1}},1:{start:{line:6,column:4},end:{line:10,column:5}},2:{start:{line:7,column:25},end:{line:7,column:33}},3:{start:{line:8,column:23},end:{line:8,column:38}},4:{start:{line:9,column:8},end:{line:9,column:133}},5:{start:{line:11,column:14},end:{line:11,column:124}},6:{start:{line:11,column:49},end:{line:11,column:119}},7:{start:{line:12,column:4},end:{line:12,column:153}},8:{start:{line:14,column:20},end:{line:21,column:1}},9:{start:{line:15,column:20},end:{line:15,column:39}},10:{start:{line:16,column:20},end:{line:16,column:39}},11:{start:{line:17,column:4},end:{line:20,column:6}},12:{start:{line:22,column:21},end:{line:33,column:1}},13:{start:{line:23,column:49},end:{line:23,column:62}},14:{start:{line:24,column:14},end:{line:24,column:33}},15:{start:{line:25,column:14},end:{line:25,column:29}},16:{start:{line:26,column:22},end:{line:26,column:25}},17:{start:{line:27,column:14},end:{line:27,column:24}},18:{start:{line:28,column:18},end:{line:28,column:51}},19:{start:{line:29,column:19},end:{line:29,column:39}},20:{start:{line:30,column:14},end:{line:30,column:50}},21:{start:{line:31,column:14},end:{line:31,column:50}},22:{start:{line:32,column:4},end:{line:32,column:18}},23:{start:{line:34,column:29},end:{line:64,column:1}},24:{start:{line:35,column:15},end:{line:35,column:19}},25:{start:{line:36,column:15},end:{line:36,column:19}},26:{start:{line:37,column:4},end:{line:56,column:5}},27:{start:{line:39,column:12},end:{line:41,column:15}},28:{start:{line:42,column:12},end:{line:42,column:18}},29:{start:{line:44,column:12},end:{line:47,column:15}},30:{start:{line:48,column:12},end:{line:48,column:18}},31:{start:{line:50,column:12},end:{line:54,column:15}},32:{start:{line:55,column:12},end:{line:55,column:18}},33:{start:{line:57,column:25},end:{line:62,column:6}},34:{start:{line:63,column:4},end:{line:63,column:70}},35:{start:{line:65,column:14},end:{line:65,column:292}},36:{start:{line:65,column:34},end:{line:65,column:291}},37:{start:{line:65,column:104},end:{line:65,column:288}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:5,column:23},end:{line:5,column:24}},loc:{start:{line:5,column:94},end:{line:13,column:1}},line:5},1:{name:"(anonymous_1)",decl:{start:{line:11,column:27},end:{line:11,column:28}},loc:{start:{line:11,column:49},end:{line:11,column:119}},line:11},2:{name:"(anonymous_2)",decl:{start:{line:14,column:20},end:{line:14,column:21}},loc:{start:{line:14,column:40},end:{line:21,column:1}},line:14},3:{name:"(anonymous_3)",decl:{start:{line:22,column:21},end:{line:22,column:22}},loc:{start:{line:22,column:40},end:{line:33,column:1}},line:22},4:{name:"(anonymous_4)",decl:{start:{line:34,column:29},end:{line:34,column:30}},loc:{start:{line:34,column:46},end:{line:64,column:1}},line:34},5:{name:"(anonymous_5)",decl:{start:{line:65,column:14},end:{line:65,column:15}},loc:{start:{line:65,column:34},end:{line:65,column:291}},line:65},6:{name:"(anonymous_6)",decl:{start:{line:65,column:86},end:{line:65,column:87}},loc:{start:{line:65,column:104},end:{line:65,column:288}},line:65}},branchMap:{0:{loc:{start:{line:5,column:63},end:{line:5,column:86}},type:"default-arg",locations:[{start:{line:5,column:73},end:{line:5,column:86}}],line:5},1:{loc:{start:{line:6,column:4},end:{line:10,column:5}},type:"if",locations:[{start:{line:6,column:4},end:{line:10,column:5}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:6},2:{loc:{start:{line:11,column:49},end:{line:11,column:119}},type:"cond-expr",locations:[{start:{line:11,column:59},end:{line:11,column:84}},{start:{line:11,column:87},end:{line:11,column:119}}],line:11},3:{loc:{start:{line:24,column:14},end:{line:24,column:33}},type:"binary-expr",locations:[{start:{line:24,column:14},end:{line:24,column:22}},{start:{line:24,column:26},end:{line:24,column:33}}],line:24},4:{loc:{start:{line:25,column:14},end:{line:25,column:29}},type:"binary-expr",locations:[{start:{line:25,column:14},end:{line:25,column:18}},{start:{line:25,column:22},end:{line:25,column:29}}],line:25},5:{loc:{start:{line:28,column:29},end:{line:28,column:50}},type:"cond-expr",locations:[{start:{line:28,column:39},end:{line:28,column:46}},{start:{line:28,column:49},end:{line:28,column:50}}],line:28},6:{loc:{start:{line:37,column:4},end:{line:56,column:5}},type:"switch",locations:[{start:{line:38,column:8},end:{line:42,column:18}},{start:{line:43,column:8},end:{line:48,column:18}},{start:{line:49,column:8},end:{line:55,column:18}}],line:37}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0},b:{0:[0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"80c4a162af9ff11419db7b7c460ec352bdae34fe"});var r=i[e];return u=function(){return r},r}u(),u().s[0]++;var l=function(e){var t=e.paths,n=e.id,r=e.strokeWidth,s=e.strokeColor,a=e.command,o=void 0===a?(u().b[0][0]++,d):a;if(u().f[0]++,u().s[1]++,1===t.length){u().b[1][0]++;var l=(u().s[2]++,t[0]),c=l.x,h=l.y,f=(u().s[3]++,r/2);return u().s[4]++,i.createElement("circle",{key:n,id:n,cx:c,cy:h,r:f,stroke:s,fill:s})}u().b[1][1]++;var p=(u().s[5]++,t.reduce((function(e,t,n,i){return u().f[1]++,u().s[6]++,0===n?(u().b[2][0]++,"M "+t.x+","+t.y):(u().b[2][1]++,e+" "+o(t,n,i))}),""));return u().s[7]++,i.createElement("path",{key:n,id:n,d:p,fill:"none",strokeLinecap:"round",stroke:s,strokeWidth:r})};u().s[8]++,u().s[12]++;var c=function(e){u().f[3]++;var t=(u().s[13]++,e),n=t.current,i=t.next,r=t.previous,s=t.reverse,a=(u().s[14]++,u().b[3][0]++,r||(u().b[3][1]++,n)),o=(u().s[15]++,u().b[4][0]++,i||(u().b[4][1]++,n)),l=(u().s[16]++,.2),c=(u().s[17]++,function(e,t){u().f[2]++;var n=(u().s[9]++,t.x-e.x),i=(u().s[10]++,t.y-e.y);return u().s[11]++,{length:Math.sqrt(Math.pow(n,2)+Math.pow(i,2)),angle:Math.atan2(i,n)}}(a,o)),d=(u().s[18]++,c.angle+(s?(u().b[5][0]++,Math.PI):(u().b[5][1]++,0))),h=(u().s[19]++,c.length*l),f=(u().s[20]++,n.x+Math.cos(d)*h),p=(u().s[21]++,n.y+Math.sin(d)*h);return u().s[22]++,[f,p]};u().s[23]++;var d=function(e,t,n){u().f[4]++;var i=(u().s[24]++,null),r=(u().s[25]++,null);switch(u().s[26]++,t){case 0:u().b[6][0]++,u().s[27]++;var s=c({current:e});i=s[0],r=s[1],u().s[28]++;break;case 1:u().b[6][1]++,u().s[29]++;var a=c({current:n[t-1],next:e});i=a[0],r=a[1],u().s[30]++;break;default:u().b[6][2]++,u().s[31]++;var o=c({current:n[t-1],previous:n[t-2],next:e});i=o[0],r=o[1],u().s[32]++}var l=(u().s[33]++,c({current:e,previous:n[t-1],next:n[t+1],reverse:!0})),d=l[0],h=l[1];return u().s[34]++,"C "+i+","+r+" "+d+","+h+" "+e.x+", "+e.y};u().s[35]++;var h=function(e){var t=e.id,n=e.paths;return u().f[5]++,u().s[36]++,i.createElement(i.Fragment,null,n.map((function(e,n){return u().f[6]++,u().s[37]++,i.createElement(l,{key:t+"__"+n,paths:e.paths,id:t+"__"+n,strokeWidth:e.strokeWidth,strokeColor:e.strokeColor,command:d})})))};function f(){var e="/home/vinoth/projects/react-sketch-canvas/src/Canvas/index.tsx",t=new Function("return this")(),n="__coverage__",i=t[n]||(t[n]={});i[e]&&"317c21a99c8bf0f995546f3a66265470aeb29b9d"===i[e].hash||(i[e]={path:"/home/vinoth/projects/react-sketch-canvas/src/Canvas/index.tsx",statementMap:{0:{start:{line:3,column:18},end:{line:14,column:2}},1:{start:{line:3,column:27},end:{line:14,column:2}},2:{start:{line:4,column:16},end:{line:4,column:27}},3:{start:{line:5,column:4},end:{line:10,column:7}},4:{start:{line:6,column:8},end:{line:8,column:9}},5:{start:{line:7,column:12},end:{line:7,column:25}},6:{start:{line:9,column:8},end:{line:9,column:34}},7:{start:{line:11,column:4},end:{line:11,column:56}},8:{start:{line:11,column:43},end:{line:11,column:54}},9:{start:{line:12,column:4},end:{line:12,column:18}},10:{start:{line:13,column:4},end:{line:13,column:49}},11:{start:{line:16,column:22},end:{line:16,column:56}},12:{start:{line:17,column:18},end:{line:17,column:36}},13:{start:{line:18,column:19},end:{line:18,column:38}},14:{start:{line:19,column:4},end:{line:19,column:64}},15:{start:{line:20,column:4},end:{line:20,column:54}},16:{start:{line:21,column:4},end:{line:21,column:56}},17:{start:{line:22,column:4},end:{line:22,column:40}},18:{start:{line:24,column:22},end:{line:189,column:2}},19:{start:{line:28,column:11},end:{line:28,column:16}},20:{start:{line:29,column:22},end:{line:29,column:40}},21:{start:{line:31,column:27},end:{line:43,column:5}},22:{start:{line:32,column:29},end:{line:32,column:71}},23:{start:{line:33,column:27},end:{line:33,column:46}},24:{start:{line:34,column:26},end:{line:34,column:45}},25:{start:{line:35,column:8},end:{line:37,column:9}},26:{start:{line:36,column:12},end:{line:36,column:34}},27:{start:{line:38,column:22},end:{line:41,column:9}},28:{start:{line:42,column:8},end:{line:42,column:21}},29:{start:{line:45,column:30},end:{line:55,column:5}},30:{start:{line:47,column:8},end:{line:50,column:9}},31:{start:{line:49,column:12},end:{line:49,column:19}},32:{start:{line:51,column:8},end:{line:52,column:19}},33:{start:{line:52,column:12},end:{line:52,column:19}},34:{start:{line:53,column:22},end:{line:53,column:43}},35:{start:{line:54,column:8},end:{line:54,column:29}},36:{start:{line:56,column:30},end:{line:66,column:5}},37:{start:{line:57,column:8},end:{line:58,column:19}},38:{start:{line:58,column:12},end:{line:58,column:19}},39:{start:{line:60,column:8},end:{line:63,column:9}},40:{start:{line:62,column:12},end:{line:62,column:19}},41:{start:{line:64,column:22},end:{line:64,column:43}},42:{start:{line:65,column:8},end:{line:65,column:29}},43:{start:{line:67,column:28},end:{line:76,column:5}},44:{start:{line:68,column:8},end:{line:69,column:19}},45:{start:{line:69,column:12},end:{line:69,column:19}},46:{start:{line:71,column:8},end:{line:74,column:9}},47:{start:{line:73,column:12},end:{line:73,column:19}},48:{start:{line:75,column:8},end:{line:75,column:22}},49:{start:{line:78,column:4},end:{line:144,column:8}},50:{start:{line:78,column:42},end:{line:144,column:5}},51:{start:{line:80,column:12},end:{line:119,column:15}},52:{start:{line:81,column:16},end:{line:118,column:17}},53:{start:{line:82,column:35},end:{line:82,column:52}},54:{start:{line:83,column:20},end:{line:85,column:21}},55:{start:{line:84,column:24},end:{line:84,column:63}},56:{start:{line:86,column:57},end:{line:86,column:85}},57:{start:{line:87,column:41},end:{line:87,column:97}},58:{start:{line:88,column:46},end:{line:88,column:77}},59:{start:{line:89,column:20},end:{line:97,column:21}},60:{start:{line:90,column:24},end:{line:96,column:25}},61:{start:{line:91,column:40},end:{line:91,column:72}},62:{start:{line:92,column:28},end:{line:92,column:56}},63:{start:{line:95,column:28},end:{line:95,column:144}},64:{start:{line:98,column:20},end:{line:114,column:23}},65:{start:{line:100,column:45},end:{line:100,column:77}},66:{start:{line:101,column:24},end:{line:101,column:77}},67:{start:{line:102,column:24},end:{line:102,column:79}},68:{start:{line:103,column:40},end:{line:103,column:69}},69:{start:{line:104,column:24},end:{line:106,column:25}},70:{start:{line:105,column:28},end:{line:105,column:67}},71:{start:{line:107,column:24},end:{line:109,column:27}},72:{start:{line:108,column:28},end:{line:108,column:59}},73:{start:{line:110,column:24},end:{line:110,column:78}},74:{start:{line:113,column:24},end:{line:113,column:32}},75:{start:{line:117,column:20},end:{line:117,column:30}},76:{start:{line:122,column:12},end:{line:142,column:15}},77:{start:{line:123,column:16},end:{line:141,column:17}},78:{start:{line:124,column:35},end:{line:124,column:60}},79:{start:{line:125,column:20},end:{line:136,column:21}},80:{start:{line:126,column:46},end:{line:126,column:74}},81:{start:{line:127,column:24},end:{line:130,column:25}},82:{start:{line:128,column:28},end:{line:128,column:57}},83:{start:{line:129,column:28},end:{line:129,column:35}},84:{start:{line:131,column:24},end:{line:131,column:80}},85:{start:{line:132,column:24},end:{line:134,column:64}},86:{start:{line:135,column:24},end:{line:135,column:53}},87:{start:{line:137,column:20},end:{line:137,column:59}},88:{start:{line:140,column:20},end:{line:140,column:30}},89:{start:{line:147,column:4},end:{line:152,column:26}},90:{start:{line:148,column:8},end:{line:148,column:64}},91:{start:{line:149,column:8},end:{line:151,column:10}},92:{start:{line:150,column:12},end:{line:150,column:71}},93:{start:{line:153,column:24},end:{line:153,column:62}},94:{start:{line:153,column:47},end:{line:153,column:61}},95:{start:{line:154,column:23},end:{line:154,column:24}},96:{start:{line:155,column:23},end:{line:165,column:12}},97:{start:{line:156,column:8},end:{line:159,column:9}},98:{start:{line:157,column:12},end:{line:157,column:30}},99:{start:{line:158,column:12},end:{line:158,column:30}},100:{start:{line:160,column:8},end:{line:162,column:9}},101:{start:{line:161,column:12},end:{line:161,column:42}},102:{start:{line:163,column:8},end:{line:163,column:44}},103:{start:{line:164,column:8},end:{line:164,column:26}},104:{start:{line:166,column:4},end:{line:188,column:79}},105:{start:{line:178,column:52},end:{line:178,column:223}},106:{start:{line:182,column:43},end:{line:184,column:188}},107:{start:{line:184,column:77},end:{line:184,column:82}},108:{start:{line:184,column:96},end:{line:184,column:185}},109:{start:{line:187,column:46},end:{line:188,column:73}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:3,column:18},end:{line:3,column:19}},loc:{start:{line:3,column:27},end:{line:14,column:2}},line:3},1:{name:"(anonymous_1)",decl:{start:{line:3,column:39},end:{line:3,column:40}},loc:{start:{line:3,column:60},end:{line:14,column:1}},line:3},2:{name:"(anonymous_2)",decl:{start:{line:5,column:33},end:{line:5,column:34}},loc:{start:{line:5,column:39},end:{line:10,column:5}},line:5},3:{name:"(anonymous_3)",decl:{start:{line:11,column:34},end:{line:11,column:35}},loc:{start:{line:11,column:43},end:{line:11,column:54}},line:11},4:{name:"getCanvasWithViewBox",decl:{start:{line:15,column:9},end:{line:15,column:29}},loc:{start:{line:15,column:38},end:{line:23,column:1}},line:15},5:{name:"(anonymous_5)",decl:{start:{line:24,column:39},end:{line:24,column:40}},loc:{start:{line:24,column:55},end:{line:189,column:1}},line:24},6:{name:"(anonymous_6)",decl:{start:{line:31,column:27},end:{line:31,column:28}},loc:{start:{line:31,column:45},end:{line:43,column:5}},line:31},7:{name:"(anonymous_7)",decl:{start:{line:45,column:30},end:{line:45,column:31}},loc:{start:{line:45,column:41},end:{line:55,column:5}},line:45},8:{name:"(anonymous_8)",decl:{start:{line:56,column:30},end:{line:56,column:31}},loc:{start:{line:56,column:41},end:{line:66,column:5}},line:56},9:{name:"(anonymous_9)",decl:{start:{line:67,column:28},end:{line:67,column:29}},loc:{start:{line:67,column:39},end:{line:76,column:5}},line:67},10:{name:"(anonymous_10)",decl:{start:{line:78,column:35},end:{line:78,column:36}},loc:{start:{line:78,column:42},end:{line:144,column:5}},line:78},11:{name:"(anonymous_11)",decl:{start:{line:79,column:21},end:{line:79,column:22}},loc:{start:{line:79,column:36},end:{line:120,column:9}},line:79},12:{name:"(anonymous_12)",decl:{start:{line:80,column:31},end:{line:80,column:32}},loc:{start:{line:80,column:58},end:{line:119,column:13}},line:80},13:{name:"(anonymous_13)",decl:{start:{line:99,column:30},end:{line:99,column:31}},loc:{start:{line:99,column:42},end:{line:111,column:21}},line:99},14:{name:"(anonymous_14)",decl:{start:{line:107,column:49},end:{line:107,column:50}},loc:{start:{line:107,column:60},end:{line:109,column:25}},line:107},15:{name:"(anonymous_15)",decl:{start:{line:112,column:31},end:{line:112,column:32}},loc:{start:{line:112,column:38},end:{line:114,column:21}},line:112},16:{name:"(anonymous_16)",decl:{start:{line:121,column:19},end:{line:121,column:20}},loc:{start:{line:121,column:25},end:{line:143,column:9}},line:121},17:{name:"(anonymous_17)",decl:{start:{line:122,column:31},end:{line:122,column:32}},loc:{start:{line:122,column:52},end:{line:142,column:13}},line:122},18:{name:"(anonymous_18)",decl:{start:{line:147,column:20},end:{line:147,column:21}},loc:{start:{line:147,column:26},end:{line:152,column:5}},line:147},19:{name:"(anonymous_19)",decl:{start:{line:149,column:15},end:{line:149,column:16}},loc:{start:{line:149,column:21},end:{line:151,column:9}},line:149},20:{name:"(anonymous_20)",decl:{start:{line:153,column:37},end:{line:153,column:38}},loc:{start:{line:153,column:47},end:{line:153,column:61}},line:153},21:{name:"(anonymous_21)",decl:{start:{line:155,column:36},end:{line:155,column:37}},loc:{start:{line:155,column:58},end:{line:165,column:5}},line:155},22:{name:"(anonymous_22)",decl:{start:{line:178,column:32},end:{line:178,column:33}},loc:{start:{line:178,column:52},end:{line:178,column:223}},line:178},23:{name:"(anonymous_23)",decl:{start:{line:182,column:32},end:{line:182,column:33}},loc:{start:{line:182,column:43},end:{line:184,column:188}},line:182},24:{name:"(anonymous_24)",decl:{start:{line:184,column:67},end:{line:184,column:68}},loc:{start:{line:184,column:77},end:{line:184,column:82}},line:184},25:{name:"(anonymous_25)",decl:{start:{line:184,column:88},end:{line:184,column:89}},loc:{start:{line:184,column:96},end:{line:184,column:185}},line:184},26:{name:"(anonymous_26)",decl:{start:{line:187,column:27},end:{line:187,column:28}},loc:{start:{line:187,column:46},end:{line:188,column:73}},line:187}},branchMap:{0:{loc:{start:{line:6,column:8},end:{line:8,column:9}},type:"if",locations:[{start:{line:6,column:8},end:{line:8,column:9}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:6},1:{loc:{start:{line:25,column:73},end:{line:25,column:99}},type:"default-arg",locations:[{start:{line:25,column:78},end:{line:25,column:99}}],line:25},2:{loc:{start:{line:25,column:101},end:{line:25,column:115}},type:"default-arg",locations:[{start:{line:25,column:109},end:{line:25,column:115}}],line:25},3:{loc:{start:{line:25,column:117},end:{line:25,column:132}},type:"default-arg",locations:[{start:{line:25,column:126},end:{line:25,column:132}}],line:25},4:{loc:{start:{line:25,column:134},end:{line:25,column:167}},type:"default-arg",locations:[{start:{line:25,column:146},end:{line:25,column:167}}],line:25},5:{loc:{start:{line:25,column:169},end:{line:25,column:188}},type:"default-arg",locations:[{start:{line:25,column:183},end:{line:25,column:188}}],line:25},6:{loc:{start:{line:25,column:190},end:{line:25,column:210}},type:"default-arg",locations:[{start:{line:25,column:208},end:{line:25,column:210}}],line:25},7:{loc:{start:{line:25,column:212},end:{line:25,column:245}},type:"default-arg",locations:[{start:{line:25,column:240},end:{line:25,column:245}}],line:25},8:{loc:{start:{line:25,column:247},end:{line:25,column:290}},type:"default-arg",locations:[{start:{line:25,column:284},end:{line:25,column:290}}],line:25},9:{loc:{start:{line:25,column:292},end:{line:25,column:320}},type:"default-arg",locations:[{start:{line:25,column:315},end:{line:25,column:320}}],line:25},10:{loc:{start:{line:25,column:322},end:{line:28,column:5}},type:"default-arg",locations:[{start:{line:25,column:330},end:{line:28,column:5}}],line:25},11:{loc:{start:{line:33,column:27},end:{line:33,column:46}},type:"binary-expr",locations:[{start:{line:33,column:27},end:{line:33,column:41}},{start:{line:33,column:45},end:{line:33,column:46}}],line:33},12:{loc:{start:{line:34,column:26},end:{line:34,column:45}},type:"binary-expr",locations:[{start:{line:34,column:26},end:{line:34,column:40}},{start:{line:34,column:44},end:{line:34,column:45}}],line:34},13:{loc:{start:{line:35,column:8},end:{line:37,column:9}},type:"if",locations:[{start:{line:35,column:8},end:{line:37,column:9}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:35},14:{loc:{start:{line:47,column:8},end:{line:50,column:9}},type:"if",locations:[{start:{line:47,column:8},end:{line:50,column:9}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:47},15:{loc:{start:{line:47,column:12},end:{line:48,column:54}},type:"binary-expr",locations:[{start:{line:47,column:12},end:{line:47,column:42}},{start:{line:48,column:12},end:{line:48,column:54}}],line:47},16:{loc:{start:{line:51,column:8},end:{line:52,column:19}},type:"if",locations:[{start:{line:51,column:8},end:{line:52,column:19}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:51},17:{loc:{start:{line:51,column:12},end:{line:51,column:63}},type:"binary-expr",locations:[{start:{line:51,column:12},end:{line:51,column:41}},{start:{line:51,column:45},end:{line:51,column:63}}],line:51},18:{loc:{start:{line:57,column:8},end:{line:58,column:19}},type:"if",locations:[{start:{line:57,column:8},end:{line:58,column:19}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:57},19:{loc:{start:{line:60,column:8},end:{line:63,column:9}},type:"if",locations:[{start:{line:60,column:8},end:{line:63,column:9}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:60},20:{loc:{start:{line:60,column:12},end:{line:61,column:54}},type:"binary-expr",locations:[{start:{line:60,column:12},end:{line:60,column:42}},{start:{line:61,column:12},end:{line:61,column:54}}],line:60},21:{loc:{start:{line:68,column:8},end:{line:69,column:19}},type:"if",locations:[{start:{line:68,column:8},end:{line:69,column:19}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:68},22:{loc:{start:{line:68,column:12},end:{line:68,column:63}},type:"binary-expr",locations:[{start:{line:68,column:12},end:{line:68,column:41}},{start:{line:68,column:45},end:{line:68,column:63}}],line:68},23:{loc:{start:{line:71,column:8},end:{line:74,column:9}},type:"if",locations:[{start:{line:71,column:8},end:{line:74,column:9}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:71},24:{loc:{start:{line:71,column:12},end:{line:72,column:54}},type:"binary-expr",locations:[{start:{line:71,column:12},end:{line:71,column:42}},{start:{line:72,column:12},end:{line:72,column:54}}],line:71},25:{loc:{start:{line:83,column:20},end:{line:85,column:21}},type:"if",locations:[{start:{line:83,column:20},end:{line:85,column:21}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:83},26:{loc:{start:{line:89,column:20},end:{line:97,column:21}},type:"if",locations:[{start:{line:89,column:20},end:{line:97,column:21}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:89},27:{loc:{start:{line:104,column:24},end:{line:106,column:25}},type:"if",locations:[{start:{line:104,column:24},end:{line:106,column:25}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:104},28:{loc:{start:{line:124,column:35},end:{line:124,column:60}},type:"binary-expr",locations:[{start:{line:124,column:35},end:{line:124,column:52}},{start:{line:124,column:56},end:{line:124,column:60}}],line:124},29:{loc:{start:{line:125,column:20},end:{line:136,column:21}},type:"if",locations:[{start:{line:125,column:20},end:{line:136,column:21}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:125},30:{loc:{start:{line:127,column:24},end:{line:130,column:25}},type:"if",locations:[{start:{line:127,column:24},end:{line:130,column:25}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:127},31:{loc:{start:{line:156,column:8},end:{line:159,column:9}},type:"if",locations:[{start:{line:156,column:8},end:{line:159,column:9}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:156},32:{loc:{start:{line:160,column:8},end:{line:162,column:9}},type:"if",locations:[{start:{line:160,column:8},end:{line:162,column:9}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:160},33:{loc:{start:{line:180,column:16},end:{line:181,column:186}},type:"binary-expr",locations:[{start:{line:180,column:16},end:{line:180,column:31}},{start:{line:180,column:36},end:{line:181,column:185}}],line:180},34:{loc:{start:{line:186,column:131},end:{line:186,column:188}},type:"cond-expr",locations:[{start:{line:186,column:149},end:{line:186,column:174}},{start:{line:186,column:177},end:{line:186,column:188}}],line:186}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0,88:0,89:0,90:0,91:0,92:0,93:0,94:0,95:0,96:0,97:0,98:0,99:0,100:0,101:0,102:0,103:0,104:0,105:0,106:0,107:0,108:0,109:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0},b:{0:[0,0],1:[0],2:[0],3:[0],4:[0],5:[0],6:[0],7:[0],8:[0],9:[0],10:[0],11:[0,0],12:[0,0],13:[0,0],14:[0,0],15:[0,0],16:[0,0],17:[0,0],18:[0,0],19:[0,0],20:[0,0],21:[0,0],22:[0,0],23:[0,0],24:[0,0],25:[0,0],26:[0,0],27:[0,0],28:[0,0],29:[0,0],30:[0,0],31:[0,0],32:[0,0],33:[0,0],34:[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"317c21a99c8bf0f995546f3a66265470aeb29b9d"});var r=i[e];return f=function(){return r},r}f(),f().s[0]++;var p=function(e){return f().f[0]++,f().s[1]++,new Promise((function(t,n){f().f[1]++;var i=(f().s[2]++,new Image);f().s[3]++,i.addEventListener("load",(function(){f().f[2]++,f().s[4]++,i.width>0?(f().b[0][0]++,f().s[5]++,t(i)):f().b[0][1]++,f().s[6]++,n("Image not found")})),f().s[7]++,i.addEventListener("error",(function(e){return f().f[3]++,f().s[8]++,n(e)})),f().s[9]++,i.src=e,f().s[10]++,i.setAttribute("crossorigin","anonymous")}))};function m(e){var t;f().f[4]++;var n=(f().s[11]++,null==(t=e.firstChild)?void 0:t.cloneNode(!0)),i=(f().s[12]++,e.offsetWidth),r=(f().s[13]++,e.offsetHeight);return f().s[14]++,n.setAttribute("viewBox","0 0 "+i+" "+r),f().s[15]++,n.setAttribute("width",i.toString()),f().s[16]++,n.setAttribute("height",r.toString()),f().s[17]++,{svgCanvas:n,width:i,height:r}}var g=(f().s[18]++,i.forwardRef((function(e,t){f().f[5]++;var n=(f().s[19]++,e),a=n.paths,u=n.isDrawing,c=n.onPointerDown,d=n.onPointerMove,g=n.onPointerUp,y=n.id,v=void 0===y?(f().b[1][0]++,"react-sketch-canvas"):y,b=n.width,x=void 0===b?(f().b[2][0]++,"100%"):b,w=n.height,C=void 0===w?(f().b[3][0]++,"100%"):w,k=n.className,A=void 0===k?(f().b[4][0]++,"react-sketch-canvas"):k,_=n.canvasColor,E=void 0===_?(f().b[5][0]++,"red"):_,S=n.backgroundImage,F=void 0===S?(f().b[6][0]++,""):S,D=n.exportWithBackgroundImage,$=void 0===D?(f().b[7][0]++,!1):D,O=n.preserveBackgroundImageAspectRatio,N=void 0===O?(f().b[8][0]++,"none"):O,I=n.allowOnlyPointerType,T=void 0===I?(f().b[9][0]++,"all"):I,R=n.style,M=void 0===R?(f().b[10][0]++,{border:"0.0625rem solid #9c9c9c",borderRadius:"0.25rem"}):R,B=(f().s[20]++,i.useRef(null));f().s[21]++;var z=function(e){var t,n,i;f().f[6]++;var r=(f().s[22]++,null==(t=B.current)?void 0:t.getBoundingClientRect()),s=(f().s[23]++,null!=(f().b[11][0]++,n=window.scrollX)?n:(f().b[11][1]++,0)),a=(f().s[24]++,null!=(f().b[12][0]++,i=window.scrollY)?i:(f().b[12][1]++,0));if(f().s[25]++,!r)return f().b[13][0]++,f().s[26]++,{x:0,y:0};f().b[13][1]++;var o=(f().s[27]++,{x:e.pageX-r.left-s,y:e.pageY-r.top-a});return f().s[28]++,o};f().s[29]++,f().s[36]++,f().s[43]++;var L=function(e){return f().f[9]++,f().s[44]++,f().b[22][0]++,"mouse"===e.pointerType&&(f().b[22][1]++,0!==e.button)?(f().b[21][0]++,void f().s[45]++):(f().b[21][1]++,f().s[46]++,f().b[24][0]++,"all"!==T&&(f().b[24][1]++,e.pointerType!==T)?(f().b[23][0]++,void f().s[47]++):(f().b[23][1]++,f().s[48]++,void g()))};f().s[49]++,i.useImperativeHandle(t,(function(){return f().f[10]++,f().s[50]++,{exportImage:function(e){return f().f[11]++,f().s[51]++,new Promise(function(){var t,n=(t=o.mark((function t(n,i){var r,s,a,u,l,c,d,h;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(f().f[12]++,f().s[52]++,t.prev=2,f().s[53]++,r=B.current,f().s[54]++,r){t.next=11;break}throw f().b[25][0]++,f().s[55]++,Error("Canvas not rendered yet");case 11:f().b[25][1]++;case 12:return f().s[56]++,s=m(r),a=s.svgCanvas,u=s.width,l=s.height,f().s[57]++,c="data:image/svg+xml;base64,"+btoa(a.outerHTML),f().s[58]++,t.next=17,p(c);case 17:if(t.t0=t.sent,d=[t.t0],f().s[59]++,!$){t.next=38;break}return f().b[26][0]++,f().s[60]++,t.prev=23,f().s[61]++,t.next=27,p(F);case 27:h=t.sent,f().s[62]++,d.push(h),t.next=36;break;case 32:t.prev=32,t.t1=t.catch(23),f().s[63]++,console.warn("exportWithBackgroundImage props is set without a valid background image URL. This option is ignored");case 36:t.next=39;break;case 38:f().b[26][1]++;case 39:f().s[64]++,Promise.all(d).then((function(t){f().f[13]++;var i=(f().s[65]++,document.createElement("canvas"));f().s[66]++,i.setAttribute("width",u.toString()),f().s[67]++,i.setAttribute("height",l.toString());var r=(f().s[68]++,i.getContext("2d"));if(f().s[69]++,!r)throw f().b[27][0]++,f().s[70]++,Error("Canvas not rendered yet");f().b[27][1]++,f().s[71]++,t.reverse().forEach((function(e){f().f[14]++,f().s[72]++,r.drawImage(e,0,0)})),f().s[73]++,n(i.toDataURL("image/"+e))})).catch((function(e){throw f().f[15]++,f().s[74]++,e})),t.next=47;break;case 43:t.prev=43,t.t2=t.catch(2),f().s[75]++,i(t.t2);case 47:case"end":return t.stop()}}),t,null,[[2,43],[23,32]])})),function(){var e=this,n=arguments;return new Promise((function(i,s){var a=t.apply(e,n);function o(e){r(a,i,s,o,u,"next",e)}function u(e){r(a,i,s,o,u,"throw",e)}o(void 0)}))});return function(e,t){return n.apply(this,arguments)}}())},exportSvg:function(){return f().f[16]++,f().s[76]++,new Promise((function(e,t){f().f[17]++,f().s[77]++;try{var n,i=(f().s[78]++,null!=(f().b[28][0]++,n=B.current)?n:(f().b[28][1]++,null));if(f().s[79]++,null!==i){var r,s;f().b[29][0]++;var a=(f().s[80]++,m(i)).svgCanvas;if(f().s[81]++,$)return f().b[30][0]++,f().s[82]++,e(a.outerHTML),void f().s[83]++;f().b[30][1]++,f().s[84]++,null==(r=a.querySelector("#"+v+"__background"))||r.remove(),f().s[85]++,null==(s=a.querySelector("#"+v+"__canvas-background"))||s.setAttribute("fill",E),f().s[86]++,e(a.outerHTML)}else f().b[29][1]++;f().s[87]++,t(new Error("Canvas not loaded"))}catch(e){f().s[88]++,t(e)}}))}}})),f().s[89]++,i.useEffect((function(){return f().f[18]++,f().s[90]++,document.addEventListener("pointerup",L),f().s[91]++,function(){f().f[19]++,f().s[92]++,document.removeEventListener("pointerup",L)}}),[L]);var P=(f().s[93]++,a.filter((function(e){return f().f[20]++,f().s[94]++,!e.drawMode}))),j=(f().s[95]++,0),U=(f().s[96]++,a.reduce((function(e,t){return f().f[21]++,f().s[97]++,t.drawMode?(f().b[31][1]++,f().s[100]++,void 0===e[j]?(f().b[32][0]++,f().s[101]++,e[j]=[]):f().b[32][1]++,f().s[102]++,e[j].push(t),f().s[103]++,e):(f().b[31][0]++,f().s[98]++,j+=1,f().s[99]++,e)}),[[]]));return f().s[104]++,i.createElement("div",{role:"presentation","aria-label":"react-sketch-canvas",ref:B,className:A,style:s({touchAction:"none",width:x,height:C},M),"touch-action":"none",onPointerDown:function(e){if(f().f[7]++,f().s[30]++,f().b[15][0]++,"all"!==T&&(f().b[15][1]++,e.pointerType!==T))return f().b[14][0]++,void f().s[31]++;if(f().b[14][1]++,f().s[32]++,f().b[17][0]++,"mouse"===e.pointerType&&(f().b[17][1]++,0!==e.button))return f().b[16][0]++,void f().s[33]++;f().b[16][1]++;var t=(f().s[34]++,z(e));f().s[35]++,c(t)},onPointerMove:function(e){if(f().f[8]++,f().s[37]++,!u)return f().b[18][0]++,void f().s[38]++;if(f().b[18][1]++,f().s[39]++,f().b[20][0]++,"all"!==T&&(f().b[20][1]++,e.pointerType!==T))return f().b[19][0]++,void f().s[40]++;f().b[19][1]++;var t=(f().s[41]++,z(e));f().s[42]++,d(t)},onPointerUp:L},i.createElement("svg",{version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",style:{width:"100%",height:"100%"},id:v},i.createElement("g",{id:v+"__eraser-stroke-group",display:"none"},i.createElement("rect",{id:v+"__mask-background",x:"0",y:"0",width:"100%",height:"100%",fill:"white"}),P.map((function(e,t){return f().f[22]++,f().s[105]++,i.createElement(l,{key:v+"__eraser-"+t,id:v+"__eraser-"+t,paths:e.paths,strokeColor:"#000000",strokeWidth:e.strokeWidth})}))),i.createElement("defs",null,(f().b[33][0]++,F&&(f().b[33][1]++,i.createElement("pattern",{id:v+"__background",x:"0",y:"0",width:"100%",height:"100%",patternUnits:"userSpaceOnUse"},i.createElement("image",{x:"0",y:"0",width:"100%",height:"100%",xlinkHref:F,preserveAspectRatio:N})))),P.map((function(e,t){return f().f[23]++,f().s[106]++,i.createElement("mask",{id:v+"__eraser-mask-"+t,key:v+"__eraser-mask-"+t,maskUnits:"userSpaceOnUse"},i.createElement("use",{href:"#"+v+"__mask-background"}),Array.from({length:P.length-t},(function(e,n){return f().f[24]++,f().s[107]++,n+t})).map((function(e){return f().f[25]++,f().s[108]++,i.createElement("use",{key:e.toString(),href:"#"+v+"__eraser-"+e.toString()})})))}))),i.createElement("g",{id:v+"__canvas-background-group"},i.createElement("rect",{id:v+"__canvas-background",x:"0",y:"0",width:"100%",height:"100%",fill:F?(f().b[34][0]++,"url(#"+v+"__background)"):(f().b[34][1]++,E)})),U.map((function(e,t){return f().f[26]++,f().s[109]++,i.createElement("g",{id:v+"__stroke-group-"+t,key:v+"__stroke-group-"+t,mask:"url(#"+v+"__eraser-mask-"+t+")"},i.createElement(h,{id:v,paths:e}))}))))})));function y(){var e="/home/vinoth/projects/react-sketch-canvas/src/ReactSketchCanvas/index.tsx",t=new Function("return this")(),n="__coverage__",i=t[n]||(t[n]={});i[e]&&"b2a537109f7bffcb588e5c596cf0910c6ae5d7e9"===i[e].hash||(i[e]={path:"/home/vinoth/projects/react-sketch-canvas/src/ReactSketchCanvas/index.tsx",statementMap:{0:{start:{line:3,column:33},end:{line:172,column:2}},1:{start:{line:7,column:100},end:{line:7,column:105}},2:{start:{line:8,column:22},end:{line:8,column:39}},3:{start:{line:9,column:36},end:{line:9,column:56}},4:{start:{line:10,column:38},end:{line:10,column:59}},5:{start:{line:11,column:40},end:{line:11,column:58}},6:{start:{line:12,column:38},end:{line:12,column:56}},7:{start:{line:13,column:44},end:{line:13,column:62}},8:{start:{line:14,column:25},end:{line:21,column:19}},9:{start:{line:15,column:27},end:{line:15,column:62}},10:{start:{line:16,column:8},end:{line:19,column:9}},11:{start:{line:17,column:12},end:{line:17,column:45}},12:{start:{line:18,column:12},end:{line:18,column:19}},13:{start:{line:20,column:8},end:{line:20,column:51}},14:{start:{line:22,column:4},end:{line:24,column:20}},15:{start:{line:23,column:8},end:{line:23,column:23}},16:{start:{line:25,column:4},end:{line:27,column:23}},17:{start:{line:26,column:8},end:{line:26,column:31}},18:{start:{line:28,column:4},end:{line:118,column:8}},19:{start:{line:28,column:42},end:{line:118,column:5}},20:{start:{line:30,column:12},end:{line:30,column:32}},21:{start:{line:33,column:12},end:{line:33,column:45}},22:{start:{line:34,column:12},end:{line:34,column:32}},23:{start:{line:38,column:12},end:{line:42,column:13}},24:{start:{line:39,column:16},end:{line:39,column:49}},25:{start:{line:40,column:16},end:{line:40,column:34}},26:{start:{line:41,column:16},end:{line:41,column:23}},27:{start:{line:43,column:12},end:{line:43,column:83}},28:{start:{line:43,column:40},end:{line:43,column:81}},29:{start:{line:44,column:12},end:{line:44,column:73}},30:{start:{line:44,column:46},end:{line:44,column:71}},31:{start:{line:48,column:12},end:{line:49,column:23}},32:{start:{line:49,column:16},end:{line:49,column:23}},33:{start:{line:50,column:12},end:{line:53,column:15}},34:{start:{line:50,column:46},end:{line:53,column:13}},35:{start:{line:54,column:12},end:{line:54,column:64}},36:{start:{line:54,column:40},end:{line:54,column:62}},37:{start:{line:57,column:32},end:{line:57,column:62}},38:{start:{line:58,column:12},end:{line:63,column:13}},39:{start:{line:59,column:16},end:{line:59,column:75}},40:{start:{line:62,column:16},end:{line:62,column:46}},41:{start:{line:66,column:12},end:{line:80,column:15}},42:{start:{line:67,column:34},end:{line:67,column:62}},43:{start:{line:68,column:16},end:{line:79,column:17}},44:{start:{line:69,column:20},end:{line:69,column:81}},45:{start:{line:72,column:20},end:{line:78,column:23}},46:{start:{line:74,column:24},end:{line:74,column:38}},47:{start:{line:77,column:24},end:{line:77,column:34}},48:{start:{line:83,column:12},end:{line:90,column:15}},49:{start:{line:84,column:16},end:{line:89,column:17}},50:{start:{line:85,column:20},end:{line:85,column:42}},51:{start:{line:88,column:20},end:{line:88,column:30}},52:{start:{line:93,column:12},end:{line:93,column:75}},53:{start:{line:93,column:46},end:{line:93,column:73}},54:{start:{line:96,column:12},end:{line:111,column:15}},55:{start:{line:97,column:16},end:{line:99,column:17}},56:{start:{line:98,column:20},end:{line:98,column:88}},57:{start:{line:100,column:16},end:{line:110,column:17}},58:{start:{line:101,column:42},end:{line:105,column:25}},59:{start:{line:102,column:47},end:{line:102,column:71}},60:{start:{line:103,column:45},end:{line:103,column:67}},61:{start:{line:104,column:24},end:{line:104,column:84}},62:{start:{line:106,column:20},end:{line:106,column:43}},63:{start:{line:109,column:20},end:{line:109,column:30}},64:{start:{line:114,column:12},end:{line:114,column:30}},65:{start:{line:115,column:12},end:{line:115,column:29}},66:{start:{line:116,column:12},end:{line:116,column:32}},67:{start:{line:119,column:30},end:{line:136,column:5}},68:{start:{line:120,column:8},end:{line:120,column:27}},69:{start:{line:121,column:8},end:{line:121,column:25}},70:{start:{line:122,column:21},end:{line:127,column:9}},71:{start:{line:128,column:8},end:{line:134,column:9}},72:{start:{line:129,column:12},end:{line:133,column:14}},73:{start:{line:135,column:8},end:{line:135,column:69}},74:{start:{line:135,column:42},end:{line:135,column:67}},75:{start:{line:137,column:30},end:{line:149,column:5}},76:{start:{line:138,column:8},end:{line:139,column:19}},77:{start:{line:139,column:12},end:{line:139,column:19}},78:{start:{line:140,column:30},end:{line:140,column:55}},79:{start:{line:141,column:30},end:{line:144,column:9}},80:{start:{line:145,column:8},end:{line:148,column:11}},81:{start:{line:145,column:42},end:{line:148,column:9}},82:{start:{line:150,column:28},end:{line:170,column:5}},83:{start:{line:151,column:8},end:{line:153,column:9}},84:{start:{line:152,column:12},end:{line:152,column:19}},85:{start:{line:154,column:8},end:{line:154,column:28}},86:{start:{line:155,column:8},end:{line:157,column:9}},87:{start:{line:156,column:12},end:{line:156,column:19}},88:{start:{line:158,column:28},end:{line:158,column:63}},89:{start:{line:159,column:8},end:{line:161,column:9}},90:{start:{line:160,column:12},end:{line:160,column:19}},91:{start:{line:162,column:30},end:{line:165,column:9}},92:{start:{line:166,column:8},end:{line:169,column:11}},93:{start:{line:166,column:42},end:{line:169,column:9}},94:{start:{line:171,column:4},end:{line:171,column:506}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:3,column:50},end:{line:3,column:51}},loc:{start:{line:3,column:66},end:{line:172,column:1}},line:3},1:{name:"(anonymous_1)",decl:{start:{line:7,column:18},end:{line:7,column:19}},loc:{start:{line:7,column:30},end:{line:7,column:33}},line:7},2:{name:"(anonymous_2)",decl:{start:{line:7,column:46},end:{line:7,column:47}},loc:{start:{line:7,column:68},end:{line:7,column:71}},line:7},3:{name:"(anonymous_3)",decl:{start:{line:14,column:43},end:{line:14,column:44}},loc:{start:{line:14,column:49},end:{line:21,column:5}},line:14},4:{name:"(anonymous_4)",decl:{start:{line:22,column:20},end:{line:22,column:21}},loc:{start:{line:22,column:26},end:{line:24,column:5}},line:22},5:{name:"(anonymous_5)",decl:{start:{line:25,column:20},end:{line:25,column:21}},loc:{start:{line:25,column:26},end:{line:27,column:5}},line:25},6:{name:"(anonymous_6)",decl:{start:{line:28,column:35},end:{line:28,column:36}},loc:{start:{line:28,column:42},end:{line:118,column:5}},line:28},7:{name:"(anonymous_7)",decl:{start:{line:29,column:19},end:{line:29,column:20}},loc:{start:{line:29,column:30},end:{line:31,column:9}},line:29},8:{name:"(anonymous_8)",decl:{start:{line:32,column:21},end:{line:32,column:22}},loc:{start:{line:32,column:27},end:{line:35,column:9}},line:32},9:{name:"(anonymous_9)",decl:{start:{line:36,column:14},end:{line:36,column:15}},loc:{start:{line:36,column:20},end:{line:45,column:9}},line:36},10:{name:"(anonymous_10)",decl:{start:{line:43,column:25},end:{line:43,column:26}},loc:{start:{line:43,column:40},end:{line:43,column:81}},line:43},11:{name:"(anonymous_11)",decl:{start:{line:44,column:28},end:{line:44,column:29}},loc:{start:{line:44,column:46},end:{line:44,column:71}},line:44},12:{name:"(anonymous_12)",decl:{start:{line:46,column:14},end:{line:46,column:15}},loc:{start:{line:46,column:20},end:{line:55,column:9}},line:46},13:{name:"(anonymous_13)",decl:{start:{line:50,column:28},end:{line:50,column:29}},loc:{start:{line:50,column:46},end:{line:53,column:13}},line:50},14:{name:"(anonymous_14)",decl:{start:{line:54,column:25},end:{line:54,column:26}},loc:{start:{line:54,column:40},end:{line:54,column:62}},line:54},15:{name:"(anonymous_15)",decl:{start:{line:56,column:21},end:{line:56,column:22}},loc:{start:{line:56,column:36},end:{line:64,column:9}},line:56},16:{name:"(anonymous_16)",decl:{start:{line:65,column:19},end:{line:65,column:20}},loc:{start:{line:65,column:25},end:{line:81,column:9}},line:65},17:{name:"(anonymous_17)",decl:{start:{line:66,column:31},end:{line:66,column:32}},loc:{start:{line:66,column:52},end:{line:80,column:13}},line:66},18:{name:"(anonymous_18)",decl:{start:{line:73,column:30},end:{line:73,column:31}},loc:{start:{line:73,column:40},end:{line:75,column:21}},line:73},19:{name:"(anonymous_19)",decl:{start:{line:76,column:31},end:{line:76,column:32}},loc:{start:{line:76,column:38},end:{line:78,column:21}},line:76},20:{name:"(anonymous_20)",decl:{start:{line:82,column:21},end:{line:82,column:22}},loc:{start:{line:82,column:27},end:{line:91,column:9}},line:82},21:{name:"(anonymous_21)",decl:{start:{line:83,column:31},end:{line:83,column:32}},loc:{start:{line:83,column:52},end:{line:90,column:13}},line:83},22:{name:"(anonymous_22)",decl:{start:{line:92,column:19},end:{line:92,column:20}},loc:{start:{line:92,column:30},end:{line:94,column:9}},line:92},23:{name:"(anonymous_23)",decl:{start:{line:93,column:28},end:{line:93,column:29}},loc:{start:{line:93,column:46},end:{line:93,column:73}},line:93},24:{name:"(anonymous_24)",decl:{start:{line:95,column:26},end:{line:95,column:27}},loc:{start:{line:95,column:32},end:{line:112,column:9}},line:95},25:{name:"(anonymous_25)",decl:{start:{line:96,column:31},end:{line:96,column:32}},loc:{start:{line:96,column:52},end:{line:111,column:13}},line:96},26:{name:"(anonymous_26)",decl:{start:{line:101,column:62},end:{line:101,column:63}},loc:{start:{line:101,column:92},end:{line:105,column:21}},line:101},27:{name:"(anonymous_27)",decl:{start:{line:113,column:21},end:{line:113,column:22}},loc:{start:{line:113,column:27},end:{line:117,column:9}},line:113},28:{name:"(anonymous_28)",decl:{start:{line:119,column:30},end:{line:119,column:31}},loc:{start:{line:119,column:41},end:{line:136,column:5}},line:119},29:{name:"(anonymous_29)",decl:{start:{line:135,column:24},end:{line:135,column:25}},loc:{start:{line:135,column:42},end:{line:135,column:67}},line:135},30:{name:"(anonymous_30)",decl:{start:{line:137,column:30},end:{line:137,column:31}},loc:{start:{line:137,column:41},end:{line:149,column:5}},line:137},31:{name:"(anonymous_31)",decl:{start:{line:145,column:24},end:{line:145,column:25}},loc:{start:{line:145,column:42},end:{line:148,column:9}},line:145},32:{name:"(anonymous_32)",decl:{start:{line:150,column:28},end:{line:150,column:29}},loc:{start:{line:150,column:34},end:{line:170,column:5}},line:150},33:{name:"(anonymous_33)",decl:{start:{line:166,column:24},end:{line:166,column:25}},loc:{start:{line:166,column:42},end:{line:169,column:9}},line:166}},branchMap:{0:{loc:{start:{line:4,column:12},end:{line:4,column:38}},type:"default-arg",locations:[{start:{line:4,column:17},end:{line:4,column:38}}],line:4},1:{loc:{start:{line:4,column:40},end:{line:4,column:54}},type:"default-arg",locations:[{start:{line:4,column:48},end:{line:4,column:54}}],line:4},2:{loc:{start:{line:4,column:56},end:{line:4,column:71}},type:"default-arg",locations:[{start:{line:4,column:65},end:{line:4,column:71}}],line:4},3:{loc:{start:{line:4,column:73},end:{line:4,column:87}},type:"default-arg",locations:[{start:{line:4,column:85},end:{line:4,column:87}}],line:4},4:{loc:{start:{line:4,column:89},end:{line:4,column:110}},type:"default-arg",locations:[{start:{line:4,column:103},end:{line:4,column:110}}],line:4},5:{loc:{start:{line:4,column:112},end:{line:4,column:131}},type:"default-arg",locations:[{start:{line:4,column:126},end:{line:4,column:131}}],line:4},6:{loc:{start:{line:4,column:133},end:{line:4,column:153}},type:"default-arg",locations:[{start:{line:4,column:151},end:{line:4,column:153}}],line:4},7:{loc:{start:{line:4,column:155},end:{line:4,column:188}},type:"default-arg",locations:[{start:{line:4,column:183},end:{line:4,column:188}}],line:4},8:{loc:{start:{line:4,column:190},end:{line:4,column:233}},type:"default-arg",locations:[{start:{line:4,column:227},end:{line:4,column:233}}],line:4},9:{loc:{start:{line:4,column:235},end:{line:4,column:250}},type:"default-arg",locations:[{start:{line:4,column:249},end:{line:4,column:250}}],line:4},10:{loc:{start:{line:4,column:252},end:{line:4,column:267}},type:"default-arg",locations:[{start:{line:4,column:266},end:{line:4,column:267}}],line:4},11:{loc:{start:{line:4,column:269},end:{line:4,column:297}},type:"default-arg",locations:[{start:{line:4,column:292},end:{line:4,column:297}}],line:4},12:{loc:{start:{line:4,column:299},end:{line:7,column:5}},type:"default-arg",locations:[{start:{line:4,column:307},end:{line:7,column:5}}],line:4},13:{loc:{start:{line:7,column:7},end:{line:7,column:33}},type:"default-arg",locations:[{start:{line:7,column:18},end:{line:7,column:33}}],line:7},14:{loc:{start:{line:7,column:35},end:{line:7,column:71}},type:"default-arg",locations:[{start:{line:7,column:46},end:{line:7,column:71}}],line:7},15:{loc:{start:{line:7,column:73},end:{line:7,column:94}},type:"default-arg",locations:[{start:{line:7,column:89},end:{line:7,column:94}}],line:7},16:{loc:{start:{line:15,column:27},end:{line:15,column:62}},type:"binary-expr",locations:[{start:{line:15,column:27},end:{line:15,column:54}},{start:{line:15,column:58},end:{line:15,column:62}}],line:15},17:{loc:{start:{line:16,column:8},end:{line:19,column:9}},type:"if",locations:[{start:{line:16,column:8},end:{line:19,column:9}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:16},18:{loc:{start:{line:38,column:12},end:{line:42,column:13}},type:"if",locations:[{start:{line:38,column:12},end:{line:42,column:13}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:38},19:{loc:{start:{line:48,column:12},end:{line:49,column:23}},type:"if",locations:[{start:{line:48,column:12},end:{line:49,column:23}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:48},20:{loc:{start:{line:58,column:12},end:{line:63,column:13}},type:"if",locations:[{start:{line:58,column:12},end:{line:63,column:13}},{start:{line:61,column:17},end:{line:63,column:13}}],line:58},21:{loc:{start:{line:68,column:16},end:{line:79,column:17}},type:"if",locations:[{start:{line:68,column:16},end:{line:79,column:17}},{start:{line:71,column:21},end:{line:79,column:17}}],line:68},22:{loc:{start:{line:97,column:16},end:{line:99,column:17}},type:"if",locations:[{start:{line:97,column:16},end:{line:99,column:17}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:97},23:{loc:{start:{line:102,column:47},end:{line:102,column:71}},type:"binary-expr",locations:[{start:{line:102,column:47},end:{line:102,column:66}},{start:{line:102,column:70},end:{line:102,column:71}}],line:102},24:{loc:{start:{line:103,column:45},end:{line:103,column:67}},type:"binary-expr",locations:[{start:{line:103,column:45},end:{line:103,column:62}},{start:{line:103,column:66},end:{line:103,column:67}}],line:103},25:{loc:{start:{line:124,column:25},end:{line:124,column:59}},type:"cond-expr",locations:[{start:{line:124,column:36},end:{line:124,column:47}},{start:{line:124,column:50},end:{line:124,column:59}}],line:124},26:{loc:{start:{line:125,column:25},end:{line:125,column:61}},type:"cond-expr",locations:[{start:{line:125,column:36},end:{line:125,column:47}},{start:{line:125,column:50},end:{line:125,column:61}}],line:125},27:{loc:{start:{line:128,column:8},end:{line:134,column:9}},type:"if",locations:[{start:{line:128,column:8},end:{line:134,column:9}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:128},28:{loc:{start:{line:138,column:8},end:{line:139,column:19}},type:"if",locations:[{start:{line:138,column:8},end:{line:139,column:19}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:138},29:{loc:{start:{line:151,column:8},end:{line:153,column:9}},type:"if",locations:[{start:{line:151,column:8},end:{line:153,column:9}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:151},30:{loc:{start:{line:155,column:8},end:{line:157,column:9}},type:"if",locations:[{start:{line:155,column:8},end:{line:157,column:9}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:155},31:{loc:{start:{line:158,column:28},end:{line:158,column:63}},type:"binary-expr",locations:[{start:{line:158,column:28},end:{line:158,column:55}},{start:{line:158,column:59},end:{line:158,column:63}}],line:158},32:{loc:{start:{line:159,column:8},end:{line:161,column:9}},type:"if",locations:[{start:{line:159,column:8},end:{line:161,column:9}},{start:{line:void 0,column:void 0},end:{line:void 0,column:void 0}}],line:159}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0,88:0,89:0,90:0,91:0,92:0,93:0,94:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0},b:{0:[0],1:[0],2:[0],3:[0],4:[0],5:[0],6:[0],7:[0],8:[0],9:[0],10:[0],11:[0],12:[0],13:[0],14:[0],15:[0],16:[0,0],17:[0,0],18:[0,0],19:[0,0],20:[0,0],21:[0,0],22:[0,0],23:[0,0],24:[0,0],25:[0,0],26:[0,0],27:[0,0],28:[0,0],29:[0,0],30:[0,0],31:[0,0],32:[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"b2a537109f7bffcb588e5c596cf0910c6ae5d7e9"});var r=i[e];return y=function(){return r},r}y();var v=(y().s[0]++,i.forwardRef((function(e,t){y().f[0]++;var n=(y().s[1]++,e),r=n.id,a=void 0===r?(y().b[0][0]++,"react-sketch-canvas"):r,o=n.width,u=void 0===o?(y().b[1][0]++,"100%"):o,l=n.height,c=void 0===l?(y().b[2][0]++,"100%"):l,d=n.className,h=void 0===d?(y().b[3][0]++,""):d,f=n.canvasColor,p=void 0===f?(y().b[4][0]++,"white"):f,m=n.strokeColor,v=void 0===m?(y().b[5][0]++,"red"):m,b=n.backgroundImage,x=void 0===b?(y().b[6][0]++,""):b,w=n.exportWithBackgroundImage,C=void 0===w?(y().b[7][0]++,!1):w,k=n.preserveBackgroundImageAspectRatio,A=void 0===k?(y().b[8][0]++,"none"):k,_=n.strokeWidth,E=void 0===_?(y().b[9][0]++,4):_,S=n.eraserWidth,F=void 0===S?(y().b[10][0]++,8):S,D=n.allowOnlyPointerType,$=void 0===D?(y().b[11][0]++,"all"):D,O=n.style,N=void 0===O?(y().b[12][0]++,{border:"0.0625rem solid #9c9c9c",borderRadius:"0.25rem"}):O,I=n.onChange,T=void 0===I?(y().b[13][0]++,function(e){y().f[1]++}):I,R=n.onStroke,M=void 0===R?(y().b[14][0]++,function(e,t){y().f[2]++}):R,B=n.withTimestamp,z=void 0===B?(y().b[15][0]++,!1):B,L=(y().s[2]++,i.createRef()),P=(y().s[3]++,i.useState(!0)),j=P[0],U=P[1],W=(y().s[4]++,i.useState(!1)),V=W[0],q=W[1],G=(y().s[5]++,i.useState([])),H=G[0],X=G[1],Y=(y().s[6]++,i.useState([])),K=Y[0],J=Y[1],Z=(y().s[7]++,i.useState([])),Q=Z[0],ee=Z[1],te=(y().s[8]++,i.useCallback((function(){var e,t;y().f[3]++;var n=(y().s[9]++,null!=(y().b[16][0]++,e=null==(t=Q.slice(-1))?void 0:t[0])?e:(y().b[16][1]++,null));if(y().s[10]++,null===n)return y().b[17][0]++,y().s[11]++,console.warn("No stroke found!"),void y().s[12]++;y().b[17][1]++,y().s[13]++,M(n,!n.drawMode)}),[V]));return y().s[14]++,i.useEffect((function(){y().f[4]++,y().s[15]++,te()}),[V]),y().s[16]++,i.useEffect((function(){y().f[5]++,y().s[17]++,T(Q)}),[Q]),y().s[18]++,i.useImperativeHandle(t,(function(){return y().f[6]++,y().s[19]++,{eraseMode:function(e){y().f[7]++,y().s[20]++,U(!e)},clearCanvas:function(){y().f[8]++,y().s[21]++,X([].concat(Q)),y().s[22]++,ee([])},undo:function(){if(y().f[9]++,y().s[23]++,0!==H.length)return y().b[18][0]++,y().s[24]++,ee([].concat(H)),y().s[25]++,X([]),void y().s[26]++;y().b[18][1]++,y().s[27]++,J((function(e){return y().f[10]++,y().s[28]++,[].concat(e,Q.slice(-1))})),y().s[29]++,ee((function(e){return y().f[11]++,y().s[30]++,e.slice(0,-1)}))},redo:function(){if(y().f[12]++,y().s[31]++,0===K.length)return y().b[19][0]++,void y().s[32]++;y().b[19][1]++,y().s[33]++,ee((function(e){return y().f[13]++,y().s[34]++,[].concat(e,K.slice(-1))})),y().s[35]++,J((function(e){return y().f[14]++,y().s[36]++,e.slice(0,-1)}))},exportImage:function(e){var t;y().f[15]++;var n=(y().s[37]++,null==(t=L.current)?void 0:t.exportImage);if(y().s[38]++,n)return y().b[20][1]++,y().s[40]++,n(e);throw y().b[20][0]++,y().s[39]++,Error("Export function called before canvas loaded")},exportSvg:function(){return y().f[16]++,y().s[41]++,new Promise((function(e,t){var n;y().f[17]++;var i=(y().s[42]++,null==(n=L.current)?void 0:n.exportSvg);y().s[43]++,i?(y().b[21][1]++,y().s[45]++,i().then((function(t){y().f[18]++,y().s[46]++,e(t)})).catch((function(e){y().f[19]++,y().s[47]++,t(e)}))):(y().b[21][0]++,y().s[44]++,t(Error("Export function called before canvas loaded")))}))},exportPaths:function(){return y().f[20]++,y().s[48]++,new Promise((function(e,t){y().f[21]++,y().s[49]++;try{y().s[50]++,e(Q)}catch(e){y().s[51]++,t(e)}}))},loadPaths:function(e){y().f[22]++,y().s[52]++,ee((function(t){return y().f[23]++,y().s[53]++,[].concat(t,e)}))},getSketchingTime:function(){return y().f[24]++,y().s[54]++,new Promise((function(e,t){y().f[25]++,y().s[55]++,z?y().b[22][1]++:(y().b[22][0]++,y().s[56]++,t(new Error("Set 'withTimestamp' prop to get sketching time"))),y().s[57]++;try{var n=(y().s[58]++,Q.reduce((function(e,t){var n,i;y().f[26]++;var r=(y().s[59]++,null!=(y().b[23][0]++,n=t.startTimestamp)?n:(y().b[23][1]++,0)),s=(y().s[60]++,null!=(y().b[24][0]++,i=t.endTimestamp)?i:(y().b[24][1]++,0));return y().s[61]++,e+(s-r)}),0));y().s[62]++,e(n)}catch(e){y().s[63]++,t(e)}}))},resetCanvas:function(){y().f[27]++,y().s[64]++,X([]),y().s[65]++,J([]),y().s[66]++,ee([])}}})),y().s[67]++,y().s[75]++,y().s[82]++,y().s[94]++,i.createElement(g,{ref:L,id:a,width:u,height:c,className:h,canvasColor:p,backgroundImage:x,exportWithBackgroundImage:C,preserveBackgroundImageAspectRatio:A,allowOnlyPointerType:$,style:N,paths:Q,isDrawing:V,onPointerDown:function(e){y().f[28]++,y().s[68]++,q(!0),y().s[69]++,J([]);var t=(y().s[70]++,{drawMode:j,strokeColor:j?(y().b[25][0]++,v):(y().b[25][1]++,"#000000"),strokeWidth:j?(y().b[26][0]++,E):(y().b[26][1]++,F),paths:[e]});y().s[71]++,z?(y().b[27][0]++,y().s[72]++,t=s({},t,{startTimestamp:Date.now(),endTimestamp:0})):y().b[27][1]++,y().s[73]++,ee((function(e){return y().f[29]++,y().s[74]++,[].concat(e,[t])}))},onPointerMove:function(e){if(y().f[30]++,y().s[76]++,!V)return y().b[28][0]++,void y().s[77]++;y().b[28][1]++;var t=(y().s[78]++,Q.slice(-1)[0]),n=(y().s[79]++,s({},t,{paths:[].concat(t.paths,[e])}));y().s[80]++,ee((function(e){return y().f[31]++,y().s[81]++,[].concat(e.slice(0,-1),[n])}))},onPointerUp:function(){var e,t;if(y().f[32]++,y().s[83]++,!V)return y().b[29][0]++,void y().s[84]++;if(y().b[29][1]++,y().s[85]++,q(!1),y().s[86]++,!z)return y().b[30][0]++,void y().s[87]++;y().b[30][1]++;var n=(y().s[88]++,null!=(y().b[31][0]++,e=null==(t=Q.slice(-1))?void 0:t[0])?e:(y().b[31][1]++,null));if(y().s[89]++,null===n)return y().b[32][0]++,void y().s[90]++;y().b[32][1]++;var i=(y().s[91]++,s({},n,{endTimestamp:Date.now()}));y().s[92]++,ee((function(e){return y().f[33]++,y().s[93]++,[].concat(e.slice(0,-1),[i])}))}})})));function b(){var e="/home/vinoth/projects/react-sketch-canvas/src/types/canvas.ts",t=new Function("return this")(),n="__coverage__",i=t[n]||(t[n]={});i[e]&&"2be87fac19128abc01bbef968f5632f44d7b92aa"===i[e].hash||(i[e]={path:"/home/vinoth/projects/react-sketch-canvas/src/types/canvas.ts",statementMap:{},fnMap:{},branchMap:{},s:{},f:{},b:{},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"2be87fac19128abc01bbef968f5632f44d7b92aa"});var r=i[e];return b=function(){return r},r}function x(){var e="/home/vinoth/projects/react-sketch-canvas/src/types/index.ts",t=new Function("return this")(),n="__coverage__",i=t[n]||(t[n]={});i[e]&&"f901f2ab2015710050609381f310eb527969a502"===i[e].hash||(i[e]={path:"/home/vinoth/projects/react-sketch-canvas/src/types/index.ts",statementMap:{},fnMap:{},branchMap:{},s:{},f:{},b:{},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"f901f2ab2015710050609381f310eb527969a502"});var r=i[e];return x=function(){return r},r}function w(){var e="/home/vinoth/projects/react-sketch-canvas/src/index.tsx",t=new Function("return this")(),n="__coverage__",i=t[n]||(t[n]={});i[e]&&"8a41ff681dd72447491d9a16cbdba8afde945045"===i[e].hash||(i[e]={path:"/home/vinoth/projects/react-sketch-canvas/src/index.tsx",statementMap:{},fnMap:{},branchMap:{},s:{},f:{},b:{},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"8a41ff681dd72447491d9a16cbdba8afde945045"});var r=i[e];return w=function(){return r},r}b(),x(),w()},7847:(e,t,n)=>{const i=Symbol("SemVer ANY");class r{static get ANY(){return i}constructor(e,t){if(t=s(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}l("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===i?this.value="":this.value=this.operator+this.semver.version,l("comp",this)}parse(e){const t=this.options.loose?a[o.COMPARATORLOOSE]:a[o.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new c(n[2],this.options.loose):this.semver=i}toString(){return this.value}test(e){if(l("Comparator.test",e,this.options.loose),this.semver===i||e===i)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}return u(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new d(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new d(this.value,t).test(e.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),s=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),o=u(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),l=u(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||i||s&&a||o||l}}e.exports=r;const s=n(1388),{re:a,t:o}=n(4808),u=n(3125),l=n(952),c=n(2435),d=n(2013)},2013:(e,t,n)=>{class i{constructor(e,t){if(t=s(t),e instanceof i)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new i(e.raw,t);if(e instanceof a)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!p(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&m(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,n=r.get(t);if(n)return n;const i=this.options.loose,s=i?l[c.HYPHENRANGELOOSE]:l[c.HYPHENRANGE];e=e.replace(s,S(this.options.includePrerelease)),o("hyphen replace",e),e=e.replace(l[c.COMPARATORTRIM],d),o("comparator trim",e,l[c.COMPARATORTRIM]),e=(e=(e=e.replace(l[c.TILDETRIM],h)).replace(l[c.CARETTRIM],f)).split(/\s+/).join(" ");const u=i?l[c.COMPARATORLOOSE]:l[c.COMPARATOR],m=e.split(" ").map((e=>y(e,this.options))).join(" ").split(/\s+/).map((e=>E(e,this.options))).filter(this.options.loose?e=>!!e.match(u):()=>!0).map((e=>new a(e,this.options))),g=(m.length,new Map);for(const e of m){if(p(e))return[e];g.set(e.value,e)}g.size>1&&g.has("")&&g.delete("");const v=[...g.values()];return r.set(t,v),v}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Range is required");return this.set.some((n=>g(n,t)&&e.set.some((e=>g(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(F(this.set[t],e,this.options))return!0;return!1}}e.exports=i;const r=new(n(7105))({max:1e3}),s=n(1388),a=n(7847),o=n(952),u=n(2435),{re:l,t:c,comparatorTrimReplace:d,tildeTrimReplace:h,caretTrimReplace:f}=n(4808),p=e=>"<0.0.0-0"===e.value,m=e=>""===e.value,g=(e,t)=>{let n=!0;const i=e.slice();let r=i.pop();for(;n&&i.length;)n=i.every((e=>r.intersects(e,t))),r=i.pop();return n},y=(e,t)=>(o("comp",e,t),e=w(e,t),o("caret",e),e=b(e,t),o("tildes",e),e=k(e,t),o("xrange",e),e=_(e,t),o("stars",e),e),v=e=>!e||"x"===e.toLowerCase()||"*"===e,b=(e,t)=>e.trim().split(/\s+/).map((e=>x(e,t))).join(" "),x=(e,t)=>{const n=t.loose?l[c.TILDELOOSE]:l[c.TILDE];return e.replace(n,((t,n,i,r,s)=>{let a;return o("tilde",e,t,n,i,r,s),v(n)?a="":v(i)?a=`>=${n}.0.0 <${+n+1}.0.0-0`:v(r)?a=`>=${n}.${i}.0 <${n}.${+i+1}.0-0`:s?(o("replaceTilde pr",s),a=`>=${n}.${i}.${r}-${s} <${n}.${+i+1}.0-0`):a=`>=${n}.${i}.${r} <${n}.${+i+1}.0-0`,o("tilde return",a),a}))},w=(e,t)=>e.trim().split(/\s+/).map((e=>C(e,t))).join(" "),C=(e,t)=>{o("caret",e,t);const n=t.loose?l[c.CARETLOOSE]:l[c.CARET],i=t.includePrerelease?"-0":"";return e.replace(n,((t,n,r,s,a)=>{let u;return o("caret",e,t,n,r,s,a),v(n)?u="":v(r)?u=`>=${n}.0.0${i} <${+n+1}.0.0-0`:v(s)?u="0"===n?`>=${n}.${r}.0${i} <${n}.${+r+1}.0-0`:`>=${n}.${r}.0${i} <${+n+1}.0.0-0`:a?(o("replaceCaret pr",a),u="0"===n?"0"===r?`>=${n}.${r}.${s}-${a} <${n}.${r}.${+s+1}-0`:`>=${n}.${r}.${s}-${a} <${n}.${+r+1}.0-0`:`>=${n}.${r}.${s}-${a} <${+n+1}.0.0-0`):(o("no pr"),u="0"===n?"0"===r?`>=${n}.${r}.${s}${i} <${n}.${r}.${+s+1}-0`:`>=${n}.${r}.${s}${i} <${n}.${+r+1}.0-0`:`>=${n}.${r}.${s} <${+n+1}.0.0-0`),o("caret return",u),u}))},k=(e,t)=>(o("replaceXRanges",e,t),e.split(/\s+/).map((e=>A(e,t))).join(" ")),A=(e,t)=>{e=e.trim();const n=t.loose?l[c.XRANGELOOSE]:l[c.XRANGE];return e.replace(n,((n,i,r,s,a,u)=>{o("xRange",e,n,i,r,s,a,u);const l=v(r),c=l||v(s),d=c||v(a),h=d;return"="===i&&h&&(i=""),u=t.includePrerelease?"-0":"",l?n=">"===i||"<"===i?"<0.0.0-0":"*":i&&h?(c&&(s=0),a=0,">"===i?(i=">=",c?(r=+r+1,s=0,a=0):(s=+s+1,a=0)):"<="===i&&(i="<",c?r=+r+1:s=+s+1),"<"===i&&(u="-0"),n=`${i+r}.${s}.${a}${u}`):c?n=`>=${r}.0.0${u} <${+r+1}.0.0-0`:d&&(n=`>=${r}.${s}.0${u} <${r}.${+s+1}.0-0`),o("xRange return",n),n}))},_=(e,t)=>(o("replaceStars",e,t),e.trim().replace(l[c.STAR],"")),E=(e,t)=>(o("replaceGTE0",e,t),e.trim().replace(l[t.includePrerelease?c.GTE0PRE:c.GTE0],"")),S=e=>(t,n,i,r,s,a,o,u,l,c,d,h,f)=>`${n=v(i)?"":v(r)?`>=${i}.0.0${e?"-0":""}`:v(s)?`>=${i}.${r}.0${e?"-0":""}`:a?`>=${n}`:`>=${n}${e?"-0":""}`} ${u=v(l)?"":v(c)?`<${+l+1}.0.0-0`:v(d)?`<${l}.${+c+1}.0-0`:h?`<=${l}.${c}.${d}-${h}`:e?`<${l}.${c}.${+d+1}-0`:`<=${u}`}`.trim(),F=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(o(e[n].semver),e[n].semver!==a.ANY&&e[n].semver.prerelease.length>0){const i=e[n].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0}},2435:(e,t,n)=>{const i=n(952),{MAX_LENGTH:r,MAX_SAFE_INTEGER:s}=n(5558),{re:a,t:o}=n(4808),u=n(1388),{compareIdentifiers:l}=n(4935);class c{constructor(e,t){if(t=u(t),e instanceof c){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>r)throw new TypeError(`version is longer than ${r} characters`);i("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?a[o.LOOSE]:a[o.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<s)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(i("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),l(this.major,e.major)||l(this.minor,e.minor)||l(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],r=e.prerelease[t];if(i("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return l(n,r)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{const n=this.build[t],r=e.build[t];if(i("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return l(n,r)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}e.exports=c},6694:(e,t,n)=>{const i=n(9943);e.exports=(e,t)=>{const n=i(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}},3125:(e,t,n)=>{const i=n(3276),r=n(7893),s=n(6379),a=n(8463),o=n(1897),u=n(506);e.exports=(e,t,n,l)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return i(e,n,l);case"!=":return r(e,n,l);case">":return s(e,n,l);case">=":return a(e,n,l);case"<":return o(e,n,l);case"<=":return u(e,n,l);default:throw new TypeError(`Invalid operator: ${t}`)}}},8686:(e,t,n)=>{const i=n(2435),r=n(9943),{re:s,t:a}=n(4808);e.exports=(e,t)=>{if(e instanceof i)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){let t;for(;(t=s[a.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&t.index+t[0].length===n.index+n[0].length||(n=t),s[a.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;s[a.COERCERTL].lastIndex=-1}else n=e.match(s[a.COERCE]);return null===n?null:r(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)}},5914:(e,t,n)=>{const i=n(2435);e.exports=(e,t,n)=>{const r=new i(e,n),s=new i(t,n);return r.compare(s)||r.compareBuild(s)}},5404:(e,t,n)=>{const i=n(2271);e.exports=(e,t)=>i(e,t,!0)},2271:(e,t,n)=>{const i=n(2435);e.exports=(e,t,n)=>new i(e,n).compare(new i(t,n))},6007:(e,t,n)=>{const i=n(9943),r=n(3276);e.exports=(e,t)=>{if(r(e,t))return null;{const n=i(e),r=i(t),s=n.prerelease.length||r.prerelease.length,a=s?"pre":"",o=s?"prerelease":"";for(const e in n)if(("major"===e||"minor"===e||"patch"===e)&&n[e]!==r[e])return a+e;return o}}},3276:(e,t,n)=>{const i=n(2271);e.exports=(e,t,n)=>0===i(e,t,n)},6379:(e,t,n)=>{const i=n(2271);e.exports=(e,t,n)=>i(e,t,n)>0},8463:(e,t,n)=>{const i=n(2271);e.exports=(e,t,n)=>i(e,t,n)>=0},6360:(e,t,n)=>{const i=n(2435);e.exports=(e,t,n,r)=>{"string"==typeof n&&(r=n,n=void 0);try{return new i(e,n).inc(t,r).version}catch(e){return null}}},1897:(e,t,n)=>{const i=n(2271);e.exports=(e,t,n)=>i(e,t,n)<0},506:(e,t,n)=>{const i=n(2271);e.exports=(e,t,n)=>i(e,t,n)<=0},4551:(e,t,n)=>{const i=n(2435);e.exports=(e,t)=>new i(e,t).major},469:(e,t,n)=>{const i=n(2435);e.exports=(e,t)=>new i(e,t).minor},7893:(e,t,n)=>{const i=n(2271);e.exports=(e,t,n)=>0!==i(e,t,n)},9943:(e,t,n)=>{const{MAX_LENGTH:i}=n(5558),{re:r,t:s}=n(4808),a=n(2435),o=n(1388);e.exports=(e,t)=>{if(t=o(t),e instanceof a)return e;if("string"!=typeof e)return null;if(e.length>i)return null;if(!(t.loose?r[s.LOOSE]:r[s.FULL]).test(e))return null;try{return new a(e,t)}catch(e){return null}}},4250:(e,t,n)=>{const i=n(2435);e.exports=(e,t)=>new i(e,t).patch},8204:(e,t,n)=>{const i=n(9943);e.exports=(e,t)=>{const n=i(e,t);return n&&n.prerelease.length?n.prerelease:null}},733:(e,t,n)=>{const i=n(2271);e.exports=(e,t,n)=>i(t,e,n)},2961:(e,t,n)=>{const i=n(5914);e.exports=(e,t)=>e.sort(((e,n)=>i(n,e,t)))},9844:(e,t,n)=>{const i=n(2013);e.exports=(e,t,n)=>{try{t=new i(t,n)}catch(e){return!1}return t.test(e)}},1116:(e,t,n)=>{const i=n(5914);e.exports=(e,t)=>e.sort(((e,n)=>i(e,n,t)))},7230:(e,t,n)=>{const i=n(9943);e.exports=(e,t)=>{const n=i(e,t);return n?n.version:null}},7699:(e,t,n)=>{const i=n(4808);e.exports={re:i.re,src:i.src,tokens:i.t,SEMVER_SPEC_VERSION:n(5558).SEMVER_SPEC_VERSION,SemVer:n(2435),compareIdentifiers:n(4935).compareIdentifiers,rcompareIdentifiers:n(4935).rcompareIdentifiers,parse:n(9943),valid:n(7230),clean:n(6694),inc:n(6360),diff:n(6007),major:n(4551),minor:n(469),patch:n(4250),prerelease:n(8204),compare:n(2271),rcompare:n(733),compareLoose:n(5404),compareBuild:n(5914),sort:n(1116),rsort:n(2961),gt:n(6379),lt:n(1897),eq:n(3276),neq:n(7893),gte:n(8463),lte:n(506),cmp:n(3125),coerce:n(8686),Comparator:n(7847),Range:n(2013),satisfies:n(9844),toComparators:n(8865),maxSatisfying:n(3727),minSatisfying:n(4338),minVersion:n(1542),validRange:n(576),outside:n(9106),gtr:n(995),ltr:n(7805),intersects:n(3214),simplifyRange:n(1338),subset:n(3122)}},5558:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:t,MAX_SAFE_COMPONENT_LENGTH:16}},952:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},4935:e=>{const t=/^[0-9]+$/,n=(e,n)=>{const i=t.test(e),r=t.test(n);return i&&r&&(e=+e,n=+n),e===n?0:i&&!r?-1:r&&!i?1:e<n?-1:1};e.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},1388:e=>{const t=["includePrerelease","loose","rtl"];e.exports=e=>e?"object"!=typeof e?{loose:!0}:t.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{}},4808:(e,t,n)=>{const{MAX_SAFE_COMPONENT_LENGTH:i}=n(5558),r=n(952),s=(t=e.exports={}).re=[],a=t.src=[],o=t.t={};let u=0;const l=(e,t,n)=>{const i=u++;r(i,t),o[e]=i,a[i]=t,s[i]=new RegExp(t,n?"g":void 0)};l("NUMERICIDENTIFIER","0|[1-9]\\d*"),l("NUMERICIDENTIFIERLOOSE","[0-9]+"),l("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),l("MAINVERSION",`(${a[o.NUMERICIDENTIFIER]})\\.(${a[o.NUMERICIDENTIFIER]})\\.(${a[o.NUMERICIDENTIFIER]})`),l("MAINVERSIONLOOSE",`(${a[o.NUMERICIDENTIFIERLOOSE]})\\.(${a[o.NUMERICIDENTIFIERLOOSE]})\\.(${a[o.NUMERICIDENTIFIERLOOSE]})`),l("PRERELEASEIDENTIFIER",`(?:${a[o.NUMERICIDENTIFIER]}|${a[o.NONNUMERICIDENTIFIER]})`),l("PRERELEASEIDENTIFIERLOOSE",`(?:${a[o.NUMERICIDENTIFIERLOOSE]}|${a[o.NONNUMERICIDENTIFIER]})`),l("PRERELEASE",`(?:-(${a[o.PRERELEASEIDENTIFIER]}(?:\\.${a[o.PRERELEASEIDENTIFIER]})*))`),l("PRERELEASELOOSE",`(?:-?(${a[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${a[o.PRERELEASEIDENTIFIERLOOSE]})*))`),l("BUILDIDENTIFIER","[0-9A-Za-z-]+"),l("BUILD",`(?:\\+(${a[o.BUILDIDENTIFIER]}(?:\\.${a[o.BUILDIDENTIFIER]})*))`),l("FULLPLAIN",`v?${a[o.MAINVERSION]}${a[o.PRERELEASE]}?${a[o.BUILD]}?`),l("FULL",`^${a[o.FULLPLAIN]}$`),l("LOOSEPLAIN",`[v=\\s]*${a[o.MAINVERSIONLOOSE]}${a[o.PRERELEASELOOSE]}?${a[o.BUILD]}?`),l("LOOSE",`^${a[o.LOOSEPLAIN]}$`),l("GTLT","((?:<|>)?=?)"),l("XRANGEIDENTIFIERLOOSE",`${a[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),l("XRANGEIDENTIFIER",`${a[o.NUMERICIDENTIFIER]}|x|X|\\*`),l("XRANGEPLAIN",`[v=\\s]*(${a[o.XRANGEIDENTIFIER]})(?:\\.(${a[o.XRANGEIDENTIFIER]})(?:\\.(${a[o.XRANGEIDENTIFIER]})(?:${a[o.PRERELEASE]})?${a[o.BUILD]}?)?)?`),l("XRANGEPLAINLOOSE",`[v=\\s]*(${a[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[o.XRANGEIDENTIFIERLOOSE]})(?:${a[o.PRERELEASELOOSE]})?${a[o.BUILD]}?)?)?`),l("XRANGE",`^${a[o.GTLT]}\\s*${a[o.XRANGEPLAIN]}$`),l("XRANGELOOSE",`^${a[o.GTLT]}\\s*${a[o.XRANGEPLAINLOOSE]}$`),l("COERCE",`(^|[^\\d])(\\d{1,${i}})(?:\\.(\\d{1,${i}}))?(?:\\.(\\d{1,${i}}))?(?:$|[^\\d])`),l("COERCERTL",a[o.COERCE],!0),l("LONETILDE","(?:~>?)"),l("TILDETRIM",`(\\s*)${a[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",l("TILDE",`^${a[o.LONETILDE]}${a[o.XRANGEPLAIN]}$`),l("TILDELOOSE",`^${a[o.LONETILDE]}${a[o.XRANGEPLAINLOOSE]}$`),l("LONECARET","(?:\\^)"),l("CARETTRIM",`(\\s*)${a[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",l("CARET",`^${a[o.LONECARET]}${a[o.XRANGEPLAIN]}$`),l("CARETLOOSE",`^${a[o.LONECARET]}${a[o.XRANGEPLAINLOOSE]}$`),l("COMPARATORLOOSE",`^${a[o.GTLT]}\\s*(${a[o.LOOSEPLAIN]})$|^$`),l("COMPARATOR",`^${a[o.GTLT]}\\s*(${a[o.FULLPLAIN]})$|^$`),l("COMPARATORTRIM",`(\\s*)${a[o.GTLT]}\\s*(${a[o.LOOSEPLAIN]}|${a[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",l("HYPHENRANGE",`^\\s*(${a[o.XRANGEPLAIN]})\\s+-\\s+(${a[o.XRANGEPLAIN]})\\s*$`),l("HYPHENRANGELOOSE",`^\\s*(${a[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${a[o.XRANGEPLAINLOOSE]})\\s*$`),l("STAR","(<|>)?=?\\s*\\*"),l("GTE0","^\\s*>=\\s*0.0.0\\s*$"),l("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},995:(e,t,n)=>{const i=n(9106);e.exports=(e,t,n)=>i(e,t,">",n)},3214:(e,t,n)=>{const i=n(2013);e.exports=(e,t,n)=>(e=new i(e,n),t=new i(t,n),e.intersects(t))},7805:(e,t,n)=>{const i=n(9106);e.exports=(e,t,n)=>i(e,t,"<",n)},3727:(e,t,n)=>{const i=n(2435),r=n(2013);e.exports=(e,t,n)=>{let s=null,a=null,o=null;try{o=new r(t,n)}catch(e){return null}return e.forEach((e=>{o.test(e)&&(s&&-1!==a.compare(e)||(s=e,a=new i(s,n)))})),s}},4338:(e,t,n)=>{const i=n(2435),r=n(2013);e.exports=(e,t,n)=>{let s=null,a=null,o=null;try{o=new r(t,n)}catch(e){return null}return e.forEach((e=>{o.test(e)&&(s&&1!==a.compare(e)||(s=e,a=new i(s,n)))})),s}},1542:(e,t,n)=>{const i=n(2435),r=n(2013),s=n(6379);e.exports=(e,t)=>{e=new r(e,t);let n=new i("0.0.0");if(e.test(n))return n;if(n=new i("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const r=e.set[t];let a=null;r.forEach((e=>{const t=new i(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":a&&!s(t,a)||(a=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!a||n&&!s(n,a)||(n=a)}return n&&e.test(n)?n:null}},9106:(e,t,n)=>{const i=n(2435),r=n(7847),{ANY:s}=r,a=n(2013),o=n(9844),u=n(6379),l=n(1897),c=n(506),d=n(8463);e.exports=(e,t,n,h)=>{let f,p,m,g,y;switch(e=new i(e,h),t=new a(t,h),n){case">":f=u,p=c,m=l,g=">",y=">=";break;case"<":f=l,p=d,m=u,g="<",y="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,h))return!1;for(let n=0;n<t.set.length;++n){const i=t.set[n];let a=null,o=null;if(i.forEach((e=>{e.semver===s&&(e=new r(">=0.0.0")),a=a||e,o=o||e,f(e.semver,a.semver,h)?a=e:m(e.semver,o.semver,h)&&(o=e)})),a.operator===g||a.operator===y)return!1;if((!o.operator||o.operator===g)&&p(e,o.semver))return!1;if(o.operator===y&&m(e,o.semver))return!1}return!0}},1338:(e,t,n)=>{const i=n(9844),r=n(2271);e.exports=(e,t,n)=>{const s=[];let a=null,o=null;const u=e.sort(((e,t)=>r(e,t,n)));for(const e of u)i(e,t,n)?(o=e,a||(a=e)):(o&&s.push([a,o]),o=null,a=null);a&&s.push([a,null]);const l=[];for(const[e,t]of s)e===t?l.push(e):t||e!==u[0]?t?e===u[0]?l.push(`<=${t}`):l.push(`${e} - ${t}`):l.push(`>=${e}`):l.push("*");const c=l.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return c.length<d.length?c:t}},3122:(e,t,n)=>{const i=n(2013),r=n(7847),{ANY:s}=r,a=n(9844),o=n(2271),u=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===s){if(1===t.length&&t[0].semver===s)return!0;e=n.includePrerelease?[new r(">=0.0.0-0")]:[new r(">=0.0.0")]}if(1===t.length&&t[0].semver===s){if(n.includePrerelease)return!0;t=[new r(">=0.0.0")]}const i=new Set;let u,d,h,f,p,m,g;for(const t of e)">"===t.operator||">="===t.operator?u=l(u,t,n):"<"===t.operator||"<="===t.operator?d=c(d,t,n):i.add(t.semver);if(i.size>1)return null;if(u&&d){if(h=o(u.semver,d.semver,n),h>0)return null;if(0===h&&(">="!==u.operator||"<="!==d.operator))return null}for(const e of i){if(u&&!a(e,String(u),n))return null;if(d&&!a(e,String(d),n))return null;for(const i of t)if(!a(e,String(i),n))return!1;return!0}let y=!(!d||n.includePrerelease||!d.semver.prerelease.length)&&d.semver,v=!(!u||n.includePrerelease||!u.semver.prerelease.length)&&u.semver;y&&1===y.prerelease.length&&"<"===d.operator&&0===y.prerelease[0]&&(y=!1);for(const e of t){if(g=g||">"===e.operator||">="===e.operator,m=m||"<"===e.operator||"<="===e.operator,u)if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),">"===e.operator||">="===e.operator){if(f=l(u,e,n),f===e&&f!==u)return!1}else if(">="===u.operator&&!a(u.semver,String(e),n))return!1;if(d)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),"<"===e.operator||"<="===e.operator){if(p=c(d,e,n),p===e&&p!==d)return!1}else if("<="===d.operator&&!a(d.semver,String(e),n))return!1;if(!e.operator&&(d||u)&&0!==h)return!1}return!(u&&m&&!d&&0!==h||d&&g&&!u&&0!==h||v||y)},l=(e,t,n)=>{if(!e)return t;const i=o(e.semver,t.semver,n);return i>0?e:i<0||">"===t.operator&&">="===e.operator?t:e},c=(e,t,n)=>{if(!e)return t;const i=o(e.semver,t.semver,n);return i<0?e:i>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,n={})=>{if(e===t)return!0;e=new i(e,n),t=new i(t,n);let r=!1;e:for(const i of e.set){for(const e of t.set){const t=u(i,e,n);if(r=r||null!==t,t)continue e}if(r)return!1}return!0}},8865:(e,t,n)=>{const i=n(2013);e.exports=(e,t)=>new i(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},576:(e,t,n)=>{const i=n(2013);e.exports=(e,t)=>{try{return new i(e,t).range||"*"}catch(e){return null}}},4731:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DEFAULT_ACTIONS:()=>b1,default:()=>D1,guessMode:()=>_1,vega:()=>g1,vegaLite:()=>y1});var i={};n.r(i),n.d(i,{JsonPatchError:()=>N,_areEquals:()=>U,applyOperation:()=>B,applyPatch:()=>z,applyReducer:()=>L,deepClone:()=>I,getValueByPointer:()=>M,validate:()=>j,validator:()=>P});var r={};n.r(r),n.d(r,{compare:()=>K,generate:()=>X,observe:()=>H,unobserve:()=>G});var s={};n.r(s),n.d(s,{aggregate:()=>Zl,bin:()=>Ql,collect:()=>tc,compare:()=>nc,countpattern:()=>rc,cross:()=>sc,density:()=>uc,dotbin:()=>fc,expression:()=>pc,extent:()=>gc,facet:()=>vc,field:()=>bc,filter:()=>wc,flatten:()=>Cc,fold:()=>kc,formula:()=>Ac,generate:()=>_c,impute:()=>Fc,joinaggregate:()=>Dc,kde:()=>$c,key:()=>Oc,load:()=>Ic,lookup:()=>Rc,multiextent:()=>Mc,multivalues:()=>zc,params:()=>Pc,pivot:()=>jc,prefacet:()=>Uc,project:()=>Wc,proxy:()=>Vc,quantile:()=>qc,relay:()=>Gc,sample:()=>Hc,sequence:()=>Xc,sieve:()=>Yc,subflow:()=>yc,timeunit:()=>Kc,tupleindex:()=>Zc,values:()=>Qc,window:()=>rd});var a={};n.r(a),n.d(a,{interpolate:()=>If,interpolateArray:()=>_f,interpolateBasis:()=>ff,interpolateBasisClosed:()=>pf,interpolateCubehelix:()=>gm,interpolateCubehelixLong:()=>ym,interpolateDate:()=>Sf,interpolateDiscrete:()=>Cp,interpolateHcl:()=>nm,interpolateHclLong:()=>im,interpolateHsl:()=>Tp,interpolateHslLong:()=>Rp,interpolateHue:()=>kp,interpolateLab:()=>em,interpolateNumber:()=>Ff,interpolateNumberArray:()=>kf,interpolateObject:()=>Df,interpolateRgb:()=>bf,interpolateRgbBasis:()=>wf,interpolateRgbBasisClosed:()=>Cf,interpolateRound:()=>Tf,interpolateString:()=>Nf,interpolateTransformCss:()=>Dp,interpolateTransformSvg:()=>$p,interpolateZoom:()=>Np,piecewise:()=>bp,quantize:()=>vm});var o={};n.r(o),n.d(o,{bound:()=>Nw,identifier:()=>Rw,mark:()=>Mw,overlap:()=>Bw,render:()=>Vw,viewlayout:()=>dC});var u={};n.r(u),n.d(u,{axisticks:()=>fC,datajoin:()=>pC,encode:()=>gC,legendentries:()=>yC,linkpath:()=>CC,pie:()=>SC,scale:()=>$C,sortitems:()=>TC,stack:()=>LC});var l={};n.r(l),n.d(l,{contour:()=>gE,geojson:()=>bE,geopath:()=>xE,geopoint:()=>wE,geoshape:()=>CE,graticule:()=>kE,heatmap:()=>AE,isocontour:()=>aE,kde2d:()=>fE,projection:()=>EE});var c={};n.r(c),n.d(c,{force:()=>wS});var d={};n.r(d),n.d(d,{nest:()=>wF,pack:()=>SF,partition:()=>DF,stratify:()=>$F,tree:()=>IF,treelinks:()=>TF,treemap:()=>BF});var h={};n.r(h),n.d(h,{label:()=>nD});var f={};n.r(f),n.d(f,{loess:()=>rD,regression:()=>aD});var p={};n.r(p),n.d(p,{voronoi:()=>DD});var m={};n.r(m),n.d(m,{wordcloud:()=>WD});var g={};n.r(g),n.d(g,{crossfilter:()=>KD,resolvefilter:()=>JD});var y={};n.r(y),n.d(y,{Bounds:()=>$y,CanvasHandler:()=>sx,CanvasRenderer:()=>cx,DATE:()=>Or,DAY:()=>Nr,DAYOFYEAR:()=>Ir,Dataflow:()=>Fu,Debug:()=>xe,Error:()=>ye,EventStream:()=>pu,Gradient:()=>Bg,GroupItem:()=>Ny,HOURS:()=>Tr,Handler:()=>jb,Info:()=>be,Item:()=>Oy,MILLISECONDS:()=>Br,MINUTES:()=>Rr,MONTH:()=>Dr,Marks:()=>_b,MultiPulse:()=>Au,None:()=>ge,Operator:()=>du,Parameters:()=>uu,Pulse:()=>xu,QUARTER:()=>Fr,RenderType:()=>Jx,Renderer:()=>Wb,ResourceLoader:()=>Iy,SECONDS:()=>Mr,SVGHandler:()=>hx,SVGRenderer:()=>Mx,SVGStringRenderer:()=>Kx,Scenegraph:()=>Ib,TIME_UNITS:()=>zr,Transform:()=>$u,View:()=>QI,WEEK:()=>$r,Warn:()=>ve,YEAR:()=>Sr,accessor:()=>ee,accessorFields:()=>ne,accessorName:()=>te,array:()=>He,ascending:()=>Je,bandwidthNRD:()=>qu,bin:()=>Gu,bootstrapCI:()=>Yu,boundClip:()=>sw,boundContext:()=>ev,boundItem:()=>Eb,boundMark:()=>Fb,boundStroke:()=>My,changeset:()=>au,clampRange:()=>Xe,codegenExpression:()=>Qz,compare:()=>Ke,constant:()=>tt,cumulativeLogNormal:()=>cl,cumulativeNormal:()=>rl,cumulativeUniform:()=>gl,dayofyear:()=>qr,debounce:()=>nt,defaultLocale:()=>vo,definition:()=>Nu,densityLogNormal:()=>ll,densityNormal:()=>il,densityUniform:()=>ml,domChild:()=>Bb,domClear:()=>zb,domCreate:()=>Rb,domFind:()=>Mb,dotbin:()=>Ku,error:()=>ae,expressionFunction:()=>tI,extend:()=>it,extent:()=>rt,extentIndex:()=>st,falsy:()=>pe,fastmap:()=>lt,field:()=>ue,flush:()=>ct,font:()=>bb,fontFamily:()=>vb,fontSize:()=>fb,format:()=>Uo,formatLocale:()=>lo,formats:()=>Wo,hasOwnProperty:()=>ot,id:()=>le,identity:()=>ce,inferType:()=>Ro,inferTypes:()=>Mo,ingest:()=>eu,inherits:()=>dt,inrange:()=>ht,interpolate:()=>ug,interpolateColors:()=>sg,interpolateRange:()=>rg,intersect:()=>ew,intersectBoxLine:()=>dv,intersectPath:()=>ov,intersectPoint:()=>uv,intersectRule:()=>cv,isArray:()=>Ce,isBoolean:()=>ft,isDate:()=>pt,isFunction:()=>Ye,isIterable:()=>mt,isNumber:()=>gt,isObject:()=>ke,isRegExp:()=>yt,isString:()=>vt,isTuple:()=>Jo,key:()=>bt,lerp:()=>xt,lineHeight:()=>pb,loader:()=>Go,locale:()=>yo,logger:()=>we,lruCache:()=>wt,markup:()=>Dx,merge:()=>Ct,mergeConfig:()=>_e,multiLineOffset:()=>gb,one:()=>he,pad:()=>At,panLinear:()=>Me,panLog:()=>Be,panPow:()=>ze,panSymlog:()=>Le,parse:()=>LB,parseExpression:()=>Kz,parseSelector:()=>rL,pathCurves:()=>Lg,pathEqual:()=>ow,pathParse:()=>Ug,pathRectangle:()=>hy,pathRender:()=>Qg,pathSymbols:()=>iy,pathTrail:()=>fy,peek:()=>Fe,point:()=>Pb,projection:()=>X_,quantileLogNormal:()=>dl,quantileNormal:()=>sl,quantileUniform:()=>yl,quantiles:()=>Wu,quantizeInterpolator:()=>ag,quarter:()=>qe,quartiles:()=>Vu,random:()=>Hu,randomInteger:()=>Zu,randomKDE:()=>ol,randomLCG:()=>Ju,randomLogNormal:()=>hl,randomMixture:()=>fl,randomNormal:()=>al,randomUniform:()=>vl,read:()=>qo,regressionExp:()=>_l,regressionLinear:()=>kl,regressionLoess:()=>$l,regressionLog:()=>Al,regressionPoly:()=>Fl,regressionPow:()=>El,regressionQuad:()=>Sl,renderModule:()=>Qx,repeat:()=>kt,resetDefaultLocale:()=>bo,resetSVGClipId:()=>Fy,resetSVGDefIds:()=>uw,responseType:()=>Vo,runtimeContext:()=>dI,sampleCurve:()=>Tl,sampleLogNormal:()=>ul,sampleNormal:()=>nl,sampleUniform:()=>pl,scale:()=>Xm,sceneEqual:()=>aw,sceneFromJSON:()=>Ob,scenePickVisit:()=>Cv,sceneToJSON:()=>$b,sceneVisit:()=>wv,sceneZOrder:()=>xv,scheme:()=>hg,serializeXML:()=>$x,setRandom:()=>Xu,span:()=>_t,splitAccessPath:()=>oe,stringValue:()=>Et,textMetrics:()=>ob,timeBin:()=>$s,timeFloor:()=>os,timeFormatLocale:()=>mo,timeInterval:()=>fs,timeOffset:()=>gs,timeSequence:()=>bs,timeUnitSpecifier:()=>Ur,timeUnits:()=>Pr,toBoolean:()=>St,toDate:()=>Dt,toNumber:()=>De,toSet:()=>Ot,toString:()=>$t,transform:()=>Iu,transforms:()=>Ou,truncate:()=>Nt,truthy:()=>fe,tupleid:()=>Zo,typeParsers:()=>No,utcFloor:()=>cs,utcInterval:()=>ps,utcOffset:()=>ys,utcSequence:()=>xs,utcdayofyear:()=>Jr,utcquarter:()=>Ge,utcweek:()=>Zr,version:()=>uL,visitArray:()=>It,week:()=>Gr,writeConfig:()=>Ee,zero:()=>de,zoomLinear:()=>je,zoomLog:()=>Ue,zoomPow:()=>We,zoomSymlog:()=>Ve});var v={};n.r(v),n.d(v,{compile:()=>A0,extractTransforms:()=>E0,normalize:()=>JH,version:()=>S0});var b={};n.r(b),n.d(b,{dark:()=>$0,excel:()=>N0,fivethirtyeight:()=>B0,ggplot2:()=>L0,googlecharts:()=>a1,latimes:()=>q0,quartz:()=>X0,urbaninstitute:()=>n1,version:()=>o1,vox:()=>K0});var x,w=(x=function(e,t){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}x(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),C=Object.prototype.hasOwnProperty;function k(e,t){return C.call(e,t)}function A(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);for(var i in t=[],e)k(e,i)&&t.push(i);return t}function _(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function E(e){for(var t,n=0,i=e.length;n<i;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function S(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function F(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function D(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(D(e[t]))return!0}else if("object"==typeof e){var i=A(e),r=i.length;for(t=0;t<r;t++)if(D(e[i[t]]))return!0}return!1}function $(e,t){var n=[e];for(var i in t){var r="object"==typeof t[i]?JSON.stringify(t[i],null,2):t[i];void 0!==r&&n.push(i+": "+r)}return n.join("\n")}var O=function(e){function t(t,n,i,r,s){var a=this.constructor,o=e.call(this,$(t,{name:n,index:i,operation:r,tree:s}))||this;return o.name=n,o.index=i,o.operation=r,o.tree=s,Object.setPrototypeOf(o,a.prototype),o.message=$(t,{name:n,index:i,operation:r,tree:s}),o}return w(t,e),t}(Error),N=O,I=_,T={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=M(n,this.path);i&&(i=_(i));var r=B(n,{op:"remove",path:this.from}).removed;return B(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=M(n,this.from);return B(n,{op:"add",path:this.path,value:_(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:U(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},R={add:function(e,t,n){return E(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:T.move,copy:T.copy,test:T.test,_get:T._get};function M(e,t){if(""==t)return e;var n={op:"_get",path:t};return B(e,n),n.value}function B(e,t,n,i,r,s){if(void 0===n&&(n=!1),void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===s&&(s=0),n&&("function"==typeof n?n(t,0,e,t.path):P(t,0)),""===t.path){var a={newDocument:e};if("add"===t.op)return a.newDocument=t.value,a;if("replace"===t.op)return a.newDocument=t.value,a.removed=e,a;if("move"===t.op||"copy"===t.op)return a.newDocument=M(e,t.from),"move"===t.op&&(a.removed=e),a;if("test"===t.op){if(a.test=U(e,t.value),!1===a.test)throw new N("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return a.newDocument=e,a}if("remove"===t.op)return a.removed=e,a.newDocument=null,a;if("_get"===t.op)return t.value=e,a;if(n)throw new N("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return a}i||(e=_(e));var o=(t.path||"").split("/"),u=e,l=1,c=o.length,d=void 0,h=void 0,f=void 0;for(f="function"==typeof n?n:P;;){if((h=o[l])&&-1!=h.indexOf("~")&&(h=F(h)),r&&"__proto__"==h)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===d&&(void 0===u[h]?d=o.slice(0,l).join("/"):l==c-1&&(d=t.path),void 0!==d&&f(t,0,e,d)),l++,Array.isArray(u)){if("-"===h)h=u.length;else{if(n&&!E(h))throw new N("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);E(h)&&(h=~~h)}if(l>=c){if(n&&"add"===t.op&&h>u.length)throw new N("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);if(!1===(a=R[t.op].call(t,u,h,e)).test)throw new N("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return a}}else if(l>=c){if(!1===(a=T[t.op].call(t,u,h,e)).test)throw new N("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return a}if(u=u[h],n&&l<c&&(!u||"object"!=typeof u))throw new N("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}function z(e,t,n,i,r){if(void 0===i&&(i=!0),void 0===r&&(r=!0),n&&!Array.isArray(t))throw new N("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=_(e));for(var s=new Array(t.length),a=0,o=t.length;a<o;a++)s[a]=B(e,t[a],n,!0,r,a),e=s[a].newDocument;return s.newDocument=e,s}function L(e,t,n){var i=B(e,t);if(!1===i.test)throw new N("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function P(e,t,n,i){if("object"!=typeof e||null===e||Array.isArray(e))throw new N("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!T[e.op])throw new N("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new N("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new N('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new N("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new N("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&D(e.value))throw new N("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var r=e.path.split("/").length,s=i.split("/").length;if(r!==s+1&&r!==s)throw new N("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==i)throw new N("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var a=j([{op:"_get",path:e.from,value:void 0}],n);if(a&&"OPERATION_PATH_UNRESOLVABLE"===a.name)throw new N("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function j(e,t,n){try{if(!Array.isArray(e))throw new N("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)z(_(t),_(e),n||!0);else{n=n||P;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(e){if(e instanceof N)return e;throw e}}function U(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,i,r,s=Array.isArray(e),a=Array.isArray(t);if(s&&a){if((i=e.length)!=t.length)return!1;for(n=i;0!=n--;)if(!U(e[n],t[n]))return!1;return!0}if(s!=a)return!1;var o=Object.keys(e);if((i=o.length)!==Object.keys(t).length)return!1;for(n=i;0!=n--;)if(!t.hasOwnProperty(o[n]))return!1;for(n=i;0!=n--;)if(!U(e[r=o[n]],t[r]))return!1;return!0}return e!=e&&t!=t}var W=new WeakMap,V=function(e){this.observers=new Map,this.obj=e},q=function(e,t){this.callback=e,this.observer=t};function G(e,t){t.unobserve()}function H(e,t){var n,i=function(e){return W.get(e)}(e);if(i){var r=function(e,t){return e.observers.get(t)}(i,t);n=r&&r.observer}else i=new V(e),W.set(e,i);if(n)return n;if(n={},i.value=_(e),t){n.callback=t,n.next=null;var s=function(){X(n)},a=function(){clearTimeout(n.next),n.next=setTimeout(s)};"undefined"!=typeof window&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return n.patches=[],n.object=e,n.unobserve=function(){X(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(i,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new q(t,n)),n}function X(e,t){void 0===t&&(t=!1);var n=W.get(e.object);Y(n.value,e.object,e.patches,"",t),e.patches.length&&z(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function Y(e,t,n,i,r){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var s=A(t),a=A(e),o=!1,u=a.length-1;u>=0;u--){var l=e[d=a[u]];if(!k(t,d)||void 0===t[d]&&void 0!==l&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+S(d),value:_(l)}),n.push({op:"remove",path:i+"/"+S(d)}),o=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}));else{var c=t[d];"object"==typeof l&&null!=l&&"object"==typeof c&&null!=c&&Array.isArray(l)===Array.isArray(c)?Y(l,c,n,i+"/"+S(d),r):l!==c&&(r&&n.push({op:"test",path:i+"/"+S(d),value:_(l)}),n.push({op:"replace",path:i+"/"+S(d),value:_(c)}))}}if(o||s.length!=a.length)for(u=0;u<s.length;u++){var d;k(e,d=s[u])||void 0===t[d]||n.push({op:"add",path:i+"/"+S(d),value:_(t[d])})}}}function K(e,t,n){void 0===n&&(n=!1);var i=[];return Y(e,t,i,"",n),i}Object.assign({},i,r,{JsonPatchError:O,deepClone:_,escapePathComponent:S,unescapePathComponent:F});var J=n(6058),Z=n.n(J),Q=n(7699);function ee(e,t,n){return e.fields=t||[],e.fname=n,e}function te(e){return null==e?null:e.fname}function ne(e){return null==e?null:e.fields}function ie(e){return 1===e.length?re(e[0]):se(e)}const re=e=>function(t){return t[e]},se=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function ae(e){throw Error(e)}function oe(e){const t=[],n=e.length;let i,r,s,a=null,o=0,u="";function l(){t.push(u+e.substring(i,r)),u="",i=r+1}for(e+="",i=r=0;r<n;++r)if(s=e[r],"\\"===s)u+=e.substring(i,r),u+=e.substring(++r,++r),i=r;else if(s===a)l(),a=null,o=-1;else{if(a)continue;i===o&&'"'===s||i===o&&"'"===s?(i=r+1,a=s):"."!==s||o?"["===s?(r>i&&l(),o=i=r+1):"]"===s&&(o||ae("Access path missing open bracket: "+e),o>0&&l(),o=0,i=r+1):r>i?l():i=r+1}return o&&ae("Access path missing closing bracket: "+e),a&&ae("Access path missing closing quote: "+e),r>i&&(r++,l()),t}function ue(e,t,n){const i=oe(e);return e=1===i.length?i[0]:e,ee((n&&n.get||ie)(i),[e],t||e)}const le=ue("id"),ce=ee((e=>e),[],"identity"),de=ee((()=>0),[],"zero"),he=ee((()=>1),[],"one"),fe=ee((()=>!0),[],"true"),pe=ee((()=>!1),[],"false");function me(e,t,n){const i=[t].concat([].slice.call(n));console[e].apply(console,i)}const ge=0,ye=1,ve=2,be=3,xe=4;function we(e,t){let n=e||ge;return{level(e){return arguments.length?(n=+e,this):n},error(){return n>=ye&&me(t||"error","ERROR",arguments),this},warn(){return n>=ve&&me(t||"warn","WARN",arguments),this},info(){return n>=be&&me(t||"log","INFO",arguments),this},debug(){return n>=xe&&me(t||"log","DEBUG",arguments),this}}}var Ce=Array.isArray;function ke(e){return e===Object(e)}const Ae=e=>"__proto__"!==e;function _e(...e){return e.reduce(((e,t)=>{for(const n in t)if("signals"===n)e.signals=Se(e.signals,t.signals);else{const i="legend"===n?{layout:1}:"style"===n||null;Ee(e,n,t[n],i)}return e}),{})}function Ee(e,t,n,i){if(!Ae(t))return;let r,s;if(ke(n)&&!Ce(n))for(r in s=ke(e[t])?e[t]:e[t]={},n)i&&(!0===i||i[r])?Ee(s,r,n[r]):Ae(r)&&(s[r]=n[r]);else e[t]=n}function Se(e,t){if(null==e)return t;const n={},i=[];function r(e){n[e.name]||(n[e.name]=1,i.push(e))}return t.forEach(r),e.forEach(r),i}function Fe(e){return e[e.length-1]}function De(e){return null==e||""===e?null:+e}const $e=e=>t=>e*Math.exp(t),Oe=e=>t=>Math.log(e*t),Ne=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),Ie=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,Te=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function Re(e,t,n,i){const r=n(e[0]),s=n(Fe(e)),a=(s-r)*t;return[i(r-a),i(s-a)]}function Me(e,t){return Re(e,t,De,ce)}function Be(e,t){var n=Math.sign(e[0]);return Re(e,t,Oe(n),$e(n))}function ze(e,t,n){return Re(e,t,Te(n),Te(1/n))}function Le(e,t,n){return Re(e,t,Ne(n),Ie(n))}function Pe(e,t,n,i,r){const s=i(e[0]),a=i(Fe(e)),o=null!=t?i(t):(s+a)/2;return[r(o+(s-o)*n),r(o+(a-o)*n)]}function je(e,t,n){return Pe(e,t,n,De,ce)}function Ue(e,t,n){const i=Math.sign(e[0]);return Pe(e,t,n,Oe(i),$e(i))}function We(e,t,n,i){return Pe(e,t,n,Te(i),Te(1/i))}function Ve(e,t,n,i){return Pe(e,t,n,Ne(i),Ie(i))}function qe(e){return 1+~~(new Date(e).getMonth()/3)}function Ge(e){return 1+~~(new Date(e).getUTCMonth()/3)}function He(e){return null!=e?Ce(e)?e:[e]:[]}function Xe(e,t,n){let i,r=e[0],s=e[1];return s<r&&(i=s,s=r,r=i),i=s-r,i>=n-t?[t,n]:[r=Math.min(Math.max(r,t),n-i),r+i]}function Ye(e){return"function"==typeof e}function Ke(e,t,n){n=n||{},t=He(t)||[];const i=[],r=[],s={},a=n.comparator||Ze;return He(e).forEach(((e,a)=>{null!=e&&(i.push("descending"===t[a]?-1:1),r.push(e=Ye(e)?e:ue(e,null,n)),(ne(e)||[]).forEach((e=>s[e]=1)))})),0===r.length?null:ee(a(r,i),Object.keys(s))}const Je=(e,t)=>(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0),Ze=(e,t)=>1===e.length?Qe(e[0],t[0]):et(e,t,e.length),Qe=(e,t)=>function(n,i){return Je(e(n),e(i))*t},et=(e,t,n)=>(t.push(0),function(i,r){let s,a=0,o=-1;for(;0===a&&++o<n;)s=e[o],a=Je(s(i),s(r));return a*t[o]});function tt(e){return Ye(e)?e:()=>e}function nt(e,t){let n;return i=>{n&&clearTimeout(n),n=setTimeout((()=>(t(i),n=null)),e)}}function it(e){for(let t,n,i=1,r=arguments.length;i<r;++i)for(n in t=arguments[i],t)e[n]=t[n];return e}function rt(e,t){let n,i,r,s,a=0;if(e&&(n=e.length))if(null==t){for(i=e[a];a<n&&(null==i||i!=i);i=e[++a]);for(r=s=i;a<n;++a)i=e[a],null!=i&&(i<r&&(r=i),i>s&&(s=i))}else{for(i=t(e[a]);a<n&&(null==i||i!=i);i=t(e[++a]));for(r=s=i;a<n;++a)i=t(e[a]),null!=i&&(i<r&&(r=i),i>s&&(s=i))}return[r,s]}function st(e,t){const n=e.length;let i,r,s,a,o,u=-1;if(null==t){for(;++u<n;)if(r=e[u],null!=r&&r>=r){i=s=r;break}if(u===n)return[-1,-1];for(a=o=u;++u<n;)r=e[u],null!=r&&(i>r&&(i=r,a=u),s<r&&(s=r,o=u))}else{for(;++u<n;)if(r=t(e[u],u,e),null!=r&&r>=r){i=s=r;break}if(u===n)return[-1,-1];for(a=o=u;++u<n;)r=t(e[u],u,e),null!=r&&(i>r&&(i=r,a=u),s<r&&(s=r,o=u))}return[a,o]}const at=Object.prototype.hasOwnProperty;function ot(e,t){return at.call(e,t)}const ut={};function lt(e){let t,n={};function i(e){return ot(n,e)&&n[e]!==ut}const r={size:0,empty:0,object:n,has:i,get:e=>i(e)?n[e]:void 0,set(e,t){return i(e)||(++r.size,n[e]===ut&&--r.empty),n[e]=t,this},delete(e){return i(e)&&(--r.size,++r.empty,n[e]=ut),this},clear(){r.size=r.empty=0,r.object=n={}},test(e){return arguments.length?(t=e,r):t},clean(){const e={};let i=0;for(const r in n){const s=n[r];s===ut||t&&t(s)||(e[r]=s,++i)}r.size=i,r.empty=0,r.object=n=e}};return e&&Object.keys(e).forEach((t=>{r.set(t,e[t])})),r}function ct(e,t,n,i,r,s){if(!n&&0!==n)return s;const a=+n;let o,u=e[0],l=Fe(e);l<u&&(o=u,u=l,l=o),o=Math.abs(t-u);const c=Math.abs(l-t);return o<c&&o<=a?i:c<=a?r:s}function dt(e,t,n){const i=e.prototype=Object.create(t.prototype);return Object.defineProperty(i,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),it(i,n)}function ht(e,t,n,i){let r,s=t[0],a=t[t.length-1];return s>a&&(r=s,s=a,a=r),i=void 0===i||i,((n=void 0===n||n)?s<=e:s<e)&&(i?e<=a:e<a)}function ft(e){return"boolean"==typeof e}function pt(e){return"[object Date]"===Object.prototype.toString.call(e)}function mt(e){return e&&Ye(e[Symbol.iterator])}function gt(e){return"number"==typeof e}function yt(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function vt(e){return"string"==typeof e}function bt(e,t,n){e&&(e=t?He(e).map((e=>e.replace(/\\(.)/g,"$1"))):He(e));const i=e&&e.length,r=n&&n.get||ie,s=e=>r(t?[e]:oe(e));let a;if(i)if(1===i){const t=s(e[0]);a=function(e){return""+t(e)}}else{const t=e.map(s);a=function(e){let n=""+t[0](e),r=0;for(;++r<i;)n+="|"+t[r](e);return n}}else a=function(){return""};return ee(a,e,"key")}function xt(e,t){const n=e[0],i=Fe(e),r=+t;return r?1===r?i:n+r*(i-n):n}function wt(e){let t,n,i;e=+e||1e4;const r=()=>{t={},n={},i=0},s=(r,s)=>(++i>e&&(n=t,t={},i=1),t[r]=s);return r(),{clear:r,has:e=>ot(t,e)||ot(n,e),get:e=>ot(t,e)?t[e]:ot(n,e)?s(e,n[e]):void 0,set:(e,n)=>ot(t,e)?t[e]=n:s(e,n)}}function Ct(e,t,n,i){const r=t.length,s=n.length;if(!s)return t;if(!r)return n;const a=i||new t.constructor(r+s);let o=0,u=0,l=0;for(;o<r&&u<s;++l)a[l]=e(t[o],n[u])>0?n[u++]:t[o++];for(;o<r;++o,++l)a[l]=t[o];for(;u<s;++u,++l)a[l]=n[u];return a}function kt(e,t){let n="";for(;--t>=0;)n+=e;return n}function At(e,t,n,i){const r=n||" ",s=e+"",a=t-s.length;return a<=0?s:"left"===i?kt(r,a)+s:"center"===i?kt(r,~~(a/2))+s+kt(r,Math.ceil(a/2)):s+kt(r,a)}function _t(e){return e&&Fe(e)-e[0]||0}function Et(e){return Ce(e)?"["+e.map(Et)+"]":ke(e)||vt(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function St(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e||!e)}const Ft=e=>gt(e)||pt(e)?e:Date.parse(e);function Dt(e,t){return t=t||Ft,null==e||""===e?null:t(e)}function $t(e){return null==e||""===e?null:e+""}function Ot(e){const t={},n=e.length;for(let i=0;i<n;++i)t[e[i]]=!0;return t}function Nt(e,t,n,i){const r=null!=i?i:"…",s=e+"",a=s.length,o=Math.max(0,t-r.length);return a<=t?s:"left"===n?r+s.slice(a-o):"center"===n?s.slice(0,Math.ceil(o/2))+r+s.slice(a-~~(o/2)):s.slice(0,o)+r}function It(e,t,n){if(e)if(t){const i=e.length;for(let r=0;r<i;++r){const i=t(e[r]);i&&n(i,r,e)}}else e.forEach(n)}function Tt(e,t,n){return e.fields=t||[],e.fname=n,e}function Rt(e){return null==e?null:e.fname}function Mt(e){return null==e?null:e.fields}function Bt(e){return 1===e.length?zt(e[0]):Lt(e)}const zt=e=>function(t){return t[e]},Lt=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function Pt(e){throw Error(e)}function jt(e){const t=[],n=e.length;let i,r,s,a=null,o=0,u="";function l(){t.push(u+e.substring(i,r)),u="",i=r+1}for(e+="",i=r=0;r<n;++r)if(s=e[r],"\\"===s)u+=e.substring(i,r),u+=e.substring(++r,++r),i=r;else if(s===a)l(),a=null,o=-1;else{if(a)continue;i===o&&'"'===s||i===o&&"'"===s?(i=r+1,a=s):"."!==s||o?"["===s?(r>i&&l(),o=i=r+1):"]"===s&&(o||Pt("Access path missing open bracket: "+e),o>0&&l(),o=0,i=r+1):r>i?l():i=r+1}return o&&Pt("Access path missing closing bracket: "+e),a&&Pt("Access path missing closing quote: "+e),r>i&&(r++,l()),t}function Ut(e,t,n){const i=jt(e);return e=1===i.length?i[0]:e,Tt((n&&n.get||Bt)(i),[e],t||e)}const Wt=Ut("id"),Vt=Tt((e=>e),[],"identity"),qt=Tt((()=>0),[],"zero"),Gt=Tt((()=>1),[],"one"),Ht=Tt((()=>!0),[],"true"),Xt=Tt((()=>!1),[],"false");function Yt(e,t,n){const i=[t].concat([].slice.call(n));console[e].apply(console,i)}function Kt(e,t,n=Yt){let i=e||0;return{level(e){return arguments.length?(i=+e,this):i},error(){return i>=1&&n(t||"error","ERROR",arguments),this},warn(){return i>=2&&n(t||"warn","WARN",arguments),this},info(){return i>=3&&n(t||"log","INFO",arguments),this},debug(){return i>=4&&n(t||"log","DEBUG",arguments),this}}}var Jt=Array.isArray;function Zt(e){return e===Object(e)}const Qt=e=>"__proto__"!==e;function en(e,t,n,i){if(!Qt(t))return;let r,s;if(Zt(n)&&!Jt(n))for(r in s=Zt(e[t])?e[t]:e[t]={},n)i&&(!0===i||i[r])?en(s,r,n[r]):Qt(r)&&(s[r]=n[r]);else e[t]=n}function tn(e,t){if(null==e)return t;const n={},i=[];function r(e){n[e.name]||(n[e.name]=1,i.push(e))}return t.forEach(r),e.forEach(r),i}function nn(e){return e[e.length-1]}function rn(e){return null==e||""===e?null:+e}const sn=e=>t=>e*Math.exp(t),an=e=>t=>Math.log(e*t),on=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),un=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,ln=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function cn(e,t,n,i){const r=n(e[0]),s=n(nn(e)),a=(s-r)*t;return[i(r-a),i(s-a)]}function dn(e,t,n,i,r){const s=i(e[0]),a=i(nn(e)),o=null!=t?i(t):(s+a)/2;return[r(o+(s-o)*n),r(o+(a-o)*n)]}function hn(e,t,n){return dn(e,t,n,rn,Vt)}function fn(e,t,n){const i=Math.sign(e[0]);return dn(e,t,n,an(i),sn(i))}function pn(e,t,n,i){return dn(e,t,n,ln(i),ln(1/i))}function mn(e,t,n,i){return dn(e,t,n,on(i),un(i))}function gn(e){return null!=e?Jt(e)?e:[e]:[]}function yn(e){return"function"==typeof e}function vn(e,t,n){n=n||{},t=gn(t)||[];const i=[],r=[],s={},a=n.comparator||xn;return gn(e).forEach(((e,a)=>{null!=e&&(i.push("descending"===t[a]?-1:1),r.push(e=yn(e)?e:Ut(e,null,n)),(Mt(e)||[]).forEach((e=>s[e]=1)))})),0===r.length?null:Tt(a(r,i),Object.keys(s))}const bn=(e,t)=>(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0),xn=(e,t)=>1===e.length?wn(e[0],t[0]):Cn(e,t,e.length),wn=(e,t)=>function(n,i){return bn(e(n),e(i))*t},Cn=(e,t,n)=>(t.push(0),function(i,r){let s,a=0,o=-1;for(;0===a&&++o<n;)s=e[o],a=bn(s(i),s(r));return a*t[o]});function kn(e){return yn(e)?e:()=>e}function An(e,t){let n;return i=>{n&&clearTimeout(n),n=setTimeout((()=>(t(i),n=null)),e)}}function _n(e){for(let t,n,i=1,r=arguments.length;i<r;++i)for(n in t=arguments[i],t)e[n]=t[n];return e}function En(e,t){let n,i,r,s,a=0;if(e&&(n=e.length))if(null==t){for(i=e[a];a<n&&(null==i||i!=i);i=e[++a]);for(r=s=i;a<n;++a)i=e[a],null!=i&&(i<r&&(r=i),i>s&&(s=i))}else{for(i=t(e[a]);a<n&&(null==i||i!=i);i=t(e[++a]));for(r=s=i;a<n;++a)i=t(e[a]),null!=i&&(i<r&&(r=i),i>s&&(s=i))}return[r,s]}const Sn=Object.prototype.hasOwnProperty;function Fn(e,t){return Sn.call(e,t)}const Dn={};function $n(e){let t,n={};function i(e){return Fn(n,e)&&n[e]!==Dn}const r={size:0,empty:0,object:n,has:i,get:e=>i(e)?n[e]:void 0,set(e,t){return i(e)||(++r.size,n[e]===Dn&&--r.empty),n[e]=t,this},delete(e){return i(e)&&(--r.size,++r.empty,n[e]=Dn),this},clear(){r.size=r.empty=0,r.object=n={}},test(e){return arguments.length?(t=e,r):t},clean(){const e={};let i=0;for(const r in n){const s=n[r];s===Dn||t&&t(s)||(e[r]=s,++i)}r.size=i,r.empty=0,r.object=n=e}};return e&&Object.keys(e).forEach((t=>{r.set(t,e[t])})),r}function On(e,t,n){const i=e.prototype=Object.create(t.prototype);return Object.defineProperty(i,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),_n(i,n)}function Nn(e,t,n,i){let r,s=t[0],a=t[t.length-1];return s>a&&(r=s,s=a,a=r),i=void 0===i||i,((n=void 0===n||n)?s<=e:s<e)&&(i?e<=a:e<a)}function In(e){return"[object Date]"===Object.prototype.toString.call(e)}function Tn(e){return"number"==typeof e}function Rn(e){return"string"==typeof e}function Mn(e,t,n){e&&(e=t?gn(e).map((e=>e.replace(/\\(.)/g,"$1"))):gn(e));const i=e&&e.length,r=n&&n.get||Bt,s=e=>r(t?[e]:jt(e));let a;if(i)if(1===i){const t=s(e[0]);a=function(e){return""+t(e)}}else{const t=e.map(s);a=function(e){let n=""+t[0](e),r=0;for(;++r<i;)n+="|"+t[r](e);return n}}else a=function(){return""};return Tt(a,e,"key")}function Bn(e,t){let n="";for(;--t>=0;)n+=e;return n}function zn(e){return e&&nn(e)-e[0]||0}function Ln(e){return Jt(e)?"["+e.map(Ln)+"]":Zt(e)||Rn(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Pn(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e||!e)}const jn=e=>Tn(e)||In(e)?e:Date.parse(e);function Un(e,t){return t=t||jn,null==e||""===e?null:t(e)}function Wn(e){return null==e||""===e?null:e+""}function Vn(e){const t={},n=e.length;for(let i=0;i<n;++i)t[e[i]]=!0;return t}function qn(e,t,n){if(e)if(t){const i=e.length;for(let r=0;r<i;++r){const i=t(e[r]);i&&n(i,r,e)}}else e.forEach(n)}var Gn={},Hn={};function Xn(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function Yn(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var i in e)i in t||n.push(t[i]=i)})),n}function Kn(e,t){var n=e+"",i=n.length;return i<t?new Array(t-i+1).join(0)+n:n}function Jn(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function i(e,t){var i,r=[],s=e.length,a=0,o=0,u=s<=0,l=!1;function c(){if(u)return Hn;if(l)return l=!1,Gn;var t,i,r=a;if(34===e.charCodeAt(r)){for(;a++<s&&34!==e.charCodeAt(a)||34===e.charCodeAt(++a););return(t=a)>=s?u=!0:10===(i=e.charCodeAt(a++))?l=!0:13===i&&(l=!0,10===e.charCodeAt(a)&&++a),e.slice(r+1,t-1).replace(/""/g,'"')}for(;a<s;){if(10===(i=e.charCodeAt(t=a++)))l=!0;else if(13===i)l=!0,10===e.charCodeAt(a)&&++a;else if(i!==n)continue;return e.slice(r,t)}return u=!0,e.slice(r,s)}for(10===e.charCodeAt(s-1)&&--s,13===e.charCodeAt(s-1)&&--s;(i=c())!==Hn;){for(var d=[];i!==Gn&&i!==Hn;)d.push(i),i=c();t&&null==(d=t(d,o++))||r.push(d)}return r}function r(t,n){return t.map((function(t){return n.map((function(e){return a(t[e])})).join(e)}))}function s(t){return t.map(a).join(e)}function a(e){return null==e?"":e instanceof Date?function(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+Kn(-e,6):e>9999?"+"+Kn(e,6):Kn(e,4)}(e.getUTCFullYear())+"-"+Kn(e.getUTCMonth()+1,2)+"-"+Kn(e.getUTCDate(),2)+(r?"T"+Kn(t,2)+":"+Kn(n,2)+":"+Kn(i,2)+"."+Kn(r,3)+"Z":i?"T"+Kn(t,2)+":"+Kn(n,2)+":"+Kn(i,2)+"Z":n||t?"T"+Kn(t,2)+":"+Kn(n,2)+"Z":"")}(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,r,s=i(e,(function(e,i){if(n)return n(e,i-1);r=e,n=t?function(e,t){var n=Xn(e);return function(i,r){return t(n(i),r,e)}}(e,t):Xn(e)}));return s.columns=r||[],s},parseRows:i,format:function(t,n){return null==n&&(n=Yn(t)),[n.map(a).join(e)].concat(r(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=Yn(e)),r(e,t).join("\n")},formatRows:function(e){return e.map(s).join("\n")},formatRow:s,formatValue:a}}function Zn(e){return e}function Qn(e,t){return"string"==typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return ei(e,t)}))}:ei(e,t)}function ei(e,t){var n=t.id,i=t.bbox,r=null==t.properties?{}:t.properties,s=ti(e,t);return null==n&&null==i?{type:"Feature",properties:r,geometry:s}:null==i?{type:"Feature",id:n,properties:r,geometry:s}:{type:"Feature",id:n,bbox:i,properties:r,geometry:s}}function ti(e,t){var n=function(e){if(null==e)return Zn;var t,n,i=e.scale[0],r=e.scale[1],s=e.translate[0],a=e.translate[1];return function(e,o){o||(t=n=0);var u=2,l=e.length,c=new Array(l);for(c[0]=(t+=e[0])*i+s,c[1]=(n+=e[1])*r+a;u<l;)c[u]=e[u],++u;return c}}(e.transform),i=e.arcs;function r(e,t){t.length&&t.pop();for(var r=i[e<0?~e:e],s=0,a=r.length;s<a;++s)t.push(n(r[s],s));e<0&&function(e,t){for(var n,i=e.length,r=i-t;r<--i;)n=e[r],e[r++]=e[i],e[i]=n}(t,a)}function s(e){return n(e)}function a(e){for(var t=[],n=0,i=e.length;n<i;++n)r(e[n],t);return t.length<2&&t.push(t[0]),t}function o(e){for(var t=a(e);t.length<4;)t.push(t[0]);return t}function u(e){return e.map(o)}return function e(t){var n,i=t.type;switch(i){case"GeometryCollection":return{type:i,geometries:t.geometries.map(e)};case"Point":n=s(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(s);break;case"LineString":n=a(t.arcs);break;case"MultiLineString":n=t.arcs.map(a);break;case"Polygon":n=u(t.arcs);break;case"MultiPolygon":n=t.arcs.map(u);break;default:return null}return{type:i,coordinates:n}}(t)}function ni(e,t){var n={},i={},r={},s=[],a=-1;function o(e,t){for(var i in e){var r=e[i];delete t[r.start],delete r.start,delete r.end,r.forEach((function(e){n[e<0?~e:e]=1})),s.push(r)}}return t.forEach((function(n,i){var r,s=e.arcs[n<0?~n:n];s.length<3&&!s[1][0]&&!s[1][1]&&(r=t[++a],t[a]=n,t[i]=r)})),t.forEach((function(t){var n,s,a=function(t){var n,i=e.arcs[t<0?~t:t],r=i[0];return e.transform?(n=[0,0],i.forEach((function(e){n[0]+=e[0],n[1]+=e[1]}))):n=i[i.length-1],t<0?[n,r]:[r,n]}(t),o=a[0],u=a[1];if(n=r[o])if(delete r[n.end],n.push(t),n.end=u,s=i[u]){delete i[s.start];var l=s===n?n:n.concat(s);i[l.start=n.start]=r[l.end=s.end]=l}else i[n.start]=r[n.end]=n;else if(n=i[u])if(delete i[n.start],n.unshift(t),n.start=o,s=r[o]){delete r[s.end];var c=s===n?n:s.concat(n);i[c.start=s.start]=r[c.end=n.end]=c}else i[n.start]=r[n.end]=n;else i[(n=[t]).start=o]=r[n.end=u]=n})),o(r,i),o(i,r),t.forEach((function(e){n[e<0?~e:e]||s.push([e])})),s}function ii(e){return ti(e,ri.apply(this,arguments))}function ri(e,t,n){var i,r,s;if(arguments.length>1)i=si(0,t,n);else for(r=0,i=new Array(s=e.arcs.length);r<s;++r)i[r]=r;return{type:"MultiLineString",arcs:ni(e,i)}}function si(e,t,n){var i,r=[],s=[];function a(e){var t=e<0?~e:e;(s[t]||(s[t]=[])).push({i:e,g:i})}function o(e){e.forEach(a)}function u(e){e.forEach(o)}return function e(t){switch(i=t,t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":o(t.arcs);break;case"MultiLineString":case"Polygon":u(t.arcs);break;case"MultiPolygon":!function(e){e.forEach(u)}(t.arcs)}}(t),s.forEach(null==n?function(e){r.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&r.push(e[0].i)}),r}var ai=Math.sqrt(50),oi=Math.sqrt(10),ui=Math.sqrt(2);function li(e,t,n){var i,r,s,a,o=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((i=t<e)&&(r=e,e=t,t=r),0===(a=ci(e,t,n))||!isFinite(a))return[];if(a>0){let n=Math.round(e/a),i=Math.round(t/a);for(n*a<e&&++n,i*a>t&&--i,s=new Array(r=i-n+1);++o<r;)s[o]=(n+o)*a}else{a=-a;let n=Math.round(e*a),i=Math.round(t*a);for(n/a<e&&++n,i/a>t&&--i,s=new Array(r=i-n+1);++o<r;)s[o]=(n+o)/a}return i&&s.reverse(),s}function ci(e,t,n){var i=(t-e)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),s=i/Math.pow(10,r);return r>=0?(s>=ai?10:s>=oi?5:s>=ui?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(s>=ai?10:s>=oi?5:s>=ui?2:1)}function di(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),s=i/r;return s>=ai?r*=10:s>=oi?r*=5:s>=ui&&(r*=2),t<e?-r:r}var hi,fi=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function pi(e){if(!(t=fi.exec(e)))throw new Error("invalid format: "+e);var t;return new mi({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function mi(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function gi(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function yi(e){return(e=gi(Math.abs(e)))?e[1]:NaN}function vi(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(yi(t)/3)))-yi(Math.abs(e)))}function bi(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,yi(t)-yi(e))+1}function xi(e){return Math.max(0,-yi(Math.abs(e)))}function wi(e,t){var n=gi(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}pi.prototype=mi.prototype,mi.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Ci={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>wi(100*e,t),r:wi,s:function(e,t){var n=gi(e,t);if(!n)return e+"";var i=n[0],r=n[1],s=r-(hi=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,a=i.length;return s===a?i:s>a?i+new Array(s-a+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+gi(e,Math.max(0,t+s-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function ki(e){return e}var Ai,_i,Ei,Si=Array.prototype.map,Fi=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Di(e){var t,n,i=void 0===e.grouping||void 0===e.thousands?ki:(t=Si.call(e.grouping,Number),n=e.thousands+"",function(e,i){for(var r=e.length,s=[],a=0,o=t[0],u=0;r>0&&o>0&&(u+o+1>i&&(o=Math.max(1,i-u)),s.push(e.substring(r-=o,r+o)),!((u+=o+1)>i));)o=t[a=(a+1)%t.length];return s.reverse().join(n)}),r=void 0===e.currency?"":e.currency[0]+"",s=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",o=void 0===e.numerals?ki:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Si.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"−":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=pi(e)).fill,n=e.align,d=e.sign,h=e.symbol,f=e.zero,p=e.width,m=e.comma,g=e.precision,y=e.trim,v=e.type;"n"===v?(m=!0,v="g"):Ci[v]||(void 0===g&&(g=12),y=!0,v="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var b="$"===h?r:"#"===h&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===h?s:/[%p]/.test(v)?u:"",w=Ci[v],C=/[defgprs%]/.test(v);function k(e){var r,s,u,h=b,k=x;if("c"===v)k=w(e)+k,e="";else{var A=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:w(Math.abs(e),g),y&&(e=function(e){e:for(var t,n=e.length,i=1,r=-1;i<n;++i)switch(e[i]){case".":r=t=i;break;case"0":0===r&&(r=i),t=i;break;default:if(!+e[i])break e;r>0&&(r=0)}return r>0?e.slice(0,r)+e.slice(t+1):e}(e)),A&&0==+e&&"+"!==d&&(A=!1),h=(A?"("===d?d:l:"-"===d||"("===d?"":d)+h,k=("s"===v?Fi[8+hi/3]:"")+k+(A&&"("===d?")":""),C)for(r=-1,s=e.length;++r<s;)if(48>(u=e.charCodeAt(r))||u>57){k=(46===u?a+e.slice(r+1):e.slice(r))+k,e=e.slice(0,r);break}}m&&!f&&(e=i(e,1/0));var _=h.length+e.length+k.length,E=_<p?new Array(p-_+1).join(t):"";switch(m&&f&&(e=i(E+e,E.length?p-k.length:1/0),E=""),n){case"<":e=h+e+k+E;break;case"=":e=h+E+e+k;break;case"^":e=E.slice(0,_=E.length>>1)+h+e+k+E.slice(_);break;default:e=E+h+e+k}return o(e)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),k.toString=function(){return e+""},k}return{format:d,formatPrefix:function(e,t){var n=d(((e=pi(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor(yi(t)/3))),r=Math.pow(10,-i),s=Fi[8+i/3];return function(e){return n(r*e)+s}}}}Ai=Di({thousands:",",grouping:[3],currency:["$",""]}),_i=Ai.format,Ei=Ai.formatPrefix;var $i=new Date,Oi=new Date;function Ni(e,t,n,i){function r(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return r.floor=function(t){return e(t=new Date(+t)),t},r.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},r.round=function(e){var t=r(e),n=r.ceil(e);return e-t<n-e?t:n},r.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},r.range=function(n,i,s){var a,o=[];if(n=r.ceil(n),s=null==s?1:Math.floor(s),!(n<i&&s>0))return o;do{o.push(a=new Date(+n)),t(n,s),e(n)}while(a<n&&n<i);return o},r.filter=function(n){return Ni((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,i){if(e>=e)if(i<0)for(;++i<=0;)for(;t(e,-1),!n(e););else for(;--i>=0;)for(;t(e,1),!n(e););}))},n&&(r.count=function(t,i){return $i.setTime(+t),Oi.setTime(+i),e($i),e(Oi),Math.floor(n($i,Oi))},r.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?r.filter(i?function(t){return i(t)%e==0}:function(t){return r.count(0,t)%e==0}):r:null}),r}const Ii=1e3,Ti=6e4,Ri=36e5,Mi=864e5,Bi=6048e5,zi=31536e6;var Li=Ni((e=>e.setHours(0,0,0,0)),((e,t)=>e.setDate(e.getDate()+t)),((e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ti)/Mi),(e=>e.getDate()-1));const Pi=Li;function ji(e){return Ni((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ti)/Bi}))}Li.range;var Ui=ji(0),Wi=ji(1),Vi=ji(2),qi=ji(3),Gi=ji(4),Hi=ji(5),Xi=ji(6),Yi=(Ui.range,Wi.range,Vi.range,qi.range,Gi.range,Hi.range,Xi.range,Ni((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/Mi}),(function(e){return e.getUTCDate()-1})));const Ki=Yi;function Ji(e){return Ni((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/Bi}))}Yi.range;var Zi=Ji(0),Qi=Ji(1),er=Ji(2),tr=Ji(3),nr=Ji(4),ir=Ji(5),rr=Ji(6),sr=(Zi.range,Qi.range,er.range,tr.range,nr.range,ir.range,rr.range,Ni((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()})));sr.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Ni((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};const ar=sr;sr.range;var or=Ni((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}));const ur=or;or.range;var lr=Ni((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ii-e.getMinutes()*Ti)}),(function(e,t){e.setTime(+e+t*Ri)}),(function(e,t){return(t-e)/Ri}),(function(e){return e.getHours()}));const cr=lr;lr.range;var dr=Ni((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ii)}),(function(e,t){e.setTime(+e+t*Ti)}),(function(e,t){return(t-e)/Ti}),(function(e){return e.getMinutes()}));const hr=dr;dr.range;var fr=Ni((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*Ii)}),(function(e,t){return(t-e)/Ii}),(function(e){return e.getUTCSeconds()}));const pr=fr;fr.range;var mr=Ni((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));mr.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?Ni((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):mr:null};const gr=mr;mr.range;var yr=Ni((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));yr.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Ni((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};const vr=yr;yr.range;var br=Ni((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()}));const xr=br;br.range;var wr=Ni((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*Ri)}),(function(e,t){return(t-e)/Ri}),(function(e){return e.getUTCHours()}));const Cr=wr;wr.range;var kr=Ni((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*Ti)}),(function(e,t){return(t-e)/Ti}),(function(e){return e.getUTCMinutes()}));const Ar=kr;function _r(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Er(e){let t=e,n=e;function i(e,t,i,r){for(null==i&&(i=0),null==r&&(r=e.length);i<r;){const s=i+r>>>1;n(e[s],t)<0?i=s+1:r=s}return i}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>_r(e(t),n)}(e)),{left:i,center:function(e,n,r,s){null==r&&(r=0),null==s&&(s=e.length);const a=i(e,n,r,s-1);return a>r&&t(e[a-1],n)>-t(e[a],n)?a-1:a},right:function(e,t,i,r){for(null==i&&(i=0),null==r&&(r=e.length);i<r;){const s=i+r>>>1;n(e[s],t)>0?r=s:i=s+1}return i}}}kr.range;const Sr="year",Fr="quarter",Dr="month",$r="week",Or="date",Nr="day",Ir="dayofyear",Tr="hours",Rr="minutes",Mr="seconds",Br="milliseconds",zr=[Sr,Fr,Dr,$r,Or,Nr,Ir,Tr,Rr,Mr,Br],Lr=zr.reduce(((e,t,n)=>(e[t]=1+n,e)),{});function Pr(e){const t=gn(e).slice(),n={};return t.length||Pt("Missing time unit."),t.forEach((e=>{Fn(Lr,e)?n[e]=1:Pt("Invalid time unit: ".concat(e,"."))})),(n[$r]||n[Nr]?1:0)+(n[Fr]||n[Dr]||n[Or]?1:0)+(n[Ir]?1:0)>1&&Pt("Incompatible time units: ".concat(e)),t.sort(((e,t)=>Lr[e]-Lr[t])),t}const jr={[Sr]:"%Y ",[Fr]:"Q%q ",[Dr]:"%b ",[Or]:"%d ",[$r]:"W%U ",[Nr]:"%a ",[Ir]:"%j ",[Tr]:"%H:00",[Rr]:"00:%M",[Mr]:":%S",[Br]:".%L",["".concat(Sr,"-").concat(Dr)]:"%Y-%m ",["".concat(Sr,"-").concat(Dr,"-").concat(Or)]:"%Y-%m-%d ",["".concat(Tr,"-").concat(Rr)]:"%H:%M"};function Ur(e,t){const n=_n({},jr,t),i=Pr(e),r=i.length;let s,a,o="",u=0;for(u=0;u<r;)for(s=i.length;s>u;--s)if(a=i.slice(u,s).join("-"),null!=n[a]){o+=n[a],u=s;break}return o.trim()}const Wr=new Date;function Vr(e){return Wr.setFullYear(e),Wr.setMonth(0),Wr.setDate(1),Wr.setHours(0,0,0,0),Wr}function qr(e){return Hr(new Date(e))}function Gr(e){return Xr(new Date(e))}function Hr(e){return Pi.count(Vr(e.getFullYear())-1,e)}function Xr(e){return Ui.count(Vr(e.getFullYear())-1,e)}function Yr(e){return Vr(e).getDay()}function Kr(e,t,n,i,r,s,a){if(0<=e&&e<100){const o=new Date(-1,t,n,i,r,s,a);return o.setFullYear(e),o}return new Date(e,t,n,i,r,s,a)}function Jr(e){return Qr(new Date(e))}function Zr(e){return es(new Date(e))}function Qr(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Ki.count(t-1,e)}function es(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Zi.count(t-1,e)}function ts(e){return Wr.setTime(Date.UTC(e,0,1)),Wr.getUTCDay()}function ns(e,t,n,i,r,s,a){if(0<=e&&e<100){const e=new Date(Date.UTC(-1,t,n,i,r,s,a));return e.setUTCFullYear(n.y),e}return new Date(Date.UTC(e,t,n,i,r,s,a))}function is(e,t,n,i,r){const s=t||1,a=nn(e),o=(e,t,r)=>function(e,t,n,i){const r=n<=1?e:i?(t,r)=>i+n*Math.floor((e(t,r)-i)/n):(t,i)=>n*Math.floor(e(t,i)/n);return t?(e,n)=>t(r(e,n),n):r}(n[r=r||e],i[r],e===a&&s,t),u=new Date,l=Vn(e),c=l[Sr]?o(Sr):kn(2012),d=l[Dr]?o(Dr):l[Fr]?o(Fr):qt,h=l[$r]&&l[Nr]?o(Nr,1,$r+Nr):l[$r]?o($r,1):l[Nr]?o(Nr,1):l[Or]?o(Or,1):l[Ir]?o(Ir,1):Gt,f=l[Tr]?o(Tr):qt,p=l[Rr]?o(Rr):qt,m=l[Mr]?o(Mr):qt,g=l[Br]?o(Br):qt;return function(e){u.setTime(+e);const t=c(u);return r(t,d(u),h(u,t),f(u),p(u),m(u),g(u))}}function rs(e,t,n){return t+7*e-(n+6)%7}const ss={[Sr]:e=>e.getFullYear(),[Fr]:e=>Math.floor(e.getMonth()/3),[Dr]:e=>e.getMonth(),[Or]:e=>e.getDate(),[Tr]:e=>e.getHours(),[Rr]:e=>e.getMinutes(),[Mr]:e=>e.getSeconds(),[Br]:e=>e.getMilliseconds(),[Ir]:e=>Hr(e),[$r]:e=>Xr(e),[$r+Nr]:(e,t)=>rs(Xr(e),e.getDay(),Yr(t)),[Nr]:(e,t)=>rs(1,e.getDay(),Yr(t))},as={[Fr]:e=>3*e,[$r]:(e,t)=>rs(e,0,Yr(t))};function os(e,t){return is(e,t||1,ss,as,Kr)}const us={[Sr]:e=>e.getUTCFullYear(),[Fr]:e=>Math.floor(e.getUTCMonth()/3),[Dr]:e=>e.getUTCMonth(),[Or]:e=>e.getUTCDate(),[Tr]:e=>e.getUTCHours(),[Rr]:e=>e.getUTCMinutes(),[Mr]:e=>e.getUTCSeconds(),[Br]:e=>e.getUTCMilliseconds(),[Ir]:e=>Qr(e),[$r]:e=>es(e),[Nr]:(e,t)=>rs(1,e.getUTCDay(),ts(t)),[$r+Nr]:(e,t)=>rs(es(e),e.getUTCDay(),ts(t))},ls={[Fr]:e=>3*e,[$r]:(e,t)=>rs(e,0,ts(t))};function cs(e,t){return is(e,t||1,us,ls,ns)}const ds={[Sr]:ar,[Fr]:ur.every(3),[Dr]:ur,[$r]:Ui,[Or]:Pi,[Nr]:Pi,[Ir]:Pi,[Tr]:cr,[Rr]:hr,[Mr]:pr,[Br]:gr},hs={[Sr]:vr,[Fr]:xr.every(3),[Dr]:xr,[$r]:Zi,[Or]:Ki,[Nr]:Ki,[Ir]:Ki,[Tr]:Cr,[Rr]:Ar,[Mr]:pr,[Br]:gr};function fs(e){return ds[e]}function ps(e){return hs[e]}function ms(e,t,n){return e?e.offset(t,n):void 0}function gs(e,t,n){return ms(fs(e),t,n)}function ys(e,t,n){return ms(ps(e),t,n)}function vs(e,t,n,i){return e?e.range(t,n,i):void 0}function bs(e,t,n,i){return vs(fs(e),t,n,i)}function xs(e,t,n,i){return vs(ps(e),t,n,i)}const ws=31536e6,Cs=[Sr,Dr,Or,Tr,Rr,Mr,Br],ks=Cs.slice(0,-1),As=ks.slice(0,-1),_s=As.slice(0,-1),Es=_s.slice(0,-1),Ss=[Sr,Dr],Fs=[Sr],Ds=[[ks,1,1e3],[ks,5,5e3],[ks,15,15e3],[ks,30,3e4],[As,1,6e4],[As,5,3e5],[As,15,9e5],[As,30,18e5],[_s,1,36e5],[_s,3,108e5],[_s,6,216e5],[_s,12,432e5],[Es,1,864e5],[[Sr,$r],1,6048e5],[Ss,1,2592e6],[Ss,3,7776e6],[Fs,1,ws]];function $s(e){const t=e.extent,n=e.maxbins||40,i=Math.abs(zn(t))/n;let r,s,a=Er((e=>e[2])).right(Ds,i);return a===Ds.length?(r=Fs,s=di(t[0]/ws,t[1]/ws,n)):a?(a=Ds[i/Ds[a-1][2]<Ds[a][2]/i?a-1:a],r=a[0],s=a[1]):(r=Cs,s=Math.max(di(t[0],t[1],n),1)),{units:r,step:s}}function Os(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Ns(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Is(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function Ts(e){var t=e.dateTime,n=e.date,i=e.time,r=e.periods,s=e.days,a=e.shortDays,o=e.months,u=e.shortMonths,l=Gs(r),c=Hs(r),d=Gs(s),h=Hs(s),f=Gs(a),p=Hs(a),m=Gs(o),g=Hs(o),y=Gs(u),v=Hs(u),b={a:function(e){return a[e.getDay()]},A:function(e){return s[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return o[e.getMonth()]},c:null,d:pa,e:pa,f:ba,g:$a,G:Na,H:ma,I:ga,j:ya,L:va,m:xa,M:wa,p:function(e){return r[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:to,s:no,S:Ca,u:ka,U:Aa,V:Ea,w:Sa,W:Fa,x:null,X:null,y:Da,Y:Oa,Z:Ia,"%":eo},x={a:function(e){return a[e.getUTCDay()]},A:function(e){return s[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return o[e.getUTCMonth()]},c:null,d:Ta,e:Ta,f:La,g:Ka,G:Za,H:Ra,I:Ma,j:Ba,L:za,m:Pa,M:ja,p:function(e){return r[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:to,s:no,S:Ua,u:Wa,U:Va,V:Ga,w:Ha,W:Xa,x:null,X:null,y:Ya,Y:Ja,Z:Qa,"%":eo},w={a:function(e,t,n){var i=f.exec(t.slice(n));return i?(e.w=p.get(i[0].toLowerCase()),n+i[0].length):-1},A:function(e,t,n){var i=d.exec(t.slice(n));return i?(e.w=h.get(i[0].toLowerCase()),n+i[0].length):-1},b:function(e,t,n){var i=y.exec(t.slice(n));return i?(e.m=v.get(i[0].toLowerCase()),n+i[0].length):-1},B:function(e,t,n){var i=m.exec(t.slice(n));return i?(e.m=g.get(i[0].toLowerCase()),n+i[0].length):-1},c:function(e,n,i){return A(e,t,n,i)},d:ra,e:ra,f:ca,g:ea,G:Qs,H:aa,I:aa,j:sa,L:la,m:ia,M:oa,p:function(e,t,n){var i=l.exec(t.slice(n));return i?(e.p=c.get(i[0].toLowerCase()),n+i[0].length):-1},q:na,Q:ha,s:fa,S:ua,u:Ys,U:Ks,V:Js,w:Xs,W:Zs,x:function(e,t,i){return A(e,n,t,i)},X:function(e,t,n){return A(e,i,t,n)},y:ea,Y:Qs,Z:ta,"%":da};function C(e,t){return function(n){var i,r,s,a=[],o=-1,u=0,l=e.length;for(n instanceof Date||(n=new Date(+n));++o<l;)37===e.charCodeAt(o)&&(a.push(e.slice(u,o)),null!=(r=Ps[i=e.charAt(++o)])?i=e.charAt(++o):r="e"===i?" ":"0",(s=t[i])&&(i=s(n,r)),a.push(i),u=o+1);return a.push(e.slice(u,o)),a.join("")}}function k(e,t){return function(n){var i,r,s=Is(1900,void 0,1);if(A(s,e,n+="",0)!=n.length)return null;if("Q"in s)return new Date(s.Q);if("s"in s)return new Date(1e3*s.s+("L"in s?s.L:0));if(t&&!("Z"in s)&&(s.Z=0),"p"in s&&(s.H=s.H%12+12*s.p),void 0===s.m&&(s.m="q"in s?s.q:0),"V"in s){if(s.V<1||s.V>53)return null;"w"in s||(s.w=1),"Z"in s?(r=(i=Ns(Is(s.y,0,1))).getUTCDay(),i=r>4||0===r?Qi.ceil(i):Qi(i),i=Ki.offset(i,7*(s.V-1)),s.y=i.getUTCFullYear(),s.m=i.getUTCMonth(),s.d=i.getUTCDate()+(s.w+6)%7):(r=(i=Os(Is(s.y,0,1))).getDay(),i=r>4||0===r?Wi.ceil(i):Wi(i),i=Pi.offset(i,7*(s.V-1)),s.y=i.getFullYear(),s.m=i.getMonth(),s.d=i.getDate()+(s.w+6)%7)}else("W"in s||"U"in s)&&("w"in s||(s.w="u"in s?s.u%7:"W"in s?1:0),r="Z"in s?Ns(Is(s.y,0,1)).getUTCDay():Os(Is(s.y,0,1)).getDay(),s.m=0,s.d="W"in s?(s.w+6)%7+7*s.W-(r+5)%7:s.w+7*s.U-(r+6)%7);return"Z"in s?(s.H+=s.Z/100|0,s.M+=s.Z%100,Ns(s)):Os(s)}}function A(e,t,n,i){for(var r,s,a=0,o=t.length,u=n.length;a<o;){if(i>=u)return-1;if(37===(r=t.charCodeAt(a++))){if(r=t.charAt(a++),!(s=w[r in Ps?t.charAt(a++):r])||(i=s(e,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}return b.x=C(n,b),b.X=C(i,b),b.c=C(t,b),x.x=C(n,x),x.X=C(i,x),x.c=C(t,x),{format:function(e){var t=C(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=k(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=C(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=k(e+="",!0);return t.toString=function(){return e},t}}}var Rs,Ms,Bs,zs,Ls,Ps={"-":"",_:" ",0:"0"},js=/^\s*\d+/,Us=/^%/,Ws=/[\\^$*+?|[\]().{}]/g;function Vs(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",s=r.length;return i+(s<n?new Array(n-s+1).join(t)+r:r)}function qs(e){return e.replace(Ws,"\\$&")}function Gs(e){return new RegExp("^(?:"+e.map(qs).join("|")+")","i")}function Hs(e){return new Map(e.map(((e,t)=>[e.toLowerCase(),t])))}function Xs(e,t,n){var i=js.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function Ys(e,t,n){var i=js.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function Ks(e,t,n){var i=js.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function Js(e,t,n){var i=js.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function Zs(e,t,n){var i=js.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function Qs(e,t,n){var i=js.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function ea(e,t,n){var i=js.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function ta(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function na(e,t,n){var i=js.exec(t.slice(n,n+1));return i?(e.q=3*i[0]-3,n+i[0].length):-1}function ia(e,t,n){var i=js.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function ra(e,t,n){var i=js.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function sa(e,t,n){var i=js.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function aa(e,t,n){var i=js.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function oa(e,t,n){var i=js.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function ua(e,t,n){var i=js.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function la(e,t,n){var i=js.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function ca(e,t,n){var i=js.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function da(e,t,n){var i=Us.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function ha(e,t,n){var i=js.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function fa(e,t,n){var i=js.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function pa(e,t){return Vs(e.getDate(),t,2)}function ma(e,t){return Vs(e.getHours(),t,2)}function ga(e,t){return Vs(e.getHours()%12||12,t,2)}function ya(e,t){return Vs(1+Pi.count(ar(e),e),t,3)}function va(e,t){return Vs(e.getMilliseconds(),t,3)}function ba(e,t){return va(e,t)+"000"}function xa(e,t){return Vs(e.getMonth()+1,t,2)}function wa(e,t){return Vs(e.getMinutes(),t,2)}function Ca(e,t){return Vs(e.getSeconds(),t,2)}function ka(e){var t=e.getDay();return 0===t?7:t}function Aa(e,t){return Vs(Ui.count(ar(e)-1,e),t,2)}function _a(e){var t=e.getDay();return t>=4||0===t?Gi(e):Gi.ceil(e)}function Ea(e,t){return e=_a(e),Vs(Gi.count(ar(e),e)+(4===ar(e).getDay()),t,2)}function Sa(e){return e.getDay()}function Fa(e,t){return Vs(Wi.count(ar(e)-1,e),t,2)}function Da(e,t){return Vs(e.getFullYear()%100,t,2)}function $a(e,t){return Vs((e=_a(e)).getFullYear()%100,t,2)}function Oa(e,t){return Vs(e.getFullYear()%1e4,t,4)}function Na(e,t){var n=e.getDay();return Vs((e=n>=4||0===n?Gi(e):Gi.ceil(e)).getFullYear()%1e4,t,4)}function Ia(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Vs(t/60|0,"0",2)+Vs(t%60,"0",2)}function Ta(e,t){return Vs(e.getUTCDate(),t,2)}function Ra(e,t){return Vs(e.getUTCHours(),t,2)}function Ma(e,t){return Vs(e.getUTCHours()%12||12,t,2)}function Ba(e,t){return Vs(1+Ki.count(vr(e),e),t,3)}function za(e,t){return Vs(e.getUTCMilliseconds(),t,3)}function La(e,t){return za(e,t)+"000"}function Pa(e,t){return Vs(e.getUTCMonth()+1,t,2)}function ja(e,t){return Vs(e.getUTCMinutes(),t,2)}function Ua(e,t){return Vs(e.getUTCSeconds(),t,2)}function Wa(e){var t=e.getUTCDay();return 0===t?7:t}function Va(e,t){return Vs(Zi.count(vr(e)-1,e),t,2)}function qa(e){var t=e.getUTCDay();return t>=4||0===t?nr(e):nr.ceil(e)}function Ga(e,t){return e=qa(e),Vs(nr.count(vr(e),e)+(4===vr(e).getUTCDay()),t,2)}function Ha(e){return e.getUTCDay()}function Xa(e,t){return Vs(Qi.count(vr(e)-1,e),t,2)}function Ya(e,t){return Vs(e.getUTCFullYear()%100,t,2)}function Ka(e,t){return Vs((e=qa(e)).getUTCFullYear()%100,t,2)}function Ja(e,t){return Vs(e.getUTCFullYear()%1e4,t,4)}function Za(e,t){var n=e.getUTCDay();return Vs((e=n>=4||0===n?nr(e):nr.ceil(e)).getUTCFullYear()%1e4,t,4)}function Qa(){return"+0000"}function eo(){return"%"}function to(e){return+e}function no(e){return Math.floor(+e/1e3)}function io(e){const t={};return n=>t[n]||(t[n]=e(n))}function ro(e){const t=io(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(e){const n=pi(e||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return function(e,t){return n=>{const i=e(n),r=i.indexOf(t);if(r<0)return i;let s=function(e,t){let n,i=e.lastIndexOf("e");if(i>0)return i;for(i=e.length;--i>t;)if(n=e.charCodeAt(i),n>=48&&n<=57)return i+1}(i,r);const a=s<i.length?i.slice(s):"";for(;--s>r;)if("0"!==i[s]){++s;break}return i.slice(0,s)+a}}(t(n),t(".1f")(1)[1])}return t(n)},formatSpan(e,i,r,s){s=pi(null==s?",f":s);const a=di(e,i,r),o=Math.max(Math.abs(e),Math.abs(i));let u;if(null==s.precision)switch(s.type){case"s":return isNaN(u=vi(a,o))||(s.precision=u),n(s,o);case"":case"e":case"g":case"p":case"r":isNaN(u=bi(a,o))||(s.precision=u-("e"===s.type));break;case"f":case"%":isNaN(u=xi(a))||(s.precision=u-2*("%"===s.type))}return t(s)}}}let so,ao;function oo(){return so=ro({format:_i,formatPrefix:Ei})}function uo(e){return ro(Di(e))}function lo(e){return arguments.length?so=uo(e):so}function co(e,t,n){Zt(n=n||{})||Pt("Invalid time multi-format specifier: ".concat(n));const i=t(Mr),r=t(Rr),s=t(Tr),a=t(Or),o=t($r),u=t(Dr),l=t(Fr),c=t(Sr),d=e(n[Br]||".%L"),h=e(n[Mr]||":%S"),f=e(n[Rr]||"%I:%M"),p=e(n[Tr]||"%I %p"),m=e(n[Or]||n[Nr]||"%a %d"),g=e(n[$r]||"%b %d"),y=e(n[Dr]||"%B"),v=e(n[Fr]||"%B"),b=e(n[Sr]||"%Y");return e=>(i(e)<e?d:r(e)<e?h:s(e)<e?f:a(e)<e?p:u(e)<e?o(e)<e?m:g:c(e)<e?l(e)<e?y:v:b)(e)}function ho(e){const t=io(e.format),n=io(e.utcFormat);return{timeFormat:e=>Rn(e)?t(e):co(t,fs,e),utcFormat:e=>Rn(e)?n(e):co(n,ps,e),timeParse:io(e.parse),utcParse:io(e.utcParse)}}function fo(){return ao=ho({format:Ms,parse:Bs,utcFormat:zs,utcParse:Ls})}function po(e){return ho(Ts(e))}function mo(e){return arguments.length?ao=po(e):ao}Rs=Ts({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),Ms=Rs.format,Bs=Rs.parse,zs=Rs.utcFormat,Ls=Rs.utcParse,oo(),fo();const go=(e,t)=>_n({},e,t);function yo(e,t){const n=e?uo(e):lo(),i=t?po(t):mo();return go(n,i)}function vo(e,t){const n=arguments.length;return n&&2!==n&&Pt("defaultLocale expects either zero or two arguments."),n?go(lo(e),mo(t)):go(lo(),mo())}function bo(){return oo(),fo(),vo()}var xo=n(8834).Buffer;const wo=/^(data:|([A-Za-z]+:)?\/\/)/,Co=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,ko=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,Ao="file://";async function _o(e,t){const n=await this.sanitize(e,t),i=n.href;return n.localFile?this.file(i):this.http(i,t)}async function Eo(e,t){t=_n({},this.options,t);const n=this.fileAccess,i={href:null};let r,s,a;const o=Co.test(e.replace(ko,""));null!=e&&"string"==typeof e&&o||Pt("Sanitize failure, invalid URI: "+Ln(e));const u=wo.test(e);return(a=t.baseURL)&&!u&&(e.startsWith("/")||a.endsWith("/")||(e="/"+e),e=a+e),s=(r=e.startsWith(Ao))||"file"===t.mode||"http"!==t.mode&&!u&&n,r?e=e.slice(Ao.length):e.startsWith("//")&&("file"===t.defaultProtocol?(e=e.slice(2),s=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(i,"localFile",{value:!!s}),i.href=e,t.target&&(i.target=t.target+""),t.rel&&(i.rel=t.rel+""),"image"===t.context&&t.crossOrigin&&(i.crossOrigin=t.crossOrigin+""),i}function So(e){return e?t=>new Promise(((n,i)=>{e.readFile(t,((e,t)=>{e?i(e):n(t)}))})):Fo}async function Fo(){Pt("No file system access.")}function Do(e){return e?async function(t,n){const i=_n({},this.options.http,n),r=n&&n.response,s=await e(t,i);return s.ok?yn(s[r])?s[r]():s.text():Pt(s.status+""+s.statusText)}:$o}async function $o(){Pt("No HTTP fetch method available.")}const Oo=e=>!(Number.isNaN(+e)||e instanceof Date),No={boolean:Pn,integer:rn,number:rn,date:Un,string:Wn,unknown:Vt},Io=[e=>"true"===e||"false"===e||!0===e||!1===e,e=>Oo(e)&&Number.isInteger(+e),Oo,e=>!Number.isNaN(Date.parse(e))],To=["boolean","integer","number","date"];function Ro(e,t){if(!e||!e.length)return"unknown";const n=e.length,i=Io.length,r=Io.map(((e,t)=>t+1));for(let a,o,u=0,l=0;u<n;++u)for(o=t?e[u][t]:e[u],a=0;a<i;++a)if(r[a]&&null!=(s=o)&&s==s&&!Io[a](o)&&(r[a]=0,++l,l===Io.length))return"string";var s;return To[r.reduce(((e,t)=>0===e?t:e),0)-1]}function Mo(e,t){return t.reduce(((t,n)=>(t[n]=Ro(e,n),t)),{})}function Bo(e){const t=function(t,n){const i={delimiter:e};return zo(t,n?_n(n,i):i)};return t.responseType="text",t}function zo(e,t){return t.header&&(e=t.header.map(Ln).join(t.delimiter)+"\n"+e),Jn(t.delimiter).parse(e+"")}function Lo(e,t){const n=t&&t.property?Ut(t.property):Vt;return!Zt(e)||(i=e,"function"==typeof xo&&yn(xo.isBuffer)&&xo.isBuffer(i))?n(JSON.parse(e)):function(e,t){return!Jt(e)&&function(e){return e&&yn(e[Symbol.iterator])}(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}(n(e),t);var i}zo.responseType="text",Lo.responseType="json";const Po={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function jo(e,t){let n,i,r,s;return e=Lo(e,t),t&&t.feature?(n=Qn,r=t.feature):t&&t.mesh?(n=ii,r=t.mesh,s=Po[t.filter]):Pt("Missing TopoJSON feature or mesh parameter."),i=(i=e.objects[r])?n(e,i,s):Pt("Invalid TopoJSON object: "+r),i&&i.features||[i]}jo.responseType="json";const Uo={dsv:zo,csv:Bo(","),tsv:Bo("\t"),json:Lo,topojson:jo};function Wo(e,t){return arguments.length>1?(Uo[e]=t,this):Fn(Uo,e)?Uo[e]:null}function Vo(e){const t=Wo(e);return t&&t.responseType||"text"}function qo(e,t,n,i){const r=Wo((t=t||{}).type||"json");return r||Pt("Unknown data format type: "+t.type),e=r(e,t),t.parse&&function(e,t,n,i){if(!e.length)return;const r=mo();n=n||r.timeParse,i=i||r.utcParse;let s,a,o,u,l,c,d=e.columns||Object.keys(e[0]);"auto"===t&&(t=Mo(e,d)),d=Object.keys(t);const h=d.map((e=>{const r=t[e];let s,a;if(r&&(r.startsWith("date:")||r.startsWith("utc:")))return s=r.split(/:(.+)?/,2),a=s[1],("'"===a[0]&&"'"===a[a.length-1]||'"'===a[0]&&'"'===a[a.length-1])&&(a=a.slice(1,-1)),("utc"===s[0]?i:n)(a);if(!No[r])throw Error("Illegal format pattern: "+e+":"+r);return No[r]}));for(o=0,l=e.length,c=d.length;o<l;++o)for(s=e[o],u=0;u<c;++u)a=d[u],s[a]=h[u](s[a])}(e,t.parse,n,i),Fn(e,"columns")&&delete e.columns,e}const Go=function(e,t){return t=>({options:t||{},sanitize:Eo,load:_o,fileAccess:!1,file:So(null),http:Do(e)})}("undefined"!=typeof fetch&&fetch);function Ho(e){const t=e||Vt,n=[],i={};return n.add=e=>{const r=t(e);return i[r]||(i[r]=1,n.push(e)),n},n.remove=e=>{const r=t(e);if(i[r]){i[r]=0;const t=n.indexOf(e);t>=0&&n.splice(t,1)}return n},n}async function Xo(e,t){try{await t(e)}catch(t){e.error(t)}}const Yo=Symbol("vega_id");let Ko=1;function Jo(e){return!(!e||!Zo(e))}function Zo(e){return e[Yo]}function Qo(e,t){return e[Yo]=t,e}function eu(e){const t=e===Object(e)?e:{data:e};return Zo(t)?t:Qo(t,Ko++)}function tu(e){return nu(e,eu({}))}function nu(e,t){for(const n in e)t[n]=e[n];return t}function iu(e,t){return Qo(t,Zo(e))}function ru(e,t){return e?t?(n,i)=>e(n,i)||Zo(t(n))-Zo(t(i)):(t,n)=>e(t,n)||Zo(t)-Zo(n):null}function su(e){return e&&e.constructor===au}function au(){const e=[],t=[],n=[],i=[],r=[];let s=null,a=!1;return{constructor:au,insert(t){const n=gn(t),i=n.length;for(let t=0;t<i;++t)e.push(n[t]);return this},remove(e){const n=yn(e)?i:t,r=gn(e),s=r.length;for(let e=0;e<s;++e)n.push(r[e]);return this},modify(e,t,i){const s={field:t,value:kn(i)};return yn(e)?(s.filter=e,r.push(s)):(s.tuple=e,n.push(s)),this},encode(e,t){return yn(e)?r.push({filter:e,field:t}):n.push({tuple:e,field:t}),this},clean(e){return s=e,this},reflow(){return a=!0,this},pulse(o,u){const l={},c={};let d,h,f,p,m,g;for(d=0,h=u.length;d<h;++d)l[Zo(u[d])]=1;for(d=0,h=t.length;d<h;++d)m=t[d],l[Zo(m)]=-1;for(d=0,h=i.length;d<h;++d)p=i[d],u.forEach((e=>{p(e)&&(l[Zo(e)]=-1)}));for(d=0,h=e.length;d<h;++d)m=e[d],g=Zo(m),l[g]?l[g]=1:o.add.push(eu(e[d]));for(d=0,h=u.length;d<h;++d)m=u[d],l[Zo(m)]<0&&o.rem.push(m);function y(e,t,n){n?e[t]=n(e):o.encode=t,a||(c[Zo(e)]=e)}for(d=0,h=n.length;d<h;++d)f=n[d],m=f.tuple,p=f.field,g=l[Zo(m)],g>0&&(y(m,p,f.value),o.modifies(p));for(d=0,h=r.length;d<h;++d)f=r[d],p=f.filter,u.forEach((e=>{p(e)&&l[Zo(e)]>0&&y(e,f.field,f.value)})),o.modifies(f.field);if(a)o.mod=t.length||i.length?u.filter((e=>l[Zo(e)]>0)):u.slice();else for(g in c)o.mod.push(c[g]);return(s||null==s&&(t.length||i.length))&&o.clean(!0),o}}}const ou="_:mod:_";function uu(){Object.defineProperty(this,ou,{writable:!0,value:{}})}uu.prototype={set(e,t,n,i){const r=this,s=r[e],a=r[ou];return null!=t&&t>=0?(s[t]!==n||i)&&(s[t]=n,a[t+":"+e]=-1,a[e]=-1):(s!==n||i)&&(r[e]=n,a[e]=Jt(n)?1+n.length:-1),r},modified(e,t){const n=this[ou];if(!arguments.length){for(const e in n)if(n[e])return!0;return!1}if(Jt(e)){for(let t=0;t<e.length;++t)if(n[e[t]])return!0;return!1}return null!=t&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[ou]={},this}};let lu=0;const cu=new uu;function du(e,t,n,i){this.id=++lu,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,i)}function hu(e){return function(t){const n=this.flags;return 0===arguments.length?!!(n&e):(this.flags=t?n|e:n&~e,this)}}du.prototype={targets(){return this._targets||(this._targets=Ho(Wt))},set(e){return this.value!==e?(this.value=e,1):0},skip:hu(1),modified:hu(2),parameters(e,t,n){t=!1!==t;const i=this._argval=this._argval||new uu,r=this._argops=this._argops||[],s=[];let a,o,u,l;const c=(e,n,a)=>{a instanceof du?(a!==this&&(t&&a.targets().add(this),s.push(a)),r.push({op:a,name:e,index:n})):i.set(e,n,a)};for(a in e)if(o=e[a],"pulse"===a)gn(o).forEach((e=>{e instanceof du?e!==this&&(e.targets().add(this),s.push(e)):Pt("Pulse parameters must be operator instances.")})),this.source=o;else if(Jt(o))for(i.set(a,-1,Array(u=o.length)),l=0;l<u;++l)c(a,l,o[l]);else c(a,-1,o);return this.marshall().clear(),n&&(r.initonly=!0),s},marshall(e){const t=this._argval||cu,n=this._argops;let i,r,s,a;if(n){const o=n.length;for(r=0;r<o;++r)i=n[r],s=i.op,a=s.modified()&&s.stamp===e,t.set(i.name,i.index,s.value,a);if(n.initonly){for(r=0;r<o;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,i,r;if(e)for(t=0,n=e.length;t<n;++t)i=e[t],r=i.op,r._targets&&r._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),i=t.call(this,n,e);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let fu=0;function pu(e,t,n){this.id=++fu,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function mu(e,t,n){return new pu(e,t,n)}pu.prototype={_filter:Ht,_apply:Vt,targets(){return this._targets||(this._targets=Ho(Wt))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,i=n?n.length:0;for(let e=0;e<i;++e)n[e].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=mu(e);return this.targets().add(t),t},apply(e){const t=mu(null,e);return this.targets().add(t),t},merge(){const e=mu();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter((()=>{const n=Date.now();return n-t>e?(t=n,1):0}))},debounce(e){const t=mu();return this.targets().add(mu(null,null,An(e,(e=>{const n=e.dataflow;t.receive(e),n&&n.run&&n.run()})))),t},between(e,t){let n=!1;return e.targets().add(mu(null,null,(()=>n=!0))),t.targets().add(mu(null,null,(()=>n=!1))),this.filter((()=>n))},detach(){this._filter=Ht,this._targets=null}};const gu={skip:!0};function yu(e,t,n,i,r,s){const a=_n({},s,gu);let o,u;yn(n)||(n=kn(n)),void 0===i?o=t=>e.touch(n(t)):yn(i)?(u=new du(null,i,r,!1),o=t=>{u.evaluate(t);const i=n(t),r=u.value;su(r)?e.pulse(i,r,s):e.update(i,r,a)}):o=t=>e.update(n(t),i,a),t.apply(o)}function vu(e,t,n,i,r,s){if(void 0===i)t.targets().add(n);else{const a=s||{},o=new du(null,function(e,t){return t=yn(t)?t:kn(t),e?function(n,i){const r=t(n,i);return e.skip()||(e.skip(r!==this.value).value=r),r}:t}(n,i),r,!1);o.modified(a.force),o.rank=t.rank,t.targets().add(o),n&&(o.skip(!0),o.value=n.value,o.targets().add(n),e.connect(n,[o]))}}const bu={};function xu(e,t,n){this.dataflow=e,this.stamp=null==t?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function wu(e,t){const n=[];return qn(e,t,(e=>n.push(e))),n}function Cu(e,t){const n={};return e.visit(t,(e=>{n[Zo(e)]=1})),e=>n[Zo(e)]?null:e}function ku(e,t){return e?(n,i)=>e(n,i)&&t(n,i):t}function Au(e,t,n,i){const r=this,s=n.length;let a=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=i||null,this.pulses=n;for(let e=0;e<s;++e){const i=n[e];if(i.stamp===t){if(i.fields){const e=r.fields||(r.fields={});for(const t in i.fields)e[t]=1}i.changed(r.ADD)&&(a|=r.ADD),i.changed(r.REM)&&(a|=r.REM),i.changed(r.MOD)&&(a|=r.MOD)}}this.changes=a}function _u(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}xu.prototype={StopPropagation:bu,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new xu(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new xu(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,Cu(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return Jt(e)?e.forEach((e=>t[e]=!0)):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?Jt(e)?e.some((e=>n[e])):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=ku(n.addF,t)),2&e&&(n.remF=ku(n.remF,t)),4&e&&(n.modF=ku(n.modF,t)),16&e&&(n.srcF=ku(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=wu(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=wu(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=wu(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,i=t;if(16&e)return qn(n.source,n.srcF,i),n;1&e&&qn(n.add,n.addF,i),2&e&&qn(n.rem,n.remF,i),4&e&&qn(n.mod,n.modF,i);const r=n.source;if(8&e&&r){const e=n.add.length+n.mod.length;e===r.length||qn(r,e?Cu(n,5):n.srcF,i)}return n}},On(Au,xu,{fork(e){const t=new xu(this.dataflow).init(this,e&this.NO_FIELDS);return void 0!==e&&(e&t.ADD&&this.visit(t.ADD,(e=>t.add.push(e))),e&t.REM&&this.visit(t.REM,(e=>t.rem.push(e))),e&t.MOD&&this.visit(t.MOD,(e=>t.mod.push(e)))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?Jt(e)?e.some((e=>n[e])):n[e]:0},filter(){Pt("MultiPulse does not support filtering.")},materialize(){Pt("MultiPulse does not support materialization.")},visit(e,t){const n=this,i=n.pulses,r=i.length;let s=0;if(e&n.SOURCE)for(;s<r;++s)i[s].visit(e,t);else for(;s<r;++s)i[s].stamp===n.stamp&&i[s].visit(e,t);return n}});const Eu={skip:!1,force:!1};function Su(e,t,n,i){let r,s;const a=e[n];for(;n>t&&(s=n-1>>1,r=e[s],i(a,r)<0);)e[n]=r,n=s;return e[n]=a}function Fu(){this.logger(Kt()),this.logLevel(1),this._clock=0,this._rank=0,this._locale=vo();try{this._loader=Go()}catch(e){}this._touched=Ho(Wt),this._input={},this._pulse=null,this._heap=function(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),Su(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let i;return t.length?(i=t[0],t[0]=n,function(e,t,n){const i=t,r=e.length,s=e[t];let a,o=1+(t<<1);for(;o<r;)a=o+1,a<r&&n(e[o],e[a])>=0&&(o=a),e[t]=e[o],o=1+((t=o)<<1);e[t]=s,Su(e,i,t,n)}(t,0,e)):i=n,i}}}(((e,t)=>e.qrank-t.qrank)),this._postrun=[]}function Du(e){return function(){return this._log[e].apply(this,arguments)}}function $u(e,t){du.call(this,e,null,t)}Fu.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:Du("error"),warn:Du("warn"),info:Du("info"),debug:Du("debug"),logLevel:Du("level"),cleanThreshold:1e4,add:function(e,t,n,i){let r,s=1;return e instanceof du?r=e:e&&e.prototype instanceof du?r=new e:yn(e)?r=new du(null,e):(s=0,r=new du(e,t)),this.rank(r),s&&(i=n,n=t),n&&this.connect(r,r.parameters(n,i)),this.touch(r),r},connect:function(e,t){const n=e.rank,i=t.length;for(let r=0;r<i;++r)if(n<t[r].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,i,r;for(;t.length;)if(this.rank(n=t.pop()),i=n._targets)for(r=i.length;--r>=0;)t.push(n=i[r]),n===e&&Pt("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||Eu);const i=new xu(this,this._clock+(this._pulse?0:1)),r=e.pulse&&e.pulse.source||[];return i.target=e,this._input[e.id]=t.pulse(i,r),this},touch:function(e,t){const n=t||Eu;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const i=n||Eu;return(e.set(t)||i.force)&&this.touch(e,i),this},changeset:au,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return qo(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const i=this,r=i._pending||function(e){let t;const n=new Promise((e=>t=e));return n.requests=0,n.done=()=>{0==--n.requests&&(e._pending=null,t(e))},e._pending=n}(i);r.requests+=1;const s=await i.request(t,n);return i.pulse(e,i.changeset().remove(Ht).insert(s.data||[])),r.done(),s},request:async function(e,t){const n=this;let i,r=0;try{i=await n.loader().load(e,{context:"dataflow",response:Vo(t&&t.type)});try{i=n.parse(i,t)}catch(t){r=-2,n.warn("Data ingestion failed",e,t)}}catch(t){r=-1,n.warn("Loading failed",e,t)}return{data:i,status:r}},events:function(e,t,n,i){const r=this,s=mu(n,i),a=function(e){e.dataflow=r;try{s.receive(e)}catch(e){r.error(e)}finally{r.run()}};let o;o="string"==typeof e&&"undefined"!=typeof document?document.querySelectorAll(e):gn(e);const u=o.length;for(let e=0;e<u;++e)o[e].addEventListener(t,a);return s},on:function(e,t,n,i,r){return(e instanceof du?vu:yu)(this,e,t,n,i,r),this},evaluate:async function(e,t,n){const i=this,r=[];if(i._pulse)return _u(i);if(i._pending&&await i._pending,t&&await Xo(i,t),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const s=++i._clock;i._pulse=new xu(i,s,e),i._touched.forEach((e=>i._enqueue(e,!0))),i._touched=Ho(Wt);let a,o,u,l=0;try{for(;i._heap.size()>0;)a=i._heap.pop(),a.rank===a.qrank?(o=a.run(i._getPulse(a,e)),o.then?o=await o:o.async&&(r.push(o.async),o=bu),o!==bu&&a._targets&&a._targets.forEach((e=>i._enqueue(e))),++l):i._enqueue(a,!0)}catch(e){i._heap.clear(),u=e}if(i._input={},i._pulse=null,i.debug(`Pulse ${s}: ${l} operators`),u&&(i._postrun=[],i.error(u)),i._postrun.length){const e=i._postrun.sort(((e,t)=>t.priority-e.priority));i._postrun=[];for(let t=0;t<e.length;++t)await Xo(i,e[t].callback)}return n&&await Xo(i,n),r.length&&Promise.all(r).then((e=>i.runAsync(null,(()=>{e.forEach((e=>{try{e(i)}catch(e){i.error(e)}}))})))),i},run:function(e,t,n){return this._pulse?_u(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(i,i),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(e){this.error(e)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,i=this._clock;return n&&Jt(n)?new Au(this,i,n.map((e=>e.pulse)),t):this._input[e.id]||function(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==bu&&(e.source=t.source),e)}(this._pulse,n&&n.pulse)}},On($u,du,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then((e=>this.pulse=e)):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const Ou={};function Nu(e){const t=Iu(e);return t&&t.Definition||null}function Iu(e){return e=e&&e.toLowerCase(),Fn(Ou,e)?Ou[e]:null}function Tu(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let i=-1;for(let r of e)null!=(r=t(r,++i,e))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function Ru(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let i=-1;for(let r of e)null!=(r=t(r,++i,e))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}function Mu(e,t,n=0,i=e.length-1,r=_r){for(;i>n;){if(i-n>600){const s=i-n+1,a=t-n+1,o=Math.log(s),u=.5*Math.exp(2*o/3),l=.5*Math.sqrt(o*u*(s-u)/s)*(a-s/2<0?-1:1);Mu(e,t,Math.max(n,Math.floor(t-a*u/s+l)),Math.min(i,Math.floor(t+(s-a)*u/s+l)),r)}const s=e[t];let a=n,o=i;for(Bu(e,n,t),r(e[i],s)>0&&Bu(e,n,i);a<o;){for(Bu(e,a,o),++a,--o;r(e[a],s)<0;)++a;for(;r(e[o],s)>0;)--o}0===r(e[n],s)?Bu(e,n,o):(++o,Bu(e,o,i)),o<=t&&(n=o+1),t<=o&&(i=o-1)}return e}function Bu(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function zu(e){return null===e?NaN:+e}function Lu(e,t,n){if(i=(e=Float64Array.from(function*(e,t){if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let i of e)null!=(i=t(i,++n,e))&&(i=+i)>=i&&(yield i)}}(e,n))).length){if((t=+t)<=0||i<2)return Ru(e);if(t>=1)return Tu(e);var i,r=(i-1)*t,s=Math.floor(r),a=Tu(Mu(e,s).subarray(0,s+1));return a+(Ru(e.subarray(s+1))-a)*(r-s)}}function Pu(e,t,n=zu){if(i=e.length){if((t=+t)<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,r=(i-1)*t,s=Math.floor(r),a=+n(e[s],s,e);return a+(+n(e[s+1],s+1,e)-a)*(r-s)}}function ju(e,t){return Lu(e,.5,t)}function*Uu(e,t){if(null==t)for(let t of e)null!=t&&""!==t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let i of e)i=t(i,++n,e),null!=i&&""!==i&&(i=+i)>=i&&(yield i)}}function Wu(e,t,n){const i=Float64Array.from(Uu(e,n));return i.sort(_r),t.map((e=>Pu(i,e)))}function Vu(e,t){return Wu(e,[.25,.5,.75],t)}function qu(e,t){const n=e.length,i=function(e,t){const n=function(e,t){let n,i=0,r=0,s=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(n=t-r,r+=n/++i,s+=n*(t-r));else{let a=-1;for(let o of e)null!=(o=t(o,++a,e))&&(o=+o)>=o&&(n=o-r,r+=n/++i,s+=n*(o-r))}if(i>1)return s/(i-1)}(e,t);return n?Math.sqrt(n):n}(e,t),r=Vu(e,t),s=(r[2]-r[0])/1.34;return 1.06*(Math.min(i,s)||i||Math.abs(r[0])||1)*Math.pow(n,-.2)}function Gu(e){const t=e.maxbins||20,n=e.base||10,i=Math.log(n),r=e.divide||[5,2];let s,a,o,u,l,c,d=e.extent[0],h=e.extent[1];const f=e.span||h-d||Math.abs(d)||1;if(e.step)s=e.step;else if(e.steps){for(u=f/t,l=0,c=e.steps.length;l<c&&e.steps[l]<u;++l);s=e.steps[Math.max(0,l-1)]}else{for(a=Math.ceil(Math.log(t)/i),o=e.minstep||0,s=Math.max(o,Math.pow(n,Math.round(Math.log(f)/i)-a));Math.ceil(f/s)>t;)s*=n;for(l=0,c=r.length;l<c;++l)u=s/r[l],u>=o&&f/u<=t&&(s=u)}u=Math.log(s);const p=u>=0?0:1+~~(-u/i),m=Math.pow(n,-p-1);return(e.nice||void 0===e.nice)&&(u=Math.floor(d/s+m)*s,d=d<u?u-s:u,h=Math.ceil(h/s)*s),{start:d,stop:h===d?d+s:h,step:s}}var Hu=Math.random;function Xu(e){Hu=e}function Yu(e,t,n,i){if(!e.length)return[void 0,void 0];const r=Float64Array.from(Uu(e,i)),s=r.length,a=t;let o,u,l,c;for(l=0,c=Array(a);l<a;++l){for(o=0,u=0;u<s;++u)o+=r[~~(Hu()*s)];c[l]=o/s}return c.sort(_r),[Lu(c,n/2),Lu(c,1-n/2)]}function Ku(e,t,n,i){i=i||(e=>e);const r=e.length,s=new Float64Array(r);let a,o=0,u=1,l=i(e[0]),c=l,d=l+t;for(;u<r;++u){if(a=i(e[u]),a>=d){for(c=(l+c)/2;o<u;++o)s[o]=c;d=a+t,l=a}c=a}for(c=(l+c)/2;o<u;++o)s[o]=c;return n?function(e,t){const n=e.length;let i,r,s=0,a=1;for(;e[s]===e[a];)++a;for(;a<n;){for(i=a+1;e[a]===e[i];)++i;if(e[a]-e[a-1]<t){for(r=a+(s+i-a-a>>1);r<a;)e[r++]=e[a];for(;r>a;)e[r--]=e[s]}s=a,a=i}return e}(s,t+t/4):s}function Ju(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}}function Zu(e,t){let n,i,r;null==t&&(t=e,e=0);const s={min(e){return arguments.length?(n=e||0,r=i-n,s):n},max(e){return arguments.length?(i=e||0,r=i-n,s):i},sample:()=>n+Math.floor(r*Hu()),pdf:e=>e===Math.floor(e)&&e>=n&&e<i?1/r:0,cdf(e){const t=Math.floor(e);return t<n?0:t>=i?1:(t-n+1)/r},icdf:e=>e>=0&&e<=1?n-1+Math.floor(e*r):NaN};return s.min(e).max(t)}const Qu=Math.sqrt(2*Math.PI),el=Math.SQRT2;let tl=NaN;function nl(e,t){e=e||0,t=null==t?1:t;let n,i,r=0,s=0;if(tl==tl)r=tl,tl=NaN;else{do{r=2*Hu()-1,s=2*Hu()-1,n=r*r+s*s}while(0===n||n>1);i=Math.sqrt(-2*Math.log(n)/n),r*=i,tl=s*i}return e+r*t}function il(e,t,n){const i=(e-(t||0))/(n=null==n?1:n);return Math.exp(-.5*i*i)/(n*Qu)}function rl(e,t,n){const i=(e-(t=t||0))/(n=null==n?1:n),r=Math.abs(i);let s;if(r>37)s=0;else{const e=Math.exp(-r*r/2);let t;r<7.07106781186547?(t=.0352624965998911*r+.700383064443688,t=t*r+6.37396220353165,t=t*r+33.912866078383,t=t*r+112.079291497871,t=t*r+221.213596169931,t=t*r+220.206867912376,s=e*t,t=.0883883476483184*r+1.75566716318264,t=t*r+16.064177579207,t=t*r+86.7807322029461,t=t*r+296.564248779674,t=t*r+637.333633378831,t=t*r+793.826512519948,t=t*r+440.413735824752,s/=t):(t=r+.65,t=r+4/t,t=r+3/t,t=r+2/t,t=r+1/t,s=e/t/2.506628274631)}return i>0?1-s:s}function sl(e,t,n){return e<0||e>1?NaN:(t||0)+(null==n?1:n)*el*function(e){let t,n=-Math.log((1-e)*(1+e));return n<6.25?(n-=3.125,t=-364441206401782e-35,t=t*n-16850591381820166e-35,t=128584807152564e-32+t*n,t=11157877678025181e-33+t*n,t=t*n-1333171662854621e-31,t=20972767875968562e-33+t*n,t=6637638134358324e-30+t*n,t=t*n-4054566272975207e-29,t=t*n-8151934197605472e-29,t=26335093153082323e-28+t*n,t=t*n-12975133253453532e-27,t=t*n-5415412054294628e-26,t=1.0512122733215323e-9+t*n,t=t*n-4.112633980346984e-9,t=t*n-2.9070369957882005e-8,t=4.2347877827932404e-7+t*n,t=t*n-13654692000834679e-22,t=t*n-13882523362786469e-21,t=.00018673420803405714+t*n,t=t*n-.000740702534166267,t=t*n-.006033670871430149,t=.24015818242558962+t*n,t=1.6536545626831027+t*n):n<16?(n=Math.sqrt(n)-3.25,t=2.2137376921775787e-9,t=9.075656193888539e-8+t*n,t=t*n-2.7517406297064545e-7,t=1.8239629214389228e-8+t*n,t=15027403968909828e-22+t*n,t=t*n-4013867526981546e-21,t=29234449089955446e-22+t*n,t=12475304481671779e-21+t*n,t=t*n-47318229009055734e-21,t=6828485145957318e-20+t*n,t=24031110387097894e-21+t*n,t=t*n-.0003550375203628475,t=.0009532893797373805+t*n,t=t*n-.0016882755560235047,t=.002491442096107851+t*n,t=t*n-.003751208507569241,t=.005370914553590064+t*n,t=1.0052589676941592+t*n,t=3.0838856104922208+t*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,t=-27109920616438573e-27,t=t*n-2.555641816996525e-10,t=1.5076572693500548e-9+t*n,t=t*n-3.789465440126737e-9,t=7.61570120807834e-9+t*n,t=t*n-1.496002662714924e-8,t=2.914795345090108e-8+t*n,t=t*n-6.771199775845234e-8,t=2.2900482228026655e-7+t*n,t=t*n-9.9298272942317e-7,t=4526062597223154e-21+t*n,t=t*n-1968177810553167e-20,t=7599527703001776e-20+t*n,t=t*n-.00021503011930044477,t=t*n-.00013871931833623122,t=1.0103004648645344+t*n,t=4.849906401408584+t*n):t=1/0,t*e}(2*e-1)}function al(e,t){let n,i;const r={mean(e){return arguments.length?(n=e||0,r):n},stdev(e){return arguments.length?(i=null==e?1:e,r):i},sample:()=>nl(n,i),pdf:e=>il(e,n,i),cdf:e=>rl(e,n,i),icdf:e=>sl(e,n,i)};return r.mean(e).stdev(t)}function ol(e,t){const n=al();let i=0;const r={data(n){return arguments.length?(e=n,i=n?n.length:0,r.bandwidth(t)):e},bandwidth(n){return arguments.length?(!(t=n)&&e&&(t=qu(e)),r):t},sample:()=>e[~~(Hu()*i)]+t*n.sample(),pdf(r){let s=0,a=0;for(;a<i;++a)s+=n.pdf((r-e[a])/t);return s/t/i},cdf(r){let s=0,a=0;for(;a<i;++a)s+=n.cdf((r-e[a])/t);return s/i},icdf(){throw Error("KDE icdf not supported.")}};return r.data(e)}function ul(e,t){return e=e||0,t=null==t?1:t,Math.exp(e+nl()*t)}function ll(e,t,n){if(e<=0)return 0;t=t||0,n=null==n?1:n;const i=(Math.log(e)-t)/n;return Math.exp(-.5*i*i)/(n*Qu*e)}function cl(e,t,n){return rl(Math.log(e),t,n)}function dl(e,t,n){return Math.exp(sl(e,t,n))}function hl(e,t){let n,i;const r={mean(e){return arguments.length?(n=e||0,r):n},stdev(e){return arguments.length?(i=null==e?1:e,r):i},sample:()=>ul(n,i),pdf:e=>ll(e,n,i),cdf:e=>cl(e,n,i),icdf:e=>dl(e,n,i)};return r.mean(e).stdev(t)}function fl(e,t){let n,i=0;const r={weights(e){return arguments.length?(n=function(e){const t=[];let n,r=0;for(n=0;n<i;++n)r+=t[n]=null==e[n]?1:+e[n];for(n=0;n<i;++n)t[n]/=r;return t}(t=e||[]),r):t},distributions(n){return arguments.length?(n?(i=n.length,e=n):(i=0,e=[]),r.weights(t)):e},sample(){const t=Hu();let r=e[i-1],s=n[0],a=0;for(;a<i-1;s+=n[++a])if(t<s){r=e[a];break}return r.sample()},pdf(t){let r=0,s=0;for(;s<i;++s)r+=n[s]*e[s].pdf(t);return r},cdf(t){let r=0,s=0;for(;s<i;++s)r+=n[s]*e[s].cdf(t);return r},icdf(){throw Error("Mixture icdf not supported.")}};return r.distributions(e).weights(t)}function pl(e,t){return null==t&&(t=null==e?1:e,e=0),e+(t-e)*Hu()}function ml(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function gl(e,t,n){return null==n&&(n=null==t?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function yl(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function vl(e,t){let n,i;const r={min(e){return arguments.length?(n=e||0,r):n},max(e){return arguments.length?(i=null==e?1:e,r):i},sample:()=>pl(n,i),pdf:e=>ml(e,n,i),cdf:e=>gl(e,n,i),icdf:e=>yl(e,n,i)};return null==t&&(t=null==e?1:e,e=0),r.min(e).max(t)}function bl(e,t,n,i){const r=i-e*e,s=Math.abs(r)<1e-24?0:(n-e*t)/r;return[t-s*e,s]}function xl(e,t,n,i){e=e.filter((e=>{let i=t(e),r=n(e);return null!=i&&(i=+i)>=i&&null!=r&&(r=+r)>=r})),i&&e.sort(((e,n)=>t(e)-t(n)));const r=e.length,s=new Float64Array(r),a=new Float64Array(r);let o,u,l,c=0,d=0,h=0;for(l of e)s[c]=o=+t(l),a[c]=u=+n(l),++c,d+=(o-d)/c,h+=(u-h)/c;for(c=0;c<r;++c)s[c]-=d,a[c]-=h;return[s,a,d,h]}function wl(e,t,n,i){let r,s,a=-1;for(const o of e)r=t(o),s=n(o),null!=r&&(r=+r)>=r&&null!=s&&(s=+s)>=s&&i(r,s,++a)}function Cl(e,t,n,i,r){let s=0,a=0;return wl(e,t,n,((e,t)=>{const n=t-r(e),o=t-i;s+=n*n,a+=o*o})),1-s/a}function kl(e,t,n){let i=0,r=0,s=0,a=0,o=0;wl(e,t,n,((e,t)=>{++o,i+=(e-i)/o,r+=(t-r)/o,s+=(e*t-s)/o,a+=(e*e-a)/o}));const u=bl(i,r,s,a),l=e=>u[0]+u[1]*e;return{coef:u,predict:l,rSquared:Cl(e,t,n,r,l)}}function Al(e,t,n){let i=0,r=0,s=0,a=0,o=0;wl(e,t,n,((e,t)=>{++o,e=Math.log(e),i+=(e-i)/o,r+=(t-r)/o,s+=(e*t-s)/o,a+=(e*e-a)/o}));const u=bl(i,r,s,a),l=e=>u[0]+u[1]*Math.log(e);return{coef:u,predict:l,rSquared:Cl(e,t,n,r,l)}}function _l(e,t,n){const[i,r,s,a]=xl(e,t,n);let o,u,l,c=0,d=0,h=0,f=0,p=0;wl(e,t,n,((e,t)=>{o=i[p++],u=Math.log(t),l=o*t,c+=(t*u-c)/p,d+=(l-d)/p,h+=(l*u-h)/p,f+=(o*l-f)/p}));const[m,g]=bl(d/a,c/a,h/a,f/a),y=e=>Math.exp(m+g*(e-s));return{coef:[Math.exp(m-g*s),g],predict:y,rSquared:Cl(e,t,n,a,y)}}function El(e,t,n){let i=0,r=0,s=0,a=0,o=0,u=0;wl(e,t,n,((e,t)=>{const n=Math.log(e),l=Math.log(t);++u,i+=(n-i)/u,r+=(l-r)/u,s+=(n*l-s)/u,a+=(n*n-a)/u,o+=(t-o)/u}));const l=bl(i,r,s,a),c=e=>l[0]*Math.pow(e,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:Cl(e,t,n,o,c)}}function Sl(e,t,n){const[i,r,s,a]=xl(e,t,n),o=i.length;let u,l,c,d,h=0,f=0,p=0,m=0,g=0;for(u=0;u<o;)l=i[u],c=r[u++],d=l*l,h+=(d-h)/u,f+=(d*l-f)/u,p+=(d*d-p)/u,m+=(l*c-m)/u,g+=(d*c-g)/u;const y=p-h*h,v=h*y-f*f,b=(g*h-m*f)/v,x=(m*y-g*f)/v,w=-b*h,C=e=>b*(e-=s)*e+x*e+w+a;return{coef:[w-x*s+b*s*s+a,x-2*b*s,b],predict:C,rSquared:Cl(e,t,n,a,C)}}function Fl(e,t,n,i){if(1===i)return kl(e,t,n);if(2===i)return Sl(e,t,n);const[r,s,a,o]=xl(e,t,n),u=r.length,l=[],c=[],d=i+1;let h,f,p,m,g;for(h=0;h<d;++h){for(p=0,m=0;p<u;++p)m+=Math.pow(r[p],h)*s[p];for(l.push(m),g=new Float64Array(d),f=0;f<d;++f){for(p=0,m=0;p<u;++p)m+=Math.pow(r[p],h+f);g[f]=m}c.push(g)}c.push(l);const y=function(e){const t=e.length-1,n=[];let i,r,s,a,o;for(i=0;i<t;++i){for(a=i,r=i+1;r<t;++r)Math.abs(e[i][r])>Math.abs(e[i][a])&&(a=r);for(s=i;s<t+1;++s)o=e[s][i],e[s][i]=e[s][a],e[s][a]=o;for(r=i+1;r<t;++r)for(s=t;s>=i;s--)e[s][r]-=e[s][i]*e[i][r]/e[i][i]}for(r=t-1;r>=0;--r){for(o=0,s=r+1;s<t;++s)o+=e[s][r]*n[s];n[r]=(e[t][r]-o)/e[r][r]}return n}(c),v=e=>{e-=a;let t=o+y[0]+y[1]*e+y[2]*e*e;for(h=3;h<d;++h)t+=y[h]*Math.pow(e,h);return t};return{coef:Dl(d,y,-a,o),predict:v,rSquared:Cl(e,t,n,o,v)}}function Dl(e,t,n,i){const r=Array(e);let s,a,o,u;for(s=0;s<e;++s)r[s]=0;for(s=e-1;s>=0;--s)for(o=t[s],u=1,r[s]+=o,a=1;a<=s;++a)u*=(s+1-a)/a,r[s-a]+=o*Math.pow(n,a)*u;return r[0]+=i,r}function $l(e,t,n,i){const[r,s,a,o]=xl(e,t,n,!0),u=r.length,l=Math.max(2,~~(i*u)),c=new Float64Array(u),d=new Float64Array(u),h=new Float64Array(u).fill(1);for(let e=-1;++e<=2;){const t=[0,l-1];for(let e=0;e<u;++e){const n=r[e],i=t[0],a=t[1],o=n-r[i]>r[a]-n?i:a;let u=0,l=0,f=0,p=0,m=0;const g=1/Math.abs(r[o]-n||1);for(let e=i;e<=a;++e){const t=r[e],i=s[e],a=Ol(Math.abs(n-t)*g)*h[e],o=t*a;u+=a,l+=o,f+=i*a,p+=i*o,m+=t*o}const[y,v]=bl(l/u,f/u,p/u,m/u);c[e]=y+v*n,d[e]=Math.abs(s[e]-c[e]),Nl(r,e+1,t)}if(2===e)break;const n=ju(d);if(Math.abs(n)<1e-12)break;for(let e,t,i=0;i<u;++i)e=d[i]/(6*n),h[i]=e>=1?1e-12:(t=1-e*e)*t}return function(e,t,n,i){const r=e.length,s=[];let a,o=0,u=0,l=[];for(;o<r;++o)a=e[o]+n,l[0]===a?l[1]+=(t[o]-l[1])/++u:(u=0,l[1]+=i,l=[a,t[o]],s.push(l));return l[1]+=i,s}(r,c,a,o)}function Ol(e){return(e=1-e*e*e)*e*e}function Nl(e,t,n){const i=e[t];let r=n[0],s=n[1]+1;if(!(s>=e.length))for(;t>r&&e[s]-i<=i-e[r];)n[0]=++r,n[1]=s,++s}const Il=.5*Math.PI/180;function Tl(e,t,n,i){n=n||25,i=Math.max(n,i||200);const r=t=>[t,e(t)],s=t[0],a=t[1],o=a-s,u=o/i,l=[r(s)],c=[];if(n===i){for(let e=1;e<i;++e)l.push(r(s+e/n*o));return l.push(r(a)),l}c.push(r(a));for(let e=n;--e>0;)c.push(r(s+e/n*o));let d=l[0],h=c[c.length-1];const f=1/o,p=function(e,t){let n=e,i=e;const r=t.length;for(let e=0;e<r;++e){const r=t[e][1];r<n&&(n=r),r>i&&(i=r)}return 1/(i-n)}(d[1],c);for(;h;){const e=r((d[0]+h[0])/2);e[0]-d[0]>=u&&Rl(d,e,h,f,p)>Il?c.push(e):(d=h,l.push(h),c.pop()),h=c[c.length-1]}return l}function Rl(e,t,n,i,r){const s=Math.atan2(r*(n[1]-e[1]),i*(n[0]-e[0])),a=Math.atan2(r*(t[1]-e[1]),i*(t[0]-e[0]));return Math.abs(s-a)}function Ml(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=0|Math.max(0,Math.ceil((t-e)/n)),s=new Array(r);++i<r;)s[i]=e+i*n;return s}function Bl(e){return e&&e.length?1===e.length?e[0]:(t=e,e=>{const n=t.length;let i=1,r=String(t[0](e));for(;i<n;++i)r+="|"+t[i](e);return r}):function(){return""};var t}function zl(e,t,n){return n||e+(t?"_"+t:"")}const Ll=()=>{},Pl={init:Ll,add:Ll,rem:Ll,idx:0},jl={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||void 0===e.min)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||void 0===e.max)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Ul=Object.keys(jl);function Wl(e,t){return jl[e](t)}function Vl(e,t){return e.idx-t.idx}function ql(){this.valid=0,this.missing=0,this._ops.forEach((e=>e.init(this)))}function Gl(e,t){null!=e&&""!==e?e==e&&(++this.valid,this._ops.forEach((n=>n.add(this,e,t)))):++this.missing}function Hl(e,t){null!=e&&""!==e?e==e&&(--this.valid,this._ops.forEach((n=>n.rem(this,e,t)))):--this.missing}function Xl(e){return this._out.forEach((t=>e[t.out]=t.value(this))),e}function Yl(e,t){const n=t||Vt,i=function(e){const t={};e.forEach((e=>t[e.name]=e));const n=e=>{e.req&&e.req.forEach((e=>{t[e]||n(t[e]=jl[e]())}))};return e.forEach(n),Object.values(t).sort(Vl)}(e),r=e.slice().sort(Vl);function s(e){this._ops=i,this._out=r,this.cell=e,this.init()}return s.prototype.init=ql,s.prototype.add=Gl,s.prototype.rem=Hl,s.prototype.set=Xl,s.prototype.get=n,s.fields=e.map((e=>e.out)),s}function Kl(e){this._key=e?Ut(e):Zo,this.reset()}Ul.forEach((e=>{jl[e]=function(e,t){return n=>_n({name:e,out:n||e},Pl,t)}(e,jl[e])}));const Jl=Kl.prototype;function Zl(e){$u.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}function Ql(e){$u.call(this,null,e)}function ec(e,t,n){const i=e;let r=t||[],s=n||[],a={},o=0;return{add:e=>s.push(e),remove:e=>a[i(e)]=++o,size:()=>r.length,data:(e,t)=>(o&&(r=r.filter((e=>!a[i(e)])),a={},o=0),t&&e&&r.sort(e),s.length&&(r=e?function(e,t,n,i){const r=t.length,s=n.length;if(!s)return t;if(!r)return n;const a=new t.constructor(r+s);let o=0,u=0,l=0;for(;o<r&&u<s;++l)a[l]=e(t[o],n[u])>0?n[u++]:t[o++];for(;o<r;++o,++l)a[l]=t[o];for(;u<s;++u,++l)a[l]=n[u];return a}(e,r,s.sort(e)):r.concat(s),s=[]),r)}}function tc(e){$u.call(this,[],e)}function nc(e){du.call(this,null,ic,e)}function ic(e){return this.value&&!e.modified()?this.value:vn(e.fields,e.orders)}function rc(e){$u.call(this,null,e)}function sc(e){$u.call(this,null,e)}Jl.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Jl.add=function(e){this._add.push(e)},Jl.rem=function(e){this._rem.push(e)},Jl.values=function(){if(this._get=null,0===this._rem.length)return this._add;const e=this._add,t=this._rem,n=this._key,i=e.length,r=t.length,s=Array(i-r),a={};let o,u,l;for(o=0;o<r;++o)a[n(t[o])]=1;for(o=0,u=0;o<i;++o)a[n(l=e[o])]?a[n(l)]=0:s[u++]=l;return this._rem=[],this._add=s},Jl.distinct=function(e){const t=this.values(),n={};let i,r=t.length,s=0;for(;--r>=0;)i=e(t[r])+"",Fn(n,i)||(n[i]=1,++s);return s},Jl.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=function(e,t){const n=e.length;let i,r,s,a,o,u=-1;if(null==t){for(;++u<n;)if(r=e[u],null!=r&&r>=r){i=s=r;break}if(u===n)return[-1,-1];for(a=o=u;++u<n;)r=e[u],null!=r&&(i>r&&(i=r,a=u),s<r&&(s=r,o=u))}else{for(;++u<n;)if(r=t(e[u],u,e),null!=r&&r>=r){i=s=r;break}if(u===n)return[-1,-1];for(a=o=u;++u<n;)r=t(e[u],u,e),null!=r&&(i>r&&(i=r,a=u),s<r&&(s=r,o=u))}return[a,o]}(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},Jl.argmin=function(e){return this.extent(e)[0]||{}},Jl.argmax=function(e){return this.extent(e)[1]||{}},Jl.min=function(e){const t=this.extent(e)[0];return null!=t?e(t):void 0},Jl.max=function(e){const t=this.extent(e)[1];return null!=t?e(t):void 0},Jl.quartile=function(e){return this._get===e&&this._q||(this._q=Vu(this.values(),e),this._get=e),this._q},Jl.q1=function(e){return this.quartile(e)[0]},Jl.q2=function(e){return this.quartile(e)[1]},Jl.q3=function(e){return this.quartile(e)[2]},Jl.ci=function(e){return this._get===e&&this._ci||(this._ci=Yu(this.values(),1e3,.05,e),this._get=e),this._ci},Jl.ci0=function(e){return this.ci(e)[0]},Jl.ci1=function(e){return this.ci(e)[1]},Zl.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Ul},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},On(Zl,$u,{transform(e,t){const n=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.modified();return n.stamp=i.stamp,n.value&&(r||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(n.value=n.value||n.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),i.modifies(n._outputs),n._drop=!1!==e.drop,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&i.clean(!0).runAfter((()=>this.clean())),n.changes(i)},cross(){const e=this,t=e.value,n=e._dnames,i=n.map((()=>({}))),r=n.length;function s(e){let t,s,a,o;for(t in e)for(a=e[t].tuple,s=0;s<r;++s)i[s][o=a[n[s]]]=o}s(e._prev),s(t),function s(a,o,u){const l=n[u],c=i[u++];for(const n in c){const i=a?a+"|"+n:n;o[l]=c[n],u<r?s(i,o,u):t[i]||e.cell(i,o)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],i={};function r(e){const n=gn(Mt(e)),r=n.length;let s,a=0;for(;a<r;++a)i[s=n[a]]||(i[s]=1,t.push(s))}this._dims=gn(e.groupby),this._dnames=this._dims.map((e=>{const t=Rt(e);return r(e),n.push(t),t})),this.cellkey=e.key?e.key:Bl(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const s=e.fields||[null],a=e.ops||["count"],o=e.as||[],u=s.length,l={};let c,d,h,f,p,m;for(u!==a.length&&Pt("Unmatched number of fields and aggregate ops."),m=0;m<u;++m)c=s[m],d=a[m],null==c&&"count"!==d&&Pt("Null aggregate field specified."),f=Rt(c),p=zl(d,f,o[m]),n.push(p),"count"!==d?(h=l[f],h||(r(c),h=l[f]=[],h.field=c,this._measures.push(h)),"count"!==d&&(this._countOnly=!1),h.push(Wl(d,p))):this._counts.push(p);return this._measures=this._measures.map((e=>Yl(e,e.field))),{}},cellkey:Bl(),cell(e,t){let n=this.value[e];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const e=this._measures,t=e.length;n.agg=Array(t);for(let i=0;i<t;++i)n.agg[i]=new e[i](n)}return n.store&&(n.data=new Kl),n},newtuple(e,t){const n=this._dnames,i=this._dims,r=i.length,s={};for(let t=0;t<r;++t)s[n[t]]=i[t](e);return t?iu(t.tuple,s):eu(s)},clean(){const e=this.value;for(const t in e)0===e[t].num&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const i=n.agg;for(let t=0,n=i.length;t<n;++t)i[t].add(i[t].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const i=n.agg;for(let t=0,n=i.length;t<n;++t)i[t].rem(i[t].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let i=0,r=n.length;i<r;++i)t[n[i]]=e.num;if(!this._countOnly){const n=e.agg;for(let e=0,i=n.length;e<i;++e)n[e].set(t)}return t},changes(e){const t=this._adds,n=this._mods,i=this._prev,r=this._drop,s=e.add,a=e.rem,o=e.mod;let u,l,c,d;if(i)for(l in i)u=i[l],r&&!u.num||a.push(u.tuple);for(c=0,d=this._alen;c<d;++c)s.push(this.celltuple(t[c])),t[c]=null;for(c=0,d=this._mlen;c<d;++c)u=n[c],(0===u.num&&r?a:o).push(this.celltuple(u)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}}),Ql.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},On(Ql,$u,{transform(e,t){const n=!1!==e.interval,i=this._bins(e),r=i.start,s=i.step,a=e.as||["bin0","bin1"],o=a[0],u=a[1];let l;return l=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(Mt(e.field))?t.ADD_MOD:t.ADD,t.visit(l,n?e=>{const t=i(e);e[o]=t,e[u]=null==t?null:r+s*(1+(t-r)/s)}:e=>e[o]=i(e)),t.modifies(n?a:o)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=Gu(e),i=n.step;let r,s,a=n.start,o=a+Math.ceil((n.stop-a)/i)*i;null!=(r=e.anchor)&&(s=r-(a+i*Math.floor((r-a)/i)),a+=s,o+=s);const u=function(e){let n=rn(t(e));return null==n?null:n<a?-1/0:n>o?1/0:(n=Math.max(a,Math.min(n,o-i)),a+i*Math.floor(1e-14+(n-a)/i))};return u.start=a,u.stop=n.stop,u.step=i,this.value=Tt(u,Mt(t),e.name||"bin_"+Rt(t))}}),tc.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},On(tc,$u,{transform(e,t){const n=t.fork(t.ALL),i=ec(Zo,this.value,n.materialize(n.ADD).add),r=e.sort,s=t.changed()||r&&(e.modified("sort")||t.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(s),this.value=n.source=i.data(ru(r),s),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),On(nc,du),rc.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},On(rc,$u,{transform(e,t){const n=t=>n=>{for(var i,r=function(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(n)}(o(n),e.case,s)||[],u=0,l=r.length;u<l;++u)a.test(i=r[u])||t(i)},i=this._parameterCheck(e,t),r=this._counts,s=this._match,a=this._stop,o=e.field,u=e.as||["text","count"],l=n((e=>r[e]=1+(r[e]||0))),c=n((e=>r[e]-=1));return i?t.visit(t.SOURCE,l):(t.visit(t.ADD,l),t.visit(t.REM,c)),this._finish(t,u)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,i=this._tuples||(this._tuples={}),r=t[0],s=t[1],a=e.fork(e.NO_SOURCE|e.NO_FIELDS);let o,u,l;for(o in n)u=i[o],l=n[o]||0,!u&&l?(i[o]=u=eu({}),u[r]=o,u[s]=l,a.add.push(u)):0===l?(u&&a.rem.push(u),n[o]=null,i[o]=null):u[s]!==l&&(u[s]=l,a.mod.push(u));return a.modifies(t)}}),sc.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},On(sc,$u,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.as||["a","b"],r=i[0],s=i[1],a=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let o=this.value;return a?(o&&(n.rem=o),o=t.materialize(t.SOURCE).source,n.add=this.value=function(e,t,n,i){for(var r,s,a=[],o={},u=e.length,l=0;l<u;++l)for(o[t]=s=e[l],r=0;r<u;++r)o[n]=e[r],i(o)&&(a.push(eu(o)),(o={})[t]=s);return a}(o,r,s,e.filter||Ht)):n.mod=o,n.source=this.value,n.modifies(i)}});const ac={kde:ol,mixture:fl,normal:al,lognormal:hl,uniform:vl};function oc(e,t){const n=e.function;Fn(ac,n)||Pt("Unknown distribution function: "+n);const i=ac[n]();for(const n in e)"field"===n?i.data((e.from||t()).map(e[n])):"distributions"===n?i[n](e[n].map((e=>oc(e,t)))):"function"==typeof i[n]&&i[n](e[n]);return i}function uc(e){$u.call(this,null,e)}const lc=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],cc={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:lc},{name:"weights",type:"number",array:!0}]};function dc(e,t){return e?e.map(((e,n)=>t[n]||Rt(e))):null}function hc(e,t,n){const i=[],r=e=>e(u);let s,a,o,u,l,c;if(null==t)i.push(e.map(n));else for(s={},a=0,o=e.length;a<o;++a)u=e[a],l=t.map(r),c=s[l],c||(s[l]=c=[],c.dims=l,i.push(c)),c.push(n(u));return i}function fc(e){$u.call(this,null,e)}function pc(e){du.call(this,null,mc,e),this.modified(!0)}function mc(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Tt((n=>t(n,e)),Mt(t),Rt(t))}function gc(e){$u.call(this,[void 0,void 0],e)}function yc(e,t){du.call(this,e),this.parent=t,this.count=0}function vc(e){$u.call(this,{},e),this._keys=$n();const t=this._targets=[];t.active=0,t.forEach=e=>{for(let n=0,i=t.active;n<i;++n)e(t[n],n,t)}}function bc(e){du.call(this,null,xc,e)}function xc(e){return this.value&&!e.modified()?this.value:Jt(e.name)?gn(e.name).map((e=>Ut(e))):Ut(e.name,e.as)}function wc(e){$u.call(this,$n(),e)}function Cc(e){$u.call(this,[],e)}function kc(e){$u.call(this,[],e)}function Ac(e){$u.call(this,null,e)}function _c(e){$u.call(this,[],e)}uc.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:lc.concat(cc)},{name:"as",type:"string",array:!0,default:["value","density"]}]},On(uc,$u,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=oc(e.distribution,function(e){return()=>e.materialize(e.SOURCE).source}(t)),r=e.steps||e.minsteps||25,s=e.steps||e.maxsteps||200;let a=e.method||"pdf";"pdf"!==a&&"cdf"!==a&&Pt("Invalid density method: "+a),e.extent||i.data||Pt("Missing density extent parameter."),a=i[a];const o=e.as||["value","density"],u=Tl(a,e.extent||En(i.data()),r,s).map((e=>{const t={};return t[o[0]]=e[0],t[o[1]]=e[1],eu(t)}));this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),fc.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]},On(fc,$u,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,i=hc(t.source,e.groupby,Vt),r=e.smooth||!1,s=e.field,a=e.step||((e,t)=>zn(En(e,t))/30)(n,s),o=ru(((e,t)=>s(e)-s(t))),u=e.as||"bin",l=i.length;let c,d=1/0,h=-1/0,f=0;for(;f<l;++f){const e=i[f].sort(o);c=-1;for(const t of Ku(e,a,r,s))t<d&&(d=t),t>h&&(h=t),e[++c][u]=t}return this.value={start:d,stop:h,step:a},t.reflow(!0).modifies(u)}}),On(pc,du),gc.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},On(gc,$u,{transform(e,t){const n=this.value,i=e.field,r=t.changed()||t.modified(i.fields)||e.modified("field");let s=n[0],a=n[1];if((r||null==s)&&(s=1/0,a=-1/0),t.visit(r?t.SOURCE:t.ADD,(e=>{const t=rn(i(e));null!=t&&(t<s&&(s=t),t>a&&(a=t))})),!Number.isFinite(s)||!Number.isFinite(a)){let e=Rt(i);e&&(e=` for field "${e}"`),t.dataflow.warn(`Infinite extent${e}: [${s}, ${a}]`),s=a=void 0}this.value=[s,a]}}),On(yc,du,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),On(vc,$u,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,i){const r=this.value;let s,a,o=Fn(r,e)&&r[e];return o?o.value.stamp<n.stamp&&(o.init(n),this.activate(o)):(a=i||(a=this._group[e])&&a.tuple,s=n.dataflow,o=new yc(n.fork(n.NO_SOURCE),this),s.add(o).connect(t(s,e,a)),r[e]=o,this.activate(o)),o},clean(){const e=this.value;let t=0;for(const n in e)if(0===e[n].count){const i=e[n].detachSubflow;i&&i(),delete e[n],++t}if(t){const e=this._targets.filter((e=>e&&e.count>0));this.initTargets(e)}},initTargets(e){const t=this._targets,n=t.length,i=e?e.length:0;let r=0;for(;r<i;++r)t[r]=e[r];for(;r<n&&null!=t[r];++r)t[r]=null;t.active=i},transform(e,t){const n=t.dataflow,i=e.key,r=e.subflow,s=this._keys,a=e.modified("key"),o=e=>this.subflow(e,r,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,(e=>{const t=Zo(e),n=s.get(t);void 0!==n&&(s.delete(t),o(n).rem(e))})),t.visit(t.ADD,(e=>{const t=i(e);s.set(Zo(e),t),o(t).add(e)})),a||t.modified(i.fields)?t.visit(t.MOD,(e=>{const t=Zo(e),n=s.get(t),r=i(e);n===r?o(r).mod(e):(s.set(t,r),o(n).rem(e),o(r).add(e))})):t.changed(t.MOD)&&t.visit(t.MOD,(e=>{o(s.get(Zo(e))).mod(e)})),a&&t.visit(t.REFLOW,(e=>{const t=Zo(e),n=s.get(t),r=i(e);n!==r&&(s.set(t,r),o(n).rem(e),o(r).add(e))})),t.clean()?n.runAfter((()=>{this.clean(),s.clean()})):s.empty>n.cleanThreshold&&n.runAfter(s.clean),t}}),On(bc,du),wc.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},On(wc,$u,{transform(e,t){const n=t.dataflow,i=this.value,r=t.fork(),s=r.add,a=r.rem,o=r.mod,u=e.expr;let l=!0;function c(t){const n=Zo(t),r=u(t,e),c=i.get(n);r&&c?(i.delete(n),s.push(t)):r||c?l&&r&&!c&&o.push(t):(i.set(n,1),a.push(t))}return t.visit(t.REM,(e=>{const t=Zo(e);i.has(t)?i.delete(t):a.push(e)})),t.visit(t.ADD,(t=>{u(t,e)?s.push(t):i.set(Zo(t),1)})),t.visit(t.MOD,c),e.modified()&&(l=!1,t.visit(t.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r}}),Cc.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},On(Cc,$u,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=dc(i,e.as||[]),s=e.index||null,a=r.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{const t=i.map((t=>t(e))),o=t.reduce(((e,t)=>Math.max(e,t.length)),0);let u,l,c,d=0;for(;d<o;++d){for(l=tu(e),u=0;u<a;++u)l[r[u]]=null==(c=t[u][d])?null:c;s&&(l[s]=d),n.add.push(l)}})),this.value=n.source=n.add,s&&n.modifies(s),n.modifies(r)}}),kc.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},On(kc,$u,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=i.map(Rt),s=e.as||["key","value"],a=s[0],o=s[1],u=i.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{for(let t,s=0;s<u;++s)t=tu(e),t[a]=r[s],t[o]=i[s](e),n.add.push(t)})),this.value=n.source=n.add,n.modifies(s)}}),Ac.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},On(Ac,$u,{transform(e,t){const n=e.expr,i=e.as,r=e.modified(),s=e.initonly?t.ADD:r?t.SOURCE:t.modified(n.fields)||t.modified(i)?t.ADD_MOD:t.ADD;return r&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(i),t.visit(s,(t=>t[i]=n(t,e)))}}),On(_c,$u,{transform(e,t){const n=t.fork(t.ALL),i=e.generator;let r,s,a,o=this.value,u=e.size-o.length;if(u>0){for(r=[];--u>=0;)r.push(a=eu(i(e))),o.push(a);n.add=n.add.length?n.materialize(n.ADD).add.concat(r):r}else s=o.slice(0,-u),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(s):s,o=o.slice(-u);return n.source=this.value=o,n}});const Ec={value:"value",median:ju,mean:function(e,t){let n=0,i=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(++n,i+=t);else{let r=-1;for(let s of e)null!=(s=t(s,++r,e))&&(s=+s)>=s&&(++n,i+=s)}if(n)return i/n},min:Ru,max:Tu},Sc=[];function Fc(e){$u.call(this,[],e)}function Dc(e){Zl.call(this,e)}function $c(e){$u.call(this,null,e)}function Oc(e){du.call(this,null,Nc,e)}function Nc(e){return this.value&&!e.modified()?this.value:Mn(e.fields,e.flat)}function Ic(e){$u.call(this,[],e),this._pending=null}function Tc(e,t,n){n.forEach(eu);const i=t.fork(t.NO_FIELDS&t.NO_SOURCE);return i.rem=e.value,e.value=i.source=i.add=n,e._pending=null,i.rem.length&&i.clean(!0),i}function Rc(e){$u.call(this,{},e)}function Mc(e){du.call(this,null,Bc,e)}function Bc(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let i,r,s=1/0,a=-1/0;for(i=0;i<n;++i)r=t[i],r[0]<s&&(s=r[0]),r[1]>a&&(a=r[1]);return[s,a]}function zc(e){du.call(this,null,Lc,e)}function Lc(e){return this.value&&!e.modified()?this.value:e.values.reduce(((e,t)=>e.concat(t)),[])}function Pc(e){$u.call(this,null,e)}function jc(e){Zl.call(this,e)}function Uc(e){vc.call(this,e)}function Wc(e){$u.call(this,null,e)}function Vc(e){$u.call(this,null,e)}function qc(e){$u.call(this,null,e)}function Gc(e){$u.call(this,null,e)}function Hc(e){$u.call(this,[],e),this.count=0}function Xc(e){$u.call(this,null,e)}function Yc(e){$u.call(this,null,e),this.modified(!0)}function Kc(e){$u.call(this,null,e)}Fc.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},On(Fc,$u,{transform(e,t){var n,i,r,s,a,o,u,l,c,d,h=t.fork(t.ALL),f=function(e){var t,n=e.method||Ec.value;if(null!=Ec[n])return n===Ec.value?(t=void 0!==e.value?e.value:0,()=>t):Ec[n];Pt("Unrecognized imputation method: "+n)}(e),p=function(e){const t=e.field;return e=>e?t(e):NaN}(e),m=Rt(e.field),g=Rt(e.key),y=(e.groupby||[]).map(Rt),v=function(e,t,n,i){var r,s,a,o,u,l,c,d,h=e=>e(d),f=[],p=i?i.slice():[],m={},g={};for(p.forEach(((e,t)=>m[e]=t+1)),o=0,c=e.length;o<c;++o)l=n(d=e[o]),u=m[l]||(m[l]=p.push(l)),(a=g[s=(r=t?t.map(h):Sc)+""])||(a=g[s]=[],f.push(a),a.values=r),a[u-1]=d;return f.domain=p,f}(t.source,e.groupby,e.key,e.keyvals),b=[],x=this.value,w=v.domain.length;for(a=0,l=v.length;a<l;++a)for(r=(n=v[a]).values,i=NaN,u=0;u<w;++u)if(null==n[u]){for(s=v.domain[u],d={_impute:!0},o=0,c=r.length;o<c;++o)d[y[o]]=r[o];d[g]=s,d[m]=Number.isNaN(i)?i=f(n,p):i,b.push(eu(d))}return b.length&&(h.add=h.materialize(h.ADD).add.concat(b)),x.length&&(h.rem=h.materialize(h.REM).rem.concat(x)),this.value=b,h}}),Dc.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Ul},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},On(Dc,Zl,{transform(e,t){const n=this,i=e.modified();let r;return n.value&&(i||t.modified(n._inputs,!0))?(r=n.value=i?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(r=n.value=n.value||this.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),n.changes(),t.visit(t.SOURCE,(e=>{_n(e,r[n.cellkey(e)].tuple)})),t.reflow(i).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(e[n]),e[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),$c.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},On($c,$u,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=hc(i,e.groupby,e.field),s=(e.groupby||[]).map(Rt),a=e.bandwidth,o=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],l=[];let c=e.extent,d=e.steps||e.minsteps||25,h=e.steps||e.maxsteps||200;"pdf"!==o&&"cdf"!==o&&Pt("Invalid density method: "+o),"shared"===e.resolve&&(c||(c=En(i,e.field)),d=h=e.steps||h),r.forEach((t=>{const n=ol(t,a)[o],i=e.counts?t.length:1;Tl(n,c||En(t),d,h).forEach((e=>{const n={};for(let e=0;e<s.length;++e)n[s[e]]=t.dims[e];n[u[0]]=e[0],n[u[1]]=e[1]*i,l.push(eu(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}}),On(Oc,du),On(Ic,$u,{transform(e,t){const n=t.dataflow;return this._pending?Tc(this,t,this._pending):function(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}(e)?t.StopPropagation:e.values?Tc(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then((e=>(this._pending=gn(e.data),e=>e.touch(this))))}:n.request(e.url,e.format).then((e=>Tc(this,t,gn(e.data))))}}),Rc.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},On(Rc,$u,{transform(e,t){const n=e.fields,i=e.index,r=e.values,s=null==e.default?null:e.default,a=e.modified(),o=n.length;let u,l,c,d=a?t.SOURCE:t.ADD,h=t,f=e.as;return r?(l=r.length,o>1&&!f&&Pt('Multi-field lookup requires explicit "as" parameter.'),f&&f.length!==o*l&&Pt('The "as" parameter has too few output field names.'),f=f||r.map(Rt),u=function(e){for(var t,a,u=0,c=0;u<o;++u)if(null==(a=i.get(n[u](e))))for(t=0;t<l;++t,++c)e[f[c]]=s;else for(t=0;t<l;++t,++c)e[f[c]]=r[t](a)}):(f||Pt("Missing output field names."),u=function(e){for(var t,r=0;r<o;++r)t=i.get(n[r](e)),e[f[r]]=null==t?s:t}),a?h=t.reflow(!0):(c=n.some((e=>t.modified(e.fields))),d|=c?t.MOD:0),t.visit(d,u),h.modifies(f)}}),On(Mc,du),On(zc,du),On(Pc,$u,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),jc.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Ul,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},On(jc,Zl,{_transform:Zl.prototype.transform,transform(e,t){return this._transform(function(e,t){const n=e.field,i=e.value,r=("count"===e.op?"__count__":e.op)||"sum",s=Mt(n).concat(Mt(i)),a=function(e,t,n){const i={},r=[];return n.visit(n.SOURCE,(t=>{const n=e(t);i[n]||(i[n]=1,r.push(n))})),r.sort(bn),t?r.slice(0,t):r}(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:a.map((()=>r)),fields:a.map((e=>function(e,t,n,i){return Tt((i=>t(i)===e?n(i):NaN),i,e+"")}(e,n,i,s))),as:a.map((e=>e+"")),modified:e.modified.bind(e)}}(e,t),t)}}),On(Uc,vc,{transform(e,t){const n=e.subflow,i=e.field,r=e=>this.subflow(Zo(e),n,t,e);return(e.modified("field")||i&&t.modified(Mt(i)))&&Pt("PreFacet does not support field modification."),this.initTargets(),i?(t.visit(t.MOD,(e=>{const t=r(e);i(e).forEach((e=>t.mod(e)))})),t.visit(t.ADD,(e=>{const t=r(e);i(e).forEach((e=>t.add(eu(e))))})),t.visit(t.REM,(e=>{const t=r(e);i(e).forEach((e=>t.rem(e)))}))):(t.visit(t.MOD,(e=>r(e).mod(e))),t.visit(t.ADD,(e=>r(e).add(e))),t.visit(t.REM,(e=>r(e).rem(e)))),t.clean()&&t.runAfter((()=>this.clean())),t}}),Wc.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},On(Wc,$u,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=dc(e.fields,e.as||[]),s=i?(e,t)=>function(e,t,n,i){for(let r=0,s=n.length;r<s;++r)t[i[r]]=n[r](e);return t}(e,t,i,r):nu;let a;return this.value?a=this.value:(t=t.addAll(),a=this.value={}),t.visit(t.REM,(e=>{const t=Zo(e);n.rem.push(a[t]),a[t]=null})),t.visit(t.ADD,(e=>{const t=s(e,eu({}));a[Zo(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{n.mod.push(s(e,a[Zo(e)]))})),n}}),On(Vc,$u,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),qc.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]},On(qc,$u,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const r=hc(t.materialize(t.SOURCE).source,e.groupby,e.field),s=(e.groupby||[]).map(Rt),a=[],o=e.step||.01,u=e.probs||Ml(o/2,1-1e-14,o),l=u.length;return r.forEach((e=>{const t=Wu(e,u);for(let n=0;n<l;++n){const r={};for(let t=0;t<s.length;++t)r[s[t]]=e.dims[t];r[i[0]]=u[n],r[i[1]]=t[n],a.push(eu(r))}})),this.value&&(n.rem=this.value),this.value=n.add=n.source=a,n}}),On(Gc,$u,{transform(e,t){let n,i;return this.value?i=this.value:(n=t=t.addAll(),i=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,(e=>{const t=Zo(e);n.rem.push(i[t]),i[t]=null})),t.visit(t.ADD,(e=>{const t=tu(e);i[Zo(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{const t=i[Zo(e)];for(const i in e)t[i]=e[i],n.modifies(i);n.mod.push(t)}))),n}}),Hc.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},On(Hc,$u,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.modified("size"),r=e.size,s=this.value.reduce(((e,t)=>(e[Zo(t)]=1,e)),{});let a=this.value,o=this.count,u=0;function l(e){let t,i;a.length<r?a.push(e):(i=~~((o+1)*Hu()),i<a.length&&i>=u&&(t=a[i],s[Zo(t)]&&n.rem.push(t),a[i]=e)),++o}if(t.rem.length&&(t.visit(t.REM,(e=>{const t=Zo(e);s[t]&&(s[t]=-1,n.rem.push(e)),--o})),a=a.filter((e=>-1!==s[Zo(e)]))),(t.rem.length||i)&&a.length<r&&t.source&&(u=o=a.length,t.visit(t.SOURCE,(e=>{s[Zo(e)]||l(e)})),u=-1),i&&a.length>r){const e=a.length-r;for(let t=0;t<e;++t)s[Zo(a[t])]=-1,n.rem.push(a[t]);a=a.slice(e)}return t.mod.length&&t.visit(t.MOD,(e=>{s[Zo(e)]&&n.mod.push(e)})),t.add.length&&t.visit(t.ADD,l),(t.add.length||u<0)&&(n.add=a.filter((e=>!s[Zo(e)]))),this.count=o,this.value=n.source=a,n}}),Xc.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},On(Xc,$u,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),i=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=Ml(e.start,e.stop,e.step||1).map((e=>{const t={};return t[i]=e,eu(t)})),n.add=t.add.concat(this.value),n}}),On(Yc,$u,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const Jc=["unit0","unit1"];function Zc(e){$u.call(this,$n(),e)}function Qc(e){$u.call(this,null,e)}Kc.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:zr,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Jc}]},On(Kc,$u,{transform(e,t){const n=e.field,i=!1!==e.interval,r="utc"===e.timezone,s=this._floor(e,t),a=(r?ps:fs)(s.unit).offset,o=e.as||Jc,u=o[0],l=o[1],c=s.step;let d=s.start||1/0,h=s.stop||-1/0,f=t.ADD;return(e.modified()||t.modified(Mt(n)))&&(f=(t=t.reflow(!0)).SOURCE,d=1/0,h=-1/0),t.visit(f,(e=>{const t=n(e);let r,o;null==t?(e[u]=null,i&&(e[l]=null)):(e[u]=r=o=s(t),i&&(e[l]=o=a(r,c)),r<d&&(d=r),o>h&&(h=o))})),s.start=d,s.stop=h,t.modifies(i?o:u)},_floor(e,t){const n="utc"===e.timezone,{units:i,step:r}=e.units?{units:e.units,step:e.step||1}:$s({extent:e.extent||En(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),s=Pr(i),a=this.value||{},o=(n?cs:os)(s,r);return o.unit=nn(s),o.units=s,o.step=r,o.start=a.start,o.stop=a.stop,this.value=o}}),On(Zc,$u,{transform(e,t){const n=t.dataflow,i=e.field,r=this.value,s=e=>r.set(i(e),e);let a=!0;return e.modified("field")||t.modified(i.fields)?(r.clear(),t.visit(t.SOURCE,s)):t.changed()?(t.visit(t.REM,(e=>r.delete(i(e)))),t.visit(t.ADD,s)):a=!1,this.modified(a),r.empty>n.cleanThreshold&&n.runAfter(r.clean),t.fork()}}),On(Qc,$u,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(ru(e.sort)):t.source).map(e.field))}});const ed={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?++e:e}}},percent_rank:function(){const e=ed.rank(),t=e.next;return{init:e.init,next:e=>(t(e)-1)/(e.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,i=t.compare;let r=t.index;if(e<r){for(;r+1<n.length&&!i(n[r],n[r+1]);)++r;e=r}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||Pt("ntile num must be greater than zero.");const n=ed.cume_dist(),i=n.next;return{init:n.init,next:e=>Math.ceil(t*i(e))}},lag:function(e,t){return t=+t||1,{next:n=>{const i=n.index-t;return i>=0?e(n.data[i]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const i=n.index+t,r=n.data;return i<r.length?e(r[i]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||Pt("nth_value nth must be greater than zero."),{next:n=>{const i=n.i0+(t-1);return i<n.i1?e(n.data[i]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const i=e(n.data[n.index]);return null!=i?t=i:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:i=>{const r=i.data;return i.index<=n?t:(n=function(e,t,n){for(let i=t.length;n<i;++n)if(null!=e(t[n]))return n;return-1}(e,r,i.index))<0?(n=r.length,t=null):t=e(r[n])}}}},td=Object.keys(ed);function nd(e){const t=gn(e.ops),n=gn(e.fields),i=gn(e.params),r=gn(e.as),s=this.outputs=[],a=this.windows=[],o={},u={},l=[],c=[];let d=!0;function h(e){gn(Mt(e)).forEach((e=>o[e]=1))}h(e.sort),t.forEach(((e,t)=>{const o=n[t],f=Rt(o),p=zl(e,f,r[t]);if(h(o),s.push(p),Fn(ed,e))a.push(function(e,t,n,i){const r=ed[e](t,n);return{init:r.init||qt,update:function(e,t){t[i]=r.next(e)}}}(e,n[t],i[t],p));else{if(null==o&&"count"!==e&&Pt("Null aggregate field specified."),"count"===e)return void l.push(p);d=!1;let t=u[f];t||(t=u[f]=[],t.field=o,c.push(t)),t.push(Wl(e,p))}})),(l.length||c.length)&&(this.cell=function(e,t,n){e=e.map((e=>Yl(e,e.field)));const i={num:0,agg:null,store:!1,count:t};if(!n)for(var r=e.length,s=i.agg=Array(r),a=0;a<r;++a)s[a]=new e[a](i);if(i.store)var o=i.data=new Kl;return i.add=function(e){if(i.num+=1,!n){o&&o.add(e);for(let t=0;t<r;++t)s[t].add(s[t].get(e),e)}},i.rem=function(e){if(i.num-=1,!n){o&&o.rem(e);for(let t=0;t<r;++t)s[t].rem(s[t].get(e),e)}},i.set=function(e){let r,a;for(o&&o.values(),r=0,a=t.length;r<a;++r)e[t[r]]=i.num;if(!n)for(r=0,a=s.length;r<a;++r)s[r].set(e)},i.init=function(){i.num=0,o&&o.reset();for(let e=0;e<r;++e)s[e].init()},i}(c,l,d)),this.inputs=Object.keys(o)}const id=nd.prototype;function rd(e){$u.call(this,{},e),this._mlen=0,this._mods=[]}function sd(e,t,n,i){const r=i.sort,s=r&&!i.ignorePeers,a=i.frame||[null,0],o=e.data(n),u=o.length,l=s?Er(r):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:o,compare:r||kn(-1)};t.init();for(let e=0;e<u;++e)ad(c,a,e,u),s&&od(c,l),t.update(c,o[e])}function ad(e,t,n,i){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,n-Math.abs(t[0])),e.i1=null==t[1]?i:Math.min(i,n+Math.abs(t[1])+1),e.index=n}function od(e,t){const n=e.i0,i=e.i1-1,r=e.compare,s=e.data,a=s.length-1;n>0&&!r(s[n],s[n-1])&&(e.i0=t.left(s,s[n])),i<a&&!r(s[i],s[i+1])&&(e.i1=t.right(s,s[i]))}function ud(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function ld(e){this._context=e}function cd(){}function dd(e){this._context=e}function hd(e){this._context=e}function fd(e,t){this._basis=new ld(e),this._beta=t}id.init=function(){this.windows.forEach((e=>e.init())),this.cell&&this.cell.init()},id.update=function(e,t){const n=this.cell,i=this.windows,r=e.data,s=i&&i.length;let a;if(n){for(a=e.p0;a<e.i0;++a)n.rem(r[a]);for(a=e.p1;a<e.i1;++a)n.add(r[a]);n.set(t)}for(a=0;a<s;++a)i[a].update(e,t)},rd.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:td.concat(Ul)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},On(rd,$u,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),i=ru(e.sort),r=Bl(e.groupby),s=e=>this.group(r(e));let a=this.state;a&&!n||(a=this.state=new nd(e)),n||t.modified(a.inputs)?(this.value={},t.visit(t.SOURCE,(e=>s(e).add(e)))):(t.visit(t.REM,(e=>s(e).remove(e))),t.visit(t.ADD,(e=>s(e).add(e))));for(let t=0,n=this._mlen;t<n;++t)sd(this._mods[t],a,i,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(a.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=ec(Zo),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}}),ld.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:ud(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:ud(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},dd.prototype={areaStart:cd,areaEnd:cd,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:ud(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},hd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:ud(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},fd.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var i,r=e[0],s=t[0],a=e[n]-r,o=t[n]-s,u=-1;++u<=n;)i=u/n,this._basis.point(this._beta*e[u]+(1-this._beta)*(r+i*a),this._beta*t[u]+(1-this._beta)*(s+i*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const pd=function e(t){function n(e){return 1===t?new ld(e):new fd(e,t)}return n.beta=function(t){return e(+t)},n}(.85);function md(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function gd(e,t){this._context=e,this._k=(1-t)/6}gd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:md(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:md(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const yd=function e(t){function n(e){return new gd(e,t)}return n.tension=function(t){return e(+t)},n}(0);function vd(e,t){this._context=e,this._k=(1-t)/6}vd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:md(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const bd=function e(t){function n(e){return new vd(e,t)}return n.tension=function(t){return e(+t)},n}(0);function xd(e,t){this._context=e,this._k=(1-t)/6}xd.prototype={areaStart:cd,areaEnd:cd,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:md(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const wd=function e(t){function n(e){return new xd(e,t)}return n.tension=function(t){return e(+t)},n}(0);var Cd=Math.abs,kd=Math.atan2,Ad=Math.cos,_d=Math.max,Ed=Math.min,Sd=Math.sin,Fd=Math.sqrt,Dd=1e-12,$d=Math.PI,Od=$d/2,Nd=2*$d;function Id(e){return e>1?0:e<-1?$d:Math.acos(e)}function Td(e){return e>=1?Od:e<=-1?-Od:Math.asin(e)}function Rd(e,t,n){var i=e._x1,r=e._y1,s=e._x2,a=e._y2;if(e._l01_a>Dd){var o=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*o-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,r=(r*o-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>Dd){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*l+e._x1*e._l23_2a-t*e._l12_2a)/c,a=(a*l+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(i,r,s,a,e._x2,e._y2)}function Md(e,t){this._context=e,this._alpha=t}Md.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Rd(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Bd=function e(t){function n(e){return t?new Md(e,t):new gd(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function zd(e,t){this._context=e,this._alpha=t}zd.prototype={areaStart:cd,areaEnd:cd,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Rd(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Ld=function e(t){function n(e){return t?new zd(e,t):new xd(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Pd(e,t){this._context=e,this._alpha=t}Pd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Rd(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const jd=function e(t){function n(e){return t?new Pd(e,t):new vd(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Ud(e){this._context=e}function Wd(e){return new Ud(e)}function Vd(e){this._context=e}function qd(e){return e<0?-1:1}function Gd(e,t,n){var i=e._x1-e._x0,r=t-e._x1,s=(e._y1-e._y0)/(i||r<0&&-0),a=(n-e._y1)/(r||i<0&&-0),o=(s*r+a*i)/(i+r);return(qd(s)+qd(a))*Math.min(Math.abs(s),Math.abs(a),.5*Math.abs(o))||0}function Hd(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Xd(e,t,n){var i=e._x0,r=e._y0,s=e._x1,a=e._y1,o=(s-i)/3;e._context.bezierCurveTo(i+o,r+o*t,s-o,a-o*n,s,a)}function Yd(e){this._context=e}function Kd(e){this._context=new Jd(e)}function Jd(e){this._context=e}function Zd(e){this._context=e}function Qd(e){var t,n,i=e.length-1,r=new Array(i),s=new Array(i),a=new Array(i);for(r[0]=0,s[0]=2,a[0]=e[0]+2*e[1],t=1;t<i-1;++t)r[t]=1,s[t]=4,a[t]=4*e[t]+2*e[t+1];for(r[i-1]=2,s[i-1]=7,a[i-1]=8*e[i-1]+e[i],t=1;t<i;++t)n=r[t]/s[t-1],s[t]-=n,a[t]-=n*a[t-1];for(r[i-1]=a[i-1]/s[i-1],t=i-2;t>=0;--t)r[t]=(a[t]-r[t+1])/s[t];for(s[i-1]=(e[i]+r[i-1])/2,t=0;t<i-1;++t)s[t]=2*e[t+1]-r[t+1];return[r,s]}function eh(e,t){this._context=e,this._t=t}Ud.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}},Vd.prototype={areaStart:cd,areaEnd:cd,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},Yd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Xd(this,this._t0,Hd(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Xd(this,Hd(this,n=Gd(this,e,t)),n);break;default:Xd(this,this._t0,n=Gd(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(Kd.prototype=Object.create(Yd.prototype)).point=function(e,t){Yd.prototype.point.call(this,t,e)},Jd.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,i,r,s){this._context.bezierCurveTo(t,e,i,n,s,r)}},Zd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var i=Qd(e),r=Qd(t),s=0,a=1;a<n;++s,++a)this._context.bezierCurveTo(i[0][s],r[0][s],i[1][s],r[1][s],e[a],t[a]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},eh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const th=Math.PI,nh=2*th,ih=1e-6,rh=nh-ih;function sh(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function ah(){return new sh}sh.prototype=ah.prototype={constructor:sh,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,i){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(e,t,n,i,r,s){this._+="C"+ +e+","+ +t+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+s)},arcTo:function(e,t,n,i,r){e=+e,t=+t,n=+n,i=+i,r=+r;var s=this._x1,a=this._y1,o=n-e,u=i-t,l=s-e,c=a-t,d=l*l+c*c;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(d>ih)if(Math.abs(c*o-u*l)>ih&&r){var h=n-s,f=i-a,p=o*o+u*u,m=h*h+f*f,g=Math.sqrt(p),y=Math.sqrt(d),v=r*Math.tan((th-Math.acos((p+d-m)/(2*g*y)))/2),b=v/y,x=v/g;Math.abs(b-1)>ih&&(this._+="L"+(e+b*l)+","+(t+b*c)),this._+="A"+r+","+r+",0,0,"+ +(c*h>l*f)+","+(this._x1=e+x*o)+","+(this._y1=t+x*u)}else this._+="L"+(this._x1=e)+","+(this._y1=t)},arc:function(e,t,n,i,r,s){e=+e,t=+t,s=!!s;var a=(n=+n)*Math.cos(i),o=n*Math.sin(i),u=e+a,l=t+o,c=1^s,d=s?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+u+","+l:(Math.abs(this._x1-u)>ih||Math.abs(this._y1-l)>ih)&&(this._+="L"+u+","+l),n&&(d<0&&(d=d%nh+nh),d>rh?this._+="A"+n+","+n+",0,1,"+c+","+(e-a)+","+(t-o)+"A"+n+","+n+",0,1,"+c+","+(this._x1=u)+","+(this._y1=l):d>ih&&(this._+="A"+n+","+n+",0,"+ +(d>=th)+","+c+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r))))},rect:function(e,t,n,i){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};const oh=ah;function uh(e){return function(){return e}}function lh(e){return e.innerRadius}function ch(e){return e.outerRadius}function dh(e){return e.startAngle}function hh(e){return e.endAngle}function fh(e){return e&&e.padAngle}function ph(e,t,n,i,r,s,a,o){var u=n-e,l=i-t,c=a-r,d=o-s,h=d*u-c*l;if(!(h*h<Dd))return[e+(h=(c*(t-s)-d*(e-r))/h)*u,t+h*l]}function mh(e,t,n,i,r,s,a){var o=e-n,u=t-i,l=(a?s:-s)/Fd(o*o+u*u),c=l*u,d=-l*o,h=e+c,f=t+d,p=n+c,m=i+d,g=(h+p)/2,y=(f+m)/2,v=p-h,b=m-f,x=v*v+b*b,w=r-s,C=h*m-p*f,k=(b<0?-1:1)*Fd(_d(0,w*w*x-C*C)),A=(C*b-v*k)/x,_=(-C*v-b*k)/x,E=(C*b+v*k)/x,S=(-C*v+b*k)/x,F=A-g,D=_-y,$=E-g,O=S-y;return F*F+D*D>$*$+O*O&&(A=E,_=S),{cx:A,cy:_,x01:-c,y01:-d,x11:A*(r/w-1),y11:_*(r/w-1)}}function gh(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function yh(e){return e[0]}function vh(e){return e[1]}function bh(e,t){var n=uh(!0),i=null,r=Wd,s=null;function a(a){var o,u,l,c=(a=gh(a)).length,d=!1;for(null==i&&(s=r(l=oh())),o=0;o<=c;++o)!(o<c&&n(u=a[o],o,a))===d&&((d=!d)?s.lineStart():s.lineEnd()),d&&s.point(+e(u,o,a),+t(u,o,a));if(l)return s=null,l+""||null}return e="function"==typeof e?e:void 0===e?yh:uh(e),t="function"==typeof t?t:void 0===t?vh:uh(t),a.x=function(t){return arguments.length?(e="function"==typeof t?t:uh(+t),a):e},a.y=function(e){return arguments.length?(t="function"==typeof e?e:uh(+e),a):t},a.defined=function(e){return arguments.length?(n="function"==typeof e?e:uh(!!e),a):n},a.curve=function(e){return arguments.length?(r=e,null!=i&&(s=r(i)),a):r},a.context=function(e){return arguments.length?(null==e?i=s=null:s=r(i=e),a):i},a}function xh(e,t,n){var i=null,r=uh(!0),s=null,a=Wd,o=null;function u(u){var l,c,d,h,f,p=(u=gh(u)).length,m=!1,g=new Array(p),y=new Array(p);for(null==s&&(o=a(f=oh())),l=0;l<=p;++l){if(!(l<p&&r(h=u[l],l,u))===m)if(m=!m)c=l,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),d=l-1;d>=c;--d)o.point(g[d],y[d]);o.lineEnd(),o.areaEnd()}m&&(g[l]=+e(h,l,u),y[l]=+t(h,l,u),o.point(i?+i(h,l,u):g[l],n?+n(h,l,u):y[l]))}if(f)return o=null,f+""||null}function l(){return bh().defined(r).curve(a).context(s)}return e="function"==typeof e?e:void 0===e?yh:uh(+e),t="function"==typeof t?t:uh(void 0===t?0:+t),n="function"==typeof n?n:void 0===n?vh:uh(+n),u.x=function(t){return arguments.length?(e="function"==typeof t?t:uh(+t),i=null,u):e},u.x0=function(t){return arguments.length?(e="function"==typeof t?t:uh(+t),u):e},u.x1=function(e){return arguments.length?(i=null==e?null:"function"==typeof e?e:uh(+e),u):i},u.y=function(e){return arguments.length?(t="function"==typeof e?e:uh(+e),n=null,u):t},u.y0=function(e){return arguments.length?(t="function"==typeof e?e:uh(+e),u):t},u.y1=function(e){return arguments.length?(n=null==e?null:"function"==typeof e?e:uh(+e),u):n},u.lineX0=u.lineY0=function(){return l().x(e).y(t)},u.lineY1=function(){return l().x(e).y(n)},u.lineX1=function(){return l().x(i).y(t)},u.defined=function(e){return arguments.length?(r="function"==typeof e?e:uh(!!e),u):r},u.curve=function(e){return arguments.length?(a=e,null!=s&&(o=a(s)),u):a},u.context=function(e){return arguments.length?(null==e?s=o=null:o=a(s=e),u):s},u}Array.prototype.slice;const wh={draw:function(e,t){var n=Math.sqrt(t/$d);e.moveTo(n,0),e.arc(0,0,n,0,Nd)}};Math.sqrt(1/3);Math.sin($d/10),Math.sin(7*$d/10);function Ch(e,t){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}Math.sin(Nd/10),Math.cos(Nd/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12);const kh=()=>"undefined"!=typeof Image?Image:null,Ah=Er(_r),_h=Ah.right,Eh=Ah.left,Sh=(Er(zu).center,_h);function Fh(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Dh(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const $h=Symbol("implicit");function Oh(){var e=new Map,t=[],n=[],i=$h;function r(r){var s=r+"",a=e.get(s);if(!a){if(i!==$h)return i;e.set(s,a=t.push(r))}return n[(a-1)%n.length]}return r.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Map;for(const i of n){const n=i+"";e.has(n)||e.set(n,t.push(i))}return r},r.range=function(e){return arguments.length?(n=Array.from(e),r):n.slice()},r.unknown=function(e){return arguments.length?(i=e,r):i},r.copy=function(){return Oh(t,n).unknown(i)},Fh.apply(r,arguments),r}function Nh(e,t,n,i){var r,s=di(e,t,n);switch((i=pi(null==i?",f":i)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=i.precision||isNaN(r=vi(s,a))||(i.precision=r),Ei(i,a);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=bi(s,Math.max(Math.abs(e),Math.abs(t))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=xi(s))||(i.precision=r-2*("%"===i.type))}return _i(i)}function Ih(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Th(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Rh(){}var Mh=.7,Bh=1/Mh,zh="\\s*([+-]?\\d+)\\s*",Lh="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ph="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",jh=/^#([0-9a-f]{3,8})$/,Uh=new RegExp("^rgb\\("+[zh,zh,zh]+"\\)$"),Wh=new RegExp("^rgb\\("+[Ph,Ph,Ph]+"\\)$"),Vh=new RegExp("^rgba\\("+[zh,zh,zh,Lh]+"\\)$"),qh=new RegExp("^rgba\\("+[Ph,Ph,Ph,Lh]+"\\)$"),Gh=new RegExp("^hsl\\("+[Lh,Ph,Ph]+"\\)$"),Hh=new RegExp("^hsla\\("+[Lh,Ph,Ph,Lh]+"\\)$"),Xh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Yh(){return this.rgb().formatHex()}function Kh(){return this.rgb().formatRgb()}function Jh(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=jh.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Zh(t):3===n?new nf(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Qh(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Qh(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Uh.exec(e))?new nf(t[1],t[2],t[3],1):(t=Wh.exec(e))?new nf(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Vh.exec(e))?Qh(t[1],t[2],t[3],t[4]):(t=qh.exec(e))?Qh(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Gh.exec(e))?of(t[1],t[2]/100,t[3]/100,1):(t=Hh.exec(e))?of(t[1],t[2]/100,t[3]/100,t[4]):Xh.hasOwnProperty(e)?Zh(Xh[e]):"transparent"===e?new nf(NaN,NaN,NaN,0):null}function Zh(e){return new nf(e>>16&255,e>>8&255,255&e,1)}function Qh(e,t,n,i){return i<=0&&(e=t=n=NaN),new nf(e,t,n,i)}function ef(e){return e instanceof Rh||(e=Jh(e)),e?new nf((e=e.rgb()).r,e.g,e.b,e.opacity):new nf}function tf(e,t,n,i){return 1===arguments.length?ef(e):new nf(e,t,n,null==i?1:i)}function nf(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function rf(){return"#"+af(this.r)+af(this.g)+af(this.b)}function sf(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function af(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function of(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new cf(e,t,n,i)}function uf(e){if(e instanceof cf)return new cf(e.h,e.s,e.l,e.opacity);if(e instanceof Rh||(e=Jh(e)),!e)return new cf;if(e instanceof cf)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),s=Math.max(t,n,i),a=NaN,o=s-r,u=(s+r)/2;return o?(a=t===s?(n-i)/o+6*(n<i):n===s?(i-t)/o+2:(t-n)/o+4,o/=u<.5?s+r:2-s-r,a*=60):o=u>0&&u<1?0:a,new cf(a,o,u,e.opacity)}function lf(e,t,n,i){return 1===arguments.length?uf(e):new cf(e,t,n,null==i?1:i)}function cf(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function df(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function hf(e,t,n,i,r){var s=e*e,a=s*e;return((1-3*e+3*s-a)*t+(4-6*s+3*a)*n+(1+3*e+3*s-3*a)*i+a*r)/6}function ff(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],s=e[i+1],a=i>0?e[i-1]:2*r-s,o=i<t-1?e[i+2]:2*s-r;return hf((n-i/t)*t,a,r,s,o)}}function pf(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],s=e[i%t],a=e[(i+1)%t],o=e[(i+2)%t];return hf((n-i/t)*t,r,s,a,o)}}Ih(Rh,Jh,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Yh,formatHex:Yh,formatHsl:function(){return uf(this).formatHsl()},formatRgb:Kh,toString:Kh}),Ih(nf,tf,Th(Rh,{brighter:function(e){return e=null==e?Bh:Math.pow(Bh,e),new nf(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?Mh:Math.pow(Mh,e),new nf(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rf,formatHex:rf,formatRgb:sf,toString:sf})),Ih(cf,lf,Th(Rh,{brighter:function(e){return e=null==e?Bh:Math.pow(Bh,e),new cf(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Mh:Math.pow(Mh,e),new cf(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new nf(df(e>=240?e-240:e+120,r,i),df(e,r,i),df(e<120?e+240:e-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const mf=e=>()=>e;function gf(e,t){return function(n){return e+n*t}}function yf(e,t){var n=t-e;return n?gf(e,n>180||n<-180?n-360*Math.round(n/360):n):mf(isNaN(e)?t:e)}function vf(e,t){var n=t-e;return n?gf(e,n):mf(isNaN(e)?t:e)}const bf=function e(t){var n=function(e){return 1==(e=+e)?vf:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):mf(isNaN(t)?n:t)}}(t);function i(e,t){var i=n((e=tf(e)).r,(t=tf(t)).r),r=n(e.g,t.g),s=n(e.b,t.b),a=vf(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=r(t),e.b=s(t),e.opacity=a(t),e+""}}return i.gamma=e,i}(1);function xf(e){return function(t){var n,i,r=t.length,s=new Array(r),a=new Array(r),o=new Array(r);for(n=0;n<r;++n)i=tf(t[n]),s[n]=i.r||0,a[n]=i.g||0,o[n]=i.b||0;return s=e(s),a=e(a),o=e(o),i.opacity=1,function(e){return i.r=s(e),i.g=a(e),i.b=o(e),i+""}}}var wf=xf(ff),Cf=xf(pf);function kf(e,t){t||(t=[]);var n,i=e?Math.min(t.length,e.length):0,r=t.slice();return function(s){for(n=0;n<i;++n)r[n]=e[n]*(1-s)+t[n]*s;return r}}function Af(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function _f(e,t){return(Af(t)?kf:Ef)(e,t)}function Ef(e,t){var n,i=t?t.length:0,r=e?Math.min(i,e.length):0,s=new Array(r),a=new Array(i);for(n=0;n<r;++n)s[n]=If(e[n],t[n]);for(;n<i;++n)a[n]=t[n];return function(e){for(n=0;n<r;++n)a[n]=s[n](e);return a}}function Sf(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function Ff(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Df(e,t){var n,i={},r={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?i[n]=If(e[n],t[n]):r[n]=t[n];return function(e){for(n in i)r[n]=i[n](e);return r}}var $f=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Of=new RegExp($f.source,"g");function Nf(e,t){var n,i,r,s=$f.lastIndex=Of.lastIndex=0,a=-1,o=[],u=[];for(e+="",t+="";(n=$f.exec(e))&&(i=Of.exec(t));)(r=i.index)>s&&(r=t.slice(s,r),o[a]?o[a]+=r:o[++a]=r),(n=n[0])===(i=i[0])?o[a]?o[a]+=i:o[++a]=i:(o[++a]=null,u.push({i:a,x:Ff(n,i)})),s=Of.lastIndex;return s<t.length&&(r=t.slice(s),o[a]?o[a]+=r:o[++a]=r),o.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,i=0;i<t;++i)o[(n=u[i]).i]=n.x(e);return o.join("")})}function If(e,t){var n,i=typeof t;return null==t||"boolean"===i?mf(t):("number"===i?Ff:"string"===i?(n=Jh(t))?(t=n,bf):Nf:t instanceof Jh?bf:t instanceof Date?Sf:Af(t)?kf:Array.isArray(t)?Ef:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Df:Ff)(e,t)}function Tf(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Rf(e){return+e}var Mf=[0,1];function Bf(e){return e}function zf(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function Lf(e,t,n){var i=e[0],r=e[1],s=t[0],a=t[1];return r<i?(i=zf(r,i),s=n(a,s)):(i=zf(i,r),s=n(s,a)),function(e){return s(i(e))}}function Pf(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),s=new Array(i),a=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<i;)r[a]=zf(e[a],e[a+1]),s[a]=n(t[a],t[a+1]);return function(t){var n=Sh(e,t,1,i)-1;return s[n](r[n](t))}}function jf(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Uf(){var e,t,n,i,r,s,a=Mf,o=Mf,u=If,l=Bf;function c(){var e=Math.min(a.length,o.length);return l!==Bf&&(l=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(a[0],a[e-1])),i=e>2?Pf:Lf,r=s=null,d}function d(t){return null==t||isNaN(t=+t)?n:(r||(r=i(a.map(e),o,u)))(e(l(t)))}return d.invert=function(n){return l(t((s||(s=i(o,a.map(e),Ff)))(n)))},d.domain=function(e){return arguments.length?(a=Array.from(e,Rf),c()):a.slice()},d.range=function(e){return arguments.length?(o=Array.from(e),c()):o.slice()},d.rangeRound=function(e){return o=Array.from(e),u=Tf,c()},d.clamp=function(e){return arguments.length?(l=!!e||Bf,c()):l!==Bf},d.interpolate=function(e){return arguments.length?(u=e,c()):u},d.unknown=function(e){return arguments.length?(n=e,d):n},function(n,i){return e=n,t=i,c()}}function Wf(){return Uf()(Bf,Bf)}function Vf(e){var t=e.domain;return e.ticks=function(e){var n=t();return li(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var i=t();return Nh(i[0],i[i.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var i,r,s=t(),a=0,o=s.length-1,u=s[a],l=s[o],c=10;for(l<u&&(r=u,u=l,l=r,r=a,a=o,o=r);c-- >0;){if((r=ci(u,l,n))===i)return s[a]=u,s[o]=l,t(s);if(r>0)u=Math.floor(u/r)*r,l=Math.ceil(l/r)*r;else{if(!(r<0))break;u=Math.ceil(u*r)/r,l=Math.floor(l*r)/r}i=r}return e},e}function qf(e,t){var n,i=0,r=(e=e.slice()).length-1,s=e[i],a=e[r];return a<s&&(n=i,i=r,r=n,n=s,s=a,a=n),e[i]=t.floor(s),e[r]=t.ceil(a),e}function Gf(e){return Math.log(e)}function Hf(e){return Math.exp(e)}function Xf(e){return-Math.log(-e)}function Yf(e){return-Math.exp(-e)}function Kf(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Jf(e){return function(t){return-e(-t)}}function Zf(e){var t,n,i=e(Gf,Hf),r=i.domain,s=10;function a(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(s),n=function(e){return 10===e?Kf:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(s),r()[0]<0?(t=Jf(t),n=Jf(n),e(Xf,Yf)):e(Gf,Hf),i}return i.base=function(e){return arguments.length?(s=+e,a()):s},i.domain=function(e){return arguments.length?(r(e),a()):r()},i.ticks=function(e){var i,a=r(),o=a[0],u=a[a.length-1];(i=u<o)&&(h=o,o=u,u=h);var l,c,d,h=t(o),f=t(u),p=null==e?10:+e,m=[];if(!(s%1)&&f-h<p){if(h=Math.floor(h),f=Math.ceil(f),o>0){for(;h<=f;++h)for(c=1,l=n(h);c<s;++c)if(!((d=l*c)<o)){if(d>u)break;m.push(d)}}else for(;h<=f;++h)for(c=s-1,l=n(h);c>=1;--c)if(!((d=l*c)<o)){if(d>u)break;m.push(d)}2*m.length<p&&(m=li(o,u,p))}else m=li(h,f,Math.min(f-h,p)).map(n);return i?m.reverse():m},i.tickFormat=function(e,r){if(null==r&&(r=10===s?".0e":","),"function"!=typeof r&&(r=_i(r)),e===1/0)return r;null==e&&(e=10);var a=Math.max(1,s*e/i.ticks().length);return function(e){var i=e/n(Math.round(t(e)));return i*s<s-.5&&(i*=s),i<=a?r(e):""}},i.nice=function(){return r(qf(r(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},i}function Qf(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function ep(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function tp(e){return e<0?-e*e:e*e}function np(e){var t=e(Bf,Bf),n=1;function i(){return 1===n?e(Bf,Bf):.5===n?e(ep,tp):e(Qf(n),Qf(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,i()):n},Vf(t)}function ip(){var e=np(Uf());return e.copy=function(){return jf(e,ip()).exponent(e.exponent())},Fh.apply(e,arguments),e}function rp(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function sp(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function ap(e){var t=1,n=e(rp(t),sp(t));return n.constant=function(n){return arguments.length?e(rp(t=+n),sp(t)):t},Vf(n)}function op(e,t,n,i,r,s){const a=[[pr,1,Ii],[pr,5,5e3],[pr,15,15e3],[pr,30,3e4],[s,1,Ti],[s,5,3e5],[s,15,9e5],[s,30,18e5],[r,1,Ri],[r,3,108e5],[r,6,216e5],[r,12,432e5],[i,1,Mi],[i,2,1728e5],[n,1,Bi],[t,1,2592e6],[t,3,7776e6],[e,1,zi]];function o(t,n,i){const r=Math.abs(n-t)/i,s=Er((([,,e])=>e)).right(a,r);if(s===a.length)return e.every(di(t/zi,n/zi,i));if(0===s)return gr.every(Math.max(di(t,n,i),1));const[o,u]=a[r/a[s-1][2]<a[s][2]/r?s-1:s];return o.every(u)}return[function(e,t,n){const i=t<e;i&&([e,t]=[t,e]);const r=n&&"function"==typeof n.range?n:o(e,t,n),s=r?r.range(e,+t+1):[];return i?s.reverse():s},o]}const[up,lp]=op(vr,xr,Zi,Ki,Cr,Ar),[cp,dp]=op(ar,ur,Ui,Pi,cr,hr);function hp(e){return new Date(e)}function fp(e){return e instanceof Date?+e:+new Date(+e)}function pp(e,t,n,i,r,s,a,o,u,l){var c=Wf(),d=c.invert,h=c.domain,f=l(".%L"),p=l(":%S"),m=l("%I:%M"),g=l("%I %p"),y=l("%a %d"),v=l("%b %d"),b=l("%B"),x=l("%Y");function w(e){return(u(e)<e?f:o(e)<e?p:a(e)<e?m:s(e)<e?g:i(e)<e?r(e)<e?y:v:n(e)<e?b:x)(e)}return c.invert=function(e){return new Date(d(e))},c.domain=function(e){return arguments.length?h(Array.from(e,fp)):h().map(hp)},c.ticks=function(t){var n=h();return e(n[0],n[n.length-1],null==t?10:t)},c.tickFormat=function(e,t){return null==t?w:l(t)},c.nice=function(e){var n=h();return e&&"function"==typeof e.range||(e=t(n[0],n[n.length-1],null==e?10:e)),e?h(qf(n,e)):c},c.copy=function(){return jf(c,pp(e,t,n,i,r,s,a,o,u,l))},c}function mp(){var e,t,n,i,r,s=0,a=1,o=Bf,u=!1;function l(t){return null==t||isNaN(t=+t)?r:o(0===n?.5:(t=(i(t)-e)*n,u?Math.max(0,Math.min(1,t)):t))}function c(e){return function(t){var n,i;return arguments.length?([n,i]=t,o=e(n,i),l):[o(0),o(1)]}}return l.domain=function(r){return arguments.length?([s,a]=r,e=i(s=+s),t=i(a=+a),n=e===t?0:1/(t-e),l):[s,a]},l.clamp=function(e){return arguments.length?(u=!!e,l):u},l.interpolator=function(e){return arguments.length?(o=e,l):o},l.range=c(If),l.rangeRound=c(Tf),l.unknown=function(e){return arguments.length?(r=e,l):r},function(r){return i=r,e=r(s),t=r(a),n=e===t?0:1/(t-e),l}}function gp(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function yp(){var e=Vf(mp()(Bf));return e.copy=function(){return gp(e,yp())},Dh.apply(e,arguments)}function vp(){var e=np(mp());return e.copy=function(){return gp(e,vp()).exponent(e.exponent())},Dh.apply(e,arguments)}function bp(e,t){void 0===t&&(t=e,e=If);for(var n=0,i=t.length-1,r=t[0],s=new Array(i<0?0:i);n<i;)s[n]=e(r,r=t[++n]);return function(e){var t=Math.max(0,Math.min(i-1,Math.floor(e*=i)));return s[t](e-t)}}function xp(){var e,t,n,i,r,s,a,o=0,u=.5,l=1,c=1,d=Bf,h=!1;function f(e){return isNaN(e=+e)?a:(e=.5+((e=+s(e))-t)*(c*e<c*t?i:r),d(h?Math.max(0,Math.min(1,e)):e))}function p(e){return function(t){var n,i,r;return arguments.length?([n,i,r]=t,d=bp(e,[n,i,r]),f):[d(0),d(.5),d(1)]}}return f.domain=function(a){return arguments.length?([o,u,l]=a,e=s(o=+o),t=s(u=+u),n=s(l=+l),i=e===t?0:.5/(t-e),r=t===n?0:.5/(n-t),c=t<e?-1:1,f):[o,u,l]},f.clamp=function(e){return arguments.length?(h=!!e,f):h},f.interpolator=function(e){return arguments.length?(d=e,f):d},f.range=p(If),f.rangeRound=p(Tf),f.unknown=function(e){return arguments.length?(a=e,f):a},function(a){return s=a,e=a(o),t=a(u),n=a(l),i=e===t?0:.5/(t-e),r=t===n?0:.5/(n-t),c=t<e?-1:1,f}}function wp(){var e=np(xp());return e.copy=function(){return gp(e,wp()).exponent(e.exponent())},Dh.apply(e,arguments)}function Cp(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function kp(e,t){var n=yf(+e,+t);return function(e){var t=n(e);return t-360*Math.floor(t/360)}}var Ap,_p=180/Math.PI,Ep={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Sp(e,t,n,i,r,s){var a,o,u;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(u=e*n+t*i)&&(n-=e*u,i-=t*u),(o=Math.sqrt(n*n+i*i))&&(n/=o,i/=o,u/=o),e*i<t*n&&(e=-e,t=-t,u=-u,a=-a),{translateX:r,translateY:s,rotate:Math.atan2(t,e)*_p,skewX:Math.atan(u)*_p,scaleX:a,scaleY:o}}function Fp(e,t,n,i){function r(e){return e.length?e.pop()+" ":""}return function(s,a){var o=[],u=[];return s=e(s),a=e(a),function(e,i,r,s,a,o){if(e!==r||i!==s){var u=a.push("translate(",null,t,null,n);o.push({i:u-4,x:Ff(e,r)},{i:u-2,x:Ff(i,s)})}else(r||s)&&a.push("translate("+r+t+s+n)}(s.translateX,s.translateY,a.translateX,a.translateY,o,u),function(e,t,n,s){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),s.push({i:n.push(r(n)+"rotate(",null,i)-2,x:Ff(e,t)})):t&&n.push(r(n)+"rotate("+t+i)}(s.rotate,a.rotate,o,u),function(e,t,n,s){e!==t?s.push({i:n.push(r(n)+"skewX(",null,i)-2,x:Ff(e,t)}):t&&n.push(r(n)+"skewX("+t+i)}(s.skewX,a.skewX,o,u),function(e,t,n,i,s,a){if(e!==n||t!==i){var o=s.push(r(s)+"scale(",null,",",null,")");a.push({i:o-4,x:Ff(e,n)},{i:o-2,x:Ff(t,i)})}else 1===n&&1===i||s.push(r(s)+"scale("+n+","+i+")")}(s.scaleX,s.scaleY,a.scaleX,a.scaleY,o,u),s=a=null,function(e){for(var t,n=-1,i=u.length;++n<i;)o[(t=u[n]).i]=t.x(e);return o.join("")}}}var Dp=Fp((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Ep:Sp(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),$p=Fp((function(e){return null==e?Ep:(Ap||(Ap=document.createElementNS("http://www.w3.org/2000/svg","g")),Ap.setAttribute("transform",e),(e=Ap.transform.baseVal.consolidate())?Sp((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):Ep)}),", ",")",")");function Op(e){return((e=Math.exp(e))+1/e)/2}const Np=function e(t,n,i){function r(e,r){var s,a,o=e[0],u=e[1],l=e[2],c=r[0],d=r[1],h=r[2],f=c-o,p=d-u,m=f*f+p*p;if(m<1e-12)a=Math.log(h/l)/t,s=function(e){return[o+e*f,u+e*p,l*Math.exp(t*e*a)]};else{var g=Math.sqrt(m),y=(h*h-l*l+i*m)/(2*l*n*g),v=(h*h-l*l-i*m)/(2*h*n*g),b=Math.log(Math.sqrt(y*y+1)-y),x=Math.log(Math.sqrt(v*v+1)-v);a=(x-b)/t,s=function(e){var i=e*a,r=Op(b),s=l/(n*g)*(r*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*i+b)-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[o+s*f,u+s*p,l*r/Op(t*i+b)]}}return s.duration=1e3*a*t/Math.SQRT2,s}return r.rho=function(t){var n=Math.max(.001,+t),i=n*n;return e(n,i,i*i)},r}(Math.SQRT2,2,4);function Ip(e){return function(t,n){var i=e((t=lf(t)).h,(n=lf(n)).h),r=vf(t.s,n.s),s=vf(t.l,n.l),a=vf(t.opacity,n.opacity);return function(e){return t.h=i(e),t.s=r(e),t.l=s(e),t.opacity=a(e),t+""}}}const Tp=Ip(yf);var Rp=Ip(vf);const Mp=Math.PI/180,Bp=180/Math.PI,zp=.96422,Lp=.82521,Pp=4/29,jp=6/29,Up=3*jp*jp;function Wp(e){if(e instanceof qp)return new qp(e.l,e.a,e.b,e.opacity);if(e instanceof Zp)return Qp(e);e instanceof nf||(e=ef(e));var t,n,i=Yp(e.r),r=Yp(e.g),s=Yp(e.b),a=Gp((.2225045*i+.7168786*r+.0606169*s)/1);return i===r&&r===s?t=n=a:(t=Gp((.4360747*i+.3850649*r+.1430804*s)/zp),n=Gp((.0139322*i+.0971045*r+.7141733*s)/Lp)),new qp(116*a-16,500*(t-a),200*(a-n),e.opacity)}function Vp(e,t,n,i){return 1===arguments.length?Wp(e):new qp(e,t,n,null==i?1:i)}function qp(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}function Gp(e){return e>.008856451679035631?Math.pow(e,1/3):e/Up+Pp}function Hp(e){return e>jp?e*e*e:Up*(e-Pp)}function Xp(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Yp(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Kp(e){if(e instanceof Zp)return new Zp(e.h,e.c,e.l,e.opacity);if(e instanceof qp||(e=Wp(e)),0===e.a&&0===e.b)return new Zp(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Bp;return new Zp(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Jp(e,t,n,i){return 1===arguments.length?Kp(e):new Zp(e,t,n,null==i?1:i)}function Zp(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function Qp(e){if(isNaN(e.h))return new qp(e.l,0,0,e.opacity);var t=e.h*Mp;return new qp(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function em(e,t){var n=vf((e=Vp(e)).l,(t=Vp(t)).l),i=vf(e.a,t.a),r=vf(e.b,t.b),s=vf(e.opacity,t.opacity);return function(t){return e.l=n(t),e.a=i(t),e.b=r(t),e.opacity=s(t),e+""}}function tm(e){return function(t,n){var i=e((t=Jp(t)).h,(n=Jp(n)).h),r=vf(t.c,n.c),s=vf(t.l,n.l),a=vf(t.opacity,n.opacity);return function(e){return t.h=i(e),t.c=r(e),t.l=s(e),t.opacity=a(e),t+""}}}Ih(qp,Vp,Th(Rh,{brighter:function(e){return new qp(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new qp(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new nf(Xp(3.1338561*(t=zp*Hp(t))-1.6168667*(e=1*Hp(e))-.4906146*(n=Lp*Hp(n))),Xp(-.9787684*t+1.9161415*e+.033454*n),Xp(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),Ih(Zp,Jp,Th(Rh,{brighter:function(e){return new Zp(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new Zp(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return Qp(this).rgb()}}));const nm=tm(yf);var im=tm(vf),rm=-.14861,sm=1.78277,am=-.29227,om=-.90649,um=1.97294,lm=um*om,cm=um*sm,dm=sm*am-om*rm;function hm(e){if(e instanceof pm)return new pm(e.h,e.s,e.l,e.opacity);e instanceof nf||(e=ef(e));var t=e.r/255,n=e.g/255,i=e.b/255,r=(dm*i+lm*t-cm*n)/(dm+lm-cm),s=i-r,a=(um*(n-r)-am*s)/om,o=Math.sqrt(a*a+s*s)/(um*r*(1-r)),u=o?Math.atan2(a,s)*Bp-120:NaN;return new pm(u<0?u+360:u,o,r,e.opacity)}function fm(e,t,n,i){return 1===arguments.length?hm(e):new pm(e,t,n,null==i?1:i)}function pm(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function mm(e){return function t(n){function i(t,i){var r=e((t=fm(t)).h,(i=fm(i)).h),s=vf(t.s,i.s),a=vf(t.l,i.l),o=vf(t.opacity,i.opacity);return function(e){return t.h=r(e),t.s=s(e),t.l=a(Math.pow(e,n)),t.opacity=o(e),t+""}}return n=+n,i.gamma=t,i}(1)}Ih(pm,fm,Th(Rh,{brighter:function(e){return e=null==e?Bh:Math.pow(Bh,e),new pm(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Mh:Math.pow(Mh,e),new pm(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*Mp,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),r=Math.sin(e);return new nf(255*(t+n*(rm*i+sm*r)),255*(t+n*(am*i+om*r)),255*(t+n*(um*i)),this.opacity)}}));const gm=mm(yf);var ym=mm(vf);function vm(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}function bm(e,t,n){const i=e-t+2*n;return e?i>0?i:1:0}const xm="linear",wm="log",Cm="pow",km="sqrt",Am="symlog",_m="time",Em="utc",Sm="sequential",Fm="diverging",Dm="quantile",$m="quantize",Om="threshold",Nm="ordinal",Im="point",Tm="band",Rm="bin-ordinal",Mm="continuous",Bm="discrete",zm="discretizing",Lm="interpolating",Pm="temporal";function jm(){const e=Oh().unknown(void 0),t=e.domain,n=e.range;let i,r,s=[0,1],a=!1,o=0,u=0,l=.5;function c(){const e=t().length,c=s[1]<s[0],d=s[1-c],h=bm(e,o,u);let f=s[c-0];i=(d-f)/(h||1),a&&(i=Math.floor(i)),f+=(d-f-i*(e-o))*l,r=i*(1-o),a&&(f=Math.round(f),r=Math.round(r));const p=Ml(e).map((e=>f+i*e));return n(c?p.reverse():p)}return delete e.unknown,e.domain=function(e){return arguments.length?(t(e),c()):t()},e.range=function(e){return arguments.length?(s=[+e[0],+e[1]],c()):s.slice()},e.rangeRound=function(e){return s=[+e[0],+e[1]],a=!0,c()},e.bandwidth=function(){return r},e.step=function(){return i},e.round=function(e){return arguments.length?(a=!!e,c()):a},e.padding=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),o=u,c()):o},e.paddingInner=function(e){return arguments.length?(o=Math.max(0,Math.min(1,e)),c()):o},e.paddingOuter=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),c()):u},e.align=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),c()):l},e.invertRange=function(e){if(null==e[0]||null==e[1])return;const i=s[1]<s[0],a=i?n().reverse():n(),o=a.length-1;let u,l,c,d=+e[0],h=+e[1];return d!=d||h!=h||(h<d&&(c=d,d=h,h=c),h<a[0]||d>s[1-i])?void 0:(u=Math.max(0,_h(a,d)-1),l=d===h?u:_h(a,h)-1,d-a[u]>r+1e-10&&++u,i&&(c=u,u=o-l,l=o-c),u>l?void 0:t().slice(u,l+1))},e.invert=function(t){const n=e.invertRange([t,t]);return n?n[0]:n},e.copy=function(){return jm().domain(t()).range(s).round(a).paddingInner(o).paddingOuter(u).align(l)},c()}function Um(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return Um(t())},e}var Wm=Array.prototype.map;function Vm(e){return Wm.call(e,rn)}const qm=Array.prototype.slice,Gm={};function Hm(e,t,n){const i=function(){const n=t();return n.invertRange||(n.invertRange=n.invert?(i=n,function(e){let t,n=e[0],r=e[1];return r<n&&(t=n,n=r,r=t),[i.invert(n),i.invert(r)]}):n.invertExtent?function(e){return function(t){const n=e.range();let i,r,s,a,o=t[0],u=t[1],l=-1;for(u<o&&(r=o,o=u,u=r),s=0,a=n.length;s<a;++s)n[s]>=o&&n[s]<=u&&(l<0&&(l=s),i=s);if(!(l<0))return o=e.invertExtent(n[l]),u=e.invertExtent(n[i]),[void 0===o[0]?o[1]:o[0],void 0===u[1]?u[0]:u[1]]}}(n):void 0),n.type=e,n;var i};return i.metadata=Vn(gn(n)),i}function Xm(e,t,n){return arguments.length>1?(Gm[e]=Hm(e,t,n),this):Ym(e)?Gm[e]:void 0}function Ym(e){return Fn(Gm,e)}function Km(e,t){const n=Gm[e];return n&&n.metadata[t]}function Jm(e){return Km(e,Mm)}function Zm(e){return Km(e,Bm)}function Qm(e){return Km(e,zm)}function eg(e){return Km(e,wm)}function tg(e){return Km(e,Lm)}function ng(e){return Km(e,Dm)}Xm("identity",(function e(t){var n;function i(e){return null==e||isNaN(e=+e)?n:e}return i.invert=i,i.domain=i.range=function(e){return arguments.length?(t=Array.from(e,Rf),i):t.slice()},i.unknown=function(e){return arguments.length?(n=e,i):n},i.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,Rf):[0,1],Vf(i)})),Xm(xm,(function e(){var t=Wf();return t.copy=function(){return jf(t,e())},Fh.apply(t,arguments),Vf(t)}),Mm),Xm(wm,(function e(){var t=Zf(Uf()).domain([1,10]);return t.copy=function(){return jf(t,e()).base(t.base())},Fh.apply(t,arguments),t}),[Mm,wm]),Xm(Cm,ip,Mm),Xm(km,(function(){return ip.apply(null,arguments).exponent(.5)}),Mm),Xm(Am,(function e(){var t=ap(Uf());return t.copy=function(){return jf(t,e()).constant(t.constant())},Fh.apply(t,arguments)}),Mm),Xm(_m,(function(){return Fh.apply(pp(cp,dp,ar,ur,Ui,Pi,cr,hr,pr,Ms).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[Mm,Pm]),Xm(Em,(function(){return Fh.apply(pp(up,lp,vr,xr,Zi,Ki,Cr,Ar,pr,zs).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[Mm,Pm]),Xm(Sm,yp,[Mm,Lm]),Xm("".concat(Sm,"-").concat(xm),yp,[Mm,Lm]),Xm("".concat(Sm,"-").concat(wm),(function e(){var t=Zf(mp()).domain([1,10]);return t.copy=function(){return gp(t,e()).base(t.base())},Dh.apply(t,arguments)}),[Mm,Lm,wm]),Xm("".concat(Sm,"-").concat(Cm),vp,[Mm,Lm]),Xm("".concat(Sm,"-").concat(km),(function(){return vp.apply(null,arguments).exponent(.5)}),[Mm,Lm]),Xm("".concat(Sm,"-").concat(Am),(function e(){var t=ap(mp());return t.copy=function(){return gp(t,e()).constant(t.constant())},Dh.apply(t,arguments)}),[Mm,Lm]),Xm("".concat(Fm,"-").concat(xm),(function e(){var t=Vf(xp()(Bf));return t.copy=function(){return gp(t,e())},Dh.apply(t,arguments)}),[Mm,Lm]),Xm("".concat(Fm,"-").concat(wm),(function e(){var t=Zf(xp()).domain([.1,1,10]);return t.copy=function(){return gp(t,e()).base(t.base())},Dh.apply(t,arguments)}),[Mm,Lm,wm]),Xm("".concat(Fm,"-").concat(Cm),wp,[Mm,Lm]),Xm("".concat(Fm,"-").concat(km),(function(){return wp.apply(null,arguments).exponent(.5)}),[Mm,Lm]),Xm("".concat(Fm,"-").concat(Am),(function e(){var t=ap(xp());return t.copy=function(){return gp(t,e()).constant(t.constant())},Dh.apply(t,arguments)}),[Mm,Lm]),Xm(Dm,(function e(){var t,n=[],i=[],r=[];function s(){var e=0,t=Math.max(1,i.length);for(r=new Array(t-1);++e<t;)r[e-1]=Pu(n,e/t);return a}function a(e){return null==e||isNaN(e=+e)?t:i[Sh(r,e)]}return a.invertExtent=function(e){var t=i.indexOf(e);return t<0?[NaN,NaN]:[t>0?r[t-1]:n[0],t<r.length?r[t]:n[n.length-1]]},a.domain=function(e){if(!arguments.length)return n.slice();n=[];for(let t of e)null==t||isNaN(t=+t)||n.push(t);return n.sort(_r),s()},a.range=function(e){return arguments.length?(i=Array.from(e),s()):i.slice()},a.unknown=function(e){return arguments.length?(t=e,a):t},a.quantiles=function(){return r.slice()},a.copy=function(){return e().domain(n).range(i).unknown(t)},Fh.apply(a,arguments)}),[zm,Dm]),Xm($m,(function e(){var t,n=0,i=1,r=1,s=[.5],a=[0,1];function o(e){return null!=e&&e<=e?a[Sh(s,e,0,r)]:t}function u(){var e=-1;for(s=new Array(r);++e<r;)s[e]=((e+1)*i-(e-r)*n)/(r+1);return o}return o.domain=function(e){return arguments.length?([n,i]=e,n=+n,i=+i,u()):[n,i]},o.range=function(e){return arguments.length?(r=(a=Array.from(e)).length-1,u()):a.slice()},o.invertExtent=function(e){var t=a.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,s[0]]:t>=r?[s[r-1],i]:[s[t-1],s[t]]},o.unknown=function(e){return arguments.length?(t=e,o):o},o.thresholds=function(){return s.slice()},o.copy=function(){return e().domain([n,i]).range(a).unknown(t)},Fh.apply(Vf(o),arguments)}),zm),Xm(Om,(function e(){var t,n=[.5],i=[0,1],r=1;function s(e){return null!=e&&e<=e?i[Sh(n,e,0,r)]:t}return s.domain=function(e){return arguments.length?(n=Array.from(e),r=Math.min(n.length,i.length-1),s):n.slice()},s.range=function(e){return arguments.length?(i=Array.from(e),r=Math.min(n.length,i.length-1),s):i.slice()},s.invertExtent=function(e){var t=i.indexOf(e);return[n[t-1],n[t]]},s.unknown=function(e){return arguments.length?(t=e,s):t},s.copy=function(){return e().domain(n).range(i).unknown(t)},Fh.apply(s,arguments)}),zm),Xm(Rm,(function e(){let t=[],n=[];function i(e){return null==e||e!=e?void 0:n[(Sh(t,e)-1)%n.length]}return i.domain=function(e){return arguments.length?(t=Vm(e),i):t.slice()},i.range=function(e){return arguments.length?(n=qm.call(e),i):n.slice()},i.tickFormat=function(e,n){return Nh(t[0],nn(t),null==e?10:e,n)},i.copy=function(){return e().domain(i.domain()).range(i.range())},i}),[Bm,zm]),Xm(Nm,Oh,Bm),Xm(Tm,jm,Bm),Xm(Im,(function(){return Um(jm().paddingInner(1))}),Bm);const ig=["clamp","base","constant","exponent"];function rg(e,t){const n=t[0],i=nn(t)-n;return function(t){return e(n+t*i)}}function sg(e,t,n){return bp(ug(t||"rgb",n),e)}function ag(e,t){const n=new Array(t),i=t+1;for(let r=0;r<t;)n[r]=e(++r/i);return n}function og(e,t,n){const i=n-t;let r,s,a;return i&&Number.isFinite(i)?(r=(s=e.type).indexOf("-"),s=r<0?s:s.slice(r+1),a=Xm(s)().domain([t,n]).range([0,1]),ig.forEach((t=>e[t]?a[t](e[t]()):0)),a):kn(.5)}function ug(e,t){const n=a[function(e){return"interpolate"+e.toLowerCase().split("-").map((e=>e[0].toUpperCase()+e.slice(1))).join("")}(e)];return null!=t&&n&&n.gamma?n.gamma(t):n}function lg(e){const t=e.length/6|0,n=new Array(t);for(let i=0;i<t;)n[i]="#"+e.slice(6*i,6*++i);return n}function cg(e,t){for(const n in e)hg(n,t(e[n]))}const dg={};function hg(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(dg[e]=t,this):dg[e]}cg({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},lg),cg({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},(e=>sg(lg(e))));const fg="symbol",pg=e=>Jt(e)?e.map((e=>String(e))):String(e),mg=(e,t)=>e[1]-t[1],gg=(e,t)=>t[1]-e[1];function yg(e,t,n){let i;return Tn(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),null!=n&&(t=Math.min(t,Math.floor(zn(e.domain())/n||1)))),Zt(t)&&(i=t.step,t=t.interval),Rn(t)&&(t=e.type===_m?fs(t):e.type==Em?ps(t):Pt("Only time and utc scales accept interval strings."),i&&(t=t.every(i))),t}function vg(e,t,n){let i=e.range(),r=i[0],s=nn(i),a=mg;if(r>s&&(i=s,s=r,r=i,a=gg),r=Math.floor(r),s=Math.ceil(s),t=t.map((t=>[t,e(t)])).filter((e=>r<=e[1]&&e[1]<=s)).sort(a).map((e=>e[0])),n>0&&t.length>1){const e=[t[0],nn(t)];for(;t.length>n&&t.length>=3;)t=t.filter(((e,t)=>!(t%2)));t.length<3&&(t=e)}return t}function bg(e,t){return e.bins?vg(e,e.bins):e.ticks?e.ticks(t):e.domain()}function xg(e,t,n,i,r,s){const a=t.type;let o=pg;if(a===_m||r===_m)o=e.timeFormat(i);else if(a===Em||r===Em)o=e.utcFormat(i);else if(eg(a)){const r=e.formatFloat(i);if(s||t.bins)o=r;else{const e=wg(t,n,!1);o=t=>e(t)?r(t):""}}else if(t.tickFormat){const r=t.domain();o=e.formatSpan(r[0],r[r.length-1],n,i)}else i&&(o=e.format(i));return o}function wg(e,t,n){const i=bg(e,t),r=e.base(),s=Math.log(r),a=Math.max(1,r*t/i.length),o=e=>{let t=e/Math.pow(r,Math.round(Math.log(e)/s));return t*r<r-.5&&(t*=r),t<=a};return n?i.filter(o):o}const Cg={[Dm]:"quantiles",[$m]:"thresholds",[Om]:"domain"},kg={[Dm]:"quantiles",[$m]:"domain"};function Ag(e,t){return e.bins?function(e){const t=e.slice(0,-1);return t.max=nn(e),t}(e.bins):e.type===wm?wg(e,t,!0):Cg[e.type]?function(e){const t=[-1/0].concat(e);return t.max=1/0,t}(e[Cg[e.type]]()):bg(e,t)}function _g(e,t,n,i,r,s,a){const o=kg[t.type]&&s!==_m&&s!==Em?function(e,t,n){const i=t[kg[t.type]](),r=i.length;let s,a=r>1?i[1]-i[0]:i[0];for(s=1;s<r;++s)a=Math.min(a,i[s]-i[s-1]);return e.formatSpan(0,a,30,n)}(e,t,r):xg(e,t,n,r,s,a);return i===fg&&(e=>Cg[e.type]||e.bins)(t)?Eg(o):"discrete"===i?Fg(o):Dg(o)}const Eg=e=>(t,n,i)=>{const r=Sg(i[n+1],Sg(i.max,1/0)),s=$g(t,e),a=$g(r,e);return s&&a?s+" – "+a:a?"< "+a:"≥ "+s},Sg=(e,t)=>null!=e?e:t,Fg=e=>(t,n)=>n?e(t):null,Dg=e=>t=>e(t),$g=(e,t)=>Number.isFinite(e)?t(e):null;function Og(e,t,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=function(e,t,n,i){const r=i||t.type;return Rn(n)&&function(e){return Km(e,Pm)}(r)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||r!==_m?n||r!==Em?_g(e,t,5,null,n,i,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}(e,t,n.format,n.formatType);if(Qm(t.type)){const e=Ag(t).slice(1).map(r),n=e.length;return"".concat(n," boundar").concat(1===n?"y":"ies",": ").concat(e.join(", "))}if(Zm(t.type)){const e=t.domain(),n=e.length,s=n>i?e.slice(0,i-2).map(r).join(", ")+", ending with "+e.slice(-1).map(r):e.map(r).join(", ");return"".concat(n," value").concat(1===n?"":"s",": ").concat(s)}{const e=t.domain();return"values from ".concat(r(e[0])," to ").concat(r(nn(e)))}}let Ng=0;const Ig="p_";function Tg(e){return e&&e.gradient}function Rg(e,t,n){const i=e.gradient;let r=e.id,s="radial"===i?Ig:"";return r||(r=e.id="gradient_"+Ng++,"radial"===i?(e.x1=Mg(e.x1,.5),e.y1=Mg(e.y1,.5),e.r1=Mg(e.r1,0),e.x2=Mg(e.x2,.5),e.y2=Mg(e.y2,.5),e.r2=Mg(e.r2,.5),s=Ig):(e.x1=Mg(e.x1,0),e.y1=Mg(e.y1,0),e.x2=Mg(e.x2,1),e.y2=Mg(e.y2,0))),t[r]=e,"url("+(n||"")+"#"+s+r+")"}function Mg(e,t){return null!=e?e:t}function Bg(e,t){var n,i=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:i,stop:function(e,t){return i.push({offset:e,color:t}),n}}}const zg={basis:{curve:function(e){return new ld(e)}},"basis-closed":{curve:function(e){return new dd(e)}},"basis-open":{curve:function(e){return new hd(e)}},bundle:{curve:pd,tension:"beta",value:.85},cardinal:{curve:yd,tension:"tension",value:0},"cardinal-open":{curve:bd,tension:"tension",value:0},"cardinal-closed":{curve:wd,tension:"tension",value:0},"catmull-rom":{curve:Bd,tension:"alpha",value:.5},"catmull-rom-closed":{curve:Ld,tension:"alpha",value:.5},"catmull-rom-open":{curve:jd,tension:"alpha",value:.5},linear:{curve:Wd},"linear-closed":{curve:function(e){return new Vd(e)}},monotone:{horizontal:function(e){return new Kd(e)},vertical:function(e){return new Yd(e)}},natural:{curve:function(e){return new Zd(e)}},step:{curve:function(e){return new eh(e,.5)}},"step-after":{curve:function(e){return new eh(e,1)}},"step-before":{curve:function(e){return new eh(e,0)}}};function Lg(e,t,n){var i=Fn(zg,e)&&zg[e],r=null;return i&&(r=i.curve||i[t||"vertical"],i.tension&&null!=n&&(r=r[i.tension](n))),r}const Pg={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},jg=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function Ug(e){const t=[];let n,i,r,s,a,o,u,l,c,d;const h=e.slice().replace(jg[0],"###$1").split(jg[1]).slice(1);for(u=0,c=h.length;u<c;++u){for(n=h[u],i=n.slice(1).trim().replace(jg[2],"$1###$2").replace(jg[3],"$1###$2").split(jg[4]),a=n.charAt(0),r=[a],l=0,d=i.length;l<d;++l)(s=+i[l])===s&&r.push(s);if(o=Pg[a.toLowerCase()],r.length-1>o){const e=r.length;for(l=1,t.push([a].concat(r.slice(l,l+=o))),a="M"===a?"L":"m"===a?"l":a;l<e;l+=o)t.push([a].concat(r.slice(l,l+o)))}else t.push(r)}return t}const Wg=Math.PI/180,Vg=Math.PI/2,qg=2*Math.PI,Gg=Math.sqrt(3)/2;var Hg={},Xg={},Yg=[].join;function Kg(e){const t=Yg.call(e);if(Xg[t])return Xg[t];var n=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],u=e[6],l=e[7];const c=l*a,d=-u*o,h=u*a,f=l*o,p=Math.cos(r),m=Math.sin(r),g=Math.cos(s),y=Math.sin(s),v=.5*(s-r),b=Math.sin(.5*v),x=8/3*b*b/Math.sin(v),w=n+p-x*m,C=i+m+x*p,k=n+g,A=i+y,_=k+x*y,E=A-x*g;return Xg[t]=[c*w+d*C,h*w+f*C,c*_+d*E,h*_+f*E,c*k+d*A,h*k+f*A]}const Jg=["l",0,0,0,0,0,0,0];function Zg(e,t,n){const i=Jg[0]=e[0];if("a"===i||"A"===i)Jg[1]=t*e[1],Jg[2]=n*e[2],Jg[3]=e[3],Jg[4]=e[4],Jg[5]=e[5],Jg[6]=t*e[6],Jg[7]=n*e[7];else if("h"===i||"H"===i)Jg[1]=t*e[1];else if("v"===i||"V"===i)Jg[1]=n*e[1];else for(var r=1,s=e.length;r<s;++r)Jg[r]=(r%2==1?t:n)*e[r];return Jg}function Qg(e,t,n,i,r,s){var a,o,u,l,c,d=null,h=0,f=0,p=0,m=0;null==n&&(n=0),null==i&&(i=0),null==r&&(r=1),null==s&&(s=r),e.beginPath&&e.beginPath();for(var g=0,y=t.length;g<y;++g){switch(a=t[g],1===r&&1===s||(a=Zg(a,r,s)),a[0]){case"l":h+=a[1],f+=a[2],e.lineTo(h+n,f+i);break;case"L":h=a[1],f=a[2],e.lineTo(h+n,f+i);break;case"h":h+=a[1],e.lineTo(h+n,f+i);break;case"H":h=a[1],e.lineTo(h+n,f+i);break;case"v":f+=a[1],e.lineTo(h+n,f+i);break;case"V":f=a[1],e.lineTo(h+n,f+i);break;case"m":h+=a[1],f+=a[2],e.moveTo(h+n,f+i);break;case"M":h=a[1],f=a[2],e.moveTo(h+n,f+i);break;case"c":o=h+a[5],u=f+a[6],p=h+a[3],m=f+a[4],e.bezierCurveTo(h+a[1]+n,f+a[2]+i,p+n,m+i,o+n,u+i),h=o,f=u;break;case"C":h=a[5],f=a[6],p=a[3],m=a[4],e.bezierCurveTo(a[1]+n,a[2]+i,p+n,m+i,h+n,f+i);break;case"s":o=h+a[3],u=f+a[4],p=2*h-p,m=2*f-m,e.bezierCurveTo(p+n,m+i,h+a[1]+n,f+a[2]+i,o+n,u+i),p=h+a[1],m=f+a[2],h=o,f=u;break;case"S":o=a[3],u=a[4],p=2*h-p,m=2*f-m,e.bezierCurveTo(p+n,m+i,a[1]+n,a[2]+i,o+n,u+i),h=o,f=u,p=a[1],m=a[2];break;case"q":o=h+a[3],u=f+a[4],p=h+a[1],m=f+a[2],e.quadraticCurveTo(p+n,m+i,o+n,u+i),h=o,f=u;break;case"Q":o=a[3],u=a[4],e.quadraticCurveTo(a[1]+n,a[2]+i,o+n,u+i),h=o,f=u,p=a[1],m=a[2];break;case"t":o=h+a[1],u=f+a[2],null===d[0].match(/[QqTt]/)?(p=h,m=f):"t"===d[0]?(p=2*h-l,m=2*f-c):"q"===d[0]&&(p=2*h-p,m=2*f-m),l=p,c=m,e.quadraticCurveTo(p+n,m+i,o+n,u+i),f=u,p=(h=o)+a[1],m=f+a[2];break;case"T":o=a[1],u=a[2],p=2*h-p,m=2*f-m,e.quadraticCurveTo(p+n,m+i,o+n,u+i),h=o,f=u;break;case"a":ey(e,h+n,f+i,[a[1],a[2],a[3],a[4],a[5],a[6]+h+n,a[7]+f+i]),h+=a[6],f+=a[7];break;case"A":ey(e,h+n,f+i,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+i]),h=a[6],f=a[7];break;case"z":case"Z":e.closePath()}d=a}}function ey(e,t,n,i){const r=function(e,t,n,i,r,s,a,o,u){const l=Yg.call(arguments);if(Hg[l])return Hg[l];const c=a*Wg,d=Math.sin(c),h=Math.cos(c),f=h*(o-e)*.5+d*(u-t)*.5,p=h*(u-t)*.5-d*(o-e)*.5;let m=f*f/((n=Math.abs(n))*n)+p*p/((i=Math.abs(i))*i);m>1&&(m=Math.sqrt(m),n*=m,i*=m);const g=h/n,y=d/n,v=-d/i,b=h/i,x=g*o+y*u,w=v*o+b*u,C=g*e+y*t,k=v*e+b*t;let A=1/((C-x)*(C-x)+(k-w)*(k-w))-.25;A<0&&(A=0);let _=Math.sqrt(A);s==r&&(_=-_);const E=.5*(x+C)-_*(k-w),S=.5*(w+k)+_*(C-x),F=Math.atan2(w-S,x-E);let D=Math.atan2(k-S,C-E)-F;D<0&&1===s?D+=qg:D>0&&0===s&&(D-=qg);const $=Math.ceil(Math.abs(D/(Vg+.001))),O=[];for(let e=0;e<$;++e){const t=F+e*D/$,r=F+(e+1)*D/$;O[e]=[E,S,t,r,n,i,d,h]}return Hg[l]=O}(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,n);for(let t=0;t<r.length;++t){const n=Kg(r[t]);e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}const ty=.5773502691896257,ny={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,qg)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/2.5;e.moveTo(-n,-i),e.lineTo(-n,i),e.lineTo(-i,i),e.lineTo(-i,n),e.lineTo(i,n),e.lineTo(i,i),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(i,-i),e.lineTo(i,-n),e.lineTo(-i,-n),e.lineTo(-i,-i),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),i=-n/2;e.rect(i,i,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/7,r=n/2.5,s=n/8;e.moveTo(-i,n),e.lineTo(i,n),e.lineTo(i,-s),e.lineTo(r,-s),e.lineTo(0,-n),e.lineTo(-r,-s),e.lineTo(-i,-s),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Gg*n,r=i-n*ty,s=n/4;e.moveTo(0,-i-r),e.lineTo(-s,i-r),e.lineTo(s,i-r),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Gg*n,r=i-n*ty;e.moveTo(0,-i-r),e.lineTo(-n,i-r),e.lineTo(n,i-r),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Gg*n;e.moveTo(0,-i),e.lineTo(-n,i),e.lineTo(n,i),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Gg*n;e.moveTo(0,i),e.lineTo(-n,-i),e.lineTo(n,-i),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Gg*n;e.moveTo(i,0),e.lineTo(-i,-n),e.lineTo(-i,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Gg*n;e.moveTo(-i,0),e.lineTo(i,-n),e.lineTo(i,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function iy(e){return Fn(ny,e)?ny[e]:function(e){if(!Fn(ry,e)){const t=Ug(e);ry[e]={draw:function(e,n){Qg(e,t,0,0,Math.sqrt(n)/2)}}}return ry[e]}(e)}var ry={};const sy=.448084975506;function ay(e){return e.x}function oy(e){return e.y}function uy(e){return e.width}function ly(e){return e.height}function cy(e){return"function"==typeof e?e:()=>+e}function dy(e,t,n){return Math.max(t,Math.min(e,n))}function hy(){var e=ay,t=oy,n=uy,i=ly,r=cy(0),s=r,a=r,o=r,u=null;function l(l,c,d){var h,f=null!=c?c:+e.call(this,l),p=null!=d?d:+t.call(this,l),m=+n.call(this,l),g=+i.call(this,l),y=Math.min(m,g)/2,v=dy(+r.call(this,l),0,y),b=dy(+s.call(this,l),0,y),x=dy(+a.call(this,l),0,y),w=dy(+o.call(this,l),0,y);if(u||(u=h=oh()),v<=0&&b<=0&&x<=0&&w<=0)u.rect(f,p,m,g);else{var C=f+m,k=p+g;u.moveTo(f+v,p),u.lineTo(C-b,p),u.bezierCurveTo(C-sy*b,p,C,p+sy*b,C,p+b),u.lineTo(C,k-w),u.bezierCurveTo(C,k-sy*w,C-sy*w,k,C-w,k),u.lineTo(f+x,k),u.bezierCurveTo(f+sy*x,k,f,k-sy*x,f,k-x),u.lineTo(f,p+v),u.bezierCurveTo(f,p+sy*v,f+sy*v,p,f+v,p),u.closePath()}if(h)return u=null,h+""||null}return l.x=function(t){return arguments.length?(e=cy(t),l):e},l.y=function(e){return arguments.length?(t=cy(e),l):t},l.width=function(e){return arguments.length?(n=cy(e),l):n},l.height=function(e){return arguments.length?(i=cy(e),l):i},l.cornerRadius=function(e,t,n,i){return arguments.length?(r=cy(e),s=null!=t?cy(t):r,o=null!=n?cy(n):r,a=null!=i?cy(i):s,l):r},l.context=function(e){return arguments.length?(u=null==e?null:e,l):u},l}function fy(){var e,t,n,i,r,s,a,o,u=null;function l(e,t,n){const i=n/2;if(r){var l=a-t,c=e-s;if(l||c){var d=Math.sqrt(l*l+c*c),h=(l/=d)*o,f=(c/=d)*o,p=Math.atan2(c,l);u.moveTo(s-h,a-f),u.lineTo(e-l*i,t-c*i),u.arc(e,t,i,p-Math.PI,p),u.lineTo(s+h,a+f),u.arc(s,a,o,p,p+Math.PI)}else u.arc(e,t,i,0,qg);u.closePath()}else r=1;s=e,a=t,o=i}function c(s){var a,o,c,d=s.length,h=!1;for(null==u&&(u=c=oh()),a=0;a<=d;++a)!(a<d&&i(o=s[a],a,s))===h&&(h=!h)&&(r=0),h&&l(+e(o,a,s),+t(o,a,s),+n(o,a,s));if(c)return u=null,c+""||null}return c.x=function(t){return arguments.length?(e=t,c):e},c.y=function(e){return arguments.length?(t=e,c):t},c.size=function(e){return arguments.length?(n=e,c):n},c.defined=function(e){return arguments.length?(i=e,c):i},c.context=function(e){return arguments.length?(u=null==e?null:e,c):u},c}function py(e,t){return null!=e?e:t}const my=e=>e.x||0,gy=e=>e.y||0,yy=e=>!(!1===e.defined),vy=function(){var e=lh,t=ch,n=uh(0),i=null,r=dh,s=hh,a=fh,o=null;function u(){var u,l,c=+e.apply(this,arguments),d=+t.apply(this,arguments),h=r.apply(this,arguments)-Od,f=s.apply(this,arguments)-Od,p=Cd(f-h),m=f>h;if(o||(o=u=oh()),d<c&&(l=d,d=c,c=l),d>Dd)if(p>Nd-Dd)o.moveTo(d*Ad(h),d*Sd(h)),o.arc(0,0,d,h,f,!m),c>Dd&&(o.moveTo(c*Ad(f),c*Sd(f)),o.arc(0,0,c,f,h,m));else{var g,y,v=h,b=f,x=h,w=f,C=p,k=p,A=a.apply(this,arguments)/2,_=A>Dd&&(i?+i.apply(this,arguments):Fd(c*c+d*d)),E=Ed(Cd(d-c)/2,+n.apply(this,arguments)),S=E,F=E;if(_>Dd){var D=Td(_/c*Sd(A)),$=Td(_/d*Sd(A));(C-=2*D)>Dd?(x+=D*=m?1:-1,w-=D):(C=0,x=w=(h+f)/2),(k-=2*$)>Dd?(v+=$*=m?1:-1,b-=$):(k=0,v=b=(h+f)/2)}var O=d*Ad(v),N=d*Sd(v),I=c*Ad(w),T=c*Sd(w);if(E>Dd){var R,M=d*Ad(b),B=d*Sd(b),z=c*Ad(x),L=c*Sd(x);if(p<$d&&(R=ph(O,N,z,L,M,B,I,T))){var P=O-R[0],j=N-R[1],U=M-R[0],W=B-R[1],V=1/Sd(Id((P*U+j*W)/(Fd(P*P+j*j)*Fd(U*U+W*W)))/2),q=Fd(R[0]*R[0]+R[1]*R[1]);S=Ed(E,(c-q)/(V-1)),F=Ed(E,(d-q)/(V+1))}}k>Dd?F>Dd?(g=mh(z,L,O,N,d,F,m),y=mh(M,B,I,T,d,F,m),o.moveTo(g.cx+g.x01,g.cy+g.y01),F<E?o.arc(g.cx,g.cy,F,kd(g.y01,g.x01),kd(y.y01,y.x01),!m):(o.arc(g.cx,g.cy,F,kd(g.y01,g.x01),kd(g.y11,g.x11),!m),o.arc(0,0,d,kd(g.cy+g.y11,g.cx+g.x11),kd(y.cy+y.y11,y.cx+y.x11),!m),o.arc(y.cx,y.cy,F,kd(y.y11,y.x11),kd(y.y01,y.x01),!m))):(o.moveTo(O,N),o.arc(0,0,d,v,b,!m)):o.moveTo(O,N),c>Dd&&C>Dd?S>Dd?(g=mh(I,T,M,B,c,-S,m),y=mh(O,N,z,L,c,-S,m),o.lineTo(g.cx+g.x01,g.cy+g.y01),S<E?o.arc(g.cx,g.cy,S,kd(g.y01,g.x01),kd(y.y01,y.x01),!m):(o.arc(g.cx,g.cy,S,kd(g.y01,g.x01),kd(g.y11,g.x11),!m),o.arc(0,0,c,kd(g.cy+g.y11,g.cx+g.x11),kd(y.cy+y.y11,y.cx+y.x11),m),o.arc(y.cx,y.cy,S,kd(y.y11,y.x11),kd(y.y01,y.x01),!m))):o.arc(0,0,c,w,x,m):o.lineTo(I,T)}else o.moveTo(0,0);if(o.closePath(),u)return o=null,u+""||null}return u.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,i=(+r.apply(this,arguments)+ +s.apply(this,arguments))/2-$d/2;return[Ad(i)*n,Sd(i)*n]},u.innerRadius=function(t){return arguments.length?(e="function"==typeof t?t:uh(+t),u):e},u.outerRadius=function(e){return arguments.length?(t="function"==typeof e?e:uh(+e),u):t},u.cornerRadius=function(e){return arguments.length?(n="function"==typeof e?e:uh(+e),u):n},u.padRadius=function(e){return arguments.length?(i=null==e?null:"function"==typeof e?e:uh(+e),u):i},u.startAngle=function(e){return arguments.length?(r="function"==typeof e?e:uh(+e),u):r},u.endAngle=function(e){return arguments.length?(s="function"==typeof e?e:uh(+e),u):s},u.padAngle=function(e){return arguments.length?(a="function"==typeof e?e:uh(+e),u):a},u.context=function(e){return arguments.length?(o=null==e?null:e,u):o},u}().startAngle((e=>e.startAngle||0)).endAngle((e=>e.endAngle||0)).padAngle((e=>e.padAngle||0)).innerRadius((e=>e.innerRadius||0)).outerRadius((e=>e.outerRadius||0)).cornerRadius((e=>e.cornerRadius||0)),by=xh().x(my).y1(gy).y0((e=>(e.y||0)+(e.height||0))).defined(yy),xy=xh().y(gy).x1(my).x0((e=>(e.x||0)+(e.width||0))).defined(yy),wy=bh().x(my).y(gy).defined(yy),Cy=hy().x(my).y(gy).width((e=>e.width||0)).height((e=>e.height||0)).cornerRadius((e=>py(e.cornerRadiusTopLeft,e.cornerRadius)||0),(e=>py(e.cornerRadiusTopRight,e.cornerRadius)||0),(e=>py(e.cornerRadiusBottomRight,e.cornerRadius)||0),(e=>py(e.cornerRadiusBottomLeft,e.cornerRadius)||0)),ky=function(e,t){var n=null;function i(){var i;if(n||(n=i=oh()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),i)return n=null,i+""||null}return e="function"==typeof e?e:uh(e||wh),t="function"==typeof t?t:uh(void 0===t?64:+t),i.type=function(t){return arguments.length?(e="function"==typeof t?t:uh(t),i):e},i.size=function(e){return arguments.length?(t="function"==typeof e?e:uh(+e),i):t},i.context=function(e){return arguments.length?(n=null==e?null:e,i):n},i}().type((e=>iy(e.shape||"circle"))).size((e=>py(e.size,64))),Ay=fy().x(my).y(gy).defined(yy).size((e=>e.size||1));function _y(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function Ey(e,t,n,i){return Cy.context(e)(t,n,i)}var Sy=1;function Fy(){Sy=1}function Dy(e,t,n){var i=t.clip,r=e._defs,s=t.clip_id||(t.clip_id="clip"+Sy++),a=r.clipping[s]||(r.clipping[s]={id:s});return yn(i)?a.path=i(null):_y(n)?a.path=Ey(null,n,0,0):(a.width=n.width||0,a.height=n.height||0),"url(#"+s+")"}function $y(e){this.clear(),e&&this.union(e)}function Oy(e){this.mark=e,this.bounds=this.bounds||new $y}function Ny(e){Oy.call(this,e),this.items=this.items||[]}function Iy(e){this._pending=0,this._loader=e||Go()}function Ty(e){e._pending+=1}function Ry(e){e._pending-=1}function My(e,t,n){if(t.stroke&&0!==t.opacity&&0!==t.strokeOpacity){const i=null!=t.strokeWidth?+t.strokeWidth:1;e.expand(i+(n?function(e,t){return e.strokeJoin&&"miter"!==e.strokeJoin?0:t}(t,i):0))}return e}$y.prototype={clone(){return new $y(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,i){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),i<t?(this.y2=t,this.y1=i):(this.y1=t,this.y2=i),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const i=this.rotatedPoints(e,t,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(e,t,n){var{x1:i,y1:r,x2:s,y2:a}=this,o=Math.cos(e),u=Math.sin(e),l=t-t*o+n*u,c=n-t*u-n*o;return[o*i-u*r+l,u*i+o*r+c,o*i-u*a+l,u*i+o*a+c,o*s-u*r+l,u*s+o*r+c,o*s-u*a+l,u*s+o*a+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},On(Ny,Oy),Iy.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return Ty(t),t._loader.sanitize(e,{context:"href"}).then((e=>(Ry(t),e))).catch((()=>(Ry(t),null)))},loadImage(e){const t=this,n=kh();return Ty(t),t._loader.sanitize(e,{context:"image"}).then((e=>{const i=e.href;if(!i||!n)throw{url:i};const r=new n,s=Fn(e,"crossOrigin")?e.crossOrigin:"anonymous";return null!=s&&(r.crossOrigin=s),r.onload=()=>Ry(t),r.onerror=()=>Ry(t),r.src=i,r})).catch((e=>(Ry(t),{complete:!1,width:0,height:0,src:e&&e.url||""})))},ready(){const e=this;return new Promise((t=>{!function n(i){e.pending()?setTimeout((()=>{n(!0)}),10):t(i)}(!1)}))}};const By=qg-1e-8;let zy,Ly,Py,jy,Uy,Wy,Vy,qy;const Gy=(e,t)=>zy.add(e,t),Hy=(e,t)=>Gy(Ly=e,Py=t),Xy=e=>Gy(e,zy.y1),Yy=e=>Gy(zy.x1,e),Ky=(e,t)=>Uy*e+Vy*t,Jy=(e,t)=>Wy*e+qy*t,Zy=(e,t)=>Gy(Ky(e,t),Jy(e,t)),Qy=(e,t)=>Hy(Ky(e,t),Jy(e,t));function ev(e,t){return zy=e,t?(jy=t*Wg,Uy=qy=Math.cos(jy),Wy=Math.sin(jy),Vy=-Wy):(Uy=qy=1,jy=Wy=Vy=0),tv}const tv={beginPath(){},closePath(){},moveTo:Qy,lineTo:Qy,rect(e,t,n,i){jy?(Zy(e+n,t),Zy(e+n,t+i),Zy(e,t+i),Qy(e,t)):(Gy(e+n,t+i),Hy(e,t))},quadraticCurveTo(e,t,n,i){const r=Ky(e,t),s=Jy(e,t),a=Ky(n,i),o=Jy(n,i);nv(Ly,r,a,Xy),nv(Py,s,o,Yy),Hy(a,o)},bezierCurveTo(e,t,n,i,r,s){const a=Ky(e,t),o=Jy(e,t),u=Ky(n,i),l=Jy(n,i),c=Ky(r,s),d=Jy(r,s);iv(Ly,a,u,c,Xy),iv(Py,o,l,d,Yy),Hy(c,d)},arc(e,t,n,i,r,s){if(i+=jy,r+=jy,Ly=n*Math.cos(r)+e,Py=n*Math.sin(r)+t,Math.abs(r-i)>By)Gy(e-n,t-n),Gy(e+n,t+n);else{const a=i=>Gy(n*Math.cos(i)+e,n*Math.sin(i)+t);let o,u;if(a(i),a(r),r!==i)if((i%=qg)<0&&(i+=qg),(r%=qg)<0&&(r+=qg),r<i&&(s=!s,o=i,i=r,r=o),s)for(r-=qg,o=i-i%Vg,u=0;u<4&&o>r;++u,o-=Vg)a(o);else for(o=i-i%Vg+Vg,u=0;u<4&&o<r;++u,o+=Vg)a(o)}}};function nv(e,t,n,i){const r=(e-t)/(e+n-2*t);0<r&&r<1&&i(e+(t-e)*r)}function iv(e,t,n,i,r){const s=i-e+3*t-3*n,a=e+n-2*t,o=e-t;let u,l=0,c=0;Math.abs(s)>1e-14?(u=a*a+o*s,u>=0&&(u=Math.sqrt(u),l=(-a+u)/s,c=(-a-u)/s)):l=.5*o/a,0<l&&l<1&&r(rv(l,e,t,n,i)),0<c&&c<1&&r(rv(c,e,t,n,i))}function rv(e,t,n,i,r){const s=1-e,a=s*s,o=e*e;return a*s*t+3*a*e*n+3*s*o*i+o*e*r}var sv=(sv=Ch(1,1))?sv.getContext("2d"):null;const av=new $y;function ov(e){return function(t,n){if(!sv)return!0;e(sv,t),av.clear().union(t.bounds).intersect(n).round();const{x1:i,y1:r,x2:s,y2:a}=av;for(let e=r;e<=a;++e)for(let t=i;t<=s;++t)if(sv.isPointInPath(t,e))return!0;return!1}}function uv(e,t){return t.contains(e.x||0,e.y||0)}function lv(e,t){const n=e.x||0,i=e.y||0,r=e.width||0,s=e.height||0;return t.intersects(av.set(n,i,n+r,i+s))}function cv(e,t){const n=e.x||0,i=e.y||0;return dv(t,n,i,null!=e.x2?e.x2:n,null!=e.y2?e.y2:i)}function dv(e,t,n,i,r){const{x1:s,y1:a,x2:o,y2:u}=e,l=i-t,c=r-n;let d,h,f,p,m=0,g=1;for(p=0;p<4;++p){if(0===p&&(d=-l,h=-(s-t)),1===p&&(d=l,h=o-t),2===p&&(d=-c,h=-(a-n)),3===p&&(d=c,h=u-n),Math.abs(d)<1e-10&&h<0)return!1;if(f=h/d,d<0){if(f>g)return!1;f>m&&(m=f)}else if(d>0){if(f<m)return!1;f<g&&(g=f)}}return!0}function hv(e,t){e.globalCompositeOperation=t.blend||"source-over"}function fv(e,t){return null==e?t:e}function pv(e,t){const n=t.length;for(let i=0;i<n;++i)e.addColorStop(t[i].offset,t[i].color);return e}function mv(e,t,n){return Tg(n)?function(e,t,n){const i=n.width(),r=n.height();let s;if("radial"===t.gradient)s=e.createRadialGradient(n.x1+fv(t.x1,.5)*i,n.y1+fv(t.y1,.5)*r,Math.max(i,r)*fv(t.r1,0),n.x1+fv(t.x2,.5)*i,n.y1+fv(t.y2,.5)*r,Math.max(i,r)*fv(t.r2,.5));else{const a=fv(t.x1,0),o=fv(t.y1,0),u=fv(t.x2,1),l=fv(t.y2,0);if(a!==u&&o!==l&&i!==r){const n=Ch(Math.ceil(i),Math.ceil(r)),s=n.getContext("2d");return s.scale(i,r),s.fillStyle=pv(s.createLinearGradient(a,o,u,l),t.stops),s.fillRect(0,0,i,r),e.createPattern(n,"no-repeat")}s=e.createLinearGradient(n.x1+a*i,n.y1+o*r,n.x1+u*i,n.y1+l*r)}return pv(s,t.stops)}(e,n,t.bounds):n}function gv(e,t,n){return(n*=null==t.fillOpacity?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=mv(e,t,t.fill),!0)}var yv=[];function vv(e,t,n){var i=null!=(i=t.strokeWidth)?i:1;return!(i<=0)&&(n*=null==t.strokeOpacity?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=mv(e,t,t.stroke),e.lineWidth=i,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||yv),e.lineDashOffset=t.strokeDashOffset||0),!0)}function bv(e,t){return e.zindex-t.zindex||e.index-t.index}function xv(e){if(!e.zdirty)return e.zitems;var t,n,i,r=e.items,s=[];for(n=0,i=r.length;n<i;++n)(t=r[n]).index=n,t.zindex&&s.push(t);return e.zdirty=!1,e.zitems=s.sort(bv)}function wv(e,t){var n,i,r=e.items;if(!r||!r.length)return;const s=xv(e);if(s&&s.length){for(n=0,i=r.length;n<i;++n)r[n].zindex||t(r[n]);r=s}for(n=0,i=r.length;n<i;++n)t(r[n])}function Cv(e,t){var n,i,r=e.items;if(!r||!r.length)return null;const s=xv(e);for(s&&s.length&&(r=s),i=r.length;--i>=0;)if(n=t(r[i]))return n;if(r===s)for(i=(r=e.items).length;--i>=0;)if(!r[i].zindex&&(n=t(r[i])))return n;return null}function kv(e){return function(t,n,i){wv(n,(n=>{i&&!i.intersects(n.bounds)||_v(e,t,n,n)}))}}function Av(e){return function(t,n,i){!n.items.length||i&&!i.intersects(n.bounds)||_v(e,t,n.items[0],n.items)}}function _v(e,t,n,i){var r=null==n.opacity?1:n.opacity;0!==r&&(e(t,i)||(hv(t,n),n.fill&&gv(t,n,r)&&t.fill(),n.stroke&&vv(t,n,r)&&t.stroke()))}function Ev(e){return e=e||Ht,function(t,n,i,r,s,a){return i*=t.pixelRatio,r*=t.pixelRatio,Cv(n,(n=>{const o=n.bounds;if((!o||o.contains(s,a))&&o)return e(t,n,i,r,s,a)?n:void 0}))}}function Sv(e,t){return function(n,i,r,s){var a,o,u=Array.isArray(i)?i[0]:i,l=null==t?u.fill:t,c=u.stroke&&n.isPointInStroke;return c&&(a=u.strokeWidth,o=u.strokeCap,n.lineWidth=null!=a?a:1,n.lineCap=null!=o?o:"butt"),!e(n,i)&&(l&&n.isPointInPath(r,s)||c&&n.isPointInStroke(r,s))}}function Fv(e){return Ev(Sv(e))}function Dv(e,t){return"translate("+e+","+t+")"}function $v(e){return"rotate("+e+")"}function Ov(e){return Dv(e.x||0,e.y||0)}function Nv(e,t,n){function i(e,n){var i=n.x||0,r=n.y||0,s=n.angle||0;e.translate(i,r),s&&e.rotate(s*=Wg),e.beginPath(),t(e,n),s&&e.rotate(-s),e.translate(-i,-r)}return{type:e,tag:"path",nested:!1,attr:function(e,n){e("transform",function(e){return Dv(e.x||0,e.y||0)+(e.angle?" "+$v(e.angle):"")}(n)),e("d",t(null,n))},bound:function(e,n){return t(ev(e,n.angle),n),My(e,n).translate(n.x||0,n.y||0)},draw:kv(i),pick:Fv(i),isect:n||ov(i)}}var Iv=Nv("arc",(function(e,t){return vy.context(e)(t)}));function Tv(e,t,n){function i(e,n){e.beginPath(),t(e,n)}const r=Sv(i);return{type:e,tag:"path",nested:!0,attr:function(e,n){var i=n.mark.items;i.length&&e("d",t(null,i))},bound:function(e,n){var i=n.items;return 0===i.length?e:(t(ev(e),i),My(e,i[0]))},draw:Av(i),pick:function(e,t,n,i,s,a){var o=t.items,u=t.bounds;return!o||!o.length||u&&!u.contains(s,a)?null:(n*=e.pixelRatio,i*=e.pixelRatio,r(e,o,n,i)?o[0]:null)},isect:uv,tip:n}}var Rv=Tv("area",(function(e,t){const n=t[0],i=n.interpolate||"linear";return("horizontal"===n.orient?xy:by).curve(Lg(i,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,i,r="horizontal"===e[0].orient?t[1]:t[0],s="horizontal"===e[0].orient?"y":"x",a=e.length,o=1/0;--a>=0;)!1!==e[a].defined&&(i=Math.abs(e[a][s]-r))<o&&(o=i,n=e[a]);return n}));function Mv(e,t){e.beginPath(),_y(t)?Ey(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Bv(e){const t=fv(e.strokeWidth,1);return null!=e.strokeOffset?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function zv(e,t){const n=Bv(t);e("d",Ey(null,t,n,n))}function Lv(e,t,n,i){const r=Bv(t);e.beginPath(),Ey(e,t,(n||0)+r,(i||0)+r)}const Pv=Sv(Lv),jv=Sv(Lv,!1),Uv=Sv(Lv,!0);var Wv={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",Ov(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,i=n.length;for(let t=0;t<i;++t)e.union(n[t].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),My(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){wv(t,(t=>{const i=t.x||0,r=t.y||0,s=t.strokeForeground,a=null==t.opacity?1:t.opacity;(t.stroke||t.fill)&&a&&(Lv(e,t,i,r),hv(e,t),t.fill&&gv(e,t,a)&&e.fill(),t.stroke&&!s&&vv(e,t,a)&&e.stroke()),e.save(),e.translate(i,r),t.clip&&Mv(e,t),n&&n.translate(-i,-r),wv(t,(t=>{this.draw(e,t,n)})),n&&n.translate(i,r),e.restore(),s&&t.stroke&&a&&(Lv(e,t,i,r),hv(e,t),vv(e,t,a)&&e.stroke())}))},pick:function(e,t,n,i,r,s){if(t.bounds&&!t.bounds.contains(r,s)||!t.items)return null;const a=n*e.pixelRatio,o=i*e.pixelRatio;return Cv(t,(u=>{let l,c,d;const h=u.bounds;if(h&&!h.contains(r,s))return;c=u.x||0,d=u.y||0;const f=c+(u.width||0),p=d+(u.height||0),m=u.clip;if(m&&(r<c||r>f||s<d||s>p))return;if(e.save(),e.translate(c,d),c=r-c,d=s-d,m&&_y(u)&&!Uv(e,u,a,o))return e.restore(),null;const g=u.strokeForeground,y=!1!==t.interactive;return y&&g&&u.stroke&&jv(e,u,a,o)?(e.restore(),u):(l=Cv(u,(e=>function(e,t,n){return(!1!==e.interactive||"group"===e.marktype)&&e.bounds&&e.bounds.contains(t,n)}(e,c,d)?this.pick(e,n,i,c,d):null)),!l&&y&&(u.fill||!g&&u.stroke)&&Pv(e,u,a,o)&&(l=u),e.restore(),l||null)}))},isect:lv,content:function(e,t,n){e("clip-path",t.clip?Dy(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),zv(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?zv(e,t):e("d","")}},Vv={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function qv(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then((t=>{e.image=t,e.image.url=e.url}))),n}function Gv(e,t){return null!=e.width?e.width:t&&t.width?!1!==e.aspect&&e.height?e.height*t.width/t.height:t.width:0}function Hv(e,t){return null!=e.height?e.height:t&&t.height?!1!==e.aspect&&e.width?e.width*t.height/t.width:t.height:0}function Xv(e,t){return"center"===e?t/2:"right"===e?t:0}function Yv(e,t){return"middle"===e?t/2:"bottom"===e?t:0}var Kv={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const i=qv(t,n),r=Gv(t,i),s=Hv(t,i),a=(t.x||0)-Xv(t.align,r),o=(t.y||0)-Yv(t.baseline,s);e("href",!i.src&&i.toDataURL?i.toDataURL():i.src||"",Vv["xmlns:xlink"],"xlink:href"),e("transform",Dv(a,o)),e("width",r),e("height",s),e("preserveAspectRatio",!1===t.aspect?"none":"xMidYMid")},bound:function(e,t){const n=t.image,i=Gv(t,n),r=Hv(t,n),s=(t.x||0)-Xv(t.align,i),a=(t.y||0)-Yv(t.baseline,r);return e.set(s,a,s+i,a+r)},draw:function(e,t,n){wv(t,(t=>{if(n&&!n.intersects(t.bounds))return;const i=qv(t,this);let r=Gv(t,i),s=Hv(t,i);if(0===r||0===s)return;let a,o,u,l,c=(t.x||0)-Xv(t.align,r),d=(t.y||0)-Yv(t.baseline,s);!1!==t.aspect&&(o=i.width/i.height,u=t.width/t.height,o==o&&u==u&&o!==u&&(u<o?(l=r/o,d+=(s-l)/2,s=l):(l=s*o,c+=(r-l)/2,r=l))),(i.complete||i.toDataURL)&&(hv(e,t),e.globalAlpha=null!=(a=t.opacity)?a:1,e.imageSmoothingEnabled=!1!==t.smooth,e.drawImage(i,c,d,r,s))}))},pick:Ev(),isect:Ht,get:qv,xOffset:Xv,yOffset:Yv},Jv=Tv("line",(function(e,t){const n=t[0],i=n.interpolate||"linear";return wy.curve(Lg(i,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,i,r=Math.pow(e[0].strokeWidth||1,2),s=e.length;--s>=0;)if(!1!==e[s].defined&&(n=e[s].x-t[0])*n+(i=e[s].y-t[1])*i<r)return e[s];return null}));function Zv(e,t){var n=t.path;if(null==n)return!0;var i=t.x||0,r=t.y||0,s=t.scaleX||1,a=t.scaleY||1,o=(t.angle||0)*Wg,u=t.pathCache;u&&u.path===n||((t.pathCache=u=Ug(n)).path=n),o&&e.rotate&&e.translate?(e.translate(i,r),e.rotate(o),Qg(e,u,0,0,s,a),e.rotate(-o),e.translate(-i,-r)):Qg(e,u,i,r,s,a)}var Qv={type:"path",tag:"path",nested:!1,attr:function(e,t){var n=t.scaleX||1,i=t.scaleY||1;1===n&&1===i||e("vector-effect","non-scaling-stroke"),e("transform",function(e){return Dv(e.x||0,e.y||0)+(e.angle?" "+$v(e.angle):"")+(e.scaleX||e.scaleY?" "+(t=e.scaleX||1,n=e.scaleY||1,"scale("+t+","+n+")"):"");var t,n}(t)),e("d",t.path)},bound:function(e,t){return Zv(ev(e,t.angle),t)?e.set(0,0,0,0):My(e,t,!0)},draw:kv(Zv),pick:Fv(Zv),isect:ov(Zv)};function eb(e,t){e.beginPath(),Ey(e,t)}var tb={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",Ey(null,t))},bound:function(e,t){var n,i;return My(e.set(n=t.x||0,i=t.y||0,n+t.width||0,i+t.height||0),t)},draw:kv(eb),pick:Fv(eb),isect:lv};function nb(e,t,n){var i,r,s,a;return!(!t.stroke||!vv(e,t,n)||(i=t.x||0,r=t.y||0,s=null!=t.x2?t.x2:i,a=null!=t.y2?t.y2:r,e.beginPath(),e.moveTo(i,r),e.lineTo(s,a),0))}var ib={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",Ov(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)},bound:function(e,t){var n,i;return My(e.set(n=t.x||0,i=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:i),t)},draw:function(e,t,n){wv(t,(t=>{if(!n||n.intersects(t.bounds)){var i=null==t.opacity?1:t.opacity;i&&nb(e,t,i)&&(hv(e,t),e.stroke())}}))},pick:Ev((function(e,t,n,i){return!!e.isPointInStroke&&nb(e,t,1)&&e.isPointInStroke(n,i)})),isect:cv},rb=Nv("shape",(function(e,t){return(t.mark.shape||t.shape).context(e)(t)})),sb=Nv("symbol",(function(e,t){return ky.context(e)(t)}),uv);const ab=function(e){let t,n,i;e=+e||1e4;const r=()=>{t={},n={},i=0},s=(r,s)=>(++i>e&&(n=t,t={},i=1),t[r]=s);return r(),{clear:r,has:e=>Fn(t,e)||Fn(n,e),get:e=>Fn(t,e)?t[e]:Fn(n,e)?s(e,n[e]):void 0,set:(e,n)=>Fn(t,e)?t[e]=n:s(e,n)}}();var ob={height:fb,measureWidth:db,estimateWidth:lb,width:lb,canvas:ub};function ub(e){ob.width=e&&sv?db:lb}function lb(e,t){return cb(yb(e,t),fb(e))}function cb(e,t){return~~(.8*e.length*t)}function db(e,t){return fb(e)<=0||!(t=yb(e,t))?0:hb(t,bb(e))}function hb(e,t){const n=`(${t}) ${e}`;let i=ab.get(n);return void 0===i&&(sv.font=t,i=sv.measureText(e).width,ab.set(n,i)),i}function fb(e){return null!=e.fontSize?+e.fontSize||0:11}function pb(e){return null!=e.lineHeight?e.lineHeight:fb(e)+2}function mb(e){return t=e.lineBreak&&e.text&&!Jt(e.text)?e.text.split(e.lineBreak):e.text,Jt(t)?t.length>1?t:t[0]:t;var t}function gb(e){const t=mb(e);return(Jt(t)?t.length-1:0)*pb(e)}function yb(e,t){const n=null==t?"":(t+"").trim();return e.limit>0&&n.length?function(e,t){var n=+e.limit,i=function(e){if(ob.width===db){const t=bb(e);return e=>hb(e,t)}{const t=fb(e);return e=>cb(e,t)}}(e);if(i(t)<n)return t;var r,s=e.ellipsis||"…",a="rtl"===e.dir,o=0,u=t.length;if(n-=i(s),a){for(;o<u;)r=o+u>>>1,i(t.slice(r))>n?o=r+1:u=r;return s+t.slice(o)}for(;o<u;)r=1+(o+u>>>1),i(t.slice(0,r))<n?o=r:u=r-1;return t.slice(0,o)+s}(e,n):n}function vb(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function bb(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+fb(e)+"px "+vb(e,t)}function xb(e){var t=e.baseline,n=fb(e);return Math.round("top"===t?.79*n:"middle"===t?.3*n:"bottom"===t?-.21*n:"line-top"===t?.29*n+.5*pb(e):"line-bottom"===t?.29*n-.5*pb(e):0)}ub(!0);const wb={left:"start",center:"middle",right:"end"},Cb=new $y;function kb(e){var t,n=e.x||0,i=e.y||0,r=e.radius||0;return r&&(t=(e.theta||0)-Vg,n+=r*Math.cos(t),i+=r*Math.sin(t)),Cb.x1=n,Cb.y1=i,Cb}function Ab(e,t,n){var i,r=ob.height(t),s=t.align,a=kb(t),o=a.x1,u=a.y1,l=t.dx||0,c=(t.dy||0)+xb(t)-Math.round(.8*r),d=mb(t);if(Jt(d)?(r+=pb(t)*(d.length-1),i=d.reduce(((e,n)=>Math.max(e,ob.width(t,n))),0)):i=ob.width(t,d),"center"===s?l-=i/2:"right"===s&&(l-=i),e.set(l+=o,c+=u,l+i,c+r),t.angle&&!n)e.rotate(t.angle*Wg,o,u);else if(2===n)return e.rotatedPoints(t.angle*Wg,o,u);return e}var _b={arc:Iv,area:Rv,group:Wv,image:Kv,line:Jv,path:Qv,rect:tb,rule:ib,shape:rb,symbol:sb,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,i=t.dx||0,r=(t.dy||0)+xb(t),s=kb(t),a=s.x1,o=s.y1,u=t.angle||0;e("text-anchor",wb[t.align]||"start"),u?(n=Dv(a,o)+" "+$v(u),(i||r)&&(n+=" "+Dv(i,r))):n=Dv(a+i,o+r),e("transform",n)},bound:Ab,draw:function(e,t,n){wv(t,(t=>{var i,r,s,a,o,u,l,c=null==t.opacity?1:t.opacity;if(!(n&&!n.intersects(t.bounds)||0===c||t.fontSize<=0||null==t.text||0===t.text.length)){if(e.font=bb(t),e.textAlign=t.align||"left",r=(i=kb(t)).x1,s=i.y1,t.angle&&(e.save(),e.translate(r,s),e.rotate(t.angle*Wg),r=s=0),r+=t.dx||0,s+=(t.dy||0)+xb(t),u=mb(t),hv(e,t),Jt(u))for(o=pb(t),a=0;a<u.length;++a)l=yb(t,u[a]),t.fill&&gv(e,t,c)&&e.fillText(l,r,s),t.stroke&&vv(e,t,c)&&e.strokeText(l,r,s),s+=o;else l=yb(t,u),t.fill&&gv(e,t,c)&&e.fillText(l,r,s),t.stroke&&vv(e,t,c)&&e.strokeText(l,r,s);t.angle&&e.restore()}}))},pick:Ev((function(e,t,n,i,r,s){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var a=kb(t),o=a.x1,u=a.y1,l=Ab(Cb,t,1),c=-t.angle*Wg,d=Math.cos(c),h=Math.sin(c),f=d*r-h*s+(o-d*o+h*u),p=h*r+d*s+(u-h*o-d*u);return l.contains(f,p)})),isect:function(e,t){const n=Ab(Cb,e,2);return dv(t,n[0],n[1],n[2],n[3])||dv(t,n[0],n[1],n[4],n[5])||dv(t,n[4],n[5],n[6],n[7])||dv(t,n[2],n[3],n[6],n[7])}},trail:Tv("trail",(function(e,t){return Ay.context(e)(t)}),(function(e,t){for(var n,i,r=e.length;--r>=0;)if(!1!==e[r].defined&&(n=e[r].x-t[0])*n+(i=e[r].y-t[1])*i<(n=e[r].size||1)*n)return e[r];return null}))};function Eb(e,t,n){var i=_b[e.mark.marktype],r=t||i.bound;return i.nested&&(e=e.mark),r(e.bounds||(e.bounds=new $y),e,n)}var Sb={mark:null};function Fb(e,t,n){var i,r,s,a,o=_b[e.marktype],u=o.bound,l=e.items,c=l&&l.length;if(o.nested)return c?s=l[0]:(Sb.mark=e,s=Sb),a=Eb(s,u,n),t&&t.union(a)||a;if(t=t||e.bounds&&e.bounds.clear()||new $y,c)for(i=0,r=l.length;i<r;++i)t.union(Eb(l[i],u,n));return e.bounds=t}const Db=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function $b(e,t){return JSON.stringify(e,Db,t)}function Ob(e){return Nb("string"==typeof e?JSON.parse(e):e)}function Nb(e){var t,n,i,r=e.marktype,s=e.items;if(s)for(n=0,i=s.length;n<i;++n)t=r?"mark":"group",s[n][t]=e,s[n].zindex&&(s[n][t].zdirty=!0),"group"===(r||t)&&Nb(s[n]);return r&&Fb(e),e}function Ib(e){arguments.length?this.root=Ob(e):(this.root=Tb({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Ny(this.root)])}function Tb(e,t){const n={bounds:new $y,clip:!!e.clip,group:t,interactive:!1!==e.interactive,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return null!=e.aria&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function Rb(e,t,n){return!e&&"undefined"!=typeof document&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Mb(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===t)return n[i]}function Bb(e,t,n,i){var r,s=e.childNodes[t];return s&&s.tagName.toLowerCase()===n.toLowerCase()||(r=s||null,s=Rb(e.ownerDocument,n,i),e.insertBefore(s,r)),s}function zb(e,t){for(var n=e.childNodes,i=n.length;i>t;)e.removeChild(n[--i]);return e}function Lb(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function Pb(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function jb(e,t){this._active=null,this._handlers={},this._loader=e||Go(),this._tooltip=t||Ub}function Ub(e,t,n,i){e.element().setAttribute("title",i||"")}function Wb(e){this._el=null,this._bgcolor=null,this._loader=new Iy(e)}Ib.prototype={toJSON(e){return $b(this.root,e||0)},mark(e,t,n){const i=Tb(e,t=t||this.root.items[0]);return t.items[n]=i,i.zindex&&(i.group.zdirty=!0),i}},jb.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let i=e?e.length:0;--i>=0;)if(e[i].type===t&&(!n||e[i].handler===n))return i;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const e in t)n.push(...t[e]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then((t=>{const n=new MouseEvent(e.type,e),i=Rb(null,"a");for(const e in t)i.setAttribute(e,t[e]);i.dispatchEvent(n)})).catch((()=>{}))},handleTooltip(e,t,n){if(t&&null!=t.tooltip){t=function(e,t,n,i){var r,s,a=e&&e.mark;if(a&&(r=_b[a.marktype]).tip){for((s=Pb(t,n))[0]-=i[0],s[1]-=i[1];e=e.mark.group;)s[0]-=e.x||0,s[1]-=e.y||0;e=r.tip(a.items,s)}return e}(t,e,this.canvas(),this._origin);const i=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,i)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),i=this._origin,r=e.bounds,s=r.width(),a=r.height();let o=r.x1+i[0]+n.left,u=r.y1+i[1]+n.top;for(;e.mark&&(e=e.mark.group);)o+=e.x||0,u+=e.y||0;return{x:o,y:u,width:s,height:a,left:o,top:u,right:o+s,bottom:u+a}}},Wb.prototype={initialize(e,t,n,i,r){return this._el=e,this.resize(t,n,i,r)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,i){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=i||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then((()=>t)):Promise.resolve(t)},_load(e,t){var n=this,i=n._loader[e](t);if(!n._ready){const e=n._call;n._ready=n._loader.ready().then((t=>{t&&e(),n._ready=null}))}return i},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const Vb="dragenter",qb="dragleave",Gb="dragover",Hb="mousedown",Xb="mousemove",Yb="mouseout",Kb="mouseover",Jb="click",Zb="mousewheel",Qb="touchstart",ex="touchmove",tx="touchend",nx=Xb,ix=Yb,rx=Jb;function sx(e,t){jb.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}function ax(e,t){(e=>e===Qb||e===ex||e===tx?[Qb,ex,tx]:[e])(t).forEach((t=>function(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?n=>e[t](n):n=>e.fire(t,n)))}(e,t)))}function ox(e,t,n){return function(i){const r=this._active,s=this.pickEvent(i);s===r||(r&&r.exit||this.fire(n,i),this._active=s,this.fire(t,i)),this.fire(e,i)}}function ux(e){return function(t){this.fire(e,t),this._active=null}}On(sx,jb,{initialize(e,t,n){return this._canvas=e&&Mb(e,"canvas"),[Jb,Hb,Xb,Yb,qb].forEach((e=>ax(this,e))),jb.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup",Vb,qb,Gb,Hb,"mouseup",Xb,Yb,Kb,Jb,"dblclick","wheel",Zb,Qb,ex,tx],DOMMouseScroll(e){this.fire(Zb,e)},mousemove:ox(Xb,Kb,Yb),dragover:ox(Gb,Vb,qb),mouseout:ux(Yb),dragleave:ux(qb),mousedown(e){this._down=this._active,this.fire(Hb,e)},click(e){this._down===this._active&&(this.fire(Jb,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(Qb,e,!0)},touchmove(e){this.fire(ex,e,!0)},touchend(e){this.fire(tx,e,!0),this._touch=null},fire(e,t,n){const i=n?this._touch:this._active,r=this._handlers[e];if(t.vegaType=e,e===rx&&i&&i.href?this.handleHref(t,i,i.href):e!==nx&&e!==ix||this.handleTooltip(t,i,e!==ix),r)for(let e=0,n=r.length;e<n;++e)r[e].handler.call(this._obj,t,i)},on(e,t){const n=this.eventName(e),i=this._handlers;return this._handlerIndex(i[n],e,t)<0&&(ax(this,e),(i[n]||(i[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&i.splice(r,1),this},pickEvent(e){const t=Pb(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,i,r){const s=this.context();return _b[e.marktype].pick.call(this,s,e,t,n,i,r)}});var lx="undefined"!=typeof window&&window.devicePixelRatio||1;function cx(e){Wb.call(this,e),this._options={},this._redraw=!1,this._dirty=new $y,this._tempb=new $y}const dx=Wb.prototype;function hx(e,t){jb.call(this,e,t);const n=this;n._hrefHandler=fx(n,((e,t)=>{t&&t.href&&n.handleHref(e,t,t.href)})),n._tooltipHandler=fx(n,((e,t)=>{n.handleTooltip(e,t,e.type!==ix)}))}On(cx,Wb,{initialize(e,t,n,i,r,s){return this._options=s||{},this._canvas=this._options.externalContext?null:Ch(1,1,this._options.type),e&&this._canvas&&(zb(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),dx.initialize.call(this,e,t,n,i,r)},resize(e,t,n,i){if(dx.resize.call(this,e,t,n,i),this._canvas)!function(e,t,n,i,r,s){const a="undefined"!=typeof HTMLElement&&e instanceof HTMLElement&&null!=e.parentNode,o=e.getContext("2d"),u=a?lx:r;e.width=t*u,e.height=n*u;for(const e in s)o[e]=s[e];a&&1!==u&&(e.style.width=t+"px",e.style.height=n+"px"),o.pixelRatio=u,o.setTransform(u,0,0,u,u*i[0],u*i[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const e=this._options.externalContext;e||Pt("CanvasRenderer is missing a valid canvas or context"),e.scale(this._scale,this._scale),e.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,i=this._width,r=this._height,s=this._dirty,a=((e,t,n)=>(new $y).set(0,0,t,n).translate(-e[0],-e[1]))(n,i,r);t.save();const o=this._redraw||s.empty()?(this._redraw=!1,a.expand(1)):function(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-n[0]%1,-n[1]%1),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}(t,a.intersect(s),n);return this.clear(-n[0],-n[1],i,r),this.draw(t,e,o),t.restore(),s.clear(),this},draw(e,t,n){const i=_b[t.marktype];t.clip&&function(e,t){var n=t.clip;e.save(),yn(n)?(e.beginPath(),n(e),e.clip()):Mv(e,t.group)}(e,t),i.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,i){const r=this._options,s=this.context();"pdf"===r.type||r.externalContext||s.clearRect(e,t,n,i),null!=this._bgcolor&&(s.fillStyle=this._bgcolor,s.fillRect(e,t,n,i))}});const fx=(e,t)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,t.call(e._obj,n,i)};On(hx,jb,{initialize(e,t,n){let i=this._svg;return i&&(i.removeEventListener(rx,this._hrefHandler),i.removeEventListener(nx,this._tooltipHandler),i.removeEventListener(ix,this._tooltipHandler)),this._svg=i=e&&Mb(e,"svg"),i&&(i.addEventListener(rx,this._hrefHandler),i.addEventListener(nx,this._tooltipHandler),i.addEventListener(ix,this._tooltipHandler)),jb.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),i=this._handlers;if(this._handlerIndex(i[n],e,t)<0){const r={type:e,handler:t,listener:fx(this,t)};(i[n]||(i[n]=[])).push(r),this._svg&&this._svg.addEventListener(n,r.listener)}return this},off(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this}});const px="aria-hidden",mx="aria-label",gx="role",yx="aria-roledescription",vx="graphics-object",bx="graphics-symbol",xx=(e,t,n)=>({[gx]:e,[yx]:t,[mx]:n||void 0}),wx=Vn(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),Cx={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,i=t.title?Sx(e):null,r=e.context,s=r.scales[t.scale].value,a=r.dataflow.locale(),o=s.type;return("left"===n||"right"===n?"Y":"X")+"-axis"+(i?` titled '${i}'`:"")+` for a ${Zm(o)?"discrete":o} scale`+` with ${Og(a,s,e)}`}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?Sx(e):null,i=`${t.type||""} legend`.trim(),r=t.scales,s=Object.keys(r),a=e.context,o=a.scales[r[s[0]]].value,u=a.dataflow.locale();return((l=i).length?l[0].toUpperCase()+l.slice(1):l)+(n?` titled '${n}'`:"")+` for ${function(e){return(e=e.map((e=>e+("fill"===e||"stroke"===e?" color":"")))).length<2?e[0]:e.slice(0,-1).join(", ")+" and "+nn(e)}(s)}`+` with ${Og(u,o,e)}`;var l}},"title-text":{desc:"title",caption:e=>`Title text '${Ex(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${Ex(e)}'`}},kx={ariaRole:gx,ariaRoleDescription:yx,description:mx};function Ax(e,t){const n=!1===t.aria;if(e(px,n||void 0),n||null==t.description)for(const t in kx)e(kx[t],void 0);else{const n=t.mark.marktype;e(mx,t.description),e(gx,t.ariaRole||("group"===n?vx:bx)),e(yx,t.ariaRoleDescription||`${n} mark`)}}function _x(e){return!1===e.aria?{[px]:!0}:wx[e.role]?null:Cx[e.role]?function(e,t){try{const n=e.items[0],i=t.caption||(()=>"");return xx(t.role||bx,t.desc,n.description||i(n))}catch(e){return null}}(e,Cx[e.role]):function(e){const t=e.marktype,n="group"===t||"text"===t||e.items.some((e=>null!=e.description&&!1!==e.aria));return xx(n?vx:bx,`${t} mark container`,e.description)}(e)}function Ex(e){return gn(e.text).join(" ")}function Sx(e){try{return gn(nn(e.items).items[0].text).join(" ")}catch(e){return null}}const Fx=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function Dx(){let e="",t="",n="";const i=[],r=()=>t=n="",s=(e,n)=>{var i;return null!=n&&(t+=` ${e}="${i=n,Fx(i).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}"`),a},a={open(o,...u){(s=>{t&&(e+=`${t}>${n}`,r()),i.push(s)})(o),t="<"+o;for(const e of u)for(const t in e)s(t,e[t]);return a},close(){const s=i.pop();return e+=t?t+(n?`>${n}</${s}>`:"/>"):`</${s}>`,r(),a},attr:s,text:e=>(n+=Fx(e),a),toString:()=>e};return a}const $x=e=>Ox(Dx(),e)+"";function Ox(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,i=n.length;for(let t=0;t<i;++t)e.attr(n[t].name,n[t].value)}if(t.hasChildNodes()){const n=t.childNodes,i=n.length;for(let t=0;t<i;t++){const i=n[t];3===i.nodeType?e.text(i.nodeValue):Ox(e,i)}}return e.close()}const Nx={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Ix={fill:"none","stroke-miterlimit":10},Tx="http://www.w3.org/2000/xmlns/",Rx=Vv.xmlns;function Mx(e){Wb.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const Bx=Wb.prototype;function zx(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function Lx(e,t,n){let i,r,s;if("radial"===t.gradient){let i=Bb(e,n++,"pattern",Rx);Hx(i,{id:Ig+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),i=Bb(i,0,"rect",Rx),Hx(i,{width:1,height:1,fill:`url(${Yx()}#${t.id})`}),Hx(e=Bb(e,n++,"radialGradient",Rx),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else Hx(e=Bb(e,n++,"linearGradient",Rx),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(i=0,r=t.stops.length;i<r;++i)s=Bb(e,i,"stop",Rx),s.setAttribute("offset",t.stops[i].offset),s.setAttribute("stop-color",t.stops[i].color);return zb(e,i),n}function Px(e,t,n){let i;return(e=Bb(e,n,"clipPath",Rx)).setAttribute("id",t.id),t.path?(i=Bb(e,0,"path",Rx),i.setAttribute("d",t.path)):(i=Bb(e,0,"rect",Rx),Hx(i,{x:0,y:0,width:t.width,height:t.height})),zb(e,1),n+1}function jx(e,t,n,i,r){let s,a=e._svg;if(!a&&(s=t.ownerDocument,a=Rb(s,i,Rx),e._svg=a,e.mark&&(a.__data__=e,a.__values__={fill:"default"},"g"===i))){const t=Rb(s,"path",Rx);a.appendChild(t),t.__data__=e;const n=Rb(s,"g",Rx);a.appendChild(n),n.__data__=e;const i=Rb(s,"path",Rx);a.appendChild(i),i.__data__=e,i.__values__={fill:"default"}}return(a.ownerSVGElement!==r||function(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}(a,n))&&t.insertBefore(a,n?n.nextSibling:t.firstChild),a}On(Mx,Wb,{initialize(e,t,n,i,r){return this._defs={},this._clearDefs(),e&&(this._svg=Bb(e,0,"svg",Rx),this._svg.setAttributeNS(Tx,"xmlns",Rx),this._svg.setAttributeNS(Tx,"xmlns:xlink",Vv["xmlns:xlink"]),this._svg.setAttribute("version",Vv.version),this._svg.setAttribute("class","marks"),zb(e,1),this._root=Bb(this._svg,0,"g",Rx),Hx(this._root,Ix),zb(this._svg,1)),this.background(this._bgcolor),Bx.initialize.call(this,e,t,n,i,r)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Bx.background.apply(this,arguments)},resize(e,t,n,i){return Bx.resize.call(this,e,t,n,i),this._svg&&(Hx(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=Bb(e,0,"rect",Rx),Hx(n,{width:this._width,height:this._height,fill:t}));const i=$x(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),i},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),zb(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,i,r,s,a,o,u;for(a=0,o=e.length;a<o;++a)n=e[a],i=n.mark,i.marktype!==r&&(r=i.marktype,s=_b[r]),i.zdirty&&i.dirty!==t&&(this._dirtyAll=!1,zx(n,t),i.items.forEach((e=>{e.dirty=t}))),i.zdirty||(n.exit?(s.nested&&i.items.length?(u=i.items[0],u._svg&&this._update(s,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null):(n=s.nested?i.items[0]:n,n._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(s,n._svg,n):(this._dirtyAll=!1,zx(n,t)),n._update=t)));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const i=this._svg,r=_b[t.marktype],s=!1===t.interactive?"none":null,a="g"===r.tag;let o=null,u=0;const l=jx(t,e,n,"g",i);l.setAttribute("class",Lb(t));const c=_x(t);for(const e in c)Xx(l,e,c[e]);a||Xx(l,"pointer-events",s),Xx(l,"clip-path",t.clip?Dy(this,t,t.group):null);const d=e=>{const t=this.isDirty(e),n=jx(e,l,o,r.tag,i);t&&(this._update(r,n,e),a&&function(e,t,n){t=t.lastChild.previousSibling;let i,r=0;wv(n,(n=>{i=e.mark(t,n,i),++r})),zb(t,1+r)}(this,n,e)),o=n,++u};return r.nested?t.items.length&&d(t.items[0]):wv(t,d),zb(l,u),l},_update(e,t,n){Ux=t,Wx=t.__values__,Ax(qx,n),e.attr(qx,n,this);const i=Vx[e.type];i&&i.call(this,e,t,n),Ux&&this.style(Ux,n)},style(e,t){if(null!=t)for(const n in Nx){let i="font"===n?vb(t):t[n];if(i===Wx[n])continue;const r=Nx[n];null==i?e.removeAttribute(r):(Tg(i)&&(i=Rg(i,this._defs.gradient,Yx())),e.setAttribute(r,i+"")),Wx[n]=i}},defs(){const e=this._svg,t=this._defs;let n=t.el,i=0;for(const r in t.gradient)n||(t.el=n=Bb(e,1,"defs",Rx)),i=Lx(n,t.gradient[r],i);for(const r in t.clipping)n||(t.el=n=Bb(e,1,"defs",Rx)),i=Px(n,t.clipping[r],i);n&&(0===i?(e.removeChild(n),t.el=null):zb(n,i))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let Ux=null,Wx=null;const Vx={group(e,t,n){const i=Ux=t.childNodes[2];Wx=i.__values__,e.foreground(qx,n,this),Wx=t.__values__,Ux=t.childNodes[1],e.content(qx,n,this);const r=Ux=t.childNodes[0];e.background(qx,n,this);const s=!1===n.mark.interactive?"none":null;if(s!==Wx.events&&(Xx(i,"pointer-events",s),Xx(r,"pointer-events",s),Wx.events=s),n.strokeForeground&&n.stroke){const e=n.fill;Xx(i,"display",null),this.style(r,n),Xx(r,"stroke",null),e&&(n.fill=null),Wx=i.__values__,this.style(i,n),e&&(n.fill=e),Ux=null}else Xx(i,"display","none")},image(e,t,n){!1===n.smooth?(Gx(t,"image-rendering","optimizeSpeed"),Gx(t,"image-rendering","pixelated")):Gx(t,"image-rendering",null)},text(e,t,n){const i=mb(n);let r,s,a,o;Jt(i)?(s=i.map((e=>yb(n,e))),r=s.join("\n"),r!==Wx.text&&(zb(t,0),a=t.ownerDocument,o=pb(n),s.forEach(((e,i)=>{const r=Rb(a,"tspan",Rx);r.__data__=n,r.textContent=e,i&&(r.setAttribute("x",0),r.setAttribute("dy",o)),t.appendChild(r)})),Wx.text=r)):(s=yb(n,i),s!==Wx.text&&(t.textContent=s,Wx.text=s)),Xx(t,"font-family",vb(n)),Xx(t,"font-size",fb(n)+"px"),Xx(t,"font-style",n.fontStyle),Xx(t,"font-variant",n.fontVariant),Xx(t,"font-weight",n.fontWeight)}};function qx(e,t,n){t!==Wx[e]&&(n?function(e,t,n,i){null!=n?e.setAttributeNS(i,t,n):e.removeAttributeNS(i,t)}(Ux,e,t,n):Xx(Ux,e,t),Wx[e]=t)}function Gx(e,t,n){n!==Wx[t]&&(null==n?e.style.removeProperty(t):e.style.setProperty(t,n+""),Wx[t]=n)}function Hx(e,t){for(const n in t)Xx(e,n,t[n])}function Xx(e,t,n){null!=n?e.setAttribute(t,n):e.removeAttribute(t)}function Yx(){let e;return"undefined"==typeof window?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Kx(e){Wb.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}On(Kx,Wb,{svg(){return this._text},_render(e){const t=Dx();t.open("svg",_n({},Vv,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",Ix,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=_b[t.marktype],i=n.tag,r=[Ax,n.attr];e.open("g",{class:Lb(t),"clip-path":t.clip?Dy(this,t,t.group):null},_x(t),{"pointer-events":"g"!==i&&!1===t.interactive?"none":null});const s=s=>{const a=this.href(s);if(a&&e.open("a",a),e.open(i,this.attr(t,s,r,"g"!==i?i:null)),"text"===i){const t=mb(s);if(Jt(t)){const n={x:0,dy:pb(s)};for(let i=0;i<t.length;++i)e.open("tspan",i?n:null).text(yb(s,t[i])).close()}else e.text(yb(s,t))}else if("g"===i){const i=s.strokeForeground,r=s.fill,a=s.stroke;i&&a&&(s.stroke=null),e.open("path",this.attr(t,s,n.background,"bgrect")).close(),e.open("g",this.attr(t,s,n.content)),wv(s,(t=>this.mark(e,t))),e.close(),i&&a?(r&&(s.fill=null),s.stroke=a,e.open("path",this.attr(t,s,n.foreground,"bgrect")).close(),r&&(s.fill=r)):e.open("path",this.attr(t,s,n.foreground,"bgfore")).close()}e.close(),a&&e.close()};return n.nested?t.items&&t.items.length&&s(t.items[0]):wv(t,s),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then((e=>{e["xlink:href"]=e.href,e.href=null,(this._hrefs||(this._hrefs={}))[t]=e}))}return null},attr(e,t,n,i){const r={},s=(e,t,n,i)=>{r[i||e]=t};return Array.isArray(n)?n.forEach((e=>e(s,t,this))):n(s,t,this),i&&function(e,t,n,i,r){if(null==t)return e;if("bgrect"===i&&!1===n.interactive&&(e["pointer-events"]="none"),"bgfore"===i&&(!1===n.interactive&&(e["pointer-events"]="none"),e.display="none",null!==t.fill))return e;"image"===i&&!1===t.smooth&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),"text"===i&&(e["font-family"]=vb(t),e["font-size"]=fb(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const n in Nx){let i=t[n];const s=Nx[n];("transparent"!==i||"fill"!==s&&"stroke"!==s)&&null!=i&&(Tg(i)&&(i=Rg(i,r.gradient,"")),e[s]=i)}}(r,t,e,i,this._defs),r},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(t).length+Object.keys(n).length){e.open("defs");for(const n in t){const i=t[n],r=i.stops;"radial"===i.gradient?(e.open("pattern",{id:Ig+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),e.close(),e.open("radialGradient",{id:n,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})):e.open("linearGradient",{id:n,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(let t=0;t<r.length;++t)e.open("stop",{offset:r[t].offset,"stop-color":r[t].color}).close();e.close()}for(const t in n){const i=n[t];e.open("clipPath",{id:t}),i.path?e.open("path",{d:i.path}).close():e.open("rect",{x:0,y:0,width:i.width,height:i.height}).close(),e.close()}e.close()}}});const Jx={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},Zx={};function Qx(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(Zx[e]=t,this):Zx[e]}function ew(e,t,n){const i=[],r=(new $y).union(t),s=e.marktype;return s?tw(e,r,n,i):"group"===s?nw(e,r,n,i):Pt("Intersect scene must be mark node or group item.")}function tw(e,t,n,i){if(function(e,t,n){return e.bounds&&t.intersects(e.bounds)&&("group"===e.marktype||!1!==e.interactive&&(!n||n(e)))}(e,t,n)){const r=e.items,s=e.marktype,a=r.length;let o=0;if("group"===s)for(;o<a;++o)nw(r[o],t,n,i);else for(const e=_b[s].isect;o<a;++o){const n=r[o];iw(n,t,e)&&i.push(n)}}return i}function nw(e,t,n,i){n&&n(e.mark)&&iw(e,t,_b.group.isect)&&i.push(e);const r=e.items,s=r&&r.length;if(s){const a=e.x||0,o=e.y||0;t.translate(-a,-o);for(let e=0;e<s;++e)tw(r[e],t,n,i);t.translate(a,o)}return i}function iw(e,t,n){const i=e.bounds;return t.encloses(i)||t.intersects(i)&&n(e,t)}Zx.canvas=Zx.png={renderer:cx,headless:cx,handler:sx},Zx.svg={renderer:Mx,headless:Kx,handler:hx},Zx.none={};const rw=new $y;function sw(e){const t=e.clip;if(yn(t))t(ev(rw.clear()));else{if(!t)return;rw.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(rw)}function aw(e,t,n){return e===t||("path"===n?ow(e,t):e instanceof Date&&t instanceof Date?+e==+t:Tn(e)&&Tn(t)?Math.abs(e-t)<=1e-9:e&&t&&(Zt(e)||Zt(t))?function(e,t){var n,i,r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(r.sort(),s.sort(),i=r.length-1;i>=0;i--)if(r[i]!=s[i])return!1;for(i=r.length-1;i>=0;i--)if(!aw(e[n=r[i]],t[n],n))return!1;return typeof e==typeof t}(e,t):e==t)}function ow(e,t){return aw(Ug(e),Ug(t))}function uw(){Fy(),Ng=0}const lw="top",cw="left",dw="right",hw="bottom",fw="start",pw="middle",mw="end",gw="group",yw="axis",vw="title",bw="legend",xw="row-header",ww="row-footer",Cw="row-title",kw="column-header",Aw="column-footer",_w="column-title",Ew="none",Sw="all",Fw="each",Dw="flush",$w="column",Ow="row";function Nw(e){$u.call(this,null,e)}function Iw(e,t,n){return t(e.bounds.clear(),e,n)}On(Nw,$u,{transform(e,t){const n=t.dataflow,i=e.mark,r=i.marktype,s=_b[r],a=s.bound;let o,u=i.bounds;if(s.nested)i.items.length&&n.dirty(i.items[0]),u=Iw(i,a),i.items.forEach((e=>{e.bounds.clear().union(u)}));else if(r===gw||e.modified())switch(t.visit(t.MOD,(e=>n.dirty(e))),u.clear(),i.items.forEach((e=>u.union(Iw(e,a)))),i.role){case yw:case bw:case vw:t.reflow()}else o=t.changed(t.REM),t.visit(t.ADD,(e=>{u.union(Iw(e,a))})),t.visit(t.MOD,(e=>{o=o||u.alignsWith(e.bounds),n.dirty(e),u.union(Iw(e,a))})),o&&(u.clear(),i.items.forEach((e=>u.union(e.bounds))));return sw(i),t.modifies("bounds")}});const Tw=":vega_identifier:";function Rw(e){$u.call(this,0,e)}function Mw(e){$u.call(this,null,e)}function Bw(e){$u.call(this,null,e)}Rw.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},On(Rw,$u,{transform(e,t){const n=(r=t.dataflow)._signals[Tw]||(r._signals[Tw]=r.add(0)),i=e.as;var r;let s=n.value;return t.visit(t.ADD,(e=>e[i]=e[i]||++s)),n.set(this.value=s),t}}),On(Mw,$u,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,function(e){const t=e.groups,n=e.parent;return t&&1===t.size?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const i=n.marktype===gw?Ny:Oy;return t.visit(t.ADD,(e=>i.call(e,n))),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const zw={parity:e=>e.filter(((e,t)=>t%2?e.opacity=0:1)),greedy:(e,t)=>{let n;return e.filter(((e,i)=>i&&Lw(n.bounds,e.bounds,t)?e.opacity=0:(n=e,1)))}},Lw=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),Pw=(e,t)=>{for(var n,i=1,r=e.length,s=e[0].bounds;i<r;s=n,++i)if(Lw(s,n=e[i].bounds,t))return!0},jw=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},Uw=e=>(e.forEach((e=>e.opacity=1)),e),Ww=(e,t)=>e.reflow(t.modified()).modifies("opacity");function Vw(e){$u.call(this,null,e)}On(Bw,$u,{transform(e,t){const n=zw[e.method]||zw.parity,i=e.separation||0;let r,s,a=t.materialize(t.SOURCE).source;if(!a||!a.length)return;if(!e.method)return e.modified("method")&&(Uw(a),t=Ww(t,e)),t;if(a=a.filter(jw),!a.length)return;if(e.sort&&(a=a.slice().sort(e.sort)),r=Uw(a),t=Ww(t,e),r.length>=3&&Pw(r,i)){do{r=n(r,i)}while(r.length>=3&&Pw(r,i));r.length<3&&!nn(a).opacity&&(r.length>1&&(nn(r).opacity=0),nn(a).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(s=((e,t,n)=>{var i=e.range(),r=new $y;return t===lw||t===hw?r.set(i[0],-1/0,i[1],1/0):r.set(-1/0,i[0],1/0,i[1]),r.expand(n||1),e=>r.encloses(e.bounds)})(e.boundScale,e.boundOrient,+e.boundTolerance),a.forEach((e=>{s(e)||(e.opacity=0)})));const o=r[0].mark.bounds.clear();return a.forEach((e=>{e.opacity&&o.union(e.bounds)})),t}}),On(Vw,$u,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,(e=>n.dirty(e))),t.fields&&t.fields.zindex){const e=t.source&&t.source[0];e&&(e.mark.zdirty=!0)}}});const qw=new $y;function Gw(e,t,n){return e[t]===n?0:(e[t]=n,1)}function Hw(e){var t=e.items[0].orient;return t===cw||t===dw}function Xw(e,t,n,i){var r,s,a=t.items[0],o=a.datum,u=null!=a.translate?a.translate:.5,l=a.orient,c=function(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}(o),d=a.range,h=a.offset,f=a.position,p=a.minExtent,m=a.maxExtent,g=o.title&&a.items[c[2]].items[0],y=a.titlePadding,v=a.bounds,b=g&&gb(g),x=0,w=0;switch(qw.clear().union(v),v.clear(),(r=c[0])>-1&&v.union(a.items[r].bounds),(r=c[1])>-1&&v.union(a.items[r].bounds),l){case lw:x=f||0,w=-h,s=Math.max(p,Math.min(m,-v.y1)),v.add(0,-s).add(d,0),g&&Yw(e,g,s,y,b,0,-1,v);break;case cw:x=-h,w=f||0,s=Math.max(p,Math.min(m,-v.x1)),v.add(-s,0).add(0,d),g&&Yw(e,g,s,y,b,1,-1,v);break;case dw:x=n+h,w=f||0,s=Math.max(p,Math.min(m,v.x2)),v.add(0,0).add(s,d),g&&Yw(e,g,s,y,b,1,1,v);break;case hw:x=f||0,w=i+h,s=Math.max(p,Math.min(m,v.y2)),v.add(0,0).add(d,s),g&&Yw(e,g,s,y,0,0,1,v);break;default:x=a.x,w=a.y}return My(v.translate(x,w),a),Gw(a,"x",x+u)|Gw(a,"y",w+u)&&(a.bounds=qw,e.dirty(a),a.bounds=v,e.dirty(a)),a.mark.bounds.clear().union(v)}function Yw(e,t,n,i,r,s,a,o){const u=t.bounds;if(t.auto){const o=a*(n+r+i);let l=0,c=0;e.dirty(t),s?l=(t.x||0)-(t.x=o):c=(t.y||0)-(t.y=o),t.mark.bounds.clear().union(u.translate(-l,-c)),e.dirty(t)}o.union(u)}const Kw=(e,t)=>Math.floor(Math.min(e,t)),Jw=(e,t)=>Math.ceil(Math.max(e,t));function Zw(e){return(new $y).set(0,0,e.width||0,e.height||0)}function Qw(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function eC(e,t,n){const i=Zt(e)?e[t]:e;return null!=i?i:void 0!==n?n:0}function tC(e){return e<0?Math.ceil(-e):0}function nC(e,t,n){var i,r,s,a,o,u,l,c,d,h,f,p=!n.nodirty,m=n.bounds===Dw?Zw:Qw,g=qw.set(0,0,0,0),y=eC(n.align,$w),v=eC(n.align,Ow),b=eC(n.padding,$w),x=eC(n.padding,Ow),w=n.columns||t.length,C=w<=0?1:Math.ceil(t.length/w),k=t.length,A=Array(k),_=Array(w),E=0,S=Array(k),F=Array(C),D=0,$=Array(k),O=Array(k),N=Array(k);for(r=0;r<w;++r)_[r]=0;for(r=0;r<C;++r)F[r]=0;for(r=0;r<k;++r)u=t[r],o=N[r]=m(u),u.x=u.x||0,$[r]=0,u.y=u.y||0,O[r]=0,s=r%w,a=~~(r/w),E=Math.max(E,l=Math.ceil(o.x2)),D=Math.max(D,c=Math.ceil(o.y2)),_[s]=Math.max(_[s],l),F[a]=Math.max(F[a],c),A[r]=b+tC(o.x1),S[r]=x+tC(o.y1),p&&e.dirty(t[r]);for(r=0;r<k;++r)r%w==0&&(A[r]=0),r<w&&(S[r]=0);if(y===Fw)for(s=1;s<w;++s){for(f=0,r=s;r<k;r+=w)f<A[r]&&(f=A[r]);for(r=s;r<k;r+=w)A[r]=f+_[s-1]}else if(y===Sw){for(f=0,r=0;r<k;++r)r%w&&f<A[r]&&(f=A[r]);for(r=0;r<k;++r)r%w&&(A[r]=f+E)}else for(y=!1,s=1;s<w;++s)for(r=s;r<k;r+=w)A[r]+=_[s-1];if(v===Fw)for(a=1;a<C;++a){for(f=0,i=(r=a*w)+w;r<i;++r)f<S[r]&&(f=S[r]);for(r=a*w;r<i;++r)S[r]=f+F[a-1]}else if(v===Sw){for(f=0,r=w;r<k;++r)f<S[r]&&(f=S[r]);for(r=w;r<k;++r)S[r]=f+D}else for(v=!1,a=1;a<C;++a)for(i=(r=a*w)+w;r<i;++r)S[r]+=F[a-1];for(d=0,r=0;r<k;++r)d=A[r]+(r%w?d:0),$[r]+=d-t[r].x;for(s=0;s<w;++s)for(h=0,r=s;r<k;r+=w)h+=S[r],O[r]+=h-t[r].y;if(y&&eC(n.center,$w)&&C>1)for(r=0;r<k;++r)(d=(o=y===Sw?E:_[r%w])-N[r].x2-t[r].x-$[r])>0&&($[r]+=d/2);if(v&&eC(n.center,Ow)&&1!==w)for(r=0;r<k;++r)(h=(o=v===Sw?D:F[~~(r/w)])-N[r].y2-t[r].y-O[r])>0&&(O[r]+=h/2);for(r=0;r<k;++r)g.union(N[r].translate($[r],O[r]));switch(d=eC(n.anchor,"x"),h=eC(n.anchor,"y"),eC(n.anchor,$w)){case mw:d-=g.width();break;case pw:d-=g.width()/2}switch(eC(n.anchor,Ow)){case mw:h-=g.height();break;case pw:h-=g.height()/2}for(d=Math.round(d),h=Math.round(h),g.clear(),r=0;r<k;++r)t[r].mark.bounds.clear();for(r=0;r<k;++r)(u=t[r]).x+=$[r]+=d,u.y+=O[r]+=h,g.union(u.mark.bounds.union(u.bounds.translate($[r],O[r]))),p&&e.dirty(u);return g}function iC(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function rC(e,t){return e.bounds[t]}function sC(e,t,n,i,r,s,a,o,u,l,c,d,h,f){var p,m,g,y,v,b,x,w,C,k=n.length,A=0,_=0;if(!k)return A;for(p=c;p<k;p+=d)n[p]&&(A=a(A,u(n[p],l)));if(!t.length)return A;for(t.length>r&&(e.warn("Grid headers exceed limit: "+r),t=t.slice(0,r)),A+=s,m=0,y=t.length;m<y;++m)e.dirty(t[m]),t[m].mark.bounds.clear();for(p=c,m=0,y=t.length;m<y;++m,p+=d){for(v=(b=t[m]).mark.bounds,g=p;g>=0&&null==(x=n[g]);g-=h);o?(w=null==f?x.x:Math.round(x.bounds.x1+f*x.bounds.width()),C=A):(w=A,C=null==f?x.y:Math.round(x.bounds.y1+f*x.bounds.height())),v.union(b.bounds.translate(w-(b.x||0),C-(b.y||0))),b.x=w,b.y=C,e.dirty(b),_=a(_,v[l])}return _}function aC(e,t,n,i,r,s){if(t){e.dirty(t);var a=n,o=n;i?a=Math.round(r.x1+s*r.width()):o=Math.round(r.y1+s*r.height()),t.bounds.translate(a-(t.x||0),o-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=a,t.y=o,e.dirty(t)}}function oC(e,t,n,i,r,s,a){const o=function(e,t){const n=e[t]||{};return(t,i)=>null!=n[t]?n[t]:null!=e[t]?e[t]:i}(n,t),u=function(e,t){let n=-1/0;return e.forEach((e=>{null!=e.offset&&(n=Math.max(n,e.offset))})),n>-1/0?n:t}(e,o("offset",0)),l=o("anchor",fw),c=l===mw?1:l===pw?.5:0,d={align:Fw,bounds:o("bounds",Dw),columns:"vertical"===o("direction")?1:e.length,padding:o("margin",8),center:o("center"),nodirty:!0};switch(t){case cw:d.anchor={x:Math.floor(i.x1)-u,column:mw,y:c*(a||i.height()+2*i.y1),row:l};break;case dw:d.anchor={x:Math.ceil(i.x2)+u,y:c*(a||i.height()+2*i.y1),row:l};break;case lw:d.anchor={y:Math.floor(r.y1)-u,row:mw,x:c*(s||r.width()+2*r.x1),column:l};break;case hw:d.anchor={y:Math.ceil(r.y2)+u,x:c*(s||r.width()+2*r.x1),column:l};break;case"top-left":d.anchor={x:u,y:u};break;case"top-right":d.anchor={x:s-u,y:u,column:mw};break;case"bottom-left":d.anchor={x:u,y:a-u,row:mw};break;case"bottom-right":d.anchor={x:s-u,y:a-u,column:mw,row:mw}}return d}function uC(e,t){var n,i,r=t.items[0],s=r.datum,a=r.orient,o=r.bounds,u=r.x,l=r.y;return r._bounds?r._bounds.clear().union(o):r._bounds=o.clone(),o.clear(),function(e,t,n){var i=t.padding,r=i-n.x,s=i-n.y;if(t.datum.title){var a=t.items[1].items[0],o=a.anchor,u=t.titlePadding||0,l=i-a.x,c=i-a.y;switch(a.orient){case cw:r+=Math.ceil(a.bounds.width())+u;break;case dw:case hw:break;default:s+=a.bounds.height()+u}switch((r||s)&&cC(e,n,r,s),a.orient){case cw:c+=lC(t,n,a,o,1,1);break;case dw:l+=lC(t,n,a,mw,0,0)+u,c+=lC(t,n,a,o,1,1);break;case hw:l+=lC(t,n,a,o,0,0),c+=lC(t,n,a,mw,-1,0,1)+u;break;default:l+=lC(t,n,a,o,0,0)}(l||c)&&cC(e,a,l,c),(l=Math.round(a.bounds.x1-i))<0&&(cC(e,n,-l,0),cC(e,a,-l,0))}else(r||s)&&cC(e,n,r,s)}(e,r,r.items[0].items[0]),o=function(e,t){return e.items.forEach((e=>t.union(e.bounds))),t.x1=e.padding,t.y1=e.padding,t}(r,o),n=2*r.padding,i=2*r.padding,o.empty()||(n=Math.ceil(o.width()+n),i=Math.ceil(o.height()+i)),"symbol"===s.type&&function(e){const t=e.reduce(((e,t)=>(e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0),e)),{});e.forEach((e=>{e.width=t[e.column],e.height=e.bounds.y2-e.y}))}(r.items[0].items[0].items[0].items),a!==Ew&&(r.x=u=0,r.y=l=0),r.width=n,r.height=i,My(o.set(u,l,u+n,l+i),r),r.mark.bounds.clear().union(o),r}function lC(e,t,n,i,r,s,a){const o="symbol"!==e.datum.type,u=n.datum.vgrad,l=(!o||!s&&u||a?t:t.items[0]).bounds[r?"y2":"x2"]-e.padding,c=u&&s?l:0,d=u&&s?0:l,h=r<=0?0:gb(n);return Math.round(i===fw?c:i===mw?d-h:.5*(l-h))}function cC(e,t,n,i){t.x+=n,t.y+=i,t.bounds.translate(n,i),t.mark.bounds.translate(n,i),e.dirty(t)}function dC(e){$u.call(this,null,e)}function hC(e,t){let n=0;if(void 0===t)for(let t of e)(t=+t)&&(n+=t);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function fC(e){$u.call(this,null,e)}function pC(e){$u.call(this,null,e)}function mC(){return eu({})}function gC(e){$u.call(this,null,e)}function yC(e){$u.call(this,[],e)}On(dC,$u,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach((t=>{e.layout&&function(e,t,n){var i,r,s,a,o,u,l,c=function(e){var t,n,i=e.items,r=i.length,s=0;const a={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;s<r;++s)if(n=(t=i[s]).items,t.marktype===gw)switch(t.role){case yw:case bw:case vw:break;case xw:a.rowheaders.push(...n);break;case ww:a.rowfooters.push(...n);break;case kw:a.colheaders.push(...n);break;case Aw:a.colfooters.push(...n);break;case Cw:a.rowtitle=n[0];break;case _w:a.coltitle=n[0];break;default:a.marks.push(...n)}return a}(t),d=c.marks,h=n.bounds===Dw?iC:rC,f=n.offset,p=n.columns||d.length,m=p<=0?1:Math.ceil(d.length/p),g=m*p;const y=nC(e,d,n);y.empty()&&y.set(0,0,0,0),c.rowheaders&&(u=eC(n.headerBand,Ow,null),i=sC(e,c.rowheaders,d,0,m,-eC(f,"rowHeader"),Kw,0,h,"x1",0,p,1,u)),c.colheaders&&(u=eC(n.headerBand,$w,null),r=sC(e,c.colheaders,d,0,p,-eC(f,"columnHeader"),Kw,1,h,"y1",0,1,p,u)),c.rowfooters&&(u=eC(n.footerBand,Ow,null),s=sC(e,c.rowfooters,d,0,m,eC(f,"rowFooter"),Jw,0,h,"x2",p-1,p,1,u)),c.colfooters&&(u=eC(n.footerBand,$w,null),a=sC(e,c.colfooters,d,0,p,eC(f,"columnFooter"),Jw,1,h,"y2",g-p,1,p,u)),c.rowtitle&&(o=eC(n.titleAnchor,Ow),l=eC(f,"rowTitle"),l=o===mw?s+l:i-l,u=eC(n.titleBand,Ow,.5),aC(e,c.rowtitle,l,0,y,u)),c.coltitle&&(o=eC(n.titleAnchor,$w),l=eC(f,"columnTitle"),l=o===mw?a+l:r-l,u=eC(n.titleBand,$w,.5),aC(e,c.coltitle,l,1,y,u))}(n,t,e.layout),function(e,t,n){var i,r,s,a,o,u=t.items,l=Math.max(0,t.width||0),c=Math.max(0,t.height||0),d=(new $y).set(0,0,l,c),h=d.clone(),f=d.clone(),p=[];for(a=0,o=u.length;a<o;++a)switch((r=u[a]).role){case yw:(Hw(r)?h:f).union(Xw(e,r,l,c));break;case vw:i=r;break;case bw:p.push(uC(e,r));break;case"frame":case"scope":case xw:case ww:case Cw:case kw:case Aw:case _w:h.union(r.bounds),f.union(r.bounds);break;default:d.union(r.bounds)}if(p.length){const t={};p.forEach((e=>{(s=e.orient||dw)!==Ew&&(t[s]||(t[s]=[])).push(e)}));for(const i in t){const r=t[i];nC(e,r,oC(r,i,n.legends,h,f,l,c))}p.forEach((t=>{const i=t.bounds;if(i.equals(t._bounds)||(t.bounds=t._bounds,e.dirty(t),t.bounds=i,e.dirty(t)),n.autosize&&"fit"===n.autosize.type)switch(t.orient){case cw:case dw:d.add(i.x1,0).add(i.x2,0);break;case lw:case hw:d.add(0,i.y1).add(0,i.y2)}else d.union(i)}))}d.union(h).union(f),i&&d.union(function(e,t,n,i,r){var s,a=t.items[0],o=a.frame,u=a.orient,l=a.anchor,c=a.offset,d=a.padding,h=a.items[0].items[0],f=a.items[1]&&a.items[1].items[0],p=u===cw||u===dw?i:n,m=0,g=0,y=0,v=0,b=0;if(o!==gw?u===cw?(m=r.y2,p=r.y1):u===dw?(m=r.y1,p=r.y2):(m=r.x1,p=r.x2):u===cw&&(m=i,p=0),s=l===fw?m:l===mw?p:(m+p)/2,f&&f.text){switch(u){case lw:case hw:b=h.bounds.height()+d;break;case cw:v=h.bounds.width()+d;break;case dw:v=-h.bounds.width()-d}qw.clear().union(f.bounds),qw.translate(v-(f.x||0),b-(f.y||0)),Gw(f,"x",v)|Gw(f,"y",b)&&(e.dirty(f),f.bounds.clear().union(qw),f.mark.bounds.clear().union(qw),e.dirty(f)),qw.clear().union(f.bounds)}else qw.clear();switch(qw.union(h.bounds),u){case lw:g=s,y=r.y1-qw.height()-c;break;case cw:g=r.x1-qw.width()-c,y=s;break;case dw:g=r.x2+qw.width()+c,y=s;break;case hw:g=s,y=r.y2+c;break;default:g=a.x,y=a.y}return Gw(a,"x",g)|Gw(a,"y",y)&&(qw.translate(g,y),e.dirty(a),a.bounds.clear().union(qw),t.bounds.clear().union(qw),e.dirty(a)),a.bounds}(e,i,l,c,d)),t.clip&&d.set(0,0,t.width||0,t.height||0),function(e,t,n,i){const r=i.autosize||{},s=r.type;if(e._autosize<1||!s)return;let a=e._width,o=e._height,u=Math.max(0,t.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),d=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-u)),f=Math.max(0,Math.ceil(n.y2-c));if("padding"===r.contains){const t=e.padding();a-=t.left+t.right,o-=t.top+t.bottom}s===Ew?(l=0,d=0,u=a,c=o):"fit"===s?(u=Math.max(0,a-l-h),c=Math.max(0,o-d-f)):"fit-x"===s?(u=Math.max(0,a-l-h),o=c+d+f):"fit-y"===s?(a=u+l+h,c=Math.max(0,o-d-f)):"pad"===s&&(a=u+l+h,o=c+d+f),e._resizeView(a,o,u,c,[l,d],r.resize)}(e,t,d,n)}(n,t,e)})),function(e){return e&&"legend-entry"!==e.mark.role}(e.mark.group)?t.reflow():t}}),On(fC,$u,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,s=e.scale,a=yg(s,null==e.count?e.values?e.values.length:10:e.count,e.minstep),o=e.format||xg(n,s,a,e.formatSpecifier,e.formatType,!!e.values),u=e.values?vg(s,e.values,a):bg(s,a);return r&&(i.rem=r),r=u.map(((e,t)=>eu({index:t/(u.length-1||1),value:e,label:o(e)}))),e.extra&&r.length&&r.push(eu({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i}}),On(pC,$u,{transform(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.item||mC,s=e.key||Zo,a=this.value;return Jt(i.encode)&&(i.encode=null),a&&(e.modified("key")||t.modified(s))&&Pt("DataJoin does not support modified key function or fields."),a||(t=t.addAll(),this.value=a=function(e){const t=$n().test((e=>e.exit));return t.lookup=n=>t.get(e(n)),t}(s)),t.visit(t.ADD,(e=>{const t=s(e);let n=a.get(t);n?n.exit?(a.empty--,i.add.push(n)):i.mod.push(n):(n=r(e),a.set(t,n),i.add.push(n)),n.datum=e,n.exit=!1})),t.visit(t.MOD,(e=>{const t=s(e),n=a.get(t);n&&(n.datum=e,i.mod.push(n))})),t.visit(t.REM,(e=>{const t=s(e),n=a.get(t);e!==n.datum||n.exit||(i.rem.push(n),n.exit=!0,++a.empty)})),t.changed(t.ADD_MOD)&&i.modifies("datum"),(t.clean()||e.clean&&a.empty>n.cleanThreshold)&&n.runAfter(a.clean),i}}),On(gC,$u,{transform(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,r=e.encoders,s=t.encode;if(Jt(s)){if(!n.changed()&&!s.every((e=>r[e])))return t.StopPropagation;s=s[0],n.encode=null}var a="enter"===s,o=r.update||Xt,u=r.enter||Xt,l=r.exit||Xt,c=(s&&!a?r[s]:o)||Xt;if(t.changed(t.ADD)&&(t.visit(t.ADD,(t=>{u(t,e),o(t,e)})),n.modifies(u.output),n.modifies(o.output),c!==Xt&&c!==o&&(t.visit(t.ADD,(t=>{c(t,e)})),n.modifies(c.output))),t.changed(t.REM)&&l!==Xt&&(t.visit(t.REM,(t=>{l(t,e)})),n.modifies(l.output)),a||c!==Xt){const r=t.MOD|(e.modified()?t.REFLOW:0);a?(t.visit(r,(t=>{const r=u(t,e)||i;(c(t,e)||r)&&n.mod.push(t)})),n.mod.length&&n.modifies(u.output)):t.visit(r,(t=>{(c(t,e)||i)&&n.mod.push(t)})),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}}),On(yC,$u,{transform(e,t){if(null!=this.value&&!e.modified())return t.StopPropagation;var n,i,r,s,a,o=t.dataflow.locale(),u=t.fork(t.NO_SOURCE|t.NO_FIELDS),l=this.value,c=e.type||fg,d=e.scale,h=+e.limit,f=yg(d,null==e.count?5:e.count,e.minstep),p=!!e.values||c===fg,m=e.format||_g(o,d,f,c,e.formatSpecifier,e.formatType,p),g=e.values||Ag(d,f);return l&&(u.rem=l),c===fg?(h&&g.length>h?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),l=g.slice(0,h-1),a=!0):l=g,yn(r=e.size)?(e.values||0!==d(l[0])||(l=l.slice(1)),s=l.reduce(((t,n)=>Math.max(t,r(n,e))),0)):r=kn(s=r||8),l=l.map(((t,n)=>eu({index:n,label:m(t,n,l),value:t,offset:s,size:r(t,e)}))),a&&(a=g[l.length],l.push(eu({index:l.length,label:"…".concat(g.length-l.length," entries"),value:a,offset:s,size:r(a,e)})))):"gradient"===c?(n=d.domain(),i=og(d,n[0],nn(n)),g.length<3&&!e.values&&n[0]!==nn(n)&&(g=[n[0],nn(n)]),l=g.map(((e,t)=>eu({index:t,label:m(e,t,g),value:e,perc:i(e)})))):(r=g.length-1,i=function(e){const t=e.domain(),n=t.length-1;let i=+t[0],r=+nn(t),s=r-i;if(e.type===Om){const e=n?s/n:.1;i-=e,r+=e,s=r-i}return e=>(e-i)/s}(d),l=g.map(((e,t)=>eu({index:t,label:m(e,t,g),value:e,perc:t?i(e):0,perc2:t===r?1:i(g[t+1])})))),u.source=l,u.add=l,this.value=l,u}});const vC=e=>e.source.x,bC=e=>e.source.y,xC=e=>e.target.x,wC=e=>e.target.y;function CC(e){$u.call(this,{},e)}CC.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},On(CC,$u,{transform(e,t){var n=e.sourceX||vC,i=e.sourceY||bC,r=e.targetX||xC,s=e.targetY||wC,a=e.as||"path",o=e.orient||"vertical",u=e.shape||"line",l=EC.get(u+"-"+o)||EC.get(u);return l||Pt("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,(e=>{e[a]=l(n(e),i(e),r(e),s(e))})),t.reflow(e.modified()).modifies(a)}});const kC=(e,t,n,i)=>"M"+e+","+t+"L"+n+","+i,AC=(e,t,n,i)=>{var r=n-e,s=i-t,a=Math.sqrt(r*r+s*s)/2;return"M"+e+","+t+"A"+a+","+a+" "+180*Math.atan2(s,r)/Math.PI+" 0 1 "+n+","+i},_C=(e,t,n,i)=>{const r=n-e,s=i-t,a=.2*(r+s),o=.2*(s-r);return"M"+e+","+t+"C"+(e+a)+","+(t+o)+" "+(n+o)+","+(i-a)+" "+n+","+i},EC=$n({line:kC,"line-radial":(e,t,n,i)=>kC(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),arc:AC,"arc-radial":(e,t,n,i)=>AC(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),curve:_C,"curve-radial":(e,t,n,i)=>_C(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),"orthogonal-horizontal":(e,t,n,i)=>"M"+e+","+t+"V"+i+"H"+n,"orthogonal-vertical":(e,t,n,i)=>"M"+e+","+t+"H"+n+"V"+i,"orthogonal-radial":(e,t,n,i)=>{const r=Math.cos(e),s=Math.sin(e),a=Math.cos(n),o=Math.sin(n);return"M"+t*r+","+t*s+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*a+","+t*o+"L"+i*a+","+i*o},"diagonal-horizontal":(e,t,n,i)=>{const r=(e+n)/2;return"M"+e+","+t+"C"+r+","+t+" "+r+","+i+" "+n+","+i},"diagonal-vertical":(e,t,n,i)=>{const r=(t+i)/2;return"M"+e+","+t+"C"+e+","+r+" "+n+","+r+" "+n+","+i},"diagonal-radial":(e,t,n,i)=>{const r=Math.cos(e),s=Math.sin(e),a=Math.cos(n),o=Math.sin(n),u=(t+i)/2;return"M"+t*r+","+t*s+"C"+u*r+","+u*s+" "+u*a+","+u*o+" "+i*a+","+i*o}});function SC(e){$u.call(this,null,e)}function FC(e){return Jm(e)&&e!==Sm}SC.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},On(SC,$u,{transform(e,t){var n,i,r,s=e.as||["startAngle","endAngle"],a=s[0],o=s[1],u=e.field||Gt,l=e.startAngle||0,c=null!=e.endAngle?e.endAngle:2*Math.PI,d=t.source,h=d.map(u),f=h.length,p=l,m=(c-l)/hC(h),g=Ml(f);for(e.sort&&g.sort(((e,t)=>h[e]-h[t])),n=0;n<f;++n)r=h[g[n]],(i=d[g[n]])[a]=p,i[o]=p+=r*m;return this.value=h,t.reflow(e.modified()).modifies(s)}});const DC=Vn(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function $C(e){$u.call(this,null,e),this.modified(!0)}function OC(e,t,n){return eg(e)&&Math.abs(t.reduce(((e,t)=>e+(t<0?-1:t>0?1:0)),0))!==t.length&&n.warn("Log scale domain includes zero: "+Ln(t)),t}function NC(e,t,n){return yn(e)&&(t||n)?rg(e,IC(t||[0,1],n)):e}function IC(e,t){return t?e.slice().reverse():e}function TC(e){$u.call(this,null,e)}On($C,$u,{transform(e,t){var n=t.dataflow,i=this.value,r=function(e){var t,n=e.type,i="";return n===Sm?"sequential-linear":(function(e){const t=e.type;return Jm(t)&&t!==_m&&t!==Em&&(e.scheme||e.range&&e.range.length&&e.range.every(Rn))}(e)&&(i=2===(t=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(null!=e.domainMid):0)?"sequential-":3===t?"diverging-":""),(i+n||xm).toLowerCase())}(e);for(r in i&&r===i.type||(this.value=i=Xm(r)()),e)if(!DC[r]){if("padding"===r&&FC(i.type))continue;yn(i[r])?i[r](e[r]):n.warn("Unsupported scale property: "+r)}return function(e,t,n){var i=e.type,r=t.round||!1,s=t.range;if(null!=t.rangeStep)s=function(e,t,n){e!==Tm&&e!==Im&&Pt("Only band and point scales support rangeStep.");var i=(null!=t.paddingOuter?t.paddingOuter:t.padding)||0,r=e===Im?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0;return[0,t.rangeStep*bm(n,r,i)]}(i,t,n);else if(t.scheme&&(s=function(e,t,n){var i,r=t.schemeExtent;return Jt(t.scheme)?i=sg(t.scheme,t.interpolate,t.interpolateGamma):(i=hg(t.scheme.toLowerCase()))||Pt("Unrecognized scheme name: ".concat(t.scheme)),n=e===Om?n+1:e===Rm?n-1:e===Dm||e===$m?+t.schemeCount||5:n,tg(e)?NC(i,r,t.reverse):yn(i)?ag(NC(i,r),n):e===Nm?i:i.slice(0,n)}(i,t,n),yn(s))){if(e.interpolator)return e.interpolator(s);Pt("Scale type ".concat(i," does not support interpolating color schemes."))}if(s&&tg(i))return e.interpolator(sg(IC(s,t.reverse),t.interpolate,t.interpolateGamma));s&&t.interpolate&&e.interpolate?e.interpolate(ug(t.interpolate,t.interpolateGamma)):yn(e.round)?e.round(r):yn(e.rangeRound)&&e.interpolate(r?Tf:If),s&&e.range(IC(s,t.reverse))}(i,e,function(e,t,n){let i=t.bins;if(i&&!Jt(i)){const t=e.domain(),n=t[0],r=nn(t),s=i.step;let a=null==i.start?n:i.start,o=null==i.stop?r:i.stop;s||Pt("Scale bins parameter missing step property."),a<n&&(a=s*Math.ceil(n/s)),o>r&&(o=s*Math.floor(r/s)),i=Ml(a,o+s/2,s)}return i?e.bins=i:e.bins&&delete e.bins,e.type===Rm&&(i?t.domain||t.domainRaw||(e.domain(i),n=i.length):e.bins=e.domain()),n}(i,e,function(e,t,n){const i=function(e,t,n){return t?(e.domain(OC(e.type,t,n)),t.length):-1}(e,t.domainRaw,n);if(i>-1)return i;var r,s,a=t.domain,o=e.type,u=t.zero||void 0===t.zero&&function(e){const t=e.type;return!e.bins&&(t===xm||t===Cm||t===km)}(e);if(!a)return 0;if(FC(o)&&t.padding&&a[0]!==nn(a)&&(a=function(e,t,n,i,r,s){var a=Math.abs(nn(n)-n[0]),o=a/(a-2*i),u=e===wm?fn(t,null,o):e===km?pn(t,null,o,.5):e===Cm?pn(t,null,o,r||1):e===Am?mn(t,null,o,s||1):hn(t,null,o);return(t=t.slice())[0]=u[0],t[t.length-1]=u[1],t}(o,a,t.range,t.padding,t.exponent,t.constant)),(u||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(r=(a=a.slice()).length-1||1,u&&(a[0]>0&&(a[0]=0),a[r]<0&&(a[r]=0)),null!=t.domainMin&&(a[0]=t.domainMin),null!=t.domainMax&&(a[r]=t.domainMax),null!=t.domainMid)){const e=(s=t.domainMid)>a[r]?r+1:s<a[0]?0:r;e!==r&&n.warn("Scale domainMid exceeds domain min or max.",s),a.splice(e,0,s)}return e.domain(OC(o,a,n)),o===Nm&&e.unknown(t.domainImplicit?$h:void 0),t.nice&&e.nice&&e.nice(!0!==t.nice&&yg(e,t.nice)||null),a.length}(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),On(TC,$u,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(ru(e.sort)),this.modified(n),t}});const RC="zero",MC="center",BC="normalize",zC=["y0","y1"];function LC(e){$u.call(this,null,e)}function PC(e,t,n,i,r){for(var s,a=(t-e.sum)/2,o=e.length,u=0;u<o;++u)(s=e[u])[i]=a,s[r]=a+=Math.abs(n(s))}function jC(e,t,n,i,r){for(var s,a=1/e.sum,o=0,u=e.length,l=0,c=0;l<u;++l)(s=e[l])[i]=o,s[r]=o=a*(c+=Math.abs(n(s)))}function UC(e,t,n,i,r){for(var s,a,o=0,u=0,l=e.length,c=0;c<l;++c)(s=+n(a=e[c]))<0?(a[i]=u,a[r]=u+=s):(a[i]=o,a[r]=o+=s)}LC.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:RC,values:[RC,MC,BC]},{name:"as",type:"string",array:!0,length:2,default:zC}]},On(LC,$u,{transform(e,t){var n,i,r,s,a=e.as||zC,o=a[0],u=a[1],l=ru(e.sort),c=e.field||Gt,d=e.offset===MC?PC:e.offset===BC?jC:UC;for(n=function(e,t,n,i){var r,s,a,o,u,l,c,d,h,f=[],p=e=>e(u);if(null==t)f.push(e.slice());else for(r={},s=0,a=e.length;s<a;++s)u=e[s],(c=r[l=t.map(p)])||(r[l]=c=[],f.push(c)),c.push(u);for(l=0,h=0,o=f.length;l<o;++l){for(s=0,d=0,a=(c=f[l]).length;s<a;++s)d+=Math.abs(i(c[s]));c.sum=d,d>h&&(h=d),n&&c.sort(n)}return f.max=h,f}(t.source,e.groupby,l,c),i=0,r=n.length,s=n.max;i<r;++i)d(n[i],s,c,o,u);return t.reflow(e.modified()).modifies(a)}});const WC=e=>e;function VC(e,t){e&&GC.hasOwnProperty(e.type)&&GC[e.type](e,t)}var qC={Feature:function(e,t){VC(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)VC(n[i].geometry,t)}},GC={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){HC(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)HC(n[i],t,0)},Polygon:function(e,t){XC(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)XC(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)VC(n[i],t)}};function HC(e,t,n){var i,r=-1,s=e.length-n;for(t.lineStart();++r<s;)i=e[r],t.point(i[0],i[1],i[2]);t.lineEnd()}function XC(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)HC(e[n],t,1);t.polygonEnd()}function YC(e,t){e&&qC.hasOwnProperty(e.type)?qC[e.type](e,t):VC(e,t)}class KC{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let i=0;i<this._n&&i<32;i++){const r=t[i],s=e+r,a=Math.abs(e)<Math.abs(r)?e-(s-r):r-(s-e);a&&(t[n++]=a),e=s}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t,n,i,r=this._n,s=0;if(r>0){for(s=e[--r];r>0&&(t=s,n=e[--r],s=t+n,i=n-(s-t),!i););r>0&&(i<0&&e[r-1]<0||i>0&&e[r-1]>0)&&(n=2*i,t=s+n,n==t-s&&(s=t))}return s}}var JC=1e-6,ZC=1e-12,QC=Math.PI,ek=QC/2,tk=QC/4,nk=2*QC,ik=180/QC,rk=QC/180,sk=Math.abs,ak=Math.atan,ok=Math.atan2,uk=Math.cos,lk=Math.ceil,ck=Math.exp,dk=(Math.floor,Math.hypot),hk=Math.log,fk=Math.pow,pk=Math.sin,mk=Math.sign||function(e){return e>0?1:e<0?-1:0},gk=Math.sqrt,yk=Math.tan;function vk(e){return e>1?0:e<-1?QC:Math.acos(e)}function bk(e){return e>1?ek:e<-1?-ek:Math.asin(e)}function xk(){}var wk,Ck,kk,Ak,_k=new KC,Ek=new KC,Sk={point:xk,lineStart:xk,lineEnd:xk,polygonStart:function(){Sk.lineStart=Fk,Sk.lineEnd=Ok},polygonEnd:function(){Sk.lineStart=Sk.lineEnd=Sk.point=xk,_k.add(sk(Ek)),Ek=new KC},result:function(){var e=_k/2;return _k=new KC,e}};function Fk(){Sk.point=Dk}function Dk(e,t){Sk.point=$k,wk=kk=e,Ck=Ak=t}function $k(e,t){Ek.add(Ak*e-kk*t),kk=e,Ak=t}function Ok(){$k(wk,Ck)}const Nk=Sk;var Ik=1/0,Tk=Ik,Rk=-Ik,Mk=Rk;const Bk={point:function(e,t){e<Ik&&(Ik=e),e>Rk&&(Rk=e),t<Tk&&(Tk=t),t>Mk&&(Mk=t)},lineStart:xk,lineEnd:xk,polygonStart:xk,polygonEnd:xk,result:function(){var e=[[Ik,Tk],[Rk,Mk]];return Rk=Mk=-(Tk=Ik=1/0),e}};var zk,Lk,Pk,jk,Uk=0,Wk=0,Vk=0,qk=0,Gk=0,Hk=0,Xk=0,Yk=0,Kk=0,Jk={point:Zk,lineStart:Qk,lineEnd:nA,polygonStart:function(){Jk.lineStart=iA,Jk.lineEnd=rA},polygonEnd:function(){Jk.point=Zk,Jk.lineStart=Qk,Jk.lineEnd=nA},result:function(){var e=Kk?[Xk/Kk,Yk/Kk]:Hk?[qk/Hk,Gk/Hk]:Vk?[Uk/Vk,Wk/Vk]:[NaN,NaN];return Uk=Wk=Vk=qk=Gk=Hk=Xk=Yk=Kk=0,e}};function Zk(e,t){Uk+=e,Wk+=t,++Vk}function Qk(){Jk.point=eA}function eA(e,t){Jk.point=tA,Zk(Pk=e,jk=t)}function tA(e,t){var n=e-Pk,i=t-jk,r=gk(n*n+i*i);qk+=r*(Pk+e)/2,Gk+=r*(jk+t)/2,Hk+=r,Zk(Pk=e,jk=t)}function nA(){Jk.point=Zk}function iA(){Jk.point=sA}function rA(){aA(zk,Lk)}function sA(e,t){Jk.point=aA,Zk(zk=Pk=e,Lk=jk=t)}function aA(e,t){var n=e-Pk,i=t-jk,r=gk(n*n+i*i);qk+=r*(Pk+e)/2,Gk+=r*(jk+t)/2,Hk+=r,Xk+=(r=jk*e-Pk*t)*(Pk+e),Yk+=r*(jk+t),Kk+=3*r,Zk(Pk=e,jk=t)}const oA=Jk;function uA(e){this._context=e}uA.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,nk)}},result:xk};var lA,cA,dA,hA,fA,pA=new KC,mA={point:xk,lineStart:function(){mA.point=gA},lineEnd:function(){lA&&yA(cA,dA),mA.point=xk},polygonStart:function(){lA=!0},polygonEnd:function(){lA=null},result:function(){var e=+pA;return pA=new KC,e}};function gA(e,t){mA.point=yA,cA=hA=e,dA=fA=t}function yA(e,t){hA-=e,fA-=t,pA.add(gk(hA*hA+fA*fA)),hA=e,fA=t}const vA=mA;function bA(){this._string=[]}function xA(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function wA(e,t){var n,i,r=4.5;function s(e){return e&&("function"==typeof r&&i.pointRadius(+r.apply(this,arguments)),YC(e,n(i))),i.result()}return s.area=function(e){return YC(e,n(Nk)),Nk.result()},s.measure=function(e){return YC(e,n(vA)),vA.result()},s.bounds=function(e){return YC(e,n(Bk)),Bk.result()},s.centroid=function(e){return YC(e,n(oA)),oA.result()},s.projection=function(t){return arguments.length?(n=null==t?(e=null,WC):(e=t).stream,s):e},s.context=function(e){return arguments.length?(i=null==e?(t=null,new bA):new uA(t=e),"function"!=typeof r&&i.pointRadius(r),s):t},s.pointRadius=function(e){return arguments.length?(r="function"==typeof e?e:(i.pointRadius(+e),+e),s):r},s.projection(e).context(t)}function CA(){var e,t=[];return{point:function(t,n,i){e.push([t,n,i])},lineStart:function(){t.push(e=[])},lineEnd:xk,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function kA(e,t){return sk(e[0]-t[0])<JC&&sk(e[1]-t[1])<JC}function AA(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function _A(e,t,n,i,r){var s,a,o=[],u=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n,i=e[0],a=e[t];if(kA(i,a)){if(!i[2]&&!a[2]){for(r.lineStart(),s=0;s<t;++s)r.point((i=e[s])[0],i[1]);return void r.lineEnd()}a[0]+=2e-6}o.push(n=new AA(i,e,null,!0)),u.push(n.o=new AA(i,null,n,!1)),o.push(n=new AA(a,e,null,!1)),u.push(n.o=new AA(a,null,n,!0))}})),o.length){for(u.sort(t),EA(o),EA(u),s=0,a=u.length;s<a;++s)u[s].e=n=!n;for(var l,c,d=o[0];;){for(var h=d,f=!0;h.v;)if((h=h.n)===d)return;l=h.z,r.lineStart();do{if(h.v=h.o.v=!0,h.e){if(f)for(s=0,a=l.length;s<a;++s)r.point((c=l[s])[0],c[1]);else i(h.x,h.n.x,1,r);h=h.n}else{if(f)for(l=h.p.z,s=l.length-1;s>=0;--s)r.point((c=l[s])[0],c[1]);else i(h.x,h.p.x,-1,r);h=h.p}l=(h=h.o).z,f=!f}while(!h.v);r.lineEnd()}}}function EA(e){if(t=e.length){for(var t,n,i=0,r=e[0];++i<t;)r.n=n=e[i],n.p=r,r=n;r.n=n=e[0],n.p=r}}function SA(e){return[ok(e[1],e[0]),bk(e[2])]}function FA(e){var t=e[0],n=e[1],i=uk(n);return[i*uk(t),i*pk(t),pk(n)]}function DA(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function $A(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function OA(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function NA(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function IA(e){var t=gk(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function TA(e){return sk(e[0])<=QC?e[0]:mk(e[0])*((sk(e[0])+QC)%nk-QC)}function RA(e){return Array.from(function*(e){for(const t of e)yield*t}(e))}function MA(e,t,n,i){return function(r){var s,a,o,u=t(r),l=CA(),c=t(l),d=!1,h={point:f,lineStart:m,lineEnd:g,polygonStart:function(){h.point=y,h.lineStart=v,h.lineEnd=b,a=[],s=[]},polygonEnd:function(){h.point=f,h.lineStart=m,h.lineEnd=g,a=RA(a);var e=function(e,t){var n=TA(t),i=t[1],r=pk(i),s=[pk(n),-uk(n),0],a=0,o=0,u=new KC;1===r?i=ek+JC:-1===r&&(i=-ek-JC);for(var l=0,c=e.length;l<c;++l)if(h=(d=e[l]).length)for(var d,h,f=d[h-1],p=TA(f),m=f[1]/2+tk,g=pk(m),y=uk(m),v=0;v<h;++v,p=x,g=C,y=k,f=b){var b=d[v],x=TA(b),w=b[1]/2+tk,C=pk(w),k=uk(w),A=x-p,_=A>=0?1:-1,E=_*A,S=E>QC,F=g*C;if(u.add(ok(F*_*pk(E),y*k+F*uk(E))),a+=S?A+_*nk:A,S^p>=n^x>=n){var D=$A(FA(f),FA(b));IA(D);var $=$A(s,D);IA($);var O=(S^A>=0?-1:1)*bk($[2]);(i>O||i===O&&(D[0]||D[1]))&&(o+=S^A>=0?1:-1)}}return(a<-1e-6||a<JC&&u<-1e-12)^1&o}(s,i);a.length?(d||(r.polygonStart(),d=!0),_A(a,zA,e,n,r)):e&&(d||(r.polygonStart(),d=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),d&&(r.polygonEnd(),d=!1),a=s=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function f(t,n){e(t,n)&&r.point(t,n)}function p(e,t){u.point(e,t)}function m(){h.point=p,u.lineStart()}function g(){h.point=f,u.lineEnd()}function y(e,t){o.push([e,t]),c.point(e,t)}function v(){c.lineStart(),o=[]}function b(){y(o[0][0],o[0][1]),c.lineEnd();var e,t,n,i,u=c.clean(),h=l.result(),f=h.length;if(o.pop(),s.push(o),o=null,f)if(1&u){if((t=(n=h[0]).length-1)>0){for(d||(r.polygonStart(),d=!0),r.lineStart(),e=0;e<t;++e)r.point((i=n[e])[0],i[1]);r.lineEnd()}}else f>1&&2&u&&h.push(h.pop().concat(h.shift())),a.push(h.filter(BA))}return h}}function BA(e){return e.length>1}function zA(e,t){return((e=e.x)[0]<0?e[1]-ek-JC:ek-e[1])-((t=t.x)[0]<0?t[1]-ek-JC:ek-t[1])}bA.prototype={_radius:4.5,_circle:xA(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=xA(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};const LA=MA((function(){return!0}),(function(e){var t,n=NaN,i=NaN,r=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(s,a){var o=s>0?QC:-QC,u=sk(s-n);sk(u-QC)<JC?(e.point(n,i=(i+a)/2>0?ek:-ek),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(o,i),e.point(s,i),t=0):r!==o&&u>=QC&&(sk(n-r)<JC&&(n-=r*JC),sk(s-o)<JC&&(s-=o*JC),i=function(e,t,n,i){var r,s,a=pk(e-n);return sk(a)>JC?ak((pk(t)*(s=uk(i))*pk(n)-pk(i)*(r=uk(t))*pk(e))/(r*s*a)):(t+i)/2}(n,i,s,a),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(o,i),t=0),e.point(n=s,i=a),r=o},lineEnd:function(){e.lineEnd(),n=i=NaN},clean:function(){return 2-t}}}),(function(e,t,n,i){var r;if(null==e)r=n*ek,i.point(-QC,r),i.point(0,r),i.point(QC,r),i.point(QC,0),i.point(QC,-r),i.point(0,-r),i.point(-QC,-r),i.point(-QC,0),i.point(-QC,r);else if(sk(e[0]-t[0])>JC){var s=e[0]<t[0]?QC:-QC;r=n*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(t[0],t[1])}),[-QC,-ek]);function PA(e,t){(t=FA(t))[0]-=e,IA(t);var n=vk(-t[1]);return((-t[2]<0?-n:n)+nk-JC)%nk}function jA(e){var t=uk(e),n=6*rk,i=t>0,r=sk(t)>JC;function s(e,n){return uk(e)*uk(n)>t}function a(e,n,i){var r=[1,0,0],s=$A(FA(e),FA(n)),a=DA(s,s),o=s[0],u=a-o*o;if(!u)return!i&&e;var l=t*a/u,c=-t*o/u,d=$A(r,s),h=NA(r,l);OA(h,NA(s,c));var f=d,p=DA(h,f),m=DA(f,f),g=p*p-m*(DA(h,h)-1);if(!(g<0)){var y=gk(g),v=NA(f,(-p-y)/m);if(OA(v,h),v=SA(v),!i)return v;var b,x=e[0],w=n[0],C=e[1],k=n[1];w<x&&(b=x,x=w,w=b);var A=w-x,_=sk(A-QC)<JC;if(!_&&k<C&&(b=C,C=k,k=b),_||A<JC?_?C+k>0^v[1]<(sk(v[0]-x)<JC?C:k):C<=v[1]&&v[1]<=k:A>QC^(x<=v[0]&&v[0]<=w)){var E=NA(f,(-p+y)/m);return OA(E,h),[v,SA(E)]}}}function o(t,n){var r=i?e:QC-e,s=0;return t<-r?s|=1:t>r&&(s|=2),n<-r?s|=4:n>r&&(s|=8),s}return MA(s,(function(e){var t,n,u,l,c;return{lineStart:function(){l=u=!1,c=1},point:function(d,h){var f,p=[d,h],m=s(d,h),g=i?m?0:o(d,h):m?o(d+(d<0?QC:-QC),h):0;if(!t&&(l=u=m)&&e.lineStart(),m!==u&&(!(f=a(t,p))||kA(t,f)||kA(p,f))&&(p[2]=1),m!==u)c=0,m?(e.lineStart(),f=a(p,t),e.point(f[0],f[1])):(f=a(t,p),e.point(f[0],f[1],2),e.lineEnd()),t=f;else if(r&&t&&i^m){var y;g&n||!(y=a(p,t,!0))||(c=0,i?(e.lineStart(),e.point(y[0][0],y[0][1]),e.point(y[1][0],y[1][1]),e.lineEnd()):(e.point(y[1][0],y[1][1]),e.lineEnd(),e.lineStart(),e.point(y[0][0],y[0][1],3)))}!m||t&&kA(t,p)||e.point(p[0],p[1]),t=p,u=m,n=g},lineEnd:function(){u&&e.lineEnd(),t=null},clean:function(){return c|(l&&u)<<1}}}),(function(t,i,r,s){!function(e,t,n,i,r,s){if(n){var a=uk(t),o=pk(t),u=i*n;null==r?(r=t+i*nk,s=t-u/2):(r=PA(a,r),s=PA(a,s),(i>0?r<s:r>s)&&(r+=i*nk));for(var l,c=r;i>0?c>s:c<s;c-=u)l=SA([a,-o*uk(c),-o*pk(c)]),e.point(l[0],l[1])}}(s,e,n,r,t,i)}),i?[0,-e]:[-QC,e-QC])}var UA=1e9,WA=-UA;function VA(e,t,n,i){function r(r,s){return e<=r&&r<=n&&t<=s&&s<=i}function s(r,s,o,l){var c=0,d=0;if(null==r||(c=a(r,o))!==(d=a(s,o))||u(r,s)<0^o>0)do{l.point(0===c||3===c?e:n,c>1?i:t)}while((c=(c+o+4)%4)!==d);else l.point(s[0],s[1])}function a(i,r){return sk(i[0]-e)<JC?r>0?0:3:sk(i[0]-n)<JC?r>0?2:1:sk(i[1]-t)<JC?r>0?1:0:r>0?3:2}function o(e,t){return u(e.x,t.x)}function u(e,t){var n=a(e,1),i=a(t,1);return n!==i?n-i:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(a){var u,l,c,d,h,f,p,m,g,y,v,b=a,x=CA(),w={point:C,lineStart:function(){w.point=k,l&&l.push(c=[]),y=!0,g=!1,p=m=NaN},lineEnd:function(){u&&(k(d,h),f&&g&&x.rejoin(),u.push(x.result())),w.point=C,g&&b.lineEnd()},polygonStart:function(){b=x,u=[],l=[],v=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,r=l.length;n<r;++n)for(var s,a,o=l[n],u=1,c=o.length,d=o[0],h=d[0],f=d[1];u<c;++u)s=h,a=f,h=(d=o[u])[0],f=d[1],a<=i?f>i&&(h-s)*(i-a)>(f-a)*(e-s)&&++t:f<=i&&(h-s)*(i-a)<(f-a)*(e-s)&&--t;return t}(),n=v&&t,r=(u=RA(u)).length;(n||r)&&(a.polygonStart(),n&&(a.lineStart(),s(null,null,1,a),a.lineEnd()),r&&_A(u,o,t,s,a),a.polygonEnd()),b=a,u=l=c=null}};function C(e,t){r(e,t)&&b.point(e,t)}function k(s,a){var o=r(s,a);if(l&&c.push([s,a]),y)d=s,h=a,f=o,y=!1,o&&(b.lineStart(),b.point(s,a));else if(o&&g)b.point(s,a);else{var u=[p=Math.max(WA,Math.min(UA,p)),m=Math.max(WA,Math.min(UA,m))],x=[s=Math.max(WA,Math.min(UA,s)),a=Math.max(WA,Math.min(UA,a))];!function(e,t,n,i,r,s){var a,o=e[0],u=e[1],l=0,c=1,d=t[0]-o,h=t[1]-u;if(a=n-o,d||!(a>0)){if(a/=d,d<0){if(a<l)return;a<c&&(c=a)}else if(d>0){if(a>c)return;a>l&&(l=a)}if(a=r-o,d||!(a<0)){if(a/=d,d<0){if(a>c)return;a>l&&(l=a)}else if(d>0){if(a<l)return;a<c&&(c=a)}if(a=i-u,h||!(a>0)){if(a/=h,h<0){if(a<l)return;a<c&&(c=a)}else if(h>0){if(a>c)return;a>l&&(l=a)}if(a=s-u,h||!(a<0)){if(a/=h,h<0){if(a>c)return;a>l&&(l=a)}else if(h>0){if(a<l)return;a<c&&(c=a)}return l>0&&(e[0]=o+l*d,e[1]=u+l*h),c<1&&(t[0]=o+c*d,t[1]=u+c*h),!0}}}}}(u,x,e,t,n,i)?o&&(b.lineStart(),b.point(s,a),v=!1):(g||(b.lineStart(),b.point(u[0],u[1])),b.point(x[0],x[1]),o||b.lineEnd(),v=!1)}p=s,m=a,g=o}return w}}function qA(e,t){function n(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,i){return(n=t.invert(n,i))&&e.invert(n[0],n[1])}),n}function GA(e,t){return[sk(e)>QC?e+Math.round(-e/nk)*nk:e,t]}function HA(e,t,n){return(e%=nk)?t||n?qA(YA(e),KA(t,n)):YA(e):t||n?KA(t,n):GA}function XA(e){return function(t,n){return[(t+=e)>QC?t-nk:t<-QC?t+nk:t,n]}}function YA(e){var t=XA(e);return t.invert=XA(-e),t}function KA(e,t){var n=uk(e),i=pk(e),r=uk(t),s=pk(t);function a(e,t){var a=uk(t),o=uk(e)*a,u=pk(e)*a,l=pk(t),c=l*n+o*i;return[ok(u*r-c*s,o*n-l*i),bk(c*r+u*s)]}return a.invert=function(e,t){var a=uk(t),o=uk(e)*a,u=pk(e)*a,l=pk(t),c=l*r-u*s;return[ok(u*r+l*s,o*n+c*i),bk(c*n-o*i)]},a}function JA(e){return function(t){var n=new ZA;for(var i in e)n[i]=e[i];return n.stream=t,n}}function ZA(){}function QA(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=i&&e.clipExtent(null),YC(n,e.stream(Bk)),t(Bk.result()),null!=i&&e.clipExtent(i),e}function e_(e,t,n){return QA(e,(function(n){var i=t[1][0]-t[0][0],r=t[1][1]-t[0][1],s=Math.min(i/(n[1][0]-n[0][0]),r/(n[1][1]-n[0][1])),a=+t[0][0]+(i-s*(n[1][0]+n[0][0]))/2,o=+t[0][1]+(r-s*(n[1][1]+n[0][1]))/2;e.scale(150*s).translate([a,o])}),n)}function t_(e,t,n){return e_(e,[[0,0],t],n)}function n_(e,t,n){return QA(e,(function(n){var i=+t,r=i/(n[1][0]-n[0][0]),s=(i-r*(n[1][0]+n[0][0]))/2,a=-r*n[0][1];e.scale(150*r).translate([s,a])}),n)}function i_(e,t,n){return QA(e,(function(n){var i=+t,r=i/(n[1][1]-n[0][1]),s=-r*n[0][0],a=(i-r*(n[1][1]+n[0][1]))/2;e.scale(150*r).translate([s,a])}),n)}GA.invert=GA,ZA.prototype={constructor:ZA,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var r_=uk(30*rk);function s_(e,t){return+t?function(e,t){function n(i,r,s,a,o,u,l,c,d,h,f,p,m,g){var y=l-i,v=c-r,b=y*y+v*v;if(b>4*t&&m--){var x=a+h,w=o+f,C=u+p,k=gk(x*x+w*w+C*C),A=bk(C/=k),_=sk(sk(C)-1)<JC||sk(s-d)<JC?(s+d)/2:ok(w,x),E=e(_,A),S=E[0],F=E[1],D=S-i,$=F-r,O=v*D-y*$;(O*O/b>t||sk((y*D+v*$)/b-.5)>.3||a*h+o*f+u*p<r_)&&(n(i,r,s,a,o,u,S,F,_,x/=k,w/=k,C,m,g),g.point(S,F),n(S,F,_,x,w,C,l,c,d,h,f,p,m,g))}}return function(t){var i,r,s,a,o,u,l,c,d,h,f,p,m={point:g,lineStart:y,lineEnd:b,polygonStart:function(){t.polygonStart(),m.lineStart=x},polygonEnd:function(){t.polygonEnd(),m.lineStart=y}};function g(n,i){n=e(n,i),t.point(n[0],n[1])}function y(){c=NaN,m.point=v,t.lineStart()}function v(i,r){var s=FA([i,r]),a=e(i,r);n(c,d,l,h,f,p,c=a[0],d=a[1],l=i,h=s[0],f=s[1],p=s[2],16,t),t.point(c,d)}function b(){m.point=g,t.lineEnd()}function x(){y(),m.point=w,m.lineEnd=C}function w(e,t){v(i=e,t),r=c,s=d,a=h,o=f,u=p,m.point=v}function C(){n(c,d,l,h,f,p,r,s,i,a,o,u,16,t),m.lineEnd=b,b()}return m}}(e,t):function(e){return JA({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var a_=JA({point:function(e,t){this.stream.point(e*rk,t*rk)}});function o_(e,t,n,i,r,s){if(!s)return function(e,t,n,i,r){function s(s,a){return[t+e*(s*=i),n-e*(a*=r)]}return s.invert=function(s,a){return[(s-t)/e*i,(n-a)/e*r]},s}(e,t,n,i,r);var a=uk(s),o=pk(s),u=a*e,l=o*e,c=a/e,d=o/e,h=(o*n-a*t)/e,f=(o*t+a*n)/e;function p(e,s){return[u*(e*=i)-l*(s*=r)+t,n-l*e-u*s]}return p.invert=function(e,t){return[i*(c*e-d*t+h),r*(f-d*e-c*t)]},p}function u_(e){return l_((function(){return e}))()}function l_(e){var t,n,i,r,s,a,o,u,l,c,d=150,h=480,f=250,p=0,m=0,g=0,y=0,v=0,b=0,x=1,w=1,C=null,k=LA,A=null,_=WC,E=.5;function S(e){return u(e[0]*rk,e[1]*rk)}function F(e){return(e=u.invert(e[0],e[1]))&&[e[0]*ik,e[1]*ik]}function D(){var e=o_(d,0,0,x,w,b).apply(null,t(p,m)),i=o_(d,h-e[0],f-e[1],x,w,b);return n=HA(g,y,v),o=qA(t,i),u=qA(n,o),a=s_(o,E),$()}function $(){return l=c=null,S}return S.stream=function(e){return l&&c===e?l:l=a_(function(e){return JA({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}(n)(k(a(_(c=e)))))},S.preclip=function(e){return arguments.length?(k=e,C=void 0,$()):k},S.postclip=function(e){return arguments.length?(_=e,A=i=r=s=null,$()):_},S.clipAngle=function(e){return arguments.length?(k=+e?jA(C=e*rk):(C=null,LA),$()):C*ik},S.clipExtent=function(e){return arguments.length?(_=null==e?(A=i=r=s=null,WC):VA(A=+e[0][0],i=+e[0][1],r=+e[1][0],s=+e[1][1]),$()):null==A?null:[[A,i],[r,s]]},S.scale=function(e){return arguments.length?(d=+e,D()):d},S.translate=function(e){return arguments.length?(h=+e[0],f=+e[1],D()):[h,f]},S.center=function(e){return arguments.length?(p=e[0]%360*rk,m=e[1]%360*rk,D()):[p*ik,m*ik]},S.rotate=function(e){return arguments.length?(g=e[0]%360*rk,y=e[1]%360*rk,v=e.length>2?e[2]%360*rk:0,D()):[g*ik,y*ik,v*ik]},S.angle=function(e){return arguments.length?(b=e%360*rk,D()):b*ik},S.reflectX=function(e){return arguments.length?(x=e?-1:1,D()):x<0},S.reflectY=function(e){return arguments.length?(w=e?-1:1,D()):w<0},S.precision=function(e){return arguments.length?(a=s_(o,E=e*e),$()):gk(E)},S.fitExtent=function(e,t){return e_(S,e,t)},S.fitSize=function(e,t){return t_(S,e,t)},S.fitWidth=function(e,t){return n_(S,e,t)},S.fitHeight=function(e,t){return i_(S,e,t)},function(){return t=e.apply(this,arguments),S.invert=t.invert&&F,D()}}function c_(e){var t=0,n=QC/3,i=l_(e),r=i(t,n);return r.parallels=function(e){return arguments.length?i(t=e[0]*rk,n=e[1]*rk):[t*ik,n*ik]},r}function d_(e,t){var n=pk(e),i=(n+pk(t))/2;if(sk(i)<JC)return function(e){var t=uk(e);function n(e,n){return[e*t,pk(n)/t]}return n.invert=function(e,n){return[e/t,bk(n*t)]},n}(e);var r=1+n*(2*i-n),s=gk(r)/i;function a(e,t){var n=gk(r-2*i*pk(t))/i;return[n*pk(e*=i),s-n*uk(e)]}return a.invert=function(e,t){var n=s-t,a=ok(e,sk(n))*mk(n);return n*i<0&&(a-=QC*mk(e)*mk(n)),[a/i,bk((r-(e*e+n*n)*i*i)/(2*i))]},a}function h_(){return c_(d_).scale(155.424).center([0,33.6442])}function f_(){return h_().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function p_(e){return function(t,n){var i=uk(t),r=uk(n),s=e(i*r);return s===1/0?[2,0]:[s*r*pk(t),s*pk(n)]}}function m_(e){return function(t,n){var i=gk(t*t+n*n),r=e(i),s=pk(r),a=uk(r);return[ok(t*s,i*a),bk(i&&n*s/i)]}}var g_=p_((function(e){return gk(2/(1+e))}));g_.invert=m_((function(e){return 2*bk(e/2)}));var y_=p_((function(e){return(e=vk(e))&&e/pk(e)}));function v_(e,t){return[e,hk(yk((ek+t)/2))]}function b_(e){var t,n,i,r=u_(e),s=r.center,a=r.scale,o=r.translate,u=r.clipExtent,l=null;function c(){var s=QC*a(),o=r(function(e){function t(t){return(t=e(t[0]*rk,t[1]*rk))[0]*=ik,t[1]*=ik,t}return e=HA(e[0]*rk,e[1]*rk,e.length>2?e[2]*rk:0),t.invert=function(t){return(t=e.invert(t[0]*rk,t[1]*rk))[0]*=ik,t[1]*=ik,t},t}(r.rotate()).invert([0,0]));return u(null==l?[[o[0]-s,o[1]-s],[o[0]+s,o[1]+s]]:e===v_?[[Math.max(o[0]-s,l),t],[Math.min(o[0]+s,n),i]]:[[l,Math.max(o[1]-s,t)],[n,Math.min(o[1]+s,i)]])}return r.scale=function(e){return arguments.length?(a(e),c()):a()},r.translate=function(e){return arguments.length?(o(e),c()):o()},r.center=function(e){return arguments.length?(s(e),c()):s()},r.clipExtent=function(e){return arguments.length?(null==e?l=t=n=i=null:(l=+e[0][0],t=+e[0][1],n=+e[1][0],i=+e[1][1]),c()):null==l?null:[[l,t],[n,i]]},c()}function x_(e){return yk((ek+e)/2)}function w_(e,t){var n=uk(e),i=e===t?pk(e):hk(n/uk(t))/hk(x_(t)/x_(e)),r=n*fk(x_(e),i)/i;if(!i)return v_;function s(e,t){r>0?t<-ek+JC&&(t=-ek+JC):t>ek-JC&&(t=ek-JC);var n=r/fk(x_(t),i);return[n*pk(i*e),r-n*uk(i*e)]}return s.invert=function(e,t){var n=r-t,s=mk(i)*gk(e*e+n*n),a=ok(e,sk(n))*mk(n);return n*i<0&&(a-=QC*mk(e)*mk(n)),[a/i,2*ak(fk(r/s,1/i))-ek]},s}function C_(e,t){return[e,t]}function k_(e,t){var n=uk(e),i=e===t?pk(e):(n-uk(t))/(t-e),r=n/i+e;if(sk(i)<JC)return C_;function s(e,t){var n=r-t,s=i*e;return[n*pk(s),r-n*uk(s)]}return s.invert=function(e,t){var n=r-t,s=ok(e,sk(n))*mk(n);return n*i<0&&(s-=QC*mk(e)*mk(n)),[s/i,r-mk(i)*gk(e*e+n*n)]},s}y_.invert=m_((function(e){return e})),v_.invert=function(e,t){return[e,2*ak(ck(t))-ek]},C_.invert=C_;var A_=1.340264,__=-.081106,E_=893e-6,S_=.003796,F_=gk(3)/2;function D_(e,t){var n=bk(F_*pk(t)),i=n*n,r=i*i*i;return[e*uk(n)/(F_*(A_+3*__*i+r*(7*E_+9*S_*i))),n*(A_+__*i+r*(E_+S_*i))]}function $_(e,t){var n=uk(t),i=uk(e)*n;return[n*pk(e)/i,pk(t)/i]}function O_(e,t){var n=t*t,i=n*n;return[e*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791)),t*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))]}function N_(e,t){return[uk(t)*pk(e),pk(t)]}function I_(e,t){var n=uk(t),i=1+uk(e)*n;return[n*pk(e)/i,pk(t)/i]}function T_(e,t){return[hk(yk((ek+t)/2)),-e]}D_.invert=function(e,t){for(var n,i=t,r=i*i,s=r*r*r,a=0;a<12&&(s=(r=(i-=n=(i*(A_+__*r+s*(E_+S_*r))-t)/(A_+3*__*r+s*(7*E_+9*S_*r)))*i)*r*r,!(sk(n)<ZC));++a);return[F_*e*(A_+3*__*r+s*(7*E_+9*S_*r))/uk(i),bk(pk(i)/F_)]},$_.invert=m_(ak),O_.invert=function(e,t){var n,i=t,r=25;do{var s=i*i,a=s*s;i-=n=(i*(1.007226+s*(.015085+a*(.028874*s-.044475-.005916*a)))-t)/(1.007226+s*(.045255+a*(.259866*s-.311325-.005916*11*a)))}while(sk(n)>JC&&--r>0);return[e/(.8707+(s=i*i)*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979)),i]},N_.invert=m_(bk),I_.invert=m_((function(e){return 2*ak(e)})),T_.invert=function(e,t){return[-t,2*ak(ck(e))-ek]};var R_=Math.abs,M_=(Math.atan,Math.atan2,Math.ceil,Math.cos),B_=(Math.exp,Math.floor,Math.log,Math.max,Math.min,Math.pow,Math.round,Math.sign,Math.sin),z_=(Math.tan,Math.PI),L_=z_/2,P_=(Math.SQRT1_2,U_(2));function j_(e){return e>1?L_:e<-1?-L_:Math.asin(e)}function U_(e){return e>0?Math.sqrt(e):0}function W_(e,t){var n,i=e*B_(t),r=30;do{t-=n=(t+B_(t)-i)/(1+M_(t))}while(R_(n)>1e-6&&--r>0);return t/2}U_(z_);var V_=function(e,t,n){function i(i,r){return[e*i*M_(r=W_(n,r)),t*B_(r)]}return i.invert=function(i,r){return r=j_(r/t),[i/(e*M_(r)),j_((2*r+B_(2*r))/n)]},i}(P_/L_,P_,z_);const q_=wA(),G_=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function H_(e,t){return function n(){const i=t();return i.type=e,i.path=wA().projection(i),i.copy=i.copy||function(){const e=n();return G_.forEach((t=>{i[t]&&e[t](i[t]())})),e.path.pointRadius(i.path.pointRadius()),e},i}}function X_(e,t){if(!e||"string"!=typeof e)throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(K_[e]=H_(e,t),this):K_[e]||null}function Y_(e){return e&&e.path||q_}const K_={albers:f_,albersusa:function(){var e,t,n,i,r,s,a=f_(),o=h_().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=h_().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(e,t){s=[e,t]}};function c(e){var t=e[0],a=e[1];return s=null,n.point(t,a),s||(i.point(t,a),s)||(r.point(t,a),s)}function d(){return e=t=null,c}return c.invert=function(e){var t=a.scale(),n=a.translate(),i=(e[0]-n[0])/t,r=(e[1]-n[1])/t;return(r>=.12&&r<.234&&i>=-.425&&i<-.214?o:r>=.166&&r<.234&&i>=-.214&&i<-.115?u:a).invert(e)},c.stream=function(n){return e&&t===n?e:(i=[a.stream(t=n),o.stream(n),u.stream(n)],r=i.length,e={point:function(e,t){for(var n=-1;++n<r;)i[n].point(e,t)},sphere:function(){for(var e=-1;++e<r;)i[e].sphere()},lineStart:function(){for(var e=-1;++e<r;)i[e].lineStart()},lineEnd:function(){for(var e=-1;++e<r;)i[e].lineEnd()},polygonStart:function(){for(var e=-1;++e<r;)i[e].polygonStart()},polygonEnd:function(){for(var e=-1;++e<r;)i[e].polygonEnd()}});var i,r},c.precision=function(e){return arguments.length?(a.precision(e),o.precision(e),u.precision(e),d()):a.precision()},c.scale=function(e){return arguments.length?(a.scale(e),o.scale(.35*e),u.scale(e),c.translate(a.translate())):a.scale()},c.translate=function(e){if(!arguments.length)return a.translate();var t=a.scale(),s=+e[0],c=+e[1];return n=a.translate(e).clipExtent([[s-.455*t,c-.238*t],[s+.455*t,c+.238*t]]).stream(l),i=o.translate([s-.307*t,c+.201*t]).clipExtent([[s-.425*t+JC,c+.12*t+JC],[s-.214*t-JC,c+.234*t-JC]]).stream(l),r=u.translate([s-.205*t,c+.212*t]).clipExtent([[s-.214*t+JC,c+.166*t+JC],[s-.115*t-JC,c+.234*t-JC]]).stream(l),d()},c.fitExtent=function(e,t){return e_(c,e,t)},c.fitSize=function(e,t){return t_(c,e,t)},c.fitWidth=function(e,t){return n_(c,e,t)},c.fitHeight=function(e,t){return i_(c,e,t)},c.scale(1070)},azimuthalequalarea:function(){return u_(g_).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return u_(y_).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return c_(w_).scale(109.5).parallels([30,30])},conicequalarea:h_,conicequidistant:function(){return c_(k_).scale(131.154).center([0,13.9389])},equalEarth:function(){return u_(D_).scale(177.158)},equirectangular:function(){return u_(C_).scale(152.63)},gnomonic:function(){return u_($_).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,i,r,s,a,o=1,u=0,l=0,c=1,d=1,h=0,f=null,p=1,m=1,g=JA({point:function(e,t){var n=b([e,t]);this.stream.point(n[0],n[1])}}),y=WC;function v(){return p=o*c,m=o*d,s=a=null,b}function b(n){var i=n[0]*p,r=n[1]*m;if(h){var s=r*e-i*t;i=i*e+r*t,r=s}return[i+u,r+l]}return b.invert=function(n){var i=n[0]-u,r=n[1]-l;if(h){var s=r*e+i*t;i=i*e-r*t,r=s}return[i/p,r/m]},b.stream=function(e){return s&&a===e?s:s=g(y(a=e))},b.postclip=function(e){return arguments.length?(y=e,f=n=i=r=null,v()):y},b.clipExtent=function(e){return arguments.length?(y=null==e?(f=n=i=r=null,WC):VA(f=+e[0][0],n=+e[0][1],i=+e[1][0],r=+e[1][1]),v()):null==f?null:[[f,n],[i,r]]},b.scale=function(e){return arguments.length?(o=+e,v()):o},b.translate=function(e){return arguments.length?(u=+e[0],l=+e[1],v()):[u,l]},b.angle=function(n){return arguments.length?(t=pk(h=n%360*rk),e=uk(h),v()):h*ik},b.reflectX=function(e){return arguments.length?(c=e?-1:1,v()):c<0},b.reflectY=function(e){return arguments.length?(d=e?-1:1,v()):d<0},b.fitExtent=function(e,t){return e_(b,e,t)},b.fitSize=function(e,t){return t_(b,e,t)},b.fitWidth=function(e,t){return n_(b,e,t)},b.fitHeight=function(e,t){return i_(b,e,t)},b},mercator:function(){return b_(v_).scale(961/nk)},mollweide:function(){return u_(V_).scale(169.529)},naturalEarth1:function(){return u_(O_).scale(175.295)},orthographic:function(){return u_(N_).scale(249.5).clipAngle(90.000001)},stereographic:function(){return u_(I_).scale(250).clipAngle(142)},transversemercator:function(){var e=b_(T_),t=e.center,n=e.rotate;return e.center=function(e){return arguments.length?t([-e[1],e[0]]):[(e=t())[1],-e[0]]},e.rotate=function(e){return arguments.length?n([e[0],e[1],e.length>2?e[2]+90:90]):[(e=n())[0],e[1],e[2]-90]},n([0,0,90]).scale(159.155)}};for(const e in K_)X_(e,K_[e]);function J_(e,t,n){var i=Ml(e,t-JC,n).concat(t);return function(e){return i.map((function(t){return[e,t]}))}}function Z_(e,t,n){var i=Ml(e,t-JC,n).concat(t);return function(e){return i.map((function(t){return[t,e]}))}}function Q_(){}const eE=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function tE(){var e=1,t=1,n=a;function i(e,t){return t.map((t=>r(e,t)))}function r(i,r){var a=[],o=[];return function(n,i,r){var a,o,u,l,c,d,h=new Array,f=new Array;for(a=o=-1,l=n[0]>=i,eE[l<<1].forEach(p);++a<e-1;)u=l,l=n[a+1]>=i,eE[u|l<<1].forEach(p);for(eE[l<<0].forEach(p);++o<t-1;){for(a=-1,l=n[o*e+e]>=i,c=n[o*e]>=i,eE[l<<1|c<<2].forEach(p);++a<e-1;)u=l,l=n[o*e+e+a+1]>=i,d=c,c=n[o*e+a+1]>=i,eE[u|l<<1|c<<2|d<<3].forEach(p);eE[l|c<<3].forEach(p)}for(a=-1,c=n[o*e]>=i,eE[c<<2].forEach(p);++a<e-1;)d=c,c=n[o*e+a+1]>=i,eE[c<<2|d<<3].forEach(p);function p(e){var t,n,i=[e[0][0]+a,e[0][1]+o],u=[e[1][0]+a,e[1][1]+o],l=s(i),c=s(u);(t=f[l])?(n=h[c])?(delete f[t.end],delete h[n.start],t===n?(t.ring.push(u),r(t.ring)):h[t.start]=f[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete f[t.end],t.ring.push(u),f[t.end=c]=t):(t=h[c])?(n=f[l])?(delete h[t.start],delete f[n.end],t===n?(t.ring.push(u),r(t.ring)):h[n.start]=f[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete h[t.start],t.ring.unshift(i),h[t.start=l]=t):h[l]=f[c]={start:l,end:c,ring:[i,u]}}eE[c<<3].forEach(p)}(i,r,(e=>{n(e,i,r),function(e){for(var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return i}(e)>0?a.push([e]):o.push(e)})),o.forEach((e=>{for(var t,n=0,i=a.length;n<i;++n)if(-1!==nE((t=a[n])[0],e))return void t.push(e)})),{type:"MultiPolygon",value:r,coordinates:a}}function s(t){return 2*t[0]+t[1]*(e+1)*4}function a(n,i,r){n.forEach((n=>{var s,a=n[0],o=n[1],u=0|a,l=0|o,c=i[l*e+u];a>0&&a<e&&u===a&&(s=i[l*e+u-1],n[0]=a+(r-s)/(c-s)-.5),o>0&&o<t&&l===o&&(s=i[(l-1)*e+u],n[1]=o+(r-s)/(c-s)-.5)}))}return i.contour=r,i.size=function(n){if(!arguments.length)return[e,t];var r=Math.floor(n[0]),s=Math.floor(n[1]);return r>=0&&s>=0||Pt("invalid size"),e=r,t=s,i},i.smooth=function(e){return arguments.length?(n=e?a:Q_,i):n===a},i}function nE(e,t){for(var n,i=-1,r=t.length;++i<r;)if(n=iE(e,t[i]))return n;return 0}function iE(e,t){for(var n=t[0],i=t[1],r=-1,s=0,a=e.length,o=a-1;s<a;o=s++){var u=e[s],l=u[0],c=u[1],d=e[o],h=d[0],f=d[1];if(rE(u,d,t))return 0;c>i!=f>i&&n<(h-l)*(i-c)/(f-c)+l&&(r=-r)}return r}function rE(e,t,n){var i,r,s,a;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&(r=e[i=+(e[0]===t[0])],s=n[i],a=t[i],r<=s&&s<=a||a<=s&&s<=r)}function sE(e,t,n){return function(i){var r=En(i),s=n?Math.min(r[0],0):r[0],a=r[1],o=a-s,u=t?di(s,a,e):o/(e+1);return Ml(s+u,a,u)}}function aE(e){$u.call(this,null,e)}function oE(e,t,n,i,r){const s=e.x1||0,a=e.y1||0,o=t*n<0;function u(e){e.forEach(l)}function l(e){o&&e.reverse(),e.forEach(c)}function c(e){e[0]=(e[0]-s)*t+i,e[1]=(e[1]-a)*n+r}return function(e){return e.coordinates.forEach(u),e}}function uE(e,t,n){const i=e>=0?e:qu(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function lE(e){return yn(e)?e:kn(+e)}function cE(){var e=e=>e[0],t=e=>e[1],n=Gt,i=[-1,-1],r=960,s=500,a=2;function o(o,u){const l=uE(i[0],o,e)>>a,c=uE(i[1],o,t)>>a,d=l?l+2:0,h=c?c+2:0,f=2*d+(r>>a),p=2*h+(s>>a),m=new Float32Array(f*p),g=new Float32Array(f*p);let y=m;o.forEach((i=>{const r=d+(+e(i)>>a),s=h+(+t(i)>>a);r>=0&&r<f&&s>=0&&s<p&&(m[r+s*f]+=+n(i))})),l>0&&c>0?(dE(f,p,m,g,l),hE(f,p,g,m,c),dE(f,p,m,g,l),hE(f,p,g,m,c),dE(f,p,m,g,l),hE(f,p,g,m,c)):l>0?(dE(f,p,m,g,l),dE(f,p,g,m,l),dE(f,p,m,g,l),y=g):c>0&&(hE(f,p,m,g,c),hE(f,p,g,m,c),hE(f,p,m,g,c),y=g);const v=u?Math.pow(2,-2*a):1/hC(y);for(let e=0,t=f*p;e<t;++e)y[e]*=v;return{values:y,scale:1<<a,width:f,height:p,x1:d,y1:h,x2:d+(r>>a),y2:h+(s>>a)}}return o.x=function(t){return arguments.length?(e=lE(t),o):e},o.y=function(e){return arguments.length?(t=lE(e),o):t},o.weight=function(e){return arguments.length?(n=lE(e),o):n},o.size=function(e){if(!arguments.length)return[r,s];var t=+e[0],n=+e[1];return t>=0&&n>=0||Pt("invalid size"),r=t,s=n,o},o.cellSize=function(e){return arguments.length?((e=+e)>=1||Pt("invalid cell size"),a=Math.floor(Math.log(e)/Math.LN2),o):1<<a},o.bandwidth=function(e){return arguments.length?(1===(e=gn(e)).length&&(e=[+e[0],+e[0]]),2!==e.length&&Pt("invalid bandwidth"),i=e,o):i},o}function dE(e,t,n,i,r){const s=1+(r<<1);for(let a=0;a<t;++a)for(let t=0,o=0;t<e+r;++t)t<e&&(o+=n[t+a*e]),t>=r&&(t>=s&&(o-=n[t-s+a*e]),i[t-r+a*e]=o/Math.min(t+1,e-1+s-t,s))}function hE(e,t,n,i,r){const s=1+(r<<1);for(let a=0;a<e;++a)for(let o=0,u=0;o<t+r;++o)o<t&&(u+=n[a+o*e]),o>=r&&(o>=s&&(u-=n[a+(o-s)*e]),i[a+(o-r)*e]=u/Math.min(o+1,t-1+s-o,s))}function fE(e){$u.call(this,null,e)}aE.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},On(aE,$u,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=e.field||Vt,s=tE().smooth(!1!==e.smooth),a=e.thresholds||function(e,t,n){const i=sE(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?i:i(e.map((e=>Tu(t(e).values))))}(i,r,e),o=null===e.as?null:e.as||"contour",u=[];return i.forEach((t=>{const n=r(t),i=s.size([n.width,n.height])(n.values,Jt(a)?a:a(n.values));!function(e,t,n,i){let r=i.scale||t.scale,s=i.translate||t.translate;if(yn(r)&&(r=r(n,i)),yn(s)&&(s=s(n,i)),(1===r||null==r)&&!s)return;const a=(Tn(r)?r:r[0])||1,o=(Tn(r)?r:r[1])||1,u=s&&s[0]||0,l=s&&s[1]||0;e.forEach(oE(t,a,o,u,l))}(i,n,t,e),i.forEach((e=>{u.push(nu(t,eu(null!=o?{[o]:e}:e)))}))})),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}}),fE.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const pE=["x","y","weight","size","cellSize","bandwidth"];function mE(e,t){return pE.forEach((n=>null!=t[n]?e[n](t[n]):0)),e}function gE(e){$u.call(this,null,e)}On(fE,$u,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=function(e,t){var n,i,r,s,a,o,u=[],l=e=>e(s);if(null==t)u.push(e);else for(n={},i=0,r=e.length;i<r;++i)s=e[i],(o=n[a=t.map(l)])||(n[a]=o=[],o.dims=a,u.push(o)),o.push(s);return u}(t.materialize(t.SOURCE).source,e.groupby),s=(e.groupby||[]).map(Rt),a=mE(cE(),e),o=e.as||"grid";return n=r.map((t=>eu(function(e,t){for(let n=0;n<s.length;++n)e[s[n]]=t[n];return e}({[o]:a(t,e.counts)},t.dims)))),this.value&&(i.rem=this.value),this.value=i.source=i.add=n,i}}),gE.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},On(gE,$u,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,i,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),s=tE().smooth(!1!==e.smooth),a=e.values,o=e.thresholds||sE(e.count||10,e.nice,!!a),u=e.size;return a||(a=t.materialize(t.SOURCE).source,i=oE(n=mE(cE(),e)(a,!0),n.scale||1,n.scale||1,0,0),u=[n.width,n.height],a=n.values),o=Jt(o)?o:o(a),a=s.size(u)(a,o),i&&a.forEach(i),this.value&&(r.rem=this.value),this.value=r.source=r.add=(a||[]).map(eu),r}});const yE="Feature",vE="FeatureCollection";function bE(e){$u.call(this,null,e)}function xE(e){$u.call(this,null,e)}function wE(e){$u.call(this,null,e)}function CE(e){$u.call(this,null,e)}function kE(e){$u.call(this,[],e),this.generator=function(){var e,t,n,i,r,s,a,o,u,l,c,d,h=10,f=h,p=90,m=360,g=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return Ml(lk(i/p)*p,n,p).map(c).concat(Ml(lk(o/m)*m,a,m).map(d)).concat(Ml(lk(t/h)*h,e,h).filter((function(e){return sk(e%p)>JC})).map(u)).concat(Ml(lk(s/f)*f,r,f).filter((function(e){return sk(e%m)>JC})).map(l))}return y.lines=function(){return v().map((function(e){return{type:"LineString",coordinates:e}}))},y.outline=function(){return{type:"Polygon",coordinates:[c(i).concat(d(a).slice(1),c(n).reverse().slice(1),d(o).reverse().slice(1))]}},y.extent=function(e){return arguments.length?y.extentMajor(e).extentMinor(e):y.extentMinor()},y.extentMajor=function(e){return arguments.length?(i=+e[0][0],n=+e[1][0],o=+e[0][1],a=+e[1][1],i>n&&(e=i,i=n,n=e),o>a&&(e=o,o=a,a=e),y.precision(g)):[[i,o],[n,a]]},y.extentMinor=function(n){return arguments.length?(t=+n[0][0],e=+n[1][0],s=+n[0][1],r=+n[1][1],t>e&&(n=t,t=e,e=n),s>r&&(n=s,s=r,r=n),y.precision(g)):[[t,s],[e,r]]},y.step=function(e){return arguments.length?y.stepMajor(e).stepMinor(e):y.stepMinor()},y.stepMajor=function(e){return arguments.length?(p=+e[0],m=+e[1],y):[p,m]},y.stepMinor=function(e){return arguments.length?(h=+e[0],f=+e[1],y):[h,f]},y.precision=function(h){return arguments.length?(g=+h,u=J_(s,r,90),l=Z_(t,e,g),c=J_(o,a,90),d=Z_(i,n,g),y):g},y.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function AE(e){$u.call(this,null,e)}function _E(e){if(!yn(e))return!1;const t=Vn(Mt(e));return t.$x||t.$y||t.$value||t.$max}function EE(e){$u.call(this,null,e),this.modified(!0)}function SE(e,t,n){yn(e[t])&&e[t](n)}function FE(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,s,a,o,u,l,c,d,h,f=e._root,p={data:i},m=e._x0,g=e._y0,y=e._x1,v=e._y1;if(!f)return e._root=p,e;for(;f.length;)if((l=t>=(s=(m+y)/2))?m=s:y=s,(c=n>=(a=(g+v)/2))?g=a:v=a,r=f,!(f=f[d=c<<1|l]))return r[d]=p,e;if(o=+e._x.call(null,f.data),u=+e._y.call(null,f.data),t===o&&n===u)return p.next=f,r?r[d]=p:e._root=p,e;do{r=r?r[d]=new Array(4):e._root=new Array(4),(l=t>=(s=(m+y)/2))?m=s:y=s,(c=n>=(a=(g+v)/2))?g=a:v=a}while((d=c<<1|l)==(h=(u>=a)<<1|o>=s));return r[h]=f,r[d]=p,e}function DE(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function $E(e){return e[0]}function OE(e){return e[1]}function NE(e,t,n){var i=new IE(null==t?$E:t,null==n?OE:n,NaN,NaN,NaN,NaN);return null==e?i:i.addAll(e)}function IE(e,t,n,i,r,s){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function TE(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}bE.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},On(bE,$u,{transform(e,t){var n,i=this._features,r=this._points,s=e.fields,a=s&&s[0],o=s&&s[1],u=e.geojson||!s&&Vt,l=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(Mt(u))||a&&t.modified(Mt(a))||o&&t.modified(Mt(o)),this.value&&!n||(l=t.SOURCE,this._features=i=[],this._points=r=[]),u&&t.visit(l,(e=>i.push(u(e)))),a&&o&&(t.visit(l,(e=>{var t=a(e),n=o(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&r.push([t,n])})),i=i.concat({type:yE,geometry:{type:"MultiPoint",coordinates:r}})),this.value={type:vE,features:i}}}),xE.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},On(xE,$u,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.field||Vt,s=e.as||"path",a=n.SOURCE;!i||e.modified()?(this.value=i=Y_(e.projection),n.materialize().reflow()):a=r===Vt||t.modified(r.fields)?n.ADD_MOD:n.ADD;const o=function(e,t){const n=e.pointRadius();return e.context(null),null!=t&&e.pointRadius(t),n}(i,e.pointRadius);return n.visit(a,(e=>e[s]=i(r(e)))),i.pointRadius(o),n.modifies(s)}}),wE.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},On(wE,$u,{transform(e,t){var n,i=e.projection,r=e.fields[0],s=e.fields[1],a=e.as||["x","y"],o=a[0],u=a[1];function l(e){const t=i([r(e),s(e)]);t?(e[o]=t[0],e[u]=t[1]):(e[o]=void 0,e[u]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,l):(n=t.modified(r.fields)||t.modified(s.fields),t.visit(n?t.ADD_MOD:t.ADD,l)),t.modifies(a)}}),CE.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},On(CE,$u,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.as||"shape",s=n.ADD;return i&&!e.modified()||(this.value=i=function(e,t,n){const i=null==n?n=>e(t(n)):i=>{var r=e.pointRadius(),s=e.pointRadius(n)(t(i));return e.pointRadius(r),s};return i.context=t=>(e.context(t),i),i}(Y_(e.projection),e.field||Ut("datum"),e.pointRadius),n.materialize().reflow(),s=n.SOURCE),n.visit(s,(e=>e[r]=i)),n.modifies(r)}}),kE.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},On(kE,$u,{transform(e,t){var n,i=this.value,r=this.generator;if(!i.length||e.modified())for(const t in e)yn(r[t])&&r[t](e[t]);return n=r(),i.length?t.mod.push(iu(i[0],n)):t.add.push(eu(n)),i[0]=n,t}}),AE.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},On(AE,$u,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,i="shared"===e.resolve,r=e.field||Vt,s=function(e,t){let n;return yn(e)?(n=n=>e(n,t),n.dep=_E(e)):e?n=kn(e):(n=e=>e.$value/e.$max||0,n.dep=!0),n}(e.opacity,e),a=function(e,t){let n;return yn(e)?(n=n=>tf(e(n,t)),n.dep=_E(e)):n=kn(tf(e||"#888")),n}(e.color,e),o=e.as||"image",u={$x:0,$y:0,$value:0,$max:i?Tu(n.map((e=>Tu(r(e).values)))):0};return n.forEach((e=>{const t=r(e),n=_n({},e,u);i||(n.$max=Tu(t.values||[])),e[o]=function(e,t,n,i){const r=e.width,s=e.height,a=e.x1||0,o=e.y1||0,u=e.x2||r,l=e.y2||s,c=e.values,d=c?e=>c[e]:qt,h=Ch(u-a,l-o),f=h.getContext("2d"),p=f.getImageData(0,0,u-a,l-o),m=p.data;for(let e=o,s=0;e<l;++e){t.$y=e-o;for(let o=a,l=e*r;o<u;++o,s+=4){t.$x=o-a,t.$value=d(o+l);const e=n(t);m[s+0]=e.r,m[s+1]=e.g,m[s+2]=e.b,m[s+3]=~~(255*i(t))}}return f.putImageData(p,0,0),h}(t,n,a.dep?a:kn(a(n)),s.dep?s:kn(s(n)))})),t.reflow(!0).modifies(o)}}),On(EE,$u,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(e){const t=X_((e||"mercator").toLowerCase());return t||Pt("Unrecognized projection type: "+e),t()}(e.type),G_.forEach((t=>{null!=e[t]&&SE(n,t,e[t])}))):G_.forEach((t=>{e.modified(t)&&SE(n,t,e[t])})),null!=e.pointRadius&&n.path.pointRadius(e.pointRadius),e.fit&&function(e,t){const n=function(e){return 1===(e=gn(e)).length?e[0]:{type:vE,features:e.reduce(((e,t)=>e.concat(function(e){return e.type===vE?e.features:gn(e).filter((e=>null!=e)).map((e=>e.type===yE?e:{type:yE,geometry:e}))}(t))),[])}}(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});var RE=NE.prototype=IE.prototype;function ME(e){return function(){return e}}function BE(e){return 1e-6*(e()-.5)}function zE(e){return e.x+e.vx}function LE(e){return e.y+e.vy}RE.copy=function(){var e,t,n=new IE(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return n;if(!i.length)return n._root=TE(i),n;for(e=[{source:i,target:n._root=new Array(4)}];i=e.pop();)for(var r=0;r<4;++r)(t=i.source[r])&&(t.length?e.push({source:t,target:i.target[r]=new Array(4)}):i.target[r]=TE(t));return n},RE.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return FE(this.cover(t,n),t,n,e)},RE.addAll=function(e){var t,n,i,r,s=e.length,a=new Array(s),o=new Array(s),u=1/0,l=1/0,c=-1/0,d=-1/0;for(n=0;n<s;++n)isNaN(i=+this._x.call(null,t=e[n]))||isNaN(r=+this._y.call(null,t))||(a[n]=i,o[n]=r,i<u&&(u=i),i>c&&(c=i),r<l&&(l=r),r>d&&(d=r));if(u>c||l>d)return this;for(this.cover(u,l).cover(c,d),n=0;n<s;++n)FE(this,a[n],o[n],e[n]);return this},RE.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,s=(i=Math.floor(t))+1;else{for(var a,o,u=r-n||1,l=this._root;n>e||e>=r||i>t||t>=s;)switch(o=(t<i)<<1|e<n,(a=new Array(4))[o]=l,l=a,u*=2,o){case 0:r=n+u,s=i+u;break;case 1:n=r-u,s=i+u;break;case 2:r=n+u,i=s-u;break;case 3:n=r-u,i=s-u}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this},RE.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},RE.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},RE.find=function(e,t,n){var i,r,s,a,o,u,l,c=this._x0,d=this._y0,h=this._x1,f=this._y1,p=[],m=this._root;for(m&&p.push(new DE(m,c,d,h,f)),null==n?n=1/0:(c=e-n,d=t-n,h=e+n,f=t+n,n*=n);u=p.pop();)if(!(!(m=u.node)||(r=u.x0)>h||(s=u.y0)>f||(a=u.x1)<c||(o=u.y1)<d))if(m.length){var g=(r+a)/2,y=(s+o)/2;p.push(new DE(m[3],g,y,a,o),new DE(m[2],r,y,g,o),new DE(m[1],g,s,a,y),new DE(m[0],r,s,g,y)),(l=(t>=y)<<1|e>=g)&&(u=p[p.length-1],p[p.length-1]=p[p.length-1-l],p[p.length-1-l]=u)}else{var v=e-+this._x.call(null,m.data),b=t-+this._y.call(null,m.data),x=v*v+b*b;if(x<n){var w=Math.sqrt(n=x);c=e-w,d=t-w,h=e+w,f=t+w,i=m.data}}return i},RE.remove=function(e){if(isNaN(s=+this._x.call(null,e))||isNaN(a=+this._y.call(null,e)))return this;var t,n,i,r,s,a,o,u,l,c,d,h,f=this._root,p=this._x0,m=this._y0,g=this._x1,y=this._y1;if(!f)return this;if(f.length)for(;;){if((l=s>=(o=(p+g)/2))?p=o:g=o,(c=a>=(u=(m+y)/2))?m=u:y=u,t=f,!(f=f[d=c<<1|l]))return this;if(!f.length)break;(t[d+1&3]||t[d+2&3]||t[d+3&3])&&(n=t,h=d)}for(;f.data!==e;)if(i=f,!(f=f.next))return this;return(r=f.next)&&delete f.next,i?(r?i.next=r:delete i.next,this):t?(r?t[d]=r:delete t[d],(f=t[0]||t[1]||t[2]||t[3])&&f===(t[3]||t[2]||t[1]||t[0])&&!f.length&&(n?n[h]=f:this._root=f),this):(this._root=r,this)},RE.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},RE.root=function(){return this._root},RE.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},RE.visit=function(e){var t,n,i,r,s,a,o=[],u=this._root;for(u&&o.push(new DE(u,this._x0,this._y0,this._x1,this._y1));t=o.pop();)if(!e(u=t.node,i=t.x0,r=t.y0,s=t.x1,a=t.y1)&&u.length){var l=(i+s)/2,c=(r+a)/2;(n=u[3])&&o.push(new DE(n,l,c,s,a)),(n=u[2])&&o.push(new DE(n,i,c,l,a)),(n=u[1])&&o.push(new DE(n,l,r,s,c)),(n=u[0])&&o.push(new DE(n,i,r,l,c))}return this},RE.visitAfter=function(e){var t,n=[],i=[];for(this._root&&n.push(new DE(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var r=t.node;if(r.length){var s,a=t.x0,o=t.y0,u=t.x1,l=t.y1,c=(a+u)/2,d=(o+l)/2;(s=r[0])&&n.push(new DE(s,a,o,c,d)),(s=r[1])&&n.push(new DE(s,c,o,u,d)),(s=r[2])&&n.push(new DE(s,a,d,c,l)),(s=r[3])&&n.push(new DE(s,c,d,u,l))}i.push(t)}for(;t=i.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},RE.x=function(e){return arguments.length?(this._x=e,this):this._x},RE.y=function(e){return arguments.length?(this._y=e,this):this._y};var PE={value:()=>{}};function jE(){for(var e,t=0,n=arguments.length,i={};t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new UE(i)}function UE(e){this._=e}function WE(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",i=e.indexOf(".");if(i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function VE(e,t){for(var n,i=0,r=e.length;i<r;++i)if((n=e[i]).name===t)return n.value}function qE(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=PE,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}UE.prototype=jE.prototype={constructor:UE,on:function(e,t){var n,i=this._,r=WE(e+"",i),s=-1,a=r.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++s<a;)if(n=(e=r[s]).type)i[n]=qE(i[n],e.name,t);else if(null==t)for(n in i)i[n]=qE(i[n],e.name,null);return this}for(;++s<a;)if((n=(e=r[s]).type)&&(n=VE(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new UE(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),s=0;s<n;++s)r[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=0,n=(i=this._[e]).length;s<n;++s)i[s].value.apply(t,r)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,s=i.length;r<s;++r)i[r].value.apply(t,n)}};const GE=jE;var HE,XE,YE=0,KE=0,JE=0,ZE=0,QE=0,eS=0,tS="object"==typeof performance&&performance.now?performance:Date,nS="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function iS(){return QE||(nS(rS),QE=tS.now()+eS)}function rS(){QE=0}function sS(){this._call=this._time=this._next=null}function aS(e,t,n){var i=new sS;return i.restart(e,t,n),i}function oS(){QE=(ZE=tS.now())+eS,YE=KE=0;try{!function(){iS(),++YE;for(var e,t=HE;t;)(e=QE-t._time)>=0&&t._call.call(null,e),t=t._next;--YE}()}finally{YE=0,function(){for(var e,t,n=HE,i=1/0;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:HE=t);XE=e,lS(i)}(),QE=0}}function uS(){var e=tS.now(),t=e-ZE;t>1e3&&(eS-=t,ZE=e)}function lS(e){YE||(KE&&(KE=clearTimeout(KE)),e-QE>24?(e<1/0&&(KE=setTimeout(oS,e-tS.now()-eS)),JE&&(JE=clearInterval(JE))):(JE||(ZE=tS.now(),JE=setInterval(uS,1e3)),YE=1,nS(oS)))}sS.prototype=aS.prototype={constructor:sS,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?iS():+n)+(null==t?0:+t),this._next||XE===this||(XE?XE._next=this:HE=this,XE=this),this._call=e,this._time=n,lS()},stop:function(){this._call&&(this._call=null,this._time=1/0,lS())}};const cS=4294967296;function dS(e){return e.x}function hS(e){return e.y}var fS=Math.PI*(3-Math.sqrt(5));function pS(e){return e.index}function mS(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}const gS={center:function(e,t){var n,i=1;function r(){var r,s,a=n.length,o=0,u=0;for(r=0;r<a;++r)o+=(s=n[r]).x,u+=s.y;for(o=(o/a-e)*i,u=(u/a-t)*i,r=0;r<a;++r)(s=n[r]).x-=o,s.y-=u}return null==e&&(e=0),null==t&&(t=0),r.initialize=function(e){n=e},r.x=function(t){return arguments.length?(e=+t,r):e},r.y=function(e){return arguments.length?(t=+e,r):t},r.strength=function(e){return arguments.length?(i=+e,r):i},r},collide:function(e){var t,n,i,r=1,s=1;function a(){for(var e,a,u,l,c,d,h,f=t.length,p=0;p<s;++p)for(a=NE(t,zE,LE).visitAfter(o),e=0;e<f;++e)u=t[e],d=n[u.index],h=d*d,l=u.x+u.vx,c=u.y+u.vy,a.visit(m);function m(e,t,n,s,a){var o=e.data,f=e.r,p=d+f;if(!o)return t>l+p||s<l-p||n>c+p||a<c-p;if(o.index>u.index){var m=l-o.x-o.vx,g=c-o.y-o.vy,y=m*m+g*g;y<p*p&&(0===m&&(y+=(m=BE(i))*m),0===g&&(y+=(g=BE(i))*g),y=(p-(y=Math.sqrt(y)))/y*r,u.vx+=(m*=y)*(p=(f*=f)/(h+f)),u.vy+=(g*=y)*p,o.vx-=m*(p=1-p),o.vy-=g*p)}}}function o(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function u(){if(t){var i,r,s=t.length;for(n=new Array(s),i=0;i<s;++i)r=t[i],n[r.index]=+e(r,i,t)}}return"function"!=typeof e&&(e=ME(null==e?1:+e)),a.initialize=function(e,n){t=e,i=n,u()},a.iterations=function(e){return arguments.length?(s=+e,a):s},a.strength=function(e){return arguments.length?(r=+e,a):r},a.radius=function(t){return arguments.length?(e="function"==typeof t?t:ME(+t),u(),a):e},a},nbody:function(){var e,t,n,i,r,s=ME(-30),a=1,o=1/0,u=.81;function l(n){var r,s=e.length,a=NE(e,dS,hS).visitAfter(d);for(i=n,r=0;r<s;++r)t=e[r],a.visit(h)}function c(){if(e){var t,n,i=e.length;for(r=new Array(i),t=0;t<i;++t)n=e[t],r[n.index]=+s(n,t,e)}}function d(e){var t,n,i,s,a,o=0,u=0;if(e.length){for(i=s=a=0;a<4;++a)(t=e[a])&&(n=Math.abs(t.value))&&(o+=t.value,u+=n,i+=n*t.x,s+=n*t.y);e.x=i/u,e.y=s/u}else{(t=e).x=t.data.x,t.y=t.data.y;do{o+=r[t.data.index]}while(t=t.next)}e.value=o}function h(e,s,l,c){if(!e.value)return!0;var d=e.x-t.x,h=e.y-t.y,f=c-s,p=d*d+h*h;if(f*f/u<p)return p<o&&(0===d&&(p+=(d=BE(n))*d),0===h&&(p+=(h=BE(n))*h),p<a&&(p=Math.sqrt(a*p)),t.vx+=d*e.value*i/p,t.vy+=h*e.value*i/p),!0;if(!(e.length||p>=o)){(e.data!==t||e.next)&&(0===d&&(p+=(d=BE(n))*d),0===h&&(p+=(h=BE(n))*h),p<a&&(p=Math.sqrt(a*p)));do{e.data!==t&&(f=r[e.data.index]*i/p,t.vx+=d*f,t.vy+=h*f)}while(e=e.next)}}return l.initialize=function(t,i){e=t,n=i,c()},l.strength=function(e){return arguments.length?(s="function"==typeof e?e:ME(+e),c(),l):s},l.distanceMin=function(e){return arguments.length?(a=e*e,l):Math.sqrt(a)},l.distanceMax=function(e){return arguments.length?(o=e*e,l):Math.sqrt(o)},l.theta=function(e){return arguments.length?(u=e*e,l):Math.sqrt(u)},l},link:function(e){var t,n,i,r,s,a,o=pS,u=function(e){return 1/Math.min(r[e.source.index],r[e.target.index])},l=ME(30),c=1;function d(i){for(var r=0,o=e.length;r<c;++r)for(var u,l,d,h,f,p,m,g=0;g<o;++g)l=(u=e[g]).source,h=(d=u.target).x+d.vx-l.x-l.vx||BE(a),f=d.y+d.vy-l.y-l.vy||BE(a),h*=p=((p=Math.sqrt(h*h+f*f))-n[g])/p*i*t[g],f*=p,d.vx-=h*(m=s[g]),d.vy-=f*m,l.vx+=h*(m=1-m),l.vy+=f*m}function h(){if(i){var a,u,l=i.length,c=e.length,d=new Map(i.map(((e,t)=>[o(e,t,i),e])));for(a=0,r=new Array(l);a<c;++a)(u=e[a]).index=a,"object"!=typeof u.source&&(u.source=mS(d,u.source)),"object"!=typeof u.target&&(u.target=mS(d,u.target)),r[u.source.index]=(r[u.source.index]||0)+1,r[u.target.index]=(r[u.target.index]||0)+1;for(a=0,s=new Array(c);a<c;++a)u=e[a],s[a]=r[u.source.index]/(r[u.source.index]+r[u.target.index]);t=new Array(c),f(),n=new Array(c),p()}}function f(){if(i)for(var n=0,r=e.length;n<r;++n)t[n]=+u(e[n],n,e)}function p(){if(i)for(var t=0,r=e.length;t<r;++t)n[t]=+l(e[t],t,e)}return null==e&&(e=[]),d.initialize=function(e,t){i=e,a=t,h()},d.links=function(t){return arguments.length?(e=t,h(),d):e},d.id=function(e){return arguments.length?(o=e,d):o},d.iterations=function(e){return arguments.length?(c=+e,d):c},d.strength=function(e){return arguments.length?(u="function"==typeof e?e:ME(+e),f(),d):u},d.distance=function(e){return arguments.length?(l="function"==typeof e?e:ME(+e),p(),d):l},d},x:function(e){var t,n,i,r=ME(.1);function s(e){for(var r,s=0,a=t.length;s<a;++s)(r=t[s]).vx+=(i[s]-r.x)*n[s]*e}function a(){if(t){var s,a=t.length;for(n=new Array(a),i=new Array(a),s=0;s<a;++s)n[s]=isNaN(i[s]=+e(t[s],s,t))?0:+r(t[s],s,t)}}return"function"!=typeof e&&(e=ME(null==e?0:+e)),s.initialize=function(e){t=e,a()},s.strength=function(e){return arguments.length?(r="function"==typeof e?e:ME(+e),a(),s):r},s.x=function(t){return arguments.length?(e="function"==typeof t?t:ME(+t),a(),s):e},s},y:function(e){var t,n,i,r=ME(.1);function s(e){for(var r,s=0,a=t.length;s<a;++s)(r=t[s]).vy+=(i[s]-r.y)*n[s]*e}function a(){if(t){var s,a=t.length;for(n=new Array(a),i=new Array(a),s=0;s<a;++s)n[s]=isNaN(i[s]=+e(t[s],s,t))?0:+r(t[s],s,t)}}return"function"!=typeof e&&(e=ME(null==e?0:+e)),s.initialize=function(e){t=e,a()},s.strength=function(e){return arguments.length?(r="function"==typeof e?e:ME(+e),a(),s):r},s.y=function(t){return arguments.length?(e="function"==typeof t?t:ME(+t),a(),s):e},s}},yS="forces",vS=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],bS=["static","iterations"],xS=["x","y","vx","vy"];function wS(e){$u.call(this,null,e)}function CS(e,t,n,i){var r,s,a,o,u=gn(t.forces);for(r=0,s=vS.length;r<s;++r)(a=vS[r])!==yS&&t.modified(a)&&e[a](t[a]);for(r=0,s=u.length;r<s;++r)o=yS+r,(a=n||t.modified(yS,r)?AS(u[r]):i&&kS(u[r],i)?e.force(o):null)&&e.force(o,a);for(s=e.numForces||0;r<s;++r)e.force(yS+r,null);return e.numForces=u.length,e}function kS(e,t){var n,i;for(n in e)if(yn(i=e[n])&&t.modified(Mt(i)))return 1;return 0}function AS(e){var t,n;for(n in Fn(gS,e.force)||Pt("Unrecognized force: "+e.force),t=gS[e.force](),e)yn(t[n])&&_S(t[n],e[n],e);return t}function _S(e,t,n){e(yn(t)?e=>t(e,n):t)}function ES(e){var t=0,n=e.children,i=n&&n.length;if(i)for(;--i>=0;)t+=n[i].value;else t=1;e.value=t}function SS(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=DS)):void 0===t&&(t=FS);for(var n,i,r,s,a,o=new NS(e),u=[o];n=u.pop();)if((r=t(n.data))&&(a=(r=Array.from(r)).length))for(n.children=r,s=a-1;s>=0;--s)u.push(i=r[s]=new NS(r[s])),i.parent=n,i.depth=n.depth+1;return o.eachBefore(OS)}function FS(e){return e.children}function DS(e){return Array.isArray(e)?e[1]:null}function $S(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function OS(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function NS(e){this.data=e,this.depth=this.height=0,this.parent=null}function IS(e,t){var n,i;if(MS(t,e))return[t];for(n=0;n<e.length;++n)if(TS(t,e[n])&&MS(zS(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(i=n+1;i<e.length;++i)if(TS(zS(e[n],e[i]),t)&&TS(zS(e[n],t),e[i])&&TS(zS(e[i],t),e[n])&&MS(LS(e[n],e[i],t),e))return[e[n],e[i],t];throw new Error}function TS(e,t){var n=e.r-t.r,i=t.x-e.x,r=t.y-e.y;return n<0||n*n<i*i+r*r}function RS(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function MS(e,t){for(var n=0;n<t.length;++n)if(!RS(e,t[n]))return!1;return!0}function BS(e){switch(e.length){case 1:return{x:(t=e[0]).x,y:t.y,r:t.r};case 2:return zS(e[0],e[1]);case 3:return LS(e[0],e[1],e[2])}var t}function zS(e,t){var n=e.x,i=e.y,r=e.r,s=t.x,a=t.y,o=t.r,u=s-n,l=a-i,c=o-r,d=Math.sqrt(u*u+l*l);return{x:(n+s+u/d*c)/2,y:(i+a+l/d*c)/2,r:(d+r+o)/2}}function LS(e,t,n){var i=e.x,r=e.y,s=e.r,a=t.x,o=t.y,u=t.r,l=n.x,c=n.y,d=n.r,h=i-a,f=i-l,p=r-o,m=r-c,g=u-s,y=d-s,v=i*i+r*r-s*s,b=v-a*a-o*o+u*u,x=v-l*l-c*c+d*d,w=f*p-h*m,C=(p*x-m*b)/(2*w)-i,k=(m*g-p*y)/w,A=(f*b-h*x)/(2*w)-r,_=(h*y-f*g)/w,E=k*k+_*_-1,S=2*(s+C*k+A*_),F=C*C+A*A-s*s,D=-(E?(S+Math.sqrt(S*S-4*E*F))/(2*E):F/S);return{x:i+C+k*D,y:r+A+_*D,r:D}}function PS(e,t,n){var i,r,s,a,o=e.x-t.x,u=e.y-t.y,l=o*o+u*u;l?(r=t.r+n.r,r*=r,a=e.r+n.r,r>(a*=a)?(i=(l+a-r)/(2*l),s=Math.sqrt(Math.max(0,a/l-i*i)),n.x=e.x-i*o-s*u,n.y=e.y-i*u+s*o):(i=(l+r-a)/(2*l),s=Math.sqrt(Math.max(0,r/l-i*i)),n.x=t.x+i*o-s*u,n.y=t.y+i*u+s*o)):(n.x=t.x+n.r,n.y=t.y)}function jS(e,t){var n=e.r+t.r-1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function US(e){var t=e._,n=e.next._,i=t.r+n.r,r=(t.x*n.r+n.x*t.r)/i,s=(t.y*n.r+n.y*t.r)/i;return r*r+s*s}function WS(e){this._=e,this.next=null,this.previous=null}function VS(e){if(!(r=(e=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}(e)).length))return 0;var t,n,i,r,s,a,o,u,l,c,d;if((t=e[0]).x=0,t.y=0,!(r>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(r>2))return t.r+n.r;PS(n,t,i=e[2]),t=new WS(t),n=new WS(n),i=new WS(i),t.next=i.previous=n,n.next=t.previous=i,i.next=n.previous=t;e:for(o=3;o<r;++o){PS(t._,n._,i=e[o]),i=new WS(i),u=n.next,l=t.previous,c=n._.r,d=t._.r;do{if(c<=d){if(jS(u._,i._)){n=u,t.next=n,n.previous=t,--o;continue e}c+=u._.r,u=u.next}else{if(jS(l._,i._)){(t=l).next=n,n.previous=t,--o;continue e}d+=l._.r,l=l.previous}}while(u!==l.next);for(i.previous=t,i.next=n,t.next=n.previous=n=i,s=US(t);(i=i.next)!==n;)(a=US(i))<s&&(t=i,s=a);n=t.next}for(t=[n._],i=n;(i=i.next)!==n;)t.push(i._);for(i=function(e){for(var t,n,i=0,r=(e=function(e){for(var t,n,i=e.length;i;)n=Math.random()*i--|0,t=e[i],e[i]=e[n],e[n]=t;return e}(Array.from(e))).length,s=[];i<r;)t=e[i],n&&RS(n,t)?++i:(n=BS(s=IS(s,t)),i=0);return n}(t),o=0;o<r;++o)(t=e[o]).x-=i.x,t.y-=i.y;return i.r}function qS(e){return null==e?null:GS(e)}function GS(e){if("function"!=typeof e)throw new Error;return e}function HS(){return 0}function XS(e){return function(){return e}}function YS(e){return Math.sqrt(e.value)}function KS(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function JS(e,t){return function(n){if(i=n.children){var i,r,s,a=i.length,o=e(n)*t||0;if(o)for(r=0;r<a;++r)i[r].r+=o;if(s=VS(i),o)for(r=0;r<a;++r)i[r].r-=o;n.r=s+o}}}function ZS(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function QS(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function eF(e,t,n,i,r){for(var s,a=e.children,o=-1,u=a.length,l=e.value&&(i-t)/e.value;++o<u;)(s=a[o]).y0=n,s.y1=r,s.x0=t,s.x1=t+=s.value*l}wS.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:xS}]},On(wS,$u,{transform(e,t){var n,i,r=this.value,s=t.changed(t.ADD_REM),a=e.modified(vS),o=e.iterations||300;if(r?(s&&(t.modifies("index"),r.nodes(t.source)),(a||t.changed(t.MOD))&&CS(r,e,0,t)):(this.value=r=function(e,t){const n=function(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,a=.6,o=new Map,u=aS(d),l=GE("tick","end"),c=function(){let e=1;return()=>(e=(1664525*e+1013904223)%cS)/cS}();function d(){h(),l.call("tick",t),n<i&&(u.stop(),l.call("end",t))}function h(i){var u,l,c=e.length;void 0===i&&(i=1);for(var d=0;d<i;++d)for(n+=(s-n)*r,o.forEach((function(e){e(n)})),u=0;u<c;++u)null==(l=e[u]).fx?l.x+=l.vx*=a:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=a:(l.y=l.fy,l.vy=0);return t}function f(){for(var t,n=0,i=e.length;n<i;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var r=10*Math.sqrt(.5+n),s=n*fS;t.x=r*Math.cos(s),t.y=r*Math.sin(s)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function p(t){return t.initialize&&t.initialize(e,c),t}return null==e&&(e=[]),f(),t={tick:h,restart:function(){return u.restart(d),t},stop:function(){return u.stop(),t},nodes:function(n){return arguments.length?(e=n,f(),o.forEach(p),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(i=+e,t):i},alphaDecay:function(e){return arguments.length?(r=+e,t):+r},alphaTarget:function(e){return arguments.length?(s=+e,t):s},velocityDecay:function(e){return arguments.length?(a=1-e,t):1-a},randomSource:function(e){return arguments.length?(c=e,o.forEach(p),t):c},force:function(e,n){return arguments.length>1?(null==n?o.delete(e):o.set(e,p(n)),t):o.get(e)},find:function(t,n,i){var r,s,a,o,u,l=0,c=e.length;for(null==i?i=1/0:i*=i,l=0;l<c;++l)(a=(r=t-(o=e[l]).x)*r+(s=n-o.y)*s)<i&&(u=o,i=a);return u},on:function(e,n){return arguments.length>1?(l.on(e,n),t):l.on(e)}}}(e),i=n.stop,r=n.restart;let s=!1;return n.stopped=()=>s,n.restart=()=>(s=!1,r()),n.stop=()=>(s=!0,i()),CS(n,t,!0).on("end",(()=>s=!0))}(t.source,e),r.on("tick",(n=t.dataflow,i=this,()=>n.touch(i).run())),e.static||(s=!0,r.tick()),t.modifies("index")),a||s||e.modified(bS)||t.changed()&&e.restart)if(r.alpha(Math.max(r.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(r.alphaMin(),1/o)),e.static)for(r.stop();--o>=0;)r.tick();else if(r.stopped()&&r.restart(),!s)return t.StopPropagation;return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let e,t=this._argops,o=0,u=t.length;o<u;++o)if(e=t[o],e.name===yS&&"link"===e.op._argval.force)for(var i,r=e.op._argops,s=0,a=r.length;s<a;++s)if("links"===r[s].name&&(i=r[s].op.source)){n.pulse(i,n.changeset().reflow());break}return t.reflow(e.modified()).modifies(xS)}}),NS.prototype=SS.prototype={constructor:NS,count:function(){return this.eachAfter(ES)},each:function(e,t){let n=-1;for(const i of this)e.call(t,i,++n,this);return this},eachAfter:function(e,t){for(var n,i,r,s=this,a=[s],o=[],u=-1;s=a.pop();)if(o.push(s),n=s.children)for(i=0,r=n.length;i<r;++i)a.push(n[i]);for(;s=o.pop();)e.call(t,s,++u,this);return this},eachBefore:function(e,t){for(var n,i,r=this,s=[r],a=-1;r=s.pop();)if(e.call(t,r,++a,this),n=r.children)for(i=n.length-1;i>=0;--i)s.push(n[i]);return this},find:function(e,t){let n=-1;for(const i of this)if(e.call(t,i,++n,this))return i},sum:function(e){return this.eachAfter((function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n}))},sort:function(e){return this.eachBefore((function(t){t.children&&t.children.sort(e)}))},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;for(e=n.pop(),t=i.pop();e===t;)r=e,e=n.pop(),t=i.pop();return r}(t,e),i=[t];t!==n;)t=t.parent,i.push(t);for(var r=i.length;e!==n;)i.splice(r,0,e),e=e.parent;return i},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore((function(t){t.children||e.push(t)})),e},links:function(){var e=this,t=[];return e.each((function(n){n!==e&&t.push({source:n.parent,target:n})})),t},copy:function(){return SS(this).eachBefore($S)},[Symbol.iterator]:function*(){var e,t,n,i,r=this,s=[r];do{for(e=s.reverse(),s=[];r=e.pop();)if(yield r,t=r.children)for(n=0,i=t.length;n<i;++n)s.push(t[n])}while(s.length)}};var tF={depth:-1},nF={};function iF(e){return e.id}function rF(e){return e.parentId}function sF(){var e=iF,t=rF;function n(n){var i,r,s,a,o,u,l,c=Array.from(n),d=c.length,h=new Map;for(r=0;r<d;++r)i=c[r],o=c[r]=new NS(i),null!=(u=e(i,r,n))&&(u+="")&&(l=o.id=u,h.set(l,h.has(l)?nF:o)),null!=(u=t(i,r,n))&&(u+="")&&(o.parent=u);for(r=0;r<d;++r)if(u=(o=c[r]).parent){if(!(a=h.get(u)))throw new Error("missing: "+u);if(a===nF)throw new Error("ambiguous: "+u);a.children?a.children.push(o):a.children=[o],o.parent=a}else{if(s)throw new Error("multiple roots");s=o}if(!s)throw new Error("no root");if(s.parent=tF,s.eachBefore((function(e){e.depth=e.parent.depth+1,--d})).eachBefore(OS),s.parent=null,d>0)throw new Error("cycle");return s}return n.id=function(t){return arguments.length?(e=GS(t),n):e},n.parentId=function(e){return arguments.length?(t=GS(e),n):t},n}function aF(e,t){return e.parent===t.parent?1:2}function oF(e){var t=e.children;return t?t[0]:e.t}function uF(e){var t=e.children;return t?t[t.length-1]:e.t}function lF(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function cF(e,t,n){return e.a.parent===t.parent?e.a:n}function dF(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function hF(e,t){return e.parent===t.parent?1:2}function fF(e,t){return e+t.x}function pF(e,t){return Math.max(e,t.y)}function mF(e,t,n,i,r){for(var s,a=e.children,o=-1,u=a.length,l=e.value&&(r-n)/e.value;++o<u;)(s=a[o]).x0=t,s.x1=i,s.y0=n,s.y1=n+=s.value*l}dF.prototype=Object.create(NS.prototype);var gF=(1+Math.sqrt(5))/2;function yF(e,t,n,i,r,s){for(var a,o,u,l,c,d,h,f,p,m,g,y=[],v=t.children,b=0,x=0,w=v.length,C=t.value;b<w;){u=r-n,l=s-i;do{c=v[x++].value}while(!c&&x<w);for(d=h=c,g=c*c*(m=Math.max(l/u,u/l)/(C*e)),p=Math.max(h/g,g/d);x<w;++x){if(c+=o=v[x].value,o<d&&(d=o),o>h&&(h=o),g=c*c*m,(f=Math.max(h/g,g/d))>p){c-=o;break}p=f}y.push(a={value:c,dice:u<l,children:v.slice(b,x)}),a.dice?eF(a,n,i,r,C?i+=l*c/C:s):mF(a,n,i,C?n+=u*c/C:r,s),C-=c,b=x}return y}const vF=function e(t){function n(e,n,i,r,s){yF(t,e,n,i,r,s)}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(gF),bF=function e(t){function n(e,n,i,r,s){if((a=e._squarify)&&a.ratio===t)for(var a,o,u,l,c,d=-1,h=a.length,f=e.value;++d<h;){for(u=(o=a[d]).children,l=o.value=0,c=u.length;l<c;++l)o.value+=u[l].value;o.dice?eF(o,n,i,r,f?i+=(s-i)*o.value/f:s):mF(o,n,i,f?n+=(r-n)*o.value/f:r,s),f-=o.value}else e._squarify=a=yF(t,e,n,i,r,s),a.ratio=t}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(gF);function xF(e,t,n){const i={};return e.each((e=>{const r=e.data;n(r)&&(i[t(r)]=e)})),e.lookup=i,e}function wF(e){$u.call(this,null,e)}wF.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const CF=e=>e.values;function kF(){const e=[],t={entries:e=>i(n(e,0),0),key:n=>(e.push(n),t)};function n(t,i){if(i>=e.length)return t;const r=t.length,s=e[i++],a={},o={};let u,l,c,d=-1;for(;++d<r;)u=s(l=t[d])+"",(c=a[u])?c.push(l):a[u]=[l];for(u in a)o[u]=n(a[u],i);return o}function i(t,n){if(++n>e.length)return t;const r=[];for(const e in t)r.push({key:e,values:i(t[e],n)});return r}return t}function AF(e){$u.call(this,null,e)}On(wF,$u,{transform(e,t){t.source||Pt("Nest transform requires an upstream data source.");var n=e.generate,i=e.modified(),r=t.clone(),s=this.value;return(!s||i||t.changed())&&(s&&s.each((e=>{e.children&&Jo(e.data)&&r.rem.push(e.data)})),this.value=s=SS({values:gn(e.keys).reduce(((e,t)=>(e.key(t),e)),kF()).entries(r.source)},CF),n&&s.each((e=>{e.children&&(e=eu(e.data),r.add.push(e),r.source.push(e))})),xF(s,Zo,Zo)),r.source.root=s,r}});const _F=(e,t)=>e.parent===t.parent?1:2;On(AF,$u,{transform(e,t){t.source&&t.source.root||Pt(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),i=this.fields,r=t.source.root,s=e.as||i;e.field?r.sum(e.field):r.count(),e.sort&&r.sort(ru(e.sort,(e=>e.data))),function(e,t,n){for(let i,r=0,s=t.length;r<s;++r)i=t[r],i in n&&e[i](n[i])}(n,this.params,e),n.separation&&n.separation(!1!==e.separation?_F:Gt);try{this.value=n(r)}catch(e){Pt(e)}return r.each((e=>function(e,t,n){const i=e.data,r=t.length-1;for(let s=0;s<r;++s)i[n[s]]=e[t[s]];i[n[r]]=e.children?e.children.length:0}(e,i,s))),t.reflow(e.modified()).modifies(s).modifies("leaf")}});const EF=["x","y","r","depth","children"];function SF(e){AF.call(this,e)}SF.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:EF.length,default:EF}]},On(SF,AF,{layout:function(){var e=null,t=1,n=1,i=HS;function r(r){return r.x=t/2,r.y=n/2,e?r.eachBefore(KS(e)).eachAfter(JS(i,.5)).eachBefore(ZS(1)):r.eachBefore(KS(YS)).eachAfter(JS(HS,1)).eachAfter(JS(i,r.r/Math.min(t,n))).eachBefore(ZS(Math.min(t,n)/(2*r.r))),r}return r.radius=function(t){return arguments.length?(e=qS(t),r):e},r.size=function(e){return arguments.length?(t=+e[0],n=+e[1],r):[t,n]},r.padding=function(e){return arguments.length?(i="function"==typeof e?e:XS(+e),r):i},r},params:["radius","size","padding"],fields:EF});const FF=["x0","y0","x1","y1","depth","children"];function DF(e){AF.call(this,e)}function $F(e){$u.call(this,null,e)}DF.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:FF.length,default:FF}]},On(DF,AF,{layout:function(){var e=1,t=1,n=0,i=!1;function r(r){var s=r.height+1;return r.x0=r.y0=n,r.x1=e,r.y1=t/s,r.eachBefore(function(e,t){return function(i){i.children&&eF(i,i.x0,e*(i.depth+1)/t,i.x1,e*(i.depth+2)/t);var r=i.x0,s=i.y0,a=i.x1-n,o=i.y1-n;a<r&&(r=a=(r+a)/2),o<s&&(s=o=(s+o)/2),i.x0=r,i.y0=s,i.x1=a,i.y1=o}}(t,s)),i&&r.eachBefore(QS),r}return r.round=function(e){return arguments.length?(i=!!e,r):i},r.size=function(n){return arguments.length?(e=+n[0],t=+n[1],r):[e,t]},r.padding=function(e){return arguments.length?(n=+e,r):n},r},params:["size","round","padding"],fields:FF}),$F.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},On($F,$u,{transform(e,t){t.source||Pt("Stratify transform requires an upstream data source.");let n=this.value;const i=e.modified(),r=t.fork(t.ALL).materialize(t.SOURCE),s=!n||i||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return r.source=r.source.slice(),s&&(n=r.source.length?xF(sF().id(e.key).parentId(e.parentKey)(r.source),e.key,Ht):xF(sF()([{}]),e.key,e.key)),r.source.root=this.value=n,r}});const OF={tidy:function(){var e=aF,t=1,n=1,i=null;function r(r){var u=function(e){for(var t,n,i,r,s,a=new dF(e,0),o=[a];t=o.pop();)if(i=t._.children)for(t.children=new Array(s=i.length),r=s-1;r>=0;--r)o.push(n=t.children[r]=new dF(i[r],r)),n.parent=t;return(a.parent=new dF(null,0)).children=[a],a}(r);if(u.eachAfter(s),u.parent.m=-u.z,u.eachBefore(a),i)r.eachBefore(o);else{var l=r,c=r,d=r;r.eachBefore((function(e){e.x<l.x&&(l=e),e.x>c.x&&(c=e),e.depth>d.depth&&(d=e)}));var h=l===c?1:e(l,c)/2,f=h-l.x,p=t/(c.x+h+f),m=n/(d.depth||1);r.eachBefore((function(e){e.x=(e.x+f)*p,e.y=e.depth*m}))}return r}function s(t){var n=t.children,i=t.parent.children,r=t.i?i[t.i-1]:null;if(n){!function(e){for(var t,n=0,i=0,r=e.children,s=r.length;--s>=0;)(t=r[s]).z+=n,t.m+=n,n+=t.s+(i+=t.c)}(t);var s=(n[0].z+n[n.length-1].z)/2;r?(t.z=r.z+e(t._,r._),t.m=t.z-s):t.z=s}else r&&(t.z=r.z+e(t._,r._));t.parent.A=function(t,n,i){if(n){for(var r,s=t,a=t,o=n,u=s.parent.children[0],l=s.m,c=a.m,d=o.m,h=u.m;o=uF(o),s=oF(s),o&&s;)u=oF(u),(a=uF(a)).a=t,(r=o.z+d-s.z-l+e(o._,s._))>0&&(lF(cF(o,t,i),t,r),l+=r,c+=r),d+=o.m,l+=s.m,h+=u.m,c+=a.m;o&&!uF(a)&&(a.t=o,a.m+=d-c),s&&!oF(u)&&(u.t=s,u.m+=l-h,i=t)}return i}(t,r,t.parent.A||i[0])}function a(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function o(e){e.x*=t,e.y=e.depth*n}return r.separation=function(t){return arguments.length?(e=t,r):e},r.size=function(e){return arguments.length?(i=!1,t=+e[0],n=+e[1],r):i?null:[t,n]},r.nodeSize=function(e){return arguments.length?(i=!0,t=+e[0],n=+e[1],r):i?[t,n]:null},r},cluster:function(){var e=hF,t=1,n=1,i=!1;function r(r){var s,a=0;r.eachAfter((function(t){var n=t.children;n?(t.x=function(e){return e.reduce(fF,0)/e.length}(n),t.y=function(e){return 1+e.reduce(pF,0)}(n)):(t.x=s?a+=e(t,s):0,t.y=0,s=t)}));var o=function(e){for(var t;t=e.children;)e=t[0];return e}(r),u=function(e){for(var t;t=e.children;)e=t[t.length-1];return e}(r),l=o.x-e(o,u)/2,c=u.x+e(u,o)/2;return r.eachAfter(i?function(e){e.x=(e.x-r.x)*t,e.y=(r.y-e.y)*n}:function(e){e.x=(e.x-l)/(c-l)*t,e.y=(1-(r.y?e.y/r.y:1))*n})}return r.separation=function(t){return arguments.length?(e=t,r):e},r.size=function(e){return arguments.length?(i=!1,t=+e[0],n=+e[1],r):i?null:[t,n]},r.nodeSize=function(e){return arguments.length?(i=!0,t=+e[0],n=+e[1],r):i?[t,n]:null},r}},NF=["x","y","depth","children"];function IF(e){AF.call(this,e)}function TF(e){$u.call(this,[],e)}IF.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:NF.length,default:NF}]},On(IF,AF,{layout(e){const t=e||"tidy";if(Fn(OF,t))return OF[t]();Pt("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:NF}),TF.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},On(TF,$u,{transform(e,t){const n=this.value,i=t.source&&t.source.root,r=t.fork(t.NO_SOURCE),s={};return i||Pt("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(r.rem=n,t.visit(t.SOURCE,(e=>s[Zo(e)]=1)),i.each((e=>{const t=e.data,n=e.parent&&e.parent.data;n&&s[Zo(t)]&&s[Zo(n)]&&r.add.push(eu({source:n,target:t}))})),this.value=r.add):t.changed(t.MOD)&&(t.visit(t.MOD,(e=>s[Zo(e)]=1)),n.forEach((e=>{(s[Zo(e.source)]||s[Zo(e.target)])&&r.mod.push(e)}))),r}});const RF={binary:function(e,t,n,i,r){var s,a,o=e.children,u=o.length,l=new Array(u+1);for(l[0]=a=s=0;s<u;++s)l[s+1]=a+=o[s].value;!function e(t,n,i,r,s,a,u){if(t>=n-1){var c=o[t];return c.x0=r,c.y0=s,c.x1=a,void(c.y1=u)}for(var d=l[t],h=i/2+d,f=t+1,p=n-1;f<p;){var m=f+p>>>1;l[m]<h?f=m+1:p=m}h-l[f-1]<l[f]-h&&t+1<f&&--f;var g=l[f]-d,y=i-g;if(a-r>u-s){var v=i?(r*y+a*g)/i:a;e(t,f,g,r,s,v,u),e(f,n,y,v,s,a,u)}else{var b=i?(s*y+u*g)/i:u;e(t,f,g,r,s,a,b),e(f,n,y,r,b,a,u)}}(0,u,e.value,t,n,i,r)},dice:eF,slice:mF,slicedice:function(e,t,n,i,r){(1&e.depth?mF:eF)(e,t,n,i,r)},squarify:vF,resquarify:bF},MF=["x0","y0","x1","y1","depth","children"];function BF(e){AF.call(this,e)}function zF(e,t,n,i){const r=e.width,s=e.height,a=n||i,o=Ch(r,s).getContext("2d");t.forEach((e=>LF(o,e,a)));const u=new Uint32Array(o.getImageData(0,0,r,s).data.buffer),l=e.bitmap(),c=a&&e.bitmap();let d,h,f,p,m;for(h=0;h<s;++h)for(d=0;d<r;++d)m=4278190080&u[h*r+d],m&&(f=e(d),p=e(h),i||l.set(f,p),a&&268435456^m&&c.set(f,p));return[l,c]}function LF(e,t,n){if(!t.length)return;const i=t[0].mark.marktype;"group"===i?t.forEach((t=>{t.items.forEach((t=>LF(e,t.items,n)))})):_b[i].draw(e,{items:n?t.map(PF):t})}function PF(e){const t=nu(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=.0625,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}BF.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:MF.length,default:MF}]},On(BF,AF,{layout(){const e=function(){var e=vF,t=!1,n=1,i=1,r=[0],s=HS,a=HS,o=HS,u=HS,l=HS;function c(e){return e.x0=e.y0=0,e.x1=n,e.y1=i,e.eachBefore(d),r=[0],t&&e.eachBefore(QS),e}function d(t){var n=r[t.depth],i=t.x0+n,c=t.y0+n,d=t.x1-n,h=t.y1-n;d<i&&(i=d=(i+d)/2),h<c&&(c=h=(c+h)/2),t.x0=i,t.y0=c,t.x1=d,t.y1=h,t.children&&(n=r[t.depth+1]=s(t)/2,i+=l(t)-n,c+=a(t)-n,(d-=o(t)-n)<i&&(i=d=(i+d)/2),(h-=u(t)-n)<c&&(c=h=(c+h)/2),e(t,i,c,d,h))}return c.round=function(e){return arguments.length?(t=!!e,c):t},c.size=function(e){return arguments.length?(n=+e[0],i=+e[1],c):[n,i]},c.tile=function(t){return arguments.length?(e=GS(t),c):e},c.padding=function(e){return arguments.length?c.paddingInner(e).paddingOuter(e):c.paddingInner()},c.paddingInner=function(e){return arguments.length?(s="function"==typeof e?e:XS(+e),c):s},c.paddingOuter=function(e){return arguments.length?c.paddingTop(e).paddingRight(e).paddingBottom(e).paddingLeft(e):c.paddingTop()},c.paddingTop=function(e){return arguments.length?(a="function"==typeof e?e:XS(+e),c):a},c.paddingRight=function(e){return arguments.length?(o="function"==typeof e?e:XS(+e),c):o},c.paddingBottom=function(e){return arguments.length?(u="function"==typeof e?e:XS(+e),c):u},c.paddingLeft=function(e){return arguments.length?(l="function"==typeof e?e:XS(+e),c):l},c}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{Fn(RF,t)?e.tile(RF[t]):Pt("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:MF});const jF=31,UF=new Uint32Array(33),WF=new Uint32Array(33);WF[0]=0,UF[0]=~WF[0];for(let e=1;e<=32;++e)WF[e]=WF[e-1]<<1|1,UF[e]=~WF[e];function VF(e,t,n,i,r,s){let a=n/2;return e-a<0||e+a>r||t-(a=i/2)<0||t+a>s}function qF(e,t,n,i,r,s,a,o){const u=r*s/(2*i),l=e(t-u),c=e(t+u),d=e(n-(s/=2)),h=e(n+s);return a.outOfBounds(l,d,c,h)||a.getRange(l,d,c,h)||o&&o.getRange(l,d,c,h)}const GF=[-1,-1,1,1],HF=[-1,1,-1,1],XF=["right","center","left"],YF=["bottom","middle","top"];function KF(e,t,n,i,r,s,a,o,u,l,c,d){return!(r.outOfBounds(e,n,t,i)||(d&&s?s.getRange(e,n,t,i)||!function(e,t,n,i,r){return r[0]<=e&&n<=r[2]&&r[3]<=t&&i<=r[5]}(a,u,o,l,c):r.getRange(e,n,t,i)))}const JF={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},ZF={naive:function(e,t,n,i){const r=e.width,s=e.height;return function(e){const t=e.datum.datum.items[i].items,n=t.length,a=e.datum.fontSize,o=ob.width(e.datum,e.datum.text);let u,l,c,d,h,f,p,m=0;for(let i=0;i<n;++i)u=t[i].x,c=t[i].y,l=void 0===t[i].x2?u:t[i].x2,d=void 0===t[i].y2?c:t[i].y2,h=(u+l)/2,f=(c+d)/2,p=Math.abs(l-u+d-c),p>=m&&(m=p,e.x=h,e.y=f);return h=o/2,f=a/2,u=e.x-h,l=e.x+h,c=e.y-f,d=e.y+f,e.align="center",u<0&&l<=r?e.align="left":0<=u&&r<l&&(e.align="right"),e.baseline="middle",c<0&&d<=s?e.baseline="top":0<=c&&s<d&&(e.baseline="bottom"),!0}},"reduced-search":function(e,t,n,i){const r=e.width,s=e.height,a=t[0],o=t[1];function u(t,n,i,u,l){const c=e.invert(t),d=e.invert(n);let h,f=i,p=s;if(!VF(c,d,u,l,r,s)&&!qF(e,c,d,l,u,f,a,o)&&!qF(e,c,d,l,u,l,a,null)){for(;p-f>=1;)h=(f+p)/2,qF(e,c,d,l,u,h,a,o)?p=h:f=h;if(f>i)return[c,d,f,!0]}}return function(t){const o=t.datum.datum.items[i].items,l=o.length,c=t.datum.fontSize,d=ob.width(t.datum,t.datum.text);let h,f,p,m,g,y,v,b,x,w,C,k,A,_,E,S,F,D=n?c:0,$=!1,O=!1,N=0;for(let i=0;i<l;++i){for(h=o[i].x,p=o[i].y,f=void 0===o[i].x2?h:o[i].x2,m=void 0===o[i].y2?p:o[i].y2,h>f&&(F=h,h=f,f=F),p>m&&(F=p,p=m,m=F),x=e(h),C=e(f),w=~~((x+C)/2),k=e(p),_=e(m),A=~~((k+_)/2),v=w;v>=x;--v)for(b=A;b>=k;--b)S=u(v,b,D,d,c),S&&([t.x,t.y,D,$]=S);for(v=w;v<=C;++v)for(b=A;b<=_;++b)S=u(v,b,D,d,c),S&&([t.x,t.y,D,$]=S);$||n||(E=Math.abs(f-h+m-p),g=(h+f)/2,y=(p+m)/2,E>=N&&!VF(g,y,d,c,r,s)&&!qF(e,g,y,c,d,c,a,null)&&(N=E,t.x=g,t.y=y,O=!0))}return!(!$&&!O||(g=d/2,y=c/2,a.setRange(e(t.x-g),e(t.y-y),e(t.x+g),e(t.y+y)),t.align="center",t.baseline="middle",0))}},floodfill:function(e,t,n,i){const r=e.width,s=e.height,a=t[0],o=t[1],u=e.bitmap();return function(t){const l=t.datum.datum.items[i].items,c=l.length,d=t.datum.fontSize,h=ob.width(t.datum,t.datum.text),f=[];let p,m,g,y,v,b,x,w,C,k,A,_,E=n?d:0,S=!1,F=!1,D=0;for(let i=0;i<c;++i){for(p=l[i].x,g=l[i].y,m=void 0===l[i].x2?p:l[i].x2,y=void 0===l[i].y2?g:l[i].y2,f.push([e((p+m)/2),e((g+y)/2)]);f.length;)if([x,w]=f.pop(),!(a.get(x,w)||o.get(x,w)||u.get(x,w))){u.set(x,w);for(let e=0;e<4;++e)v=x+GF[e],b=w+HF[e],u.outOfBounds(v,b,v,b)||f.push([v,b]);if(v=e.invert(x),b=e.invert(w),C=E,k=s,!VF(v,b,h,d,r,s)&&!qF(e,v,b,d,h,C,a,o)&&!qF(e,v,b,d,h,d,a,null)){for(;k-C>=1;)A=(C+k)/2,qF(e,v,b,d,h,A,a,o)?k=A:C=A;C>E&&(t.x=v,t.y=b,E=C,S=!0)}}S||n||(_=Math.abs(m-p+y-g),v=(p+m)/2,b=(g+y)/2,_>=D&&!VF(v,b,h,d,r,s)&&!qF(e,v,b,d,h,d,a,null)&&(D=_,t.x=v,t.y=b,F=!0))}return!(!S&&!F||(v=h/2,b=d/2,a.setRange(e(t.x-v),e(t.y-b),e(t.x+v),e(t.y+b)),t.align="center",t.baseline="middle",0))}}};function QF(e,t,n,i,r,s,a,o,u,l,c){if(!e.length)return e;const d=Math.max(i.length,r.length),h=function(e,t){const n=new Float64Array(t),i=e.length;for(let t=0;t<i;++t)n[t]=e[t]||0;for(let e=i;e<t;++e)n[e]=n[i-1];return n}(i,d),f=function(e,t){const n=new Int8Array(t),i=e.length;for(let t=0;t<i;++t)n[t]|=JF[e[t]];for(let e=i;e<t;++e)n[e]=n[i-1];return n}(r,d),p=(x=e[0].datum)&&x.mark&&x.mark.marktype,m="group"===p&&e[0].datum.items[u].marktype,g="area"===m,y=function(e,t,n,i){const r=e=>[e.x,e.x,e.x,e.y,e.y,e.y];return e?"line"===e||"area"===e?e=>r(e.datum):"line"===t?e=>{const t=e.datum.items[i].items;return r(t.length?t["start"===n?0:t.length-1]:{x:NaN,y:NaN})}:e=>{const t=e.datum.bounds;return[t.x1,(t.x1+t.x2)/2,t.x2,t.y1,(t.y1+t.y2)/2,t.y2]}:r}(p,m,o,u),v=function(e,t,n){const i=Math.max(1,Math.sqrt(e*t/1e6)),r=~~((e+2*n+i)/i),s=~~((t+2*n+i)/i),a=e=>~~((e+n)/i);return a.invert=e=>e*i-n,a.bitmap=()=>function(e,t){const n=new Uint32Array(~~((e*t+32)/32));function i(e,t){n[e]|=t}function r(e,t){n[e]&=t}return{array:n,get:(t,i)=>{const r=i*e+t;return n[r>>>5]&1<<(r&jF)},set:(t,n)=>{const r=n*e+t;i(r>>>5,1<<(r&jF))},clear:(t,n)=>{const i=n*e+t;r(i>>>5,~(1<<(i&jF)))},getRange:(t,i,r,s)=>{let a,o,u,l,c=s;for(;c>=i;--c)if(a=c*e+t,o=c*e+r,u=a>>>5,l=o>>>5,u===l){if(n[u]&UF[a&jF]&WF[1+(o&jF)])return!0}else{if(n[u]&UF[a&jF])return!0;if(n[l]&WF[1+(o&jF)])return!0;for(let e=u+1;e<l;++e)if(n[e])return!0}return!1},setRange:(t,n,r,s)=>{let a,o,u,l,c;for(;n<=s;++n)if(a=n*e+t,o=n*e+r,u=a>>>5,l=o>>>5,u===l)i(u,UF[a&jF]&WF[1+(o&jF)]);else for(i(u,UF[a&jF]),i(l,WF[1+(o&jF)]),c=u+1;c<l;++c)i(c,4294967295)},clearRange:(t,n,i,s)=>{let a,o,u,l,c;for(;n<=s;++n)if(a=n*e+t,o=n*e+i,u=a>>>5,l=o>>>5,u===l)r(u,WF[a&jF]|UF[1+(o&jF)]);else for(r(u,WF[a&jF]),r(l,UF[1+(o&jF)]),c=u+1;c<l;++c)r(c,0)},outOfBounds:(n,i,r,s)=>n<0||i<0||s>=t||r>=e}}(r,s),a.ratio=i,a.padding=n,a.width=e,a.height=t,a}(t[0],t[1],l),b=g&&"naive"===c;var x;const w=e.map((e=>({datum:e,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(e)})));let C;if(!b){n&&w.sort(((e,t)=>n(e.datum,t.datum)));let t=!1;for(let e=0;e<f.length&&!t;++e)t=5===f[e]||h[e]<0;p&&(a||g)&&(s=[e.map((e=>e.datum))].concat(s)),C=s.length?zF(v,s,t,g):function(e,t){const n=e.bitmap();return(t||[]).forEach((t=>n.set(e(t.boundary[0]),e(t.boundary[3])))),[n,void 0]}(v,a&&w)}const k=g?ZF[c](v,C,a,u):function(e,t,n,i){const r=e.width,s=e.height,a=t[0],o=t[1],u=i.length;return function(t){const l=t.boundary,c=t.datum.fontSize;if(l[2]<0||l[5]<0||l[0]>r||l[3]>s)return!1;let d,h,f,p,m,g,y,v,b,x,w,C,k,A,_,E=0;for(let r=0;r<u;++r){if(d=(3&n[r])-1,h=(n[r]>>>2&3)-1,f=0===d&&0===h||i[r]<0,p=d&&h?Math.SQRT1_2:1,m=i[r]<0?-1:1,g=l[1+d]+i[r]*d*p,w=l[4+h]+m*c*h/2+i[r]*h*p,v=w-c/2,b=w+c/2,C=e(g),A=e(v),_=e(b),!E){if(!KF(C,C,A,_,a,o,g,g,v,b,l,f))continue;E=ob.width(t.datum,t.datum.text)}if(x=g+m*E*d/2,g=x-E/2,y=x+E/2,C=e(g),k=e(y),KF(C,k,A,_,a,o,g,y,v,b,l,f))return t.x=d?d*m<0?y:g:x,t.y=h?h*m<0?b:v:w,t.align=XF[d*m+1],t.baseline=YF[h*m+1],a.setRange(C,A,k,_),!0}return!1}}(v,C,f,h);return w.forEach((e=>e.opacity=+k(e))),w}const eD=["x","y","opacity","align","baseline"],tD=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function nD(e){$u.call(this,null,e)}function iD(e,t){var n,i,r,s,a,o,u=[],l=function(e){return e(s)};if(null==t)u.push(e);else for(n={},i=0,r=e.length;i<r;++i)s=e[i],(o=n[a=t.map(l)])||(n[a]=o=[],o.dims=a,u.push(o)),o.push(s);return u}function rD(e){$u.call(this,null,e)}nD.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:tD},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:eD.length,default:eD}]},On(nD,$u,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(n){const i=e.sort;return yn(i)&&t.modified(i.fields)}()))return;e.size&&2===e.size.length||Pt("Size parameter should be specified as a [width, height] array.");const i=e.as||eD;return QF(t.materialize(t.SOURCE).source,e.size,e.sort,gn(e.offset||1),gn(e.anchor||tD),e.avoidMarks||[],!1!==e.avoidBaseMark,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach((e=>{const t=e.datum;t[i[0]]=e.x,t[i[1]]=e.y,t[i[2]]=e.opacity,t[i[3]]=e.align,t[i[4]]=e.baseline})),t.reflow(n).modifies(i)}}),rD.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},On(rD,$u,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=iD(t.materialize(t.SOURCE).source,e.groupby),r=(e.groupby||[]).map(Rt),s=r.length,a=e.as||[Rt(e.x),Rt(e.y)],o=[];i.forEach((t=>{$l(t,e.x,e.y,e.bandwidth||.3).forEach((e=>{const n={};for(let e=0;e<s;++e)n[r[e]]=t.dims[e];n[a[0]]=e[0],n[a[1]]=e[1],o.push(eu(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=o}return n}});const sD={linear:kl,log:Al,exp:_l,pow:El,quad:Sl,poly:Fl};function aD(e){$u.call(this,null,e)}aD.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(sD)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},On(aD,$u,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=iD(t.materialize(t.SOURCE).source,e.groupby),r=(e.groupby||[]).map(Rt),s=e.method||"linear",a=e.order||3,o=((e,t)=>"poly"===e?t:"quad"===e?2:1)(s,a),u=e.as||[Rt(e.x),Rt(e.y)],l=sD[s],c=[];let d=e.extent;Fn(sD,s)||Pt("Invalid regression method: "+s),null!=d&&"log"===s&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),i.forEach((n=>{if(n.length<=o)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const i=l(n,e.x,e.y,a);if(e.params)return void c.push(eu({keys:n.dims,coef:i.coef,rSquared:i.rSquared}));const h=d||En(n,e.x),f=e=>{const t={};for(let e=0;e<r.length;++e)t[r[e]]=n.dims[e];t[u[0]]=e[0],t[u[1]]=e[1],c.push(eu(t))};"linear"===s?h.forEach((e=>f([e,i.predict(e)]))):Tl(i.predict,h,25,200).forEach(f)})),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});const oD=Math.pow(2,-52),uD=new Uint32Array(512);class lD{static from(e,t=yD,n=vD){const i=e.length,r=new Float64Array(2*i);for(let s=0;s<i;s++){const i=e[s];r[2*s]=t(i),r[2*s+1]=n(i)}return new lD(r)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:i,_hullHash:r}=this,s=e.length>>1;let a=1/0,o=1/0,u=-1/0,l=-1/0;for(let t=0;t<s;t++){const n=e[2*t],i=e[2*t+1];n<a&&(a=n),i<o&&(o=i),n>u&&(u=n),i>l&&(l=i),this._ids[t]=t}const c=(a+u)/2,d=(o+l)/2;let h,f,p,m=1/0;for(let t=0;t<s;t++){const n=cD(c,d,e[2*t],e[2*t+1]);n<m&&(h=t,m=n)}const g=e[2*h],y=e[2*h+1];m=1/0;for(let t=0;t<s;t++){if(t===h)continue;const n=cD(g,y,e[2*t],e[2*t+1]);n<m&&n>0&&(f=t,m=n)}let v=e[2*f],b=e[2*f+1],x=1/0;for(let t=0;t<s;t++){if(t===h||t===f)continue;const n=pD(g,y,v,b,e[2*t],e[2*t+1]);n<x&&(p=t,x=n)}let w=e[2*p],C=e[2*p+1];if(x===1/0){for(let t=0;t<s;t++)this._dists[t]=e[2*t]-e[0]||e[2*t+1]-e[1];mD(this._ids,this._dists,0,s-1);const t=new Uint32Array(s);let n=0;for(let e=0,i=-1/0;e<s;e++){const r=this._ids[e];this._dists[r]>i&&(t[n++]=r,i=this._dists[r])}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(hD(g,y,v,b,w,C)){const e=f,t=v,n=b;f=p,v=w,b=C,p=e,w=t,C=n}const k=function(e,t,n,i,r,s){const a=n-e,o=i-t,u=r-e,l=s-t,c=a*a+o*o,d=u*u+l*l,h=.5/(a*l-o*u);return{x:e+(l*c-o*d)*h,y:t+(a*d-u*c)*h}}(g,y,v,b,w,C);this._cx=k.x,this._cy=k.y;for(let t=0;t<s;t++)this._dists[t]=cD(e[2*t],e[2*t+1],k.x,k.y);mD(this._ids,this._dists,0,s-1),this._hullStart=h;let A=3;n[h]=t[p]=f,n[f]=t[h]=p,n[p]=t[f]=h,i[h]=0,i[f]=1,i[p]=2,r.fill(-1),r[this._hashKey(g,y)]=h,r[this._hashKey(v,b)]=f,r[this._hashKey(w,C)]=p,this.trianglesLen=0,this._addTriangle(h,f,p,-1,-1,-1);for(let s,a,o=0;o<this._ids.length;o++){const u=this._ids[o],l=e[2*u],c=e[2*u+1];if(o>0&&Math.abs(l-s)<=oD&&Math.abs(c-a)<=oD)continue;if(s=l,a=c,u===h||u===f||u===p)continue;let d=0;for(let e=0,t=this._hashKey(l,c);e<this._hashSize&&(d=r[(t+e)%this._hashSize],-1===d||d===n[d]);e++);d=t[d];let m,g=d;for(;m=n[g],!hD(l,c,e[2*g],e[2*g+1],e[2*m],e[2*m+1]);)if(g=m,g===d){g=-1;break}if(-1===g)continue;let y=this._addTriangle(g,u,n[g],-1,-1,i[g]);i[u]=this._legalize(y+2),i[g]=y,A++;let v=n[g];for(;m=n[v],hD(l,c,e[2*v],e[2*v+1],e[2*m],e[2*m+1]);)y=this._addTriangle(v,u,m,i[u],-1,i[v]),i[u]=this._legalize(y+2),n[v]=v,A--,v=m;if(g===d)for(;m=t[g],hD(l,c,e[2*m],e[2*m+1],e[2*g],e[2*g+1]);)y=this._addTriangle(m,u,g,-1,i[g],i[m]),this._legalize(y+2),i[m]=y,n[g]=g,A--,g=m;this._hullStart=t[u]=g,n[g]=t[v]=u,n[u]=v,r[this._hashKey(l,c)]=u,r[this._hashKey(e[2*g],e[2*g+1])]=g}this.hull=new Uint32Array(A);for(let e=0,t=this._hullStart;e<A;e++)this.hull[e]=t,t=n[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:i}=this;let r=0,s=0;for(;;){const a=n[e],o=e-e%3;if(s=o+(e+2)%3,-1===a){if(0===r)break;e=uD[--r];continue}const u=a-a%3,l=o+(e+1)%3,c=u+(a+2)%3,d=t[s],h=t[e],f=t[l],p=t[c];if(fD(i[2*d],i[2*d+1],i[2*h],i[2*h+1],i[2*f],i[2*f+1],i[2*p],i[2*p+1])){t[e]=p,t[a]=d;const i=n[c];if(-1===i){let t=this._hullStart;do{if(this._hullTri[t]===c){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,i),this._link(a,n[s]),this._link(s,c);const o=u+(a+1)%3;r<uD.length&&(uD[r++]=o)}else{if(0===r)break;e=uD[--r]}}return s}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,i,r,s){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=n,this._link(a,i),this._link(a+1,r),this._link(a+2,s),this.trianglesLen+=3,a}}function cD(e,t,n,i){const r=e-n,s=t-i;return r*r+s*s}function dD(e,t,n,i,r,s){const a=(i-t)*(r-e),o=(n-e)*(s-t);return Math.abs(a-o)>=33306690738754716e-32*Math.abs(a+o)?a-o:0}function hD(e,t,n,i,r,s){return(dD(r,s,e,t,n,i)||dD(e,t,n,i,r,s)||dD(n,i,r,s,e,t))<0}function fD(e,t,n,i,r,s,a,o){const u=e-a,l=t-o,c=n-a,d=i-o,h=r-a,f=s-o,p=c*c+d*d,m=h*h+f*f;return u*(d*m-p*f)-l*(c*m-p*h)+(u*u+l*l)*(c*f-d*h)<0}function pD(e,t,n,i,r,s){const a=n-e,o=i-t,u=r-e,l=s-t,c=a*a+o*o,d=u*u+l*l,h=.5/(a*l-o*u),f=(l*c-o*d)*h,p=(a*d-u*c)*h;return f*f+p*p}function mD(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const i=e[r],s=t[i];let a=r-1;for(;a>=n&&t[e[a]]>s;)e[a+1]=e[a--];e[a+1]=i}else{let r=n+1,s=i;gD(e,n+i>>1,r),t[e[n]]>t[e[i]]&&gD(e,n,i),t[e[r]]>t[e[i]]&&gD(e,r,i),t[e[n]]>t[e[r]]&&gD(e,n,r);const a=e[r],o=t[a];for(;;){do{r++}while(t[e[r]]<o);do{s--}while(t[e[s]]>o);if(s<r)break;gD(e,r,s)}e[n+1]=e[s],e[s]=a,i-r+1>=s-n?(mD(e,t,r,i),mD(e,t,n,s-1)):(mD(e,t,n,s-1),mD(e,t,r,i))}}function gD(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function yD(e){return e[0]}function vD(e){return e[1]}const bD=1e-6;class xD{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){const i=(e=+e)+(n=+n),r=t=+t;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${i},${r}`:(Math.abs(this._x1-i)>bD||Math.abs(this._y1-r)>bD)&&(this._+="L"+i+","+r),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=i},${this._y1=r}`)}rect(e,t,n,i){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+i}h${-n}Z`}value(){return this._||null}}class wD{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class CD{constructor(e,[t,n,i,r]=[0,0,960,500]){if(!((i=+i)>=(t=+t)&&(r=+r)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=i,this.xmin=t,this.ymax=r,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:i}=this,r=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let t,i,s=0,a=0,o=n.length;s<o;s+=3,a+=2){const o=2*n[s],u=2*n[s+1],l=2*n[s+2],c=e[o],d=e[o+1],h=e[u],f=e[u+1],p=e[l],m=e[l+1],g=h-c,y=f-d,v=p-c,b=m-d,x=g*g+y*y,w=v*v+b*b,C=2*(g*b-y*v);if(C)if(Math.abs(C)<1e-8)t=(c+p)/2,i=(d+m)/2;else{const e=1/C;t=c+(b*x-y*w)*e,i=d+(g*w-v*x)*e}else t=(c+p)/2-1e8*b,i=(d+m)/2+1e8*v;r[a]=t,r[a+1]=i}let s,a,o,u=t[t.length-1],l=4*u,c=e[2*u],d=e[2*u+1];i.fill(0);for(let n=0;n<t.length;++n)u=t[n],s=l,a=c,o=d,l=4*u,c=e[2*u],d=e[2*u+1],i[s+2]=i[l]=o-d,i[s+3]=i[l+1]=c-a}render(e){const t=null==e?e=new xD:void 0,{delaunay:{halfedges:n,inedges:i,hull:r},circumcenters:s,vectors:a}=this;if(r.length<=1)return null;for(let t=0,i=n.length;t<i;++t){const i=n[t];if(i<t)continue;const r=2*Math.floor(t/3),a=2*Math.floor(i/3),o=s[r],u=s[r+1],l=s[a],c=s[a+1];this._renderSegment(o,u,l,c,e)}let o,u=r[r.length-1];for(let t=0;t<r.length;++t){o=u,u=r[t];const n=2*Math.floor(i[u]/3),l=s[n],c=s[n+1],d=4*o,h=this._project(l,c,a[d+2],a[d+3]);h&&this._renderSegment(l,c,h[0],h[1],e)}return t&&t.value()}renderBounds(e){const t=null==e?e=new xD:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=null==t?t=new xD:void 0,i=this._clip(e);if(null===i||!i.length)return;t.moveTo(i[0],i[1]);let r=i.length;for(;i[0]===i[r-2]&&i[1]===i[r-1]&&r>1;)r-=2;for(let e=2;e<r;e+=2)i[e]===i[e-2]&&i[e+1]===i[e-1]||t.lineTo(i[e],i[e+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){const t=new wD;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,i,r){let s;const a=this._regioncode(e,t),o=this._regioncode(n,i);0===a&&0===o?(r.moveTo(e,t),r.lineTo(n,i)):(s=this._clipSegment(e,t,n,i,a,o))&&(r.moveTo(s[0],s[1]),r.lineTo(s[2],s[3]))}contains(e,t,n){return(t=+t)==t&&(n=+n)==n&&this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const e=this._clip(n);if(e)e:for(let i=0,r=t.length;i<r;i+=2)for(let s=0,a=e.length;s<a;s+=2)if(t[i]==e[s]&&t[i+1]==e[s+1]&&t[(i+2)%r]==e[(s+a-2)%a]&&t[(i+3)%r]==e[(s+a-1)%a]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:i,triangles:r}}=this,s=n[e];if(-1===s)return null;const a=[];let o=s;do{const n=Math.floor(o/3);if(a.push(t[2*n],t[2*n+1]),o=o%3==2?o-2:o+1,r[o]!==e)break;o=i[o]}while(o!==s&&-1!==o);return a}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(null===t)return null;const{vectors:n}=this,i=4*e;return n[i]||n[i+1]?this._clipInfinite(e,t,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let i,r,s,a,o,u=null,l=t[n-2],c=t[n-1],d=this._regioncode(l,c);for(let h=0;h<n;h+=2)if(i=l,r=c,l=t[h],c=t[h+1],s=d,d=this._regioncode(l,c),0===s&&0===d)a=o,o=0,u?u.push(l,c):u=[l,c];else{let t,n,h,f,p;if(0===s){if(null===(t=this._clipSegment(i,r,l,c,s,d)))continue;[n,h,f,p]=t}else{if(null===(t=this._clipSegment(l,c,i,r,d,s)))continue;[f,p,n,h]=t,a=o,o=this._edgecode(n,h),a&&o&&this._edge(e,a,o,u,u.length),u?u.push(n,h):u=[n,h]}a=o,o=this._edgecode(f,p),a&&o&&this._edge(e,a,o,u,u.length),u?u.push(f,p):u=[f,p]}if(u)a=o,o=this._edgecode(u[0],u[1]),a&&o&&this._edge(e,a,o,u,u.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return u}_clipSegment(e,t,n,i,r,s){for(;;){if(0===r&&0===s)return[e,t,n,i];if(r&s)return null;let a,o,u=r||s;8&u?(a=e+(n-e)*(this.ymax-t)/(i-t),o=this.ymax):4&u?(a=e+(n-e)*(this.ymin-t)/(i-t),o=this.ymin):2&u?(o=t+(i-t)*(this.xmax-e)/(n-e),a=this.xmax):(o=t+(i-t)*(this.xmin-e)/(n-e),a=this.xmin),r?(e=a,t=o,r=this._regioncode(e,t)):(n=a,i=o,s=this._regioncode(n,i))}}_clipInfinite(e,t,n,i,r,s){let a,o=Array.from(t);if((a=this._project(o[0],o[1],n,i))&&o.unshift(a[0],a[1]),(a=this._project(o[o.length-2],o[o.length-1],r,s))&&o.push(a[0],a[1]),o=this._clipFinite(e,o))for(let t,n=0,i=o.length,r=this._edgecode(o[i-2],o[i-1]);n<i;n+=2)t=r,r=this._edgecode(o[n],o[n+1]),t&&r&&(n=this._edge(e,t,r,o,n),i=o.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(e,t,n,i,r){for(;t!==n;){let n,s;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,s=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,s=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,s=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,s=this.ymin}i[r]===n&&i[r+1]===s||!this.contains(e,n,s)||(i.splice(r,0,n,s),r+=2)}if(i.length>4)for(let e=0;e<i.length;e+=2){const t=(e+2)%i.length,n=(e+4)%i.length;(i[e]===i[t]&&i[t]===i[n]||i[e+1]===i[t+1]&&i[t+1]===i[n+1])&&(i.splice(t,2),e-=2)}return r}_project(e,t,n,i){let r,s,a,o=1/0;if(i<0){if(t<=this.ymin)return null;(r=(this.ymin-t)/i)<o&&(a=this.ymin,s=e+(o=r)*n)}else if(i>0){if(t>=this.ymax)return null;(r=(this.ymax-t)/i)<o&&(a=this.ymax,s=e+(o=r)*n)}if(n>0){if(e>=this.xmax)return null;(r=(this.xmax-e)/n)<o&&(s=this.xmax,a=t+(o=r)*i)}else if(n<0){if(e<=this.xmin)return null;(r=(this.xmin-e)/n)<o&&(s=this.xmin,a=t+(o=r)*i)}return[s,a]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const kD=2*Math.PI,AD=Math.pow;function _D(e){return e[0]}function ED(e){return e[1]}function SD(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class FD{static from(e,t=_D,n=ED,i){return new FD("length"in e?function(e,t,n,i){const r=e.length,s=new Float64Array(2*r);for(let a=0;a<r;++a){const r=e[a];s[2*a]=t.call(i,r,a,e),s[2*a+1]=n.call(i,r,a,e)}return s}(e,t,n,i):Float64Array.from(function*(e,t,n,i){let r=0;for(const s of e)yield t.call(i,s,r,e),yield n.call(i,s,r,e),++r}(e,t,n,i)))}constructor(e){this._delaunator=new lD(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){const{triangles:t,coords:n}=e;for(let e=0;e<t.length;e+=3){const i=2*t[e],r=2*t[e+1],s=2*t[e+2];if((n[s]-n[i])*(n[r+1]-n[i+1])-(n[r]-n[i])*(n[s+1]-n[i+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},((e,t)=>t)).sort(((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]));const e=this.collinear[0],n=this.collinear[this.collinear.length-1],i=[t[2*e],t[2*e+1],t[2*n],t[2*n+1]],r=1e-8*Math.hypot(i[3]-i[1],i[2]-i[0]);for(let e=0,n=t.length/2;e<n;++e){const n=SD(t[2*e],t[2*e+1],r);t[2*e]=n[0],t[2*e+1]=n[1]}this._delaunator=new lD(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,r=this.triangles=this._delaunator.triangles,s=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let e=0,t=n.length;e<t;++e){const t=r[e%3==2?e-2:e+1];-1!==n[e]&&-1!==s[t]||(s[t]=e)}for(let e=0,t=i.length;e<t;++e)a[i[e]]=e;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],s[i[0]]=1,2===i.length&&(s[i[1]]=0))}voronoi(e){return new CD(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:i,halfedges:r,triangles:s,collinear:a}=this;if(a){const t=a.indexOf(e);return t>0&&(yield a[t-1]),void(t<a.length-1&&(yield a[t+1]))}const o=t[e];if(-1===o)return;let u=o,l=-1;do{if(yield l=s[u],u=u%3==2?u-2:u+1,s[u]!==e)return;if(u=r[u],-1===u){const t=n[(i[e]+1)%n.length];return void(t!==l&&(yield t))}}while(u!==o)}find(e,t,n=0){if((e=+e)!=e||(t=+t)!=t)return-1;const i=n;let r;for(;(r=this._step(n,e,t))>=0&&r!==n&&r!==i;)n=r;return r}_step(e,t,n){const{inedges:i,hull:r,_hullIndex:s,halfedges:a,triangles:o,points:u}=this;if(-1===i[e]||!u.length)return(e+1)%(u.length>>1);let l=e,c=AD(t-u[2*e],2)+AD(n-u[2*e+1],2);const d=i[e];let h=d;do{let i=o[h];const d=AD(t-u[2*i],2)+AD(n-u[2*i+1],2);if(d<c&&(c=d,l=i),h=h%3==2?h-2:h+1,o[h]!==e)break;if(h=a[h],-1===h){if(h=r[(s[e]+1)%r.length],h!==i&&AD(t-u[2*h],2)+AD(n-u[2*h+1],2)<c)return h;break}}while(h!==d);return l}render(e){const t=null==e?e=new xD:void 0,{points:n,halfedges:i,triangles:r}=this;for(let t=0,s=i.length;t<s;++t){const s=i[t];if(s<t)continue;const a=2*r[t],o=2*r[s];e.moveTo(n[a],n[a+1]),e.lineTo(n[o],n[o+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=null==e?e=new xD:void 0,{points:i}=this;for(let n=0,r=i.length;n<r;n+=2){const r=i[n],s=i[n+1];e.moveTo(r+t,s),e.arc(r,s,t,0,kD)}return n&&n.value()}renderHull(e){const t=null==e?e=new xD:void 0,{hull:n,points:i}=this,r=2*n[0],s=n.length;e.moveTo(i[r],i[r+1]);for(let t=1;t<s;++t){const r=2*n[t];e.lineTo(i[r],i[r+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new wD;return this.renderHull(e),e.value()}renderTriangle(e,t){const n=null==t?t=new xD:void 0,{points:i,triangles:r}=this,s=2*r[e*=3],a=2*r[e+1],o=2*r[e+2];return t.moveTo(i[s],i[s+1]),t.lineTo(i[a],i[a+1]),t.lineTo(i[o],i[o+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new wD;return this.renderTriangle(e,t),t.value()}}function DD(e){$u.call(this,null,e)}DD.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const $D=[-1e5,-1e5,1e5,1e5];function OD(e){const t=e[0][0],n=e[0][1];let i=e.length-1;for(;e[i][0]===t&&e[i][1]===n;--i);return"M"+e.slice(0,i+1).join("L")+"Z"}On(DD,$u,{transform(e,t){const n=e.as||"path",i=t.source;if(!i||!i.length)return t;let r=e.size;r=r?[0,0,r[0],r[1]]:(r=e.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:$D;const s=this.value=FD.from(i,e.x,e.y).voronoi(r);for(let e=0,t=i.length;e<t;++e){const t=s.cellPolygon(e);i[e][n]=t?OD(t):null}return t.reflow(e.modified()).modifies(n)}});var ND=Math.PI/180,ID=2048;function TD(e,t,n,i){if(!t.sprite){var r=e.context,s=e.ratio;r.clearRect(0,0,2048/s,ID/s);var a,o,u,l,c,d=0,h=0,f=0,p=n.length;for(--i;++i<p;){if(t=n[i],r.save(),r.font=t.style+" "+t.weight+" "+~~((t.size+1)/s)+"px "+t.font,a=r.measureText(t.text+"m").width*s,u=t.size<<1,t.rotate){var m=Math.sin(t.rotate*ND),g=Math.cos(t.rotate*ND),y=a*g,v=a*m,b=u*g,x=u*m;a=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,u=~~Math.max(Math.abs(v+b),Math.abs(v-b))}else a=a+31>>5<<5;if(u>f&&(f=u),d+a>=2048&&(d=0,h+=f,f=0),h+u>=ID)break;r.translate((d+(a>>1))/s,(h+(u>>1))/s),t.rotate&&r.rotate(t.rotate*ND),r.fillText(t.text,0,0),t.padding&&(r.lineWidth=2*t.padding,r.strokeText(t.text,0,0)),r.restore(),t.width=a,t.height=u,t.xoff=d,t.yoff=h,t.x1=a>>1,t.y1=u>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,d+=a}for(var w=r.getImageData(0,0,2048/s,ID/s).data,C=[];--i>=0;)if((t=n[i]).hasText){for(o=(a=t.width)>>5,u=t.y1-t.y0,l=0;l<u*o;l++)C[l]=0;if(null==(d=t.xoff))return;h=t.yoff;var k=0,A=-1;for(c=0;c<u;c++){for(l=0;l<a;l++){var _=o*c+(l>>5),E=w[2048*(h+c)+(d+l)<<2]?1<<31-l%32:0;C[_]|=E,k|=E}k?A=c:(t.y0++,u--,c--,h++)}t.y1=t.y0+A,t.sprite=C.slice(0,(t.y1-t.y0)*o)}}}function RD(e,t,n){n>>=5;for(var i,r=e.sprite,s=e.width>>5,a=e.x-(s<<4),o=127&a,u=32-o,l=e.y1-e.y0,c=(e.y+e.y0)*n+(a>>5),d=0;d<l;d++){i=0;for(var h=0;h<=s;h++)if((i<<u|(h<s?(i=r[d*s+h])>>>o:0))&t[c+h])return!0;c+=n}return!1}function MD(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function BD(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function zD(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function LD(e){return"function"==typeof e?e:function(){return e}}var PD={archimedean:zD,rectangular:function(e){var t=4*e[0]/e[1],n=0,i=0;return function(e){var r=e<0?-1:1;switch(Math.sqrt(1+4*r*e)-r&3){case 0:n+=t;break;case 1:i+=4;break;case 2:n-=t;break;default:i-=4}return[n,i]}}};const jD=["x","y","font","fontSize","fontStyle","fontWeight","angle"],UD=["text","font","rotate","fontSize","fontStyle","fontWeight"];function WD(e){$u.call(this,function(){var e,t,n,i,r,s,a,o=[256,256],u=zD,l=[],c=Math.random,d={};function h(e,t,n){for(var i,r,s,a=t.x,l=t.y,d=Math.sqrt(o[0]*o[0]+o[1]*o[1]),h=u(o),f=c()<.5?1:-1,p=-f;(i=h(p+=f))&&(r=~~i[0],s=~~i[1],!(Math.min(Math.abs(r),Math.abs(s))>=d));)if(t.x=a+r,t.y=l+s,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>o[0]||t.y+t.y1>o[1])&&(!n||!RD(t,e,o[0]))&&(!n||BD(t,n))){for(var m,g=t.sprite,y=t.width>>5,v=o[0]>>5,b=t.x-(y<<4),x=127&b,w=32-x,C=t.y1-t.y0,k=(t.y+t.y0)*v+(b>>5),A=0;A<C;A++){m=0;for(var _=0;_<=y;_++)e[k+_]|=m<<w|(_<y?(m=g[A*y+_])>>>x:0);k+=v}return t.sprite=null,!0}return!1}return d.layout=function(){for(var u=function(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=2048/t,e.height=ID/t;var n=e.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:t}}(Ch()),d=function(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}((o[0]>>5)*o[1]),f=null,p=l.length,m=-1,g=[],y=l.map((o=>({text:e(o),font:t(o),style:i(o),weight:r(o),rotate:s(o),size:~~(n(o)+1e-14),padding:a(o),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:o}))).sort(((e,t)=>t.size-e.size));++m<p;){var v=y[m];v.x=o[0]*(c()+.5)>>1,v.y=o[1]*(c()+.5)>>1,TD(u,v,y,m),v.hasText&&h(d,v,f)&&(g.push(v),f?MD(f,v):f=[{x:v.x+v.x0,y:v.y+v.y0},{x:v.x+v.x1,y:v.y+v.y1}],v.x-=o[0]>>1,v.y-=o[1]>>1)}return g},d.words=function(e){return arguments.length?(l=e,d):l},d.size=function(e){return arguments.length?(o=[+e[0],+e[1]],d):o},d.font=function(e){return arguments.length?(t=LD(e),d):t},d.fontStyle=function(e){return arguments.length?(i=LD(e),d):i},d.fontWeight=function(e){return arguments.length?(r=LD(e),d):r},d.rotate=function(e){return arguments.length?(s=LD(e),d):s},d.text=function(t){return arguments.length?(e=LD(t),d):e},d.spiral=function(e){return arguments.length?(u=PD[e]||e,d):u},d.fontSize=function(e){return arguments.length?(n=LD(e),d):n},d.padding=function(e){return arguments.length?(a=LD(e),d):a},d.random=function(e){return arguments.length?(c=e,d):c},d}(),e)}WD.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:jD}]},On(WD,$u,{transform(e,t){!e.size||e.size[0]&&e.size[1]||Pt("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||UD.some((function(n){const i=e[n];return yn(i)&&t.modified(i.fields)}))))return;const i=t.materialize(t.SOURCE).source,r=this.value,s=e.as||jD;let a,o=e.fontSize||14;if(yn(o)?a=e.fontSizeRange:o=kn(o),a){const e=o,t=Xm("sqrt")().domain(En(i,e)).range(a);o=n=>t(e(n))}i.forEach((e=>{e[s[0]]=NaN,e[s[1]]=NaN,e[s[3]]=0}));const u=r.words(i).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(o).random(Hu).layout(),l=r.size(),c=l[0]>>1,d=l[1]>>1,h=u.length;for(let e,t,n=0;n<h;++n)e=u[n],t=e.datum,t[s[0]]=e.x+c,t[s[1]]=e.y+d,t[s[2]]=e.font,t[s[3]]=e.size,t[s[4]]=e.style,t[s[5]]=e.weight,t[s[6]]=e.rotate;return t.reflow(n).modifies(s)}});const VD=e=>new Uint8Array(e),qD=e=>new Uint16Array(e),GD=e=>new Uint32Array(e);function HD(e,t,n){const i=(t<257?VD:t<65537?qD:GD)(e);return n&&i.set(n),i}function XD(e,t,n){const i=1<<t;return{one:i,zero:~i,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(e,t){const n=this,r=n.bisect(n.range,e.value),s=e.index,a=r[0],o=r[1],u=s.length;let l;for(l=0;l<a;++l)t[s[l]]|=i;for(l=o;l<u;++l)t[s[l]]|=i;return n}}}function YD(){let e=GD(0),t=[],n=0;return{insert:function(i,r,s){if(!r.length)return[];const a=n,o=r.length,u=GD(o);let l,c,d,h=Array(o);for(d=0;d<o;++d)h[d]=i(r[d]),u[d]=d;if(h=function(e,t){return e.sort.call(t,((t,n)=>{const i=e[t],r=e[n];return i<r?-1:i>r?1:0})),function(e,t){return Array.from(t,(t=>e[t]))}(e,t)}(h,u),a)l=t,c=e,t=Array(a+o),e=GD(a+o),function(e,t,n,i,r,s,a,o,u){let l,c=0,d=0;for(l=0;c<i&&d<a;++l)t[c]<r[d]?(o[l]=t[c],u[l]=n[c++]):(o[l]=r[d],u[l]=s[d++]+e);for(;c<i;++c,++l)o[l]=t[c],u[l]=n[c];for(;d<a;++d,++l)o[l]=r[d],u[l]=s[d]+e}(s,l,c,a,h,u,o,t,e);else{if(s>0)for(d=0;d<o;++d)u[d]+=s;t=h,e=u}return n=a+o,{index:u,value:h}},remove:function(i,r){const s=n;let a,o,u;for(o=0;!r[e[o]]&&o<s;++o);for(u=o;o<s;++o)r[a=e[o]]||(e[u]=a,t[u]=t[o],++u);n=s-i},bisect:function(e,i){let r;return i?r=i.length:(i=t,r=n),[Eh(i,e[0],0,r),_h(i,e[1],0,r)]},reindex:function(t){for(let i=0,r=n;i<r;++i)e[i]=t[e[i]]},index:()=>e,size:()=>n}}function KD(e){$u.call(this,function(){let e=8,t=[],n=GD(0),i=HD(0,e),r=HD(0,e);return{data:()=>t,seen:()=>n=function(e,t,n){return e.length>=t?e:((n=n||new e.constructor(t)).set(e),n)}(n,t.length),add(e){for(let n,i=0,r=t.length,s=e.length;i<s;++i)n=e[i],n._index=r++,t.push(n)},remove(e,n){const s=t.length,a=Array(s-e),o=t;let u,l,c;for(l=0;!n[l]&&l<s;++l)a[l]=t[l],o[l]=l;for(c=l;l<s;++l)u=t[l],n[l]?o[l]=-1:(o[l]=c,i[c]=i[l],r[c]=r[l],a[c]=u,u._index=c++),i[l]=0;return t=a,o},size:()=>t.length,curr:()=>i,prev:()=>r,reset:e=>r[e]=i[e],all:()=>e<257?255:e<65537?65535:4294967295,set(e,t){i[e]|=t},clear(e,t){i[e]&=~t},resize(t,n){(t>i.length||n>e)&&(e=Math.max(n,e),i=HD(t,e,i),r=HD(t,e))}}}(),e),this._indices=null,this._dims=null}function JD(e){$u.call(this,null,e)}KD.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},On(KD,$u,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some((e=>t.modified(e.fields)))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,i=e.query,r=this._indices={},s=this._dims=[],a=i.length;let o,u,l=0;for(;l<a;++l)o=n[l].fname,u=r[o]||(r[o]=YD()),s.push(XD(u,l,i[l]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),i=e.fields,r=e.query,s=this._indices,a=this._dims,o=this.value,u=o.curr(),l=o.prev(),c=o.all(),d=n.rem=n.add,h=n.mod,f=r.length,p={};let m,g,y,v,b,x,w,C,k;if(l.set(u),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&o.add(t.add),t.mod.length)for(x={},v=t.mod,w=0,C=v.length;w<C;++w)x[v[w]._index]=1;for(w=0;w<f;++w)k=i[w],(!a[w]||e.modified("fields",w)||t.modified(k.fields))&&(y=k.fname,(m=p[y])||(s[y]=g=YD(),p[y]=m=g.insert(k,t.source,0)),a[w]=XD(g,w,r[w]).onAdd(m,u));for(w=0,C=o.data().length;w<C;++w)b[w]||(l[w]!==u[w]?d.push(w):x[w]&&u[w]!==c&&h.push(w));return o.mask=(1<<f)-1,n},eval(e,t){const n=t.materialize().fork(),i=this._dims.length;let r=0;return t.rem.length&&(this.remove(e,t,n),r|=(1<<i)-1),e.modified("query")&&!e.modified("fields")&&(r|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),r|=(1<<i)-1),t.mod.length&&(this.modify(t,n),r|=(1<<i)-1),this.value.mask=r,n},insert(e,t,n){const i=t.add,r=this.value,s=this._dims,a=this._indices,o=e.fields,u={},l=n.add,c=r.size()+i.length,d=s.length;let h,f,p,m=r.size();r.resize(c,d),r.add(i);const g=r.curr(),y=r.prev(),v=r.all();for(h=0;h<d;++h)f=o[h].fname,p=u[f]||(u[f]=a[f].insert(o[h],i,m)),s[h].onAdd(p,g);for(;m<c;++m)y[m]=v,g[m]!==v&&l.push(m)},modify(e,t){const n=t.mod,i=this.value,r=i.curr(),s=i.all(),a=e.mod;let o,u,l;for(o=0,u=a.length;o<u;++o)l=a[o]._index,r[l]!==s&&n.push(l)},remove(e,t,n){const i=this._indices,r=this.value,s=r.curr(),a=r.prev(),o=r.all(),u={},l=n.rem,c=t.rem;let d,h,f,p;for(d=0,h=c.length;d<h;++d)f=c[d]._index,u[f]=1,a[f]=p=s[f],s[f]=o,p!==o&&l.push(f);for(f in i)i[f].remove(h,u);return this.reindex(t,h,u),u},reindex(e,t,n){const i=this._indices,r=this.value;e.runAfter((()=>{const e=r.remove(t,n);for(const t in i)i[t].reindex(e)}))},update(e,t,n){const i=this._dims,r=e.query,s=t.stamp,a=i.length;let o,u,l=0;for(n.filters=0,u=0;u<a;++u)e.modified("query",u)&&(o=u,++l);if(1===l)l=i[o].one,this.incrementOne(i[o],r[o],n.add,n.rem);else for(u=0,l=0;u<a;++u)e.modified("query",u)&&(l|=i[u].one,this.incrementAll(i[u],r[u],s,n.add),n.rem=n.add);return l},incrementAll(e,t,n,i){const r=this.value,s=r.seen(),a=r.curr(),o=r.prev(),u=e.index(),l=e.bisect(e.range),c=e.bisect(t),d=c[0],h=c[1],f=l[0],p=l[1],m=e.one;let g,y,v;if(d<f)for(g=d,y=Math.min(f,h);g<y;++g)v=u[g],s[v]!==n&&(o[v]=a[v],s[v]=n,i.push(v)),a[v]^=m;else if(d>f)for(g=f,y=Math.min(d,p);g<y;++g)v=u[g],s[v]!==n&&(o[v]=a[v],s[v]=n,i.push(v)),a[v]^=m;if(h>p)for(g=Math.max(d,p),y=h;g<y;++g)v=u[g],s[v]!==n&&(o[v]=a[v],s[v]=n,i.push(v)),a[v]^=m;else if(h<p)for(g=Math.max(f,h),y=p;g<y;++g)v=u[g],s[v]!==n&&(o[v]=a[v],s[v]=n,i.push(v)),a[v]^=m;e.range=t.slice()},incrementOne(e,t,n,i){const r=this.value.curr(),s=e.index(),a=e.bisect(e.range),o=e.bisect(t),u=o[0],l=o[1],c=a[0],d=a[1],h=e.one;let f,p,m;if(u<c)for(f=u,p=Math.min(c,l);f<p;++f)m=s[f],r[m]^=h,n.push(m);else if(u>c)for(f=c,p=Math.min(u,d);f<p;++f)m=s[f],r[m]^=h,i.push(m);if(l>d)for(f=Math.max(u,d),p=l;f<p;++f)m=s[f],r[m]^=h,n.push(m);else if(l<d)for(f=Math.max(c,l),p=d;f<p;++f)m=s[f],r[m]^=h,i.push(m);e.range=t.slice()}}),JD.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},On(JD,$u,{transform(e,t){const n=~(e.ignore||0),i=e.filter,r=i.mask;if(0==(r&n))return t.StopPropagation;const s=t.fork(t.ALL),a=i.data(),o=i.curr(),u=i.prev(),l=e=>o[e]&n?null:a[e];return s.filter(s.MOD,l),r&r-1?(s.filter(s.ADD,(e=>{const t=o[e]&n;return!t&&t^u[e]&n?a[e]:null})),s.filter(s.REM,(e=>{const t=o[e]&n;return!t||t^t^u[e]&n?null:a[e]}))):(s.filter(s.ADD,l),s.filter(s.REM,(e=>(o[e]&n)===r?a[e]:null))),s.filter(s.SOURCE,(e=>l(e._index)))}});const ZD="Literal",QD="CallExpression";function e$(e){this.type=e}var t$,n$,i$,r$,s$;e$.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case QD:return[e.callee].concat(e.arguments);case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];case"Identifier":case ZD:case"RawCode":default:return[]}}(this),n=0,i=t.length;n<i;++n)if(t[n].visit(e))return 1},(t$={})[1]="Boolean",t$[2]="<end>",t$[3]="Identifier",t$[4]="Keyword",t$[5]="Null",t$[6]="Numeric",t$[7]="Punctuator",t$[8]="String",t$[9]="RegularExpression";var a$="Identifier",o$="Unexpected token %0",u$="Invalid regular expression",l$="Invalid regular expression: missing /",c$="Octal literals are not allowed in strict mode.",d$="ILLEGAL",h$="Disabled.",f$=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),p$=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function m$(e,t){if(!e)throw new Error("ASSERT: "+t)}function g$(e){return e>=48&&e<=57}function y$(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function v$(e){return"01234567".indexOf(e)>=0}function b$(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function x$(e){return 10===e||13===e||8232===e||8233===e}function w$(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&f$.test(String.fromCharCode(e))}function C$(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&p$.test(String.fromCharCode(e))}const k$={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function A$(){for(;i$<r$;){const e=n$.charCodeAt(i$);if(!b$(e)&&!x$(e))break;++i$}}function _$(e){var t,n,i,r=0;for(n="u"===e?4:2,t=0;t<n;++t)i$<r$&&y$(n$[i$])?(i=n$[i$++],r=16*r+"0123456789abcdef".indexOf(i.toLowerCase())):L$({},o$,d$);return String.fromCharCode(r)}function E$(){var e,t,n,i;for(t=0,"}"===(e=n$[i$])&&L$({},o$,d$);i$<r$&&y$(e=n$[i$++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&L$({},o$,d$),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),i=56320+(t-65536&1023),String.fromCharCode(n,i))}function S$(){var e,t;for(e=n$.charCodeAt(i$++),t=String.fromCharCode(e),92===e&&(117!==n$.charCodeAt(i$)&&L$({},o$,d$),++i$,(e=_$("u"))&&"\\"!==e&&w$(e.charCodeAt(0))||L$({},o$,d$),t=e);i$<r$&&C$(e=n$.charCodeAt(i$));)++i$,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==n$.charCodeAt(i$)&&L$({},o$,d$),++i$,(e=_$("u"))&&"\\"!==e&&C$(e.charCodeAt(0))||L$({},o$,d$),t+=e);return t}function F$(){var e,t,n,i,r=i$,s=n$.charCodeAt(i$),a=n$[i$];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++i$,{type:7,value:String.fromCharCode(s),start:r,end:i$};default:if(61===(e=n$.charCodeAt(i$+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return i$+=2,{type:7,value:String.fromCharCode(s)+String.fromCharCode(e),start:r,end:i$};case 33:case 61:return i$+=2,61===n$.charCodeAt(i$)&&++i$,{type:7,value:n$.slice(r,i$),start:r,end:i$}}}return">>>="===(i=n$.substr(i$,4))?{type:7,value:i,start:r,end:i$+=4}:">>>"===(n=i.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:r,end:i$+=3}:a===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(a)>=0||"=>"===t?{type:7,value:t,start:r,end:i$+=2}:("//"===t&&L$({},o$,d$),"<>=!+-*%&|^/".indexOf(a)>=0?{type:7,value:a,start:r,end:++i$}:void L$({},o$,d$))}function D$(){var e,t,n;if(m$(g$((n=n$[i$]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=i$,e="","."!==n){if(e=n$[i$++],n=n$[i$],"0"===e){if("x"===n||"X"===n)return++i$,function(e){let t="";for(;i$<r$&&y$(n$[i$]);)t+=n$[i$++];return 0===t.length&&L$({},o$,d$),w$(n$.charCodeAt(i$))&&L$({},o$,d$),{type:6,value:parseInt("0x"+t,16),start:e,end:i$}}(t);if(v$(n))return function(e){let t="0"+n$[i$++];for(;i$<r$&&v$(n$[i$]);)t+=n$[i$++];return(w$(n$.charCodeAt(i$))||g$(n$.charCodeAt(i$)))&&L$({},o$,d$),{type:6,value:parseInt(t,8),octal:!0,start:e,end:i$}}(t);n&&g$(n.charCodeAt(0))&&L$({},o$,d$)}for(;g$(n$.charCodeAt(i$));)e+=n$[i$++];n=n$[i$]}if("."===n){for(e+=n$[i$++];g$(n$.charCodeAt(i$));)e+=n$[i$++];n=n$[i$]}if("e"===n||"E"===n)if(e+=n$[i$++],"+"!==(n=n$[i$])&&"-"!==n||(e+=n$[i$++]),g$(n$.charCodeAt(i$)))for(;g$(n$.charCodeAt(i$));)e+=n$[i$++];else L$({},o$,d$);return w$(n$.charCodeAt(i$))&&L$({},o$,d$),{type:6,value:parseFloat(e),start:t,end:i$}}function $$(){if(A$(),i$>=r$)return{type:2,start:i$,end:i$};const e=n$.charCodeAt(i$);return w$(e)?function(){var e,t;return e=i$,{type:1===(t=92===n$.charCodeAt(i$)?S$():function(){var e,t;for(e=i$++;i$<r$;){if(92===(t=n$.charCodeAt(i$)))return i$=e,S$();if(!C$(t))break;++i$}return n$.slice(e,i$)}()).length?3:k$.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:i$}}():40===e||41===e||59===e?F$():39===e||34===e?function(){var e,t,n,i,r="",s=!1;for(m$("'"===(e=n$[i$])||'"'===e,"String literal must starts with a quote"),t=i$,++i$;i$<r$;){if((n=n$[i$++])===e){e="";break}if("\\"===n)if((n=n$[i$++])&&x$(n.charCodeAt(0)))"\r"===n&&"\n"===n$[i$]&&++i$;else switch(n){case"u":case"x":"{"===n$[i$]?(++i$,r+=E$()):r+=_$(n);break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:v$(n)?(0!==(i="01234567".indexOf(n))&&(s=!0),i$<r$&&v$(n$[i$])&&(s=!0,i=8*i+"01234567".indexOf(n$[i$++]),"0123".indexOf(n)>=0&&i$<r$&&v$(n$[i$])&&(i=8*i+"01234567".indexOf(n$[i$++]))),r+=String.fromCharCode(i)):r+=n}else{if(x$(n.charCodeAt(0)))break;r+=n}}return""!==e&&L$({},o$,d$),{type:8,value:r,octal:s,start:t,end:i$}}():46===e?g$(n$.charCodeAt(i$+1))?D$():F$():g$(e)?D$():F$()}function O$(){const e=s$;return i$=e.end,s$=$$(),i$=e.end,e}function N$(){const e=i$;s$=$$(),i$=e}function I$(e,t,n){const i=new e$("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return i.operator=e,i.left=t,i.right=n,i}function T$(e,t){const n=new e$("CallExpression");return n.callee=e,n.arguments=t,n}function R$(e){const t=new e$(a$);return t.name=e,t}function M$(e){const t=new e$("Literal");return t.value=e.value,t.raw=n$.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function B$(e,t,n){const i=new e$("MemberExpression");return i.computed="["===e,i.object=t,i.property=n,i.computed||(n.member=!0),i}function z$(e,t,n){const i=new e$("Property");return i.key=t,i.value=n,i.kind=e,i}function L$(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,((e,t)=>(m$(t<i.length,"Message reference must be in range"),i[t])));throw(n=new Error(r)).index=i$,n.description=r,n}function P$(e){2===e.type&&L$(e,"Unexpected end of input"),6===e.type&&L$(e,"Unexpected number"),8===e.type&&L$(e,"Unexpected string"),3===e.type&&L$(e,"Unexpected identifier"),4===e.type&&L$(e,"Unexpected reserved word"),L$(e,o$,e.value)}function j$(e){const t=O$();7===t.type&&t.value===e||P$(t)}function U$(e){return 7===s$.type&&s$.value===e}function W$(e){return 4===s$.type&&s$.value===e}function V$(){i$=s$.start;const e=O$();return 8===e.type||6===e.type?(e.octal&&L$(e,c$),M$(e)):R$(e.value)}function q$(){var e,t,n;return i$=s$.start,3===(e=s$).type?(n=V$(),j$(":"),z$("init",n,Q$())):2!==e.type&&7!==e.type?(t=V$(),j$(":"),z$("init",t,Q$())):void P$(e)}const G$={if:1};function H$(){var e,t,n;if(U$("("))return function(){j$("(");const e=eO();return j$(")"),e}();if(U$("["))return function(){const e=[];for(i$=s$.start,j$("[");!U$("]");)U$(",")?(O$(),e.push(null)):(e.push(Q$()),U$("]")||j$(","));return O$(),function(e){const t=new e$("ArrayExpression");return t.elements=e,t}(e)}();if(U$("{"))return function(){var e,t,n=[],i={},r=String;for(i$=s$.start,j$("{");!U$("}");)t="$"+((e=q$()).key.type===a$?e.key.name:r(e.key.value)),Object.prototype.hasOwnProperty.call(i,t)?L$({},"Duplicate data property in object literal not allowed in strict mode"):i[t]=!0,n.push(e),U$("}")||j$(",");return j$("}"),function(e){const t=new e$("ObjectExpression");return t.properties=e,t}(n)}();if(e=s$.type,i$=s$.start,3===e||G$[s$.value])n=R$(O$().value);else if(8===e||6===e)s$.octal&&L$(s$,c$),n=M$(O$());else{if(4===e)throw new Error(h$);1===e?((t=O$()).value="true"===t.value,n=M$(t)):5===e?((t=O$()).value=null,n=M$(t)):U$("/")||U$("/=")?(n=M$(function(){var e,t,n,i;return s$=null,A$(),e=i$,t=function(){var e,t,n,i;for(m$("/"===(e=n$[i$]),"Regular expression literal must start with a slash"),t=n$[i$++],n=!1,i=!1;i$<r$;)if(t+=e=n$[i$++],"\\"===e)x$((e=n$[i$++]).charCodeAt(0))&&L$({},l$),t+=e;else if(x$(e.charCodeAt(0)))L$({},l$);else if(n)"]"===e&&(n=!1);else{if("/"===e){i=!0;break}"["===e&&(n=!0)}return i||L$({},l$),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";i$<r$&&C$((e=n$[i$]).charCodeAt(0));)++i$,"\\"===e&&i$<r$?L$({},o$,d$):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&L$({},u$,n),{value:n,literal:t}}(),i=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((e,t)=>{if(parseInt(t,16)<=1114111)return"x";L$({},u$)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){L$({},u$)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:i$}}()),N$()):P$(O$())}return n}function X$(){const e=[];if(j$("("),!U$(")"))for(;i$<r$&&(e.push(Q$()),!U$(")"));)j$(",");return j$(")"),e}function Y$(){j$("[");const e=eO();return j$("]"),e}function K$(){const e=function(){var e;for(e=H$();;)if(U$("."))e=B$(".",e,(j$("."),function(){i$=s$.start;const e=O$();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||P$(e),R$(e.value)}()));else if(U$("("))e=T$(e,X$());else{if(!U$("["))break;e=B$("[",e,Y$())}return e}();if(7===s$.type&&(U$("++")||U$("--")))throw new Error(h$);return e}function J$(){var e,t;if(7!==s$.type&&4!==s$.type)t=K$();else{if(U$("++")||U$("--"))throw new Error(h$);if(U$("+")||U$("-")||U$("~")||U$("!"))e=O$(),t=J$(),t=function(e,t){const n=new e$("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(W$("delete")||W$("void")||W$("typeof"))throw new Error(h$);t=K$()}}return t}function Z$(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Q$(){var e,t;return e=function(){var e,t,n,i,r,s,a,o,u,l;if(e=s$,u=J$(),0===(r=Z$(i=s$)))return u;for(i.prec=r,O$(),t=[e,s$],s=[u,i,a=J$()];(r=Z$(s$))>0;){for(;s.length>2&&r<=s[s.length-2].prec;)a=s.pop(),o=s.pop().value,u=s.pop(),t.pop(),n=I$(o,u,a),s.push(n);(i=O$()).prec=r,s.push(i),t.push(s$),n=J$(),s.push(n)}for(n=s[l=s.length-1],t.pop();l>1;)t.pop(),n=I$(s[l-1].value,s[l-2],n),l-=2;return n}(),U$("?")&&(O$(),t=Q$(),j$(":"),e=function(e,t,n){const i=new e$("ConditionalExpression");return i.test=e,i.consequent=t,i.alternate=n,i}(e,t,Q$())),e}function eO(){const e=Q$();if(U$(","))throw new Error(h$);return e}var tO={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function nO(e){function t(t,n,i){return r=>function(t,n,i,r){let s=e(n[0]);return i&&(s=i+"("+s+")",0===i.lastIndexOf("new ",0)&&(s="("+s+")")),s+"."+t+(r<0?"":0===r?"()":"("+n.slice(1).map(e).join(",")+")")}(t,r,n,i)}const n="new Date",i="String",r="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&Pt("Missing arguments to clamp function."),t.length>3&&Pt("Too many arguments to clamp function.");const n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase",i,0),lower:t("toLowerCase",i,0),substring:t("substring",i),split:t("split",i),trim:t("trim",i,0),regexp:r,test:t("test",r),if:function(t){t.length<3&&Pt("Missing arguments to if function."),t.length>3&&Pt("Too many arguments to if function.");const n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}var iO,rO,sO,aO,oO,uO,lO,cO,dO,hO,fO,pO,mO,gO,yO,vO,bO=new KC,xO=new KC,wO={point:xk,lineStart:xk,lineEnd:xk,polygonStart:function(){bO=new KC,wO.lineStart=CO,wO.lineEnd=kO},polygonEnd:function(){var e=+bO;xO.add(e<0?nk+e:e),this.lineStart=this.lineEnd=this.point=xk},sphere:function(){xO.add(nk)}};function CO(){wO.point=AO}function kO(){_O(iO,rO)}function AO(e,t){wO.point=_O,iO=e,rO=t,sO=e*=rk,aO=uk(t=(t*=rk)/2+tk),oO=pk(t)}function _O(e,t){var n=(e*=rk)-sO,i=n>=0?1:-1,r=i*n,s=uk(t=(t*=rk)/2+tk),a=pk(t),o=oO*a,u=aO*s+o*uk(r),l=o*i*pk(r);bO.add(ok(l,u)),sO=e,aO=s,oO=a}var EO,SO,FO,DO,$O,OO,NO,IO,TO,RO,MO,BO,zO,LO,PO,jO,UO={point:WO,lineStart:qO,lineEnd:GO,polygonStart:function(){UO.point=HO,UO.lineStart=XO,UO.lineEnd=YO,gO=new KC,wO.polygonStart()},polygonEnd:function(){wO.polygonEnd(),UO.point=WO,UO.lineStart=qO,UO.lineEnd=GO,bO<0?(uO=-(cO=180),lO=-(dO=90)):gO>JC?dO=90:gO<-1e-6&&(lO=-90),vO[0]=uO,vO[1]=cO},sphere:function(){uO=-(cO=180),lO=-(dO=90)}};function WO(e,t){yO.push(vO=[uO=e,cO=e]),t<lO&&(lO=t),t>dO&&(dO=t)}function VO(e,t){var n=FA([e*rk,t*rk]);if(mO){var i=$A(mO,n),r=$A([i[1],-i[0],0],i);IA(r),r=SA(r);var s,a=e-hO,o=a>0?1:-1,u=r[0]*ik*o,l=sk(a)>180;l^(o*hO<u&&u<o*e)?(s=r[1]*ik)>dO&&(dO=s):l^(o*hO<(u=(u+360)%360-180)&&u<o*e)?(s=-r[1]*ik)<lO&&(lO=s):(t<lO&&(lO=t),t>dO&&(dO=t)),l?e<hO?KO(uO,e)>KO(uO,cO)&&(cO=e):KO(e,cO)>KO(uO,cO)&&(uO=e):cO>=uO?(e<uO&&(uO=e),e>cO&&(cO=e)):e>hO?KO(uO,e)>KO(uO,cO)&&(cO=e):KO(e,cO)>KO(uO,cO)&&(uO=e)}else yO.push(vO=[uO=e,cO=e]);t<lO&&(lO=t),t>dO&&(dO=t),mO=n,hO=e}function qO(){UO.point=VO}function GO(){vO[0]=uO,vO[1]=cO,UO.point=WO,mO=null}function HO(e,t){if(mO){var n=e-hO;gO.add(sk(n)>180?n+(n>0?360:-360):n)}else fO=e,pO=t;wO.point(e,t),VO(e,t)}function XO(){wO.lineStart()}function YO(){HO(fO,pO),wO.lineEnd(),sk(gO)>JC&&(uO=-(cO=180)),vO[0]=uO,vO[1]=cO,mO=null}function KO(e,t){return(t-=e)<0?t+360:t}function JO(e,t){return e[0]-t[0]}function ZO(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var QO={sphere:xk,point:eN,lineStart:nN,lineEnd:sN,polygonStart:function(){QO.lineStart=aN,QO.lineEnd=oN},polygonEnd:function(){QO.lineStart=nN,QO.lineEnd=sN}};function eN(e,t){e*=rk;var n=uk(t*=rk);tN(n*uk(e),n*pk(e),pk(t))}function tN(e,t,n){++EO,FO+=(e-FO)/EO,DO+=(t-DO)/EO,$O+=(n-$O)/EO}function nN(){QO.point=iN}function iN(e,t){e*=rk;var n=uk(t*=rk);LO=n*uk(e),PO=n*pk(e),jO=pk(t),QO.point=rN,tN(LO,PO,jO)}function rN(e,t){e*=rk;var n=uk(t*=rk),i=n*uk(e),r=n*pk(e),s=pk(t),a=ok(gk((a=PO*s-jO*r)*a+(a=jO*i-LO*s)*a+(a=LO*r-PO*i)*a),LO*i+PO*r+jO*s);SO+=a,OO+=a*(LO+(LO=i)),NO+=a*(PO+(PO=r)),IO+=a*(jO+(jO=s)),tN(LO,PO,jO)}function sN(){QO.point=eN}function aN(){QO.point=uN}function oN(){lN(BO,zO),QO.point=eN}function uN(e,t){BO=e,zO=t,e*=rk,t*=rk,QO.point=lN;var n=uk(t);LO=n*uk(e),PO=n*pk(e),jO=pk(t),tN(LO,PO,jO)}function lN(e,t){e*=rk;var n=uk(t*=rk),i=n*uk(e),r=n*pk(e),s=pk(t),a=PO*s-jO*r,o=jO*i-LO*s,u=LO*r-PO*i,l=dk(a,o,u),c=bk(l),d=l&&-c/l;TO.add(d*a),RO.add(d*o),MO.add(d*u),SO+=c,OO+=c*(LO+(LO=i)),NO+=c*(PO+(PO=r)),IO+=c*(jO+(jO=s)),tN(LO,PO,jO)}const cN="intersect",dN="union",hN="index:unit";function fN(e,t){for(var n,i,r=t.fields,s=t.values,a=r.length,o=0;o<a;++o)if((i=r[o]).getter=Ut.getter||Ut(i.field),In(n=i.getter(e))&&(n=rn(n)),In(s[o])&&(s[o]=rn(s[o])),In(s[o][0])&&(s[o]=s[o].map(rn)),"E"===i.type){if(Jt(s[o])?s[o].indexOf(n)<0:n!==s[o])return!1}else if("R"===i.type){if(!Nn(n,s[o]))return!1}else if("R-RE"===i.type){if(!Nn(n,s[o],!0,!1))return!1}else if("R-E"===i.type){if(!Nn(n,s[o],!1,!1))return!1}else if("R-LE"===i.type&&!Nn(n,s[o],!1,!0))return!1;return!0}const pN=Ut("_vgsid_"),mN=function(e){let t=e,n=e;function i(e,t,i,r){for(null==i&&(i=0),null==r&&(r=e.length);i<r;){const s=i+r>>>1;n(e[s],t)<0?i=s+1:r=s}return i}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}(e(t),n)}(e)),{left:i,center:function(e,n,r,s){null==r&&(r=0),null==s&&(s=e.length);const a=i(e,n,r,s-1);return a>r&&t(e[a-1],n)>-t(e[a],n)?a-1:a},right:function(e,t,i,r){for(null==i&&(i=0),null==r&&(r=e.length);i<r;){const s=i+r>>>1;n(e[s],t)>0?r=s:i=s+1}return i}}}(pN),gN=mN.left,yN=mN.right;var vN={E_union:function(e,t){if(!e.length)return t;for(var n=0,i=t.length;n<i;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((e=>t.indexOf(e)>=0)):t},R_union:function(e,t){var n=rn(t[0]),i=rn(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<i&&(e[1]=i),e):[n,i]},R_intersect:function(e,t){var n=rn(t[0]),i=rn(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?i<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>i&&(e[1]=i),e):[n,i]}};function bN(e,t,n,i){t[0].type!==ZD&&Pt("First argument to selection functions must be a string literal.");const r=t[0].value,s=":"+r;(t.length>=2&&nn(t).value)!==cN||Fn(i,"@unit")||(i["@unit"]=n.getData(r).indataRef(n,"unit")),Fn(i,s)||(i[s]=n.getData(r).tuplesRef())}function xN(e){const t=this.context.data[e];return t?t.values.value:[]}const wN=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},CN=wN("format"),kN=wN("timeFormat"),AN=wN("utcFormat"),_N=wN("timeParse"),EN=wN("utcParse"),SN=new Date(2e3,0,1);function FN(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(SN.setYear(2e3),SN.setMonth(e),SN.setDate(t),kN.call(this,SN,n)):""}function DN(e,t,n,i){t[0].type!==ZD&&Pt("First argument to data functions must be a string literal.");const r=t[0].value,s=":"+r;if(!Fn(s,i))try{i[s]=n.getData(r).tuplesRef()}catch(e){}}function $N(e,t,n,i){if(t[0].type===ZD)ON(n,i,t[0].value);else for(e in n.scales)ON(n,i,e)}function ON(e,t,n){const i="%"+n;if(!Fn(t,i))try{t[i]=e.scaleRef(n)}catch(e){}}function NN(e,t){let n;return yn(e)?e:Rn(e)?(n=t.scales[e])&&n.value:void 0}function IN(e,t){return function(n,i,r){if(n){const t=NN(n,(r||this).context);return t&&t.path[e](i)}return t(i)}}const TN=IN("area",(function(e){return xO=new KC,YC(e,wO),2*xO})),RN=IN("bounds",(function(e){var t,n,i,r,s,a,o;if(dO=cO=-(uO=lO=1/0),yO=[],YC(e,UO),n=yO.length){for(yO.sort(JO),t=1,s=[i=yO[0]];t<n;++t)ZO(i,(r=yO[t])[0])||ZO(i,r[1])?(KO(i[0],r[1])>KO(i[0],i[1])&&(i[1]=r[1]),KO(r[0],i[1])>KO(i[0],i[1])&&(i[0]=r[0])):s.push(i=r);for(a=-1/0,t=0,i=s[n=s.length-1];t<=n;i=r,++t)r=s[t],(o=KO(i[1],r[0]))>a&&(a=o,uO=r[0],cO=i[1])}return yO=vO=null,uO===1/0||lO===1/0?[[NaN,NaN],[NaN,NaN]]:[[uO,lO],[cO,dO]]})),MN=IN("centroid",(function(e){EO=SO=FO=DO=$O=OO=NO=IO=0,TO=new KC,RO=new KC,MO=new KC,YC(e,QO);var t=+TO,n=+RO,i=+MO,r=dk(t,n,i);return r<ZC&&(t=OO,n=NO,i=IO,SO<JC&&(t=FO,n=DO,i=$O),(r=dk(t,n,i))<ZC)?[NaN,NaN]:[ok(n,t)*ik,bk(i/r)*ik]}));function BN(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function zN(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function LN(e){const t=tf(e);return.2126*zN(t.r)+.7152*zN(t.g)+.0722*zN(t.b)}function PN(e,t){return e===t||e!=e&&t!=t||(Jt(e)?!(!Jt(t)||e.length!==t.length)&&function(e,t){for(let n=0,i=e.length;n<i;++n)if(!PN(e[n],t[n]))return!1;return!0}(e,t):!(!Zt(e)||!Zt(t))&&jN(e,t))}function jN(e,t){for(const n in e)if(!PN(e[n],t[n]))return!1;return!0}function UN(e){return t=>jN(e,t)}const WN={};function VN(e){return Jt(e)||ArrayBuffer.isView(e)?e:null}function qN(e){return VN(e)||(Rn(e)?e:null)}const GN=e=>e.data;function HN(e,t){const n=xN.call(t,e);return n.root&&n.root.lookup||{}}const XN=()=>"undefined"!=typeof window&&window||null,YN={random:()=>Hu(),cumulativeNormal:rl,cumulativeLogNormal:cl,cumulativeUniform:gl,densityNormal:il,densityLogNormal:ll,densityUniform:ml,quantileNormal:sl,quantileLogNormal:dl,quantileUniform:yl,sampleNormal:nl,sampleLogNormal:ul,sampleUniform:pl,isArray:Jt,isBoolean:function(e){return"boolean"==typeof e},isDate:In,isDefined:e=>void 0!==e,isNumber:Tn,isObject:Zt,isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},isString:Rn,isTuple:Jo,isValid:e=>null!=e&&e==e,toBoolean:Pn,toDate:Un,toNumber:rn,toString:Wn,indexof:function(e,...t){return qN(e).indexOf(...t)},join:function(e,...t){return VN(e).join(...t)},lastindexof:function(e,...t){return qN(e).lastIndexOf(...t)},replace:function(e,t,n){return yn(n)&&Pt("Function argument passed to replace."),String(e).replace(t,n)},reverse:function(e){return VN(e).slice().reverse()},slice:function(e,...t){return qN(e).slice(...t)},flush:function(e,t,n,i,r,s){if(!n&&0!==n)return s;const a=+n;let o,u=e[0],l=nn(e);l<u&&(o=u,u=l,l=o),o=Math.abs(t-u);const c=Math.abs(l-t);return o<c&&o<=a?i:c<=a?r:s},lerp:function(e,t){const n=e[0],i=nn(e),r=+t;return r?1===r?i:n+r*(i-n):n},merge:function(){const e=[].slice.call(arguments);return e.unshift({}),_n(...e)},pad:function(e,t,n,i){const r=n||" ",s=e+"",a=t-s.length;return a<=0?s:"left"===i?Bn(r,a)+s:"center"===i?Bn(r,~~(a/2))+s+Bn(r,Math.ceil(a/2)):s+Bn(r,a)},peek:nn,pluck:function(e,t){const n=WN[t]||(WN[t]=Ut(t));return Jt(e)?e.map(n):n(e)},span:zn,inrange:Nn,truncate:function(e,t,n,i){const r=null!=i?i:"…",s=e+"",a=s.length,o=Math.max(0,t-r.length);return a<=t?s:"left"===n?r+s.slice(a-o):"center"===n?s.slice(0,Math.ceil(o/2))+r+s.slice(a-~~(o/2)):s.slice(0,o)+r},rgb:tf,lab:Vp,hcl:Jp,hsl:lf,luminance:LN,contrast:function(e,t){const n=LN(e),i=LN(t);return(Math.max(n,i)+.05)/(Math.min(n,i)+.05)},sequence:Ml,format:CN,utcFormat:AN,utcParse:EN,utcOffset:ys,utcSequence:xs,timeFormat:kN,timeParse:_N,timeOffset:gs,timeSequence:bs,timeUnitSpecifier:Ur,monthFormat:function(e){return FN.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return FN.call(this,e,1,"%b")},dayFormat:function(e){return FN.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return FN.call(this,0,2+e,"%a")},quarter:function(e){return 1+~~(new Date(e).getMonth()/3)},utcquarter:function(e){return 1+~~(new Date(e).getUTCMonth()/3)},week:Gr,utcweek:Zr,dayofyear:qr,utcdayofyear:Jr,warn:function(){return BN(this.context.dataflow,"warn",arguments)},info:function(){return BN(this.context.dataflow,"info",arguments)},debug:function(){return BN(this.context.dataflow,"debug",arguments)},extent:En,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[i,r]=e,s=(new $y).set(i[0],i[1],r[0],r[1]);return ew(n||this.context.dataflow.scenegraph().root,s,function(e){let t=null;if(e){const n=gn(e.marktype),i=gn(e.markname);t=e=>(!n.length||n.some((t=>e.marktype===t)))&&(!i.length||i.some((t=>e.name===t)))}return t}(t))},clampRange:function(e,t,n){let i,r=e[0],s=e[1];return s<r&&(i=s,s=r,r=i),i=s-r,i>=n-t?[t,n]:[r=Math.min(Math.max(r,t),n-i),r+i]},pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+i*i)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=XN();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=XN();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return bm(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow,i=this.context.data[e].input;return n.pulse(i,n.changeset().remove(Ht).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?Qg(n,t=t||Ug(e)):e}},panLinear:function(e,t){return cn(e,t,rn,Vt)},panLog:function(e,t){var n=Math.sign(e[0]);return cn(e,t,an(n),sn(n))},panPow:function(e,t,n){return cn(e,t,ln(n),ln(1/n))},panSymlog:function(e,t,n){return cn(e,t,on(n),un(n))},zoomLinear:hn,zoomLog:fn,zoomPow:pn,zoomSymlog:mn,encode:function(e,t,n){if(e){const n=this.context.dataflow,i=e.mark.source;n.pulse(i,n.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,t,n,i,r,s){const a=this.context.dataflow,o=this.context.data[e],u=o.input,l=a.stamp();let c,d,h=o.changes;if(!1===a._trigger||!(u.value.length||t||i))return 0;if((!h||h.stamp<l)&&(o.changes=h=a.changeset(),h.stamp=l,a.runAfter((()=>{o.modified=!0,a.pulse(u,h).run()}),!0,1)),n&&(c=!0===n?Ht:Jt(n)||Jo(n)?n:UN(n),h.remove(c)),t&&h.insert(t),i&&(c=UN(i),u.value.some(c)?h.remove(c):h.insert(i)),r)for(d in s)h.modify(r,d,s[d]);return 1}},KN=["view","item","group","xy","x","y"],JN="this.",ZN={},QN={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${Ln("$"+e)}]`,functions:function(e){const t=nO(e);KN.forEach((e=>t[e]="event.vega."+e));for(const e in YN)t[e]=JN+e;return _n(t,function(e,t,n){t.__bandwidth=e=>e&&e.bandwidth?e.bandwidth():0,n._bandwidth=$N,n._range=$N,n._scale=$N;const i=t=>"_["+(t.type===ZD?Ln("%"+t.value):Ln("%")+"+"+e(t))+"]";return{_bandwidth:e=>`this.__bandwidth(${i(e[0])})`,_range:e=>`${i(e[0])}.range()`,_scale:t=>`${i(t[0])}(${e(t[1])})`}}(e,YN,ZN)),t},constants:tO,visitors:ZN},eI=function(e){const t=(e=e||{}).allowed?Vn(e.allowed):{},n=e.forbidden?Vn(e.forbidden):{},i=e.constants||tO,r=(e.functions||nO)(d),s=e.globalvar,a=e.fieldvar,o=yn(s)?s:e=>`${s}["${e}"]`;let u={},l={},c=0;function d(e){if(Rn(e))return e;const t=h[e.type];return null==t&&Pt("Unsupported type: "+e.type),t(e)}const h={Literal:e=>e.raw,Identifier:e=>{const r=e.name;return c>0?r:Fn(n,r)?Pt("Illegal identifier: "+r):Fn(i,r)?i[r]:Fn(t,r)?r:(u[r]=1,o(r))},MemberExpression:e=>{const t=!e.computed,n=d(e.object);t&&(c+=1);const i=d(e.property);return n===a&&(l[function(e){const t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(i)]=1),t&&(c-=1),n+(t?"."+i:"["+i+"]")},CallExpression:e=>{"Identifier"!==e.callee.type&&Pt("Illegal callee type: "+e.callee.type);const t=e.callee.name,n=e.arguments,i=Fn(r,t)&&r[t];return i||Pt("Unrecognized function: "+t),yn(i)?i(n):i+"("+n.map(d).join(",")+")"},ArrayExpression:e=>"["+e.elements.map(d).join(",")+"]",BinaryExpression:e=>"("+d(e.left)+" "+e.operator+" "+d(e.right)+")",UnaryExpression:e=>"("+e.operator+d(e.argument)+")",ConditionalExpression:e=>"("+d(e.test)+"?"+d(e.consequent)+":"+d(e.alternate)+")",LogicalExpression:e=>"("+d(e.left)+e.operator+d(e.right)+")",ObjectExpression:e=>"{"+e.properties.map(d).join(",")+"}",Property:e=>{c+=1;const t=d(e.key);return c-=1,t+":"+d(e.value)}};function f(e){const t={code:d(e),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},t}return f.functions=r,f.constants=i,f}(QN);function tI(e,t,n){return 1===arguments.length?YN[e]:(YN[e]=t,n&&(ZN[e]=n),eI&&(eI.functions[e]=JN+e),this)}function nI(e,t){const n={};let i;try{i=function(e){i$=0,r$=(n$=e).length,s$=null,N$();const t=eO();if(2!==s$.type)throw new Error("Unexpect token after expression.");return t}(e=Rn(e)?e:Ln(e)+"")}catch(t){Pt("Expression parse error: "+e)}i.visit((e=>{if(e.type!==QD)return;const i=e.callee.name,r=QN.visitors[i];r&&r(i,e.arguments,t,n)}));const r=eI(i);return r.globals.forEach((e=>{const i="$"+e;!Fn(n,i)&&t.getSignal(e)&&(n[i]=t.signalRef(e))})),{$expr:_n({code:r.code},t.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}tI("bandwidth",(function(e,t){const n=NN(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}),$N),tI("copy",(function(e,t){const n=NN(e,(t||this).context);return n?n.copy():void 0}),$N),tI("domain",(function(e,t){const n=NN(e,(t||this).context);return n?n.domain():[]}),$N),tI("range",(function(e,t){const n=NN(e,(t||this).context);return n&&n.range?n.range():[]}),$N),tI("invert",(function(e,t,n){const i=NN(e,(n||this).context);return i?Jt(t)?(i.invertRange||i.invert)(t):(i.invert||i.invertExtent)(t):void 0}),$N),tI("scale",(function(e,t,n){const i=NN(e,(n||this).context);return i?i(t):void 0}),$N),tI("gradient",(function(e,t,n,i,r){e=NN(e,(r||this).context);const s=Bg(t,n);let a=e.domain(),o=a[0],u=nn(a),l=Vt;return u-o?l=og(e,o,u):e=(e.interpolator?Xm("sequential")().interpolator(e.interpolator()):Xm("linear")().interpolate(e.interpolate()).range(e.range())).domain([o=0,u=1]),e.ticks&&(a=e.ticks(+i||15),o!==a[0]&&a.unshift(o),u!==nn(a)&&a.push(u)),a.forEach((t=>s.stop(l(t),e(t)))),s}),$N),tI("geoArea",TN,$N),tI("geoBounds",RN,$N),tI("geoCentroid",MN,$N),tI("geoShape",(function(e,t,n){const i=NN(e,(n||this).context);return function(e){return i?i.path.context(e)(t):""}}),$N),tI("indata",(function(e,t,n){const i=this.context.data[e]["index:"+t],r=i?i.value.get(n):void 0;return r?r.count:r}),(function(e,t,n,i){t[0].type!==ZD&&Pt("First argument to indata must be a string literal."),t[1].type!==ZD&&Pt("Second argument to indata must be a string literal.");const r=t[0].value,s=t[1].value,a="@"+s;Fn(a,i)||(i[a]=n.getData(r).indataRef(n,s))})),tI("data",xN,DN),tI("treePath",(function(e,t,n){const i=HN(e,this),r=i[t],s=i[n];return r&&s?r.path(s).map(GN):void 0}),DN),tI("treeAncestors",(function(e,t){const n=HN(e,this)[t];return n?n.ancestors().map(GN):void 0}),DN),tI("vlSelectionTest",(function(e,t,n){for(var i,r,s,a,o,u=this.context.data[e],l=u?u.values.value:[],c=u?u[hN]&&u[hN].value:void 0,d=n===cN,h=l.length,f=0;f<h;++f)if(i=l[f],c&&d){if(-1===(s=(r=r||{})[a=i.unit]||0))continue;if(o=fN(t,i),r[a]=o?-1:++s,o&&1===c.size)return!0;if(!o&&s===c.get(a).count)return!1}else if(d^(o=fN(t,i)))return o;return h&&d}),bN),tI("vlSelectionIdTest",(function(e,t,n){const i=this.context.data[e],r=i?i.values.value:[],s=i?i[hN]&&i[hN].value:void 0,a=n===cN,o=pN(t),u=gN(r,o);if(u===r.length)return!1;if(pN(r[u])!==o)return!1;if(s&&a){if(1===s.size)return!0;if(yN(r,o)-u<s.size)return!1}return!0}),bN),tI("vlSelectionResolve",(function(e,t,n,i){for(var r,s,a,o,u,l,c,d,h,f,p,m=this.context.data[e],g=m?m.values.value:[],y={},v={},b={},x=g.length,w=0;w<x;++w){for(o=(r=g[w]).unit,s=r.fields,a=r.values,f=0,p=s.length;f<p;++f)u=s[f],c=(l=y[u.field]||(y[u.field]={}))[o]||(l[o]=[]),b[u.field]=d=u.type.charAt(0),h=vN[d+"_union"],l[o]=h(c,gn(a[f]));n&&(c=v[o]||(v[o]=[])).push(gn(a).reduce(((e,t,n)=>(e[s[n].field]=t,e)),{}))}return t=t||dN,Object.keys(y).forEach((e=>{y[e]=Object.keys(y[e]).map((t=>y[e][t])).reduce(((n,i)=>void 0===n?i:vN[b[e]+"_"+t](n,i)))})),g=Object.keys(v),n&&g.length&&(y[i?"vlPoint":"vlMulti"]=t===dN?{or:g.reduce(((e,t)=>(e.push(...v[t]),e)),[])}:{and:g.map((e=>({or:v[e]})))}),y}),bN),tI("vlSelectionTuples",(function(e,t){return e.map((e=>_n({values:t.fields.map((t=>(t.getter||(t.getter=Ut(t.field)))(e.datum)))},t)))}));const iI=Vn(["rule"]),rI=Vn(["group","image","rect"]);function sI(e){return(e+"").toLowerCase()}function aI(e,t,n){";"!==n[n.length-1]&&(n="return("+n+");");const i=Function(...t.concat(n));return e&&e.functions?i.bind(e.functions):i}var oI={operator:(e,t)=>aI(e,["_"],t.code),parameter:(e,t)=>aI(e,["datum","_"],t.code),event:(e,t)=>aI(e,["event"],t.code),handler:(e,t)=>aI(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:i}=t;let r="var o=item,datum=o.datum,m=0,$;";for(const e in i){const t="o["+Ln(e)+"]";r+="$=".concat(i[e].code,";if(").concat(t,"!==$)").concat(t,"=$,m=1;")}return r+=function(e,t){let n="";return iI[t]||(e.x2&&(e.x?(rI[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(rI[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(i,n),r+="return m;",aI(e,["item","_"],r)},codegen:{get(e){const t="[".concat(e.map(Ln).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const i=Function("a","b","var u, v; return "+e.map(((e,i)=>{const r=t[i];let s,a;return e.path?(s="a".concat(e.path),a="b".concat(e.path)):((n=n||{})["f"+i]=e,s="this.f".concat(i,"(a)"),a="this.f".concat(i,"(b)")),function(e,t,n,i){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(i,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(i," : ")}(s,a,-r,r)})).join("")+"0;");return n?i.bind(n):i}}};function uI(e,t,n){if(!e||!Zt(e))return e;for(let i,r=0,s=lI.length;r<s;++r)if(i=lI[r],Fn(e,i.key))return i.parse(e,t,n);return e}var lI=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||Pt("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Mn(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const i="e:"+e.$expr.code+"_"+e.$name;return t.fn[i]||(t.fn[i]=Tt(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Ut(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,i={};for(const e in n){const r=n[e];i[e]=Tt(t.encodeExpression(r.$expr),r.$fields),i[e].output=r.$output}return i}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,i=gn(e.$compare).map((e=>e&&e.$tupleid?Zo:e));return t.fn[n]||(t.fn[n]=vn(i,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(e,i,r){const s=t.fork().parse(n),a=s.get(n.operators[0].id),o=s.signals.parent;return o&&o.set(r),a.detachSubflow=()=>t.detach(s),a}}},{key:"$tupleid",parse:function(){return Zo}}];const cI={skip:!0};function dI(e,t,n,i){return new hI(e,t,n,i)}function hI(e,t,n,i){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=i||oI,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function fI(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}function pI(e,t){e&&(null==t?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}hI.prototype=fI.prototype={fork(){const e=new fI(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter((t=>t!==e));const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,i=n.dataflow,r=e.value;if(n.set(e.id,t),"collect"===sI(e.type)&&r&&(r.$ingest?i.ingest(t,r.$ingest,r.$format):r.$request?i.preload(t,r.$request,r.$format):i.pulse(t,i.changeset().insert(r))),e.root&&(n.root=t),e.parent){let r=n.get(e.parent.$ref);r?(i.connect(r,[t]),t.targets().add(r)):(n.unresolved=n.unresolved||[]).push((()=>{r=n.get(e.parent.$ref),i.connect(r,[t]),t.targets().add(r)}))}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const i in e.data){const r=n.data[i]||(n.data[i]={});e.data[i].forEach((e=>r[e]=t))}},resolve(){return(this.unresolved||[]).forEach((e=>e())),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[sI(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,i,r){this.dataflow.on(t,n,i,r,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach((e=>t.parseOperator(e))),n.forEach((e=>t.parseOperatorParameters(e))),(e.streams||[]).forEach((e=>t.parseStream(e))),(e.updates||[]).forEach((e=>t.parseUpdate(e))),t.resolve()},parseOperator:function(e){const t=this;"operator"!==sI(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||Pt("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const i in e){const r=e[i];t[i]=Jt(r)?r.map((e=>uI(e,n,t))):uI(r,n,t)}return t},parseStream:function(e){var t,n=this,i=null!=e.filter?n.eventExpression(e.filter):void 0,r=null!=e.stream?n.get(e.stream):void 0;e.source?r=n.events(e.source,e.type,i):e.merge&&(r=(t=e.merge.map((e=>n.get(e))))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map((e=>n.get(e))),r=r.between(t[0],t[1])),e.filter&&(r=r.filter(i)),null!=e.throttle&&(r=r.throttle(+e.throttle)),null!=e.debounce&&(r=r.debounce(+e.debounce)),null==r&&Pt("Invalid stream definition: "+JSON.stringify(e)),e.consume&&r.consume(!0),n.stream(e,r)},parseUpdate:function(e){var t,n=this,i=Zt(i=e.source)?i.$ref:i,r=n.get(i),s=e.update,a=void 0;r||Pt("Source not defined: "+e.source),t=e.target&&e.target.$expr?n.eventExpression(e.target.$expr):n.get(e.target),s&&s.$expr&&(s.$params&&(a=n.parseParameters(s.$params)),s=n.handlerExpression(s.$expr)),n.update(e,r,t,s,a)},getState:function(e){var t=this,n={};if(e.signals){var i=n.signals={};Object.keys(t.signals).forEach((n=>{const r=t.signals[n];e.signals(n,r)&&(i[n]=r.value)}))}if(e.data){var r=n.data={};Object.keys(t.data).forEach((n=>{const i=t.data[n];e.data(n,i)&&(r[n]=i.input.value)}))}return t.subcontext&&!1!==e.recurse&&(n.subcontext=t.subcontext.map((t=>t.getState(e)))),n},setState:function(e){var t=this,n=t.dataflow,i=e.data,r=e.signals;Object.keys(r||{}).forEach((e=>{n.update(t.signals[e],r[e],cI)})),Object.keys(i||{}).forEach((e=>{n.pulse(t.data[e].input,n.changeset().remove(Ht).insert(i[e]))})),(e.subcontext||[]).forEach(((e,n)=>{const i=t.subcontext[n];i&&i.setState(e)}))}};const mI="default";function gI(e,t){const n=e.globalCursor()?"undefined"!=typeof document&&document.body:e.container();if(n)return null==t?n.style.removeProperty("cursor"):n.style.cursor=t}function yI(e,t){var n=e._runtime.data;return Fn(n,t)||Pt("Unrecognized data set: "+t),n[t]}function vI(e,t){su(t)||Pt("Second argument to changes must be a changeset.");const n=yI(this,e);return n.modified=!0,this.pulse(n.input,t)}function bI(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function xI(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function wI(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}const CI="view",kI={trap:!1};function AI(e,t,n,i){e._eventListeners.push({type:n,sources:gn(t),handler:i})}function _I(e,t,n){const i=e._eventConfig&&e._eventConfig[t];return!(!1===i||Zt(i)&&!i[n])||(e.warn(`Blocked ${t} ${n} event listener.`),!1)}function EI(e){return e.item}function SI(e){return e.item.mark.source}function FI(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function DI(e,t,n){const i=document.createElement(e);for(const e in t)i.setAttribute(e,t[e]);return null!=n&&(i.textContent=n),i}function $I(e,t,n,i){const r=n.event||"input",s=()=>e.update(t.value);i.signal(n.signal,t.value),t.addEventListener(r,s),AI(i,t,r,s),e.set=e=>{t.value=e,t.dispatchEvent(function(e){return"undefined"!=typeof Event?new Event(e):{type:e}}(r))}}function OI(e,t,n,i){const r=i.signal(n.signal),s=DI("div",{class:"vega-bind"}),a="radio"===n.input?s:s.appendChild(DI("label"));a.appendChild(DI("span",{class:"vega-bind-name"},n.name||n.signal)),t.appendChild(s);let o=NI;switch(n.input){case"checkbox":o=II;break;case"select":o=TI;break;case"radio":o=RI;break;case"range":o=MI}o(e,a,n,r)}function NI(e,t,n,i){const r=DI("input");for(const e in n)"signal"!==e&&"element"!==e&&r.setAttribute("input"===e?"type":e,n[e]);r.setAttribute("name",n.signal),r.value=i,t.appendChild(r),r.addEventListener("input",(()=>e.update(r.value))),e.elements=[r],e.set=e=>r.value=e}function II(e,t,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const s=DI("input",r);t.appendChild(s),s.addEventListener("change",(()=>e.update(s.checked))),e.elements=[s],e.set=e=>s.checked=!!e||null}function TI(e,t,n,i){const r=DI("select",{name:n.signal}),s=n.labels||[];n.options.forEach(((e,t)=>{const n={value:e};BI(e,i)&&(n.selected=!0),r.appendChild(DI("option",n,(s[t]||e)+""))})),t.appendChild(r),r.addEventListener("change",(()=>{e.update(n.options[r.selectedIndex])})),e.elements=[r],e.set=e=>{for(let t=0,i=n.options.length;t<i;++t)if(BI(n.options[t],e))return void(r.selectedIndex=t)}}function RI(e,t,n,i){const r=DI("span",{class:"vega-bind-radio"}),s=n.labels||[];t.appendChild(r),e.elements=n.options.map(((t,a)=>{const o={type:"radio",name:n.signal,value:t};BI(t,i)&&(o.checked=!0);const u=DI("input",o);u.addEventListener("change",(()=>e.update(t)));const l=DI("label",{},(s[a]||t)+"");return l.prepend(u),r.appendChild(l),u})),e.set=t=>{const n=e.elements,i=n.length;for(let e=0;e<i;++e)BI(n[e].value,t)&&(n[e].checked=!0)}}function MI(e,t,n,i){i=void 0!==i?i:(+n.max+ +n.min)/2;const r=null!=n.max?n.max:Math.max(100,+i)||100,s=n.min||Math.min(0,r,+i)||0,a=n.step||di(s,r,100),o=DI("input",{type:"range",name:n.signal,min:s,max:r,step:a});o.value=i;const u=DI("span",{},+i);t.appendChild(o),t.appendChild(u);const l=()=>{u.textContent=o.value,e.update(+o.value)};o.addEventListener("input",l),o.addEventListener("change",l),e.elements=[o],e.set=e=>{o.value=e,u.textContent=e}}function BI(e,t){return e===t||e+""==t+""}function zI(e,t,n,i,r,s){return(t=t||new i(e.loader())).initialize(n,bI(e),xI(e),wI(e),r,s).background(e.background())}function LI(e,t){return t?function(){try{t.apply(this,arguments)}catch(t){e.error(t)}}:null}function PI(e,t,n){if("string"==typeof t){if("undefined"==typeof document)return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t&&n)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}const jI=e=>+e||0;function UI(e){return Zt(e)?{top:jI(e.top),bottom:jI(e.bottom),left:jI(e.left),right:jI(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(jI(e))}async function WI(e,t,n,i){const r=Qx(t),s=r&&r.headless;return s||Pt("Unrecognized renderer type: "+t),await e.runAsync(),zI(e,null,null,s,n,i).renderAsync(e._scenegraph.root)}var VI="padding",qI={skip:!0};function GI(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===VI?i.left+i.right:0)}function HI(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===VI?i.top+i.bottom:0)}function XI(e,t){return t.modified&&Jt(t.input.value)&&e.indexOf("_:vega:_")}function YI(e,t){return!("parent"===e||t instanceof Ou.proxy)}function KI(e,t,n,i){const r=e.element();r&&r.setAttribute("title",function(e){return null==e?"":Jt(e)?JI(e):Zt(e)&&!In(e)?(t=e,Object.keys(t).map((e=>{const n=t[e];return e+": "+(Jt(n)?JI(n):ZI(n))})).join("\n")):e+"";var t}(i))}function JI(e){return"["+e.map(ZI).join(", ")+"]"}function ZI(e){return Jt(e)?"[…]":Zt(e)&&!In(e)?"{…}":e}function QI(e,t){const n=this;if(t=t||{},Fu.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),null!=t.logLevel&&n.logLevel(t.logLevel),t.locale||e.locale){const i=_n({},e.locale,t.locale);n.locale(yo(i.number,i.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||Jx.Canvas,n._scenegraph=new Ib;const i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||KI,n._redraw=!0,n._handler=(new sx).scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(e){const t=_n({defaults:{}},e),n=(e,t)=>{t.forEach((t=>{Jt(e[t])&&(e[t]=Vn(e[t]))}))};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=function(e,t,n){return dI(e,Ou,YN,n).parse(t)}(n,e,t.expr);n._runtime=r,n._signals=r.signals,n._bind=(e.bindings||[]).map((e=>({state:null,param:_n({},e)}))),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=GI(n,n._width),n._viewHeight=HI(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(e){var t=e._signals,n=t.width,i=t.height,r=t.padding;function s(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,(t=>{e._width=t.size,e._viewWidth=GI(e,t.size),s()}),{size:n}),e._resizeHeight=e.add(null,(t=>{e._height=t.size,e._viewHeight=HI(e,t.size),s()}),{size:i});const a=e.add(null,s,{pad:r});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=i.rank+1,a.rank=r.rank+1}(n),function(e){e.add(null,(t=>(e._background=t.bg,e._resize=1,t.bg)),{bg:e._signals.background})}(n),function(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:mI,item:null}));e.on(e.events("view","mousemove"),t,((e,n)=>{const i=t.value,r=i?Rn(i)?i:i.user:mI,s=n.item&&n.item.cursor||null;return i&&r===i.user&&s==i.item?i:{user:r,item:s}})),e.add(null,(function(t){let n=t.cursor,i=this.value;return Rn(n)||(i=n.item,n=n.user),gI(e,n&&n!==mI?n:i||n),i}),{cursor:t})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function eT(e,t){return Fn(e._signals,t)?e._signals[t]:Pt("Unrecognized signal name: "+Ln(t))}function tT(e,t){const n=(e._targets||[]).filter((e=>e._update&&e._update.handler===t));return n.length?n[0]:null}function nT(e,t,n,i){let r=tT(n,i);return r||(r=LI(e,(()=>i(t,n.value))),r.handler=i,e.on(n,null,r)),e}function iT(e,t,n){const i=tT(t,n);return i&&t._targets.remove(i),e}On(QI,Fu,{async evaluate(e,t,n){if(await Fu.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,r=wI(i=this),s=bI(i),a=xI(i),i._renderer.background(i.background()),i._renderer.resize(s,a,r),i._handler.origin(r),i._resizeListeners.forEach((e=>{try{e(s,a)}catch(e){i.error(e)}}))),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(e){this.error(e)}var i,r,s,a;return n&&Xo(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=null!=e?e+"":null;return t!==this._desc&&pI(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const i=eT(this,e);return 1===arguments.length?i.value:this.update(i,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",UI(e)):UI(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(Qx(e)||Pt("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(Fu.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(eT(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,i,r,s){this.runAfter((a=>{let o=0;a._autosize=0,a.width()!==n&&(o=1,a.signal("width",n,qI),a._resizeWidth.skip(!0)),a.height()!==i&&(o=1,a.signal("height",i,qI),a._resizeHeight.skip(!0)),a._viewWidth!==e&&(a._resize=1,a._viewWidth=e),a._viewHeight!==t&&(a._resize=1,a._viewHeight=t),a._origin[0]===r[0]&&a._origin[1]===r[1]||(a._resize=1,a._origin=r),o&&a.run("enter"),s&&a.runAfter((e=>e.resize()))}),!1,1)},addEventListener(e,t,n){let i=t;return n&&!1===n.trap||(i=LI(this,t),i.raw=t),this._handler.on(e,i),this},removeEventListener(e,t){for(var n,i,r=this._handler.handlers(e),s=r.length;--s>=0;)if(i=r[s].type,n=r[s].handler,e===i&&(t===n||t===n.raw)){this._handler.off(i,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return nT(this,e,eT(this,e),t)},removeSignalListener(e,t){return iT(this,eT(this,e),t)},addDataListener(e,t){return nT(this,e,yI(this,e).values,t)},removeDataListener(e,t){return iT(this,yI(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=gI(this,null);this._globalCursor=!!e,t&&gI(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(function(e,t,n){var i=new sS,r=t;return null==t?(i.restart(e,t,n),i):(i._restart=i.restart,i.restart=function(e,t,n){t=+t,n=null==n?iS():+n,i._restart((function s(a){a+=r,i._restart(s,r+=t,n),e(a)}),t,n)},i.restart(e,t,n),i)}((function(t){e({timestamp:Date.now(),elapsed:t})}),t))},events:function(e,t,n){var i,r=this,s=new pu(n),a=function(n,i){r.runAsync(null,(()=>{e===CI&&function(e,t){var n=e._eventConfig.defaults,i=n.prevent,r=n.allow;return!1!==i&&!0!==r&&(!0===i||!1===r||(i?i[t]:r?!r[t]:e.preventDefault()))}(r,t)&&n.preventDefault(),s.receive(function(e,t,n){var i,r,s=e._renderer,a=s&&s.canvas();return a&&(r=wI(e),(i=Pb(t.changedTouches?t.changedTouches[0]:t,a))[0]-=r[0],i[1]-=r[1]),t.dataflow=e,t.item=n,t.vega=function(e,t,n){const i=t?"group"===t.mark.marktype?t:t.mark.group:null;function r(e){var n,r=i;if(e)for(n=t;n;n=n.mark.group)if(n.mark.name===e){r=n;break}return r&&r.mark&&r.mark.interactive?r:{}}function s(e){if(!e)return n;Rn(e)&&(e=r(e));const t=n.slice();for(;e;)t[0]-=e.x||0,t[1]-=e.y||0,e=e.mark&&e.mark.group;return t}return{view:kn(e),item:kn(t||{}),group:r,xy:s,x:e=>s(e)[0],y:e=>s(e)[1]}}(e,n,i),t}(r,n,i))}))};if("timer"===e)_I(r,"timer",t)&&r.timer(a,t);else if(e===CI)_I(r,"view",t)&&r.addEventListener(t,a,kI);else if("window"===e?_I(r,"window",t)&&"undefined"!=typeof window&&(i=[window]):"undefined"!=typeof document&&_I(r,"selector",t)&&(i=document.querySelectorAll(e)),i){for(var o=0,u=i.length;o<u;++o)i[o].addEventListener(t,a);AI(r,i,t,a)}else r.warn("Can not resolve event source: "+e);return s},finalize:function(){var e,t,n,i=this._tooltip,r=this._timers,s=this._eventListeners;for(e=r.length;--e>=0;)r[e].stop();for(e=s.length;--e>=0;)for(t=(n=s[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return i&&i.call(this,this._handler,null,null,null),this},hover:function(e,t){return t=[t||"update",(e=[e||"hover"])[0]],this.on(this.events("view","mouseover",EI),SI,FI(e)),this.on(this.events("view","mouseout",EI),SI,FI(t)),this},data:function(e,t){return arguments.length<2?yI(this,e).values.value:vI.call(this,e,au().remove(Ht).insert(t))},change:vI,insert:function(e,t){return vI.call(this,e,au().insert(t))},remove:function(e,t){return vI.call(this,e,au().remove(t))},scale:function(e){var t=this._runtime.scales;return Fn(t,e)||Pt("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,i=n._renderType,r=n._eventConfig.bind,s=Qx(i);e=n._el=e?PI(n,e,!0):null,function(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),pI(t,e.description()))}(n),s||n.error("Unrecognized renderer type: "+i);const a=s.handler||sx,o=e?s.renderer:s.headless;return n._renderer=o?zI(n,n._renderer,e,o):null,n._handler=function(e,t,n,i){const r=new i(e.loader(),LI(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,wI(e),e);return t&&t.handlers().forEach((e=>{r.on(e.type,e.handler)})),r}(n,n._handler,e,a),n._redraw=!0,e&&"none"!==r&&(t=t?n._elBind=PI(n,t,!0):e.appendChild(DI("form",{class:"vega-bindings"})),n._bind.forEach((e=>{e.param.element&&"container"!==r&&(e.element=PI(n,e.param.element,!!e.param.input))})),n._bind.forEach((e=>{!function(e,t,n){if(!t)return;const i=n.param;let r=n.state;r||(r=n.state={elements:null,active:!1,set:null,update:t=>{t!=e.signal(i.signal)&&e.runAsync(null,(()=>{r.source=!0,e.signal(i.signal,t)}))}},i.debounce&&(r.update=An(i.debounce,r.update))),(null==i.input&&i.element?$I:OI)(r,t,i,e),r.active||(e.on(e._signals[i.signal],null,(()=>{r.source?r.source=!1:r.set(e.signal(i.signal))})),r.active=!0)}(n,e.element||t,e)}))),n},toImageURL:async function(e,t){e!==Jx.Canvas&&e!==Jx.SVG&&e!==Jx.PNG&&Pt("Unrecognized image type: "+e);const n=await WI(this,e,t);return e===Jx.SVG?function(e,t){const n=new Blob([e],{type:"image/svg+xml"});return window.URL.createObjectURL(n)}(n.svg()):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await WI(this,Jx.Canvas,e,t)).canvas()},toSVG:async function(e){return(await WI(this,Jx.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:XI,signals:YI,recurse:!0})},setState:function(e){return this.runAsync(null,(t=>{t._trigger=!1,t._runtime.setState(e)}),(e=>{e._trigger=!0})),this}});const rT=/[[\]{}]/,sT={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let aT,oT;function uT(e,t,n,i,r){const s=e.length;let a,o=0;for(;t<s;++t){if(a=e[t],!o&&a===n)return t;r&&r.indexOf(a)>=0?--o:i&&i.indexOf(a)>=0&&++o}return t}function lT(e){const t=[],n=e.length;let i=0,r=0;for(;r<n;)r=uT(e,r,",","[{","]}"),t.push(e.substring(i,r).trim()),i=++r;if(0===t.length)throw"Empty event selector: "+e;return t}function cT(e){return"["===e[0]?function(e){const t=e.length;let n,i=1;if(i=uT(e,i,"]","[","]"),i===t)throw"Empty between selector: "+e;if(n=lT(e.substring(1,i)),2!==n.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(i+1).trim())[0])throw"Expected '>' after between selector: "+e;n=n.map(cT);const r=cT(e.slice(1).trim());return r.between?{between:n,stream:r}:(r.between=n,r)}(e):function(e){const t={source:aT},n=[];let i,r,s=[0,0],a=0,o=0,u=e.length,l=0;if("}"===e[u-1]){if(l=e.lastIndexOf("{"),!(l>=0))throw"Unmatched right brace: "+e;try{s=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map((t=>{const n=+t;if(n!=n)throw e;return n}))}(e.substring(l+1,u-1))}catch(t){throw"Invalid throttle specification: "+e}u=(e=e.slice(0,l).trim()).length,l=0}if(!u)throw e;if("@"===e[0]&&(a=++l),i=uT(e,l,":"),i<u&&(n.push(e.substring(o,i).trim()),o=l=++i),l=uT(e,l,"["),l===u)n.push(e.substring(o,u).trim());else if(n.push(e.substring(o,l).trim()),r=[],o=++l,o===u)throw"Unmatched left bracket: "+e;for(;l<u;){if(l=uT(e,l,"]"),l===u)throw"Unmatched left bracket: "+e;if(r.push(e.substring(o,l).trim()),l<u-1&&"["!==e[++l])throw"Expected left bracket: "+e;o=++l}if(!(u=n.length)||rT.test(n[u-1]))throw"Invalid event selector: "+e;var c;return u>1?(t.type=n[1],a?t.markname=n[0].slice(1):(c=n[0],oT[c]?t.marktype=n[0]:t.source=n[0])):t.type=n[0],"!"===t.type.slice(-1)&&(t.consume=!0,t.type=t.type.slice(0,-1)),null!=r&&(t.filter=r),s[0]&&(t.throttle=s[0]),s[1]&&(t.debounce=s[1]),t}(e)}function dT(e){return Zt(e)?e:{type:e||"pad"}}const hT=e=>+e||0;function fT(e){return Zt(e)?e.signal?e:{top:hT(e.top),bottom:hT(e.bottom),left:hT(e.left),right:hT(e.right)}:{top:t=hT(e),bottom:t,left:t,right:t};var t}const pT=e=>Zt(e)&&!Jt(e)?_n({},e):{value:e};function mT(e,t,n,i){return null!=n?(Zt(n)&&!Jt(n)||Jt(n)&&n.length&&Zt(n[0])?e.update[t]=n:e[i||"enter"][t]={value:n},1):0}function gT(e,t,n){for(const n in t)mT(e,n,t[n]);for(const t in n)mT(e,t,n[t],"update")}function yT(e,t,n){for(const i in t)n&&Fn(n,i)||(e[i]=_n(e[i]||{},t[i]));return e}function vT(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const bT="mark",xT="frame",wT="scope",CT="legend-label";function kT(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const AT=e=>Rn(e)?Ln(e):e.signal?`(${e.signal})`:FT(e);function _T(e){if(null!=e.gradient)return function(e){const t=[e.start,e.stop,e.count].map((e=>null==e?null:Ln(e)));for(;t.length&&null==nn(t);)t.pop();return t.unshift(AT(e.gradient)),`gradient(${t.join(",")})`}(e);let t=e.signal?`(${e.signal})`:e.color?function(e){return e.c?ET("hcl",e.h,e.c,e.l):e.h||e.s?ET("hsl",e.h,e.s,e.l):e.l||e.a?ET("lab",e.l,e.a,e.b):e.r||e.g||e.b?ET("rgb",e.r,e.g,e.b):null}(e.color):null!=e.field?FT(e.field):void 0!==e.value?Ln(e.value):void 0;return null!=e.scale&&(t=function(e,t){const n=AT(e.scale);return null!=e.range?t=`lerp(_range(${n}), ${+e.range})`:(void 0!==t&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(1==+e.band?"":"*"+ST(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),null==t&&(t="0")),t}(e,t)),void 0===t&&(t=null),null!=e.exponent&&(t=`pow(${t},${ST(e.exponent)})`),null!=e.mult&&(t+=`*${ST(e.mult)}`),null!=e.offset&&(t+=`+${ST(e.offset)}`),e.round&&(t=`round(${t})`),t}const ET=(e,t,n,i)=>`(${e}(${[t,n,i].map(_T).join(",")})+'')`;function ST(e){return Zt(e)?"("+_T(e)+")":e}function FT(e){return DT(Zt(e)?e:{datum:e})}function DT(e){let t,n,i;if(e.signal)t="datum",i=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(i=e.parent,t+=".datum"):i=e.group}else e.datum?(t="datum",i=e.datum):Pt("Invalid field reference: "+Ln(e));return e.signal||(i=Rn(i)?jt(i).map(Ln).join("]["):DT(i)),t+"["+i+"]"}function $T(e,t,n,i,r,s){const a={};(s=s||{}).encoders={$encode:a},e=function(e,t,n,i,r){const s={},a={};let o,u,l,c;for(u in u="lineBreak","text"!==t||null==r[u]||vT(u,e)||kT(s,u,r[u]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c=n===xT?r.group:n===bT?_n({},r.mark,r[t]):null,c)l=vT(u,e)||("fill"===u||"stroke"===u)&&(vT("fill",e)||vT("stroke",e)),l||kT(s,u,c[u]);for(u in gn(i).forEach((t=>{const n=r.style&&r.style[t];for(const t in n)vT(t,e)||kT(s,t,n[t])})),e=_n({},e),s)c=s[u],c.signal?(o=o||{})[u]=c:a[u]=c;return e.enter=_n(a,e.enter),o&&(e.update=_n(o,e.update)),e}(e,t,n,i,r.config);for(const n in e)a[n]=OT(e[n],t,s,r);return s}function OT(e,t,n,i){const r={},s={};for(const t in e)null!=e[t]&&(r[t]=NT((a=e[t],Jt(a)?function(e){let t="";return e.forEach((e=>{const n=_T(e);t+=e.test?`(${e.test})?${n}:`:n})),":"===nn(t)&&(t+="null"),t}(a):_T(a)),i,n,s));var a;return{$expr:{marktype:t,channels:r},$fields:Object.keys(s),$output:Object.keys(e)}}function NT(e,t,n,i){const r=nI(e,t);return r.$fields.forEach((e=>i[e]=1)),_n(n,r.$params),r.$expr}const IT=["value","update","init","react","bind"];function TT(e,t){Pt(e+' for "outer" push: '+Ln(t))}function RT(e,t){const n=e.name;if("outer"===e.push)t.signals[n]||TT("No prior signal definition",n),IT.forEach((t=>{void 0!==e[t]&&TT("Invalid property ",t)}));else{const i=t.addSignal(n,e.value);!1===e.react&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function MT(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function BT(e,t,n,i){return new MT(e,t,n,i)}function zT(e,t){return BT("operator",e,t)}function LT(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function PT(e,t){return t?{$field:e,$name:t}:{$field:e}}const jT=PT("key");function UT(e,t){return{$compare:e,$order:t}}function WT(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const VT="scope",qT="view";function GT(e){return e&&e.signal}function HT(e){if(GT(e))return!0;if(Zt(e))for(const t in e)if(HT(e[t]))return!0;return!1}function XT(e,t){return null!=e?e:t}function YT(e){return e&&e.signal||e}const KT="timer";function JT(e,t){return(e.merge?ZT:e.stream?QT:e.type?eR:Pt("Invalid stream specification: "+Ln(e)))(e,t)}function ZT(e,t){const n=tR({merge:e.merge.map((e=>JT(e,t)))},e,t);return t.addStream(n).id}function QT(e,t){const n=tR({stream:JT(e.stream,t)},e,t);return t.addStream(n).id}function eR(e,t){let n;var i;e.type===KT?(n=t.event(KT,e.throttle),e={between:e.between,filter:e.filter}):n=t.event((i=e.source)===VT?qT:i||qT,e.type);const r=tR({stream:n},e,t);return 1===Object.keys(r).length?n:t.addStream(r).id}function tR(e,t,n){let i=t.between;return i&&(2!==i.length&&Pt('Stream "between" parameter must have 2 entries: '+Ln(t)),e.between=[JT(i[0],n),JT(i[1],n)]),i=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&i.push(function(e,t,n){const i="event.item";return i+(e&&"*"!==e?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===VT&&i.push("inScope(event.item)"),i.length&&(e.filter=nI("("+i.join(")&&(")+")",n).$expr),null!=(i=t.throttle)&&(e.throttle=+i),null!=(i=t.debounce)&&(e.debounce=+i),t.consume&&(e.consume=!0),e}const nR={code:"_.$value",ast:{type:"Identifier",value:"value"}};function iR(e){return{signal:"["+e.map((e=>e.scale?'scale("'+e.scale+'")':e.signal))+"]"}}const rR=e=>(t,n,i)=>BT(e,n,t||void 0,i),sR=rR("aggregate"),aR=rR("axisticks"),oR=rR("bound"),uR=rR("collect"),lR=rR("compare"),cR=rR("datajoin"),dR=rR("encode"),hR=rR("expression"),fR=rR("facet"),pR=rR("field"),mR=rR("key"),gR=rR("legendentries"),yR=rR("load"),vR=rR("mark"),bR=rR("multiextent"),xR=rR("multivalues"),wR=rR("overlap"),CR=rR("params"),kR=rR("prefacet"),AR=rR("projection"),_R=rR("proxy"),ER=rR("relay"),SR=rR("render"),FR=rR("scale"),DR=rR("sieve"),$R=rR("sortitems"),OR=rR("viewlayout"),NR=rR("values");let IR=0;const TR={min:"min",max:"max",count:"sum"};function RR(e,t){const n=t.getScale(e.name).params;let i;for(i in n.domain=LR(e.domain,e,t),null!=e.range&&(n.range=HR(e,t,n)),null!=e.interpolate&&function(e,t){t.interpolate=MR(e.type||e),null!=e.gamma&&(t.interpolateGamma=MR(e.gamma))}(e.interpolate,n),null!=e.nice&&(n.nice=function(e){return Zt(e)?{interval:MR(e.interval),step:MR(e.step)}:MR(e)}(e.nice)),null!=e.bins&&(n.bins=function(e,t){return e.signal||Jt(e)?BR(e,t):t.objectProperty(e)}(e.bins,t)),e)Fn(n,i)||"name"===i||(n[i]=MR(e[i],t))}function MR(e,t){return Zt(e)?e.signal?t.signalRef(e.signal):Pt("Unsupported object: "+Ln(e)):e}function BR(e,t){return e.signal?t.signalRef(e.signal):e.map((e=>MR(e,t)))}function zR(e){Pt("Can not find data set: "+Ln(e))}function LR(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(Jt(e)?PR:e.fields?UR:jR)(e,t,n);null==t.domainMin&&null==t.domainMax||Pt("No scale domain defined for domainMin/domainMax to override.")}function PR(e,t,n){return e.map((e=>MR(e,n)))}function jR(e,t,n){const i=n.getData(e.data);return i||zR(e.data),Zm(t.type)?i.valuesRef(n,e.field,VR(e.sort,!1)):ng(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function UR(e,t,n){const i=e.data,r=e.fields.reduce(((e,t)=>(t=Rn(t)?{data:i,field:t}:Jt(t)||t.signal?function(e,t){const n="_:vega:_"+IR++,i=uR({});if(Jt(e))i.value={$ingest:e};else if(e.signal){const r="setdata("+Ln(n)+","+e.signal+")";i.params.input=t.signalRef(r)}return t.addDataPipeline(n,[i,DR({})]),{data:n,field:"data"}}(t,n):t,e.push(t),e)),[]);return(Zm(t.type)?WR:ng(t.type)?qR:GR)(e,n,r)}function WR(e,t,n){const i=VR(e.sort,!0);let r,s;const a=n.map((e=>{const n=t.getData(e.data);return n||zR(e.data),n.countsRef(t,e.field,i)})),o={groupby:jT,pulse:a};i&&(r=i.op||"count",s=i.field?WT(r,i.field):"count",o.ops=[TR[r]],o.fields=[t.fieldRef(s)],o.as=[s]),r=t.add(sR(o));const u=t.add(uR({pulse:LT(r)}));return s=t.add(NR({field:jT,sort:t.sortRef(i),pulse:LT(u)})),LT(s)}function VR(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field&&e.op&&!TR[e.op]&&Pt("Multiple domain scales can not be sorted using "+e.op):Pt("No field provided for sort aggregate op: "+e.op):Zt(e)?e.field="key":e={field:"key"}),e}function qR(e,t,n){const i=n.map((e=>{const n=t.getData(e.data);return n||zR(e.data),n.domainRef(t,e.field)}));return LT(t.add(xR({values:i})))}function GR(e,t,n){const i=n.map((e=>{const n=t.getData(e.data);return n||zR(e.data),n.extentRef(t,e.field)}));return LT(t.add(bR({extents:i})))}function HR(e,t,n){const i=t.config.range;let r=e.range;if(r.signal)return t.signalRef(r.signal);if(Rn(r)){if(i&&Fn(i,r))return HR(e=_n({},e,{range:i[r]}),t,n);"width"===r?r=[0,{signal:"width"}]:"height"===r?r=Zm(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:Pt("Unrecognized scale range value: "+Ln(r))}else{if(r.scheme)return n.scheme=Jt(r.scheme)?BR(r.scheme,t):MR(r.scheme,t),r.extent&&(n.schemeExtent=BR(r.extent,t)),void(r.count&&(n.schemeCount=MR(r.count,t)));if(r.step)return void(n.rangeStep=MR(r.step,t));if(Zm(e.type)&&!Jt(r))return LR(r,e,t);Jt(r)||Pt("Unsupported range type: "+Ln(r))}return r.map((e=>(Jt(e)?BR:MR)(e,t)))}function XR(e,t,n){return Jt(e)?e.map((e=>XR(e,t,n))):Zt(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:Pt("Unsupported parameter object: "+Ln(e)):e}const YR="top",KR="left",JR="right",ZR="bottom",QR="label",eM="perc",tM="value",nM="guide-label",iM="guide-title",rM="symbol",sM="gradient",aM="discrete",oM="size",uM=[oM,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],lM={name:1,style:1,interactive:1},cM={value:0},dM={value:1},hM="group",fM="rect",pM="rule",mM="text";function gM(e){return e.type=hM,e.interactive=e.interactive||!1,e}function yM(e,t){const n=(n,i)=>XT(e[n],XT(t[n],i));return n.isVertical=n=>"vertical"===XT(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>XT(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>XT(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>XT(e.columns,XT(t.columns,+n.isVertical(!0))),n}function vM(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function bM(e,t,n){return`item.anchor === 'start' ? ${e} : item.anchor === 'end' ? ${t} : ${n}`}const xM=bM(Ln(KR),Ln(JR),Ln("center"));function wM(e,t){return t?e?Zt(e)?Object.assign({},e,{offset:wM(e.offset,t)}):{value:e,offset:t}:t:e}function CM(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=yT(e.encode,t,lM)):e.interactive=!1,e}function kM(e,t,n,i){const r=yM(e,n),s=r.isVertical(),a=r.gradientThickness(),o=r.gradientLength();let u,l,c,d,h;s?(l=[0,1],c=[0,0],d=a,h=o):(l=[0,0],c=[1,0],d=o,h=a);const f={enter:u={opacity:cM,x:cM,y:cM,width:pT(d),height:pT(h)},update:_n({},u,{opacity:dM,fill:{gradient:t,start:l,stop:c}}),exit:{opacity:cM}};return gT(f,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),CM({type:fM,role:"legend-gradient",encode:f},i)}function AM(e,t,n,i,r){const s=yM(e,n),a=s.isVertical(),o=s.gradientThickness(),u=s.gradientLength();let l,c,d,h,f="";a?(l="y",d="y2",c="x",h="width",f="1-"):(l="x",d="x2",c="y",h="height");const p={opacity:cM,fill:{scale:t,field:tM}};p[l]={signal:f+"datum."+eM,mult:u},p[c]=cM,p[d]={signal:f+"datum.perc2",mult:u},p[h]=pT(o);const m={enter:p,update:_n({},p,{opacity:dM}),exit:{opacity:cM}};return gT(m,{stroke:s("gradientStrokeColor"),strokeWidth:s("gradientStrokeWidth")},{opacity:s("gradientOpacity")}),CM({type:fM,role:"legend-band",key:tM,from:r,encode:m},i)}function _M(e,t,n,i){const r=yM(e,t),s=r.isVertical(),a=pT(r.gradientThickness()),o=r.gradientLength();let u,l,c,d,h=r("labelOverlap"),f="";const p={enter:u={opacity:cM},update:l={opacity:dM,text:{field:QR}},exit:{opacity:cM}};return gT(p,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:XT(e.labelLimit,t.gradientLabelLimit)}),s?(u.align={value:"left"},u.baseline=l.baseline={signal:'datum.perc<=0?"bottom":datum.perc>=1?"top":"middle"'},c="y",d="x",f="1-"):(u.align=l.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},u.baseline={value:"top"},c="x",d="y"),u[c]=l[c]={signal:f+"datum."+eM,mult:o},u[d]=l[d]=a,a.offset=XT(e.labelOffset,t.gradientLabelOffset)||0,h=h?{separation:r("labelSeparation"),method:h,order:"datum.index"}:void 0,CM({type:mM,role:CT,style:nM,key:tM,from:i,encode:p,overlap:h},n)}function EM(e,t,n,i,r){const s=yM(e,t),a=n.entries,o=!(!a||!a.interactive),u=a?a.name:void 0,l=s("clipHeight"),c=s("symbolOffset"),d={data:"value"},h=`(${r}) ? datum.offset : datum.size`,f=l?pT(l):{field:oM},p="datum.index",m=`max(1, ${r})`;let g,y,v,b,x;f.mult=.5,g={enter:y={opacity:cM,x:{signal:h,mult:.5,offset:c},y:f},update:v={opacity:dM,x:y.x,y:y.y},exit:{opacity:cM}};let w=null,C=null;e.fill||(w=t.symbolBaseFillColor,C=t.symbolBaseStrokeColor),gT(g,{fill:s("symbolFillColor",w),shape:s("symbolType"),size:s("symbolSize"),stroke:s("symbolStrokeColor",C),strokeDash:s("symbolDash"),strokeDashOffset:s("symbolDashOffset"),strokeWidth:s("symbolStrokeWidth")},{opacity:s("symbolOpacity")}),uM.forEach((t=>{e[t]&&(v[t]=y[t]={scale:e[t],field:tM})}));const k=CM({type:"symbol",role:"legend-symbol",key:tM,from:d,clip:!!l||void 0,encode:g},n.symbols),A=pT(c);A.offset=s("labelOffset"),g={enter:y={opacity:cM,x:{signal:h,offset:A},y:f},update:v={opacity:dM,text:{field:QR},x:y.x,y:y.y},exit:{opacity:cM}},gT(g,{align:s("labelAlign"),baseline:s("labelBaseline"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontStyle:s("labelFontStyle"),fontWeight:s("labelFontWeight"),limit:s("labelLimit")});const _=CM({type:mM,role:CT,style:nM,key:tM,from:d,encode:g},n.labels);return g={enter:{noBound:{value:!l},width:cM,height:l?pT(l):cM,opacity:cM},exit:{opacity:cM},update:v={opacity:dM,row:{signal:null},column:{signal:null}}},s.isVertical(!0)?(b=`ceil(item.mark.items.length / ${m})`,v.row.signal=`${p}%${b}`,v.column.signal=`floor(${p} / ${b})`,x={field:["row",p]}):(v.row.signal=`floor(${p} / ${m})`,v.column.signal=`${p} % ${m}`,x={field:p}),v.column.signal=`(${r})?${v.column.signal}:${p}`,gM({role:wT,from:i={facet:{data:i,name:"value",groupby:"index"}},encode:yT(g,a,lM),marks:[k,_],name:u,interactive:o,sort:x})}const SM='item.orient === "left"',FM='item.orient === "right"',DM=`(${SM} || ${FM})`,$M=`datum.vgrad && ${DM}`,OM=bM('"top"','"bottom"','"middle"'),NM=`datum.vgrad && ${FM} ? (${bM('"right"','"left"','"center"')}) : (${DM} && !(datum.vgrad && ${SM})) ? "left" : ${xM}`,IM=`item._anchor || (${DM} ? "middle" : "start")`,TM=`${$M} ? (${SM} ? -90 : 90) : 0`,RM=`${DM} ? (datum.vgrad ? (${FM} ? "bottom" : "top") : ${OM}) : "top"`;function MM(e,t){let n;return Zt(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+BM(e.path)+")":e.sphere&&(n="geoShape("+BM(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function BM(e){return Zt(e)&&e.signal?e.signal:Ln(e)}function zM(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===hM?wT:t||bT:t}function LM(e){return{marktype:e.type,name:e.name||void 0,role:e.role||zM(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function PM(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function jM(e,t){const n=Nu(e.type);n||Pt("Unrecognized transform type: "+Ln(e.type));const i=BT(n.type.toLowerCase(),null,UM(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(i)),i.metadata=n.metadata||{},i}function UM(e,t,n){const i={},r=e.params.length;for(let s=0;s<r;++s){const r=e.params[s];i[r.name]=WM(r,t,n)}return i}function WM(e,t,n){const i=e.type,r=t[e.name];return"index"===i?function(e,t,n){return Rn(t.from)||Pt('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}(0,t,n):void 0!==r?"param"===i?function(e,t,n){const i=t[e.name];return e.array?(Jt(i)||Pt("Expected an array of sub-parameters. Instead: "+Ln(i)),i.map((t=>qM(e,t,n)))):qM(e,i,n)}(e,t,n):"projection"===i?n.projectionRef(t[e.name]):e.array&&!GT(r)?r.map((t=>VM(e,t,n))):VM(e,r,n):void(e.required&&Pt("Missing required "+Ln(t.type)+" parameter: "+Ln(e.name)))}function VM(e,t,n){const i=e.type;if(GT(t))return YM(i)?Pt("Expression references can not be signals."):KM(i)?n.fieldRef(t):JM(i)?n.compareRef(t):n.signalRef(t.signal);{const r=e.expr||KM(i);return r&&GM(t)?n.exprRef(t.expr,t.as):r&&HM(t)?PT(t.field,t.as):YM(i)?nI(t,n):XM(i)?LT(n.getData(t).values):KM(i)?PT(t):JM(i)?n.compareRef(t):t}}function qM(e,t,n){const i=e.params.length;let r;for(let n=0;n<i;++n){r=e.params[n];for(const e in r.key)if(r.key[e]!==t[e]){r=null;break}if(r)break}r||Pt("Unsupported parameter: "+Ln(t));const s=_n(UM(r,t,n),r.key);return LT(n.add(CR(s)))}const GM=e=>e&&e.expr,HM=e=>e&&e.field,XM=e=>"data"===e,YM=e=>"expr"===e,KM=e=>"field"===e,JM=e=>"compare"===e;function ZM(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:LT(t.getData(e.data).output)}function QM(e,t,n,i,r){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=r,this.index={}}function eB(e){return Rn(e)?e:null}function tB(e,t,n){const i=WT(n.op,n.field);let r;if(t.ops){for(let e=0,n=t.as.length;e<n;++e)if(t.as[e]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function nB(e,t,n,i,r,s,a){const o=t[n]||(t[n]={}),u=function(e){return Zt(e)?("descending"===e.order?"-":"+")+WT(e.op,e.field):""}(s);let l,c,d=eB(r);if(null!=d&&(e=t.scope,d+=u?"|"+u:"",l=o[d]),!l){const n=s?{field:jT,pulse:t.countsRef(e,r,s)}:{field:e.fieldRef(r),pulse:LT(t.output)};u&&(n.sort=e.sortRef(s)),c=e.add(BT(i,void 0,n)),a&&(t.index[r]=c),l=LT(c),null!=d&&(o[d]=l)}return l}function iB(e,t,n){const i=e.remove,r=e.insert,s=e.toggle,a=e.modify,o=e.values,u=t.add(zT()),l=nI("if("+e.trigger+',modify("'+n+'",'+[r,i,s,a,o].map((e=>null==e?"null":e)).join(",")+"),0)",t);u.update=l.$expr,u.params=l.$params}function rB(e,t){const n=zM(e),i=e.type===hM,r=e.from&&e.from.facet,s=e.overlap;let a,o,u,l,c,d,h,f=e.layout||n===wT||n===xT;const p=n===bT||f||r,m=function(e,t,n){let i,r,s,a,o;return e?(i=e.facet)&&(t||Pt("Only group marks can be faceted."),null!=i.field?a=o=ZM(i,n):(e.data?o=LT(n.getData(e.data).aggregate):(s=jM(_n({type:"aggregate",groupby:gn(i.groupby)},i.aggregate),n),s.params.key=n.keyRef(i.groupby),s.params.pulse=ZM(i,n),a=o=LT(n.add(s))),r=n.keyRef(i.groupby,!0))):a=LT(n.add(uR(null,[{}]))),a||(a=ZM(e,n)),{key:r,pulse:a,parent:o}}(e.from,i,t);o=t.add(cR({key:m.key||(e.key?PT(e.key):void 0),pulse:m.pulse,clean:!i}));const g=LT(o);o=u=t.add(uR({pulse:g})),o=t.add(vR({markdef:LM(e),interactive:PM(e.interactive,t),clip:MM(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:LT(o)}));const y=LT(o);o=l=t.add(dR($T(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),o.params.parent=t.encode(),e.transform&&e.transform.forEach((e=>{const n=jM(e,t),i=n.metadata;(i.generates||i.changes)&&Pt("Mark transforms should not generate new data."),i.nomod||(l.params.mod=!0),n.params.pulse=LT(o),t.add(o=n)})),e.sort&&(o=t.add($R({sort:t.compareRef(e.sort),pulse:LT(o)})));const v=LT(o);(r||f)&&(f=t.add(OR({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:v})),d=LT(f));const b=t.add(oR({mark:y,pulse:d||v}));h=LT(b),i&&(p&&(a=t.operators,a.pop(),f&&a.pop()),t.pushState(v,d||h,g),r?function(e,t,n){const i=e.from.facet,r=i.name,s=ZM(i,t);let a;i.name||Pt("Facet must have a name: "+Ln(i)),i.data||Pt("Facet must reference a data set: "+Ln(i)),i.field?a=t.add(kR({field:t.fieldRef(i.field),pulse:s})):i.groupby?a=t.add(fR({key:t.keyRef(i.groupby),group:LT(t.proxy(n.parent)),pulse:s})):Pt("Facet must specify groupby or field: "+Ln(i));const o=t.fork(),u=o.add(uR()),l=o.add(DR({pulse:LT(u)}));o.addData(r,new QM(o,u,u,l)),o.addSignal("parent",null),a.params.subflow={$subflow:o.parse(e).toRuntime()}}(e,t,m):p?function(e,t,n){const i=t.add(kR({pulse:n.pulse})),r=t.fork();r.add(DR()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(e).toRuntime()}}(e,t,m):t.parse(e),t.popState(),p&&(f&&a.push(f),a.push(b))),s&&(h=function(e,t,n){const i=e.method,r=e.bound,s=e.separation,a={separation:GT(s)?n.signalRef(s.signal):s,method:GT(i)?n.signalRef(i.signal):i,pulse:t};if(e.order&&(a.sort=n.compareRef({field:e.order})),r){const e=r.tolerance;a.boundTolerance=GT(e)?n.signalRef(e.signal):+e,a.boundScale=n.scaleRef(r.scale),a.boundOrient=r.orient}return LT(n.add(wR(a)))}(s,h,t));const x=t.add(SR({pulse:h})),w=t.add(DR({pulse:LT(x)},void 0,t.parent()));null!=e.name&&(c=e.name,t.addData(c,new QM(t,u,x,w)),e.on&&e.on.forEach((e=>{(e.insert||e.remove||e.toggle)&&Pt("Marks only support modify triggers."),iB(e,t,c)})))}function sB(e,t,n){const i={enter:{},update:{}};return gT(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}function aB(e,t,n){return t[e]?`scale("${t[e]}",datum)`:vM(e,n[0].encode)}function oB(e,t){const n={enter:{},update:{}};return gT(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:xM},angle:{signal:'item.orient==="left"?-90:item.orient==="right"?90:0'},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),yT(n,t,lM)}function uB(e){const t=uR({},e);return t.metadata={source:!0},t}function lB(e,t){return yR({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}QM.fromEntries=function(e,t){const n=t.length,i=t[n-1],r=t[n-2];let s=t[0],a=null,o=1;for(s&&"load"===s.type&&(s=t[1]),e.add(t[0]);o<n;++o)t[o].params.pulse=LT(t[o-1]),e.add(t[o]),"aggregate"===t[o].type&&(a=t[o]);return new QM(e,s,r,i,a)},QM.prototype={countsRef(e,t,n){const i=this,r=i.counts||(i.counts={}),s=eB(t);let a,o,u;return null!=s&&(e=i.scope,a=r[s]),a?n&&n.field&&tB(e,a.agg.params,n):(u={groupby:e.fieldRef(t,"key"),pulse:LT(i.output)},n&&n.field&&tB(e,u,n),o=e.add(sR(u)),a=e.add(uR({pulse:LT(o)})),a={agg:o,ref:LT(a)},null!=s&&(r[s]=a)),a.ref},tuplesRef(){return LT(this.values)},extentRef(e,t){return nB(e,this,"extent","extent",t,!1)},domainRef(e,t){return nB(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return nB(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return nB(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return nB(e,this,"indata","tupleindex",t,!0,!0)}};const cB=e=>e===ZR||e===YR,dB=(e,t,n)=>GT(e)?yB(e.signal,t,n):e===KR||e===YR?t:n,hB=(e,t,n)=>GT(e)?mB(e.signal,t,n):cB(e)?t:n,fB=(e,t,n)=>GT(e)?gB(e.signal,t,n):cB(e)?n:t,pB=(e,t,n)=>GT(e)?vB(e.signal,t,n):e===YR?{value:t}:{value:n},mB=(e,t,n)=>bB(`${e} === 'top' || ${e} === 'bottom'`,t,n),gB=(e,t,n)=>bB(`${e} !== 'top' && ${e} !== 'bottom'`,t,n),yB=(e,t,n)=>wB(`${e} === 'left' || ${e} === 'top'`,t,n),vB=(e,t,n)=>wB(`${e} === 'top'`,t,n),bB=(e,t,n)=>(t=null!=t?pT(t):t,n=null!=n?pT(n):n,xB(t)&&xB(n)?{signal:`${e} ? (${t=t?t.signal||Ln(t.value):null}) : (${n=n?n.signal||Ln(n.value):null})`}:[_n({test:e},t)].concat(n||[])),xB=e=>null==e||1===Object.keys(e).length,wB=(e,t,n)=>({signal:`${e} ? (${kB(t)}) : (${kB(n)})`}),CB=(e,t,n,i,r)=>({signal:(null!=i?`${e} === 'left' ? (${kB(i)}) : `:"")+(null!=n?`${e} === 'bottom' ? (${kB(n)}) : `:"")+(null!=r?`${e} === 'right' ? (${kB(r)}) : `:"")+(null!=t?`${e} === 'top' ? (${kB(t)}) : `:"")+"(null)"}),kB=e=>GT(e)?e.signal:null==e?null:Ln(e),AB=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function _B(e,t,n,i){let r;if(t&&Fn(t,e))return t[e];if(Fn(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=e[5].toLowerCase()+e.slice(6)}return i["guide-title"][r]}if(e.startsWith("label")){switch(e){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=e[5].toLowerCase()+e.slice(6)}return i["guide-label"][r]}return null}function EB(e){const t={};for(const n of e)if(n)for(const e in n)t[e]=1;return Object.keys(t)}function SB(e,t){return{scale:e.scale,range:t}}function FB(e,t,n,i,r){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+r+")"}}function DB(e,t,n,i,r,s){const a=yM(e,t),o=e.orient,u=e.scale,l=dB(o,-1,1),c=YT(a("labelFlush")),d=YT(a("labelFlushOffset")),h=a("labelAlign"),f=a("labelBaseline");let p,m=0===c||!!c;const g=pT(r);g.mult=l,g.offset=pT(a("labelPadding")||0),g.offset.mult=l;const y={scale:u,field:tM,band:.5,offset:wM(s.offset,a("labelOffset"))},v=hB(o,m?FB(u,c,'"left"','"right"','"center"'):{value:"center"},((e,t,n)=>GT(e)?((e,t,n)=>wB(`${e} === 'right'`,t,n))(e.signal,t,n):e===JR?{value:t}:{value:n})(o,"left","right")),b=hB(o,pB(o,"bottom","top"),m?FB(u,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=FB(u,c,`-(${d})`,d,0);m=m&&d;const w={opacity:cM,x:hB(o,y,g),y:fB(o,y,g)},C={enter:w,update:p={opacity:dM,text:{field:QR},x:w.x,y:w.y,align:v,baseline:b},exit:{opacity:cM,x:w.x,y:w.y}};gT(C,{dx:!h&&m?hB(o,x):null,dy:!f&&m?fB(o,x):null}),gT(C,{angle:a("labelAngle"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontWeight:a("labelFontWeight"),fontStyle:a("labelFontStyle"),limit:a("labelLimit"),lineHeight:a("labelLineHeight")},{align:h,baseline:f});const k=a("labelBound");let A=a("labelOverlap");return A=A||k?{separation:a("labelSeparation"),method:A,order:"datum.index",bound:k?{scale:u,orient:o,tolerance:k}:null}:void 0,p.align!==v&&(p.align=AB(p.align,v)),p.baseline!==b&&(p.baseline=AB(p.baseline,b)),CM({type:mM,role:"axis-label",style:nM,key:tM,from:i,encode:C,overlap:A},n)}function $B(e,t){const n=function(e,t){var n,i,r,s=t.config,a=s.style,o=s.axis,u="band"===t.scaleType(e.scale)&&s.axisBand,l=e.orient;if(GT(l)){const e=EB([s.axisX,s.axisY]),t=EB([s.axisTop,s.axisBottom,s.axisLeft,s.axisRight]);for(r of(n={},e))n[r]=hB(l,_B(r,s.axisX,o,a),_B(r,s.axisY,o,a));for(r of(i={},t))i[r]=CB(l.signal,_B(r,s.axisTop,o,a),_B(r,s.axisBottom,o,a),_B(r,s.axisLeft,o,a),_B(r,s.axisRight,o,a))}else n=l===YR||l===ZR?s.axisX:s.axisY,i=s["axis"+l[0].toUpperCase()+l.slice(1)];return n||i||u?_n({},o,n,i,u):o}(e,t),i=e.encode||{},r=i.axis||{},s=r.name||void 0,a=r.interactive,o=r.style,u=yM(e,n),l=function(e){const t=e("tickBand");let n,i,r=e("tickOffset");return t?t.signal?(n={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},i={signal:`(${t.signal}) === 'extent'`},Zt(r)||(r={signal:`(${t.signal}) === 'extent' ? 0 : ${r}`})):"extent"===t?(n=1,i=!0,r=0):(n=.5,i=!1):(n=e("bandPosition"),i=e("tickExtra")),{extra:i,band:n,offset:r}}(u),c={scale:e.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:null!=e.title},d=LT(t.add(uR({},[c]))),h=LT(t.add(aR({scale:t.scaleRef(e.scale),extra:t.property(l.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),f=[];let p;return c.grid&&f.push(function(e,t,n,i,r){const s=yM(e,t),a=e.orient,o=e.gridScale,u=dB(a,1,-1),l=function(e,t){if(1===t);else if(Zt(e)){let n=e=_n({},e);for(;null!=n.mult;){if(!Zt(n.mult))return n.mult=GT(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n=n.mult=_n({},n.mult)}n.mult=t}else e=GT(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);return e}(e.offset,u);let c,d,h;const f={enter:c={opacity:cM},update:h={opacity:dM},exit:d={opacity:cM}};gT(f,{stroke:s("gridColor"),strokeCap:s("gridCap"),strokeDash:s("gridDash"),strokeDashOffset:s("gridDashOffset"),strokeOpacity:s("gridOpacity"),strokeWidth:s("gridWidth")});const p={scale:e.scale,field:tM,band:r.band,extra:r.extra,offset:r.offset,round:s("tickRound")},m=hB(a,{signal:"height"},{signal:"width"}),g=o?{scale:o,range:0,mult:u,offset:l}:{value:0,offset:l},y=o?{scale:o,range:1,mult:u,offset:l}:_n(m,{mult:u,offset:l});return c.x=h.x=hB(a,p,g),c.y=h.y=fB(a,p,g),c.x2=h.x2=fB(a,y),c.y2=h.y2=hB(a,y),d.x=hB(a,p),d.y=fB(a,p),CM({type:pM,role:"axis-grid",key:tM,from:i,encode:f},n)}(e,n,i.grid,h,l)),c.ticks&&(p=u("tickSize"),f.push(function(e,t,n,i,r,s){const a=yM(e,t),o=e.orient,u=dB(o,-1,1);let l,c,d;const h={enter:l={opacity:cM},update:d={opacity:dM},exit:c={opacity:cM}};gT(h,{stroke:a("tickColor"),strokeCap:a("tickCap"),strokeDash:a("tickDash"),strokeDashOffset:a("tickDashOffset"),strokeOpacity:a("tickOpacity"),strokeWidth:a("tickWidth")});const f=pT(r);f.mult=u;const p={scale:e.scale,field:tM,band:s.band,extra:s.extra,offset:s.offset,round:a("tickRound")};return d.y=l.y=hB(o,cM,p),d.y2=l.y2=hB(o,f),c.x=hB(o,p),d.x=l.x=fB(o,cM,p),d.x2=l.x2=fB(o,f),c.y=fB(o,p),CM({type:pM,role:"axis-tick",key:tM,from:i,encode:h},n)}(e,n,i.ticks,h,p,l))),c.labels&&(p=c.ticks?p:0,f.push(DB(e,n,i.labels,h,p,l))),c.domain&&f.push(function(e,t,n,i){const r=yM(e,t),s=e.orient;let a,o;const u={enter:a={opacity:cM},update:o={opacity:dM},exit:{opacity:cM}};gT(u,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const l=SB(e,0),c=SB(e,1);return a.x=o.x=hB(s,l,cM),a.x2=o.x2=hB(s,c),a.y=o.y=fB(s,l,cM),a.y2=o.y2=fB(s,c),CM({type:pM,role:"axis-domain",from:i,encode:u},n)}(e,n,i.domain,d)),c.title&&f.push(function(e,t,n,i){const r=yM(e,t),s=e.orient,a=dB(s,-1,1);let o,u;const l={enter:o={opacity:cM,anchor:pT(r("titleAnchor",null)),align:{signal:xM}},update:u=_n({},o,{opacity:dM,text:pT(e.title)}),exit:{opacity:cM}},c={signal:`lerp(range("${e.scale}"), ${bM(0,1,.5)})`};return u.x=hB(s,c),u.y=fB(s,c),o.angle=hB(s,cM,((e,t)=>GT(e)?{signal:`(${e.signal}) * 90`}:{value:90*e})(a)),o.baseline=hB(s,pB(s,ZR,YR),{value:ZR}),u.angle=o.angle,u.baseline=o.baseline,gT(l,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),function(e,t,n,i){const r=(e,t)=>null!=e?(n.update[t]=AB(pT(e),n.update[t]),!1):!vT(t,i),s=r(e("titleX"),"x"),a=r(e("titleY"),"y");n.enter.auto=a===s?pT(a):hB(t,pT(a),pT(s))}(r,s,l,n),l.update.align=AB(l.update.align,o.align),l.update.angle=AB(l.update.angle,o.angle),l.update.baseline=AB(l.update.baseline,o.baseline),CM({type:mM,role:"axis-title",style:iM,from:i,encode:l},n)}(e,n,i.title,d)),rB(gM({role:"axis",from:d,encode:yT(OB(u,e),r,lM),marks:f,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:s,interactive:a,style:o}),t)}function OB(e,t){const n={enter:{},update:{}};return gT(n,{orient:e("orient"),offset:e("offset")||0,position:XT(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function NB(e,t,n){const i=gn(e.signals),r=gn(e.scales);return n||i.forEach((e=>RT(e,t))),gn(e.projections).forEach((e=>function(e,t){const n=t.config.projection||{},i={};for(const n in e)"name"!==n&&(i[n]=XR(e[n],n,t));for(const e in n)null==i[e]&&(i[e]=XR(n[e],e,t));t.addProjection(e.name,i)}(e,t))),r.forEach((e=>function(e,t){const n=e.type||"linear";Ym(n)||Pt("Unrecognized scale type: "+Ln(n)),t.addScale(e.name,{type:n,domain:void 0})}(e,t))),gn(e.data).forEach((e=>function(e,t){const n=[];e.transform&&e.transform.forEach((e=>{n.push(jM(e,t))})),e.on&&e.on.forEach((n=>{iB(n,t,e.name)})),t.addDataPipeline(e.name,function(e,t,n){const i=[];let r,s,a,o,u,l=null,c=!1,d=!1;for(e.values?GT(e.values)||HT(e.format)?(i.push(lB(t,e)),i.push(l=uB())):i.push(l=uB({$ingest:e.values,$format:e.format})):e.url?HT(e.url)||HT(e.format)?(i.push(lB(t,e)),i.push(l=uB())):i.push(l=uB({$request:e.url,$format:e.format})):e.source&&(l=r=gn(e.source).map((e=>LT(t.getData(e).output))),i.push(null)),s=0,a=n.length;s<a;++s)o=n[s],u=o.metadata,l||u.source||i.push(l=uB()),i.push(o),u.generates&&(d=!0),u.modifies&&!d&&(c=!0),u.source?l=o:u.changes&&(l=null);return r&&(a=r.length-1,i[0]=ER({derive:c,pulse:a?r:r[0]}),(c||a)&&i.splice(1,0,uB())),l||i.push(uB()),i.push(DR({})),i}(e,t,n))}(e,t))),r.forEach((e=>RR(e,t))),(n||i).forEach((e=>function(e,t){const n=t.getSignal(e.name);let i=e.update;e.init&&(i?Pt("Signals can not include both init and update expressions."):(i=e.init,n.initonly=!0)),i&&(i=nI(i,t),n.update=i.$expr,n.params=i.$params),e.on&&e.on.forEach((e=>function(e,t,n){const i=e.encode,r={target:n};let s=e.events,a=e.update,o=[];var u,l;s||Pt("Signal update missing events specification."),Rn(s)&&(u=s,l=t.isSubscope()?VT:qT,aT=l||"view",oT=sT,s=lT(u.trim()).map(cT)),s=gn(s).filter((e=>e.signal||e.scale?(o.push(e),0):1)),o.length>1&&(o=[iR(o)]),s.length&&o.push(s.length>1?{merge:s}:s[0]),null!=i&&(a&&Pt("Signal encode and update are mutually exclusive."),a="encode(item(),"+Ln(i)+")"),r.update=Rn(a)?nI(a,t):null!=a.expr?nI(a.expr,t):null!=a.value?a.value:null!=a.signal?{$expr:nR,$params:{$value:t.signalRef(a.signal)}}:Pt("Invalid signal update specification."),e.force&&(r.options={force:!0}),o.forEach((e=>t.addUpdate(_n(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):JT(e,t)}}(e,t),r))))}(e,t,n.id)))}(e,t))),gn(e.axes).forEach((e=>$B(e,t))),gn(e.marks).forEach((e=>rB(e,t))),gn(e.legends).forEach((e=>function(e,t){const n=t.config.legend,i=e.encode||{},r=yM(e,n),s=i.legend||{},a=s.name||void 0,o=s.interactive,u=s.style,l={};let c,d,h,f=0;uM.forEach((t=>e[t]?(l[t]=e[t],f=f||e[t]):0)),f||Pt("Missing valid scale for legend.");const p=function(e,t){let n=e.type||rM;return e.type||1!==function(e){return uM.reduce(((t,n)=>t+(e[n]?1:0)),0)}(e)||!e.fill&&!e.stroke||(n=Jm(t)?sM:Qm(t)?aM:rM),n!==sM?n:Qm(t)?aM:sM}(e,t.scaleType(f)),m={title:null!=e.title,scales:l,type:p,vgrad:"symbol"!==p&&r.isVertical()},g=LT(t.add(uR(null,[m]))),y=LT(t.add(gR(d={type:p,scale:t.scaleRef(f),count:t.objectProperty(r("tickCount")),limit:t.property(r("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===sM?(h=[kM(e,f,n,i.gradient),_M(e,n,i.labels,y)],d.count=d.count||t.signalRef(`max(2,2*floor((${YT(r.gradientLength())})/100))`)):p===aM?h=[AM(e,f,n,i.gradient,y),_M(e,n,i.labels,y)]:(c=function(e,t){const n=yM(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,n),h=[EM(e,n,i,y,YT(c.columns))],d.size=function(e,t,n){return nI(`max(ceil(sqrt(${YT(aB("size",e,n))})+${YT(aB("strokeWidth",e,n))}),${YT(function(e,t,n){return vM("fontSize",e)||function(e,t,n){const i=t.config.style["guide-label"];return i&&i.fontSize}(0,t)}(n[1].encode,t))})`,t)}(e,t,h[0].marks)),h=[gM({role:"legend-entry",from:g,encode:{enter:{x:{value:0},y:{value:0}}},marks:h,layout:c,interactive:o})],m.title&&h.push(function(e,t,n,i){const r=yM(e,t),s={enter:{opacity:cM},update:{opacity:dM,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:cM}};return gT(s,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:IM},angle:{signal:TM},align:{signal:NM},baseline:{signal:RM},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),CM({type:mM,role:"legend-title",style:iM,from:i,encode:s},n)}(e,n,i.title,g)),rB(gM({role:"legend",from:g,encode:yT(sB(r,e,n),s,lM),marks:h,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:a,interactive:o,style:u}),t)}(e,t))),e.title&&function(e,t){const n=yM(e=Rn(e)?{text:e}:e,t.config.title),i=e.encode||{},r=i.group||{},s=r.name||void 0,a=r.interactive,o=r.style,u=[],l=LT(t.add(uR(null,[{}])));u.push(function(e,t,n,i){const r={value:0},s={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return gT(s,{text:e.text,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),CM({type:mM,role:"title-text",style:"group-title",from:i,encode:s},n)}(e,n,function(e){const t=e.encode;return t&&t.title||_n({name:e.name,interactive:e.interactive,style:e.style},t)}(e),l)),e.subtitle&&u.push(function(e,t,n,i){const r={value:0},s={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return gT(s,{text:e.subtitle,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),CM({type:mM,role:"title-subtitle",style:"group-subtitle",from:i,encode:s},n)}(e,n,i.subtitle,l)),rB(gM({role:"title",from:l,encode:oB(n,r),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:s,interactive:a,style:o}),t)}(e.title,t),t.parseLambdas(),t}function IB(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function TB(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function RB(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function MB(e){return(Jt(e)?BB:zB)(e)}function BB(e){const t=e.length;let n="[";for(let i=0;i<t;++i){const t=e[i];n+=(i>0?",":"")+(Zt(t)?t.signal||MB(t):Ln(t))}return n+"]"}function zB(e){let t,n,i="{",r=0;for(t in e)n=e[t],i+=(++r>1?",":"")+Ln(t)+":"+(Zt(n)?n.signal||MB(n):Ln(n));return i+"}"}function LB(e,t,n){return Zt(e)||Pt("Input Vega specification must be an object."),function(e,t){const n=t.config,i=LT(t.root=t.add(zT())),r=function(e,t){const n=n=>XT(e[n],t[n]),i=[IB("background",n("background")),IB("autosize",dT(n("autosize"))),IB("padding",fT(n("padding"))),IB("width",n("width")||0),IB("height",n("height")||0)],r=i.reduce(((e,t)=>(e[t.name]=t,e)),{}),s={};return gn(e.signals).forEach((e=>{Fn(r,e.name)?e=_n(r[e.name],e):i.push(e),s[e.name]=e})),gn(t.signals).forEach((e=>{Fn(s,e.name)||Fn(r,e.name)||i.push(e)})),i}(e,n);r.forEach((e=>RT(e,t))),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const s=t.add(uR()),a=t.add(dR($T((e=>yT({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e))(e.encode),hM,xT,e.style,t,{pulse:LT(s)}))),o=t.add(OR({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:LT(a)}));t.operators.pop(),t.pushState(LT(a),LT(o),null),NB(e,t,r),t.operators.push(o);let u=t.add(oR({mark:i,pulse:LT(o)}));return u=t.add(SR({pulse:LT(u)})),u=t.add(DR({pulse:LT(u)})),t.addData("root",new QM(t,s,s,u)),t}(e,new TB(t=function(...e){return e.reduce(((e,t)=>{for(const n in t)if("signals"===n)e.signals=tn(e.signals,t.signals);else{const i="legend"===n?{layout:1}:"style"===n||null;en(e,n,t[n],i)}return e}),{})}(function(){const e="sans-serif",t="#4c78a8",n="#000",i="#888",r="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:t},area:{fill:t},image:null,line:{stroke:t,strokeWidth:2},path:{stroke:t},rect:{fill:t},rule:{stroke:n},shape:{stroke:t},symbol:{fill:t,size:64},text:{fill:n,font:e,fontSize:11},trail:{fill:t,size:2},style:{"guide-label":{fill:n,font:e,fontSize:10},"guide-title":{fill:n,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:r}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:i,grid:!1,gridWidth:1,gridColor:r,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:i,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:r,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:i,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),t,e.config),n)).toRuntime()}function PB(e,t,n){return e.fields=t||[],e.fname=n,e}function jB(e){return 1===e.length?UB(e[0]):WB(e)}TB.prototype=RB.prototype={parse(e){return NB(e,this)},fork(){return new RB(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((t=>{t.$ref=e.id})),e.refs=null),e},proxy(e){const t=e instanceof MT?LT(e):e;return this.add(_R({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){let i,r;e&&(i=e.data||(e.data={}),r=i[t]||(i[t]=[]),r.push(n))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const i in t.index)n(t.index[i],e,"index:"+i)}return this},pushState(e,t,n){this._encode.push(LT(this.add(DR({pulse:e})))),this._parent.push(t),this._lookup.push(n?LT(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return nn(this._parent)},encode(){return nn(this._encode)},lookup(){return nn(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(Rn(e))return PT(e,t);e.signal||Pt("Unsupported field reference: "+Ln(e));const n=e.signal;let i=this.field[n];if(!i){const e={name:this.signalRef(n)};t&&(e.as=t),this.field[n]=i=LT(this.add(pR(e)))}return i},compareRef(e){let t=!1;const n=e=>GT(e)?(t=!0,this.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(t=!0,this.exprRef(e.expr)):e,i=gn(e.field).map(n),r=gn(e.order).map(n);return t?LT(this.add(lR({fields:i,orders:r}))):UT(i,r)},keyRef(e,t){let n=!1;const i=this.signals;return e=gn(e).map((e=>GT(e)?(n=!0,LT(i[e.signal])):e)),n?LT(this.add(mR({fields:e,flat:t}))):function(e,t){const n={$key:e};return t&&(n.$flat=!0),n}(e,t)},sortRef(e){if(!e)return e;const t=WT(e.op,e.field),n=e.order||"ascending";return n.signal?LT(this.add(lR({fields:t,orders:this.signalRef(n.signal)}))):UT(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},hasOwnSignal(e){return Fn(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&Pt("Duplicate signal name: "+Ln(e));const n=t instanceof MT?t:this.add(zT(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||Pt("Unrecognized signal name: "+Ln(e)),this.signals[e]},signalRef(e){return this.signals[e]?LT(this.signals[e]):(Fn(this.lambdas,e)||(this.lambdas[e]=this.add(zT(null))),LT(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const n=e[t],i=nI(n,this),r=this.lambdas[n];r.params=i.$params,r.update=i.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&Zt(e)?this.signalRef(e.signal||MB(e)):e},exprRef(e,t){const n={expr:nI(e,this)};return t&&(n.expr.$name=t),LT(this.add(hR(n)))},addBinding(e,t){this.bindings||Pt("Nested signals do not support binding: "+Ln(e)),this.bindings.push(_n({signal:e},t))},addScaleProj(e,t){Fn(this.scales,e)&&Pt("Duplicate scale or projection name: "+Ln(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,FR(t))},addProjection(e,t){this.addScaleProj(e,AR(t))},getScale(e){return this.scales[e]||Pt("Unrecognized scale name: "+Ln(e)),this.scales[e]},scaleRef(e){return LT(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return Fn(this.data,e)&&Pt("Duplicate data set name: "+Ln(e)),this.data[e]=t},getData(e){return this.data[e]||Pt("Undefined data set name: "+Ln(e)),this.data[e]},addDataPipeline(e,t){return Fn(this.data,e)&&Pt("Duplicate data set name: "+Ln(e)),this.addData(e,QM.fromEntries(this,t))}};const UB=e=>function(t){return t[e]},WB=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function VB(e){throw Error(e)}function qB(e){return"function"==typeof e}(function(e,t,n){const i=function(e){const t=[],n=e.length;let i,r,s,a=null,o=0,u="";function l(){t.push(u+e.substring(i,r)),u="",i=r+1}for(e+="",i=r=0;r<n;++r)if(s=e[r],"\\"===s)u+=e.substring(i,r),u+=e.substring(++r,++r),i=r;else if(s===a)l(),a=null,o=-1;else{if(a)continue;i===o&&'"'===s||i===o&&"'"===s?(i=r+1,a=s):"."!==s||o?"["===s?(r>i&&l(),o=i=r+1):"]"===s&&(o||VB("Access path missing open bracket: "+e),o>0&&l(),o=0,i=r+1):r>i?l():i=r+1}return o&&VB("Access path missing closing bracket: "+e),a&&VB("Access path missing closing quote: "+e),r>i&&(r++,l()),t}(e);e=1===i.length?i[0]:e,PB((n&&n.get||jB)(i),[e],t||e)})("id"),PB((e=>e),[],"identity"),PB((()=>0),[],"zero"),PB((()=>1),[],"one"),PB((()=>!0),[],"true"),PB((()=>!1),[],"false"),Array.isArray;const GB=Object.prototype.hasOwnProperty;function HB(e,t){return GB.call(e,t)}function XB(e){const t={},n=e.length;for(let i=0;i<n;++i)t[e[i]]=!0;return t}function YB(e){this.type=e}var KB,JB,ZB,QB,ez;YB.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case"CallExpression":return[e.callee].concat(e.arguments);case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this),n=0,i=t.length;n<i;++n)if(t[n].visit(e))return 1},(KB={})[1]="Boolean",KB[2]="<end>",KB[3]="Identifier",KB[4]="Keyword",KB[5]="Null",KB[6]="Numeric",KB[7]="Punctuator",KB[8]="String",KB[9]="RegularExpression";var tz="Identifier",nz="Unexpected token %0",iz="Invalid regular expression",rz="Invalid regular expression: missing /",sz="Octal literals are not allowed in strict mode.",az="ILLEGAL",oz="Disabled.",uz=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),lz=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function cz(e,t){if(!e)throw new Error("ASSERT: "+t)}function dz(e){return e>=48&&e<=57}function hz(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function fz(e){return"01234567".indexOf(e)>=0}function pz(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function mz(e){return 10===e||13===e||8232===e||8233===e}function gz(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&uz.test(String.fromCharCode(e))}function yz(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&lz.test(String.fromCharCode(e))}const vz={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function bz(){for(;ZB<QB;){const e=JB.charCodeAt(ZB);if(!pz(e)&&!mz(e))break;++ZB}}function xz(e){var t,n,i,r=0;for(n="u"===e?4:2,t=0;t<n;++t)ZB<QB&&hz(JB[ZB])?(i=JB[ZB++],r=16*r+"0123456789abcdef".indexOf(i.toLowerCase())):Tz({},nz,az);return String.fromCharCode(r)}function wz(){var e,t,n,i;for(t=0,"}"===(e=JB[ZB])&&Tz({},nz,az);ZB<QB&&hz(e=JB[ZB++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&Tz({},nz,az),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),i=56320+(t-65536&1023),String.fromCharCode(n,i))}function Cz(){var e,t;for(e=JB.charCodeAt(ZB++),t=String.fromCharCode(e),92===e&&(117!==JB.charCodeAt(ZB)&&Tz({},nz,az),++ZB,(e=xz("u"))&&"\\"!==e&&gz(e.charCodeAt(0))||Tz({},nz,az),t=e);ZB<QB&&yz(e=JB.charCodeAt(ZB));)++ZB,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==JB.charCodeAt(ZB)&&Tz({},nz,az),++ZB,(e=xz("u"))&&"\\"!==e&&yz(e.charCodeAt(0))||Tz({},nz,az),t+=e);return t}function kz(){var e,t,n,i,r=ZB,s=JB.charCodeAt(ZB),a=JB[ZB];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++ZB,{type:7,value:String.fromCharCode(s),start:r,end:ZB};default:if(61===(e=JB.charCodeAt(ZB+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return ZB+=2,{type:7,value:String.fromCharCode(s)+String.fromCharCode(e),start:r,end:ZB};case 33:case 61:return ZB+=2,61===JB.charCodeAt(ZB)&&++ZB,{type:7,value:JB.slice(r,ZB),start:r,end:ZB}}}return">>>="===(i=JB.substr(ZB,4))?{type:7,value:i,start:r,end:ZB+=4}:">>>"===(n=i.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:r,end:ZB+=3}:a===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(a)>=0||"=>"===t?{type:7,value:t,start:r,end:ZB+=2}:("//"===t&&Tz({},nz,az),"<>=!+-*%&|^/".indexOf(a)>=0?{type:7,value:a,start:r,end:++ZB}:void Tz({},nz,az))}function Az(){var e,t,n;if(cz(dz((n=JB[ZB]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=ZB,e="","."!==n){if(e=JB[ZB++],n=JB[ZB],"0"===e){if("x"===n||"X"===n)return++ZB,function(e){let t="";for(;ZB<QB&&hz(JB[ZB]);)t+=JB[ZB++];return 0===t.length&&Tz({},nz,az),gz(JB.charCodeAt(ZB))&&Tz({},nz,az),{type:6,value:parseInt("0x"+t,16),start:e,end:ZB}}(t);if(fz(n))return function(e){let t="0"+JB[ZB++];for(;ZB<QB&&fz(JB[ZB]);)t+=JB[ZB++];return(gz(JB.charCodeAt(ZB))||dz(JB.charCodeAt(ZB)))&&Tz({},nz,az),{type:6,value:parseInt(t,8),octal:!0,start:e,end:ZB}}(t);n&&dz(n.charCodeAt(0))&&Tz({},nz,az)}for(;dz(JB.charCodeAt(ZB));)e+=JB[ZB++];n=JB[ZB]}if("."===n){for(e+=JB[ZB++];dz(JB.charCodeAt(ZB));)e+=JB[ZB++];n=JB[ZB]}if("e"===n||"E"===n)if(e+=JB[ZB++],"+"!==(n=JB[ZB])&&"-"!==n||(e+=JB[ZB++]),dz(JB.charCodeAt(ZB)))for(;dz(JB.charCodeAt(ZB));)e+=JB[ZB++];else Tz({},nz,az);return gz(JB.charCodeAt(ZB))&&Tz({},nz,az),{type:6,value:parseFloat(e),start:t,end:ZB}}function _z(){if(bz(),ZB>=QB)return{type:2,start:ZB,end:ZB};const e=JB.charCodeAt(ZB);return gz(e)?function(){var e,t;return e=ZB,{type:1===(t=92===JB.charCodeAt(ZB)?Cz():function(){var e,t;for(e=ZB++;ZB<QB;){if(92===(t=JB.charCodeAt(ZB)))return ZB=e,Cz();if(!yz(t))break;++ZB}return JB.slice(e,ZB)}()).length?3:vz.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:ZB}}():40===e||41===e||59===e?kz():39===e||34===e?function(){var e,t,n,i,r="",s=!1;for(cz("'"===(e=JB[ZB])||'"'===e,"String literal must starts with a quote"),t=ZB,++ZB;ZB<QB;){if((n=JB[ZB++])===e){e="";break}if("\\"===n)if((n=JB[ZB++])&&mz(n.charCodeAt(0)))"\r"===n&&"\n"===JB[ZB]&&++ZB;else switch(n){case"u":case"x":"{"===JB[ZB]?(++ZB,r+=wz()):r+=xz(n);break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:fz(n)?(0!==(i="01234567".indexOf(n))&&(s=!0),ZB<QB&&fz(JB[ZB])&&(s=!0,i=8*i+"01234567".indexOf(JB[ZB++]),"0123".indexOf(n)>=0&&ZB<QB&&fz(JB[ZB])&&(i=8*i+"01234567".indexOf(JB[ZB++]))),r+=String.fromCharCode(i)):r+=n}else{if(mz(n.charCodeAt(0)))break;r+=n}}return""!==e&&Tz({},nz,az),{type:8,value:r,octal:s,start:t,end:ZB}}():46===e?dz(JB.charCodeAt(ZB+1))?Az():kz():dz(e)?Az():kz()}function Ez(){const e=ez;return ZB=e.end,ez=_z(),ZB=e.end,e}function Sz(){const e=ZB;ez=_z(),ZB=e}function Fz(e,t,n){const i=new YB("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return i.operator=e,i.left=t,i.right=n,i}function Dz(e,t){const n=new YB("CallExpression");return n.callee=e,n.arguments=t,n}function $z(e){const t=new YB(tz);return t.name=e,t}function Oz(e){const t=new YB("Literal");return t.value=e.value,t.raw=JB.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function Nz(e,t,n){const i=new YB("MemberExpression");return i.computed="["===e,i.object=t,i.property=n,i.computed||(n.member=!0),i}function Iz(e,t,n){const i=new YB("Property");return i.key=t,i.value=n,i.kind=e,i}function Tz(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,((e,t)=>(cz(t<i.length,"Message reference must be in range"),i[t])));throw(n=new Error(r)).index=ZB,n.description=r,n}function Rz(e){2===e.type&&Tz(e,"Unexpected end of input"),6===e.type&&Tz(e,"Unexpected number"),8===e.type&&Tz(e,"Unexpected string"),3===e.type&&Tz(e,"Unexpected identifier"),4===e.type&&Tz(e,"Unexpected reserved word"),Tz(e,nz,e.value)}function Mz(e){const t=Ez();7===t.type&&t.value===e||Rz(t)}function Bz(e){return 7===ez.type&&ez.value===e}function zz(e){return 4===ez.type&&ez.value===e}function Lz(){ZB=ez.start;const e=Ez();return 8===e.type||6===e.type?(e.octal&&Tz(e,sz),Oz(e)):$z(e.value)}function Pz(){var e,t,n;return ZB=ez.start,3===(e=ez).type?(n=Lz(),Mz(":"),Iz("init",n,Xz())):2!==e.type&&7!==e.type?(t=Lz(),Mz(":"),Iz("init",t,Xz())):void Rz(e)}const jz={if:1};function Uz(){var e,t,n;if(Bz("("))return function(){Mz("(");const e=Yz();return Mz(")"),e}();if(Bz("["))return function(){const e=[];for(ZB=ez.start,Mz("[");!Bz("]");)Bz(",")?(Ez(),e.push(null)):(e.push(Xz()),Bz("]")||Mz(","));return Ez(),function(e){const t=new YB("ArrayExpression");return t.elements=e,t}(e)}();if(Bz("{"))return function(){var e,t,n=[],i={},r=String;for(ZB=ez.start,Mz("{");!Bz("}");)t="$"+((e=Pz()).key.type===tz?e.key.name:r(e.key.value)),Object.prototype.hasOwnProperty.call(i,t)?Tz({},"Duplicate data property in object literal not allowed in strict mode"):i[t]=!0,n.push(e),Bz("}")||Mz(",");return Mz("}"),function(e){const t=new YB("ObjectExpression");return t.properties=e,t}(n)}();if(e=ez.type,ZB=ez.start,3===e||jz[ez.value])n=$z(Ez().value);else if(8===e||6===e)ez.octal&&Tz(ez,sz),n=Oz(Ez());else{if(4===e)throw new Error(oz);1===e?((t=Ez()).value="true"===t.value,n=Oz(t)):5===e?((t=Ez()).value=null,n=Oz(t)):Bz("/")||Bz("/=")?(n=Oz(function(){var e,t,n,i;return ez=null,bz(),e=ZB,t=function(){var e,t,n,i;for(cz("/"===(e=JB[ZB]),"Regular expression literal must start with a slash"),t=JB[ZB++],n=!1,i=!1;ZB<QB;)if(t+=e=JB[ZB++],"\\"===e)mz((e=JB[ZB++]).charCodeAt(0))&&Tz({},rz),t+=e;else if(mz(e.charCodeAt(0)))Tz({},rz);else if(n)"]"===e&&(n=!1);else{if("/"===e){i=!0;break}"["===e&&(n=!0)}return i||Tz({},rz),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";ZB<QB&&yz((e=JB[ZB]).charCodeAt(0));)++ZB,"\\"===e&&ZB<QB?Tz({},nz,az):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&Tz({},iz,n),{value:n,literal:t}}(),i=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((e,t)=>{if(parseInt(t,16)<=1114111)return"x";Tz({},iz)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){Tz({},iz)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:ZB}}()),Sz()):Rz(Ez())}return n}function Wz(){const e=[];if(Mz("("),!Bz(")"))for(;ZB<QB&&(e.push(Xz()),!Bz(")"));)Mz(",");return Mz(")"),e}function Vz(){Mz("[");const e=Yz();return Mz("]"),e}function qz(){const e=function(){var e;for(e=Uz();;)if(Bz("."))e=Nz(".",e,(Mz("."),function(){ZB=ez.start;const e=Ez();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||Rz(e),$z(e.value)}()));else if(Bz("("))e=Dz(e,Wz());else{if(!Bz("["))break;e=Nz("[",e,Vz())}return e}();if(7===ez.type&&(Bz("++")||Bz("--")))throw new Error(oz);return e}function Gz(){var e,t;if(7!==ez.type&&4!==ez.type)t=qz();else{if(Bz("++")||Bz("--"))throw new Error(oz);if(Bz("+")||Bz("-")||Bz("~")||Bz("!"))e=Ez(),t=Gz(),t=function(e,t){const n=new YB("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(zz("delete")||zz("void")||zz("typeof"))throw new Error(oz);t=qz()}}return t}function Hz(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Xz(){var e,t;return e=function(){var e,t,n,i,r,s,a,o,u,l;if(e=ez,u=Gz(),0===(r=Hz(i=ez)))return u;for(i.prec=r,Ez(),t=[e,ez],s=[u,i,a=Gz()];(r=Hz(ez))>0;){for(;s.length>2&&r<=s[s.length-2].prec;)a=s.pop(),o=s.pop().value,u=s.pop(),t.pop(),n=Fz(o,u,a),s.push(n);(i=Ez()).prec=r,s.push(i),t.push(ez),n=Gz(),s.push(n)}for(n=s[l=s.length-1],t.pop();l>1;)t.pop(),n=Fz(s[l-1].value,s[l-2],n),l-=2;return n}(),Bz("?")&&(Ez(),t=Xz(),Mz(":"),e=function(e,t,n){const i=new YB("ConditionalExpression");return i.test=e,i.consequent=t,i.alternate=n,i}(e,t,Xz())),e}function Yz(){const e=Xz();if(Bz(","))throw new Error(oz);return e}function Kz(e){ZB=0,QB=(JB=e).length,ez=null,Sz();const t=Yz();if(2!==ez.type)throw new Error("Unexpect token after expression.");return t}var Jz={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Zz(e){function t(t,n,i){return r=>function(t,n,i,r){let s=e(n[0]);return i&&(s=i+"("+s+")",0===i.lastIndexOf("new ",0)&&(s="("+s+")")),s+"."+t+(r<0?"":0===r?"()":"("+n.slice(1).map(e).join(",")+")")}(t,r,n,i)}const n="new Date",i="String",r="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&VB("Missing arguments to clamp function."),t.length>3&&VB("Too many arguments to clamp function.");const n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase",i,0),lower:t("toLowerCase",i,0),substring:t("substring",i),split:t("split",i),trim:t("trim",i,0),regexp:r,test:t("test",r),if:function(t){t.length<3&&VB("Missing arguments to if function."),t.length>3&&VB("Too many arguments to if function.");const n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function Qz(e){const t=(e=e||{}).allowed?XB(e.allowed):{},n=e.forbidden?XB(e.forbidden):{},i=e.constants||Jz,r=(e.functions||Zz)(d),s=e.globalvar,a=e.fieldvar,o=qB(s)?s:e=>"".concat(s,'["').concat(e,'"]');let u={},l={},c=0;function d(e){if("string"==typeof e)return e;const t=h[e.type];return null==t&&VB("Unsupported type: "+e.type),t(e)}const h={Literal:e=>e.raw,Identifier:e=>{const r=e.name;return c>0?r:HB(n,r)?VB("Illegal identifier: "+r):HB(i,r)?i[r]:HB(t,r)?r:(u[r]=1,o(r))},MemberExpression:e=>{const t=!e.computed,n=d(e.object);t&&(c+=1);const i=d(e.property);return n===a&&(l[function(e){const t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(i)]=1),t&&(c-=1),n+(t?"."+i:"["+i+"]")},CallExpression:e=>{"Identifier"!==e.callee.type&&VB("Illegal callee type: "+e.callee.type);const t=e.callee.name,n=e.arguments,i=HB(r,t)&&r[t];return i||VB("Unrecognized function: "+t),qB(i)?i(n):i+"("+n.map(d).join(",")+")"},ArrayExpression:e=>"["+e.elements.map(d).join(",")+"]",BinaryExpression:e=>"("+d(e.left)+" "+e.operator+" "+d(e.right)+")",UnaryExpression:e=>"("+e.operator+d(e.argument)+")",ConditionalExpression:e=>"("+d(e.test)+"?"+d(e.consequent)+":"+d(e.alternate)+")",LogicalExpression:e=>"("+d(e.left)+e.operator+d(e.right)+")",ObjectExpression:e=>"{"+e.properties.map(d).join(",")+"}",Property:e=>{c+=1;const t=d(e.key);return c-=1,t+":"+d(e.value)}};function f(e){const t={code:d(e),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},t}return f.functions=r,f.constants=i,f}const eL=/[[\]{}]/,tL={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let nL,iL;function rL(e,t,n){return nL=t||"view",iL=n||tL,aL(e.trim()).map(oL)}function sL(e,t,n,i,r){const s=e.length;let a,o=0;for(;t<s;++t){if(a=e[t],!o&&a===n)return t;r&&r.indexOf(a)>=0?--o:i&&i.indexOf(a)>=0&&++o}return t}function aL(e){const t=[],n=e.length;let i=0,r=0;for(;r<n;)r=sL(e,r,",","[{","]}"),t.push(e.substring(i,r).trim()),i=++r;if(0===t.length)throw"Empty event selector: "+e;return t}function oL(e){return"["===e[0]?function(e){const t=e.length;let n,i=1;if(i=sL(e,i,"]","[","]"),i===t)throw"Empty between selector: "+e;if(n=aL(e.substring(1,i)),2!==n.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(i+1).trim())[0])throw"Expected '>' after between selector: "+e;n=n.map(oL);const r=oL(e.slice(1).trim());return r.between?{between:n,stream:r}:(r.between=n,r)}(e):function(e){const t={source:nL},n=[];let i,r,s=[0,0],a=0,o=0,u=e.length,l=0;if("}"===e[u-1]){if(l=e.lastIndexOf("{"),!(l>=0))throw"Unmatched right brace: "+e;try{s=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map((t=>{const n=+t;if(n!=n)throw e;return n}))}(e.substring(l+1,u-1))}catch(t){throw"Invalid throttle specification: "+e}u=(e=e.slice(0,l).trim()).length,l=0}if(!u)throw e;if("@"===e[0]&&(a=++l),i=sL(e,l,":"),i<u&&(n.push(e.substring(o,i).trim()),o=l=++i),l=sL(e,l,"["),l===u)n.push(e.substring(o,u).trim());else if(n.push(e.substring(o,l).trim()),r=[],o=++l,o===u)throw"Unmatched left bracket: "+e;for(;l<u;){if(l=sL(e,l,"]"),l===u)throw"Unmatched left bracket: "+e;if(r.push(e.substring(o,l).trim()),l<u-1&&"["!==e[++l])throw"Expected left bracket: "+e;o=++l}if(!(u=n.length)||eL.test(n[u-1]))throw"Invalid event selector: "+e;var c;return u>1?(t.type=n[1],a?t.markname=n[0].slice(1):(c=n[0],iL[c]?t.marktype=n[0]:t.source=n[0])):t.type=n[0],"!"===t.type.slice(-1)&&(t.consume=!0,t.type=t.type.slice(0,-1)),null!=r&&(t.filter=r),s[0]&&(t.throttle=s[0]),s[1]&&(t.debounce=s[1]),t}(e)}it(Ou,s,o,u,l,c,h,d,f,p,m,g);const uL="5.20.0";function lL(e,t,n){return e.fields=t||[],e.fname=n,e}function cL(e){return 1===e.length?dL(e[0]):hL(e)}const dL=e=>function(t){return t[e]},hL=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function fL(e){throw Error(e)}function pL(e){var t,n,i,r=[],s=null,a=0,o=e.length,u="";function l(){r.push(u+e.substring(t,n)),u="",t=n+1}for(e+="",t=n=0;n<o;++n)if("\\"===(i=e[n]))u+=e.substring(t,n),u+=e.substring(++n,++n),t=n;else if(i===s)l(),s=null,a=-1;else{if(s)continue;t===a&&'"'===i||t===a&&"'"===i?(t=n+1,s=i):"."!==i||a?"["===i?(n>t&&l(),a=t=n+1):"]"===i&&(a||fL("Access path missing open bracket: "+e),a>0&&l(),a=0,t=n+1):n>t?l():t=n+1}return a&&fL("Access path missing closing bracket: "+e),s&&fL("Access path missing closing quote: "+e),n>t&&(n++,l()),r}var mL=[],gL=(function(e,t,n){const i=pL(e);e=1===i.length?i[0]:e,lL(cL(i),[e],e)}("id"),lL((function(e){return e}),mL,"identity"));function yL(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}lL((function(){return 0}),mL,"zero"),lL((function(){return 1}),mL,"one"),lL((function(){return!0}),mL,"true"),lL((function(){return!1}),mL,"false");const vL=Array.isArray;function bL(e){return e===Object(e)}const xL=e=>"__proto__"!==e;function wL(...e){return e.reduce(((e,t)=>{for(var n in t)if("signals"===n)e.signals=kL(e.signals,t.signals);else{var i="legend"===n?{layout:1}:"style"===n||null;CL(e,n,t[n],i)}return e}),{})}function CL(e,t,n,i){var r,s;if(xL(t))if(bL(n)&&!vL(n))for(r in s=bL(e[t])?e[t]:e[t]={},n)i&&(!0===i||i[r])?CL(s,r,n[r]):xL(r)&&(s[r]=n[r]);else e[t]=n}function kL(e,t){if(null==e)return t;const n={},i=[];function r(e){n[e.name]||(n[e.name]=1,i.push(e))}return t.forEach(r),e.forEach(r),i}function AL(e){return null!=e?vL(e)?e:[e]:[]}const _L=Object.prototype.hasOwnProperty;function EL(e,t){return _L.call(e,t)}function SL(e){return"boolean"==typeof e}function FL(e){return"number"==typeof e}function DL(e){return"string"==typeof e}function $L(e){return vL(e)?"["+e.map($L)+"]":bL(e)||DL(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function OL(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t}function NL(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}Object.create,Object.create,Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var IL=n(8138),TL=n.n(IL),RL=n(9378),ML=n.n(RL),BL=n(5695),zL=n.n(BL);function LL(e){return!!e.or}function PL(e){return!!e.and}function jL(e){return!!e.not}function UL(e,t){if(jL(e))UL(e.not,t);else if(PL(e))for(const n of e.and)UL(n,t);else if(LL(e))for(const n of e.or)UL(n,t);else t(e)}function WL(e,t){return jL(e)?{not:WL(e.not,t)}:PL(e)?{and:e.and.map((e=>WL(e,t)))}:LL(e)?{or:e.or.map((e=>WL(e,t)))}:t(e)}const VL=ML(),qL=TL();function GL(e,t){const n={};for(const i of t)EL(e,i)&&(n[i]=e[i]);return n}function HL(e,t){const n=Object.assign({},e);for(const e of t)delete n[e];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map((e=>zL()(e))).join(",")})`};const XL=zL();function YL(e){if(FL(e))return e;const t=DL(e)?e:zL()(e);if(t.length<250)return t;let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n&=n;return n}function KL(e){return!1===e||null===e}function JL(e,t){return e.indexOf(t)>-1}function ZL(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function QL(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function eP(e,t){for(const n of aP(t))CL(e,n,t[n],!0)}function tP(e,t){const n=[],i={};let r;for(const s of e)r=t(s),r in i||(i[r]=1,n.push(s));return n}function nP(e,t){for(const n of e)if(t.has(n))return!0;return!1}function iP(e){const t=new Set;for(const n of e){const e=pL(n).map(((e,t)=>0===t?e:`[${e}]`)),i=e.map(((t,n)=>e.slice(0,n+1).join("")));for(const e of i)t.add(e)}return t}function rP(e,t){return void 0===e||void 0===t||nP(iP(e),iP(t))}function sP(e){return 0===aP(e).length}const aP=Object.keys,oP=Object.values;function uP(e){const t=[];for(const n in e)EL(e,n)&&t.push({key:n,value:e[n]});return t}function lP(e){return!0===e||!1===e}function cP(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function dP(e,t){return jL(e)?"!("+dP(e.not,t)+")":PL(e)?"("+e.and.map((e=>dP(e,t))).join(") && (")+")":LL(e)?"("+e.or.map((e=>dP(e,t))).join(") || (")+")":t(e)}function hP(e,t){if(0===t.length)return!0;const n=t.shift();return n in e&&hP(e[n],t)&&delete e[n],sP(e)}function fP(e){return e.charAt(0).toUpperCase()+e.substr(1)}function pP(e,t="datum"){const n=pL(e),i=[];for(let e=1;e<=n.length;e++){const r=`[${n.slice(0,e).map($L).join("][")}]`;i.push(`${t}${r}`)}return i.join(" && ")}function mP(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function gP(e){return`${pL(e).map(mP).join("\\.")}`}function yP(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function vP(e){return`${pL(e).join(".")}`}function bP(e){return e?pL(e).length:0}function xP(...e){for(const t of e)if(void 0!==t)return t}let wP=42;function CP(e){if(void 0!==e)return(e%360+360)%360}function kP(e){return!!FL(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const AP={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function _P(e){return e&&e.condition}const EP=["domain","grid","labels","ticks","title"],SP={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},FP={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},DP=Object.assign(Object.assign({},FP),{style:1,labelExpr:1,encoding:1});function $P(e){return!!DP[e]}aP(DP);const OP={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},NP=OP.arc,IP=OP.area,TP=OP.bar,RP=OP.image,MP=OP.line,BP=OP.point,zP=OP.rect,LP=OP.rule,PP=OP.text,jP=OP.tick,UP=OP.trail,WP=OP.circle,VP=OP.square,qP=OP.geoshape;function GP(e){return JL(["line","area","trail"],e)}function HP(e){return JL(["rect","bar","image","arc"],e)}const XP=aP(OP);function YP(e){return e.type}OL(XP);const KP=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],JP=aP({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),ZP={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]};function QP(e){return"mark"in e}class ej{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return!!QP(e)&&function(e){return YP(e)?e.type:e}(e.mark)===this.name}}const tj={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},nj={count:1,min:1,max:1};function ij(e){return!!e&&!!e.argmin}function rj(e){return!!e&&!!e.argmax}function sj(e){return DL(e)&&!!tj[e]}aP(tj);const aj=["count","valid","missing","distinct"];function oj(e){return DL(e)&&JL(aj,e)}const uj=["count","sum","distinct","valid","missing"],lj=OL(["mean","average","median","q1","q3","min","max"]),cj="row",dj="column",hj="facet",fj="x",pj="y",mj="x2",gj="y2",yj="radius",vj="radius2",bj="theta",xj="theta2",wj="latitude",Cj="longitude",kj="latitude2",Aj="longitude2",_j="color",Ej="fill",Sj="stroke",Fj="shape",Dj="size",$j="angle",Oj="opacity",Nj="fillOpacity",Ij="strokeOpacity",Tj="strokeWidth",Rj="strokeDash",Mj="text",Bj="order",zj="detail",Lj="key",Pj="tooltip",jj="href",Uj="url",Wj="description",Vj={theta:1,theta2:1,radius:1,radius2:1};function qj(e){return e in Vj}const Gj={longitude:1,longitude2:1,latitude:1,latitude2:1},Hj=aP(Gj),Xj=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),Vj),Gj),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Yj(e){return e===_j||e===Ej||e===Sj}const Kj={row:1,column:1,facet:1},Jj=aP(Kj),Zj=Object.assign(Object.assign({},Xj),Kj),Qj=aP(Zj),{order:eU,detail:tU,tooltip:nU}=Zj,iU=NL(Zj,["order","detail","tooltip"]),{row:rU,column:sU,facet:aU}=iU,oU=NL(iU,["row","column","facet"]);function uU(e){return!!Zj[e]}aP(iU),aP(oU);const lU=[mj,gj,kj,Aj,xj,vj];function cU(e){return dU(e)!==e}function dU(e){switch(e){case mj:return fj;case gj:return pj;case kj:return wj;case Aj:return Cj;case xj:return bj;case vj:return yj}return e}function hU(e){if(qj(e))switch(e){case bj:return"startAngle";case xj:return"endAngle";case yj:return"outerRadius";case vj:return"innerRadius"}return e}function fU(e){switch(e){case fj:return mj;case pj:return gj;case wj:return kj;case Cj:return Aj;case bj:return xj;case yj:return vj}}function pU(e){switch(e){case fj:case mj:return"width";case pj:case gj:return"height"}}aP(Xj);const{x:mU,y:gU,x2:yU,y2:vU,latitude:bU,longitude:xU,latitude2:wU,longitude2:CU,theta:kU,theta2:AU,radius:_U,radius2:EU}=Xj,SU=NL(Xj,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),FU=aP(SU),DU={x:1,y:1},$U=aP(DU);function OU(e){return e in DU}const NU={theta:1,radius:1},IU=aP(NU);function TU(e){return"width"===e?fj:pj}const{text:RU,tooltip:MU,href:BU,url:zU,description:LU,detail:PU,key:jU,order:UU}=SU,WU=NL(SU,["text","tooltip","href","url","description","detail","key","order"]),VU=aP(WU),qU=Object.assign(Object.assign(Object.assign({},DU),NU),WU),GU=aP(qU);function HU(e){return!!qU[e]}const XU={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:YU}=XU,KU=NL(XU,["geoshape"]);function JU(e){switch(e){case fj:case pj:case bj:case yj:case Dj:case $j:case Tj:case Oj:case Nj:case Ij:case mj:case gj:case xj:case vj:return;case hj:case cj:case dj:case Fj:case Rj:case Mj:case Pj:case jj:case Uj:case Wj:return"discrete";case _j:case Ej:case Sj:return"flexible";case wj:case Cj:case kj:case Aj:case zj:case Lj:case Bj:return}}function ZU(e){return SL(e)&&(e=sG(e,void 0)),"bin"+aP(e).map((t=>nW(e[t])?cP(`_${t}_${Object.entries(e[t])}`):cP(`_${t}_${e[t]}`))).join("")}function QU(e){return!0===e||tW(e)&&!e.binned}function eW(e){return"binned"===e||tW(e)&&!0===e.binned}function tW(e){return bL(e)}function nW(e){return null==e?void 0:e.selection}function iW(e){switch(e){case cj:case dj:case Dj:case _j:case Ej:case Sj:case Tj:case Oj:case Nj:case Ij:case Fj:return 6;case Rj:return 4;default:return 10}}function rW(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}function sW(e){return("width"==e?"Width":"Height")+' "container" only works for single views and layered views.'}function aW(e){return`${"width"==e?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==e?"x":"y"}".`}function oW(e){return e?`Dropping "fit-${e}" because spec has discrete ${pU(e)}.`:'Dropping "fit" because spec has discrete size.'}function uW(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function lW(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function cW(e){return`Selection not supported for ${e} yet.`}function dW(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}function hW(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function fW(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function pW(e){return`Invalid field type "${e}".`}function mW(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function gW(e,t){return`Dropping ${XL(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function yW(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function vW(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function bW(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}function xW(e){return`Using unaggregated domain with raw field has no effect (${XL(e)}).`}function wW(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function CW(e){return`Unaggregated domain is currently unsupported for log scale (${XL(e)}).`}function kW(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function AW(e){return`The step for "${e}" is dropped because the ${"width"===e?"x":"y"} is continuous.`}const _W="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function EW(e,t){return`Invalid ${e}: ${XL(t)}.`}function SW(e){return`1D error band does not support ${e}.`}function FW(e){return`Channel ${e} is required for "binned" bin.`}const DW=($W=2,{level:function(e){return arguments.length?($W=+e,this):$W},error:function(){return $W>=1&&yL("error","ERROR",arguments),this},warn:function(){return $W>=2&&yL("warn","WARN",arguments),this},info:function(){return $W>=3&&yL("log","INFO",arguments),this},debug:function(){return $W>=4&&yL("log","DEBUG",arguments),this}});var $W;let OW=DW;function NW(...e){OW.warn(...e)}function IW(e){if(e&&bL(e))for(const t of jW)if(t in e)return!0;return!1}const TW=["january","february","march","april","may","june","july","august","september","october","november","december"],RW=TW.map((e=>e.substr(0,3))),MW=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],BW=MW.map((e=>e.substr(0,3)));function zW(e,t){const n=[];if(t&&void 0!==e.day&&aP(e).length>1&&(NW(function(e){return`Dropping day from datetime ${XL(e)} as day cannot be combined with other units.`}(e)),delete(e=qL(e)).day),void 0!==e.year?n.push(e.year):n.push(2012),void 0!==e.month){const i=t?function(e){if(kP(e)&&(e=+e),FL(e))return e-1;{const t=e.toLowerCase(),n=TW.indexOf(t);if(-1!==n)return n;const i=t.substr(0,3),r=RW.indexOf(i);if(-1!==r)return r;throw new Error(EW("month",e))}}(e.month):e.month;n.push(i)}else if(void 0!==e.quarter){const i=t?function(e){if(kP(e)&&(e=+e),FL(e))return e>4&&NW(EW("quarter",e)),e-1;throw new Error(EW("quarter",e))}(e.quarter):e.quarter;n.push(FL(i)?3*i:i+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){const i=t?function(e){if(kP(e)&&(e=+e),FL(e))return e%7;{const t=e.toLowerCase(),n=MW.indexOf(t);if(-1!==n)return n;const i=t.substr(0,3),r=BW.indexOf(i);if(-1!==r)return r;throw new Error(EW("day",e))}}(e.day):e.day;n.push(FL(i)?i+1:i+"+1")}else n.push(1);for(const t of["hours","minutes","seconds","milliseconds"]){const i=e[t];n.push(void 0===i?0:i)}return n}function LW(e){const t=zW(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}const PW={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},jW=aP(PW);function UW(e){return e.startsWith("utc")}const WW={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function VW(e){const t=[];for(const n of jW)qW(e,n)&&t.push(n);return t}function qW(e,t){const n=e.indexOf(t);return!(n<0||n>0&&"seconds"===t&&"i"===e.charAt(n-1)||e.length>n+3&&"day"===t&&"o"===e.charAt(n+3)||n>0&&"year"===t&&"f"===e.charAt(n-1))}function GW(e){if(!e)return;const t=VW(e);return`timeUnitSpecifier(${zL()(t)}, ${zL()(WW)})`}function HW(e){if(!e)return;let t;return DL(e)?t={unit:e}:bL(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),UW(t.unit)&&(t.utc=!0,t.unit=t.unit.substr(3)),t}function XW(e){return e&&!!e.signal}function YW(e){return!!e.step}function KW(e){return!vL(e)&&"field"in e&&"data"in e}const JW=aP({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),ZW={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},QW=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function eV(e){return e&&!!e.field&&void 0!==e.equal}function tV(e){return e&&!!e.field&&void 0!==e.lt}function nV(e){return e&&!!e.field&&void 0!==e.lte}function iV(e){return e&&!!e.field&&void 0!==e.gt}function rV(e){return e&&!!e.field&&void 0!==e.gte}function sV(e){if(e&&e.field){if(vL(e.range)&&2===e.range.length)return!0;if(XW(e.range))return!0}return!1}function aV(e){return e&&!!e.field&&(vL(e.oneOf)||vL(e.in))}function oV(e){return aV(e)||eV(e)||sV(e)||tV(e)||iV(e)||nV(e)||rV(e)}function uV(e,t){return uG(e,{timeUnit:t,wrapTime:!0})}function lV(e,t=!0){var n;const{field:i}=e,r=null===(n=HW(e.timeUnit))||void 0===n?void 0:n.unit,s=r?"time("+function(e,t,{end:n}={end:!1}){const i=pP(t),r=UW(e)?"utc":"";let s;const a={};for(const t of jW)qW(e,t)&&(a[t]="quarter"===(o=t)?`(${r}quarter(${i})-1)`:`${r}${o}(${i})`,s=t);var o;return n&&(a[s]+="+1"),function(e){const t=zW(e,!1).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}(a)}(r,i)+")":Vq(e,{expr:"datum"});if(eV(e))return s+"==="+uV(e.equal,r);if(tV(e))return`${s}<${uV(e.lt,r)}`;if(iV(e))return`${s}>${uV(e.gt,r)}`;if(nV(e))return`${s}<=${uV(e.lte,r)}`;if(rV(e))return`${s}>=${uV(e.gte,r)}`;if(aV(e))return`indexof([${function(e,t){return e.map((e=>uV(e,t)))}(e.oneOf,r).join(",")}], ${s}) !== -1`;if(function(e){return e&&!!e.field&&void 0!==e.valid}(e))return cV(s,e.valid);if(sV(e)){const{range:n}=e,i=XW(n)?{signal:`${n.signal}[0]`}:n[0],a=XW(n)?{signal:`${n.signal}[1]`}:n[1];if(null!==i&&null!==a&&t)return"inrange("+s+", ["+uV(i,r)+", "+uV(a,r)+"])";const o=[];return null!==i&&o.push(`${s} >= ${uV(i,r)}`),null!==a&&o.push(`${s} <= ${uV(a,r)}`),o.length>0?o.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function cV(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function dV(e){var t;return oV(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:null===(t=HW(e.timeUnit))||void 0===t?void 0:t.unit}):e}const hV={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},fV=hV.quantitative,pV=hV.ordinal,mV=hV.temporal,gV=hV.nominal,yV=hV.geojson,vV=aP(hV),bV="linear",xV="time",wV="utc",CV="point",kV={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},AV=aP(kV);function _V(e,t){const n=kV[e],i=kV[t];return n===i||"ordinal-position"===n&&"time"===i||"ordinal-position"===i&&"time"===n}const EV={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function SV(e){return EV[e]}const FV=["linear","log","pow","sqrt","symlog","time","utc"],DV=OL(FV),$V=OL(["linear","log","pow","sqrt","symlog"]),OV=OL(["quantile","quantize","threshold"]),NV=OL(FV.concat(["quantile","quantize","threshold","sequential","identity"])),IV=OL(["ordinal","bin-ordinal","point","band"]);function TV(e){return e in IV}function RV(e){return e in NV}function MV(e){return e in DV}function BV(e){return e in OV}function zV(e){return null==e?void 0:e.selection}const LV={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:PV,domain:jV,range:UV,scheme:WV}=(aP(LV),LV),VV=NL(LV,["type","domain","range","scheme"]),qV=aP(VV);function GV(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!JL(["point","band","identity"],e);case"bins":return!JL(["point","band","identity","ordinal"],e);case"round":return MV(e)||"band"===e||"point"===e;case"padding":return MV(e)||JL(["point","band"],e);case"paddingOuter":case"align":return JL(["point","band"],e);case"paddingInner":return"band"===e;case"domainMid":case"clamp":return MV(e);case"nice":return MV(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return RV(e)&&!JL(["log","time","utc","threshold","quantile"],e)}}function HV(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Yj(e)?void 0:`Cannot use the scale property "${e}" with non-color channel.`;case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function XV(e,t){return JL([pV,gV],t)?void 0===e||TV(e):t===mV?JL([xV,wV,void 0],e):t!==fV||JL(["log","pow","sqrt","symlog","quantile","quantize","threshold",bV,void 0],e)}function YV(e,t){if(!HU(e))return!1;switch(e){case fj:case pj:case bj:case yj:return MV(t)||JL(["band","point"],t);case Dj:case Tj:case Oj:case Nj:case Ij:case $j:return MV(t)||BV(t)||JL(["band","point","ordinal"],t);case _j:case Ej:case Sj:return"band"!==t;case Rj:return"ordinal"===t||BV(t);case Fj:return"ordinal"===t}}function KV(e,t){return e+"_"+t}function JV(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:s}=e,a=iq(e);return Nq(n)&&!oj(n.aggregate)&&r&&MV(r.get("type"))&&!1===r.get("zero")?ZV({fieldDef:n,channel:t,markDef:i,ref:a,config:s}):a}function ZV({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){return GP(n.type)||null===yG("invalid",n,r)?i:[QV(e,t),i]}function QV(e,t){const n=eq(e,!0),i="y"===dU(t)?{field:{group:"height"}}:{value:0};return Object.assign({test:n},i)}function eq(e,t=!0){return cV(DL(e)?e:Vq(e,{expr:"datum"}),!t)}function tq(e,t,n,i){const r={};if(t&&(r.scale=t),Tq(e)){const{datum:t}=e;IW(t)?r.signal=LW(t):XW(t)?r.signal=t.signal:r.value=t}else r.field=Vq(e,n);if(i){const{offset:e,band:t}=i;e&&(r.offset=e),t&&(r.band=t)}return r}function nq({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,band:s=.5}){const a=0<s&&s<1?"datum":void 0,o=Vq(t,{expr:a,suffix:r}),u=void 0!==n?Vq(n,{expr:a}):Vq(t,{suffix:"end",expr:a}),l={};if(0===s||1===s){l.scale=e;const t=0===s?o:u;l.field=t}else{const t=`${s} * ${o} + ${1-s} * ${u}`;l.signal=`scale("${e}", ${t})`}return i&&(l.offset=i),l}function iq({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:a,stack:o,offset:u,defaultRef:l,band:c}){var d;if(t){if(Bq(t)){if(zq(t)){c=null!=c?c:Sq({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:o,config:r,isMidPoint:!0});const{bin:a,timeUnit:l,type:d}=t;if(QU(a)||c&&l&&d===mV)return o&&o.impute?tq(t,s,{binSuffix:"mid"},{offset:u}):c?nq({scaleName:s,fieldOrDatumDef:t,band:c,offset:u}):tq(t,s,cG(t,e)?{binSuffix:"range"}:{},{offset:u});if(eW(a)){if(Nq(n))return nq({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:u});NW(FW(e===fj?mj:gj))}}const l=null==a?void 0:a.get("type");return tq(t,s,TV(l)?{binSuffix:"range"}:{},{offset:u,band:"band"===l?null!==(d=null!=c?c:t.band)&&void 0!==d?d:.5:void 0})}if(Lq(t)){const n=t.value,i=u?{offset:u}:{};return Object.assign(Object.assign({},rq(e,n)),i)}}return"function"==typeof l&&(l=l()),l?Object.assign(Object.assign({},l),u?{offset:u}:{}):l}function rq(e,t){return JL(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:JL(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:fG(t)}function sq(e){return e&&"number"!==e&&"time"!==e}function aq(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}function oq({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s}){var a,o;if(sq(n))return lq({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:s});const u=uq(e,i,r);if(oG(e)){const n=function(e,t,n,i,r){return!t||n?`${r?"utc":"time"}Format(${e}, '${n=DL(n)?n:i}')`:function(e,t,n){if(!e)return;const i=GW(e);return`${n||UW(e)?"utc":"time"}Format(${t}, ${i})`}(t,e,r)}(u,Nq(e)?null===(a=HW(e.timeUnit))||void 0===a?void 0:a.unit:void 0,t,s.timeFormat,Pq(e)&&(null===(o=e.scale)||void 0===o?void 0:o.type)===wV);return n?{signal:n}:void 0}return t=hq(Iq(e),t,s),Nq(e)&&QU(e.bin)?{signal:mq(u,Vq(e,{expr:i,binSuffix:"end"}),t,n,s)}:t||"quantitative"===Iq(e)?{signal:`${fq(u,t)}`}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function uq(e,t,n){return Nq(e)?n?`${Vq(e,{expr:t,suffix:"end"})}-${Vq(e,{expr:t,suffix:"start"})}`:Vq(e,{expr:t}):function(e){const{datum:t}=e;return IW(t)?LW(t):`${JSON.stringify(t)}`}(e)}function lq({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s,field:a}){return a=null!=a?a:uq(e,i,r),Nq(e)&&QU(e.bin)?{signal:mq(a,Vq(e,{expr:i,binSuffix:"end"}),t,n,s)}:{signal:aq(n,a,t)}}function cq(e,t,n,i,r,s){var a;if(!sq(i))return oG(e)?function(e,t,n,i){return e||(t?{signal:GW(t)}:i?void 0:n.timeFormat)}(n,Nq(e)?null===(a=HW(e.timeUnit))||void 0===a?void 0:a.unit:void 0,r,s):hq(t,n,r)}function dq(e,t,n){return e&&(XW(e)||"number"===e||"time"===e)?e:oG(t)&&"time"!==n&&"utc"!==n?"time":void 0}function hq(e,t,n){return DL(t)?t:e===fV?n.numberFormat:void 0}function fq(e,t){return`format(${e}, "${t||""}")`}function pq(e,t,n,i){var r;return sq(n)?aq(n,e,t):fq(e,null!==(r=DL(t)?t:void 0)&&void 0!==r?r:i.numberFormat)}function mq(e,t,n,i,r){const s=pq(e,n,i,r),a=pq(t,n,i,r);return`${cV(e,!1)} ? "null" : ${s} + " – " + ${a}`}!function(){var e;const t={};for(const n of Qj)for(const i of vV)for(const r of AV){const s=KV(n,i);YV(n,r)&&XV(r,i)&&(t[s]=null!==(e=t[s])&&void 0!==e?e:[],t[s].push(r))}}();const gq="min",yq={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function vq(e){return e in yq}function bq(e){return!!e&&!!e.encoding}function xq(e){return!(!e||"count"!==e.op&&!e.field)}function wq(e){return!!e&&vL(e)}function Cq(e){return"row"in e||"column"in e}function kq(e){return!!e&&"header"in e}function Aq(e){return"facet"in e}function _q(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function Eq(e){return zq(e)&&"sort"in e}function Sq({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:r,config:s,isMidPoint:a}){if(Bq(t)&&void 0!==t.band)return t.band;if(Nq(t)){const{timeUnit:e,bin:r}=t;if(e&&!n)return a?vG("timeUnitBandPosition",i,s):HP(i.type)?vG("timeUnitBand",i,s):0;if(QU(r))return HP(i.type)&&!a?1:.5}return(null==r?void 0:r.fieldChannel)===e&&a?.5:void 0}function Fq(e,t,n,i,r,s){return!!(QU(t.bin)||t.timeUnit&&zq(t)&&"temporal"===t.type)&&!!Sq({channel:e,fieldDef:t,fieldDef2:n,stack:i,markDef:r,config:s})}function Dq(e){return!!e&&"condition"in e}function $q(e){const t=e&&e.condition;return!!t&&!vL(t)&&Nq(t)}function Oq(e){const t=e&&e.condition;return!!t&&!vL(t)&&Bq(t)}function Nq(e){return!(!e||!e.field&&"count"!==e.aggregate)}function Iq(e){return e&&e.type}function Tq(e){return!!e&&"datum"in e}function Rq(e){return zq(e)&&Gq(e)||Mq(e)}function Mq(e){return Tq(e)&&FL(e.datum)}function Bq(e){return Nq(e)||Tq(e)}function zq(e){return!!e&&("field"in e&&"type"in e||"count"===e.aggregate)}function Lq(e){return e&&"value"in e&&"value"in e}function Pq(e){return!!e&&("scale"in e||"sort"in e)}function jq(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function Uq(e){return!!e&&"legend"in e}function Wq(e){return!!e&&("format"in e||"formatType"in e)}function Vq(e,t={}){var n,i,r;let s=e.field;const a=t.prefix;let o=t.suffix,u="";if(function(e){return"count"===e.aggregate}(e))s=function(e){return 0===e.indexOf("__")}(l="count")?l:"__count";else{let a;if(!t.nofn)if(function(e){return"op"in e}(e))a=e.op;else{const{bin:l,aggregate:c,timeUnit:d}=e;QU(l)?(a=ZU(l),o=(null!==(n=t.binSuffix)&&void 0!==n?n:"")+(null!==(i=t.suffix)&&void 0!==i?i:"")):c?rj(c)?(u=`["${s}"]`,s=`argmax_${c.argmax}`):ij(c)?(u=`["${s}"]`,s=`argmin_${c.argmin}`):a=String(c):d&&(a=function(e){const t=HW(e),{utc:n}=t,i=NL(t,["utc"]);return i.unit?(n?"utc":"")+aP(i).map((e=>cP(`${"unit"===e?"":`_${e}_`}${i[e]}`))).join(""):(n?"utc":"")+"timeunit"+aP(i).map((e=>cP(`_${e}_${i[e]}`))).join("")}(d),o=(!JL(["range","mid"],t.binSuffix)&&t.binSuffix||"")+(null!==(r=t.suffix)&&void 0!==r?r:""))}a&&(s=s?`${a}_${s}`:a)}var l;return o&&(s=`${s}_${o}`),a&&(s=`${a}_${s}`),t.forAs?vP(s):t.expr?function(e,t="datum"){return`${t}[${$L(pL(e).join("."))}]`}(s,t.expr)+u:gP(s)+u}function qq(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return Nq(e)&&!!e.bin;case"temporal":return!1}throw new Error(pW(e.type))}function Gq(e){return!qq(e)}const Hq=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(rj(t))return`${r} for argmax(${t.argmax})`;if(ij(t))return`${r} for argmin(${t.argmin})`;const s=HW(i),a=t||(null==s?void 0:s.unit)||(null==s?void 0:s.maxbins)&&"timeunit"||QU(n)&&"bin";return a?a.toUpperCase()+"("+r+")":r}(e);default:return function(e,t){var n;const{field:i,bin:r,timeUnit:s,aggregate:a}=e;if("count"===a)return t.countTitle;if(QU(r))return`${i} (binned)`;if(s){const e=null===(n=HW(s))||void 0===n?void 0:n.unit;if(e)return`${i} (${VW(e).join("-")})`}else if(a)return rj(a)?`${i} for max ${a.argmax}`:ij(a)?`${i} for min ${a.argmin}`:`${fP(a)} of ${i}`;return i}(e,t)}};let Xq=Hq;function Yq(e){Xq=e}function Kq(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,s;const a=(null!==(r=Jq(e))&&void 0!==r?r:{}).title;if(!Nq(e))return a;const o=e,u=i?Zq(o,t):void 0;return n?xP(a,o.title,u):null!==(s=null!=a?a:o.title)&&void 0!==s?s:u}function Jq(e){return jq(e)&&e.axis?e.axis:Uq(e)&&e.legend?e.legend:kq(e)&&e.header?e.header:void 0}function Zq(e,t){return Xq(e,t)}function Qq(e){var t;if(Wq(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}{const n=null!==(t=Jq(e))&&void 0!==t?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function eG(e){return Nq(e)?e:$q(e)?e.condition:void 0}function tG(e){return Bq(e)?e:Oq(e)?e.condition:void 0}function nG(e,t,n){return DL(e)||FL(e)||SL(e)?(NW(function(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${XL(n)}}.`}(t,DL(e)?"string":FL(e)?"number":"boolean",e)),{value:e}):Bq(e)?iG(e,t,n):Oq(e)?Object.assign(Object.assign({},e),{condition:iG(e.condition,t,n)}):e}function iG(e,t,n){if(Wq(e)){const{format:i,formatType:r}=e,s=NL(e,["format","formatType"]);if(sq(r)&&!n.customFormatTypes)return NW(fW(t)),iG(s,t,n)}else{const i=jq(e)?"axis":Uq(e)?"legend":kq(e)?"header":null;if(i&&e[i]){const r=e[i],{format:s,formatType:a}=r,o=NL(r,["format","formatType"]);if(sq(a)&&!n.customFormatTypes)return NW(fW(t)),iG(Object.assign(Object.assign({},e),{[i]:o}),t,n)}}return Nq(e)?rG(e,t):function(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=FL(n)?"quantitative":DL(n)?"nominal":IW(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}(e)}function rG(e,t){const{aggregate:n,timeUnit:i,bin:r,field:s}=e,a=Object.assign({},e);if(!n||sj(n)||rj(n)||ij(n)||(NW(function(e){return`Invalid aggregation operator "${e}".`}(n)),delete a.aggregate),i&&(a.timeUnit=HW(i)),s&&(a.field=`${s}`),QU(r)&&(a.bin=sG(r,t)),eW(r)&&!OU(t)&&NW(`Channel ${t} should not be used with "binned" bin.`),zq(a)){const{type:e}=a,t=function(e){if(e)switch(e=e.toLowerCase()){case"q":case fV:return"quantitative";case"t":case mV:return"temporal";case"o":case pV:return"ordinal";case"n":case gV:return"nominal";case yV:return"geojson"}}(e);e!==t&&(a.type=t),"quantitative"!==e&&oj(n)&&(NW(function(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}(e,n)),a.type="quantitative")}else if(!cU(t)){const e=function(e,t){if(e.timeUnit)return"temporal";if(QU(e.bin))return"quantitative";switch(JU(t)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}(a,t);NW(function(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}(t,e)),a.type=e}if(zq(a)){const{compatible:e,warning:n}=function(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case cj:case dj:case hj:return Gq(e)?{compatible:!1,warning:vW(t)}:aG;case fj:case pj:case _j:case Ej:case Sj:case Mj:case zj:case Lj:case Pj:case jj:case Uj:case $j:case bj:case yj:case Wj:return aG;case Cj:case Aj:case wj:case kj:return n!==fV?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:aG;case Oj:case Nj:case Ij:case Tj:case Dj:case xj:case vj:case mj:case gj:return"nominal"!==n||e.sort?aG:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case Rj:return JL(["ordinal","nominal"],e.type)?aG:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Fj:return JL(["ordinal","nominal","geojson"],e.type)?aG:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case Bj:return"nominal"!==e.type||"sort"in e?aG:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(a,t);e||NW(n)}if(Eq(a)&&DL(a.sort)){const{sort:e}=a;if(vq(e))return Object.assign(Object.assign({},a),{sort:{encoding:e}});const t=e.substr(1);if("-"===e.charAt(0)&&vq(t))return Object.assign(Object.assign({},a),{sort:{encoding:t,order:"descending"}})}if(kq(a)){const{header:e}=a,{orient:t}=e,n=NL(e,["orient"]);if(t)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},n),{labelOrient:e.labelOrient||t,titleOrient:e.titleOrient||t})})}return a}function sG(e,t){return SL(e)?{maxbins:iW(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:iW(t)})}const aG={compatible:!0};function oG(e){const{formatType:t}=Qq(e);return"time"===t||!t&&function(e){return e&&("temporal"===e.type||Nq(e)&&!!e.timeUnit)}(e)}function uG(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var s;const a=t&&(null===(s=HW(t))||void 0===s?void 0:s.unit);let o,u=a||"temporal"===n;return XW(e)?o=e.signal:IW(e)?(u=!0,o=LW(e)):(DL(e)||FL(e))&&u&&(o=`datetime(${JSON.stringify(e)})`,function(e){return!!PW[e]}(a)&&(FL(e)&&e<1e4||DL(e)&&isNaN(Date.parse(e)))&&(o=LW({[a]:e}))),o?i&&u?`time(${o})`:o:r?void 0:JSON.stringify(e)}function lG(e,t){const{type:n}=e;return t.map((t=>{const i=uG(t,{timeUnit:Nq(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==i?{signal:i}:t}))}function cG(e,t){return QU(e.bin)?HU(t)&&JL(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function dG(e){const{anchor:t,frame:n,offset:i,orient:r,color:s,subtitleColor:a,subtitleFont:o,subtitleFontSize:u,subtitleFontStyle:l,subtitleFontWeight:c,subtitleLineHeight:d,subtitlePadding:h}=e,f=NL(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},f),s?{fill:s}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},a?{subtitleColor:a}:{}),o?{subtitleFont:o}:{}),u?{subtitleFontSize:u}:{}),l?{subtitleFontStyle:l}:{}),c?{subtitleFontWeight:c}:{}),d?{subtitleLineHeight:d}:{}),h?{subtitlePadding:h}:{});return{titleMarkConfig:p,subtitleMarkConfig:GL(p,["align","baseline","dx","dy","limit"]),nonMark:m,subtitle:g}}function hG(e){return DL(e)||vL(e)&&DL(e[0])}function fG(e){return XW(e)?e:void 0!==e?{value:e}:void 0}function pG(e){return XW(e)?e.signal:$L(e.value)}function mG(e){return XW(e)?e.signal:null==e?null:$L(e)}function gG(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function yG(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&void 0!==t[r]?t[r]:void 0!==t[e]?t[e]:!s||r&&r!==e?vG(e,t,n,i):void 0}function vG(e,t,n,{vgChannel:i}={}){return xP(i?bG(e,t,n.style):void 0,bG(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function bG(e,t,n){return xG(e,gG(t),n)}function xG(e,t,n){let i;t=AL(t);for(const r of t){const t=n[r];t&&void 0!==t[e]&&(i=t[e])}return i}function wG(e,t){return AL(e).reduce(((e,n)=>{var i;return e.field.push(Vq(n,t)),e.order.push(null!==(i=n.sort)&&void 0!==i?i:"ascending"),e}),{field:[],order:[]})}function CG(e,t){const n=[...e];return t.forEach((e=>{for(const t of n)if(VL(t,e))return;n.push(e)})),n}function kG(e,t){return VL(e,t)||!t?e:e?[...AL(e),...AL(t)].join(", "):t}function AG(e,t){const n=e.value,i=t.value;if(null==n||null===i)return{explicit:e.explicit,value:null};if((hG(n)||XW(n))&&(hG(i)||XW(i)))return{explicit:e.explicit,value:kG(n,i)};if(hG(n)||XW(n))return{explicit:e.explicit,value:n};if(hG(i)||XW(i))return{explicit:e.explicit,value:i};if(!(hG(n)||XW(n)||hG(i)||XW(i)))return{explicit:e.explicit,value:CG(n,i)};throw new Error("It should never reach here")}function _G(e,t){const n=e&&e[t];return!!n&&(vL(n)?ZL(n,(e=>!!e.field)):Nq(n)||$q(n))}function EG(e){return ZL(Qj,(t=>{if(_G(e,t)){const n=e[t];if(vL(n))return ZL(n,(e=>!!e.aggregate));{const e=eG(n);return e&&!!e.aggregate}}return!1}))}function SG(e,t){const n=[],i=[],r=[],s=[],a={};return $G(e,((o,u)=>{if(Nq(o)){const{field:l,aggregate:c,bin:d,timeUnit:h}=o,f=NL(o,["field","aggregate","bin","timeUnit"]);if(c||h||d){const e=Jq(o),p=e&&e.title;let m=Vq(o,{forAs:!0});const g=Object.assign(Object.assign(Object.assign({},p?[]:{title:Kq(o,t,{allowDisabling:!0})}),f),{field:m});if(c){let e;if(rj(c)?(e="argmax",m=Vq({op:"argmax",field:c.argmax},{forAs:!0}),g.field=`${m}.${l}`):ij(c)?(e="argmin",m=Vq({op:"argmin",field:c.argmin},{forAs:!0}),g.field=`${m}.${l}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(e=c),e){const t={op:e,as:m};l&&(t.field=l),s.push(t)}}else if(n.push(m),zq(o)&&QU(d)){if(i.push({bin:d,field:l,as:m}),n.push(Vq(o,{binSuffix:"end"})),cG(o,u)&&n.push(Vq(o,{binSuffix:"range"})),OU(u)){const e={field:m+"_end"};a[u+"2"]=e}g.bin="binned",cU(u)||(g.type=fV)}else if(h){r.push({timeUnit:h,field:l,as:m});const e=zq(o)&&o.type!==mV&&"time";e&&(u===Mj||u===Pj?g.formatType=e:function(e){return!!SU[e]}(u)?g.legend=Object.assign({formatType:e},g.legend):OU(u)&&(g.axis=Object.assign({formatType:e},g.axis)))}a[u]=g}else n.push(l),a[u]=e[u]}else a[u]=e[u]})),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:a}}function FG(e,t,n){const i=t.type;return aP(e).reduce(((r,s)=>{if(!uU(s))return NW(function(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}(s)),r;const a=e[s];if("angle"!==s||"arc"!==i||e.theta||(NW("Arc marks uses theta channel rather than angle, replacing angle with theta."),s=bj),!function(e,t,n){const i=function(e,t){return function(e){switch(e){case _j:case Ej:case Sj:case Wj:case zj:case Lj:case Pj:case jj:case Bj:case Oj:case Nj:case Ij:case Tj:case hj:case cj:case dj:return XU;case fj:case pj:case wj:case Cj:return KU;case mj:case gj:case kj:case Aj:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case Dj:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Rj:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Fj:return{point:"always",geoshape:"always"};case Mj:return{text:"always"};case $j:return{point:"always",square:"always",text:"always"};case Uj:return{image:"always"};case bj:case yj:return{text:"always",arc:"always"};case xj:case vj:return{arc:"always"}}}(e)[t]}(t,n);if(!i)return!1;if("binned"===i){const n=e[t===mj?fj:pj];return!!(Nq(n)&&Nq(e[t])&&eW(n.bin))}return!0}(e,s,i))return NW(yW(s,i)),r;if(s===Dj&&"line"===i){const t=eG(e[s]);if(null==t?void 0:t.aggregate)return NW("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),r}if(s===_j&&(t.filled?"fill"in e:"stroke"in e))return NW(mW("encoding",{fill:"fill"in e,stroke:"stroke"in e})),r;if(s===zj||s===Bj&&!vL(a)&&!Lq(a)||s===Pj&&vL(a))a&&(r[s]=AL(a).reduce(((e,t)=>(Nq(t)?e.push(rG(t,s)):NW(gW(t,s)),e)),[]));else{if(s===Pj&&null===a)r[s]=null;else if(!(Nq(a)||Tq(a)||Lq(a)||Dq(a)||XW(a)))return NW(gW(a,s)),r;r[s]=nG(a,s,n)}return r}),{})}function DG(e){const t=[];for(const n of aP(e))if(_G(e,n)){const i=AL(e[n]);for(const e of i)Nq(e)?t.push(e):$q(e)&&t.push(e.condition)}return t}function $G(e,t,n){if(e)for(const i of aP(e)){const r=e[i];if(vL(r))for(const e of r)t.call(n,e,i);else t.call(n,r,i)}}function OG(e,t,n,i){return e?aP(e).reduce(((n,r)=>{const s=e[r];return vL(s)?s.reduce(((e,n)=>t.call(i,e,n,r)),n):t.call(i,n,s,r)}),n):n}function NG(e,t){return aP(t).reduce(((n,i)=>{switch(i){case fj:case pj:case jj:case Wj:case Uj:case mj:case gj:case bj:case xj:case yj:case vj:case wj:case Cj:case kj:case Aj:case Mj:case Fj:case $j:case Pj:return n;case Bj:if("line"===e||"trail"===e)return n;case zj:case Lj:{const e=t[i];if(vL(e)||Nq(e))for(const t of AL(e))t.aggregate||n.push(Vq(t,{}));return n}case Dj:if("trail"===e)return n;case _j:case Ej:case Sj:case Oj:case Nj:case Ij:case Rj:case Tj:{const e=eG(t[i]);return e&&!e.aggregate&&n.push(Vq(e,{})),n}}}),[])}function IG(e,t,n,i=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...e.map((({fieldPrefix:e,titlePrefix:n})=>{const r=i?` of ${t.field}`:"";return{field:e+t.field,type:t.type,title:XW(n)?{signal:n+`"${escape(r)}"`}:n+r}})),...DG(n)]}}function TG(e){const{axis:t,title:n,field:i}=e;return t&&void 0!==t.title?void 0:xP(n,i)}function RG(e,t,n,i,r){const{scale:s,axis:a}=n;return({partName:o,mark:u,positionPrefix:l,endPositionPrefix:c,aria:d,extraEncoding:h={}})=>{const f=TG(n);return MG(e,o,r,d,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:l+"_"+n.field,type:n.type},void 0!==f?{title:f}:{}),void 0!==s?{scale:s}:{}),void 0!==a?{axis:a}:{})},DL(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),i),h)})}}function MG(e,t,n,i,r){const{clip:s,color:a,opacity:o}=e,u=e.type;return e[t]||void 0===e[t]&&n[t]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),s?{clip:s}:{}),a?{color:a}:{}),o?{opacity:o}:{}),YP(r.mark)?r.mark:{type:r.mark}),{style:`${u}-${t}`}),SL(e[t])?{}:e[t]),!1===i?{aria:i}:{})})]:[]}function BG(e,t,n){const{encoding:i}=e,r="vertical"===t?"y":"x",s=i[r],a=i[r+"2"],o=i[r+"Error"],u=i[r+"Error2"];return{continuousAxisChannelDef:zG(s,n),continuousAxisChannelDef2:zG(a,n),continuousAxisChannelDefError:zG(o,n),continuousAxisChannelDefError2:zG(u,n),continuousAxis:r}}function zG(e,t){if(e&&e.aggregate){const{aggregate:n}=e,i=NL(e,["aggregate"]);return n!==t&&NW(function(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}(n,t)),i}return e}function LG(e,t){const{mark:n,encoding:i}=e,{x:r,y:s}=i;if(Rq(r)){if(Rq(s)){const e=Nq(r)&&r.aggregate,i=Nq(s)&&s.aggregate;if(e||i!==t){if(i||e!==t){if(e===t&&i===t)throw new Error("Both x and y cannot have aggregate");return YP(n)&&n.orient?n.orient:"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(Rq(s))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}const PG="boxplot",jG=new ej(PG,WG);function UG(e){return FL(e)?"tukey":e}function WG(e,{config:t}){var n,i;const{mark:r,encoding:s,selection:a,projection:o}=e,u=NL(e,["mark","encoding","selection","projection"]),l=YP(r)?r:{type:r};a&&NW(cW("boxplot"));const c=null!==(n=l.extent)&&void 0!==n?n:t.boxplot.extent,d=yG("size",l,t),h=UG(c),{transform:f,continuousAxisChannelDef:p,continuousAxis:m,groupby:g,aggregate:y,encodingWithoutContinuousAxis:v,ticksOrient:b,boxOrient:x,customTooltipWithoutAggregatedField:w}=function(e,t,n){const i=LG(e,PG),{continuousAxisChannelDef:r,continuousAxis:s}=BG(e,i,PG),a=r.field,o=UG(t),u=[...VG(a),{op:"median",field:a,as:"mid_box_"+a},{op:"min",field:a,as:("min-max"===o?"lower_whisker_":"min_")+a},{op:"max",field:a,as:("min-max"===o?"upper_whisker_":"max_")+a}],l="min-max"===o||"tukey"===o?[]:[{calculate:`datum["upper_box_${a}"] - datum["lower_box_${a}"]`,as:"iqr_"+a},{calculate:`min(datum["upper_box_${a}"] + datum["iqr_${a}"] * ${t}, datum["max_${a}"])`,as:"upper_whisker_"+a},{calculate:`max(datum["lower_box_${a}"] - datum["iqr_${a}"] * ${t}, datum["min_${a}"])`,as:"lower_whisker_"+a}],c=e.encoding,d=s,h=(c[d],NL(c,["symbol"==typeof d?d:d+""])),{customTooltipWithoutAggregatedField:f,filteredEncoding:p}=function(e){const{tooltip:t}=e,n=NL(e,["tooltip"]);if(!t)return{filteredEncoding:e};let i,r;if(vL(t)){for(const e of t)e.aggregate?(i||(i=[]),i.push(e)):(r||(r=[]),r.push(e));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return vL(r)&&1===r.length&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}(h),{bins:m,timeUnits:g,aggregate:y,groupby:v,encoding:b}=SG(p,n),x="vertical"===i?"horizontal":"vertical",w=i;return{transform:[...m,...g,{aggregate:[...y,...u],groupby:v},...l],groupby:v,aggregate:y,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:w,customTooltipWithoutAggregatedField:f}}(e,c,t),{color:C,size:k}=v,A=NL(v,["color","size"]),_=e=>RG(l,m,p,e,t.boxplot),E=_(A),S=_(v),F=_(Object.assign(Object.assign({},A),k?{size:k}:{})),D=IG([{fieldPrefix:"min-max"===h?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===h?"lower_whisker_":"min_",titlePrefix:"Min"}],p,v),$={type:"tick",color:"black",opacity:1,orient:b,invalid:null},O="min-max"===h?D:IG([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,v),N=[...E({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:O}),...E({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:O}),...E({partName:"ticks",mark:$,positionPrefix:"lower_whisker",aria:!1,extraEncoding:O}),...E({partName:"ticks",mark:$,positionPrefix:"upper_whisker",aria:!1,extraEncoding:O})],I=[..."tukey"!==h?N:[],...S({partName:"box",mark:Object.assign(Object.assign({type:"bar"},d?{size:d}:{}),{orient:x,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:D}),...F({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},bL(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),d?{size:d}:{}),{orient:b,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:D})];let T;if("min-max"!==h){const e=`datum["lower_box_${p.field}"]`,n=`datum["upper_box_${p.field}"]`,i=`(${n} - ${e})`,r=`${e} - ${c} * ${i}`,s=`${n} + ${c} * ${i}`,a=`datum["${p.field}"]`,o={joinaggregate:VG(p.field),groupby:g};let u;"tukey"===h&&(u={transform:[{filter:`(${r} <= ${a}) && (${a} <= ${s})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...y],groupby:g}],layer:N});const{tooltip:d}=A,f=NL(A,["tooltip"]),{scale:v,axis:b}=p,x=TG(p),C=MG(l,"outliers",t.boxplot,!0,{transform:[{filter:`(${a} < ${r}) || (${a} > ${s})`}],mark:"point",encoding:Object.assign(Object.assign({[m]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},void 0!==x?{title:x}:{}),void 0!==v?{scale:v}:{}),void 0!==b?{axis:b}:{})},f),w?{tooltip:w}:{})})[0];C&&u?T={transform:[o],layer:[C,u]}:C?(T=C,T.transform.unshift(o)):u&&(T=u,T.transform.unshift(o))}return T?Object.assign(Object.assign({},u),{layer:[T,{transform:f,layer:I}]}):Object.assign(Object.assign({},u),{transform:(null!==(i=u.transform)&&void 0!==i?i:[]).concat(f),layer:I})}function VG(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}const qG="errorbar",GG=new ej(qG,HG);function HG(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:a,markDef:o,outerSpec:u,tooltipEncoding:l}=XG(e,qG,t),c=RG(o,r,i,s,t.errorbar),d={type:"tick",orient:a},h=[...c({partName:"ticks",mark:d,positionPrefix:"lower",aria:!1,extraEncoding:l}),...c({partName:"ticks",mark:d,positionPrefix:"upper",aria:!1,extraEncoding:l}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),h.length>1?{layer:h}:Object.assign({},h[0]))}function XG(e,t,n){var i;const{mark:r,encoding:s,selection:a,projection:o}=e,u=NL(e,["mark","encoding","selection","projection"]),l=YP(r)?r:{type:r};a&&NW(cW(t));const{orient:c,inputType:d}=function(e,t){const{encoding:n}=e;if(function(e){return(Bq(e.x)||Bq(e.y))&&!Bq(e.x2)&&!Bq(e.y2)&&!Bq(e.xError)&&!Bq(e.xError2)&&!Bq(e.yError)&&!Bq(e.yError2)}(n))return{orient:LG(e,t),inputType:"raw"};const i=function(e){return Bq(e.x2)||Bq(e.y2)}(n),r=function(e){return Bq(e.xError)||Bq(e.xError2)||Bq(e.yError)||Bq(e.yError2)}(n),s=n.x,a=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const e=n.x2,i=n.y2;if(Bq(e)&&Bq(i))throw new Error(`${t} cannot have both x2 and y2`);if(Bq(e)){if(Rq(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}if(Bq(i)){if(Rq(a))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}{const e=n.xError,i=n.xError2,r=n.yError,o=n.yError2;if(Bq(i)&&!Bq(e))throw new Error(`${t} cannot have xError2 without xError`);if(Bq(o)&&!Bq(r))throw new Error(`${t} cannot have yError2 without yError`);if(Bq(e)&&Bq(r))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(Bq(e)){if(Rq(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(Bq(r)){if(Rq(a))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}(e,t),{continuousAxisChannelDef:h,continuousAxisChannelDef2:f,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:g}=BG(e,c,t),{errorBarSpecificAggregate:y,postAggregateCalculates:v,tooltipSummary:b,tooltipTitleWithFieldName:x}=function(e,t,n,i,r,s,a,o){let u=[],l=[];const c=t.field;let d,h=!1;if("raw"===s){const t=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":o.errorbar.center,n=e.extent?e.extent:"mean"===t?"stderr":"iqr";if("median"===t!=("iqr"===n)&&NW(function(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}(t,n,a)),"stderr"===n||"stdev"===n)u=[{op:n,field:c,as:"extent_"+c},{op:t,field:c,as:"center_"+c}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],d=[{fieldPrefix:"center_",titlePrefix:fP(t)},{fieldPrefix:"upper_",titlePrefix:YG(t,n,"+")},{fieldPrefix:"lower_",titlePrefix:YG(t,n,"-")}],h=!0;else{let t,i,r;e.center&&e.extent&&NW(function(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}(e.extent,a)),"ci"===n?(t="mean",i="ci0",r="ci1"):(t="median",i="q1",r="q3"),u=[{op:i,field:c,as:"lower_"+c},{op:r,field:c,as:"upper_"+c},{op:t,field:c,as:"center_"+c}],d=[{fieldPrefix:"upper_",titlePrefix:Kq({field:c,aggregate:r,type:"quantitative"},o,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:Kq({field:c,aggregate:i,type:"quantitative"},o,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:Kq({field:c,aggregate:t,type:"quantitative"},o,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&NW(function(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}(e.center,e.extent)),"aggregated-upper-lower"===s?(d=[],l=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===s&&(d=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:"upper_"+c}],r?l.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:"lower_"+c}):l.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:"lower_"+c}));for(const e of l)d.push({fieldPrefix:e.as.substring(0,6),titlePrefix:yP(yP(e.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:d,tooltipTitleWithFieldName:h}}(l,h,f,p,m,d,t,n),w=s,C=g,k=(w[C],"x"===g?"x2":"y2"),A=(w[k],"x"===g?"xError":"yError"),_=(w[A],"x"===g?"xError2":"yError2"),E=(w[_],NL(w,["symbol"==typeof C?C:C+"","symbol"==typeof k?k:k+"","symbol"==typeof A?A:A+"","symbol"==typeof _?_:_+""])),{bins:S,timeUnits:F,aggregate:D,groupby:$,encoding:O}=SG(E,n),N=[...D,...y],I="raw"!==d?[]:$,T=IG(b,h,O,x);return{transform:[...null!==(i=u.transform)&&void 0!==i?i:[],...S,...F,...0===N.length?[]:[{aggregate:N,groupby:I}],...v],groupby:I,continuousAxisChannelDef:h,continuousAxis:g,encodingWithoutContinuousAxis:O,ticksOrient:"vertical"===c?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:T}}function YG(e,t,n){return fP(e)+" "+n+" "+t}const KG="errorband",JG=new ej(KG,ZG);function ZG(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:a,outerSpec:o,tooltipEncoding:u}=XG(e,KG,t),l=a,c=RG(l,r,i,s,t.errorband),d=void 0!==e.encoding.x&&void 0!==e.encoding.y;let h={type:d?"area":"rect"},f={type:d?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return d?(h=Object.assign(Object.assign(Object.assign({},h),p),{ariaRoleDescription:"errorband"}),f=Object.assign(Object.assign({},f),p)):l.interpolate?NW(SW("interpolate")):l.tension&&NW(SW("tension")),Object.assign(Object.assign({},o),{transform:n,layer:[...c({partName:"band",mark:h,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:f,positionPrefix:"lower",aria:!1,extraEncoding:u}),...c({partName:"borders",mark:f,positionPrefix:"upper",aria:!1,extraEncoding:u})]})}const QG={};function eH(e,t,n){const i=new ej(e,t);QG[e]={normalizer:i,parts:n}}eH(PG,WG,["box","median","outliers","rule","ticks"]),eH(qG,HG,["ticks","rule"]),eH(KG,ZG,["band","borders"]);const tH=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],nH=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],iH={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},rH={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},sH=(aP(rH),"_vgsid_"),aH={single:{on:"click",fields:[sH],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[sH],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function oH(e){return!(!e||"legend"!==e&&!e.legend)}function uH(e){return oH(e)&&bL(e)}function lH(e){return"concat"in e}function cH(e){return"vconcat"in e}function dH(e){return"hconcat"in e}function hH(e){return bL(e)&&void 0!==e.step}function fH(e){return e.view||e.width||e.height}const pH=aP({align:1,bounds:1,center:1,columns:1,spacing:1});function mH(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function gH(e,t){const n=yH(e,t);return hH(n)?n.step:vH}function yH(e,t){var n;return xP(null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"],{step:e.step})}const vH=20,bH={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:vH},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:{binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},circle:{},geoshape:{},image:{},line:{},point:{},rect:{binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5},rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:aH,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},xH=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],wH={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},CH={blue:xH[0],orange:xH[1],red:xH[2],teal:xH[3],green:xH[4],yellow:xH[5],purple:xH[6],pink:xH[7],brown:xH[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function kH(e={}){const{color:t,font:n,fontSize:i}=e,r=NL(e,["color","font","fontSize"]);return wL({},bH,n?function(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}(n):{},t?function(e={}){return{signals:[{name:"color",value:bL(e)?Object.assign(Object.assign({},CH),e):CH}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},i?function(e){return{signals:[{name:"fontSize",value:bL(e)?Object.assign(Object.assign({},wH),e):wH}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(i):{},r||{})}const AH=["view",...XP],_H=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],EH=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function SH(e,t,n,i){const r=i?e[t][i]:e[t];"view"===t&&(n="cell");const s=Object.assign(Object.assign({},r),e.style[null!=n?n:t]);sP(s)||(e.style[null!=n?n:t]=s),i||delete e[t]}function FH(e){return"layer"in e}class DH{map(e,t){return Aq(e)?this.mapFacet(e,t):function(e){return"repeat"in e}(e)?this.mapRepeat(e,t):dH(e)?this.mapHConcat(e,t):cH(e)?this.mapVConcat(e,t):lH(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(FH(e))return this.mapLayer(e,t);if(QP(e))return this.mapUnit(e,t);throw new Error(rW(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map((e=>this.mapLayerOrUnit(e,t)))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map((e=>this.map(e,t)))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map((e=>this.map(e,t)))})}mapConcat(e,t){const{concat:n}=e,i=NL(e,["concat"]);return Object.assign(Object.assign({},i),{concat:n.map((e=>this.map(e,t)))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}const $H={zero:1,center:1,normalize:1},OH=new Set([NP,TP,IP,LP,BP,WP,VP,MP,PP,jP]),NH=new Set([TP,IP,NP]);function IH(e,t){var n,i;const r="x"===t?"y":"radius",s=e[t],a=e[r];if(Nq(s)&&Nq(a))if("quantitative"===Iq(s)&&"quantitative"===Iq(a)){if(s.stack)return t;if(a.stack)return r;const e=Nq(s)&&!!s.aggregate;if(e!==(Nq(a)&&!!a.aggregate))return e?t:r;{const e=null===(n=s.scale)||void 0===n?void 0:n.type,o=null===(i=a.scale)||void 0===i?void 0:i.type;if(e&&"linear"!==e)return r;if(o&&"linear"!==o)return t}}else{if("quantitative"===Iq(s))return t;if("quantitative"===Iq(a))return r}else{if("quantitative"===Iq(s))return t;if("quantitative"===Iq(a))return r}}function TH(e,t,n={}){const i=YP(e)?e.type:e;if(!OH.has(i))return null;const r=IH(t,"x")||IH(t,"theta");if(!r)return null;const s=t[r],a=Nq(s)?Vq(s,{}):void 0;let o=function(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(r),u=t[o],l=Nq(u)?Vq(u,{}):void 0;l===a&&(l=void 0,u=void 0,o=void 0);const c=FU.reduce(((e,n)=>{if("tooltip"!==n&&_G(t,n)){const i=t[n];for(const t of AL(i)){const i=eG(t);if(i.aggregate)continue;const r=Vq(i,{});r&&r===l||e.push({channel:n,fieldDef:i})}}return e}),[]);let d;if(void 0!==s.stack?d=SL(s.stack)?s.stack?"zero":null:s.stack:c.length>0&&NH.has(i)&&(d="zero"),!d||!(d in $H))return null;var h;if(EG(t)&&0===c.length)return null;if(s.scale&&s.scale.type&&s.scale.type!==bV){if(n.disallowNonLinearStack)return null;NW(function(e){return`Cannot stack non-linear scale (${e}).`}(s.scale.type))}return Bq(t[fU(r)])?(void 0!==s.stack&&NW(`Cannot stack "${h=r}" if there is already "${h}2".`),null):(Nq(s)&&s.aggregate&&!JL(uj,s.aggregate)&&NW(`Stacking is applied even though the aggregate function is non-summative ("${s.aggregate}").`),{groupbyChannel:u?o:void 0,groupbyField:l,fieldChannel:r,impute:null!==s.impute&&GP(i),stackBy:c,offset:d})}function RH(e){const{point:t,line:n}=e,i=NL(e,["point","line"]);return aP(i).length>1?i:i.type}function MH(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:HL(e[t],["point","line"])}));return e}function BH(e,t={},n){return"transparent"===e.point?{opacity:0}:e.point?bL(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?bL(t.point)?t.point:{}:void 0}function zH(e,t={}){return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}class LH{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(QP(e)){const{mark:n,encoding:i}=e,r=YP(n)?n:{type:n};switch(r.type){case"line":case"rule":case"trail":return!!BH(r,t[r.type],i);case"area":return!!BH(r,t[r.type],i)||!!zH(r,t[r.type])}}return!1}run(e,t,n){const{config:i}=t,{selection:r,projection:s,encoding:a,mark:o}=e,u=NL(e,["selection","projection","encoding","mark"]),l=YP(o)?o:{type:o},c=BH(l,i[l.type],a),d="area"===l.type&&zH(l,i[l.type]),h=[Object.assign(Object.assign({},r?{selection:r}:{}),{mark:RH(Object.assign(Object.assign({},"area"===l.type&&void 0===l.opacity&&void 0===l.fillOpacity?{opacity:.7}:{}),l)),encoding:HL(a,["shape"])})],f=TH(l,a);let p=a;if(f){const{fieldChannel:e,offset:t}=f;p=Object.assign(Object.assign({},a),{[e]:Object.assign(Object.assign({},a[e]),t?{stack:t}:{})})}return d&&h.push(Object.assign(Object.assign({},s?{projection:s}:{}),{mark:Object.assign(Object.assign({type:"line"},GL(l,["clip","interpolate","tension","tooltip"])),d),encoding:p})),c&&h.push(Object.assign(Object.assign({},s?{projection:s}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},GL(l,["clip","tooltip"])),c),encoding:p})),n(Object.assign(Object.assign({},u),{layer:h}),Object.assign(Object.assign({},t),{config:MH(i)}))}}class PH{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(QP(e)&&e.encoding)for(const n of $U){const i=e.encoding[n];if(i&&Bq(i)&&(null===(t=null==i?void 0:i.scale)||void 0===t?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let i=Object.assign({},e.encoding);for(const e of $U){const r=pU(e),s=i[e];if(s&&Bq(s)&&(null===(t=null==s?void 0:s.scale)||void 0===t?void 0:t.rangeStep)){const{scale:t}=s,a=NL(s,["scale"]),o=t,{rangeStep:u}=o,l=NL(o,["rangeStep"]);n[r]={step:t.rangeStep},NW('Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.'),i=Object.assign(Object.assign({},i),{[e]:Object.assign(Object.assign({},a),sP(l)?{}:{scale:l})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:i})}}function jH(e,t){return t?Cq(e)?HH(e,t):VH(e,t):e}function UH(e,t){return t?HH(e,t):e}function WH(e,t,n){const i=t[e];return(r=i)&&!DL(r)&&"repeat"in r?i.repeat in n?Object.assign(Object.assign({},t),{[e]:n[i.repeat]}):void NW(function(e){return`Unknown repeated value "${e}".`}(i.repeat)):t;var r}function VH(e,t){if(void 0!==(e=WH("field",e,t))){if(null===e)return null;if(Eq(e)&&xq(e.sort)){const n=WH("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function qH(e,t){if(Nq(e))return VH(e,t);{const n=WH("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function GH(e,t){if(!Bq(e)){if(Oq(e)){const n=qH(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const{condition:t}=e;return NL(e,["condition"])}}return e}{const n=qH(e,t);if(n)return n;if(Dq(e))return{condition:e.condition}}}function HH(e,t){const n={};for(const i in e)if(EL(e,i)){const r=e[i];if(vL(r))n[i]=r.map((e=>GH(e,t))).filter((e=>e));else{const e=GH(r,t);void 0!==e&&(n[i]=e)}}return n}class XH{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(QP(e)){const{encoding:t,mark:n}=e;if("line"===n)for(const e of lU){const n=t[dU(e)];if(t[e]&&(Nq(n)&&!eW(n.bin)||Tq(n)))return!0}}return!1}run(e,t,n){const{encoding:i}=e;var r,s;return NW((r=!!i.x2,s=!!i.y2,`Line mark is for continuous lines and thus cannot be used with ${r&&s?"x2 and y2":r?"x2":"y2"}. We will use the rule mark (line segments) instead.`)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}function YH(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const e=aP(t).reduce(((e,t)=>(n[t]&&e.push(t),e)),[]);e.length>0&&NW(`Layer's shared ${(i=e).join(",")} channel ${1===i.length?"is":"are"} overriden.`)}var i;const r=Object.assign(Object.assign({},null!=t?t:{}),null!=n?n:{});return sP(r)?void 0:r}function KH(e){const{parentProjection:t,projection:n}=e;return t&&n&&NW(function(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${XL(t)} is overridden by a child projection ${XL(n)}.`}({parentProjection:t,projection:n})),null!=n?n:t}function JH(e,t){void 0===t&&(t=kH(e.config));const n=function(e,t={}){return ZH.map(e,{config:t})}(e,t),{width:i,height:r}=e,s=function(e,t,n){let{width:i,height:r}=t;const s=QP(e)||FH(e),a={};s?"container"==i&&"container"==r?(a.type="fit",a.contains="padding"):"container"==i?(a.type="fit-x",a.contains="padding"):"container"==r&&(a.type="fit-y",a.contains="padding"):("container"==i&&(NW(sW("width")),i=void 0),"container"==r&&(NW(sW("height")),r=void 0));const o=Object.assign(Object.assign(Object.assign({type:"pad"},a),n?QH(n.autosize):{}),QH(e.autosize));if("fit"!==o.type||s||(NW('Autosize "fit" only works for single views and layered views.'),o.type="pad"),"container"==i&&"fit"!=o.type&&"fit-x"!=o.type&&NW(aW("width")),"container"==r&&"fit"!=o.type&&"fit-y"!=o.type&&NW(aW("height")),!VL(o,{type:"pad"}))return o}(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const ZH=new class extends DH{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[jG,GG,JG,new LH,new XH,new PH]}map(e,t){if(QP(e)){const n=_G(e.encoding,cj),i=_G(e.encoding,dj),r=_G(e.encoding,hj);if(n||i||r)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:i}=t,r=Object.assign(Object.assign({},e),{encoding:UH(e.encoding,t.repeater)});if(n||i)return this.mapUnitWithParentEncodingOrProjection(r,t);const s=this.mapLayerOrUnit.bind(this);for(const e of this.nonFacetUnitNormalizers)if(e.hasMatchingType(r,t.config))return e.run(r,t,s);return r}mapRepeat(e,t){return function(e){return!vL(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:i}=e,r=NL(e,["repeat","spec"]),{row:s,column:a,layer:o}=n,{repeater:u={},repeaterPrefix:l=""}=t;return s||a?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},s?{row:s}:{}),a?{column:a}:{}),spec:{repeat:{layer:o},spec:i}}),t):Object.assign(Object.assign({},r),{layer:o.map((e=>{const n=Object.assign(Object.assign({},u),{layer:e}),r=(i.name||"")+l+`child__layer_${cP(e)}`,s=this.mapLayerOrUnit(i,Object.assign(Object.assign({},t),{repeater:n,repeaterPrefix:r}));return s.name=r,s}))})}mapNonLayerRepeat(e,t){var n;const{repeat:i,spec:r,data:s}=e,a=NL(e,["repeat","spec","data"]);!vL(i)&&e.columns&&(e=HL(e,["columns"]),NW(dW("repeat")));const o=[],{repeater:u={},repeaterPrefix:l=""}=t,c=!vL(i)&&i.row||[u?u.row:null],d=!vL(i)&&i.column||[u?u.column:null],h=vL(i)&&i||[u?u.repeat:null];for(const e of h)for(const n of c)for(const s of d){const a={repeat:e,row:n,column:s,layer:u.layer},c=(r.name||"")+l+"child__"+(vL(i)?`${cP(e)}`:(i.row?`row_${cP(n)}`:"")+(i.column?`column_${cP(s)}`:"")),d=this.map(r,Object.assign(Object.assign({},t),{repeater:a,repeaterPrefix:c}));d.name=c,o.push(HL(d,["data"]))}const f=vL(i)?e.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:null!==(n=r.data)&&void 0!==n?n:s,align:"all"},a),{columns:f,concat:o})}mapFacet(e,t){const{facet:n}=e;return Cq(n)&&e.columns&&(e=HL(e,["columns"]),NW(dW("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:i}=e,{parentEncoding:r,parentProjection:s,config:a}=t,o=KH({parentProjection:s,projection:i}),u=YH({parentEncoding:r,encoding:UH(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),o?{projection:o}:{}),u?{encoding:u}:{}),{config:a})}mapFacetedUnit(e,t){const n=e.encoding,{row:i,column:r,facet:s}=n,a=NL(n,["row","column","facet"]),{mark:o,width:u,projection:l,height:c,view:d,selection:h,encoding:f}=e,p=NL(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:m,layout:g}=this.getFacetMappingAndLayout({row:i,column:r,facet:s},t),y=UH(a,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),g),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},u?{width:u}:{}),c?{height:c}:{}),d?{view:d}:{}),l?{projection:l}:{}),{mark:o,encoding:y}),h?{selection:h}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:i,column:r,facet:s}=e;if(i||r){s&&NW(`Facet encoding dropped as ${(a=[...i?[cj]:[],...r?[dj]:[]]).join(" and ")} ${a.length>1?"are":"is"} also specified.`);const t={},o={};for(const i of[cj,dj]){const r=e[i];if(r){const{align:e,center:s,spacing:a,columns:u}=r,l=NL(r,["align","center","spacing","columns"]);t[i]=l;for(const e of["align","center","spacing"])void 0!==r[e]&&(o[e]=null!==(n=o[e])&&void 0!==n?n:{},o[e][i]=r[e])}}return{facetMapping:t,layout:o}}{const{align:e,center:n,spacing:i,columns:r}=s;return{facetMapping:jH(NL(s,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},e?{align:e}:{}),n?{center:n}:{}),i?{spacing:i}:{}),r?{columns:r}:{})}}var a}mapLayer(e,t){var{parentEncoding:n,parentProjection:i}=t,r=NL(t,["parentEncoding","parentProjection"]);const{encoding:s,projection:a}=e,o=NL(e,["encoding","projection"]),u=Object.assign(Object.assign({},r),{parentEncoding:YH({parentEncoding:n,encoding:s}),parentProjection:KH({parentProjection:i,projection:a})});return super.mapLayer(o,u)}};function QH(e){return DL(e)?{type:e}:null!=e?e:{}}const eX=["background","padding"];function tX(e){return eX.reduce(((t,n)=>(e&&void 0!==e[n]&&(t[n]=e[n]),t)),{})}class nX{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new nX(qL(this.explicit),qL(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return xP(this.explicit[e],this.implicit[e])}getWithExplicit(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}copyAll(e){for(const t of aP(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function iX(e){return{explicit:!0,value:e}}function rX(e){return{explicit:!1,value:e}}function sX(e){return(t,n,i,r)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:aX(t,n,i,r)}}function aX(e,t,n,i){return e.explicit&&t.explicit&&NW(function(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${XL(n)} and ${XL(i)}). Using ${XL(n)}.`}(n,i,e.value,t.value)),e}function oX(e,t,n,i,r=aX){return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:VL(e.value,t.value)?e:r(e,t,n,i)}class uX extends nX{constructor(e={},t={},n=!1){super(e,t),this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function lX(e){return"url"in e}function cX(e){return"values"in e}function dX(e){return"name"in e&&!lX(e)&&!cX(e)&&!hX(e)}function hX(e){return e&&(fX(e)||pX(e)||mX(e))}function fX(e){return"sequence"in e}function pX(e){return"sphere"in e}function mX(e){return"graticule"in e}const gX="main",yX="raw";function vX(e){return"filter"in e}function bX(e){return"lookup"in e}function xX(e){return"pivot"in e}function wX(e){return"density"in e}function CX(e){return"quantile"in e}function kX(e){return"regression"in e}function AX(e){return"loess"in e}function _X(e){return"sample"in e}function EX(e){return"window"in e}function SX(e){return"joinaggregate"in e}function FX(e){return"flatten"in e}function DX(e){return"calculate"in e}function $X(e){return"bin"in e}function OX(e){return"impute"in e}function NX(e){return"timeUnit"in e}function IX(e){return"aggregate"in e}function TX(e){return"stack"in e}function RX(e){return"fold"in e}function MX(e,t,n,i){const r=Dq(t)&&t.condition,s=i(t);return r?{[n]:[...AL(r).map((t=>{const n=i(t),r=function(e){return e.selection}(t)?rJ(e,t.selection):aJ(e,t.test);return Object.assign({test:r},n)})),...void 0!==s?[s]:[]]}:void 0!==s?{[n]:s}:{}}function BX(e,t="text"){const n=e.encoding[t];return MX(e,n,t,(t=>zX(t,e.config)))}function zX(e,t,n="datum"){if(e){if(Lq(e))return fG(e.value);if(Bq(e)){const{format:i,formatType:r}=Qq(e);return oq({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}}function LX(e,t={}){const{encoding:n,markDef:i,config:r,stack:s}=e,a=n.tooltip;if(vL(a))return{tooltip:jX({tooltip:a},s,r,t)};{const o=t.reactiveGeom?"datum.datum":"datum";return MX(e,a,"tooltip",(e=>{const a=zX(e,r,o);if(a)return a;if(null===e)return;let u=yG("tooltip",i,r);return!0===u&&(u={content:"encoding"}),DL(u)?{value:u}:bL(u)?"encoding"===u.content?jX(n,s,r,t):{signal:o}:void 0}))}}function PX(e,t,n,{reactiveGeom:i}={}){const r={},s=i?"datum.datum":"datum",a=[];function o(i,o){const u=dU(o),l=zq(i)?i:Object.assign(Object.assign({},i),{type:e[u].type}),c=AL(Kq(l,n,{allowDisabling:!1})).join(", ");let d;if(OU(o)){const i="x"===o?"x2":"y2",a=eG(e[i]);if(eW(l.bin)&&a){const e=Vq(l,{expr:s}),t=Vq(a,{expr:s}),{format:o,formatType:u}=Qq(l);d=mq(e,t,o,u,n),r[i]=!0}else if(t&&t.fieldChannel===o&&"normalize"===t.offset){const{format:e,formatType:t}=Qq(l);d=oq({fieldOrDatumDef:l,format:e,formatType:t,expr:s,config:n,normalizeStack:!0}).signal}}d=null!=d?d:zX(l,n,s).signal,a.push({channel:o,key:c,value:d})}$G(e,((e,t)=>{Nq(e)?o(e,t):$q(e)&&o(e.condition,t)}));const u={};for(const{channel:e,key:t,value:n}of a)r[e]||u[t]||(u[$L(t)]=n);return u}function jX(e,t,n,{reactiveGeom:i}={}){const r=uP(PX(e,t,n,{reactiveGeom:i})).map((({key:e,value:t})=>`${e}: ${t}`));return r.length>0?{signal:`{${r.join(", ")}}`}:void 0}function UX(e,t,n={}){const{markDef:i,encoding:r,config:s}=t,{vgChannel:a}=n;let{defaultRef:o,defaultValue:u}=n;void 0===o&&(u=null!=u?u:yG(e,i,s,{vgChannel:a,ignoreVgConfig:!0}),void 0!==u&&(o=fG(u)));const l=r[e];return MX(t,l,null!=a?a:e,(n=>iq({channel:e,channelDef:n,markDef:i,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:o})))}function WX(e,t={filled:void 0}){var n,i,r,s;const{markDef:a,encoding:o,config:u}=e,{type:l}=a,c=null!==(n=t.filled)&&void 0!==n?n:yG("filled",a,u),d=JL(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,h=null!==(r=null!==(i=yG(!0===c?"color":void 0,a,u,{vgChannel:"fill"}))&&void 0!==i?i:u.mark[!0===c&&"color"])&&void 0!==r?r:d,f=null!==(s=yG(!1===c?"color":void 0,a,u,{vgChannel:"stroke"}))&&void 0!==s?s:u.mark[!1===c&&"color"],p=c?"fill":"stroke",m=Object.assign(Object.assign({},h?{fill:fG(h)}:{}),f?{stroke:fG(f)}:{});return a.color&&(c?a.fill:a.stroke)&&NW(mW("property",{fill:"fill"in a,stroke:"stroke"in a})),Object.assign(Object.assign(Object.assign(Object.assign({},m),UX("color",e,{vgChannel:p,defaultValue:c?h:f})),UX("fill",e,{defaultValue:o.fill?h:void 0})),UX("stroke",e,{defaultValue:o.stroke?f:void 0}))}function VX(e,t){const n=t[function(e){switch(e){case fj:return"xOffset";case pj:return"yOffset";case mj:return"x2Offset";case gj:return"y2Offset";case bj:return"thetaOffset";case yj:return"radiusOffset";case xj:return"theta2Offset";case vj:return"radius2Offset"}}(e)];if(n)return n}function qX(e,t,{defaultPos:n,vgChannel:i,isMidPoint:r}){const{encoding:s,markDef:a,config:o,stack:u}=t,l=s[e],c=s[fU(e)],d=t.scaleName(e),h=t.getScaleComponent(e),f=VX(e,a),p=GX({model:t,defaultPos:n,channel:e,scaleName:d,scale:h}),m=!l&&OU(e)&&(s.latitude||s.longitude)?{field:t.getName(e)}:function(e){const{channel:t,channelDef:n,isMidPoint:i,scaleName:r,stack:s,offset:a,markDef:o,config:u}=e;if(Bq(n)&&s&&t===s.fieldChannel){if(Nq(n)){const e=Sq({channel:t,fieldDef:n,isMidPoint:i,markDef:o,stack:s,config:u});if(void 0!==e)return nq({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",band:e,offset:a})}return tq(n,r,{suffix:"end"},{offset:a})}return JV(e)}({channel:e,channelDef:l,channel2Def:c,markDef:a,config:o,isMidPoint:r,scaleName:d,scale:h,stack:u,offset:f,defaultRef:p});return m?{[i||e]:m}:void 0}function GX({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:s,config:a}=e;return()=>{const o=dU(n),u=hU(n),l=yG(n,s,a,{vgChannel:u});if(void 0!==l)return rq(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const e=r.get("type");if(JL(["log",xV,wV],e));else if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}if("zeroOrMin"===t)return"y"===o?{field:{group:"height"}}:{value:0};switch(o){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const t=e[pU(n)];return Object.assign(Object.assign({},t),{mult:.5})}}}}const HX={left:"x",center:"xc",right:"x2"},XX={top:"y",middle:"yc",bottom:"y2"};function YX(e,t,n,i="middle"){if("radius"===e||"theta"===e)return hU(e);const r=yG("x"===e?"align":"baseline",t,n);return"x"===e?HX[r||("top"===i?"left":"center")]:XX[r||i]}function KX(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?JX(e,t,{defaultPos:n,defaultPos2:i}):qX(e,t,{defaultPos:n})}function JX(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=t,a=fU(e),o=pU(e),u=function(e,t,n){const{encoding:i,mark:r,markDef:s,stack:a,config:o}=e,u=dU(n),l=pU(n),c=hU(n),d=i[u],h=e.scaleName(u),f=e.getScaleComponent(u),p=VX(n in i||n in s?n:u,e.markDef);if(!d&&("x2"===n||"y2"===n)&&(i.latitude||i.longitude))return{[c]:{field:e.getName(n)}};const m=function({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:a,stack:o,offset:u,defaultRef:l}){return Bq(t)&&o&&e.charAt(0)===o.fieldChannel.charAt(0)?tq(t,s,{suffix:"start"},{offset:u}):JV({channel:e,channelDef:n,scaleName:s,scale:a,stack:o,markDef:i,config:r,offset:u,defaultRef:l})}({channel:n,channelDef:d,channel2Def:i[n],markDef:s,config:o,scaleName:h,scale:f,stack:a,offset:p,defaultRef:void 0});return void 0!==m?{[c]:m}:ZX(n,s)||ZX(n,{[n]:bG(n,s,o.style),[l]:bG(l,s,o.style)})||ZX(n,o[r])||ZX(n,o.mark)||{[c]:GX({model:e,defaultPos:t,channel:n,scaleName:h,scale:f})()}}(t,i,a),l=u[o]?YX(e,r,s):hU(e);return Object.assign(Object.assign({},qX(e,t,{defaultPos:n,vgChannel:l})),u)}function ZX(e,t){const n=pU(e),i=hU(e);return void 0!==t[i]?{[i]:rq(e,t[i])}:void 0!==t[e]?{[i]:rq(e,t[e])}:t[n]?{[n]:rq(e,t[n])}:void 0}function QX(e,t,n){var i,r,s,a;const{config:o,encoding:u,markDef:l,stack:c}=e,d=fU(t),h=pU(t),f=u[t],p=u[d],m=e.getScaleComponent(t),g=m?m.get("type"):void 0,y=e.scaleName(t),v=l.orient,b=null!==(r=null!==(i=u[h])&&void 0!==i?i:u.size)&&void 0!==r?r:yG("size",l,o,{vgChannel:h}),x="bar"===n&&("x"===t?"vertical"===v:"horizontal"===v);if(Nq(f)&&(QU(f.bin)||eW(f.bin)||f.timeUnit&&!p)&&!b&&!TV(g)){const n=Sq({channel:t,fieldDef:f,stack:c,markDef:l,config:o}),i=null===(s=e.component.axes[t])||void 0===s?void 0:s[0];return function({fieldDef:e,fieldDef2:t,channel:n,band:i,scaleName:r,markDef:s,spacing:a=0,axisTranslate:o,reverse:u,config:l}){const c=fU(n),d=hU(n),h=hU(c),f=VX(n,s);if(QU(e.bin)||e.timeUnit)return{[h]:nY({channel:n,fieldDef:e,scaleName:r,markDef:s,band:(1-i)/2,offset:tY(c,a,u,o,f),config:l}),[d]:nY({channel:n,fieldDef:e,scaleName:r,markDef:s,band:1-(1-i)/2,offset:tY(n,a,u,o,f),config:l})};if(eW(e.bin)){const i=tq(e,r,{},{offset:tY(c,a,u,o,f)});if(Nq(t))return{[h]:i,[d]:tq(t,r,{},{offset:tY(n,a,u,o,f)})};if(tW(e.bin)&&e.bin.step)return{[h]:i,[d]:{signal:`scale("${r}", ${Vq(e,{expr:"datum"})} + ${e.bin.step})`,offset:tY(n,a,u,o,f)}}}NW(FW(c))}({fieldDef:f,fieldDef2:p,channel:t,markDef:l,scaleName:y,band:n,axisTranslate:null!==(a=null==i?void 0:i.get("translate"))&&void 0!==a?a:.5,spacing:OU(t)?yG("binSpacing",l,o):void 0,reverse:m.get("reverse"),config:o})}return(Bq(f)&&TV(g)||x)&&!p?function(e,t,n,i){var r;const{markDef:s,encoding:a,config:o,stack:u}=i,l=s.orient,c=i.scaleName(n),d=i.getScaleComponent(n),h=pU(n),f=fU(n),p="horizontal"===l&&"y"===n||"vertical"===l&&"x"===n,m=yG(p?"size":h,s,o,{vgChannel:h});let g;(a.size||void 0!==m)&&(p?g=UX("size",i,{vgChannel:h,defaultValue:m}):NW(function(e){return`Cannot apply size to non-oriented mark "${e}".`}(s.type)));const y=null!==(r=Bq(t)?Sq({channel:n,fieldDef:t,markDef:s,stack:u,config:o}):void 0)&&void 0!==r?r:1;g=g||{[h]:eY(e,h,c,d,o,y)};const v="band"!==(null==d?void 0:d.get("type"))||!("band"in g[h]),b=YX(n,s,o,v?"middle":"top"),x=VX(n,s),w=JV({channel:n,channelDef:t,markDef:s,config:o,scaleName:c,scale:d,stack:u,offset:x,defaultRef:GX({model:i,defaultPos:"mid",channel:n,scaleName:c,scale:d}),band:v?.5:(1-y)/2});if(h)return Object.assign({[b]:w},g);{const e=hU(f),t=g[h],n=x?Object.assign(Object.assign({},t),{offset:x}):t;return{[b]:w,[e]:vL(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,f,t,e):JX(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function eY(e,t,n,i,r,s){if(i){const t=i.get("type");if("point"===t||"band"===t){if(void 0!==r[e].discreteBandSize)return{value:r[e].discreteBandSize};if(t===CV){const e=i.get("range");return YW(e)&&FL(e.step)?{value:e.step-2}:{value:vH-2}}return{scale:n,band:s}}return{value:r[e].continuousBandSize}}const a=gH(r.view,t),o=xP(r[e].discreteBandSize,a-2);return void 0!==o?{value:o}:void 0}function tY(e,t,n,i,r){if(qj(e))return 0;const s="x"===e||"y2"===e?-t/2:t/2;if(XW(n)){const e=mG(r);return{signal:`${n.signal} ? ${i-s}${e?"-"+e:""} : ${i+s}${e?"+"+e:""}`}}if(XW(r)){const e=i+(n?-s:s);return{signal:`${e||""}${n?" - ":e?" + ":""}${r.signal}`}}return r=r||0,i+(n?-r-s:+r+s)}function nY({channel:e,fieldDef:t,scaleName:n,markDef:i,band:r,offset:s,config:a}){return ZV({fieldDef:t,channel:e,markDef:i,ref:nq({scaleName:n,fieldOrDatumDef:t,band:r,offset:s}),config:a})}const iY=new Set(["aria"]);function rY(e,t){const{fill:n,stroke:i}="include"===t.color?WX(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(e,t){return JW.reduce(((n,i)=>(iY.has(i)||void 0===e[i]||"ignore"===t[i]||(n[i]=fG(e[i])),n)),{})}(e.markDef,t)),sY(e,"fill",n)),sY(e,"stroke",i)),UX("opacity",e)),UX("fillOpacity",e)),UX("strokeOpacity",e)),UX("strokeWidth",e)),UX("strokeDash",e)),LX(e)),BX(e,"href")),function(e){const{markDef:t,config:n}=e,i=yG("aria",t,n);return!1===i?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),function(e){const{mark:t,markDef:n,config:i}=e;if(!1===i.aria)return{};const r=yG("ariaRoleDescription",n,i);return null!=r?{ariaRoleDescription:{value:r}}:t in ZW?{}:{ariaRoleDescription:{value:t}}}(e)),function(e){const{encoding:t,markDef:n,config:i,stack:r}=e,s=t.description;if(s)return MX(e,s,"description",(t=>zX(t,e.config)));const a=yG("description",n,i);if(null!=a)return{description:fG(a)};if(!1===i.aria)return{};const o=PX(t,r,i);return sP(o)?void 0:{description:{signal:uP(o).map((({key:e,value:t})=>`${e} + ": " + (${t})`)).join(' + "; " + ')}}}(e))}(e))}function sY(e,t,n){const{config:i,mark:r,markDef:s}=e;if("hide"===yG("invalid",s,i)&&n&&!GP(r)){const i=function(e,{invalid:t=!1,channels:n}){const i=n.reduce(((t,n)=>{const i=e.getScaleComponent(n);if(i){const r=i.get("type"),s=e.vgField(n,{expr:"datum"});s&&RV(r)&&(t[s]=!0)}return t}),{}),r=aP(i);if(r.length>0){const e=t?"||":"&&";return r.map((e=>eq(e,t))).join(` ${e} `)}}(e,{invalid:!0,channels:GU});if(i)return{[t]:[{test:i,value:null},...AL(n)]}}return n?{[t]:n}:{}}function aY(e){const{config:t,markDef:n}=e;if(yG("invalid",n,t)){const t=function(e,{invalid:t=!1,channels:n}){const i=n.reduce(((t,n)=>{const i=e.getScaleComponent(n);if(i){const r=i.get("type"),s=e.vgField(n,{expr:"datum"});s&&RV(r)&&(t[s]=!0)}return t}),{}),r=aP(i);if(r.length>0){const e=t?"||":"&&";return r.map((e=>eq(e,t))).join(` ${e} `)}}(e,{channels:$U});if(t)return{defined:{signal:t}}}return{}}function oY(e,t){if(void 0!==t)return{[e]:fG(t)}}const uY="voronoi",lY={has:e=>"interval"!==e.type&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(uY)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,s=e.mark;if(GP(s))return NW(`The "nearest" transform is not supported for ${s} marks.`),n;const a={name:e.getName(uY),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},LX(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let o=0,u=!1;return n.forEach(((t,n)=>{var i;const r=null!==(i=t.name)&&void 0!==i?i:"";r===e.component.mark[0].name?o=n:r.indexOf(uY)>=0&&(u=!0)})),u||n.splice(o+1,0,a),n}};class cY{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){this._children.indexOf(e)>-1?console.warn("Attempt to add the same child twice."):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const t of this._children)t.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class dY extends cY{constructor(e,t,n,i){super(e,t),this.type=n,this.refCounts=i,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash=`Output ${function(e){const t=++wP;return t}()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}class hY extends cY{constructor(e,t){super(e),this.formula=t}clone(){return new hY(null,qL(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,i)=>{const{field:r,timeUnit:s}=n,a=FQ(t)?t.encoding[fU(i)]:void 0,o=FQ(t)&&Fq(i,n,a,t.stack,t.markDef,t.config);if(s){const t=Vq(n,{forAs:!0});e[YL({as:t,field:r,timeUnit:s})]=Object.assign({as:t,field:r,timeUnit:s},o?{band:!0}:{})}return e}),{});return sP(n)?null:new hY(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:i}=n,r=NL(n,["timeUnit"]),s=HW(i),a=Object.assign(Object.assign({},r),{timeUnit:s});return new hY(e,{[YL(a)]:a})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)this.formula[t]&&!e.formula[t].band||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(oP(this.formula).map((e=>e.as)))}dependentFields(){return new Set(oP(this.formula).map((e=>e.field)))}hash(){return`TimeUnit ${YL(this.formula)}`}assemble(){const e=[];for(const t of oP(this.formula)){const{field:n,as:i,timeUnit:r}=t,s=HW(r),{unit:a,utc:o}=s,u=NL(s,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:gP(n),type:"timeunit"},a?{units:VW(a)}:{}),o?{timezone:"utc"}:{}),u),{as:[i,`${i}_end`]}))}return e}}const fY="_tuple_fields";class pY{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const mY={has:e=>"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!oH(e.bind),parse:(e,t,n,i)=>{i.on||delete t.events,i.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,s=t.bind,a=t.init&&t.init[0],o=lY.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach(((e,r)=>{var u,l;const c=cP(`${i}_${e.field}`);n.filter((e=>e.name===c)).length||n.unshift(Object.assign(Object.assign({name:c},a?{init:NY(a[r])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${o}[${$L(e.field)}] : null`}]:[],bind:null!==(l=null!==(u=s[e.field])&&void 0!==u?u:s[e.channel])&&void 0!==l?l:s}))})),n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.filter((e=>e.name===i+WY))[0],a=i+fY,o=r.items.map((e=>cP(`${i}_${e.field}`))),u=o.map((e=>`${e} !== null`)).join(" && ");return o.length&&(s.update=`${u} ? {fields: ${a}, values: [${o.join(", ")}]} : null`),delete s.value,delete s.on,n}},gY="_toggle",yY={has:e=>"multi"===e.type&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+gY,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+WY,i=t.name+gY;return`${i} ? null : ${n}, `+("global"===t.resolve?`${i} ? null : true, `:`${i} ? null : {unit: ${HY(e)}}, `)+`${i} ? ${n} : null`}},vY={has:e=>void 0!==e.clear&&!1!==e.clear,parse:(e,t,n)=>{n.clear&&(t.clear=DL(n.clear)?rL(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(mY.has(t))for(const e of t.project.items){const i=n.findIndex((n=>n.name===cP(`${t.name}_${e.field}`)));-1!==i&&n[i].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(e,i){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:i})}if("interval"===t.type)for(const e of t.project.items){const t=n.findIndex((t=>t.name===e.signals.visual));i(t,"[0, 0]"),-1===t&&i(n.findIndex((t=>t.name===e.signals.data)),"null")}else{let e=n.findIndex((e=>e.name===t.name+WY));i(e,"null"),yY.has(t)&&(e=n.findIndex((e=>e.name===t.name+gY)),i(e,"false"))}return n}},bY={has:e=>"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind,parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!HU(r))continue;const s=e.getScaleComponent(r),a=s?s.get("type"):void 0;if(!s||!RV(a)){NW("Scale bindings are currently only supported for scales with unbinned, continuous domains.");continue}const o={selection:t.name,field:i.field};s.set("selectionExtent",o,!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter((e=>0===n.filter((t=>t.name===e.signals.data)).length));if(!e.parent||wY(e)||0===i.length)return n;const r=n.filter((e=>e.name===t.name))[0];let s=r.update;if(s.indexOf(VY)>=0)r.update=`{${i.map((e=>`${$L(e.field)}: ${e.signals.data}`)).join(", ")}}`;else{for(const e of i){const t=`${$L(e.field)}: ${e.signals.data}`;s.indexOf(t)<0&&(s=`${s.substring(0,s.length-1)}, ${t}}`)}r.update=s}return n.concat(i.map((e=>({name:e.signals.data}))))},signals:(e,t,n)=>{if(e.parent&&!wY(e))for(const e of t.scales){const t=n.filter((t=>t.name===e.signals.data))[0];t.push="outer",delete t.value,delete t.update}return n}};function xY(e,t){return`domain(${$L(e.scaleName(t))})`}function wY(e){var t;return e.parent&&OQ(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:wY(e.parent.parent))}const CY={has:e=>{const t="global"===e.resolve&&e.bind&&oH(e.bind),n=1===e.project.items.length&&e.project.items[0].field!==sH;return t&&!n&&NW("Legend bindings are only supported for selections over an individual field or encoding channel."),t&&n},parse:(e,t,n,i)=>{var r;if(i.on||delete t.events,i.clear||delete t.clear,i.on||i.clear){const e='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of t.events)n.filter=AL(null!==(r=n.filter)&&void 0!==r?r:[]),n.filter.indexOf(e)<0&&n.filter.push(e)}const s=uH(t.bind)?t.bind.legend:"click",a=DL(s)?rL(s,"view"):AL(s);t.bind={legend:{merge:a}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=uH(t.bind)&&t.bind.legend,s=e=>t=>{const n=qL(t);return n.markname=e,n};for(const e of t.project.items){if(!e.hasLegend)continue;const a=`${cP(e.field)}_legend`,o=`${i}_${a}`;if(0===n.filter((e=>e.name===o)).length){const e=r.merge.map(s(`${a}_symbols`)).concat(r.merge.map(s(`${a}_labels`))).concat(r.merge.map(s(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:o},t.init?{}:{value:null}),{on:[{events:e,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${o}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find((e=>e.name===i+WY)),a=i+fY,o=r.items.filter((e=>e.hasLegend)).map((e=>cP(`${i}_${cP(e.field)}_legend`))),u=`${o.map((e=>`${e} !== null`)).join(" && ")} ? {fields: ${a}, values: [${o.join(", ")}]} : null`;t.events&&o.length>0?s.on.push({events:o.map((e=>({signal:e}))),update:u}):o.length>0&&(s.update=u,delete s.value,delete s.on);const l=n.find((e=>e.name===i+gY)),c=uH(t.bind)&&t.bind.legend;return l&&(t.events?l.on.push(Object.assign(Object.assign({},l.on[0]),{events:c})):l.on[0].events=c),n}},kY="_translate_anchor",AY="_translate_delta",_Y={has:e=>"interval"===e.type&&e.translate,signals:(e,t,n)=>{const i=t.name,r=bY.has(t),s=i+kY,{x:a,y:o}=t.project.hasChannel;let u=rL(t.translate,"scope");return r||(u=u.map((e=>(e.between[0].markname=i+RY,e)))),n.push({name:s,value:{},on:[{events:u.map((e=>e.between[0])),update:"{x: x(unit), y: y(unit)"+(void 0!==a?", extent_x: "+(r?xY(e,fj):`slice(${a.signals.visual})`):"")+(void 0!==o?", extent_y: "+(r?xY(e,pj):`slice(${o.signals.visual})`):"")+"}"}]},{name:i+AY,value:{},on:[{events:u,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),void 0!==a&&EY(e,t,a,"width",n),void 0!==o&&EY(e,t,o,"height",n),n}};function EY(e,t,n,i,r){var s;const a=t.name,o=a+kY,u=a+AY,l=n.channel,c=bY.has(t),d=r.filter((e=>e.name===n.signals[c?"data":"visual"]))[0],h=e.getSizeSignalRef(i).signal,f=e.getScaleComponent(l),p=f.get("type"),m=`${o}.extent_${l}`,g=`${c?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear"}(${m}, ${`${c&&l===fj?"-":""}${u}.${l} / `+(c?`${h}`:`span(${m})`)}`+(c&&"pow"===p?`, ${null!==(s=f.get("exponent"))&&void 0!==s?s:1}`:"")+")";d.on.push({events:{signal:u},update:c?g:`clampRange(${g}, 0, ${h})`})}const SY="_zoom_delta",FY={has:e=>"interval"===e.type&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=bY.has(t),s=i+SY,{x:a,y:o}=t.project.hasChannel,u=$L(e.scaleName(fj)),l=$L(e.scaleName(pj));let c=rL(t.zoom,"scope");return r||(c=c.map((e=>(e.markname=i+RY,e)))),n.push({name:i+"_zoom_anchor",on:[{events:c,update:r?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter((e=>!!e)).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==a&&DY(e,t,a,"width",n),void 0!==o&&DY(e,t,o,"height",n),n}};function DY(e,t,n,i,r){var s;const a=t.name,o=n.channel,u=bY.has(t),l=r.filter((e=>e.name===n.signals[u?"data":"visual"]))[0],c=e.getSizeSignalRef(i).signal,d=e.getScaleComponent(o),h=d.get("type"),f=u?xY(e,o):l.name,p=a+SY,m=`${u?"log"===h?"zoomLog":"pow"===h?"zoomPow":"zoomLinear":"zoomLinear"}(${f}, ${a}_zoom_anchor.${o}, ${p}`+(u&&"pow"===h?`, ${null!==(s=d.get("exponent"))&&void 0!==s?s:1}`:"")+")";l.on.push({events:{signal:p},update:u?m:`clampRange(${m}, 0, ${c})`})}const $Y=[{has:()=>!0,parse:(e,t,n)=>{var i,r,s;const a=t.name,o=null!==(i=t.project)&&void 0!==i?i:t.project=new pY,u={},l={},c=new Set,d=(e,t)=>{const n="visual"===t?e.channel:e.field;let i=cP(`${a}_${n}`);for(let e=1;c.has(i);e++)i=cP(`${a}_${n}_${e}`);return c.add(i),{[t]:i}};if(!n.fields&&!n.encodings){const t=e.config.selection[n.type];if(n.init)for(const e of AL(n.init))for(const i of aP(e))oU[i]?(n.encodings||(n.encodings=[])).push(i):"interval"===n.type?(NW('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=t.encodings):(n.fields||(n.fields=[])).push(i);else n.encodings=t.encodings,n.fields=t.fields}for(const e of null!==(r=n.fields)&&void 0!==r?r:[]){const t={type:"E",field:e};t.signals=Object.assign({},d(t,"data")),o.items.push(t),o.hasField[e]=t}for(const i of null!==(s=n.encodings)&&void 0!==s?s:[]){const n=e.fieldDef(i);if(n){let r=n.field;if(n.aggregate){NW(lW(i,n.aggregate));continue}if(!r){NW(uW(i));continue}if(n.timeUnit){r=e.vgField(i);const t={timeUnit:n.timeUnit,as:r,field:n.field};l[YL(t)]=t}if(!u[r]){let s="E";"interval"===t.type?RV(e.getScaleComponent(i).get("type"))&&(s="R"):n.bin&&(s="R-RE");const a={field:r,channel:i,type:s};a.signals=Object.assign(Object.assign({},d(a,"data")),d(a,"visual")),o.items.push(u[r]=a),o.hasField[r]=o.hasChannel[i]=u[r]}}else NW(uW(i))}if(n.init){const e=e=>o.items.map((t=>void 0!==e[t.channel]?e[t.channel]:e[t.field]));if("interval"===n.type)t.init=e(n.init);else{const i=AL(n.init);t.init=i.map(e)}}sP(l)||(o.timeUnit=new hY(null,l))},signals:(e,t,n)=>{const i=t.name+fY;return n.filter((e=>e.name===i)).length>0?n:n.concat({name:i,value:t.project.items.map((e=>{const{signals:t,hasLegend:n}=e,i=NL(e,["signals","hasLegend"]);return i.field=gP(i.field),i}))})}},yY,bY,CY,_Y,FY,mY,lY,vY];function OY(e,t){for(const n of $Y)n.has(e)&&t(n)}function NY(e,t=!0,n=gL){if(vL(e)){const i=e.map((e=>NY(e,t,n)));return t?`[${i.join(", ")}]`:i}return IW(e)?n(t?LW(e):function(e){const t=zW(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}(e)):t?n(JSON.stringify(e)):e}function IY(e,t){return GY(e,((n,i)=>{t=i.marks?i.marks(e,n,t):t,OY(n,(i=>{i.marks&&(t=i.marks(e,n,t))}))})),t}function TY(e){return e.map((e=>(e.on&&!e.on.length&&delete e.on,e)))}const RY="_brush",MY="_scale_trigger",BY={signals:(e,t)=>{const n=t.name,i=n+fY,r=bY.has(t),s=[],a=[],o=[];if(t.translate&&!r){const e=`!event.item || event.item.mark.name !== ${$L(n+RY)}`;zY(t,((t,n)=>{var i;const r=AL(null!==(i=n.between[0].filter)&&void 0!==i?i:n.between[0].filter=[]);return r.indexOf(e)<0&&r.push(e),t}))}t.project.items.forEach(((n,i)=>{const r=n.channel;if(r!==fj&&r!==pj)return void NW("Interval selections only support x and y encoding channels.");const u=t.init?t.init[i]:null,l=function(e,t,n,i){const r=n.channel,s=n.signals.visual,a=n.signals.data,o=bY.has(t),u=$L(e.scaleName(r)),l=e.getScaleComponent(r),c=l?l.get("type"):void 0,d=e=>`scale(${u}, ${e})`,h=e.getSizeSignalRef(r===fj?"width":"height").signal,f=`${r}(unit)`,p=zY(t,((e,t)=>[...e,{events:t.between[0],update:`[${f}, ${f}]`},{events:t,update:`[${s}[0], clamp(${f}, 0, ${h})]`}]));return p.push({events:{signal:t.name+MY},update:RV(c)?`[${d(`${a}[0]`)}, ${d(`${a}[1]`)}]`:"[0, 0]"}),o?[{name:a,on:[]}]:[Object.assign(Object.assign({name:s},i?{init:NY(i,!0,d)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:a},i?{init:NY(i)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${u}, ${s})`}]})]}(e,t,n,u),c=n.signals.data,d=n.signals.visual,h=$L(e.scaleName(r)),f=RV(e.getScaleComponent(r).get("type"))?"+":"";s.push(...l),a.push(c),o.push({scaleName:e.scaleName(r),expr:`(!isArray(${c}) || (${f}invert(${h}, ${d})[0] === ${f}${c}[0] && ${f}invert(${h}, ${d})[1] === ${f}${c}[1]))`})})),r||s.push({name:n+MY,value:{},on:[{events:o.map((e=>({scale:e.scaleName}))),update:o.map((e=>e.expr)).join(" && ")+` ? ${n+MY} : {}`}]});const u=t.init,l=`unit: ${HY(e)}, fields: ${i}, values`;return s.concat(Object.assign(Object.assign({name:n+WY},u?{init:`{${l}: ${NY(u)}}`}:{}),{on:[{events:[{signal:a.join(" || ")}],update:a.join(" && ")+` ? {${l}: [${a}]} : null`}]}))},modifyExpr:(e,t)=>t.name+WY+", "+("global"===t.resolve?"true":`{unit: ${HY(e)}}`),marks:(e,t,n)=>{const i=t.name,{x:r,y:s}=t.project.hasChannel,a=r&&r.signals.visual,o=s&&s.signals.visual,u=`data(${$L(t.name+UY)})`;if(bY.has(t))return n;const l={x:void 0!==r?{signal:`${a}[0]`}:{value:0},y:void 0!==s?{signal:`${o}[0]`}:{value:0},x2:void 0!==r?{signal:`${a}[1]`}:{field:{group:"width"}},y2:void 0!==s?{signal:`${o}[1]`}:{field:{group:"height"}}};if("global"===t.resolve)for(const t of aP(l))l[t]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${HY(e)}`},l[t]),{value:0}];const c=t.mark,{fill:d,fillOpacity:h,cursor:f}=c,p=NL(c,["fill","fillOpacity","cursor"]),m=aP(p).reduce(((e,t)=>(e[t]=[{test:[void 0!==r&&`${a}[0] !== ${a}[1]`,void 0!==s&&`${o}[0] !== ${o}[1]`].filter((e=>e)).join(" && "),value:p[t]},{value:null}],e)),{});return[{name:i+RY+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:d},fillOpacity:{value:h}},update:l}},...n,{name:i+RY,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},f?{cursor:{value:f}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),m)}}]}};function zY(e,t){return e.events.reduce(((e,n)=>n.between?t(e,n):(NW(`${n} is not an ordered event stream for interval selections.`),e)),[])}function LY(e,t){const n=t.name,i=n+fY,r=t.project,s="(item().isVoronoi ? datum.datum : datum)",a=r.items.map((t=>{const n=e.fieldDef(t.channel);return n&&n.bin?`[${s}[${$L(e.vgField(t.channel,{}))}], ${s}[${$L(e.vgField(t.channel,{binSuffix:"end"}))}]]`:`${s}[${$L(t.field)}]`})).join(", "),o=`unit: ${HY(e)}, fields: ${i}, values`,u=t.events;return[{name:n+WY,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${o}: [${a}]} : null`,force:!0}]:[]}]}const PY={signals:LY,modifyExpr:(e,t)=>t.name+WY+", "+("global"===t.resolve?"null":`{unit: ${HY(e)}}`)},jY={signals:LY,modifyExpr:(e,t)=>t.name+WY+", "+("global"===t.resolve?"true":`{unit: ${HY(e)}}`)},UY="_store",WY="_tuple",VY="vlSelectionResolve",qY={single:jY,multi:PY,interval:BY};function GY(e,t){const n=e.component.selection;if(n)for(const e of oP(n))if(!0===t(e,qY[e.type]))break}function HY(e,{escape:t}={escape:!0}){let n=t?$L(e.name):e.name;const i=function(e){let t=e.parent;for(;t&&!DQ(t);)t=t.parent;return t}(e);if(i){const{facet:e}=i;for(const t of Jj)e[t]&&(n+=` + '__facet_${t}_' + (facet[${$L(i.vgField(t))}])`)}return n}function XY(e){let t=!1;return GY(e,(e=>{t=t||e.project.items.some((e=>e.field===sH))})),t}function YY(e){this.type=e}var KY,JY,ZY,QY,eK;YY.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case"CallExpression":return[e.callee].concat(e.arguments);case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this),n=0,i=t.length;n<i;++n)if(t[n].visit(e))return 1},(KY={})[1]="Boolean",KY[2]="<end>",KY[3]="Identifier",KY[4]="Keyword",KY[5]="Null",KY[6]="Numeric",KY[7]="Punctuator",KY[8]="String",KY[9]="RegularExpression";var tK="Identifier",nK="Unexpected token %0",iK="Invalid regular expression",rK="Invalid regular expression: missing /",sK="Octal literals are not allowed in strict mode.",aK="ILLEGAL",oK="Disabled.",uK=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),lK=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function cK(e,t){if(!e)throw new Error("ASSERT: "+t)}function dK(e){return e>=48&&e<=57}function hK(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function fK(e){return"01234567".indexOf(e)>=0}function pK(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function mK(e){return 10===e||13===e||8232===e||8233===e}function gK(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&uK.test(String.fromCharCode(e))}function yK(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&lK.test(String.fromCharCode(e))}var vK={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function bK(){for(var e;ZY<QY&&(pK(e=JY.charCodeAt(ZY))||mK(e));)++ZY}function xK(e){var t,n,i,r=0;for(n="u"===e?4:2,t=0;t<n;++t)ZY<QY&&hK(JY[ZY])?(i=JY[ZY++],r=16*r+"0123456789abcdef".indexOf(i.toLowerCase())):IK({},nK,aK);return String.fromCharCode(r)}function wK(){var e,t,n,i;for(t=0,"}"===(e=JY[ZY])&&IK({},nK,aK);ZY<QY&&hK(e=JY[ZY++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&IK({},nK,aK),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),i=56320+(t-65536&1023),String.fromCharCode(n,i))}function CK(){var e,t;for(e=JY.charCodeAt(ZY++),t=String.fromCharCode(e),92===e&&(117!==JY.charCodeAt(ZY)&&IK({},nK,aK),++ZY,(e=xK("u"))&&"\\"!==e&&gK(e.charCodeAt(0))||IK({},nK,aK),t=e);ZY<QY&&yK(e=JY.charCodeAt(ZY));)++ZY,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==JY.charCodeAt(ZY)&&IK({},nK,aK),++ZY,(e=xK("u"))&&"\\"!==e&&yK(e.charCodeAt(0))||IK({},nK,aK),t+=e);return t}function kK(){var e,t,n,i,r=ZY,s=JY.charCodeAt(ZY),a=JY[ZY];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++ZY,{type:7,value:String.fromCharCode(s),start:r,end:ZY};default:if(61===(e=JY.charCodeAt(ZY+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return ZY+=2,{type:7,value:String.fromCharCode(s)+String.fromCharCode(e),start:r,end:ZY};case 33:case 61:return ZY+=2,61===JY.charCodeAt(ZY)&&++ZY,{type:7,value:JY.slice(r,ZY),start:r,end:ZY}}}return">>>="===(i=JY.substr(ZY,4))?{type:7,value:i,start:r,end:ZY+=4}:">>>"===(n=i.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:r,end:ZY+=3}:a===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(a)>=0||"=>"===t?{type:7,value:t,start:r,end:ZY+=2}:"<>=!+-*%&|^/".indexOf(a)>=0?{type:7,value:a,start:r,end:++ZY}:void IK({},nK,aK)}function AK(){var e,t,n;if(cK(dK((n=JY[ZY]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=ZY,e="","."!==n){if(e=JY[ZY++],n=JY[ZY],"0"===e){if("x"===n||"X"===n)return++ZY,function(e){for(var t="";ZY<QY&&hK(JY[ZY]);)t+=JY[ZY++];return 0===t.length&&IK({},nK,aK),gK(JY.charCodeAt(ZY))&&IK({},nK,aK),{type:6,value:parseInt("0x"+t,16),start:e,end:ZY}}(t);if(fK(n))return function(e){for(var t="0"+JY[ZY++];ZY<QY&&fK(JY[ZY]);)t+=JY[ZY++];return(gK(JY.charCodeAt(ZY))||dK(JY.charCodeAt(ZY)))&&IK({},nK,aK),{type:6,value:parseInt(t,8),octal:!0,start:e,end:ZY}}(t);n&&dK(n.charCodeAt(0))&&IK({},nK,aK)}for(;dK(JY.charCodeAt(ZY));)e+=JY[ZY++];n=JY[ZY]}if("."===n){for(e+=JY[ZY++];dK(JY.charCodeAt(ZY));)e+=JY[ZY++];n=JY[ZY]}if("e"===n||"E"===n)if(e+=JY[ZY++],"+"!==(n=JY[ZY])&&"-"!==n||(e+=JY[ZY++]),dK(JY.charCodeAt(ZY)))for(;dK(JY.charCodeAt(ZY));)e+=JY[ZY++];else IK({},nK,aK);return gK(JY.charCodeAt(ZY))&&IK({},nK,aK),{type:6,value:parseFloat(e),start:t,end:ZY}}function _K(){var e;return bK(),ZY>=QY?{type:2,start:ZY,end:ZY}:gK(e=JY.charCodeAt(ZY))?function(){var e,t;return e=ZY,{type:1===(t=92===JY.charCodeAt(ZY)?CK():function(){var e,t;for(e=ZY++;ZY<QY;){if(92===(t=JY.charCodeAt(ZY)))return ZY=e,CK();if(!yK(t))break;++ZY}return JY.slice(e,ZY)}()).length?3:vK.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:ZY}}():40===e||41===e||59===e?kK():39===e||34===e?function(){var e,t,n,i,r="",s=!1;for(cK("'"===(e=JY[ZY])||'"'===e,"String literal must starts with a quote"),t=ZY,++ZY;ZY<QY;){if((n=JY[ZY++])===e){e="";break}if("\\"===n)if((n=JY[ZY++])&&mK(n.charCodeAt(0)))"\r"===n&&"\n"===JY[ZY]&&++ZY;else switch(n){case"u":case"x":"{"===JY[ZY]?(++ZY,r+=wK()):r+=xK(n);break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:fK(n)?(0!==(i="01234567".indexOf(n))&&(s=!0),ZY<QY&&fK(JY[ZY])&&(s=!0,i=8*i+"01234567".indexOf(JY[ZY++]),"0123".indexOf(n)>=0&&ZY<QY&&fK(JY[ZY])&&(i=8*i+"01234567".indexOf(JY[ZY++]))),r+=String.fromCharCode(i)):r+=n}else{if(mK(n.charCodeAt(0)))break;r+=n}}return""!==e&&IK({},nK,aK),{type:8,value:r,octal:s,start:t,end:ZY}}():46===e?dK(JY.charCodeAt(ZY+1))?AK():kK():dK(e)?AK():kK()}function EK(){var e;return ZY=(e=eK).end,eK=_K(),ZY=e.end,e}function SK(){var e;e=ZY,eK=_K(),ZY=e}function FK(e,t,n){var i=new YY("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return i.operator=e,i.left=t,i.right=n,i}function DK(e){var t=new YY(tK);return t.name=e,t}function $K(e){var t=new YY("Literal");return t.value=e.value,t.raw=JY.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function OK(e,t,n){var i=new YY("MemberExpression");return i.computed="["===e,i.object=t,i.property=n,i.computed||(n.member=!0),i}function NK(e,t,n){var i=new YY("Property");return i.key=t,i.value=n,i.kind=e,i}function IK(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(function(e,t){return cK(t<i.length,"Message reference must be in range"),i[t]}));throw(n=new Error(r)).index=ZY,n.description=r,n}function TK(e){2===e.type&&IK(e,"Unexpected end of input"),6===e.type&&IK(e,"Unexpected number"),8===e.type&&IK(e,"Unexpected string"),3===e.type&&IK(e,"Unexpected identifier"),4===e.type&&IK(e,"Unexpected reserved word"),IK(e,nK,e.value)}function RK(e){var t=EK();7===t.type&&t.value===e||TK(t)}function MK(e){return 7===eK.type&&eK.value===e}function BK(e){return 4===eK.type&&eK.value===e}function zK(){var e;return ZY=eK.start,8===(e=EK()).type||6===e.type?(e.octal&&IK(e,sK),$K(e)):DK(e.value)}function LK(){var e,t,n;return ZY=eK.start,3===(e=eK).type?(n=zK(),RK(":"),NK("init",n,HK())):2!==e.type&&7!==e.type?(t=zK(),RK(":"),NK("init",t,HK())):void TK(e)}var PK={if:1};function jK(){var e,t,n;if(MK("("))return function(){var e;return RK("("),e=XK(),RK(")"),e}();if(MK("["))return function(){var e=[];for(ZY=eK.start,RK("[");!MK("]");)MK(",")?(EK(),e.push(null)):(e.push(HK()),MK("]")||RK(","));return EK(),function(e){var t=new YY("ArrayExpression");return t.elements=e,t}(e)}();if(MK("{"))return function(){var e,t,n=[],i={},r=String;for(ZY=eK.start,RK("{");!MK("}");)t="$"+((e=LK()).key.type===tK?e.key.name:r(e.key.value)),Object.prototype.hasOwnProperty.call(i,t)?IK({},"Duplicate data property in object literal not allowed in strict mode"):i[t]=!0,n.push(e),MK("}")||RK(",");return RK("}"),function(e){var t=new YY("ObjectExpression");return t.properties=e,t}(n)}();if(e=eK.type,ZY=eK.start,3===e||PK[eK.value])n=DK(EK().value);else if(8===e||6===e)eK.octal&&IK(eK,sK),n=$K(EK());else{if(4===e)throw new Error(oK);1===e?((t=EK()).value="true"===t.value,n=$K(t)):5===e?((t=EK()).value=null,n=$K(t)):MK("/")||MK("/=")?(n=$K(function(){var e,t,n,i;return eK=null,bK(),e=ZY,t=function(){var e,t,n,i;for(cK("/"===(e=JY[ZY]),"Regular expression literal must start with a slash"),t=JY[ZY++],n=!1,i=!1;ZY<QY;)if(t+=e=JY[ZY++],"\\"===e)mK((e=JY[ZY++]).charCodeAt(0))&&IK({},rK),t+=e;else if(mK(e.charCodeAt(0)))IK({},rK);else if(n)"]"===e&&(n=!1);else{if("/"===e){i=!0;break}"["===e&&(n=!0)}return i||IK({},rK),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";ZY<QY&&yK((e=JY[ZY]).charCodeAt(0));)++ZY,"\\"===e&&ZY<QY?IK({},nK,aK):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&IK({},iK,n),{value:n,literal:t}}(),i=function(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(e,t){if(parseInt(t,16)<=1114111)return"x";IK({},iK)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){IK({},iK)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:ZY}}()),SK()):TK(EK())}return n}function UK(){var e=[];if(RK("("),!MK(")"))for(;ZY<QY&&(e.push(HK()),!MK(")"));)RK(",");return RK(")"),e}function WK(){var e;return RK("["),e=XK(),RK("]"),e}function VK(){var e=function(){var e,t,n,i,r;for(e=jK();;)if(MK("."))e=OK(".",e,(r=void 0,RK("."),ZY=eK.start,function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(r=EK())||TK(r),DK(r.value)));else if(MK("("))t=e,n=UK(),i=void 0,(i=new YY("CallExpression")).callee=t,i.arguments=n,e=i;else{if(!MK("["))break;e=OK("[",e,WK())}return e}();if(7===eK.type&&(MK("++")||MK("--")))throw new Error(oK);return e}function qK(){var e,t;if(7!==eK.type&&4!==eK.type)t=VK();else{if(MK("++")||MK("--"))throw new Error(oK);if(MK("+")||MK("-")||MK("~")||MK("!"))e=EK(),t=qK(),t=function(e,t){var n=new YY("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(BK("delete")||BK("void")||BK("typeof"))throw new Error(oK);t=VK()}}return t}function GK(e){var t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function HK(){var e,t;return e=function(){var e,t,n,i,r,s,a,o,u,l;if(e=eK,u=qK(),0===(r=GK(i=eK)))return u;for(i.prec=r,EK(),t=[e,eK],s=[u,i,a=qK()];(r=GK(eK))>0;){for(;s.length>2&&r<=s[s.length-2].prec;)a=s.pop(),o=s.pop().value,u=s.pop(),t.pop(),n=FK(o,u,a),s.push(n);(i=EK()).prec=r,s.push(i),t.push(eK),n=qK(),s.push(n)}for(n=s[l=s.length-1],t.pop();l>1;)t.pop(),n=FK(s[l-1].value,s[l-2],n),l-=2;return n}(),MK("?")&&(EK(),t=HK(),RK(":"),e=function(e,t,n){var i=new YY("ConditionalExpression");return i.test=e,i.consequent=t,i.alternate=n,i}(e,t,HK())),e}function XK(){var e=HK();if(MK(","))throw new Error(oK);return e}function YK(e,t,n){return e.fields=t||[],e.fname=n,e}function KK(e){return 1===e.length?JK(e[0]):ZK(e)}const JK=e=>function(t){return t[e]},ZK=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function QK(e){throw Error(e)}function eJ(e){const t=[];return"Identifier"===e.type?[e.name]:"Literal"===e.type?[e.value]:("MemberExpression"===e.type&&(t.push(...eJ(e.object)),t.push(...eJ(e.property))),t)}function tJ(e){return"MemberExpression"===e.object.type?tJ(e.object):"datum"===e.object.name}function nJ(e){const t=function(e){ZY=0,QY=(JY=e).length,eK=null,SK();var t=XK();if(2!==eK.type)throw new Error("Unexpect token after expression.");return t}(e),n=new Set;return t.visit((e=>{"MemberExpression"===e.type&&tJ(e)&&n.add(eJ(e).slice(1).join("."))})),n}(function(e,t,n){const i=function(e){const t=[],n=e.length;let i,r,s,a=null,o=0,u="";function l(){t.push(u+e.substring(i,r)),u="",i=r+1}for(e+="",i=r=0;r<n;++r)if(s=e[r],"\\"===s)u+=e.substring(i,r),u+=e.substring(++r,++r),i=r;else if(s===a)l(),a=null,o=-1;else{if(a)continue;i===o&&'"'===s||i===o&&"'"===s?(i=r+1,a=s):"."!==s||o?"["===s?(r>i&&l(),o=i=r+1):"]"===s&&(o||QK("Access path missing open bracket: "+e),o>0&&l(),o=0,i=r+1):r>i?l():i=r+1}return o&&QK("Access path missing closing bracket: "+e),a&&QK("Access path missing closing quote: "+e),r>i&&(r++,l()),t}(e);e=1===i.length?i[0]:e,YK((n&&n.get||KK)(i),[e],t||e)})("id"),YK((e=>e),[],"identity"),YK((()=>0),[],"zero"),YK((()=>1),[],"one"),YK((()=>!0),[],"true"),YK((()=>!1),[],"false"),Array.isArray,Object.prototype.hasOwnProperty;class iJ extends cY{constructor(e,t,n){super(e),this.model=t,this.filter=n,this.expr=aJ(this.model,this.filter,this),this._dependentFields=nJ(this.expr)}clone(){return new iJ(null,this.model,qL(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function rJ(e,t,n,i="datum"){const r=[],s=dP(t,(function(t){const s=cP(t),a=e.getSelectionComponent(s,t),o=$L(s+UY);if(a.project.timeUnit){const t=null!=n?n:e.component.data.raw,i=a.project.timeUnit.clone();t.parent?i.insertAsParentOf(t):t.parent=i}return"none"!==a.empty&&r.push(o),`vlSelectionTest(${o}, ${i}`+("global"===a.resolve?")":`, ${$L(a.resolve)})`)}));return(r.length?"!("+r.map((e=>`length(data(${e}))`)).join(" || ")+") || ":"")+`(${s})`}function sJ(e,t){const n=t.encoding;let i=t.field;if(n||i){if(n&&!i){const r=e.project.items.filter((e=>e.channel===n));!r.length||r.length>1?(i=e.project.items[0].field,NW((r.length?"Multiple ":"No ")+`matching ${$L(n)} encoding found for selection ${$L(t.selection)}. `+`Using "field": ${$L(i)}.`)):i=r[0].field}}else i=e.project.items[0].field,e.project.items.length>1&&NW(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${$L(i)}.`);return`${e.name}[${$L(i)}]`}function aJ(e,t,n){return dP(t,(t=>DL(t)?t:function(e){return null==e?void 0:e.selection}(t)?rJ(e,t.selection,n):lV(t)))}function oJ(e,t,n,i){var r,s,a;e.encode=null!==(r=e.encode)&&void 0!==r?r:{},e.encode[t]=null!==(s=e.encode[t])&&void 0!==s?s:{},e.encode[t].update=null!==(a=e.encode[t].update)&&void 0!==a?a:{},e.encode[t].update[n]=i}function uJ(e,t,n,i={header:!1}){var r,s;const a=e.combine(),{disable:o,orient:u,scale:l,labelExpr:c,title:d,zindex:h}=a,f=NL(a,["disable","orient","scale","labelExpr","title","zindex"]);if(!o){for(const e in f){const n=SP[e],i=f[e];if(n&&n!==t&&"both"!==n)delete f[e];else if(_P(i)){const{condition:t}=i,n=NL(i,["condition"]),r=AL(t),s=AP[e];if(s){const{vgProp:t,part:i}=s;oJ(f,i,t,[...r.map((e=>{const{test:t}=e,n=NL(e,["test"]);return Object.assign({test:aJ(null,t)},n)})),n]),delete f[e]}else if(null===s){const t={signal:r.map((e=>{const{test:t}=e,n=NL(e,["test"]);return`${aJ(null,t)} ? ${pG(n)} : `})).join("")+pG(n)};f[e]=t}}else if(XW(i)){const t=AP[e];if(t){const{vgProp:n,part:r}=t;oJ(f,r,n,i),delete f[e]}}}if("grid"===t){if(!f.grid)return;if(f.encode){const{grid:e}=f.encode;f.encode=Object.assign({},e?{grid:e}:{}),sP(f.encode)&&delete f.encode}return Object.assign(Object.assign({scale:l,orient:u},f),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:xP(h,0)})}{if(!i.header&&e.mainExtracted)return;if(void 0!==c){let e=c;(null===(s=null===(r=f.encode)||void 0===r?void 0:r.labels)||void 0===s?void 0:s.update)&&XW(f.encode.labels.update.text)&&(e=yP(c,"datum.label",f.encode.labels.update.text.signal)),oJ(f,"labels","text",{signal:e})}if(null===f.labelAlign&&delete f.labelAlign,f.encode){for(const t of EP)e.hasAxisPart(t)||delete f.encode[t];sP(f.encode)&&delete f.encode}const t=function(e,t){if(e)return vL(e)&&!hG(e)?e.map((e=>Zq(e,t))).join(", "):e}(d,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:u,grid:!1},t?{title:t}:{}),f),!1===n.aria?{aria:!1}:{}),{zindex:xP(h,0)})}}}function lJ(e){const{axes:t}=e.component,n=[];for(const i of $U)if(t[i])for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const t="x"===i?"height":"width",r=e.getSizeSignalRef(t).signal;t!==r&&n.push({name:t,update:r})}return n}const cJ={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},dJ={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},hJ=aP(cJ),fJ=aP(dJ);function pJ(e,t,n,i){return Object.assign.apply(null,[{},...e.map((e=>{if("axisOrient"===e){const e="x"===n?"bottom":"left",r=t["x"===n?"axisBottom":"axisLeft"]||{},s=t["x"===n?"axisTop":"axisRight"]||{},a=new Set([...aP(r),...aP(s)]),o={};for(const t of a.values())o[t]={signal:`${i.signal} === "${e}" ? ${mG(r[t])} : ${mG(s[t])}`};return o}return t[e]}))])}function mJ(e,t){var n;const i=[{}];for(const r of e){let e=null===(n=t[r])||void 0===n?void 0:n.style;if(e){e=AL(e);for(const n of e)i.push(t.style[n])}}return Object.assign.apply(null,i)}function gJ(e,t,n,i={}){var r;const s=xG(e,n,t.style);if(void 0!==s)return{configFrom:"style",configValue:s};for(const t of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(r=i[t])||void 0===r?void 0:r[e]))return{configFrom:t,configValue:i[t][e]};return{}}const yJ={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return cq(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return dq(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return(!Nq(e)||!eW(e.bin))&&(null!==(i=t.grid)&&void 0!==i?i:function(e,t){return!TV(e)&&Nq(t)&&!QU(null==t?void 0:t.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(e,t){const n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||xJ(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||bJ(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return null!==(i=e.labelFlush)&&void 0!==i?i:function(e,t){if("x"===t&&JL(["quantitative","temporal"],e))return!0}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return null!==(i=e.labelOverlap)&&void 0!==i?i:function(e,t){if("nominal"!==e)return"log"!==t||"greedy"}(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var s;const a="x"===e?"width":"y"===e?"height":void 0,o=a?t.getSizeSignalRef(a):void 0;return null!==(s=n.tickCount)&&void 0!==s?s:function({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!TV(t)&&"log"!==t){if(Nq(e)){if(QU(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&JL(["month","hours","day","quarter"],null===(r=HW(e.timeUnit))||void 0===r?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}}({fieldOrDatumDef:i,scaleType:r,size:o,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(void 0!==e.title)return e.title;const i=wJ(t,n);if(void 0!==i)return i;const r=t.typedFieldDef(n),s="x"===n?"x2":"y2",a=t.fieldDef(s);return CG(r?[_q(r)]:[],Nq(a)?[_q(a)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(e,t){const n=e.values;return vL(n)?lG(t,n):XW(n)?n:void 0}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return null!==(i=e.zindex)&&void 0!==i?i:function(e,t){return"rect"===e&&qq(t)?1:0}(n,t)}};function vJ(e){return`(((${e.signal} % 360) + 360) % 360)`}function bJ(e,t,n,i){if(void 0!==e){if("x"===n){if(XW(e)){const n=vJ(e);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${XW(t)?`(${t.signal} === "top")`:"top"===t} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(XW(t)){const n=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${n} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==("top"===t)?"bottom":"top"}if(XW(e)){const n=vJ(e);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${XW(t)?`(${t.signal} === "left")`:"left"===t} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(XW(t)){const n=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${n} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==("left"===t)?"top":"bottom"}}function xJ(e,t,n){if(void 0===e)return;const i="x"===n,r=i?0:90,s=i?"bottom":"left";if(XW(e)){const n=vJ(e);return{signal:`(${r?"("+n+" + 90)":n} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${n} && ${n} < ${180+r}) === ${XW(t)?`(${t.signal} === "${s}")`:t===s} ? "left" : "right"`}}if((e+r)%180==0)return i?null:"center";if(XW(t)){const n=r<e&&e<180+r?"===":"!==";return{signal:`${t.signal} ${n} "${s}" ? "left" : "right"`}}return(r<e&&e<180+r)==(t===s)?"left":"right"}function wJ(e,t){const n="x"===t?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),s=i?i.title:void 0,a=r?r.title:void 0;return s&&a?kG(s,a):s||a||(void 0!==s?s:void 0!==a?a:void 0)}class CJ extends cY{constructor(e,t){super(e),this.transform=t,this._dependentFields=nJ(this.transform.calculate)}clone(){return new CJ(null,qL(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef(((t,n)=>{if(Pq(t)&&wq(t.sort)){const{field:i,timeUnit:r}=t,s=t.sort,a=s.map(((e,t)=>`${lV({field:i,timeUnit:r,equal:e})} ? ${t} : `)).join("")+s.length;e=new CJ(e,{calculate:a,as:kJ(t,n,{forAs:!0})})}})),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${YL(this.transform)}`}}function kJ(e,t,n){return Vq(e,Object.assign({prefix:t,suffix:"sort_index"},null!=n?n:{}))}function AJ(e,t){return JL(["top","bottom"],t)?"column":JL(["left","right"],t)||"row"===e?"row":"column"}function _J(e,t,n,i){const r="row"===i?n.headerRow:"column"===i?n.headerColumn:n.headerFacet;return xP(((null==t?void 0:t.header)||{})[e],r[e],n.header[e])}function EJ(e,t,n,i){const r={};for(const s of e){const e=_J(s,t,n,i);void 0!==e&&(r[s]=e)}return r}const SJ=["row","column"],FJ=["header","footer"];function DJ(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:a,titleOrient:o}=EJ(["titleAnchor","titleAngle","titleOrient"],r,i,t),u=AJ(t,o),l=CP(a);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===t?{orient:"left"}:{}),{style:"guide-title"}),OJ(l,u)),$J(u,l,s)),zJ(i,r,t,hJ,cJ))}}function $J(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=xJ(t,"row"===e?"left":"top","row"===e?"y":"x");return i?{align:i}:{}}function OJ(e,t){const n=bJ(e,"row"===t?"left":"top","row"===t?"y":"x",!0);return n?{baseline:n}:{}}function NJ(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of FJ)if(n[r])for(const s of n[r]){const a=RJ(e,t,r,n,s);null!=a&&i.push(a)}return i}function IJ(e,t){var n;const{sort:i}=e;return xq(i)?{field:Vq(i,{expr:"datum"}),order:null!==(n=i.order)&&void 0!==n?n:"ascending"}:vL(i)?{field:kJ(e,t,{expr:"datum"}),order:"ascending"}:{field:Vq(e,{expr:"datum"}),order:null!=i?i:"ascending"}}function TJ(e,t,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:a,labelOrient:o,labelExpr:u}=EJ(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),l=oq({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,c=AJ(t,o);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?yP(yP(u,"datum.label",l),"datum.value",Vq(e,{expr:"parent"})):l}},"row"===t?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),OJ(s,c)),$J(c,s,a)),zJ(n,e,t,fJ,dJ))}function RJ(e,t,n,i,r){if(r){let s=null;const{facetFieldDef:a}=i,o=e.config?e.config:void 0;if(a&&r.labels){const{labelOrient:e}=EJ(["labelOrient"],a,o,t);("row"===t&&!JL(["top","bottom"],e)||"column"===t&&!JL(["left","right"],e))&&(s=TJ(a,t,o))}const u=DQ(e)&&!Cq(e.facet),l=r.axes,c=(null==l?void 0:l.length)>0;if(s||c){const o="row"===t?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:IJ(a,t)}:{}),c&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),r.sizeSignal?{encode:{update:{[o]:r.sizeSignal}}}:{}),c?{axes:l}:{})}}return null}const MJ={column:{start:0,end:1},row:{start:1,end:0}};function BJ(e,t){return MJ[t][e]}function zJ(e,t,n,i,r){const s={};for(const a of i){if(!r[a])continue;const i=_J(a,t,e,n);void 0!==i&&(s[r[a]]=i)}return s}function LJ(e){return[...PJ(e,"width"),...PJ(e,"height"),...PJ(e,"childWidth"),...PJ(e,"childHeight")]}function PJ(e,t){const n="width"===t?"x":"y",i=e.component.layoutSize.get(t);if(!i||"merged"===i)return[];const r=e.getSizeSignalRef(t).signal;if("step"===i){const t=e.getScaleComponent(n);if(t){const i=t.get("type"),s=t.get("range");if(TV(i)&&YW(s)){const i=e.scaleName(n);return DQ(e.parent)&&"independent"===e.parent.component.resolve.scale[n]?[jJ(i,s)]:[jJ(i,s),{name:r,update:UJ(i,t,`domain('${i}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==i){const t=r.endsWith("width"),n=t?"containerSize()[0]":"containerSize()[1]",i=`isFinite(${n}) ? ${n} : ${mH(e.config.view,t?"width":"height")}`;return[{name:r,init:i,on:[{update:i,events:"window:resize"}]}]}return[{name:r,value:i}]}function jJ(e,t){return{name:e+"_step",value:t.step}}function UJ(e,t,n){const i=t.get("type"),r=t.get("padding"),s=xP(t.get("paddingOuter"),r);let a=t.get("paddingInner");return a="band"===i?void 0!==a?a:r:1,`bandspace(${n}, ${a}, ${s}) * ${e}_step`}function WJ(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function VJ(e,t){return aP(e).reduce(((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),MX(t,r,i,(e=>XW(e)?e:{value:e.value})))}),{})}function qJ(e,t){if(OQ(t)||DQ(t))return"shared";if($Q(t))return OU(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function GJ(e,t){const n=e.scale[t],i=OU(t)?"axis":"legend";return"independent"===n?("shared"===e[i][t]&&NW(function(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}(t)),"independent"):e[i][t]||"shared"}const HJ=Object.assign(Object.assign({},rH),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),XJ=aP(HJ);class YJ extends nX{}const KJ={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:s}){var a,o,u,l,c;if("symbol"!==s)return;const{markDef:d,encoding:h,config:f,mark:p}=n,m=d.filled&&"trail"!==p;let g=Object.assign(Object.assign({},function(e,t,n){for(const i of n){const n=vG(i,t.markDef,t.config);void 0!==n&&(e[i]=fG(n))}return e}({},n,KP)),WX(n,{filled:m}));const y=null!==(a=JJ(h.opacity))&&void 0!==a?a:d.opacity;if(g.fill)if("fill"===i||m&&i===_j)delete g.fill;else if(g.fill.field)r.get("symbolFillColor")?delete g.fill:(g.fill=fG(null!==(o=f.legend.symbolBaseFillColor)&&void 0!==o?o:"black"),g.fillOpacity=fG(null!=y?y:1));else if(vL(g.fill)){const e=null!==(c=null!==(l=ZJ(null!==(u=h.fill)&&void 0!==u?u:h.color))&&void 0!==l?l:d.fill)&&void 0!==c?c:m&&d.color;e&&(g.fill=fG(e))}if(g.stroke)if("stroke"===i||!m&&i===_j)delete g.stroke;else if(g.stroke.field)delete g.stroke;else if(vL(g.stroke)){const e=xP(ZJ(h.stroke||h.color),d.stroke,m?d.color:void 0);e&&(g.stroke={value:e})}if(i!==Oj){const e=Nq(t)&&eZ(0,r,t);e?g.opacity=[Object.assign({test:e},fG(null!=y?y:1)),fG(f.legend.unselectedOpacity)]:y&&(g.opacity=fG(y))}return g=Object.assign(Object.assign({},g),e),sP(g)?void 0:g},gradient:function(e,{model:t,legendType:n}){if("gradient"!==n)return;let i={};const r=JJ(t.encoding.opacity)||t.markDef.opacity;return r&&(i.opacity=fG(r)),i=Object.assign(Object.assign({},i),e),sP(i)?void 0:i},labels:function(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},a=n.config,o=Nq(t)?eZ(0,r,t):void 0,u=o?[{test:o,value:1},{value:a.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=s,d=sq(c)?lq({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:c,config:a}):void 0,h=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),d?{text:d}:{}),e);return sP(h)?void 0:h},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function JJ(e){return QJ(e,((e,t)=>Math.max(e,t.value)))}function ZJ(e){return QJ(e,((e,t)=>xP(e,t.value)))}function QJ(e,t){return function(e){const t=e&&e.condition;return!!t&&(vL(t)||Lq(t))}(e)?AL(e.condition).reduce(t,e.value):Lq(e)?e.value:void 0}function eZ(e,t,n){const i=t.get("selections");if(!(null==i?void 0:i.length))return;const r=$L(n.field);return i.map((e=>`(!length(data(${$L(cP(e)+UY)})) || (${e}[${r}] && indexof(${e}[${r}], datum.value) >= 0))`)).join(" || ")}const tZ={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return cq(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return dq(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return null!==(n=null!==(t=i.gradientLength)&&void 0!==t?t:r.gradientLength)&&void 0!==n?n:function({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:a,gradientVerticalMaxLength:o,gradientVerticalMinLength:u}=e;if(MV(r))return"horizontal"===n?"top"===i||"bottom"===i?iZ(t,"width",a,s):a:iZ(t,"height",u,o)}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return null!==(r=null!==(i=e.labelOverlap)&&void 0!==i?i:t.labelOverlap)&&void 0!==r?r:function(e){if(JL(["quantile","threshold","log"],e))return"greedy"}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return null!==(r=e.symbolType)&&void 0!==r?r:function(e,t,n,i){var r;if("shape"!==t){const e=null!==(r=ZJ(n))&&void 0!==r?r:i;if(e)return e}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>Kq(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Yj(n)&&MV(t)){if("gradient"===e)return}else if("symbol"===e)return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(e,t){const n=e.values;return vL(n)?lG(t,n):XW(n)?n:void 0}(t,e)};function nZ({legendConfig:e,legendType:t,orient:n,legend:i}){var r,s;return null!==(s=null!==(r=i.direction)&&void 0!==r?r:e[t?"gradientDirection":"symbolDirection"])&&void 0!==s?s:function(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}(n,t)}function iZ(e,t,n,i){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${i})`}}function rZ(e){const t=FQ(e)?function(e){const{encoding:t}=e,n={};for(const i of[_j,...nH]){const r=tG(t[i]);r&&e.getScaleComponent(i)&&(i===Fj&&Nq(r)&&r.type===yV||(n[i]=aZ(e,i)))}return n}(e):function(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){rZ(i);for(const r of aP(i.component.legends))n.legend[r]=GJ(e.component.resolve,r),"shared"===n.legend[r]&&(t[r]=oZ(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of aP(t))for(const t of e.children)t.component.legends[i]&&"shared"===n.legend[i]&&delete t.component.legends[i];return t}(e);return e.component.legends=t,t}function sZ(e,t,n,i){switch(t){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===t&&e===(null==i?void 0:i.title))return!0}return e===(n||{})[t]}function aZ(e,t){var n,i,r;let s=e.legend(t);const{markDef:a,encoding:o,config:u}=e,l=u.legend,c=new YJ({},function(e,t){const n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}(e,t));!function(e,t,n){var i;const r=null===(i=e.fieldDef(t))||void 0===i?void 0:i.field;GY(e,(e=>{var i,s;const a=null!==(i=e.project.hasField[r])&&void 0!==i?i:e.project.hasChannel[t];if(a&&CY.has(e)){const t=null!==(s=n.get("selections"))&&void 0!==s?s:[];t.push(e.name),n.set("selections",t,!1),a.hasLegend=!0}}))}(e,t,c);const d=void 0!==s?!s:l.disable;if(c.set("disable",d,void 0!==s),d)return c;s=s||{};const h=e.getScaleComponent(t).get("type"),f=tG(o[t]),p=Nq(f)?null===(n=HW(f.timeUnit))||void 0===n?void 0:n.unit:void 0,m=s.orient||u.legend.orient||"right",g=function(e){const{legend:t}=e;return xP(t.type,function({channel:e,timeUnit:t,scaleType:n}){if(Yj(e)){if(JL(["quarter","month","day"],t))return"symbol";if(MV(n))return"gradient"}return"symbol"}(e))}({legend:s,channel:t,timeUnit:p,scaleType:h}),y={legend:s,channel:t,model:e,markDef:a,encoding:o,fieldOrDatumDef:f,legendConfig:l,config:u,scaleType:h,orient:m,legendType:g,direction:nZ({legend:s,legendType:g,orient:m,legendConfig:l})};for(const n of XJ){const i=n in tZ?tZ[n](y):s[n];if(void 0!==i){const r=sZ(i,n,s,e.fieldDef(t));(r||void 0===u.legend[n])&&c.set(n,i,r)}}const v=null!==(i=null==s?void 0:s.encoding)&&void 0!==i?i:{},b=c.get("selections"),x={},w={fieldOrDatumDef:f,model:e,channel:t,legendCmpt:c,legendType:g};for(const t of["labels","legend","title","symbols","gradient","entries"]){const n=VJ(null!==(r=v[t])&&void 0!==r?r:{},e),i=t in KJ?KJ[t](n,w):n;void 0===i||sP(i)||(x[t]=Object.assign(Object.assign(Object.assign({},(null==b?void 0:b.length)&&Nq(f)?{name:`${cP(f.field)}_legend_${t}`}:{}),(null==b?void 0:b.length)?{interactive:!!b}:{}),{update:i}))}return sP(x)||c.set("encode",x,!!(null==s?void 0:s.encoding)),c}function oZ(e,t){var n,i,r,s;if(!e)return t.clone();const a=e.getWithExplicit("orient"),o=t.getWithExplicit("orient");if(a.explicit&&o.explicit&&a.value!==o.value)return;let u=!1;for(const n of XJ){const i=oX(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",((e,t)=>{switch(n){case"symbolType":return i=e,"circle"===(r=t).value?r:i;case"title":return AG(e,t);case"type":return u=!0,rX("symbol")}var i,r;return aX(e,t,n,"legend")}));e.setWithExplicit(n,i)}return u&&((null===(i=null===(n=e.implicit)||void 0===n?void 0:n.encode)||void 0===i?void 0:i.gradient)&&hP(e.implicit,["encode","gradient"]),(null===(s=null===(r=e.explicit)||void 0===r?void 0:r.encode)||void 0===s?void 0:s.gradient)&&hP(e.explicit,["encode","gradient"])),e}function uZ(e,t,n,i){var r,s,a;e.encode=null!==(r=e.encode)&&void 0!==r?r:{},e.encode[t]=null!==(s=e.encode[t])&&void 0!==s?s:{},e.encode[t].update=null!==(a=e.encode[t].update)&&void 0!==a?a:{},e.encode[t].update[n]=i}function lZ(e){const t=e.component.legends,n={};for(const i of aP(t)){const r=e.getScaleComponent(i),s=XL(r.get("domains"));if(n[s])for(const e of n[s])oZ(e,t[i])||n[s].push(t[i]);else n[s]=[t[i].clone()]}return oP(n).flat().map((t=>function(e,t){var n,i,r;const s=e.combine(),{disable:a,labelExpr:o,selections:u}=s,l=NL(s,["disable","labelExpr","selections"]);if(!a){if(!1===t.aria&&null==l.aria&&(l.aria=!1),null===(n=l.encode)||void 0===n?void 0:n.symbols){const e=l.encode.symbols.update;!e.fill||"transparent"===e.fill.value||e.stroke||l.stroke||(e.stroke={value:"transparent"});for(const t of nH)l[t]&&delete e[t]}if(l.title||delete l.title,void 0!==o){let e=o;(null===(r=null===(i=l.encode)||void 0===i?void 0:i.labels)||void 0===r?void 0:r.update)&&XW(l.encode.labels.update.text)&&(e=yP(o,"datum.label",l.encode.labels.update.text.signal)),uZ(l,"labels","text",{signal:e})}for(const e in l){const t=l[e];if(XW(t)){const n=iH[e];if(n){const{vgProp:i,part:r}=n;uZ(l,r,i,t),delete l[e]}}}return l}}(t,e.config))).filter((e=>void 0!==e))}function cZ(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map((e=>e.signal)).join(", ")}]`},s=t.data.reduce(((t,n)=>{const i=XW(n)?n.signal:`data('${e.lookupDataSource(n)}')`;return JL(t,i)||t.push(i),t}),[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const dZ=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class hZ extends nX{constructor(e,t,n,i){super(Object.assign({},t),{name:e}),this.specifiedProjection=t,this.size=n,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function fZ(e){e.component.projection=FQ(e)?function(e){var t;if(e.hasProjection){const n=e.specifiedProjection,i=!(n&&(null!=n.scale||null!=n.translate)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=i?function(e){const t=[],{encoding:n}=e;for(const i of[[Cj,wj],[Aj,kj]])(tG(n[i[0]])||tG(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(Fj)&&e.typedFieldDef(Fj).type===yV&&t.push({signal:e.getName(`geojson_${t.length}`)}),0===t.length&&t.push(e.requestDataName(gX)),t}(e):void 0;return new hZ(e.projectionName(!0),Object.assign(Object.assign({},null!==(t=e.config.projection)&&void 0!==t?t:{}),null!=n?n:{}),r,s)}}(e):function(e){if(0===e.children.length)return;let t;for(const t of e.children)fZ(t);const n=QL(e.children,(e=>{const n=e.component.projection;if(n){if(t){const e=function(e,t){const n=QL(dZ,(n=>!EL(e.explicit,n)&&!EL(t.explicit,n)||!(!EL(e.explicit,n)||!EL(t.explicit,n)||XL(e.get(n))!==XL(t.get(n)))));if(XL(e.size)===XL(t.size)){if(n)return e;if(XL(e.explicit)===XL({}))return t;if(XL(t.explicit)===XL({}))return e}return null}(t,n);return e&&(t=e),!!e}return t=n,!0}return!0}));if(t&&n){const n=e.projectionName(!0),i=new hZ(n,t.specifiedProjection,t.size,qL(t.data));for(const t of e.children){const e=t.component.projection;e&&(e.isFit&&i.data.push(...t.component.projection.data),t.renameProjection(e.get("name"),n),e.merged=!0)}return i}}(e)}function pZ(e,t){return`${ZU(e)}_${t}`}function mZ(e,t,n){var i;const r=pZ(null!==(i=sG(n,void 0))&&void 0!==i?i:{},t);return e.getName(`${r}_bins`)}function gZ(e,t,n){let i,r;i=function(e){return"as"in e}(e)?DL(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:[Vq(e,{forAs:!0}),Vq(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},sG(t,void 0)),a=pZ(s,e.field),{signal:o,extentSignal:u}=function(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}(n,a);if(nW(s.extent)){const e=s.extent,t=e.selection;r=sJ(n.getSelectionComponent(cP(t),t),e),delete s.extent}return{key:a,binComponent:Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[i]},o?{signal:o}:{}),u?{extentSignal:u}:{}),r?{span:r}:{})}}class yZ extends cY{constructor(e,t){super(e),this.bins=t}clone(){return new yZ(null,qL(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,i)=>{if(zq(n)&&QU(n.bin)){const{key:r,binComponent:s}=gZ(n,n.bin,t);e[r]=Object.assign(Object.assign(Object.assign({},s),e[r]),function(e,t,n,i){var r,s;if(cG(t,n)){const a=FQ(e)&&null!==(s=null!==(r=e.axis(n))&&void 0!==r?r:e.legend(n))&&void 0!==s?s:{},o=Vq(t,{expr:"datum"}),u=Vq(t,{expr:"datum",binSuffix:"end"});return{formulaAs:Vq(t,{binSuffix:"range",forAs:!0}),formula:mq(o,u,a.format,a.formatType,i)}}return{}}(t,n,i,t.config))}return e}),{});return sP(n)?null:new yZ(e,n)}static makeFromTransform(e,t,n){const{key:i,binComponent:r}=gZ(t,t.bin,n);return new yZ(e,{[i]:r})}merge(e,t){for(const n of aP(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=tP([...this.bins[n].as,...e.bins[n].as],YL)):this.bins[n]=e.bins[n];for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(oP(this.bins).map((e=>e.as)).flat(2))}dependentFields(){return new Set(oP(this.bins).map((e=>e.field)))}hash(){return`Bin ${YL(this.bins)}`}assemble(){return oP(this.bins).flatMap((e=>{const t=[],[n,...i]=e.as,r=e.bin,{extent:s}=r,a=NL(r,["extent"]),o=Object.assign(Object.assign(Object.assign({type:"bin",field:gP(e.field),as:n,signal:e.signal},nW(s)?{extent:null}:{extent:s}),e.span?{span:{signal:`span(${e.span})`}}:{}),a);!s&&e.extentSignal&&(t.push({type:"extent",field:gP(e.field),signal:e.extentSignal}),o.extent={signal:e.extentSignal}),t.push(o);for(const e of i)for(let i=0;i<2;i++)t.push({type:"formula",expr:Vq({field:n[i]},{expr:"datum"}),as:e[i]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))}}class vZ extends cY{constructor(e){let t;if(super(null),hX(e=null!=e?e:{name:"source"})||(t=e.format?Object.assign({},HL(e.format,["parse"])):{}),cX(e))this._data={values:e.values};else if(lX(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];JL(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else pX(e)?this._data={values:[{type:"Sphere"}]}:(dX(e)||hX(e))&&(this._data={});this._generator=hX(e),e.name&&(this._name=e.name),t&&!sP(t)&&(this._data.format=t)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function bZ(e){for(const t of e){for(const e of t.children)if(e.parent!==t)return console.error("Dataflow graph is inconsistent.",t,e),!1;if(!bZ(t.children))return!1}return!0}class xZ extends cY{constructor(e,t){super(e),this.params=t}clone(){return new xZ(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${YL(this.params)}`}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class wZ extends cY{constructor(e,t){super(e),this.params=t}clone(){return new wZ(null,this.params)}dependentFields(){return new Set}producedFields(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}hash(){return`Hash ${YL(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function CZ(e){return e instanceof vZ||e instanceof xZ||e instanceof wZ}class kZ{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class AZ extends kZ{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:e,mutatedFlag:t}){e&&this.setContinue(),t&&this.setMutated()}reset(){}optimizeNextFromLeaves(e){if(CZ(e))return!1;const t=e.parent,{continueFlag:n}=this.run(e);return n&&this.optimizeNextFromLeaves(t),this.mutatedFlag}}class _Z extends kZ{}class EZ extends cY{constructor(e,t,n){super(e),this.dimensions=t,this.measures=n}clone(){return new EZ(null,new Set(this.dimensions),qL(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef((e=>{e.aggregate&&(n=!0)}));const i={},r=new Set;return n?(t.forEachFieldDef(((e,n)=>{var s,a,o,u;const{aggregate:l,field:c}=e;if(l)if("count"===l)i["*"]=null!==(s=i["*"])&&void 0!==s?s:{},i["*"].count=new Set([Vq(e,{forAs:!0})]);else{if(ij(l)||rj(l)){const e=ij(l)?"argmin":"argmax",t=l[e];i[t]=null!==(a=i[t])&&void 0!==a?a:{},i[t][e]=new Set([Vq({op:e,field:t},{forAs:!0})])}else i[c]=null!==(o=i[c])&&void 0!==o?o:{},i[c][l]=new Set([Vq(e,{forAs:!0})]);HU(n)&&"unaggregated"===t.scaleDomain(n)&&(i[c]=null!==(u=i[c])&&void 0!==u?u:{},i[c].min=new Set([Vq({field:c,aggregate:"min"},{forAs:!0})]),i[c].max=new Set([Vq({field:c,aggregate:"max"},{forAs:!0})]))}else!function(e,t,n,i){const r=FQ(i)?i.encoding[fU(t)]:void 0;if(zq(n)&&FQ(i)&&Fq(t,n,r,i.stack,i.markDef,i.config))e.add(Vq(n,{})),e.add(Vq(n,{suffix:"end"})),n.bin&&cG(n,t)&&e.add(Vq(n,{binSuffix:"range"}));else if(t in Gj){const n=function(e){switch(e){case wj:return"y";case kj:return"y2";case Cj:return"x";case Aj:return"x2"}}(t);e.add(i.getName(n))}else e.add(Vq(n))}(r,n,e,t)})),r.size+aP(i).length===0?null:new EZ(e,r,i)):null}static makeFromTransform(e,t){var n,i,r;const s=new Set,a={};for(const e of t.aggregate){const{op:t,field:r,as:s}=e;t&&("count"===t?(a["*"]=null!==(n=a["*"])&&void 0!==n?n:{},a["*"].count=new Set([s||Vq(e,{forAs:!0})])):(a[r]=null!==(i=a[r])&&void 0!==i?i:{},a[r][t]=new Set([s||Vq(e,{forAs:!0})])))}for(const e of null!==(r=t.groupby)&&void 0!==r?r:[])s.add(e);return s.size+aP(a).length===0?null:new EZ(e,s,a)}merge(e){return function(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}(this.dimensions,e.dimensions)?(function(e,t){var n;for(const i of aP(t)){const r=t[i];for(const t of aP(r))i in e?e[i][t]=new Set([...null!==(n=e[i][t])&&void 0!==n?n:[],...r[t]]):e[i]={[t]:r[t]}}}(this.measures,e.measures),!0):(function(...e){OW.debug(...e)}("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...aP(this.measures)])}producedFields(){const e=new Set;for(const t of aP(this.measures))for(const n of aP(this.measures[t])){const i=this.measures[t][n];0===i.size?e.add(`${n}_${t}`):i.forEach(e.add,e)}return e}hash(){return`Aggregate ${YL({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],t=[],n=[];for(const i of aP(this.measures))for(const r of aP(this.measures[i]))for(const s of this.measures[i][r])n.push(s),e.push(r),t.push("*"===i?null:gP(i));return{type:"aggregate",groupby:[...this.dimensions].map(gP),ops:e,fields:t,as:n}}}class SZ extends cY{constructor(e,t,n,i){super(e),this.model=t,this.name=n,this.data=i;for(const e of Jj){const n=t.facet[e];if(n){const{bin:i,sort:r}=n;this[e]=Object.assign({name:t.getName(`${e}_domain`),fields:[Vq(n),...QU(i)?[Vq(n,{binSuffix:"end"})]:[]]},xq(r)?{sortField:r}:vL(r)?{sortIndexField:kJ(n,e)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of Jj)this[t]&&(e+=` ${t.charAt(0)}:${YL(this[t])}`);return e}get fields(){var e;const t=[];for(const n of Jj)(null===(e=this[n])||void 0===e?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of Jj)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of $U){const n=this.childModel.component.scales[t];if(n&&!n.merged){const i=n.get("type"),r=n.get("range");if(TV(i)&&YW(r)){const n=uQ(lQ(this.childModel,t));n?e[t]=n:NW(`Unknown field for ${t}. Cannot calculate view size.`)}}}return e}assembleRowColumnHeaderData(e,t,n){const i={row:"y",column:"x"}[e],r=[],s=[],a=[];n&&n[i]&&(t?(r.push(`distinct_${n[i]}`),s.push("max")):(r.push(n[i]),s.push("distinct")),a.push(`distinct_${n[i]}`));const{sortField:o,sortIndexField:u}=this[e];if(o){const{op:e=gq,field:t}=o;r.push(t),s.push(e),a.push(Vq(o,{forAs:!0}))}else u&&(r.push(u),s.push("max"),a.push(u));return{name:this[e].name,source:null!=t?t:this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},r.length?{fields:r,ops:s,as:a}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:i}=this.model.layout,{layoutHeaders:r}=this.model.component,s=[],a={};for(const e of SJ){for(const i of FJ){const s=null!==(t=r[e]&&r[e][i])&&void 0!==t?t:[];for(const t of s)if((null===(n=t.axes)||void 0===n?void 0:n.length)>0){a[e]=!0;break}}if(a[e]){const t=`length(data("${this.facet.name}"))`,n="row"===e?i?{signal:`ceil(${t} / ${i})`}:1:i?{signal:`min(${t}, ${i})`}:{signal:t};s.push({name:`${this.facet.name}_${e}`,transform:[{type:"sequence",start:0,stop:n}]})}}const{row:o,column:u}=a;return(o||u)&&s.unshift(this.assembleRowColumnHeaderData("facet",null,e)),s}assemble(){var e,t;const n=[];let i=null;const r=this.getChildIndependentFieldsWithStep(),{column:s,row:a,facet:o}=this;if(s&&a&&(r.x||r.y)){i=`cross_${this.column.name}_${this.row.name}`;const s=[].concat(null!==(e=r.x)&&void 0!==e?e:[],null!==(t=r.y)&&void 0!==t?t:[]),a=s.map((()=>"distinct"));n.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:s,ops:a}]})}for(const e of[dj,cj])this[e]&&n.push(this.assembleRowColumnHeaderData(e,i,r));if(o){const e=this.assembleFacetHeaderData(r);e&&n.push(...e)}return n}}function FZ(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function DZ(e){const t={};return UL(e.filter,(e=>{var n;if(oV(e)){let i=null;eV(e)?i=e.equal:sV(e)?i=e.range[0]:aV(e)&&(i=(null!==(n=e.oneOf)&&void 0!==n?n:e.in)[0]),i&&(IW(i)?t[e.field]="date":FL(i)?t[e.field]="number":DL(i)&&(t[e.field]="string")),e.timeUnit&&(t[e.field]="date")}})),t}class $Z extends cY{constructor(e,t){super(e),this._parse=t}clone(){return new $Z(null,qL(this._parse))}hash(){return`Parse ${YL(this._parse)}`}static makeExplicit(e,t,n){let i={};const r=t.data;return!hX(r)&&r&&r.format&&r.format.parse&&(i=r.format.parse),this.makeWithAncestors(e,i,{},n)}static makeWithAncestors(e,t,n,i){for(const e of aP(n)){const t=i.getWithExplicit(e);void 0!==t.value&&(t.explicit||t.value===n[e]||"derived"===t.value||"flatten"===n[e]?delete n[e]:NW(hW(e,n[e],t.value)))}for(const e of aP(t)){const n=i.get(e);void 0!==n&&(n===t[e]?delete t[e]:NW(hW(e,t[e],n)))}const r=new nX(t,n);i.copyAll(r);const s={};for(const e of aP(r.combine())){const t=r.get(e);null!==t&&(s[e]=t)}return 0===aP(s).length||i.parseNothing?null:new $Z(e,s)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of aP(this._parse)){const n=this._parse[t];1===bP(t)&&(e[t]=n)}return e}producedFields(){return new Set(aP(this._parse))}dependentFields(){return new Set(aP(this._parse))}assembleTransforms(e=!1){return aP(this._parse).filter((t=>!e||bP(t)>1)).map((e=>{const t=function(e,t){const n=pP(e);return"number"===t?`toNumber(${n})`:"boolean"===t?`toBoolean(${n})`:"string"===t?`toString(${n})`:"date"===t?`toDate(${n})`:"flatten"===t?n:0===t.indexOf("date:")?`timeParse(${n},'${FZ(t.slice(5,t.length))}')`:0===t.indexOf("utc:")?`utcParse(${n},'${FZ(t.slice(4,t.length))}')`:(NW(`Unrecognized parse "${t}".`),null)}(e,this._parse[e]);return t?{type:"formula",expr:t,as:vP(e)}:null})).filter((e=>null!==e))}}class OZ extends cY{clone(){return new OZ(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([sH])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:sH}}}class NZ extends cY{constructor(e,t){super(e),this.transform=t}clone(){return new NZ(null,qL(this.transform))}addDimensions(e){this.transform.groupby=tP(this.transform.groupby.concat(e),(e=>e))}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map((e=>e.field)).filter((e=>void 0!==e)).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:Vq(e)}hash(){return`JoinAggregateTransform ${YL(this.transform)}`}assemble(){const e=[],t=[],n=[];for(const i of this.transform.joinaggregate)t.push(i.op),n.push(this.getDefaultName(i)),e.push(void 0===i.field?null:i.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},void 0!==i?{groupby:i}:{})}}class IZ extends cY{constructor(e,t){super(e),this._stack=t}clone(){return new IZ(null,qL(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:i,as:r,offset:s="zero"}=t,a=[],o=[];if(void 0!==t.sort)for(const e of t.sort)a.push(e.field),o.push(xP(e.order,"ascending"));const u={field:a,order:o};let l;return l=function(e){return vL(e)&&e.every((e=>DL(e)))&&e.length>1}(r)?r:DL(r)?[r,r+"_end"]:[t.stack+"_start",t.stack+"_end"],new IZ(e,{stackField:n,groupby:i,offset:s,sort:u,facetby:[],as:l})}static makeFromEncoding(e,t){const n=t.stack,{encoding:i}=t;if(!n)return null;const{groupbyChannel:r,fieldChannel:s,offset:a,impute:o}=n;let u;r&&(u=eG(i[r]));const l=function(e){return e.stack.stackBy.reduce(((e,t)=>{const n=Vq(t.fieldDef);return n&&e.push(n),e}),[])}(t),c=t.encoding.order;let d;return d=vL(c)||Nq(c)?wG(c):l.reduce(((e,t)=>(e.field.push(t),e.order.push("y"===s?"descending":"ascending"),e)),{field:[],order:[]}),new IZ(e,{dimensionFieldDef:u,stackField:t.vgField(s),facetby:[],stackby:l,sort:d,offset:a,impute:o,as:[t.vgField(s,{suffix:"start",forAs:!0}),t.vgField(s,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${YL(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[Vq(e,{binSuffix:"mid"})]:[Vq(e,{}),Vq(e,{binSuffix:"end"})]:[Vq(e)]:null!=n?n:[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:i,stackby:r,sort:s,offset:a,impute:o,as:u}=this._stack;if(o&&n){const{band:s=.5,bin:a}=n;a&&e.push({type:"formula",expr:`${s}*`+Vq(n,{expr:"datum"})+`+${1-s}*`+Vq(n,{expr:"datum",binSuffix:"end"}),as:Vq(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:i,groupby:[...r,...t],key:Vq(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:i,sort:s,as:u,offset:a}),e}}class TZ extends cY{constructor(e,t){super(e),this.transform=t}clone(){return new TZ(null,qL(this.transform))}addDimensions(e){this.transform.groupby=tP(this.transform.groupby.concat(e),(e=>e))}dependentFields(){var e,t;const n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(n.add,n),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach((e=>n.add(e.field))),this.transform.window.map((e=>e.field)).filter((e=>void 0!==e)).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:Vq(e)}hash(){return`WindowTransform ${YL(this.transform)}`}assemble(){var e;const t=[],n=[],i=[],r=[];for(const e of this.transform.window)n.push(e.op),i.push(this.getDefaultName(e)),r.push(void 0===e.param?null:e.param),t.push(void 0===e.field?null:e.field);const s=this.transform.frame,a=this.transform.groupby;if(s&&null===s[0]&&null===s[1]&&n.every((e=>sj(e))))return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},void 0!==a?{groupby:a}:{});const o=[],u=[];if(void 0!==this.transform.sort)for(const t of this.transform.sort)o.push(t.field),u.push(null!==(e=t.order)&&void 0!==e?e:"ascending");const l={field:o,order:u},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:r,as:i,ops:n,fields:t,sort:l},void 0!==c?{ignorePeers:c}:{}),void 0!==a?{groupby:a}:{}),void 0!==s?{frame:s}:{})}}class RZ extends AZ{run(e){const t=e.parent;if(e instanceof $Z){if(CZ(t))return this.flags;if(t.numChildren()>1)return this.setContinue(),this.flags;if(t instanceof $Z)this.setMutated(),t.merge(e);else{if(rP(t.producedFields(),e.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),e.swapWithParent()}}return this.setContinue(),this.flags}}class MZ extends _Z{mergeNodes(e,t){const n=t.shift();for(const i of t)e.removeChild(i),i.parent=n,i.remove()}run(e){const t=e.children.map((e=>e.hash())),n={};for(let i=0;i<t.length;i++)void 0===n[t[i]]?n[t[i]]=[e.children[i]]:n[t[i]].push(e.children[i]);for(const t of aP(n))n[t].length>1&&(this.setMutated(),this.mergeNodes(e,n[t]));for(const t of e.children)this.run(t);return this.mutatedFlag}}class BZ extends AZ{run(e){return e instanceof dY||e.numChildren()>0||e instanceof SZ||(this.setMutated(),e.remove()),this.flags}}class zZ extends AZ{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(e){if(this.setContinue(),e instanceof hY){const t=e.producedFields();nP(t,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...t]),this.prev=e}return this.flags}reset(){this.fields.clear()}}class LZ extends AZ{run(e){this.setContinue();const t=e.parent.children.filter((e=>e instanceof hY)),n=t.pop();for(const e of t)this.setMutated(),n.merge(e);return this.flags}}function PZ(e){if(e instanceof SZ)if(1!==e.numChildren()||e.children[0]instanceof dY){const n=e.model.component.data.main;jZ(n);const i=(t=e,function e(n){if(!(n instanceof SZ)){const i=n.clone();if(i instanceof dY){const e=XZ+i.getSource();i.setSource(e),t.model.component.data.outputNodes[e]=i}else(i instanceof EZ||i instanceof IZ||i instanceof TZ||i instanceof NZ)&&i.addDimensions(t.fields);for(const t of n.children.flatMap(e))t.parent=i;return[i]}return n.children.flatMap(e)}),r=e.children.map(i).flat();for(const e of r)e.parent=n}else{const t=e.children[0];(t instanceof EZ||t instanceof IZ||t instanceof TZ||t instanceof NZ)&&t.addDimensions(e.fields),t.swapWithParent(),PZ(e)}else e.children.map(PZ);var t}function jZ(e){if(e instanceof dY&&e.type===gX&&1===e.numChildren()){const t=e.children[0];t instanceof SZ||(t.swapWithParent(),jZ(e))}}class UZ extends _Z{constructor(){super()}run(e){e instanceof dY&&!e.isRequired()&&(this.setMutated(),e.remove());for(const t of e.children)this.run(t);return this.mutatedFlag}}class WZ extends _Z{constructor(e){super(),this.requiresSelectionId=e&&XY(e)}run(e){e instanceof OZ&&(this.requiresSelectionId&&(CZ(e.parent)||e.parent instanceof EZ||e.parent instanceof $Z)||(this.setMutated(),e.remove()));for(const t of e.children)this.run(t);return this.mutatedFlag}}class VZ extends AZ{run(e){const t=e.parent,n=[...t.children],i=t.children.filter((e=>e instanceof $Z));if(t.numChildren()>1&&i.length>=1){const e={},r=new Set;for(const t of i){const n=t.parse;for(const t of aP(n))t in e?e[t]!==n[t]&&r.add(t):e[t]=n[t]}for(const t of r)delete e[t];if(!sP(e)){this.setMutated();const i=new $Z(t,e);for(const r of n){if(r instanceof $Z)for(const t of aP(e))delete r.parse[t];t.removeChild(r),r.parent=i,r instanceof $Z&&0===aP(r.parse).length&&r.remove()}}}return this.setContinue(),this.flags}}class qZ extends AZ{run(e){const t=e.parent,n=t.children.filter((e=>e instanceof EZ)),i={};for(const e of n){const t=YL(e.groupBy);t in i||(i[t]=[]),i[t].push(e)}for(const e of aP(i)){const n=i[e];if(n.length>1){const e=n.pop();for(const i of n)e.merge(i)&&(t.removeChild(i),i.parent=e,i.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class GZ extends AZ{constructor(e){super(),this.model=e}run(e){const t=e.parent,n=!(CZ(t)||t instanceof iJ||t instanceof $Z||t instanceof OZ),i=[],r=[];for(const e of t.children)e instanceof yZ&&(n&&!rP(t.producedFields(),e.dependentFields())?i.push(e):r.push(e));if(i.length>0){const e=i.pop();for(const t of i)e.merge(t,this.model.renameSignal.bind(this.model));this.setMutated(),t instanceof yZ?t.merge(e,this.model.renameSignal.bind(this.model)):e.swapWithParent()}if(r.length>1){const e=r.pop();for(const t of r)e.merge(t,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class HZ extends AZ{run(e){const t=e.parent,n=[...t.children];if(!ZL(n,(e=>e instanceof dY))||t.numChildren()<=1)return this.setContinue(),this.flags;const i=[];let r;for(const e of n)if(e instanceof dY){let n=e;for(;1===n.numChildren();){const e=n.children[0];if(!(e instanceof dY))break;n=e}i.push(...n.children),r?(t.removeChild(e),e.parent=r.parent,r.parent.removeChild(r),r.parent=n,this.setMutated()):r=n}else i.push(e);if(i.length){this.setMutated();for(const e of i)e.parent.removeChild(e),e.parent=r}return this.setContinue(),this.flags}}const XZ="scale_";function YZ(e){const t=[];function n(e){if(0===e.numChildren())t.push(e);else for(const t of e.children)n(t)}for(const t of e)n(t);return t}function KZ(e){return e}function JZ(e,t){return t.map((t=>{if(e instanceof AZ){const n=e.optimizeNextFromLeaves(t);return e.reset(),n}return e.run(t)})).some(KZ)}function ZZ(e,t){let n=e.sources;const i=new Set;return i.add(JZ(new UZ,n)),i.add(JZ(new WZ(t),n)),n=n.filter((e=>e.numChildren()>0)),i.add(JZ(new BZ,YZ(n))),n=n.filter((e=>e.numChildren()>0)),i.add(JZ(new RZ,YZ(n))),i.add(JZ(new GZ(t),YZ(n))),i.add(JZ(new zZ,YZ(n))),i.add(JZ(new VZ,YZ(n))),i.add(JZ(new qZ,YZ(n))),i.add(JZ(new LZ,YZ(n))),i.add(JZ(new MZ,n)),i.add(JZ(new HZ,YZ(n))),e.sources=n,i.has(!0)}class QZ{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new QZ((()=>e(t)))}}function eQ(e){FQ(e)?function(e){const t=e.component.scales;for(const n of aP(t)){const i=tQ(e,n);if(t[n].setWithExplicit("domains",i),sQ(e,n),e.component.data.isFaceted){let t=e;for(;!DQ(t)&&t.parent;)t=t.parent;if("shared"===t.component.resolve.scale[n])for(const e of i.value)KW(e)&&(e.data=XZ+e.data.replace(XZ,""))}}}(e):function(e){for(const t of e.children)eQ(t);const t=e.component.scales;for(const n of aP(t)){let i,r=null;for(const t of e.children){const e=t.component.scales[n];if(e){i=void 0===i?e.getWithExplicit("domains"):oX(i,e.getWithExplicit("domains"),"domains","scale",oQ);const t=e.get("selectionExtent");r&&t&&r.selection!==t.selection&&NW("The same selection must be used to override scale domains in a layered view."),r=t}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}(e)}function tQ(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=function(e,t,n,i){if("unaggregated"===e){const{valid:e,reason:i}=aQ(t,n);if(!e)return void NW(i)}else if(void 0===e&&i.useUnaggregatedDomain){const{valid:e}=aQ(t,n);if(e)return"unaggregated"}return e}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),"x"===t&&tG(i.x2)?tG(i.x)?oX(iQ(n,r,e,"x"),iQ(n,r,e,"x2"),"domain","scale",oQ):iQ(n,r,e,"x2"):"y"===t&&tG(i.y2)?tG(i.y)?oX(iQ(n,r,e,"y"),iQ(n,r,e,"y2"),"domain","scale",oQ):iQ(n,r,e,"y2"):iQ(n,r,e,t)}function nQ(e,t,n){var i;const r=null===(i=HW(n))||void 0===i?void 0:i.unit;return"temporal"===t||r?function(e,t,n){return e.map((e=>({signal:`{data: ${uG(e,{timeUnit:n,type:t})}}`})))}(e,t,r):[e]}function iQ(e,t,n,i){const{encoding:r}=n,s=tG(r[i]),{type:a}=s,o=s.timeUnit;if(function(e){return e&&e.unionWith}(t)){const r=iQ(e,void 0,n,i),s=nQ(t.unionWith,a,o);return iX([...r.value,...s])}if(XW(t))return iX([t]);if(t&&"unaggregated"!==t&&!zV(t))return iX(nQ(t,a,o));const u=n.stack;if(u&&i===u.fieldChannel){if("normalize"===u.offset)return rX([[0,1]]);const e=n.requestDataName(gX);return rX([{data:e,field:n.vgField(i,{suffix:"start"})},{data:e,field:n.vgField(i,{suffix:"end"})}])}const l=HU(i)&&Nq(s)?function(e,t,n){if(!TV(n))return;const i=e.fieldDef(t),r=i.sort;if(wq(r))return{op:"min",field:kJ(i,t),order:"ascending"};const{stack:s}=e,a=s?[...s.groupbyField?[s.groupbyField]:[],...s.stackBy.map((e=>e.fieldDef.field))]:void 0;if(xq(r))return rQ(r,s&&!JL(a,r.field));if(bq(r)){const{encoding:t,order:n}=r,i=e.fieldDef(t),{aggregate:o,field:u}=i,l=s&&!JL(a,u);if(ij(o)||rj(o))return rQ({field:Vq(i),order:n},l);if(sj(o)||!o)return rQ({op:o,field:u,order:n},l)}else{if("descending"===r)return{op:"min",field:e.vgField(t),order:"descending"};if(JL(["ascending",void 0],r))return!0}}(n,i,e):void 0;if(Tq(s))return rX(nQ([s.datum],a,o));const c=s;if("unaggregated"===t){const e=n.requestDataName(gX),{field:t}=s;return rX([{data:e,field:Vq({field:t,aggregate:"min"})},{data:e,field:Vq({field:t,aggregate:"max"})}])}if(QU(c.bin)){if(TV(e))return rX("bin-ordinal"===e?[]:[{data:lP(l)?n.requestDataName(gX):n.requestDataName(yX),field:n.vgField(i,cG(c,i)?{binSuffix:"range"}:{}),sort:!0!==l&&bL(l)?l:{field:n.vgField(i,{}),op:"min"}}]);{const{bin:e}=c;if(QU(e)){const t=mZ(n,c.field,e);return rX([new QZ((()=>{const e=n.getSignalName(t);return`[${e}.start, ${e}.stop]`}))])}return rX([{data:n.requestDataName(gX),field:n.vgField(i,{})}])}}if(c.timeUnit&&JL(["time","utc"],e)&&Fq(i,c,FQ(n)?n.encoding[fU(i)]:void 0,n.stack,n.markDef,n.config)){const e=n.requestDataName(gX);return rX([{data:e,field:n.vgField(i)},{data:e,field:n.vgField(i,{suffix:"end"})}])}return rX(l?[{data:lP(l)?n.requestDataName(gX):n.requestDataName(yX),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(gX),field:n.vgField(i)}])}function rQ(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:null!=n?n:t?"sum":gq},i?{field:gP(i)}:{}),r?{order:r}:{})}function sQ(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,s=null===(n=e.fieldDef(t))||void 0===n?void 0:n.bin,a=zV(r)&&r,o=tW(s)&&nW(s.extent)&&s.extent;(a||o)&&i.set("selectionExtent",null!=a?a:o,!0)}function aQ(e,t){const{aggregate:n,type:i}=e;return n?DL(n)&&!lj[n]?{valid:!1,reason:wW(n)}:"quantitative"===i&&"log"===t?{valid:!1,reason:CW(e)}:{valid:!0}:{valid:!1,reason:xW(e)}}function oQ(e,t,n,i){return e.explicit&&t.explicit&&NW(function(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${XL(n)} and ${XL(i)}). Using the union of the two domains.`}(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function uQ(e){if(KW(e)&&DL(e.field))return e.field;if(function(e){return!vL(e)&&"fields"in e&&!("data"in e)}(e)){let t;for(const n of e.fields)if(KW(n)&&DL(n.field))if(t){if(t!==n.field)return NW("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),t}else t=n.field;return NW("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),t}if(function(e){return!vL(e)&&"fields"in e&&"data"in e}(e)){NW("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const t=e.fields[0];return DL(t)?t:void 0}}function lQ(e,t){return function(e){const t=tP(e.map((e=>{if(KW(e)){const{sort:t}=e;return NL(e,["sort"])}return e})),YL),n=tP(e.map((e=>{if(KW(e)){const t=e.sort;return void 0===t||lP(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}})).filter((e=>void 0!==e)),YL);if(0===t.length)return;if(1===t.length){const t=e[0];if(KW(t)&&n.length>0){let e=n[0];if(n.length>1)NW(_W),e=!0;else if(bL(e)&&"field"in e){const n=e.field;t.field===n&&(e=!e.order||{order:e.order})}return Object.assign(Object.assign({},t),{sort:e})}return t}const i=tP(n.map((e=>lP(e)||!("op"in e)||e.op in nj?e:(NW(function(e){return`Dropping sort property ${XL(e)} as unioned domains only support boolean or op "count", "min", and "max".`}(e)),!0))),YL);let r;1===i.length?r=i[0]:i.length>1&&(NW(_W),r=!0);const s=tP(e.map((e=>KW(e)?e.data:null)),(e=>e));return 1===s.length&&null!==s[0]?Object.assign({data:s[0],fields:t.map((e=>e.field))},r?{sort:r}:{}):Object.assign({fields:t},r?{sort:r}:{})}(e.component.scales[t].get("domains").map((t=>(KW(t)&&(t.data=e.lookupDataSource(t.data)),t))))}function cQ(e){return OQ(e)||$Q(e)?e.children.reduce(((e,t)=>e.concat(cQ(t))),dQ(e)):dQ(e)}function dQ(e){return aP(e.component.scales).reduce(((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:s,type:a,selectionExtent:o,domains:u,range:l,reverse:c}=r,d=NL(r,["name","type","selectionExtent","domains","range","reverse"]),h=function(e,t,n){return OU(n)&&YW(e)?{step:{signal:t+"_step"}}:e}(r.range,s,n);let f;o&&(f=function(e,t){const n=t.selection;return{signal:sJ(e.getSelectionComponent(n,cP(n)),t)}}(e,o));const p=lQ(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:a},p?{domain:p}:{}),f?{domainRaw:f}:{}),{range:h}),void 0!==c?{reverse:c}:{}),d)),t}),[])}class hQ extends nX{constructor(e,t){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||ZL(this.get("domains"),(e=>vL(e)&&2===e.length&&e[0]<=0&&e[1]>=0))}}const fQ=["range","scheme"];function pQ(e){return"x"===e?"width":"y"===e?"height":void 0}function mQ(e,t){const n=e.fieldDef(t);if(n&&n.bin&&QU(n.bin)){const i=mZ(e,n.field,n.bin),r=pQ(t),s=e.getName(r);return new QZ((()=>{const t=e.getSignalName(i),n=`(${t}.stop - ${t}.start) / ${t}.step`;return`${e.getSignalName(s)} / (${n})`}))}}function gQ(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e).get("type");for(const i of fQ)if(void 0!==n[i]){const s=GV(r,i),a=HV(e,i);if(s)if(a)NW(a);else switch(i){case"range":return vL(n.range)&&OU(e)?iX(n.range.map((e=>{if("width"===e||"height"===e){const n=t.getName(e),i=t.getSignalName.bind(t);return QZ.fromName(i,n)}return e}))):iX(n.range);case"scheme":return iX(yQ(n[i]))}else NW(kW(r,i,e))}if(e===fj||e===pj){const t=e===fj?"width":"height",n=i[t];if(hH(n)){if(TV(r))return iX({step:n.step});NW(AW(t))}}return rX(function(e,t){const{size:n,config:i,mark:r,encoding:s}=t,a=t.getSignalName.bind(t),{type:o}=tG(s[e]),u=t.getScaleComponent(e).get("type"),{domain:l,domainMid:c}=t.specifiedScales[e];switch(e){case fj:case pj:{if(JL(["point","band"],u))if(e!==fj||n.width){if(e===pj&&!n.height){const e=yH(i.view,"height");if(hH(e))return e}}else{const e=yH(i.view,"width");if(hH(e))return e}const r=pQ(e),s=t.getName(r);return e===pj&&RV(u)?[QZ.fromName(a,s),0]:[0,QZ.fromName(a,s)]}case Dj:{const s=vQ(r,t.component.scales[e].get("zero"),i),a=function(e,t,n,i){const r={x:mQ(n,"x"),y:mQ(n,"y")};switch(e){case"bar":case"tick":{if(void 0!==i.scale.maxBandSize)return i.scale.maxBandSize;const e=xQ(t,r,i.view);return FL(e)?e-1:new QZ((()=>`${e.signal} - 1`))}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const e=xQ(t,r,i.view);return FL(e)?Math.pow(bQ*e,2):new QZ((()=>`pow(0.95 * ${e.signal}, 2)`))}}throw new Error(yW("size",e))}(r,n,t,i);return BV(u)?function(e,t,n){const i=()=>{const i=mG(t),r=mG(e),s=`(${i} - ${r}) / (${n} - 1)`;return`sequence(${r}, ${i} + ${s}, ${s})`};return XW(t)?new QZ(i):{signal:i()}}(s,a,function(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&vL(n)?n.length+1:(NW(function(e){return`Domain for ${e} is required for threshold scale.`}(i)),3)}}(u,i,l,e)):[s,a]}case bj:return[0,2*Math.PI];case $j:return[0,360];case yj:return[0,new QZ((()=>`min(${t.getSignalName("width")},${t.getSignalName("height")})/2`))];case Tj:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case Rj:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Fj:return"symbol";case _j:case Ej:case Sj:return"ordinal"===u?"nominal"===o?"category":"ordinal":void 0!==c?"diverging":"rect"===r||"geoshape"===r?"heatmap":"ramp";case Oj:case Nj:case Ij:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}(e,t))}function yQ(e){return function(e){return!DL(e)&&!!e.name}(e)?Object.assign({scheme:e.name},HL(e,["name"])):{scheme:e}}function vQ(e,t,n){if(t)return XW(t)?{signal:`${t.signal} ? 0 : ${vQ(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(yW("size",e))}const bQ=.95;function xQ(e,t,n){const i=hH(e.width)?e.width.step:gH(n,"width"),r=hH(e.height)?e.height.step:gH(n,"height");return t.x||t.y?new QZ((()=>`min(${[t.x?t.x.signal:i,t.y?t.y.signal:r].join(", ")})`)):Math.min(i,r)}function wQ(e,t){FQ(e)?function(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:a}=e;for(const o of aP(n)){const u=a[o],l=n[o],c=e.getScaleComponent(o),d=tG(r[o]),h=u[t],f=c.get("type"),p=c.get("padding"),m=c.get("paddingInner"),g=GV(f,t),y=HV(o,t);if(void 0!==h&&(g?y&&NW(y):NW(kW(f,t,o))),g&&void 0===y)if(void 0!==h)l.copyKeyFromObject(t,u);else{const n=t in CQ?CQ[t]({model:e,channel:o,fieldOrDatumDef:d,scaleType:f,scalePadding:p,scalePaddingInner:m,domain:u.domain,markDef:s,config:i}):i.scale[t];void 0!==n&&l.set(t,n,!1)}}}(e,t):AQ(e,t)}const CQ={bins:({model:e,fieldOrDatumDef:t})=>Nq(t)?function(e,t){const n=t.bin;if(QU(n)){const i=mZ(e,t.field,n);return new QZ((()=>e.getSignalName(i)))}if(eW(n)&&tW(n)&&void 0!==n.step)return{step:n.step}}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(e,t){if(JL([_j,Ej,Sj],e)&&"nominal"!==t)return"hcl"}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(e,t,n){var i;if(!(null===(i=eG(n))||void 0===i?void 0:i.bin)&&!JL([xV,wV],e))return t in DU||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>function(e,t,n,i,r,s){if(e in DU){if(MV(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:t,orient:a}=r;if("bar"===t&&(!Nq(i)||!i.bin&&!i.timeUnit)&&("vertical"===a&&"x"===e||"horizontal"===a&&"y"===e))return s.continuousBandSize}if(t===CV)return n.pointPadding}}(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>function(e,t,n,i){if(void 0===e&&t in DU){const{bandPaddingInner:e,barBandPaddingInner:t,rectBandPaddingInner:r}=i;return xP(e,"bar"===n?t:r)}}(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:r,config:s})=>function(e,t,n,i,r,s){if(void 0===e&&t in DU&&"band"===n){const{bandPaddingOuter:e}=s;return xP(e,XW(r)?{signal:`${r.signal}/2`}:r/2)}}(e,t,n,i.type,r,s.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>function(e,t,n,i){return"x"===n&&void 0!==i.xReverse?RV(e)&&"descending"===t?XW(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse:!(!RV(e)||"descending"!==t)||void 0}(t,Nq(e)?e.sort:void 0,n,i.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>function(e,t,n,i,r){if(n&&"unaggregated"!==n&&RV(r)){if(vL(n)){const e=n[0],t=n[n.length-1];if(e<=0&&t>=0)return!0}return!1}if("size"===e&&"quantitative"===t.type&&!BV(r))return!0;if((!Nq(t)||!t.bin)&&JL([...$U,...IU],e)){const{orient:t,type:n}=i;return!JL(["bar","area","line","trail"],n)||!("horizontal"===t&&"y"===e||"vertical"===t&&"x"===e)}return!1}(e,t,n,i,r)};function kQ(e){FQ(e)?function(e){const t=e.component.scales;for(const n of GU){const i=t[n];if(!i)continue;const r=gQ(n,e);i.setWithExplicit("range",r)}}(e):AQ(e,"range")}function AQ(e,t){const n=e.component.scales;for(const n of e.children)"range"===t?kQ(n):wQ(n,t);for(const i of aP(n)){let r;for(const n of e.children){const e=n.component.scales[i];e&&(r=oX(r,e.getWithExplicit(t),t,"scale",sX(((e,n)=>{switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0}))))}n[i].setWithExplicit(t,r)}}function _Q(e){FQ(e)?e.component.scales=function(e){const{encoding:t,mark:n}=e;return GU.reduce(((i,r)=>{const s=tG(t[r]);if(s&&n===qP&&r===Fj&&s.type===yV)return i;let a=s&&s.scale;if(s&&null!==a&&!1!==a){a=null!=a?a:{};const t=function(e,t,n,i){const r=function(e,t,n){var i;switch(t.type){case"nominal":case"ordinal":if(Yj(e)||"discrete"===JU(e))return"shape"===e&&"ordinal"===t.type&&NW(bW(e,"ordinal")),"ordinal";if(e in DU){if(JL(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&e in NU)return"band";return void 0!==t.band||jq(t)&&(null===(i=t.axis)||void 0===i?void 0:i.tickBand)?"band":"point";case"temporal":return Yj(e)?"time":"discrete"===JU(e)?(NW(bW(e,"temporal")),"ordinal"):Nq(t)&&t.timeUnit&&HW(t.timeUnit).utc?"utc":"time";case"quantitative":return Yj(e)?Nq(t)&&QU(t.bin)?"bin-ordinal":"linear":"discrete"===JU(e)?(NW(bW(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(pW(t.type))}(t,n,i),{type:s}=e;return HU(t)?void 0!==s?YV(t,s)?Nq(n)&&!XV(s,n.type)?(NW(function(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}(s,r)),r):s:(NW(function(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}(t,s,r)),r):r:null}(a,r,s,n);i[r]=new hQ(e.scaleName(r+"",!0),{value:t,explicit:a.type===t})}return i}),{})}(e):e.component.scales=function(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const n of e.children){_Q(n);for(const s of aP(n.component.scales))if(r.scale[s]=null!==(t=r.scale[s])&&void 0!==t?t:qJ(s,e),"shared"===r.scale[s]){const e=i[s],t=n.component.scales[s].getWithExplicit("type");e?_V(e.value,t.value)?i[s]=oX(e,t,"type","scale",EQ):(r.scale[s]="independent",delete i[s]):i[s]=t}}for(const t of aP(i)){const r=e.scaleName(t,!0),s=i[t];n[t]=new hQ(r,s);for(const n of e.children){const e=n.component.scales[t];e&&(n.renameScale(e.get("name"),r),e.merged=!0)}}return n}(e)}const EQ=sX(((e,t)=>SV(e)-SV(t)));class SQ{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return void 0!==this.nameMap[e]}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function FQ(e){return"unit"===(null==e?void 0:e.type)}function DQ(e){return"facet"===(null==e?void 0:e.type)}function $Q(e){return"concat"===(null==e?void 0:e.type)}function OQ(e){return"layer"===(null==e?void 0:e.type)}class NQ{constructor(e,t,n,i,r,s,a){var o,u;this.type=t,this.parent=n,this.config=r,this.view=a,this.children=[],this.correctDataNames=e=>(e.from&&e.from.data&&(e.from.data=this.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=this.lookupDataSource(e.from.facet.data)),e),this.parent=n,this.config=r,this.name=null!==(o=e.name)&&void 0!==o?o:i,this.title=hG(e.title)?{text:e.title}:e.title,this.scaleNameMap=n?n.scaleNameMap:new SQ,this.projectionNameMap=n?n.projectionNameMap:new SQ,this.signalNameMap=n?n.signalNameMap:new SQ,this.data=e.data,this.description=e.description,this.transforms=(null!==(u=e.transform)&&void 0!==u?u:[]).map((e=>vX(e)?{filter:WL(e.filter,dV)}:e)),this.layout="layer"===t||"unit"===t?{}:function(e,t,n){var i,r;const s=n[t],a={},{spacing:o,columns:u}=s;void 0!==o&&(a.spacing=o),void 0!==u&&(Aq(e)&&!Cq(e.facet)||lH(e))&&(a.columns=u),cH(e)&&(a.columns=1);for(const t of pH)if(void 0!==e[t])if("spacing"===t){const n=e[t];a[t]=FL(n)?n:{row:null!==(i=n.row)&&void 0!==i?i:o,column:null!==(r=n.column)&&void 0!==r?r:o}}else a[t]=e[t];return a}(e,t,r),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:Aq(e)||n&&n.component.data.isFaceted&&void 0===e.data},layoutSize:new nX,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},s?qL(s):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(e,{ignoreRange:t}={}){_Q(e),eQ(e);for(const t of qV)wQ(e,t);t||kQ(e)}(this)}parseProjection(){fZ(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){rZ(this)}assembleGroupStyle(){var e,t;if("unit"===this.type||"layer"===this.type)return null!==(t=null===(e=this.view)||void 0===e?void 0:e.style)&&void 0!==t?t:"cell"}assembleEncodeFromView(e){const{style:t}=e,n=NL(e,["style"]),i={};for(const e of aP(n)){const t=n[e];void 0!==t&&(i[e]=fG(t))}return i}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),e||(this.description&&(t.description=fG(this.description)),"unit"!==this.type&&"layer"!==this.type)?sP(t)?void 0:t:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=t?t:{})}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=NL(e,["spacing"]),{component:i,config:r}=this,s=function(e,t){const n={};for(const i of Jj){const r=e[i];if(null==r?void 0:r.facetFieldDef){const{titleAnchor:e,titleOrient:s}=EJ(["titleAnchor","titleOrient"],r.facetFieldDef,t,i),a=AJ(i,s),o=BJ(e,a);void 0!==o&&(n[a]=o)}}return sP(n)?void 0:n}(i.layoutHeaders,r);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),s?{titleBand:s}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of Jj)e[n].title&&t.push(DJ(this,n));for(const e of SJ)t=t.concat(NJ(this,e));return t}assembleAxes(){return function(e,t){const{x:n=[],y:i=[]}=e;return[...n.map((e=>uJ(e,"grid",t))),...i.map((e=>uJ(e,"grid",t))),...n.map((e=>uJ(e,"main",t))),...i.map((e=>uJ(e,"main",t)))].filter((e=>e))}(this.component.axes,this.config)}assembleLegends(){return lZ(this)}assembleProjections(){return OQ(e=this)||$Q(e)?function(e){return e.children.reduce(((e,t)=>e.concat(t.assembleProjections())),cZ(e))}(e):cZ(e);var e}assembleTitle(){var e,t,n;const i=null!==(e=this.title)&&void 0!==e?e:{},{encoding:r}=i,s=NL(i,["encoding"]),a=Object.assign(Object.assign(Object.assign({},dG(this.config.title).nonMark),s),r?{encode:{update:r}}:{});if(a.text)return JL(["unit","layer"],this.type)?JL(["middle",void 0],a.anchor)&&(a.frame=null!==(t=a.frame)&&void 0!==t?t:"group"):a.anchor=null!==(n=a.anchor)&&void 0!==n?n:"start",sP(a)?void 0:a}assembleGroup(e=[]){const t={};(e=e.concat(this.assembleSignals())).length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||DQ(this.parent)?cQ(this):[];i.length>0&&(t.scales=i);const r=this.assembleAxes();r.length>0&&(t.axes=r);const s=this.assembleLegends();return s.length>0&&(t.legends=s),t}getName(e){return cP((this.name?this.name+"_":"")+e)}requestDataName(e){var t;const n=this.getName(e),i=this.component.data.outputNodeRefCounts;return i[n]=(null!==(t=i[n])&&void 0!==t?t:0)+1,n}getSizeSignalRef(e){if(DQ(this.parent)){const t=TU(WJ(e)),n=this.component.scales[t];if(n&&!n.merged){const e=n.get("type"),i=n.get("range");if(TV(e)&&YW(i)){const e=n.get("name"),i=uQ(lQ(this,t));return i?{signal:UJ(e,n,Vq({aggregate:"distinct",field:i},{expr:"datum"}))}:(NW(`Unknown field for ${t}. Cannot calculate view size.`),null)}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):uU(e)&&HU(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(`Cannot find a selection named "${t}".`);return n}hasAxisOrientSignalRef(){var e,t;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some((e=>e.hasOrientSignalRef())))||(null===(t=this.component.axes.y)||void 0===t?void 0:t.some((e=>e.hasOrientSignalRef())))}}class IQ extends NQ{vgField(e,t={}){const n=this.fieldDef(e);if(n)return Vq(n,t)}reduceFieldDef(e,t){return OG(this.getMapping(),((t,n,i)=>{const r=eG(n);return r?e(t,r,i):t}),t)}forEachFieldDef(e,t){$G(this.getMapping(),((t,n)=>{const i=eG(t);i&&e(i,n)}),t)}}class TQ extends cY{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=qL(t);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=s[0])&&void 0!==i?i:"value",null!==(r=s[1])&&void 0!==r?r:"density"]}clone(){return new TQ(null,qL(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${YL(this.transform)}`}assemble(){const e=this.transform,{density:t}=e,n=NL(e,["density"]);return Object.assign({type:"kde",field:t},n)}}class RQ extends cY{constructor(e,t){super(e),this.filter=t}clone(){return new RQ(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:i,markDef:r}=t;if("filter"!==yG("invalid",r,n))return null;const s=t.reduceFieldDef(((e,n,r)=>{const s=HU(r)&&t.getScaleComponent(r);return s&&RV(s.get("type"))&&"count"!==n.aggregate&&!GP(i)&&(e[n.field]=n),e}),{});return aP(s).length?new RQ(e,s):null}dependentFields(){return new Set(aP(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${YL(this.filter)}`}assemble(){const e=aP(this.filter).reduce(((e,t)=>{const n=this.filter[t],i=Vq(n,{expr:"datum"});return null!==n&&("temporal"===n.type?e.push(`(isDate(${i}) || (isValid(${i}) && isFinite(+${i})))`):"quantitative"===n.type&&(e.push(`isValid(${i})`),e.push(`isFinite(+${i})`))),e}),[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class MQ extends cY{constructor(e,t){super(e),this.transform=t,this.transform=qL(t);const{flatten:n,as:i=[]}=this.transform;this.transform.as=n.map(((e,t)=>{var n;return null!==(n=i[t])&&void 0!==n?n:e}))}clone(){return new MQ(this.parent,qL(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${YL(this.transform)}`}assemble(){const{flatten:e,as:t}=this.transform;return{type:"flatten",fields:e,as:t}}}class BQ extends cY{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=qL(t);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=s[0])&&void 0!==i?i:"key",null!==(r=s[1])&&void 0!==r?r:"value"]}clone(){return new BQ(null,qL(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${YL(this.transform)}`}assemble(){const{fold:e,as:t}=this.transform;return{type:"fold",fields:e,as:t}}}class zQ extends cY{constructor(e,t,n,i){super(e),this.fields=t,this.geojson=n,this.signal=i}clone(){return new zQ(null,qL(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const i of[[Cj,wj],[Aj,kj]]){const r=i.map((e=>{const n=tG(t.encoding[e]);return Nq(n)?n.field:Tq(n)?{expr:`${n.datum}`}:Lq(n)?{expr:`${n.value}`}:void 0}));(r[0]||r[1])&&(e=new zQ(e,r,null,t.getName("geojson_"+n++)))}if(t.channelHasField(Fj)){const i=t.typedFieldDef(Fj);i.type===yV&&(e=new zQ(e,null,i.field,t.getName("geojson_"+n++)))}return e}dependentFields(){var e;const t=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(DL);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${YL(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class LQ extends cY{constructor(e,t,n,i){super(e),this.projection=t,this.fields=n,this.as=i}clone(){return new LQ(null,this.projection,qL(this.fields),qL(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[Cj,wj],[Aj,kj]]){const i=n.map((e=>{const n=tG(t.encoding[e]);return Nq(n)?n.field:Tq(n)?{expr:`${n.datum}`}:Lq(n)?{expr:`${n.value}`}:void 0})),r=n[0]===Aj?"2":"";(i[0]||i[1])&&(e=new LQ(e,t.projectionName(),i,[t.getName("x"+r),t.getName("y"+r)]))}return e}dependentFields(){return new Set(this.fields.filter(DL))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${YL(this.fields)} ${YL(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class PQ extends cY{constructor(e,t){super(e),this.transform=t}clone(){return new PQ(null,qL(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:i}=e;return{signal:`sequence(${[t,n,...i?[i]:[]].join(",")})`}}static makeFromTransform(e,t){return new PQ(e,t)}static makeFromEncoding(e,t){const n=t.encoding,i=n.x,r=n.y;if(Nq(i)&&Nq(r)){const s=i.impute?i:r.impute?r:void 0;if(void 0===s)return;const a=i.impute?r:r.impute?i:void 0,{method:o,value:u,frame:l,keyvals:c}=s.impute,d=NG(t.mark,n);return new PQ(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:s.field,key:a.field},o?{method:o}:{}),void 0!==u?{value:u}:{}),l?{frame:l}:{}),void 0!==c?{keyvals:c}:{}),d.length?{groupby:d}:{}))}return null}hash(){return`Impute ${YL(this.transform)}`}assemble(){const{impute:e,key:t,keyvals:n,method:i,groupby:r,value:s,frame:a=[null,null]}=this.transform,o=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:(u=n,void 0!==(null==u?void 0:u.stop)?this.processSequence(n):n)}:{}),{method:"value"}),r?{groupby:r}:{}),{value:i&&"value"!==i?null:s});var u;return i&&"value"!==i?[o,Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[i],fields:[e],frame:a,ignorePeers:!1},r?{groupby:r}:{}),{type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e}]:[o]}}class jQ extends cY{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=qL(t);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=s[0])&&void 0!==i?i:t.on,null!==(r=s[1])&&void 0!==r?r:t.loess]}clone(){return new jQ(null,qL(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${YL(this.transform)}`}assemble(){const e=this.transform,{loess:t,on:n}=e,i=NL(e,["loess","on"]);return Object.assign({type:"loess",x:n,y:t},i)}}class UQ extends cY{constructor(e,t,n){super(e),this.transform=t,this.secondary=n}clone(){return new UQ(null,qL(this.transform),this.secondary)}static make(e,t,n,i){const r=t.component.data.sources,{from:s}=n;let a=null;if(function(e){return"data"in e}(s)){let e=i0(s.data,r);e||(e=new vZ(s.data),r.push(e));const n=t.getName(`lookup_${i}`);a=new dY(e,n,"lookup",t.component.data.outputNodeRefCounts),t.component.data.outputNodes[n]=a}else if(function(e){return"selection"in e}(s)){const e=s.selection;if(n=Object.assign({as:e},n),a=t.getSelectionComponent(cP(e),e).materialized,!a)throw new Error(`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`)}return new UQ(e,n,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?AL(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${YL({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:AL(this.transform.as)}:{});else{let t=this.transform.as;DL(t)||(NW('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}class WQ extends cY{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=qL(t);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=s[0])&&void 0!==i?i:"prob",null!==(r=s[1])&&void 0!==r?r:"value"]}clone(){return new WQ(null,qL(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${YL(this.transform)}`}assemble(){const e=this.transform,{quantile:t}=e,n=NL(e,["quantile"]);return Object.assign({type:"quantile",field:t},n)}}class VQ extends cY{constructor(e,t){var n,i,r;super(e),this.transform=t,this.transform=qL(t);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=s[0])&&void 0!==i?i:t.on,null!==(r=s[1])&&void 0!==r?r:t.regression]}clone(){return new VQ(null,qL(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${YL(this.transform)}`}assemble(){const e=this.transform,{regression:t,on:n}=e,i=NL(e,["regression","on"]);return Object.assign({type:"regression",x:n,y:t},i)}}class qQ extends cY{constructor(e,t){super(e),this.transform=t}clone(){return new qQ(null,qL(this.transform))}addDimensions(e){var t;this.transform.groupby=tP((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),(e=>e))}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}hash(){return`PivotTransform ${YL(this.transform)}`}assemble(){const{pivot:e,value:t,groupby:n,limit:i,op:r}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},void 0!==i?{limit:i}:{}),void 0!==r?{op:r}:{}),void 0!==n?{groupby:n}:{})}}class GQ extends cY{constructor(e,t){super(e),this.transform=t}clone(){return new GQ(null,qL(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${YL(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function HQ(e){let t=0;return function n(i,r){var s;if(i instanceof vZ&&!i.isGenerator&&!lX(i.data)&&(e.push(r),r={name:null,source:r.name,transform:[]}),i instanceof $Z&&(i.parent instanceof vZ&&!r.source?(r.format=Object.assign(Object.assign({},null!==(s=r.format)&&void 0!==s?s:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof SZ){r.name||(r.name="data_"+t++),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source;for(const t of i.assemble())e.push(t)}else switch((i instanceof xZ||i instanceof wZ||i instanceof RQ||i instanceof iJ||i instanceof CJ||i instanceof LQ||i instanceof zQ||i instanceof EZ||i instanceof UQ||i instanceof TZ||i instanceof NZ||i instanceof BQ||i instanceof MQ||i instanceof TQ||i instanceof jQ||i instanceof WQ||i instanceof VQ||i instanceof OZ||i instanceof GQ||i instanceof qQ)&&r.transform.push(i.assemble()),(i instanceof yZ||i instanceof hY||i instanceof PQ||i instanceof IZ)&&r.transform.push(...i.assemble()),i instanceof dY&&(r.source&&0===r.transform.length?i.setSource(r.source):i.parent instanceof dY?i.setSource(r.name):(r.name||(r.name="data_"+t++),i.setSource(r.name),1===i.numChildren()&&(e.push(r),r={name:null,source:r.name,transform:[]}))),i.numChildren()){case 0:i instanceof dY&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name="data_"+t++);let s=r.name;!r.source||r.transform.length>0?e.push(r):s=r.source;for(const e of i.children)n(e,{name:null,source:s,transform:[]});break}}}}function XQ(e){return"top"===e||"left"===e||XW(e)?"header":"footer"}function YQ(e,t){var n;const{facet:i,config:r,child:s,component:a}=e;if(e.channelHasField(t)){const o=i[t],u=_J("title",null,r,t);let l=Kq(o,r,{allowDisabling:!0,includeDefault:void 0===u||!!u});s.component.layoutHeaders[t].title&&(l=vL(l)?l.join(", "):l,l+=" / "+s.component.layoutHeaders[t].title,s.component.layoutHeaders[t].title=null);const c=_J("labelOrient",o,r,t),d=xP((null!==(n=o.header)&&void 0!==n?n:{}).labels,r.header.labels,!0),h=JL(["bottom","right"],c)?"footer":"header";a.layoutHeaders[t]={title:l,facetFieldDef:o,[h]:"facet"===t?[]:[KQ(e,t,d)]}}}function KQ(e,t,n){const i="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function JQ(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:s}=e.component;if(s.axis[t]=GJ(s,t),"shared"===s.axis[t]){const s="x"===t?"column":"row",a=r[s];for(const r of i.component.axes[t]){const t=XQ(r.get("orient"));a[t]=null!==(n=a[t])&&void 0!==n?n:[KQ(e,s,!1)];const i=uJ(r,"main",e.config,{header:!0});i&&a[t][0].axes.push(i),r.mainExtracted=!0}}}}function ZQ(e){for(const t of e.children)t.parseLayoutSize()}function QQ(e,t){const n=WJ(t),i=TU(n),r=e.component.resolve,s=e.component.layoutSize;let a;for(const t of e.children){const e=t.component.layoutSize.getWithExplicit(n),s=r.scale[i];if("independent"===s&&"step"===e.value){a=void 0;break}if(a){if("independent"===s&&a.value!==e.value){a=void 0;break}a=oX(a,e,n,"")}else a=e}if(a){for(const i of e.children)e.renameSignal(i.getName(n),e.getName(t)),i.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(t,a)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function e0(e,t){const n="width"===t?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const e=r.get("type"),n=r.get("range");if(TV(e)){const e=yH(i.view,t);return YW(n)||hH(e)?"step":e}return mH(i.view,t)}if(e.hasProjection||"arc"===e.mark)return mH(i.view,t);{const e=yH(i.view,t);return hH(e)?e.step:e}}function t0(e,t,n){return Vq(t,Object.assign({suffix:`by_${Vq(e)}`},null!=n?n:{}))}class n0 extends IQ{constructor(e,t,n,i){super(e,"facet",t,n,i,e.resolve),this.child=k0(e.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(e.facet,i)}initFacet(e,t){return Cq(e)?OG(e,((e,n,i)=>JL([cj,dj],i)?void 0===n.field?(NW(gW(n,i)),e):(e[i]=nG(n,i,t),e):(NW(yW(i,"facet")),e)),{}):{facet:nG(e,"facet",t)}}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=r0(this),this.child.parseData()}parseLayoutSize(){ZQ(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(e){for(const t of Jj)YQ(e,t);JQ(e,"x"),JQ(e,"y")}(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const i={};for(const r of Jj)for(const s of FJ){const a=this.component.layoutHeaders[r],o=a[s],{facetFieldDef:u}=a;if(u){const t=_J("titleOrient",u,this.config,r);if(JL(["right","bottom"],t)){const n=AJ(r,t);i.titleAnchor=null!==(e=i.titleAnchor)&&void 0!==e?e:{},i.titleAnchor[n]="end"}}if(null==o?void 0:o[0]){const e="row"===r?"height":"width",o="header"===s?"headerBand":"footerBand";"facet"===r||this.child.component.layoutSize.get(e)||(i[o]=null!==(t=i[o])&&void 0!==t?t:{},i[o][r]=.5),a.title&&(i.offset=null!==(n=i.offset)&&void 0!==n?n:{},i.offset["row"===r?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let i="all";return(t||"independent"!==this.component.resolve.scale.x)&&(e||"independent"!==this.component.resolve.scale.y)||(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof n0))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(e){return this.parent&&this.parent instanceof n0?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:Vq(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof n0){if(this.child.channelHasField("column")){const i=Vq(this.child.facet.column);e.push(i),t.push("distinct"),n.push(`distinct_${i}`)}}else for(const i of $U){const r=this.child.component.scales[i];if(r&&!r.merged){const s=r.get("type"),a=r.get("range");if(TV(s)&&YW(a)){const r=uQ(lQ(this.child,i));r?(e.push(r),t.push("distinct"),n.push(`distinct_${r}`)):NW(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:i}=this.facet,{fields:r,ops:s,as:a}=this.getCardinalityAggregateForChild(),o=[];for(const e of Jj){const t=this.facet[e];if(t){o.push(Vq(t));const{bin:u,sort:l}=t;if(QU(u)&&o.push(Vq(t,{binSuffix:"end"})),xq(l)){const{field:e,op:o=gq}=l,u=t0(t,l);n&&i?(r.push(u),s.push("max"),a.push(u)):(r.push(e),s.push(o),a.push(u))}else if(vL(l)){const n=kJ(t,e);r.push(n),s.push("max"),a.push(n)}}}const u=!!n&&!!i;return Object.assign({name:e,data:t,groupby:o},u||r.length>0?{aggregate:Object.assign(Object.assign({},u?{cross:u}:{}),r.length?{fields:r,ops:s,as:a}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?xq(n.sort)?[t0(n,n.sort,{expr:"datum"})]:vL(n.sort)?[kJ(n,e,{expr:"datum"})]:[Vq(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:e}=n;return[(xq(e)?e.order:!vL(e)&&e)||"ascending"]}return[]}assembleLabelTitle(){const{facet:e,config:t}=this;if(e.facet)return TJ(e.facet,"facet",t);const n={row:["top","bottom"],column:["left","right"]};for(const i of SJ)if(e[i]){const r=_J("labelOrient",e[i],t,i);if(JL(n[i],r))return TJ(e[i],i,t)}}assembleMarks(){const{child:e}=this,t=function(e){const t=[],n=HQ(t);for(const t of e.children)n(t,{source:e.name,name:null,transform:[]});return t}(this.component.data.facetRoot),n=e.assembleGroupEncodeEntry(!1),i=this.assembleLabelTitle()||e.assembleTitle(),r=e.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},i?{title:i}:{}),r?{style:r}:{}),{from:{facet:this.assembleFacet()},sort:{field:Jj.map((e=>this.facetSortFields(e))).flat(),order:Jj.map((e=>this.facetSortOrder(e))).flat()}}),t.length>0?{data:t}:{}),n?{encode:{update:n}}:{}),e.assembleGroup(function(e,t){if(e.component.selection&&aP(e.component.selection).length){const n=$L(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:rL("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return TY(t)}(this,[])))]}getMapping(){return this.facet}}function i0(e,t){var n,i,r,s,a,o,u,l,c,d;for(const h of t){const t=h.data;if(!(e.name&&h.hasName()&&e.name!==h.dataName||(null===(n=e.format)||void 0===n?void 0:n.mesh)&&(null===(i=t.format)||void 0===i?void 0:i.feature)||((null===(r=e.format)||void 0===r?void 0:r.feature)||(null===(s=t.format)||void 0===s?void 0:s.feature))&&(null===(a=e.format)||void 0===a?void 0:a.feature)!==(null===(o=t.format)||void 0===o?void 0:o.feature)||((null===(u=e.format)||void 0===u?void 0:u.mesh)||(null===(l=t.format)||void 0===l?void 0:l.mesh))&&(null===(c=e.format)||void 0===c?void 0:c.mesh)!==(null===(d=t.format)||void 0===d?void 0:d.mesh)))if(cX(e)&&cX(t)){if(VL(e.values,t.values))return h}else if(lX(e)&&lX(t)){if(e.url===t.url)return h}else if(dX(e)&&e.name===h.dataName)return h}return null}function r0(e){var t,n,i,r,s,a,o,u,l,c;let d=function(e,t){if(e.data||!e.parent){if(null===e.data){const e=new vZ({values:[]});return t.push(e),e}const n=i0(e.data,t);if(n)return hX(e.data)||(n.data.format=function(e,...t){for(const n of t)eP(e,null!=n?n:{});return e}({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const n=new vZ(e.data);return t.push(n),n}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources);const{outputNodes:h,outputNodeRefCounts:f}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new uX,m=e.data;hX(m)?(fX(m)?d=new wZ(d,m.sequence):mX(m)&&(d=new xZ(d,m.graticule)),p.parseNothing=!0):null===(null===(t=null==m?void 0:m.format)||void 0===t?void 0:t.parse)&&(p.parseNothing=!0),d=null!==(n=$Z.makeExplicit(d,e,p))&&void 0!==n?n:d,d=new OZ(d);const g=e.parent&&OQ(e.parent);(FQ(e)||DQ(e))&&g&&(d=null!==(i=yZ.makeFromEncoding(d,e))&&void 0!==i?i:d),e.transforms.length>0&&(d=function(e,t,n){var i,r;let s=0;for(const a of t.transforms){let o,u;if(DX(a))u=e=new CJ(e,a),o="derived";else if(vX(a)){const r=DZ(a);u=e=null!==(i=$Z.makeWithAncestors(e,{},r,n))&&void 0!==i?i:e,e=new iJ(e,t,a.filter)}else if($X(a))u=e=yZ.makeFromTransform(e,a,t),o="number";else if(NX(a))o="date",void 0===n.getWithExplicit(a.field).value&&(e=new $Z(e,{[a.field]:o}),n.set(a.field,o,!1)),u=e=hY.makeFromTransform(e,a);else if(IX(a))u=e=EZ.makeFromTransform(e,a),o="number",XY(t)&&(e=new OZ(e));else if(bX(a))u=e=UQ.make(e,t,a,s++),o="derived";else if(EX(a))u=e=new TZ(e,a),o="number";else if(SX(a))u=e=new NZ(e,a),o="number";else if(TX(a))u=e=IZ.makeFromTransform(e,a),o="derived";else if(RX(a))u=e=new BQ(e,a),o="derived";else if(FX(a))u=e=new MQ(e,a),o="derived";else if(xX(a))u=e=new qQ(e,a),o="derived";else if(_X(a))e=new GQ(e,a);else if(OX(a))u=e=PQ.makeFromTransform(e,a),o="derived";else if(wX(a))u=e=new TQ(e,a),o="derived";else if(CX(a))u=e=new WQ(e,a),o="derived";else if(kX(a))u=e=new VQ(e,a),o="derived";else{if(!AX(a)){NW(`Ignoring an invalid transform: ${XL(a)}.`);continue}u=e=new jQ(e,a),o="derived"}if(u&&void 0!==o)for(const e of null!==(r=u.producedFields())&&void 0!==r?r:[])n.set(e,o,!1)}return e}(d,e,p));const y=function(e){const t={};if(FQ(e)&&e.component.selection)for(const n of aP(e.component.selection)){const i=e.component.selection[n];for(const e of i.project.items)!e.channel&&bP(e.field)>1&&(t[e.field]="flatten")}return t}(e),v=function(e){const t={};function n(e){var n;oG(e)?t[e.field]="date":"quantitative"===e.type&&DL(n=e.aggregate)&&JL(["min","max"],n)?t[e.field]="number":bP(e.field)>1?e.field in t||(t[e.field]="flatten"):Pq(e)&&xq(e.sort)&&bP(e.sort.field)>1&&(e.sort.field in t||(t[e.sort.field]="flatten"))}if((FQ(e)||DQ(e))&&e.forEachFieldDef(((t,i)=>{if(zq(t))n(t);else{const r=dU(i),s=e.fieldDef(r);n(Object.assign(Object.assign({},t),{type:s.type}))}})),FQ(e)){const{mark:n,markDef:i,encoding:r}=e;if(GP(n)&&!e.encoding.order){const e=r["horizontal"===i.orient?"y":"x"];Nq(e)&&"quantitative"===e.type&&!(e.field in t)&&(t[e.field]="number")}}return t}(e);d=null!==(r=$Z.makeWithAncestors(d,{},Object.assign(Object.assign({},y),v),p))&&void 0!==r?r:d,FQ(e)&&(d=zQ.parseAll(d,e),d=LQ.parseAll(d,e)),(FQ(e)||DQ(e))&&(g||(d=null!==(s=yZ.makeFromEncoding(d,e))&&void 0!==s?s:d),d=null!==(a=hY.makeFromEncoding(d,e))&&void 0!==a?a:d,d=CJ.parseAllForSortIndex(d,e));const b=e.getName(yX),x=new dY(d,b,yX,f);if(h[b]=x,d=x,FQ(e)){const t=EZ.makeFromEncoding(d,e);t&&(d=t,XY(e)&&(d=new OZ(d))),d=null!==(o=PQ.makeFromEncoding(d,e))&&void 0!==o?o:d,d=null!==(u=IZ.makeFromEncoding(d,e))&&void 0!==u?u:d}FQ(e)&&(d=null!==(l=RQ.make(d,e))&&void 0!==l?l:d);const w=e.getName(gX),C=new dY(d,w,gX,f);h[w]=C,d=C,FQ(e)&&function(e,t){GY(e,(n=>{const i=n.name,r=e.getName(`lookup_${i}`);e.component.data.outputNodes[r]=n.materialized=new dY(new iJ(t,e,{selection:i}),r,"lookup",e.component.data.outputNodeRefCounts)}))}(e,C);let k=null;if(DQ(e)){const t=e.getName("facet");d=null!==(c=function(e,t){const{row:n,column:i}=t;if(n&&i){let t=null;for(const r of[n,i])if(xq(r.sort)){const{field:n,op:i=gq}=r.sort;e=t=new NZ(e,{joinaggregate:[{op:i,field:n,as:t0(r,r.sort,{forAs:!0})}],groupby:[Vq(r)]})}return t}return null}(d,e.facet))&&void 0!==c?c:d,k=new SZ(d,e,t,C.getSource()),h[t]=k}return Object.assign(Object.assign({},e.component.data),{outputNodes:h,outputNodeRefCounts:f,raw:x,main:C,facetRoot:k,ancestorParse:p})}class s0 extends NQ{constructor(e,t,n,i){var r,s,a,o;super(e,"concat",t,n,i,e.resolve),"shared"!==(null===(s=null===(r=e.resolve)||void 0===r?void 0:r.axis)||void 0===s?void 0:s.x)&&"shared"!==(null===(o=null===(a=e.resolve)||void 0===a?void 0:a.axis)||void 0===o?void 0:o.y)||NW("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(e).map(((e,t)=>k0(e,this,this.getName("concat_"+t),void 0,i)))}parseData(){this.component.data=r0(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of aP(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return cH(e)?e.vconcat:dH(e)?e.hconcat:e.concat}parseLayoutSize(){!function(e){ZQ(e);const t=1===e.layout.columns?"width":"childWidth",n=void 0===e.layout.columns?"height":"childHeight";QQ(e,t),QQ(e,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.forEach((e=>e.assembleSignals())),[]}assembleLayoutSignals(){const e=LJ(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleMarks(){return this.children.map((e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),i=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),i?{encode:{update:i}}:{}),e.assembleGroup())}))}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},null!=e?{columns:e}:{}),{bounds:"full",align:"each"})}}const a0=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},FP),{labelExpr:1,encode:1}),o0=aP(a0);class u0 extends nX{constructor(e={},t={},n=!1){super(),this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new u0(qL(this.explicit),qL(this.implicit),this.mainExtracted)}hasAxisPart(e){return!("axis"!==e&&("grid"===e||"title"===e?!this.get(e):!1===(t=this.get(e))||null===t));var t}hasOrientSignalRef(){return XW(this.explicit.orient)}}const l0={bottom:"top",top:"bottom",left:"right",right:"left"};function c0(e,t){if(!e)return t.map((e=>e.clone()));{if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const n=e[i],r=t[i];if(!!n!=!!r)return;if(n&&r){const t=n.getWithExplicit("orient"),s=r.getWithExplicit("orient");if(t.explicit&&s.explicit&&t.value!==s.value)return;e[i]=d0(n,r)}}}return e}function d0(e,t){for(const n of o0){const i=oX(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",((e,t)=>{switch(n){case"title":return AG(e,t);case"gridScale":return{explicit:e.explicit,value:xP(e.value,t.value)}}return aX(e,t,n,"axis")}));e.setWithExplicit(n,i)}return e}function h0(e,t,n,i,r){if("disable"===t)return void 0!==n;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(XW(n.labelAngle)?n.labelAngle:CP(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===wJ(i,r))return!0}return e===n[t]}const f0=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function p0(e,t){var n,i,r;let s=t.axis(e);const a=new u0,o=tG(t.encoding[e]),{mark:u,config:l}=t,c=(null==s?void 0:s.orient)||(null===(n=l["x"===e?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(i=l.axis)||void 0===i?void 0:i.orient)||function(e){return"x"===e?"bottom":"left"}(e),d=t.getScaleComponent(e).get("type"),h=function(e,t,n,i){const r="band"===t?["axisDiscrete","axisBand"]:"point"===t?["axisDiscrete","axisPoint"]:t in $V?["axisQuantitative"]:"time"===t||"utc"===t?["axisTemporal"]:[],s="x"===e?"axisX":"axisY",a=XW(n)?"axisOrient":"axis"+fP(n),o=[...r,...r.map((e=>s+e.substr(4)))],u=["axis",a,s];return{vlOnlyAxisConfig:pJ(o,i,e,n),vgAxisConfig:pJ(u,i,e,n),axisConfigStyle:mJ([...u,...o],i)}}(e,d,c,t.config),f=void 0!==s?!s:gJ("disable",l,null==s?void 0:s.style,h).configValue;if(a.set("disable",f,void 0!==s),f)return a;s=s||{};const p=function(e,t,n,i,r){const s=null==t?void 0:t.labelAngle;if(void 0!==s)return XW(s)?s:CP(s);{const{configValue:s}=gJ("labelAngle",e.config,null==t?void 0:t.style,r);return void 0!==s?CP(s):n===fj&&JL([gV,pV],i.type)?270:void 0}}(t,s,e,o,h),m={fieldOrDatumDef:o,axis:s,channel:e,model:t,scaleType:d,orient:c,labelAngle:p,mark:u,config:l};for(const n of o0){const i=n in yJ?yJ[n](m):$P(n)?s[n]:void 0,r=void 0!==i,o=h0(i,n,s,t,e);if(r&&o)a.set(n,i,o);else{const{configValue:e,configFrom:u}=$P(n)&&"values"!==n?gJ(n,t.config,s.style,h):{},l=void 0!==e;r&&!l?a.set(n,i,o):("vgAxisConfig"!==u||f0.has(n)&&l||_P(e)||XW(e))&&a.set(n,e,!1)}}const g=null!==(r=s.encoding)&&void 0!==r?r:{},y=EP.reduce(((n,i)=>{var r;if(!a.hasAxisPart(i))return n;const s=VJ(null!==(r=g[i])&&void 0!==r?r:{},t),o="labels"===i?function(e,t,n){var i;const{encoding:r,config:s}=e,a=null!==(i=tG(r[t]))&&void 0!==i?i:tG(r[fU(t)]),o=e.axis(t)||{},{format:u,formatType:l}=o;return sq(l)?Object.assign({text:lq({fieldOrDatumDef:a,field:"datum.value",format:u,formatType:l,config:s})},n):n}(t,e,s):s;return void 0===o||sP(o)||(n[i]={update:o}),n}),{});return sP(y)||a.set("encode",y,!!s.encoding||void 0!==s.labelAngle),a}function m0(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},rY(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),qX("x",e,{defaultPos:"mid"})),qX("y",e,{defaultPos:"mid"})),UX("size",e)),UX("angle",e)),function(e,t,n){return n?{shape:{value:n}}:UX("shape",e)}(e,0,t))}function g0(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,s="horizontal"===r?"width":"height",a=e.getScaleComponent("horizontal"===r?"x":"y"),o=null!==(t=yG("size",i,n,{vgChannel:s}))&&void 0!==t?t:n.tick.bandSize;if(void 0!==o)return o;{const e=a?a.get("range"):void 0;return e&&YW(e)&&FL(e.step)?3*e.step/4:3*gH(n.view,s)/4}}const y0={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},rY(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),qX("x",e,{defaultPos:"mid"})),qX("y",e,{defaultPos:"mid"})),QX(e,"radius","arc")),QX(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},rY(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),KX("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),KX("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),aY(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},rY(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),QX(e,"x","bar")),QX(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>m0(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},rY(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&Nq(n)&&n.type===yV?{field:Vq(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},rY(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),QX(e,"x","image")),QX(e,"y","image")),BX(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},rY(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),qX("x",e,{defaultPos:"mid"})),qX("y",e,{defaultPos:"mid"})),UX("size",e,{vgChannel:"strokeWidth"})),aY(e))},point:{vgMark:"symbol",encodeEntry:e=>m0(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},rY(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),QX(e,"x","rect")),QX(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},rY(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),KX("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),KX("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),UX("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>m0(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},rY(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),qX("x",e,{defaultPos:"mid"})),qX("y",e,{defaultPos:"mid"})),BX(e)),UX("size",e,{vgChannel:"fontSize"})),UX("angle",e)),oY("align",function(e,t,n){if(void 0===yG("align",e,n))return"center"}(e.markDef,0,t))),oY("baseline",function(e,t,n){if(void 0===yG("baseline",e,n))return"middle"}(e.markDef,0,t))),qX("radius",e,{defaultPos:null,isMidPoint:!0})),qX("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r="horizontal"===i?"width":"height",s="horizontal"===i?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},rY(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),qX("x",e,{defaultPos:"mid",vgChannel:"xc"})),qX("y",e,{defaultPos:"mid",vgChannel:"yc"})),UX("size",e,{defaultValue:g0(e),vgChannel:r})),{[s]:fG(yG("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},rY(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),qX("x",e,{defaultPos:"mid"})),qX("y",e,{defaultPos:"mid"})),UX("size",e)),aY(e))}};const v0="faceted_path_",b0="stack_group_";function x0(e,t={fromPrefix:""}){const{mark:n,markDef:i,config:r}=e,s=xP(i.clip,function(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(e),function(e){const t=e.component.projection;return!(!t||t.isFit)||void 0}(e)),a=gG(i),o=e.encoding.key,u=function(e){const{encoding:t,stack:n,mark:i,markDef:r,config:s}=e,a=t.order;if(!(!vL(a)&&Lq(a)&&KL(a.value)||!a&&KL(yG("order",r,s)))){if((vL(a)||Nq(a))&&!n)return wG(a,{expr:"datum"});if(GP(i)){const n="horizontal"===r.orient?"y":"x",i=t[n];if(Nq(i)){const t=i.sort;return vL(t)?{field:Vq(i,{prefix:n,suffix:"sort_index",expr:"datum"})}:xq(t)?{field:Vq({aggregate:EG(e.encoding)?t.op:void 0,field:t.field},{expr:"datum"})}:bq(t)?{field:Vq(e.fieldDef(t.encoding),{expr:"datum"}),order:t.order}:null===t?void 0:{field:Vq(i,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),l=function(e){if(!e.component.selection)return null;const t=aP(e.component.selection).length;let n=t,i=e.parent;for(;i&&0===n;)n=aP(i.component.selection).length,i=i.parent;return n?{interactive:t>0}:null}(e),c=yG("aria",i,r),d=y0[n].postEncodingTransform?y0[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:y0[n].vgMark},s?{clip:!0}:{}),a?{style:a}:{}),o?{key:o.field}:{}),u?{sort:u}:{}),l||{}),!1===c?{aria:c}:{}),{from:{data:t.fromPrefix+e.requestDataName(gX)},encode:{update:y0[n].encodeEntry(e)}}),d?{transform:d}:{})]}class w0 extends IQ{constructor(e,t,n,i={},r){var s,a;super(e,"unit",t,n,r,void 0,fH(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const o=YP(e.mark)?e.mark.type:e.mark;this.markDef=function(e,t,n,{graticule:i}){const r=YP(e)?Object.assign({},e):{type:e},s=yG("orient",r,n);if(r.orient=function(e,t,n){switch(e){case BP:case WP:case VP:case PP:case zP:case RP:return}const{x:i,y:r,x2:s,y2:a}=t;switch(e){case TP:if(Nq(i)&&(eW(i.bin)||Nq(r)&&r.aggregate&&!i.aggregate))return"vertical";if(Nq(r)&&(eW(r.bin)||Nq(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(a||s){if(n)return n;if(!s&&(Nq(i)&&i.type===fV&&!QU(i.bin)||Mq(i)))return"horizontal";if(!a&&(Nq(r)&&r.type===fV&&!QU(r.bin)||Mq(r)))return"vertical"}case LP:if(s&&(!Nq(i)||!eW(i.bin))&&a&&(!Nq(r)||!eW(r.bin)))return;case IP:if(a)return Nq(r)&&eW(r.bin)?"horizontal":"vertical";if(s)return Nq(i)&&eW(i.bin)?"vertical":"horizontal";if(e===LP){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case MP:case jP:{const t=Rq(i),s=Rq(r);if(t&&!s)return"tick"!==e?"horizontal":"vertical";if(!t&&s)return"tick"!==e?"vertical":"horizontal";if(t&&s){const t=i,s=r,a=t.type===mV,o=s.type===mV;return a&&!o?"tick"!==e?"vertical":"horizontal":!a&&o?"tick"!==e?"horizontal":"vertical":!t.aggregate&&s.aggregate?"tick"!==e?"vertical":"horizontal":t.aggregate&&!s.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(r.type,t,s),void 0!==s&&s!==r.orient&&NW(`Specified orient "${r.orient}" overridden with "${s}".`),"bar"===r.type&&r.orient){const e=yG("cornerRadiusEnd",r,n);if(void 0!==e){const n="horizontal"===r.orient&&t.x2||"vertical"===r.orient&&t.y2?["cornerRadius"]:ZP[r.orient];for(const t of n)r[t]=e;void 0!==r.cornerRadiusEnd&&delete r.cornerRadiusEnd}}return void 0===yG("opacity",r,n)&&(r.opacity=function(e,t){if(JL([BP,jP,WP,VP],e)&&!EG(t))return.7}(r.type,t)),void 0===r.filled&&(r.filled=!i&&function(e,t){const n=vG("filled",e,t),i=e.type;return xP(n,i!==BP&&i!==MP&&i!==LP)}(r,n)),void 0===yG("cursor",r,n)&&(r.cursor=function(e,t,n){return t.href||e.href||yG("href",e,n)?"pointer":e.cursor}(r,t,n)),r}(e.mark,null!==(s=e.encoding)&&void 0!==s?s:{},r,{graticule:e.data&&mX(e.data)});const u=this.encoding=FG(null!==(a=e.encoding)&&void 0!==a?a:{},this.markDef,r);this.size=function({encoding:e,size:t}){for(const n of $U){const i=pU(n);hH(t[i])&&Rq(e[n])&&(delete t[i],NW(AW(i)))}return t}({encoding:u,size:fH(e)?Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):i}),this.stack=TH(o,u),this.specifiedScales=this.initScales(o,u),this.specifiedAxes=this.initAxes(u),this.specifiedLegends=this.initLegend(u),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===qP,n=e&&Hj.some((t=>Bq(e[t])));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return GU.reduce(((e,n)=>{var i;const r=tG(t[n]);return r&&(e[n]=null!==(i=r.scale)&&void 0!==i?i:{}),e}),{})}initAxes(e){return $U.reduce(((t,n)=>{const i=e[n];if(Bq(i)||n===fj&&Bq(e.x2)||n===pj&&Bq(e.y2)){const e=Bq(i)?i.axis:void 0;t[n]=e?Object.assign({},e):e}return t}),{})}initLegend(e){return VU.reduce(((t,n)=>{const i=tG(e[n]);if(i&&function(e){switch(e){case _j:case Ej:case Sj:case Dj:case Fj:case Oj:case Tj:case Rj:return!0;case Nj:case Ij:case $j:return!1}}(n)){const e=i.legend;t[n]=e?Object.assign({},e):e}return t}),{})}parseData(){this.component.data=r0(this)}parseLayoutSize(){!function(e){const{size:t,component:n}=e;for(const i of $U){const r=pU(i);if(t[r]){const e=t[r];n.layoutSize.set(r,hH(e)?"step":e,!0)}else{const t=e0(e,r);n.layoutSize.set(r,t,!1)}}}(this)}parseSelections(){this.component.selection=function(e,t){var n;const i={},r=e.config.selection;for(const s of aP(null!=t?t:{})){const a=qL(t[s]),o=r[a.type],{fields:u,encodings:l}=o,c=NL(o,["fields","encodings"]);for(const e in c)"encodings"===e&&a.fields||"fields"===e&&a.encodings||("mark"===e&&(a[e]=Object.assign(Object.assign({},c[e]),a[e])),void 0!==a[e]&&!0!==a[e]||(a[e]=null!==(n=c[e])&&void 0!==n?n:a[e]));const d=cP(s),h=i[d]=Object.assign(Object.assign({},a),{name:d,events:DL(a.on)?rL(a.on,"scope"):qL(a.on)});OY(h,(n=>{n.has(h)&&n.parse&&n.parse(e,h,a,t[s])}))}return i}(this,this.selection)}parseMarkGroup(){var e;this.component.mark=JL([MP,IP,UP],(e=this).mark)?function(e){const t=NG(e.mark,e.encoding),n=x0(e,{fromPrefix:t.length>0?v0:""});return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:v0+e.requestDataName(gX),data:e.requestDataName(gX),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}(e):JL([TP],e.mark)?function(e){const t=QW.some((t=>yG(t,e.markDef,e.config)));if(e.stack&&!e.fieldDef("size")&&t){const[t]=x0(e,{fromPrefix:b0}),n=e.scaleName(e.stack.fieldChannel),i=(t={})=>e.vgField(e.stack.fieldChannel,t),r=(e,t)=>`${e}(${[i({prefix:"min",suffix:"start",expr:t}),i({prefix:"max",suffix:"start",expr:t}),i({prefix:"min",suffix:"end",expr:t}),i({prefix:"max",suffix:"end",expr:t})].map((e=>`scale('${n}',${e})`)).join(",")})`;let s,a;"x"===e.stack.fieldChannel?(s=Object.assign(Object.assign({},GL(t.encode.update,["y","yc","y2","height",...QW])),{x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}}),a={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},HL(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(s=Object.assign(Object.assign({},GL(t.encode.update,["x","xc","x2","width"])),{y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}}),a={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},HL(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const n of QW){const i=vG(n,e.markDef,e.config);t.encode.update[n]?(s[n]=t.encode.update[n],delete t.encode.update[n]):i&&(s[n]=fG(i)),i&&(t.encode.update[n]={value:0})}const o=e.fieldDef(e.stack.groupbyChannel),u=Vq(o)?[Vq(o)]:[];return((null==o?void 0:o.bin)||(null==o?void 0:o.timeUnit))&&u.push(Vq(o,{binSuffix:"end"})),s=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce(((n,i)=>{if(t.encode.update[i])return Object.assign(Object.assign({},n),{[i]:t.encode.update[i]});{const t=vG(i,e.markDef,e.config);return void 0!==t?Object.assign(Object.assign({},n),{[i]:fG(t)}):n}}),s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(gX),name:b0+e.requestDataName(gX),groupby:u,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:a},marks:[t]}]}]}return x0(e)}(e):x0(e)}parseAxesAndHeaders(){var e;this.component.axes=(e=this,$U.reduce(((t,n)=>(e.component.scales[n]&&(t[n]=[p0(n,e)]),t)),{}))}assembleSelectionTopLevelSignals(e){return function(e,t){let n=!1;return GY(e,((i,r)=>{const s=i.name,a=$L(s+UY);if(0===t.filter((e=>e.name===s)).length){const e="global"===i.resolve?"union":i.resolve,n="multi"===i.type?", true)":")";t.push({name:i.name,update:`${VY}(${a}, ${$L(e)}${n}`})}n=!0,r.topLevelSignals&&(t=r.topLevelSignals(e,i,t)),OY(i,(n=>{n.topLevelSignals&&(t=n.topLevelSignals(e,i,t))}))})),n&&0===t.filter((e=>"unit"===e.name)).length&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),TY(t)}(this,e)}assembleSignals(){return[...lJ(this),...(e=this,t=[],GY(e,((n,i)=>{const r=n.name;let s=i.modifyExpr(e,n);t.push(...i.signals(e,n)),OY(n,(i=>{i.signals&&(t=i.signals(e,n,t)),i.modifyExpr&&(s=i.modifyExpr(e,n,s))})),t.push({name:r+"_modify",on:[{events:{signal:n.name+WY},update:`modify(${$L(n.name+UY)}, ${s})`}]})})),TY(t))];var e,t}assembleSelectionData(e){return function(e,t){const n=[...t];return GY(e,(t=>{const i={name:t.name+UY};if(t.init){const n=t.project.items.map((e=>{const{signals:t}=e;return NL(e,["signals"])})),r=t.init.map((e=>NY(e,!1)));i.values="interval"===t.type?[{unit:HY(e,{escape:!1}),fields:n,values:r}]:r.map((t=>({unit:HY(e,{escape:!1}),fields:n,values:t})))}n.filter((e=>e.name===t.name+UY)).length||n.push(i)})),n}(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return LJ(this)}assembleMarks(){var e;let t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&OQ(this.parent)||(t=IY(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return _G(this.encoding,e)}fieldDef(e){return eG(this.encoding[e])}typedFieldDef(e){const t=this.fieldDef(e);return zq(t)?t:null}}class C0 extends NQ{constructor(e,t,n,i,r){super(e,"layer",t,n,r,e.resolve,e.view);const s=Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map(((e,t)=>{if(FH(e))return new C0(e,this,this.getName("layer_"+t),s,r);if(QP(e))return new w0(e,this,this.getName("layer_"+t),s,r);throw new Error(rW(e))}))}parseData(){this.component.data=r0(this);for(const e of this.children)e.parseData()}parseLayoutSize(){ZQ(this),QQ(this,"width"),QQ(this,"height")}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of aP(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){!function(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const t of e.children){t.parseAxesAndHeaders();for(const r of aP(t.component.axes))i.axis[r]=GJ(e.component.resolve,r),"shared"===i.axis[r]&&(n[r]=c0(n[r],t.component.axes[r]),n[r]||(i.axis[r]="independent",delete n[r]))}for(const s of $U){for(const a of e.children)if(a.component.axes[s]){if("independent"===i.axis[s]){n[s]=(null!==(t=n[s])&&void 0!==t?t:[]).concat(a.component.axes[s]);for(const e of a.component.axes[s]){const{value:t,explicit:n}=e.getWithExplicit("orient");if(!XW(t)){if(r[t]>0&&!n){const n=l0[t];r[t]>r[n]&&e.set("orient",n,!1)}r[t]++}}}delete a.component.axes[s]}if("independent"===i.axis[s]&&n[s]&&n[s].length>1)for(const e of n[s])e.get("grid")&&!e.explicit.grid&&(e.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleSignals())),lJ(this))}assembleLayoutSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleLayoutSignals())),LJ(this))}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return function(e,t){for(const n of e.children)FQ(n)&&(t=IY(n,t));return t}(this,this.children.flatMap((e=>e.assembleMarks())))}assembleLegends(){return this.children.reduce(((e,t)=>e.concat(t.assembleLegends())),lZ(this))}}function k0(e,t,n,i,r){if(Aq(e))return new n0(e,t,n,r);if(FH(e))return new C0(e,t,n,i,r);if(QP(e))return new w0(e,t,n,i,r);if(function(e){return cH(e)||dH(e)||lH(e)}(e))return new s0(e,t,n,r);throw new Error(rW(e))}function A0(e,t={}){var n;t.logger&&(n=t.logger,OW=n),t.fieldTitle&&Yq(t.fieldTitle);try{const n=kH(wL(t.config,e.config)),i=JH(e,n),r=k0(i,null,"",void 0,n);return r.parse(),function(e,t){bZ(e.sources);let n=0,i=0;for(let i=0;i<5&&ZZ(e,t);i++)n++;e.sources.map(PZ);for(let n=0;n<5&&ZZ(e,t);n++)i++;bZ(e.sources),5===Math.max(n,i)&&NW("Maximum optimization runs(5) reached.")}(r.component.data,r),{spec:function(e,t,n={},i){const r=e.config?function(e){e=qL(e);for(const t of _H)delete e[t];if(e.axis)for(const t in e.axis)_P(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of tH)delete e.legend[t];if(e.mark){for(const t of JP)delete e.mark[t];e.mark.tooltip&&bL(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of AH){for(const n of JP)delete e[t][n];const n=EH[t];if(n)for(const i of n)delete e[t][i];SH(e,t)}for(const t of aP(QG))delete e[t];!function(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=dG(e.title);sP(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),sP(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),sP(i)?delete e.title:e.title=i}(e);for(const t in e)bL(e[t])&&sP(e[t])&&delete e[t];return sP(e)?void 0:e}(e.config):void 0,s=[].concat(e.assembleSelectionData([]),function(e,t){var n,i;const r=[],s=HQ(r);let a=0;for(const t of e.sources){t.hasName()||(t.dataName="source_"+a++);const e=t.assemble();s(t,e)}for(const e of r)0===e.transform.length&&delete e.transform;let o=0;for(const[e,t]of r.entries())0!==(null!==(n=t.transform)&&void 0!==n?n:[]).length||t.source||r.splice(o++,0,r.splice(e,1)[0]);for(const t of r)for(const n of null!==(i=t.transform)&&void 0!==i?i:[])"lookup"===n.type&&(n.from=e.outputNodes[n.from].getSource());for(const e of r)e.name in t&&(e.values=t[e.name]);return r}(e.component.data,n)),a=e.assembleProjections(),o=e.assembleTitle(),u=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();return c=c.filter((e=>"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1))),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),o?{title:o}:{}),u?{style:u}:{}),l?{encode:{update:l}}:{}),{data:s}),a.length>0?{projections:a}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([])])),r?{config:r}:{}),i?{usermeta:i}:{})}(r,function(e,t,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(void 0===t?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):DL(t)&&(t={type:t}),r&&s&&("fit"===(a=t.type)||"fit-x"===a||"fit-y"===a))if("step"===r&&"step"===s)NW(oW()),t.type="pad";else if("step"===r||"step"===s){const e="step"===r?"width":"height";NW(oW(TU(e)));const n="width"===e?"height":"width";t.type=function(e){return e?`fit-${TU(e)}`:"fit"}(n)}var a;return Object.assign(Object.assign(Object.assign({},1===aP(t).length&&t.type?"pad"===t.type?{}:{autosize:t.type}:{autosize:t}),tX(n)),tX(e))}(e,i.autosize,n,r),e.datasets,e.usermeta),normalized:i}}finally{t.logger&&(OW=DW),t.fieldTitle&&Yq(Hq)}}const _0=new class extends DH{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:i}=e,{bins:r,timeUnits:s,aggregate:a,groupby:o,encoding:u}=SG(n,t),l=[...i||[],...r,...s,...0===a.length?[]:[{aggregate:a,groupby:o}]];return Object.assign(Object.assign(Object.assign({},e),l.length>0?{transform:l}:{}),{encoding:u})}return e}};function E0(e,t){return _0.map(e,{config:t})}const S0="4.13.1",F0=function(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}},D0="#fff",$0={background:"#333",title:{color:D0,subtitleColor:D0},style:{"guide-label":{fill:D0},"guide-title":{fill:D0}},axis:{domainColor:D0,gridColor:"#888",tickColor:D0}},O0="#4572a7",N0={background:"#fff",arc:{fill:O0},area:{fill:O0},line:{stroke:O0,strokeWidth:2},path:{stroke:O0},rect:{fill:O0},shape:{stroke:O0},symbol:{fill:O0,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},I0="#30a2da",T0="#cbcbcb",R0="#f0f0f0",M0="#333",B0={arc:{fill:I0},area:{fill:I0},axis:{domainColor:T0,grid:!0,gridColor:T0,gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:T0,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:R0,group:{fill:R0},legend:{labelColor:M0,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:M0,titleFontSize:14,titlePadding:10},line:{stroke:I0,strokeWidth:2},path:{stroke:I0,strokeWidth:.5},rect:{fill:I0},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:I0},bar:{binSpacing:2,fill:I0,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},z0="#000",L0={group:{fill:"#e5e5e5"},arc:{fill:z0},area:{fill:z0},line:{stroke:z0},path:{stroke:z0},rect:{fill:z0},shape:{stroke:z0},symbol:{fill:z0,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},P0="Benton Gothic, sans-serif",j0="#82c6df",U0="Benton Gothic Bold, sans-serif",W0="normal",V0={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},q0={background:"#ffffff",title:{anchor:"start",color:"#000000",font:U0,fontSize:22,fontWeight:"normal"},arc:{fill:j0},area:{fill:j0},line:{stroke:j0,strokeWidth:2},path:{stroke:j0},rect:{fill:j0},shape:{stroke:j0},symbol:{fill:j0,size:30},axis:{labelFont:P0,labelFontSize:11.5,labelFontWeight:"normal",titleFont:U0,titleFontSize:13,titleFontWeight:W0},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:P0,labelFontSize:11.5,symbolType:"square",titleFont:U0,titleFontSize:13,titleFontWeight:W0},range:{category:V0["category-6"],diverging:V0["fireandice-6"],heatmap:V0["fire-7"],ordinal:V0["fire-7"],ramp:V0["fire-7"]}},G0="#ab5787",H0="#979797",X0={background:"#f9f9f9",arc:{fill:G0},area:{fill:G0},line:{stroke:G0},path:{stroke:G0},rect:{fill:G0},shape:{stroke:G0},symbol:{fill:G0,size:30},axis:{domainColor:H0,domainWidth:.5,gridWidth:.2,labelColor:H0,tickColor:H0,tickWidth:.2,titleColor:H0},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},Y0="#3e5c69",K0={background:"#fff",arc:{fill:Y0},area:{fill:Y0},line:{stroke:Y0},path:{stroke:Y0},rect:{fill:Y0},shape:{stroke:Y0},symbol:{fill:Y0},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},J0="#1696d2",Z0="#000000",Q0="Lato",e1="Lato",t1={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},n1={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:Q0},axisX:{domain:!0,domainColor:Z0,domainWidth:1,grid:!1,labelFontSize:12,labelFont:e1,labelAngle:0,tickColor:Z0,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:Q0},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:e1,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:Q0,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:e1,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:Q0,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:t1["six-groups-cat-1"],diverging:t1["diverging-colors"],heatmap:t1["diverging-colors"],ordinal:t1["six-groups-seq"],ramp:t1["shades-blue"]},area:{fill:J0},rect:{fill:J0},line:{color:J0,stroke:J0,strokeWidth:5},trail:{color:J0,stroke:J0,strokeWidth:0,size:1},path:{stroke:J0,strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:J0,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:J0,stroke:null}},arc:{fill:J0},shape:{stroke:J0},symbol:{fill:J0,size:30}},i1="#3366CC",r1="#ccc",s1="Arial, sans-serif",a1={arc:{fill:i1},area:{fill:i1},path:{stroke:i1},rect:{fill:i1},shape:{stroke:i1},symbol:{stroke:i1},circle:{fill:i1},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:s1,fontSize:12},"guide-title":{font:s1,fontSize:12},"group-title":{font:s1,fontSize:12}},title:{font:s1,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:r1,tickColor:r1,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},o1="2.10.0";const u1="vg-tooltip-element",l1={offsetX:10,offsetY:10,id:u1,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function c1(e,t){return JSON.stringify(e,function(e){const t=[];return function(n,i){if("object"!=typeof i||null===i)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}(t))}class d1{constructor(e){this.options=Object.assign(Object.assign({},l1),e);const t=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const e=document.createElement("style");e.setAttribute("id",this.options.styleId),e.innerHTML=function(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return"#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n".toString().replace(u1,e)}(t);const n=document.head;n.childNodes.length>0?n.insertBefore(e,n.childNodes[0]):n.appendChild(e)}}tooltipHandler(e,t,n,i){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(null!=document.fullscreenElement?document.fullscreenElement:document.body).appendChild(this.el),null==i||""===i)return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=function(e,t,n){if(Jt(e))return`[${e.map((e=>t(Rn(e)?e:c1(e,n)))).join(", ")}]`;if(Zt(e)){let i="";const r=e,{title:s,image:a}=r,o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(r,["title","image"]);s&&(i+=`<h2>${t(s)}</h2>`),a&&(i+=`<img src="${t(a)}">`);const u=Object.keys(o);if(u.length>0){i+="<table>";for(const e of u){let r=o[e];void 0!==r&&(Zt(r)&&(r=c1(r,n)),i+=`<tr><td class="key">${t(e)}:</td><td class="value">${t(r)}</td></tr>`)}i+="</table>"}return i||"{}"}return t(e)}(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:r,y:s}=function(e,t,n,i){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let s=e.clientY+i;return s+t.height>window.innerHeight&&(s=+e.clientY-i-t.height),{x:r,y:s}}(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${s}px; left: ${r}px`)}}function h1(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(e){s(e)}}function o(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,o)}u((i=i.apply(e,t||[])).next())}))}var f1;function p1(e,...t){for(const n of t)m1(e,n);return e}function m1(e,t){for(const n of Object.keys(t))Ee(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const g1=y;let y1=v;const v1="undefined"!=typeof window?window:void 0;void 0===y1&&(null===(f1=null==v1?void 0:v1.vl)||void 0===f1?void 0:f1.compile)&&(y1=v1.vl);const b1={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},x1={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},w1={vega:"Vega","vega-lite":"Vega-Lite"},C1={vega:g1.version,"vega-lite":y1?y1.version:"not available"},k1={vega:e=>e,"vega-lite":(e,t)=>y1.compile(e,{config:t}).spec};function A1(e,t,n,i){const r=`<html><head>${t}</head><body><pre><code class="json">`,s=`</code></pre>${n}</body></html>`,a=window.open("");a.document.write(r+e+s),a.document.title=`${w1[i]} JSON Source`}function _1(e,t){var n;if(e.$schema){const i=F0(e.$schema);t&&t!==i.library&&console.warn(`The given visualization spec is written in ${w1[i.library]}, but mode argument sets ${null!==(n=w1[t])&&void 0!==n?n:t}.`);const r=i.library;return(0,Q.satisfies)(C1[r],`^${i.version.slice(1)}`)||console.warn(`The input spec uses ${w1[r]} ${i.version}, but the current version of ${w1[r]} is v${C1[r]}.`),r}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":null!=t?t:"vega"}function E1(e){return(t=e)&&"load"in t?e:g1.loader(e);var t}function S1(e){var t;return null!==(t=e.usermeta&&e.usermeta.embedOptions)&&void 0!==t?t:{}}function F1(e,t){var n;return h1(this,void 0,void 0,(function*(){const i=vt(e.config)?JSON.parse(yield t.load(e.config)):null!==(n=e.config)&&void 0!==n?n:{},r=vt(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),r?{patch:r}:{}),i?{config:i}:{})}))}const D1=function(e,t,n={}){var i,r,s;return h1(this,void 0,void 0,(function*(){let a,o;vt(t)?(o=E1(n.loader),a=JSON.parse(yield o.load(t))):a=t;const u=S1(a).loader;o&&!u||(o=E1(null!==(i=n.loader)&&void 0!==i?i:u));const l=yield F1(S1(a),o),c=yield F1(n,o),d=Object.assign(Object.assign({},p1(c,l)),{config:_e(null!==(r=c.config)&&void 0!==r?r:{},null!==(s=l.config)&&void 0!==s?s:{})});return yield function(e,t,n={},i){var r,s,a,o,u,l;return h1(this,void 0,void 0,(function*(){const c=n.theme?_e(b[n.theme],null!==(r=n.config)&&void 0!==r?r:{}):n.config,d=ft(n.actions)?n.actions:p1({},b1,null!==(s=n.actions)&&void 0!==s?s:{}),h=Object.assign(Object.assign({},x1),n.i18n),f=null!==(a=n.renderer)&&void 0!==a?a:"canvas",p=null!==(o=n.logLevel)&&void 0!==o?o:g1.Warn,m=null!==(u=n.downloadFileName)&&void 0!==u?u:"visualization",g="string"==typeof e?document.querySelector(e):e;if(!g)throw new Error(`${e} does not exist`);if(!1!==n.defaultStyle){const e="vega-embed-style",{root:t,rootContainer:i}=function(e){var t;const n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(t=document.head)&&void 0!==t?t:document.body}}(g);if(!t.getElementById(e)){const t=document.createElement("style");t.id=e,t.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?'.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper {\n    width: 100%;\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n'.toString():n.defaultStyle,i.appendChild(t)}}const y=_1(t,n.mode);let v=k1[y](t,c);if("vega-lite"===y&&v.$schema){const e=F0(v.$schema);(0,Q.satisfies)(C1.vega,`^${e.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${e.version}, but current version is v${C1.vega}.`)}g.classList.add("vega-embed"),d&&g.classList.add("has-actions"),g.innerHTML="";let x=g;if(d){const e=document.createElement("div");e.classList.add("chart-wrapper"),g.appendChild(e),x=e}const w=n.patch;w&&(v=w instanceof Function?w(v):z(v,w,!0,!1).newDocument),n.formatLocale&&g1.formatLocale(n.formatLocale),n.timeFormatLocale&&g1.timeFormatLocale(n.timeFormatLocale);const{ast:C}=n,k=g1.parse(v,"vega-lite"===y?{}:c,{ast:C}),A=new(n.viewClass||g1.View)(k,Object.assign({loader:i,logLevel:p,renderer:f},C?{expr:g1.expressionInterpreter}:{}));if(!1!==n.tooltip){let e;e="function"==typeof n.tooltip?n.tooltip:new d1(!0===n.tooltip?{}:n.tooltip).call,A.tooltip(e)}let _,{hover:E}=n;if(void 0===E&&(E="vega"===y),E){const{hoverSet:e,updateSet:t}="boolean"==typeof E?{}:E;A.hover(e,t)}if(n&&(null!=n.width&&A.width(n.width),null!=n.height&&A.height(n.height),null!=n.padding&&A.padding(n.padding)),yield A.initialize(x,n.bind).runAsync(),!1!==d){let e=g;if(!1!==n.defaultStyle){const t=document.createElement("details");t.title=h.CLICK_TO_VIEW_ACTIONS,g.append(t),e=t;const n=document.createElement("summary");n.innerHTML='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',t.append(n),_=e=>{t.contains(e.target)||t.removeAttribute("open")},document.addEventListener("click",_)}const i=document.createElement("div");if(e.append(i),i.classList.add("vega-actions"),!0===d||!1!==d.export)for(const e of["svg","png"])if(!0===d||!0===d.export||d.export[e]){const t=h[`${e.toUpperCase()}_ACTION`],r=document.createElement("a");r.text=t,r.href="#",r.target="_blank",r.download=`${m}.${e}`,r.addEventListener("mousedown",(function(t){return h1(this,void 0,void 0,(function*(){t.preventDefault();const i=yield A.toImageURL(e,n.scaleFactor);this.href=i}))})),i.append(r)}if(!0===d||!1!==d.source){const e=document.createElement("a");e.text=h.SOURCE_ACTION,e.href="#",e.addEventListener("click",(function(e){var i,r;A1(Z()(t),null!==(i=n.sourceHeader)&&void 0!==i?i:"",null!==(r=n.sourceFooter)&&void 0!==r?r:"",y),e.preventDefault()})),i.append(e)}if("vega-lite"===y&&(!0===d||!1!==d.compiled)){const e=document.createElement("a");e.text=h.COMPILED_ACTION,e.href="#",e.addEventListener("click",(function(e){var t,i;A1(Z()(v),null!==(t=n.sourceHeader)&&void 0!==t?t:"",null!==(i=n.sourceFooter)&&void 0!==i?i:"","vega"),e.preventDefault()})),i.append(e)}if(!0===d||!1!==d.editor){const e=null!==(l=n.editorUrl)&&void 0!==l?l:"https://vega.github.io/editor/",r=document.createElement("a");r.text=h.EDITOR_ACTION,r.href="#",r.addEventListener("click",(function(n){!function(e,t,n){const i=e.open(t),{origin:r}=new URL(t);let s=40;e.addEventListener("message",(function t(n){n.source===i&&(s=0,e.removeEventListener("message",t,!1))}),!1),setTimeout((function e(){s<=0||(i.postMessage(n,r),setTimeout(e,250),s-=1)}),250)}(window,e,{config:c,mode:y,renderer:f,spec:Z()(t)}),n.preventDefault()})),i.append(r)}}return{view:A,spec:t,vgSpec:v,finalize:function(){_&&document.removeEventListener("click",_),A.finalize()}}}))}(e,a,d,o)}))}},4206:e=>{"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},8006:(e,t,n)=>{"use strict";function i(e){var t=this;if(t instanceof i||(t=new i),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);return t}function r(e,t,n){var i=t===e.head?new o(n,null,t,e):new o(n,t,t.next,e);return null===i.next&&(e.tail=i),null===i.prev&&(e.head=i),e.length++,i}function s(e,t){e.tail=new o(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function a(e,t){e.head=new o(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function o(e,t,n,i){if(!(this instanceof o))return new o(e,t,n,i);this.list=i,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}e.exports=i,i.Node=o,i.create=i,i.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},i.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},i.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},i.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)s(this,arguments[e]);return this.length},i.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)a(this,arguments[e]);return this.length},i.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},i.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},i.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,i=0;null!==n;i++)e.call(t,n.value,i,this),n=n.next},i.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,i=this.length-1;null!==n;i--)e.call(t,n.value,i,this),n=n.prev},i.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},i.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},i.prototype.map=function(e,t){t=t||this;for(var n=new i,r=this.head;null!==r;)n.push(e.call(t,r.value,this)),r=r.next;return n},i.prototype.mapReverse=function(e,t){t=t||this;for(var n=new i,r=this.tail;null!==r;)n.push(e.call(t,r.value,this)),r=r.prev;return n},i.prototype.reduce=function(e,t){var n,i=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");i=this.head.next,n=this.head.value}for(var r=0;null!==i;r++)n=e(n,i.value,r),i=i.next;return n},i.prototype.reduceReverse=function(e,t){var n,i=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");i=this.tail.prev,n=this.tail.value}for(var r=this.length-1;null!==i;r--)n=e(n,i.value,r),i=i.prev;return n},i.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},i.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},i.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new i;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=0,s=this.head;null!==s&&r<e;r++)s=s.next;for(;null!==s&&r<t;r++,s=s.next)n.push(s.value);return n},i.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new i;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=this.length,s=this.tail;null!==s&&r>t;r--)s=s.prev;for(;null!==s&&r>e;r--,s=s.prev)n.push(s.value);return n},i.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var i=0,s=this.head;null!==s&&i<e;i++)s=s.next;var a=[];for(i=0;s&&i<t;i++)a.push(s.value),s=this.removeNode(s);for(null===s&&(s=this.tail),s!==this.head&&s!==this.tail&&(s=s.prev),i=0;i<n.length;i++)s=r(this,s,n[i]);return a},i.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var i=n.prev;n.prev=n.next,n.next=i}return this.head=t,this.tail=e,this};try{n(4206)(i)}catch(e){}},6058:e=>{"use strict";var t=/("(?:[^\\"]|\\.)*")|[:,]/g;e.exports=function(e,n){var i,r,s;return n=n||{},i=JSON.stringify([1],void 0,void 0===n.indent?2:n.indent).slice(2,-3),r=""===i?1/0:void 0===n.maxLength?80:n.maxLength,s=n.replacer,function e(n,a,o){var u,l,c,d,h,f,p,m,g,y,v,b;if(n&&"function"==typeof n.toJSON&&(n=n.toJSON()),void 0===(v=JSON.stringify(n,s)))return v;if(p=r-a.length-o,v.length<=p&&(g=v.replace(t,(function(e,t){return t||e+" "}))).length<=p)return g;if(null!=s&&(n=JSON.parse(v),s=void 0),"object"==typeof n&&null!==n){if(m=a+i,c=[],l=0,Array.isArray(n))for(y="[",u="]",p=n.length;l<p;l++)c.push(e(n[l],m,l===p-1?0:1)||"null");else for(y="{",u="}",p=(f=Object.keys(n)).length;l<p;l++)d=f[l],h=JSON.stringify(d)+": ",void 0!==(b=e(n[d],m,h.length+(l===p-1?0:1)))&&c.push(h+b);if(c.length>0)return[y,i+c.join(",\n"+m),u].join("\n"+a)}return v}(e,"",0)}}}]);
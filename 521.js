/*! For license information please see 521.js.LICENSE.txt */
(self.webpackChunk_dev_web=self.webpackChunk_dev_web||[]).push([[521],{4815:(t,e,n)=>{"use strict";n.r(e);var i=n(6720),r=n(1313);(0,r.t3)().prototype.abs=function(){return this.throwIfDisposed(),(0,i.W)(this)};var s=n(8866);(0,r.t3)().prototype.acos=function(){return this.throwIfDisposed(),(0,s.K)(this)};var o=n(6039);(0,r.t3)().prototype.acosh=function(){return this.throwIfDisposed(),(0,o._)(this)};var a=n(7571);(0,r.t3)().prototype.add=function(t){return this.throwIfDisposed(),(0,a.I)(this,t)};var u=n(7590);(0,r.t3)().prototype.all=function(t,e){return this.throwIfDisposed(),(0,u.$)(this,t,e)};var l=n(6298);(0,r.t3)().prototype.any=function(t,e){return this.throwIfDisposed(),(0,l.Y)(this,t,e)};var c=n(1523);(0,r.t3)().prototype.argMax=function(t){return this.throwIfDisposed(),(0,c.N)(this,t)};var h=n(9542);(0,r.t3)().prototype.argMin=function(t){return this.throwIfDisposed(),(0,h.v)(this,t)};var f=n(2673),d=n(9740);(0,r.t3)().prototype.asScalar=function(){return this.throwIfDisposed(),(0,d.hu)(1===this.size,(()=>"The array must have only 1 element.")),(0,f.X)(this,[])};var p=n(5875);(0,r.t3)().prototype.asType=function(t){return this.throwIfDisposed(),(0,p.p)(this,t)},(0,r.t3)().prototype.as1D=function(){return this.throwIfDisposed(),(0,f.X)(this,[this.size])},(0,r.t3)().prototype.as2D=function(t,e){return this.throwIfDisposed(),(0,f.X)(this,[t,e])},(0,r.t3)().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),(0,f.X)(this,[t,e,n])},(0,r.t3)().prototype.as4D=function(t,e,n,i){return this.throwIfDisposed(),(0,f.X)(this,[t,e,n,i])},(0,r.t3)().prototype.as5D=function(t,e,n,i,r){return this.throwIfDisposed(),(0,f.X)(this,[t,e,n,i,r])};var g=n(5492);(0,r.t3)().prototype.asin=function(){return this.throwIfDisposed(),(0,g.Z)(this)};var m=n(3927);(0,r.t3)().prototype.asinh=function(){return this.throwIfDisposed(),(0,m.V)(this)};var y=n(2418);(0,r.t3)().prototype.atan=function(){return this.throwIfDisposed(),(0,y.z)(this)};var v=n(4002);(0,r.t3)().prototype.atan2=function(t){return this.throwIfDisposed(),(0,v.f)(this,t)};var b=n(5602);(0,r.t3)().prototype.atanh=function(){return this.throwIfDisposed(),(0,b.C)(this)};var x=n(9385);(0,r.t3)().prototype.avgPool=function(t,e,n,i){return this.throwIfDisposed(),(0,x.w)(this,t,e,n,i)};var w=n(1141);(0,r.t3)().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),(0,w.E)(this,t,e)};var A=n(8325);(0,r.t3)().prototype.batchNorm=function(t,e,n,i,r){return this.throwIfDisposed(),(0,A.t)(this,t,e,n,i,r)};var _=n(7933);(0,r.t3)().prototype.broadcastTo=function(t){return this.throwIfDisposed(),(0,_.U)(this,t)},(0,r.t3)().prototype.cast=function(t){return this.throwIfDisposed(),(0,p.p)(this,t)};var k=n(8498);(0,r.t3)().prototype.ceil=function(){return this.throwIfDisposed(),(0,k.m)(this)};var C=n(3092);(0,r.t3)().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),(0,C.i)(this,t,e)};var E=n(9134);(0,r.t3)().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof r.es&&(t=[t]),(0,E.z)([this,...t],e)};var D=n(6409);(0,r.t3)().prototype.conv1d=function(t,e,n,i,r,s){return this.throwIfDisposed(),(0,D.P)(this,t,e,n,i,r,s)};var F=n(7905);(0,r.t3)().prototype.conv2dTranspose=function(t,e,n,i,r){return this.throwIfDisposed(),(0,F.b)(this,t,e,n,i,r)};var S=n(9399);(0,r.t3)().prototype.conv2d=function(t,e,n,i,r,s){return this.throwIfDisposed(),(0,S.T)(this,t,e,n,i,r,s)};var O=n(7838);(0,r.t3)().prototype.cos=function(){return this.throwIfDisposed(),(0,O.m)(this)};var N=n(3159);(0,r.t3)().prototype.cosh=function(){return this.throwIfDisposed(),(0,N.f)(this)};var M=n(805);(0,r.t3)().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),(0,M.z)(this,t,e,n)};var z=n(8058);(0,r.t3)().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),(0,z.n)(this,t,e)};var $=n(6581);(0,r.t3)().prototype.depthwiseConv2d=function(t,e,n,i,r,s){return this.throwIfDisposed(),(0,$.B)(this,t,e,n,i,r,s)};var T=n(9605);(0,r.t3)().prototype.dilation2d=function(t,e,n,i,r){return this.throwIfDisposed(),(0,T.W)(this,t,e,n,i,r)};var B=n(2152);(0,r.t3)().prototype.divNoNan=function(t){return this.throwIfDisposed(),(0,B.N)(this,t)};var j=n(2639);(0,r.t3)().prototype.div=function(t){return this.throwIfDisposed(),(0,j.h)(this,t)};var I=n(7465);(0,r.t3)().prototype.dot=function(t){return this.throwIfDisposed(),(0,I.A)(this,t)};var R=n(9673);(0,r.t3)().prototype.elu=function(){return this.throwIfDisposed(),(0,R.p)(this)};var L=n(1966);(0,r.t3)().prototype.equal=function(t){return this.throwIfDisposed(),(0,L.D)(this,t)};var P=n(6352);(0,r.t3)().prototype.erf=function(){return this.throwIfDisposed(),(0,P.q)(this)};var U=n(8575);(0,r.t3)().prototype.exp=function(){return this.throwIfDisposed(),(0,U.Q)(this)};var q=n(1064);(0,r.t3)().prototype.expandDims=function(t){return this.throwIfDisposed(),(0,q.d)(this,t)};var W=n(177);(0,r.t3)().prototype.expm1=function(){return this.throwIfDisposed(),(0,W.t)(this)};var H=n(6991);(0,r.t3)().prototype.fft=function(){return this.throwIfDisposed(),(0,H.k)(this)},(0,r.t3)().prototype.flatten=function(){return this.throwIfDisposed(),(0,f.X)(this,[this.size])};var V=n(7184);(0,r.t3)().prototype.floor=function(){return this.throwIfDisposed(),(0,V.G)(this)};var G=n(6986);(0,r.t3)().prototype.floorDiv=function(t){return this.throwIfDisposed(),(0,G.q)(this,t)};var X=n(5262);(0,r.t3)().prototype.gather=function(t,e){return this.throwIfDisposed(),(0,X.I)(this,t,e)};var Y=n(6731);(0,r.t3)().prototype.greaterEqual=function(t){return this.throwIfDisposed(),(0,Y.b)(this,t)};var J=n(1694);(0,r.t3)().prototype.greater=function(t){return this.throwIfDisposed(),(0,J.p)(this,t)};var Z=n(8923);(0,r.t3)().prototype.ifft=function(){return this.throwIfDisposed(),(0,Z.S)(this)};var K=n(8117);(0,r.t3)().prototype.irfft=function(){return this.throwIfDisposed(),(0,K.w)(this)};var Q=n(8846);(0,r.t3)().prototype.isFinite=function(){return this.throwIfDisposed(),(0,Q.x)(this)};var tt=n(3556);(0,r.t3)().prototype.isInf=function(){return this.throwIfDisposed(),(0,tt.U)(this)};var et=n(1557);(0,r.t3)().prototype.isNaN=function(){return this.throwIfDisposed(),(0,et.i)(this)};var nt=n(7397);(0,r.t3)().prototype.leakyRelu=function(t){return this.throwIfDisposed(),(0,nt.h)(this,t)};var it=n(5573);(0,r.t3)().prototype.lessEqual=function(t){return this.throwIfDisposed(),(0,it.z)(this,t)};var rt=n(2359);(0,r.t3)().prototype.less=function(t){return this.throwIfDisposed(),(0,rt.d)(this,t)};var st=n(734);(0,r.t3)().prototype.localResponseNormalization=function(t,e,n,i){return this.throwIfDisposed(),(0,st.G)(this,t,e,n,i)};var ot=n(2959);(0,r.t3)().prototype.logSigmoid=function(){return this.throwIfDisposed(),(0,ot.e)(this)};var at=n(2929);(0,r.t3)().prototype.logSoftmax=function(t){return this.throwIfDisposed(),(0,at.C)(this,t)};var ut=n(2425);(0,r.t3)().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),(0,ut.l)(this,t,e)};var lt=n(3102);(0,r.t3)().prototype.log=function(){return this.throwIfDisposed(),(0,lt.c)(this)};var ct=n(6883);(0,r.t3)().prototype.log1p=function(){return this.throwIfDisposed(),(0,ct.K)(this)};var ht=n(495);(0,r.t3)().prototype.logicalAnd=function(t){return this.throwIfDisposed(),(0,ht.H)(this,t)};var ft=n(1917);(0,r.t3)().prototype.logicalNot=function(){return this.throwIfDisposed(),(0,ft.h)(this)};var dt=n(1634);(0,r.t3)().prototype.logicalOr=function(t){return this.throwIfDisposed(),(0,dt.K)(this,t)};var pt=n(7554);(0,r.t3)().prototype.logicalXor=function(t){return this.throwIfDisposed(),(0,pt.e)(this,t)};var gt=n(8249);(0,r.t3)().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),(0,gt.O)(this,t,e,n)};var mt=n(4433);(0,r.t3)().prototype.maxPool=function(t,e,n,i){return this.throwIfDisposed(),(0,mt._)(this,t,e,n,i)};var yt=n(4991);(0,r.t3)().prototype.max=function(t,e){return this.throwIfDisposed(),(0,yt.F)(this,t,e)};var vt=n(3171);(0,r.t3)().prototype.maximum=function(t){return this.throwIfDisposed(),(0,vt.g)(this,t)};var bt=n(4854);(0,r.t3)().prototype.mean=function(t,e){return this.throwIfDisposed(),(0,bt.J)(this,t,e)};var xt=n(6038);(0,r.t3)().prototype.min=function(t,e){return this.throwIfDisposed(),(0,xt.V)(this,t,e)};var wt=n(7511);(0,r.t3)().prototype.minimum=function(t){return this.throwIfDisposed(),(0,wt.L)(this,t)};var At=n(4267);(0,r.t3)().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),(0,At.V)(this,t,e)};var _t=n(5475);(0,r.t3)().prototype.mod=function(t){return this.throwIfDisposed(),(0,_t.w)(this,t)};var kt=n(2805);(0,r.t3)().prototype.mul=function(t){return this.throwIfDisposed(),(0,kt.d)(this,t)};var Ct=n(7211);(0,r.t3)().prototype.neg=function(){return this.throwIfDisposed(),(0,Ct.W)(this)};var Et=n(1458);(0,r.t3)().prototype.norm=function(t,e,n){return this.throwIfDisposed(),(0,Et.K)(this,t,e,n)};var Dt=n(1576);(0,r.t3)().prototype.notEqual=function(t){return this.throwIfDisposed(),(0,Dt.Q)(this,t)};var Ft=n(7910);(0,r.t3)().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),(0,Ft.l)(this,t,e,n)};var St=n(9622);(0,r.t3)().prototype.onesLike=function(){return this.throwIfDisposed(),(0,St.J)(this)};var Ot=n(7039);(0,r.t3)().prototype.pad=function(t,e){return this.throwIfDisposed(),(0,Ot.v)(this,t,e)};var Nt=n(4349);(0,r.t3)().prototype.pool=function(t,e,n,i,r,s){return this.throwIfDisposed(),(0,Nt.d)(this,t,e,n,i,r,s)};var Mt=n(3788);(0,r.t3)().prototype.pow=function(t){return this.throwIfDisposed(),(0,Mt.s)(this,t)};var zt=n(1224);(0,r.t3)().prototype.prelu=function(t){return this.throwIfDisposed(),(0,zt.A)(this,t)};var $t=n(3610);(0,r.t3)().prototype.prod=function(t,e){return this.throwIfDisposed(),(0,$t.W)(this,t,e)};var Tt=n(3217);(0,r.t3)().prototype.reciprocal=function(){return this.throwIfDisposed(),(0,Tt.M)(this)};var Bt=n(8536);(0,r.t3)().prototype.relu=function(){return this.throwIfDisposed(),(0,Bt.U)(this)};var jt=n(9902);(0,r.t3)().prototype.relu6=function(){return this.throwIfDisposed(),(0,jt.b)(this)},(0,r.t3)().prototype.reshapeAs=function(t){return this.throwIfDisposed(),(0,f.X)(this,t.shape)},(0,r.t3)().prototype.reshape=function(t){return this.throwIfDisposed(),(0,f.X)(this,t)};var It=n(4284);(0,r.t3)().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),(0,It.I)(this,t,e,n)};var Rt=n(739);(0,r.t3)().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),(0,Rt.j)(this,t,e,n)};var Lt=n(4330);(0,r.t3)().prototype.reverse=function(t){return this.throwIfDisposed(),(0,Lt.G)(this,t)};var Pt=n(1411);(0,r.t3)().prototype.rfft=function(){return this.throwIfDisposed(),(0,Pt.Q)(this)};var Ut=n(4520);(0,r.t3)().prototype.round=function(){return this.throwIfDisposed(),(0,Ut.N)(this)};var qt=n(5829);(0,r.t3)().prototype.rsqrt=function(){return this.throwIfDisposed(),(0,qt.b)(this)};var Wt=n(2899);(0,r.t3)().prototype.selu=function(){return this.throwIfDisposed(),(0,Wt.U)(this)};var Ht=n(1438);(0,r.t3)().prototype.separableConv2d=function(t,e,n,i,r,s){return this.throwIfDisposed(),(0,Ht.U)(this,t,e,n,i,r,s)};var Vt=n(5808);(0,r.t3)().prototype.sigmoid=function(){return this.throwIfDisposed(),(0,Vt.X)(this)};var Gt=n(2399);(0,r.t3)().prototype.sign=function(){return this.throwIfDisposed(),(0,Gt.X)(this)};var Xt=n(221);(0,r.t3)().prototype.sin=function(){return this.throwIfDisposed(),(0,Xt.O)(this)};var Yt=n(1671);(0,r.t3)().prototype.sinh=function(){return this.throwIfDisposed(),(0,Yt.R)(this)};var Jt=n(2565);(0,r.t3)().prototype.slice=function(t,e){return this.throwIfDisposed(),(0,Jt.t)(this,t,e)};var Zt=n(5301);(0,r.t3)().prototype.softmax=function(t){return this.throwIfDisposed(),(0,Zt.X)(this,t)};var Kt=n(9876);(0,r.t3)().prototype.softplus=function(){return this.throwIfDisposed(),(0,Kt.W)(this)};var Qt=n(1639);(0,r.t3)().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),(0,Qt.f)(this,t,e)};var te=n(1381);(0,r.t3)().prototype.split=function(t,e){return this.throwIfDisposed(),(0,te.V)(this,t,e)};var ee=n(7346);(0,r.t3)().prototype.sqrt=function(){return this.throwIfDisposed(),(0,ee._)(this)};var ne=n(6966);(0,r.t3)().prototype.square=function(){return this.throwIfDisposed(),(0,ne.h)(this)};var ie=n(8774);(0,r.t3)().prototype.squaredDifference=function(t){return this.throwIfDisposed(),(0,ie.$)(this,t)};var re=n(5920);(0,r.t3)().prototype.squeeze=function(t){return this.throwIfDisposed(),(0,re.L)(this,t)};var se=n(2235);(0,r.t3)().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof r.es?[this,t]:[this,...t];return(0,se.k)(n,e)};var oe=n(3863);(0,r.t3)().prototype.step=function(t){return this.throwIfDisposed(),(0,oe.N)(this,t)};var ae=n(8333);(0,r.t3)().prototype.stridedSlice=function(t,e,n,i,r,s,o,a){return this.throwIfDisposed(),(0,ae.N)(this,t,e,n,i,r,s,o,a)};var ue=n(6885);(0,r.t3)().prototype.sub=function(t){return this.throwIfDisposed(),(0,ue.l)(this,t)};var le=n(4786);(0,r.t3)().prototype.sum=function(t,e){return this.throwIfDisposed(),(0,le.S)(this,t,e)};var ce=n(7088);(0,r.t3)().prototype.tan=function(){return this.throwIfDisposed(),(0,ce.O)(this)};var he=n(1871);(0,r.t3)().prototype.tanh=function(){return this.throwIfDisposed(),(0,he.A)(this)};var fe=n(3239);(0,r.t3)().prototype.tile=function(t){return this.throwIfDisposed(),(0,fe.G)(this,t)},(0,r.t3)().prototype.toBool=function(){return this.throwIfDisposed(),(0,p.p)(this,"bool")},(0,r.t3)().prototype.toFloat=function(){return this.throwIfDisposed(),(0,p.p)(this,"float32")},(0,r.t3)().prototype.toInt=function(){return this.throwIfDisposed(),(0,p.p)(this,"int32")};var de=n(9090);(0,r.t3)().prototype.topk=function(t,e){return this.throwIfDisposed(),(0,de.h)(this,t,e)};var pe=n(6336);(0,r.t3)().prototype.transpose=function(t){return this.throwIfDisposed(),(0,pe.p)(this,t)};var ge=n(3447);(0,r.t3)().prototype.unique=function(t){return this.throwIfDisposed(),(0,ge.T)(this,t)};var me=n(3644);(0,r.t3)().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),(0,me.p)(this,t,e)};var ye=n(7690);(0,r.t3)().prototype.unstack=function(t){return this.throwIfDisposed(),(0,ye.H)(this,t)};var ve=n(1203);(0,r.t3)().prototype.where=function(t,e){return this.throwIfDisposed(),(0,ve.a)(t,this,e)};var be=n(9635);(0,r.t3)().prototype.zerosLike=function(){return this.throwIfDisposed(),(0,be.P)(this)}},4402:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(2427),r=n(1978);class s extends i.Component{componentDidMount(){const{name:t,tab:e}=this.props;this.props.registerSurface(t,e,this)}componentDidUpdate(){return!1}render(){const{name:t,visible:e,styles:n}=this.props,o=Object.assign({},s.defaultStyles,n),{width:a,height:u}=o;let{maxHeight:l,maxWidth:c}=o;l=u===s.defaultStyles.height?l:u,c=a===s.defaultStyles.width?c:a;const h=r.css({display:e?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:u,width:a,maxHeight:l,maxWidth:c,overflow:"auto"}),f=r.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),d=r.css({boxSizing:"border-box"});return i.h("div",{className:`${h} tf-surface`,ref:t=>this.container=t,"data-visible":e},i.h("div",{className:`${f} tf-label`,ref:t=>this.label=t},t),i.h("div",{className:`${d} tf-draw-area`,ref:t=>this.drawArea=t}))}}s.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"},e.SurfaceComponent=s},4816:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(2427),r=n(1978);class s extends i.Component{render(){const{tabNames:t,activeTab:e,handleClick:n}=this.props,s=t.length>0?t.map((t=>i.h(o,{key:t,id:t,handleClick:n,isActive:t===e},t))):null,a=r.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return i.h("div",{className:`${a} visor-tabs`},s)}}e.Tabs=s;class o extends i.Component{render(){const{children:t,isActive:e,handleClick:n,id:s}=this.props,o=r.css({borderBottomColor:e?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return i.h("a",{className:`${o} tf-tab`,"data-isactive":e,onClick:()=>n(s)},t)}}},8420:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(2427),r=n(1978),s=n(4402),o=n(4816);class a extends i.Component{static render(t,e,n){return i.render(i.h(a,Object.assign({},n)),t,e)}constructor(t){super(t),this.surfaces=new Map;const e=null==t.startOpen||t.startOpen;this.state={isOpen:e,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(t,e){const n=this.surfaceId(t,e);let i;if(!this.surfaces.has(n))throw Error(`Surface not found with id: ${n}`);return i=this.surfaces.get(n),{container:i.container,label:i.label,drawArea:i.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(t,e){return t+e}setTabs(t){const e=t.map((t=>t.tab)),n=this.state.tabs;let i;for(const t of e)n.has(t)||(n.add(t),i=t);null!=i&&this.setState({tabs:n,activeTab:i})}getTabs(){return this.state.tabs}registerSurface(t,e,n){const i=this.surfaceId(t,e);this.surfaces.set(i,n)}keyHandler(t){192===t.keyCode&&(t.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(t){this.setState({activeTab:t})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(t){this.setTabs(t.surfaceList)}render(){const{isOpen:t,isFullscreen:e,activeTab:n}=this.state,{surfaceList:a}=this.props,l=Array.from(this.getTabs().values()),c=e?"90vw":"550px",h=r.css({width:c,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),f=r.css({right:"0"}),d=r.css({right:`calc(-${c} - 10px)`}),p=t?f:d,g=r.css({});return i.h("div",{className:`${h} ${p} visor`,"data-isopen":t,"data-isfullscreen":e},i.h(u,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:e}),i.h(o.Tabs,{tabNames:l,activeTab:n,handleClick:this.setActiveTab.bind(this)}),i.h("div",{className:`${g} visor-surfaces`},a.map((t=>i.h(s.SurfaceComponent,{key:t.name+t.tab,name:t.name,tab:t.tab,styles:t.styles,registerSurface:this.registerSurface.bind(this),visible:n===t.tab})))))}}function u(t){const{isFullScreen:e,fullScreenHandler:n,closeHandler:s}=t,o=r.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),a=r.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),u=r.css({marginLeft:"auto"});return i.h("div",{className:`${o} visor-controls`},i.h("button",{className:`${a}`,onClick:n},e?"Minimize":"Maximize"),i.h("button",{className:`${a} ${u}`,onClick:s},"Hide"))}e.VisorComponent=a},4427:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(3906),n(4815);const i=n(9403),r=n(8650),s=n(3557),o=n(3095),a=n(3373),u=n(9437),l=n(3254),c=n(6999),h=n(3808),f=n(1147),d=n(2053),p=n(9066),g=n(4417);e.version_vis=g.version;const m={barchart:i.barchart,table:l.table,histogram:o.histogram,linechart:a.linechart,scatterplot:u.scatterplot,confusionMatrix:r.confusionMatrix,heatmap:s.heatmap};e.render=m;const y={accuracy:p.accuracy,perClassAccuracy:p.perClassAccuracy,confusionMatrix:p.confusionMatrix};e.metrics=y;const v={history:c.history,fitCallbacks:c.fitCallbacks,perClassAccuracy:f.perClassAccuracy,valuesDistribution:d.valuesDistribution,layer:h.layer,modelSummary:h.modelSummary};e.show=v;var b=n(8769);e.visor=b.visor,function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(3145))},9403:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,a)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(n(4731)),o=n(9326),a=n(7798);e.barchart=function(t,e,n={}){return i(this,void 0,void 0,(function*(){const i=a.getDrawArea(t),r=e,c=Object.assign({},u,n);if(l.has(i)){const t=l.get(i);if(a.shallowEquals(c,t.lastOptions)){yield a.nextFrame();const e=t.view,n=e.changeset().remove((()=>!0)).insert(r);return void(yield e.change("values",n).runAsync())}}const{xLabel:h,yLabel:f,xType:d,yType:p}=c;let g=null;null!=h&&(g={title:h});let m,y=null;null!=f&&(y={title:f}),m=null!=c.color?Array.isArray(c.color)?{field:"index",type:"nominal",scale:{range:c.color}}:{value:c.color}:{value:"#4C78A0"};const v={width:c.width||o.getDefaultWidth(i),height:c.height||o.getDefaultHeight(i),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:c.fontSize,titleFontSize:c.fontSize},text:{fontSize:c.fontSize},legend:{labelFontSize:c.fontSize,titleFontSize:c.fontSize}},data:{values:r,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:d,axis:g},y:{field:"value",type:p,axis:y},color:m}};yield a.nextFrame();const b=yield s.default(i,v,{actions:!1,mode:"vega-lite",defaultStyle:!1});l.set(i,{view:b.view,lastOptions:c})}))};const u={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},l=new Map},8650:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,a)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(n(4731)),o=n(9326),a=n(7798);e.confusionMatrix=function(t,e,n={}){return i(this,void 0,void 0,(function*(){const i=Object.assign({},u,n),r=a.getDrawArea(t),l=[],c=e.values,h=e.tickLabels||[],f=0===h.length;let d=!0;for(let t=0;t<c.length;t++){const e=f?`Class ${t}`:h[t];f&&h.push(e);for(let n=0;n<c[t].length;n++){const r=f?`Class ${n}`:h[n],s=c[t][n];t!==n||i.shadeDiagonal?(l.push({label:e,prediction:r,count:s,scaleCount:s}),0!==s&&(d=!1)):l.push({label:e,prediction:r,count:s,noFill:!0})}}if(!i.shadeDiagonal&&d)for(const t of l)!0===t.noFill&&(t.noFill=!1,t.scaleCount=t.count);const p={width:i.width||o.getDefaultWidth(r),height:i.height||o.getDefaultHeight(r),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize}},data:{values:l},encoding:{x:{field:"prediction",type:"ordinal",title:i.xLabel||"prediction",scale:{domain:h}},y:{field:"label",type:"ordinal",title:i.yLabel||"label",scale:{domain:h}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:i.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};!1===i.shadeDiagonal&&p.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),i.showTextOverlay&&p.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const g="string"==typeof i.colorMap?{scheme:i.colorMap}:i.colorMap;p.layer[0].encoding.color.scale.range=g,yield s.default(r,p,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))};const u={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]}},3557:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,a)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(n(3906)),a=s(n(4731)),u=n(9326),l=n(7425),c=n(7798);function h(t,e,n){const i=t instanceof o.Tensor?t.shape:[t.length,t[0].length];0===n?l.assert(i[0]===e.length,`Length of xTickLabels (${e.length}) must match number of rows (${i[0]})`):1===n&&l.assert(i[1]===e.length,`Length of yTickLabels (${e.length}) must match number of columns (${i[1]})`)}e.heatmap=function(t,e,n={}){return i(this,void 0,void 0,(function*(){const r=Object.assign({},f,n),s=c.getDrawArea(t);let d=e.values;r.rowMajor&&(d=yield function(t){return i(this,void 0,void 0,(function*(){let e,n;t instanceof o.Tensor?(e=t.shape,n=t.transpose()):(e=[t.length,t[0].length],n=o.tidy((()=>o.tensor2d(t).transpose()))),l.assert(2===n.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const i=yield n.array();n.dispose();const r=[i.length,i[0].length];return l.assert(e[0]===r[1]&&e[1]===r[0],`Unexpected transposed shape. Original ${e} : Transposed ${r}`),i}))}(e.values));const{xTickLabels:p,yTickLabels:g}=e;null!=p&&h(d,p,0),null!=g&&h(d,g,1);const m=[];if(d instanceof o.Tensor){l.assert(2===d.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const t=yield d.data(),[e,n]=d.shape;for(let i=0;i<e;i++){const e=p?`${p[i]}@tfidx@${i}`:i;for(let r=0;r<n;r++){const s=g?`${g[r]}@tfidx@${r}`:r,o=t[i*n+r];m.push({x:e,y:s,value:o})}}}else{const t=d;for(let e=0;e<t.length;e++){const n=p?`${p[e]}@tfidx@${e}`:e;for(let i=0;i<t[e].length;i++){const r=g?`${g[i]}@tfidx@${i}`:i,s=t[e][i];m.push({x:n,y:r,value:s})}}}const y={actions:!1,mode:"vega-lite",defaultStyle:!1},v={width:r.width||u.getDefaultWidth(s),height:r.height||u.getDefaultHeight(s),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:m},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:r.xType,title:r.xLabel,sort:!1},y:{field:"y",type:r.yType,title:r.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},b=new RegExp("@tfidx@\\d+$");let x;switch(p&&(v.encoding.x.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),g&&(v.encoding.y.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),(p||g)&&(y.tooltip={sanitize:t=>String(t).replace(b,"")}),r.colorMap){case"blues":x=["#f7fbff","#4292c6"];break;case"greyscale":x=["#000000","#ffffff"];break;case"viridis":default:x="viridis"}if("viridis"!==x&&(v.encoding.fill.scale={range:x}),r.domain){const t=v.encoding.fill;null!=t.scale?t.scale=Object.assign({},t.scale,{domain:r.domain}):t.scale={domain:r.domain}}yield a.default(s,v,y)}))};const f={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1}},3095:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,a)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=n(2869),o=r(n(4731)),a=n(9326),u=n(9066),l=n(3254),c={maxBins:12,fontSize:11};e.histogram=function(t,e,n={}){return i(this,void 0,void 0,(function*(){const i=function(t){if(null==t.length)throw new Error("input data must be an array");if(0===t.length)return[];if("object"==typeof t[0]){if(null==t[0].value)throw new Error("input data must have a value field");return t}{const e=Array(t.length);for(let n=0;n<t.length;n++)e[n]={value:t[n]};return e}}(e),r=Object.assign({},c,n),h=a.subSurface(t,"histogram");if(!1!==n.stats){const e=a.subSurface(t,"stats",{prepend:!0});let o;o=n.stats?n.stats:u.arrayStats(i.map((t=>t.value))),function(t,e,n){const i=s.format(",.4~f"),r=s.format(".4~p"),o=[],a=[];if(null!=t.numVals&&(o.push("Num Vals"),a.push(i(t.numVals))),null!=t.min&&(o.push("Min"),a.push(i(t.min))),null!=t.max&&(o.push("Max"),a.push(i(t.max))),null!=t.numZeros){o.push("# Zeros");let e="";t.numVals&&(e=t.numZeros>0?`(${r(t.numZeros/t.numVals)})`:""),a.push(`${i(t.numZeros)} ${e}`)}if(null!=t.numNans){o.push("# NaNs");let e="";t.numVals&&(e=t.numNans>0?`(${r(t.numNans/t.numVals)})`:""),a.push(`${i(t.numNans)} ${e}`)}if(null!=t.numInfs){o.push("# Infinity");let e="";t.numVals&&(e=t.numInfs>0?`(${r(t.numInfs/t.numVals)})`:""),a.push(`${i(t.numInfs)} ${e}`)}l.table(e,{headers:o,values:[a]},n)}(o,e,{fontSize:r.fontSize})}if(0===i.length)return;const f=[];for(let t=0;t<i.length;t++){const e=i[t].value;null!=e&&isFinite(e)&&f.push(i[t])}const d={width:r.width||a.getDefaultWidth(h),height:r.height||a.getDefaultHeight(h),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:f},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize}},encoding:{x:{bin:{maxbins:r.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:r.color||"#001B44"}}};return o.default(h,d,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))}},3373:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,a)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(n(4731)),o=n(9326),a=n(7425),u=n(7798);e.linechart=function(t,e,n={}){return i(this,void 0,void 0,(function*(){const i=Array.isArray(e.values[0])?e.values:[e.values],r=i[0].length,c=e.series?e.series:i.map(((t,e)=>`Series ${e+1}`));a.assert(c.length===i.length,"Must have an equal number of series labels as there are data series"),null!=n.seriesColors&&a.assert(n.seriesColors.length===i.length,"Must have an equal number of series colors as there are data series");const h=[];for(let t=0;t<r;t++){const e={x:t};c.forEach(((n,r)=>{const s=i[r][t].y;e[n]=s,e[`${n}-name`]=n})),h.push(e)}const f=Object.assign({},l,n),d={x:{field:"x",type:f.xType,title:f.xLabel},tooltip:[{field:"x",type:"quantitative"},...c.map((t=>({field:t,type:"quantitative"})))]},p=c.map((t=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:t,type:f.yType,title:f.yLabel,scale:f.zoomToFit?{zero:!1}:null!=f.yAxisDomain?{domain:f.yAxisDomain}:void 0},color:{field:`${t}-name`,type:"nominal",legend:{values:c,title:null},scale:{range:f.seriesColors}}}}))),g=u.getDrawArea(t),m={width:f.width||o.getDefaultWidth(g),height:f.height||o.getDefaultHeight(g),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:f.fontSize,titleFontSize:f.fontSize},text:{fontSize:f.fontSize},legend:{labelFontSize:f.fontSize,titleFontSize:f.fontSize}},data:{values:h},encoding:d,layer:[...p,{mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}}]};return yield s.default(g,m,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const l={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},7798:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const r=n(3145),s=n(8769);e.getDrawArea=function(t){if(t instanceof HTMLElement)return t;if(r.isSurface(t))return t.drawArea;if(r.isSurfaceInfo(t))return s.visor().surface({name:t.name,tab:t.tab,styles:t.styles}).drawArea;throw new Error("Not a drawable")},e.shallowEquals=function(t,e){const n=Object.getOwnPropertyNames(t),i=Object.getOwnPropertyNames(e);if(n.length!==i.length)return!1;for(let i=0;i<n.length;i++){const r=n[i];if(t[r]!==e[r])return!1}return!0},e.nextFrame=function(){return i(this,void 0,void 0,(function*(){yield new Promise((t=>requestAnimationFrame(t)))}))}},9437:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,a)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(n(4731)),o=n(9326),a=n(7425),u=n(7798);e.scatterplot=function(t,e,n={}){return i(this,void 0,void 0,(function*(){let i=e.values;const r=null==e.series?[]:e.series;i=Array.isArray(i[0])?i:[i];const c=[];i.forEach(((t,e)=>{const n=null!=r[e]?r[e]:`Series ${e+1}`,i=t.map((t=>Object.assign({},t,{series:n})));c.push(...i)})),null!=n.seriesColors&&a.assert(n.seriesColors.length===i.length,"Must have an equal number of series colors as there are data series");const h=u.getDrawArea(t),f=Object.assign({},l,n),d={width:f.width||o.getDefaultWidth(h),height:f.height||o.getDefaultHeight(h),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:f.fontSize,titleFontSize:f.fontSize},text:{fontSize:f.fontSize},legend:{labelFontSize:f.fontSize,titleFontSize:f.fontSize}},data:{values:c},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:f.xType,title:f.xLabel,scale:f.zoomToFit?{zero:!1}:null!=f.xAxisDomain?{domain:f.xAxisDomain}:void 0},y:{field:"y",type:f.yType,title:f.yLabel,scale:f.zoomToFit?{zero:!1}:null!=f.yAxisDomain?{domain:f.yAxisDomain}:void 0},color:{field:"series",type:"nominal",scale:{range:f.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield s.default(h,d,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const l={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},3254:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(2869),r=n(9735),s=n(1978),o=n(7798);e.table=function(t,e,n={}){if(e&&null==e.headers)throw new Error('Data to render must have a "headers" property');if(e&&null==e.values)throw new Error('Data to render must have a "values" property');const u=o.getDrawArea(t),l=Object.assign({},a,n);let c=r.select(u).select("table.tf-table");const h=s.css({fontSize:l.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(0===c.size()&&(c=r.select(u).append("table"),c.attr("class",` ${h} tf-table`),c.append("thead").append("tr"),c.append("tbody")),1!==c.size())throw new Error("Error inserting table");const f=s.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),d=c.select("thead").select("tr").selectAll("th").data(e.headers),p=d.enter().append("th").attr("class",`${f}`);d.merge(p).html((t=>t)),d.exit().remove();const g=i.format(",.4~f"),m=c.select("tbody").selectAll("tr").data(e.values),y=m.enter().append("tr"),v=s.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),b=m.merge(y).selectAll("td").data((t=>t)),x=b.enter().append("td").attr("class",`${v}`);b.merge(x).html((t=>"number"==typeof t?g(t):t)),b.exit().remove(),m.exit().remove()};const a={fontSize:14}},6999:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const r=n(3373),s=n(7798),o=n(9326);function a(t,e,n,a={}){return i(this,void 0,void 0,(function*(){const i=s.getDrawArea(t),c={};for(const t of n)if(/val_/.test(t)){const i=t.replace("val_","");u(c,i);const r=l(e,t,n.indexOf(t));c[i].series.push(t),c[i].values.push(r)}else{const i=l(e,t,n.indexOf(t));u(c,t),c[t].series.push(t),c[t].values.push(i)}const h=Object.keys(c),f=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},a),d=[];for(const t of h){const e=o.subSurface(i,t),n=c[t].series,s=c[t].values;n.every((t=>Boolean(t.match("acc"))))&&(f.zoomToFitAccuracy?f.zoomToFit=!0:(f.yAxisDomain=[0,1],delete f.zoomToFit));const a=r.linechart(e,{values:s,series:n},f);d.push(a)}yield Promise.all(d)}))}function u(t,e){null==t[e]&&(t[e]={series:[],values:[]})}function l(t,e,n){if(Array.isArray(t)){const i=Array.isArray(t[0])?t[n]:t,r=[];for(let t=0;t<i.length;t++){const n=i[t];r.push({x:t,y:n[e]})}return r}return t.history[e].map(((t,e)=>({x:e,y:t})))}function c(t,e,n){return null==t[e]&&(t[e]={}),null==t[e][n]&&(t[e][n]=[]),t[e][n]}e.history=a,e.fitCallbacks=function(t,e,n={}){const r={},u=n.callbacks||["onEpochEnd","onBatchEnd"],l=s.getDrawArea(t),h=Object.assign({},n);delete h.callbacks;const f={};return u.forEach((t=>{f[t]=function(t){return(n,u)=>i(this,void 0,void 0,(function*(){/batch/i.test(t)?h.xLabel="Batch":/epoch/i.test(t)&&(h.xLabel="Epoch");const n=[],i=[];for(const s of e)if(null!=u[s]){i.push(s);const e=c(r,t,s);e.push({[s]:u[s]}),n.push(e)}a(o.subSurface(l,t,{title:t}),n,i,h),yield s.nextFrame()}))}(t)})),f}},3808:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const r=n(3095),s=n(7798),o=n(3254),a=n(9326),u=n(9066);function l(t){let e;return e=Array.isArray(t.outputShape[0])?`[${t.outputShape.map((t=>c(t))).join(", ")}]`:c(t.outputShape),{name:t.name,trainable:t.trainable,parameters:t.countParams(),outputShape:e}}function c(t){const e=t.slice();return 0===e.length?"Scalar":(null===e[0]&&(e[0]="batch"),`[${e.join(",")}]`)}e.modelSummary=function(t,e){return i(this,void 0,void 0,(function*(){const n=s.getDrawArea(t),i=function(t){return{layers:t.layers.map(l)}}(e).layers.map((t=>[t.name,t.outputShape,t.parameters,t.trainable]));o.table(n,{headers:["Layer Name","Output Shape","# Of Params","Trainable"],values:i})}))},e.layer=function(t,e){return i(this,void 0,void 0,(function*(){const n=s.getDrawArea(t),l=yield function(t){return i(this,void 0,void 0,(function*(){const e=t.getWeights(),n=t.weights,i=e.map(u.tensorStats),r=yield Promise.all(i),s=e.map((t=>t.shape));return e.map(((t,e)=>({name:n[e].name,stats:r[e],shape:c(s[e]),weight:t})))}))}(e),h=a.subSurface(n,"layer-weights-info"),f=l.map((t=>[t.name,t.shape,t.stats.min,t.stats.max,t.weight.size,t.stats.numZeros,t.stats.numNans,t.stats.numInfs]));o.table(h,{headers:["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],values:f});const d=a.subSurface(n,"select-layer"),p=a.subSurface(n,"param-distribution");!function(t,e,n){const i=`<div><button>Show Values Distribution for:</button>${`\n    <select>\n      ${t.map((t=>`<option value=${t}>${t}</option>`))}\n    </select>\n  `}</div>`;e.innerHTML=i;const r=e.querySelector("button"),s=e.querySelector("select");r.addEventListener("click",(()=>{n(s.selectedOptions[0].label)}))}(l.map((t=>t.name)),d,(t=>i(this,void 0,void 0,(function*(){const e=l.filter((e=>e.name===t))[0],n=yield e.weight.data();r.histogram(p,n,{height:150,width:460,stats:!1})}))))}))}},1147:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const r=n(7798),s=n(3254);e.perClassAccuracy=function(t,e,n){return i(this,void 0,void 0,(function*(){const i=r.getDrawArea(t),o=[];for(let t=0;t<e.length;t++){const i=n?n[t]:t.toString(),r=e[t];o.push([i,r.accuracy,r.count])}return s.table(i,{headers:["Class","Accuracy","# Samples"],values:o})}))}},2053:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const r=n(3095),s=n(7798),o=n(9066);e.valuesDistribution=function(t,e){return i(this,void 0,void 0,(function*(){const n=s.getDrawArea(t),i=yield o.tensorStats(e),a=yield e.data();r.histogram(n,a,{height:150,stats:i})}))}},3145:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isSurfaceInfo=function(t){return null!=t.name},e.isSurface=function(t){return t.drawArea instanceof HTMLElement}},9326:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(1978),r=n(7798),s={prepend:!1};e.subSurface=function(t,e,n={}){const o=r.getDrawArea(t),a=i.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),u=i.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),l=Object.assign({},s,n);let c=o.querySelector(`div[data-name=${e}]`);if(!c){if(c=document.createElement("div"),c.setAttribute("class",`${a}`),c.dataset.name=e,l.title){const t=document.createElement("div");t.setAttribute("class",`subsurface-title ${u}`),t.innerText=l.title,c.appendChild(t)}l.prepend?o.insertBefore(c,o.firstChild):o.appendChild(c)}return c},e.getDefaultWidth=function(t){let e=0,n=t;for(;n&&0===n.clientWidth;)n=n.parentElement,e=50;return n.clientWidth-e},e.getDefaultHeight=function(t){return 0===t.clientHeight?200:t.clientHeight}},9066:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(o,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const r=n(3906),s=n(7425);e.arrayStats=function(t){if(!Array.isArray(t))throw new Error("input must be an array");if(0===t.length)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const e=t.length;let n=-1/0,i=1/0,r=0,s=0,o=0;for(let a=0;a<e;a++){const e=t[a];e>n&&(n=e),e<i&&(i=e),0===e&&(r+=1),isNaN(e)?s+=1:isFinite(e)||(o+=1)}const a={numVals:e,numZeros:r,numNans:s,max:n,min:i,numInfs:o};return a.max===-1/0&&(a.max=NaN),a.min===1/0&&(a.min=NaN),a},e.tensorStats=function(t){return i(this,void 0,void 0,(function*(){const[e,n,i]=r.tidy((()=>{const e=r.scalar(0,t.dtype);return[t.min(),t.max(),t.equal(e).sum()]}));return Promise.all([t.data(),e.data(),n.data(),i.data()]).then((([t,e,n,i])=>{const r=t.length;let s=0,o=0;for(let e=0;e<r;e++){const n=t[e];isNaN(n)?s+=1:isFinite(n)||(o+=1)}let a=e[0],u=n[0];return s===r&&(a=NaN,u=NaN),{numVals:r,numZeros:i[0],numNans:s,min:a,max:u,numInfs:o}}))}))},e.confusionMatrix=function(t,e,n,o){return i(this,void 0,void 0,(function*(){s.assert(1===t.rank,"labels must be a 1D tensor"),s.assert(1===e.rank,"predictions must be a 1D tensor"),s.assert(t.size===e.size,"labels and predictions must be the same length"),null!=o&&s.assert(o.size===e.size,"labels and predictions must be the same length");const i=t.cast("int32"),a=e.cast("int32");null==n&&(n=r.tidy((()=>r.maximum(i.max(),a.max()).cast("int32").dataSync()[0]+1)));let u=Promise.resolve(null);return null!=o&&(u=o.data()),Promise.all([i.data(),a.data(),u]).then((([t,e,i])=>{const r=Array(n).fill(0);for(let t=0;t<n;t++)r[t]=Array(n).fill(0);for(let n=0;n<t.length;n++){const s=t[n],o=e[n];r[s][o]+=null!=i?i[n]:1}return r}))}))},e.accuracy=function(t,e){return i(this,void 0,void 0,(function*(){s.assertShapesMatch(t.shape,e.shape,"Error computing accuracy.");const n=t.equal(e),i=n.mean(),o=(yield i.data())[0];return r.dispose([n,i]),o}))},e.perClassAccuracy=function(t,e,n){return i(this,void 0,void 0,(function*(){return s.assert(1===t.rank,"labels must be a 1D tensor"),s.assert(1===e.rank,"predictions must be a 1D tensor"),s.assert(t.size===e.size,"labels and predictions must be the same length"),null==n&&(n=r.tidy((()=>r.maximum(t.max(),e.max()).dataSync()[0]+1))),Promise.all([t.data(),e.data()]).then((([t,e])=>{const i=Array(n).fill(0),r=Array(n).fill(0);for(let n=0;n<t.length;n++){const s=t[n],o=e[n];i[s]+=1,s===o&&(r[s]+=1)}const s=[];for(let t=0;t<i.length;t++)s.push({count:i[t],accuracy:0===i[t]?0:r[t]/i[t]});return s}))}))}},7425:(t,e)=>{"use strict";function n(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function i(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}Object.defineProperty(e,"__esModule",{value:!0}),e.assert=n,e.assertShapesMatch=function(t,e,r=""){n(i(t,e),r+` Shapes ${t} and ${e} must match`)},e.arraysEqual=i,e.DECIMAL_PLACES_TO_CHECK=4},4417:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.version="1.5.1"},8769:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(8420);let r;const s="tfjs-visor-container";e.visor=function(){if("undefined"==typeof document)throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(s)&&null!=r)return r;let t,e=document.getElementById(s);function n(e,n){let r=null;return t=i.VisorComponent.render(e,t,{ref:t=>r=t,surfaceList:Array.from(n.values())}),r}null==e&&(e=document.createElement("div"),e.id=s,document.body.appendChild(e));const a=new Map,u=n(e,a);return r=new o(u,e,a,n),r};class o{constructor(t,e,n,i){this.visorComponent=t,this.el=e,this.surfaceList=n,this.renderVisor=i}surface(t){const{name:e}=t,n=null==t.tab?"Visor":t.tab;if(null==e||!("string"==typeof e||e instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const i=Object.assign({},t,{tab:n}),r=`${e}-${n}`;return this.surfaceList.has(r)||this.surfaceList.set(r,i),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(e,n)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(t){if(!this.visorComponent.state.tabs.has(t))throw new Error(`Tab '${t}' does not exist`);this.visorComponent.setState({activeTab:t})}}e.Visor=o},2869:(t,e,n)=>{"use strict";function i(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function r(t){return(t=i(Math.abs(t)))?t[1]:NaN}n.r(e),n.d(e,{format:()=>d,formatDefaultLocale:()=>y,formatLocale:()=>m,formatPrefix:()=>p,formatSpecifier:()=>a,precisionFixed:()=>v,precisionPrefix:()=>b,precisionRound:()=>x});var s,o=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function a(t){return new u(t)}function u(t){if(!(e=o.exec(t)))throw new Error("invalid format: "+t);var e;this.fill=e[1]||" ",this.align=e[2]||">",this.sign=e[3]||"-",this.symbol=e[4]||"",this.zero=!!e[5],this.width=e[6]&&+e[6],this.comma=!!e[7],this.precision=e[8]&&+e[8].slice(1),this.trim=!!e[9],this.type=e[10]||""}function l(t,e){var n=i(t,e);if(!n)return t+"";var r=n[0],s=n[1];return s<0?"0."+new Array(-s).join("0")+r:r.length>s+1?r.slice(0,s+1)+"."+r.slice(s+1):r+new Array(s-r.length+2).join("0")}a.prototype=u.prototype,u.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const c={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return l(100*t,e)},r:l,s:function(t,e){var n=i(t,e);if(!n)return t+"";var r=n[0],o=n[1],a=o-(s=3*Math.max(-8,Math.min(8,Math.floor(o/3))))+1,u=r.length;return a===u?r:a>u?r+new Array(a-u+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+i(t,Math.max(0,e+a-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function h(t){return t}var f,d,p,g=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function m(t){var e,n,i=t.grouping&&t.thousands?(e=t.grouping,n=t.thousands,function(t,i){for(var r=t.length,s=[],o=0,a=e[0],u=0;r>0&&a>0&&(u+a+1>i&&(a=Math.max(1,i-u)),s.push(t.substring(r-=a,r+a)),!((u+=a+1)>i));)a=e[o=(o+1)%e.length];return s.reverse().join(n)}):h,o=t.currency,u=t.decimal,l=t.numerals?function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(t.numerals):h,f=t.percent||"%";function d(t){var e=(t=a(t)).fill,n=t.align,r=t.sign,h=t.symbol,d=t.zero,p=t.width,m=t.comma,y=t.precision,v=t.trim,b=t.type;"n"===b?(m=!0,b="g"):c[b]||(null==y&&(y=12),v=!0,b="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var x="$"===h?o[0]:"#"===h&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",w="$"===h?o[1]:/[%p]/.test(b)?f:"",A=c[b],_=/[defgprs%]/.test(b);function k(t){var o,a,c,h=x,f=w;if("c"===b)f=A(t)+f,t="";else{var k=(t=+t)<0;if(t=A(Math.abs(t),y),v&&(t=function(t){t:for(var e,n=t.length,i=1,r=-1;i<n;++i)switch(t[i]){case".":r=e=i;break;case"0":0===r&&(r=i),e=i;break;default:if(r>0){if(!+t[i])break t;r=0}}return r>0?t.slice(0,r)+t.slice(e+1):t}(t)),k&&0==+t&&(k=!1),h=(k?"("===r?r:"-":"-"===r||"("===r?"":r)+h,f=("s"===b?g[8+s/3]:"")+f+(k&&"("===r?")":""),_)for(o=-1,a=t.length;++o<a;)if(48>(c=t.charCodeAt(o))||c>57){f=(46===c?u+t.slice(o+1):t.slice(o))+f,t=t.slice(0,o);break}}m&&!d&&(t=i(t,1/0));var C=h.length+t.length+f.length,E=C<p?new Array(p-C+1).join(e):"";switch(m&&d&&(t=i(E+t,E.length?p-f.length:1/0),E=""),n){case"<":t=h+t+f+E;break;case"=":t=h+E+t+f;break;case"^":t=E.slice(0,C=E.length>>1)+h+t+f+E.slice(C);break;default:t=E+h+t+f}return l(t)}return y=null==y?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),k.toString=function(){return t+""},k}return{format:d,formatPrefix:function(t,e){var n=d(((t=a(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(r(e)/3))),s=Math.pow(10,-i),o=g[8+i/3];return function(t){return n(s*t)+o}}}}function y(t){return f=m(t),d=f.format,p=f.formatPrefix,f}function v(t){return Math.max(0,-r(Math.abs(t)))}function b(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(r(e)/3)))-r(Math.abs(t)))}function x(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,r(e)-r(t))+1}y({decimal:".",thousands:",",grouping:[3],currency:["$",""]})},6350:(t,e,n)=>{"use strict";n.d(e,{Xhn:()=>i.browser,MB5:()=>i.losses,glt:()=>i.nextFrame,nGf:()=>i.randomNormal,odF:()=>i.tensor2d,lub:()=>i.tidy,p_j:()=>i.train,D5U:()=>i.util,VD$:()=>i.variable,lls:()=>i.zeros});var i=n(3906),r=n(5202),s=n(5875),o=n(2805),a=n(3863);const u={kernelName:r.SY,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,o.d)(t,(0,a.N)((0,s.p)(n,"float32"),-1))}}};var l=n(2639),c=n(7211),h=n(2502),f=n(7346),d=n(6966),p=n(6885);const g={kernelName:r.VG,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=(0,d.h)((0,s.p)(n,"float32")),i=(0,f._)((0,p.l)((0,h.i)(1),e));return(0,c.W)((0,l.h)(t,i))}}}},m={kernelName:r.Sp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=(0,f._)((0,p.l)((0,d.h)((0,s.p)(n,"float32")),1));return(0,l.h)(t,e)}}}};var y=n(2011),v=n(2673),b=n(4786);const x={kernelName:r.mm,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=y.assertAndGetBroadcastShape(n.shape,i.shape);return{a:()=>{let e=t;const i=y.getReductionAxes(n.shape,r);return i.length>0&&(e=(0,b.S)(e,i)),(0,v.X)(e,n.shape)},b:()=>{let e=t;const n=y.getReductionAxes(i.shape,r);return n.length>0&&(e=(0,b.S)(e,n)),(0,v.X)(e,i.shape)}}}},w={kernelName:r.Xz,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach(((e,i)=>{n[i]=()=>t.clone()})),n}};var A=n(9635);const _={kernelName:r.sJ,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,A.P)(n)}}},k={kernelName:r.aJ,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,A.P)(n)}}},C={kernelName:r.M2,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,l.h)(t,(0,f._)((0,p.l)((0,h.i)(1),(0,d.h)((0,s.p)(n,"float32")))))}}};var E=n(7571);const D={kernelName:r.qw,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=(0,f._)((0,E.I)((0,h.i)(1),(0,d.h)((0,s.p)(n,"float32"))));return(0,l.h)(t,e)}}}},F={kernelName:r.QC,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=(0,y.assertAndGetBroadcastShape)(n.shape,i.shape);return{a:()=>{const e=(0,E.I)((0,d.h)(n),(0,d.h)(i));let s=(0,o.d)(t,(0,l.h)(i,e));const a=(0,y.getReductionAxes)(n.shape,r);return a.length>0&&(s=(0,b.S)(s,a)),(0,v.X)(s,n.shape)},b:()=>{const e=(0,E.I)((0,d.h)(n),(0,d.h)(i));let s=(0,c.W)((0,o.d)(t,(0,l.h)(n,e)));const a=(0,y.getReductionAxes)(i.shape,r);return a.length>0&&(s=(0,b.S)(s,a)),(0,v.X)(s,i.shape)}}}},S={kernelName:r.jM,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,l.h)(t,(0,E.I)((0,d.h)((0,s.p)(n,"float32")),1))}}},O={kernelName:r.Oy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,l.h)(t,(0,p.l)((0,h.i)(1),(0,d.h)((0,s.p)(n,"float32"))))}}};var N=n(3421),M=n(8516),z=n(9740),$=n(1129),T=n(128);const B=(0,T.op)({avgPool3dGrad_:function(t,e,n,i,s,o){const a=(0,M._1)(t,"dy","avgPool3dGrad"),u=(0,M._1)(e,"input","avgPool3dGrad");let l=a,c=u,h=!1;4===u.rank&&(h=!0,l=(0,v.X)(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),c=(0,v.X)(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),z.hu(5===l.rank,(()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`)),z.hu(5===c.rank,(()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`)),(0,$.m)("avgPool3dGrad",s,o);const f={dy:l,input:c},d={filterSize:n,strides:i,pad:s,dimRoundingMode:o},p=N.BV.runKernel(r.IM,f,d);return h?(0,v.X)(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),j={kernelName:r._k,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{filterSize:r,strides:s,pad:o,dimRoundingMode:a}=n;return{x:()=>B(t,i,r,s,o,a)}}},I=(0,T.op)({avgPoolGrad_:function(t,e,n,i,s){const o=(0,M._1)(t,"dy","avgPoolGrad"),a=(0,M._1)(e,"input","avgPoolGrad");z.hu(a.rank===o.rank,(()=>`Rank of input (${a.rank}) does not match rank of dy (${o.rank})`));let u=a,l=o,c=!1;3===a.rank&&(c=!0,u=(0,v.X)(a,[1,a.shape[0],a.shape[1],a.shape[2]]),l=(0,v.X)(o,[1,o.shape[0],o.shape[1],o.shape[2]])),z.hu(4===l.rank,(()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`)),z.hu(4===u.rank,(()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${u.rank}.`));const h={dy:l,input:u},f={filterSize:n,strides:i,pad:s},d=N.BV.runKernel(r.RO,h,f);return c?(0,v.X)(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),R={kernelName:r.Jh,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{filterSize:r,strides:s,pad:o}=n;return{x:()=>I(t,i,r,s,o)}}};var L=n(8249);const P={kernelName:r.XL,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[i,r]=e,{transposeA:s,transposeB:o}=n;return s||o?!s&&o?{a:()=>(0,L.O)(t,r,!1,!1),b:()=>(0,L.O)(t,i,!0,!1)}:s&&!o?{a:()=>(0,L.O)(r,t,!1,!0),b:()=>(0,L.O)(i,t,!1,!1)}:{a:()=>(0,L.O)(r,t,!0,!0),b:()=>(0,L.O)(t,i,!0,!0)}:{a:()=>(0,L.O)(t,r,!1,!0),b:()=>(0,L.O)(i,t,!0,!1)}}};var U=n(1639);const q={kernelName:r.zw,gradFunc:(t,e,n)=>{const{blockShape:i,crops:r}=n;return{x:()=>(0,U.f)(t,i,r)}}},W={kernelName:r.Ly,gradFunc:(t,e,n)=>{const i=n,r=i.inputShape,s=i.shape,o=Array.from(s);for(let t=r.length-1;t>=0;t--)if(r[t]===s[t])o[t]=1;else if(1!==r[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${s}].`);const a=[];for(let t=0;t<o.length;t++)o[t]>1&&a.push(t);return{x:()=>(0,b.S)(t,a,!0)}}},H={kernelName:r.RF,gradFunc:t=>({x:()=>t.clone()})},V={kernelName:r.gJ,gradFunc:t=>({x:()=>(0,A.P)(t)})};var G=n(6731),X=n(5573),Y=n(495),J=n(1203);const Z={kernelName:r.xn,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{clipValueMin:r,clipValueMax:s}=n;return{x:()=>(0,J.a)((0,Y.H)((0,G.b)(i,r),(0,X.z)(i,s)),t,(0,A.P)(t))}}},K={kernelName:r.yj,inputsToSave:["x"],gradFunc:u.gradFunc};var Q=n(1381);const tt={kernelName:r.Eh,saveAllInputs:!0,gradFunc:(t,e,n)=>{const i=e.map((t=>t.shape)),{axis:r}=n,s=(0,z.EC)(r,e[0].shape)[0],o=i.map((t=>t[s]));return(0,Q.V)(t,o,s).map((t=>()=>t))}};var et=n(1885),nt=n(6858);const it={kernelName:r.mh,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[i,r]=e,{dilations:s,strides:o,pad:a,dataFormat:u}=n;return z.hu($.I0(s),(()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`)),{x:()=>(0,nt._)(i.shape,t,r,o,a,u),filter:()=>(0,et.p)(i,t,r.shape,o,a,u)}}};var rt=n(9399);const st={kernelName:r.wm,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[i,r]=e,{strides:s,pad:o,dataFormat:a,dimRoundingMode:u}=n;return{dy:()=>(0,rt.T)(t,r,s,o,a,1,u),filter:()=>(0,et.p)(t,i,r.shape,s,o,a,u)}}},ot=(0,T.op)({conv3DBackpropFilter_:function(t,e,n,i,s){let o=t;4===t.rank&&(o=(0,v.X)(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let a=e;4===a.rank&&(a=(0,v.X)(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),z.hu(5===o.rank,(()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`)),z.hu(5===a.rank,(()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${a.shape}.`)),z.hu(5===n.length,(()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`)),z.hu(o.shape[4]===n[3],(()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${n[3]}.`)),z.hu(a.shape[4]===n[4],(()=>`Error in conv3dDerFilter: depth of dy (${a.shape[4]}) must match output depth for filter (${n[4]}).`));const u={x:o,dy:a},l={strides:i,pad:s,filterShape:n};return N.BV.runKernel(r.o2,u,l)}});var at=n(2833);const ut={kernelName:r.x1,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:i,strides:r,pad:s}=n;z.hu((0,$.I0)(i),(()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`));const[o,a]=e;return{x:()=>(0,at._)(o.shape,t,a,r,s),filter:()=>ot(o,t,a.shape,r,s)}}};var lt=n(221);const ct={kernelName:r.mc,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,o.d)((0,c.W)((0,lt.O)((0,s.p)(n,"float32"))),t)}}};var ht=n(1671);const ft={kernelName:r.TR,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,o.d)((0,ht.R)((0,s.p)(n,"float32")),t)}}};var dt=n(7704),pt=n(805),gt=n(6336);const mt={kernelName:r.iH,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{axis:r,exclusive:s,reverse:o}=n;return{x:()=>{const e=(0,dt.Q3)([r],i.rank);let n=(0,pt.z)(t,r,s,!o);return null!=e&&(n=(0,gt.p)(n,e)),n}}}};var yt=n(2806),vt=n(5039);const bt={kernelName:r.ci,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:i,strides:r,pad:s,dimRoundingMode:o}=n,a=null==i?[1,1]:i;z.hu($.I0(a),(()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`));const[u,l]=e;return z.hu(4===u.rank,(()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`)),z.hu(4===l.rank,(()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`)),z.hu(u.shape[3]===l.shape[2],(()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`)),z.hu($.jT(r,a),(()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`)),$.m("depthwiseConv2d",s,o),{x:()=>(0,vt.v)(u.shape,t,l,r,s,a,o),filter:()=>(0,yt.z)(u,t,l.shape,r,s,a,o)}}},xt={kernelName:r.p4,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[i,s]=e,o={x:i,filter:s,dy:t},a={x:i,filter:s,dy:t};return{x:()=>N.BV.runKernel(r.ek,o,n),filter:()=>N.BV.runKernel(r.Vn,a,n)}}},wt={kernelName:r.SX,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,i={dy:t,y:n};return{x:()=>N.BV.runKernel(r.HE,i)}}};var At=n(8575);const _t={kernelName:r.Om,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,i=(0,o.d)((0,At.Q)((0,c.W)((0,d.h)(n))),2/Math.sqrt(Math.PI));return{x:()=>(0,o.d)(t,i)}}},kt={kernelName:r.NE,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,o.d)(t,n)}}},Ct={kernelName:r.YF,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>(0,v.X)(t,n.shape)}}},Et={kernelName:r.Y0,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,o.d)(t,(0,At.Q)(n))}}},Dt={kernelName:r.OR,gradFunc:t=>({x:()=>(0,A.P)(t)})},Ft={kernelName:r.je,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=(0,y.assertAndGetBroadcastShape)(n.shape,i.shape);return{a:()=>{const e=(0,l.h)(t,(0,s.p)(i,"float32")),o=(0,y.getReductionAxes)(n.shape,r);return o.length>0?(0,v.X)((0,b.S)(e,o),n.shape):e},b:()=>{let e=(0,o.d)(t,(0,s.p)(n,"float32"));const a=(0,y.getReductionAxes)(i.shape,r);a.length>0&&(e=(0,v.X)((0,b.S)(e,a),i.shape));const u=(0,d.h)(i);return(0,c.W)((0,l.h)(e,(0,s.p)(u,"float32")))}}}};var St=n(5829),Ot=n(3239);const Nt={kernelName:r.sH,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:i}=n,[r,s,a,u]=e,l=null==u?(0,h.i)(1):u,c=(0,y.getReductionAxes)(s.shape,r.shape),f=[];if(1===s.rank){for(let t=0;t<r.shape.length-1;++t)f.push(r.shape[t]);f.push(1)}const d=(0,p.l)(r,s),g=(0,o.d)(t,l),m=(0,St.b)((0,E.I)(a,(0,h.i)(i))),x=(0,o.d)((0,o.d)((0,o.d)(m,m),m),(0,h.i)(-.5));return{x:()=>1===s.rank?(0,v.X)((0,o.d)((0,o.d)(t,(0,Ot.G)((0,v.X)(m,[1,1,1,s.shape[0]]),f)),l),r.shape):(0,v.X)((0,o.d)((0,o.d)(t,m),l),r.shape),mean:()=>{let t=(0,o.d)((0,o.d)(m,(0,h.i)(-1)),g);return 1===s.rank&&(t=(0,b.S)(t,c)),(0,v.X)(t,s.shape)},variance:()=>{let t=(0,o.d)((0,o.d)(x,d),g);return 1===s.rank&&(t=(0,b.S)(t,c)),(0,v.X)(t,s.shape)},scale:()=>{const e=(0,o.d)(d,m);let n=(0,o.d)(t,e);return 1===s.rank&&(n=(0,b.S)(n,c)),(0,v.X)(n,s.shape)},offset:()=>{let e=t;return 1===s.rank&&(e=(0,b.S)(e,c)),(0,v.X)(e,s.shape)}}}};var Mt=n(3644);const zt={kernelName:r.qi,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[i,r]=e,{axis:s}=n,o=(0,z.EC)(s,i.shape)[0];return{x:()=>{const e=i.shape,n=r.size,a=e.slice(0,o),u=a.length,l=e.slice(s,e.length).slice(1),c=l.length,h=$t(0,u),f=$t(u+1,u+1+c),d=Tt([a,[n],l]),p=(0,v.X)(t,d),g=(0,v.X)(r,[n]),m=Tt([[u],h,f]),y=(0,gt.p)(p,m);let b=(0,Mt.p)(y,g,i.shape[o]);const x=(0,dt.LJ)(m);return b=(0,gt.p)(b,x),b},indices:()=>r}}};function $t(t,e){const n=[];for(let i=t;i<e;++i)n.push(i);return n}function Tt(t){const e=[];for(let n=0;n<t.length;++n)for(let i=0;i<t[n].length;++i)e.push(t[n][i]);return e}const Bt={kernelName:r.Ac,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e;return{a:()=>(0,A.P)(n),b:()=>(0,A.P)(i)}}},jt={kernelName:r.iJ,gradFunc:t=>({x:()=>(0,s.p)(t,"float32")})},It={kernelName:r.av,gradFunc:t=>({x:()=>(0,A.P)(t)})},Rt={kernelName:r.iW,gradFunc:t=>({x:()=>(0,A.P)(t)})},Lt={kernelName:r.r7,gradFunc:t=>({x:()=>(0,A.P)(t)})};var Pt=n(1694);const Ut={kernelName:r.J$,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{alpha:r}=n,s=(0,Pt.p)(i,0);return{x:()=>(0,J.a)(s,t,(0,o.d)(t,r))}}},qt={kernelName:r.kU,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,l.h)(t,(0,E.I)(n,1))}}},Wt={kernelName:r.Zb,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,l.h)(t,(0,s.p)(n,"float32"))}}},Ht={kernelName:r.qC,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i]=e,{axis:r}=n;return{logits:()=>{const e=(0,At.Q)(i);return(0,p.l)(t,(0,o.d)((0,b.S)(t,r,!0),e))}}}},Vt=(0,T.op)({localResponseNormalizationBackprop_:function(t,e,n,i=5,s=1,o=1,a=.5){const u={x:t,y:e,dy:n},l={depthRadius:i,bias:s,alpha:o,beta:a};return N.BV.runKernel(r.Hh,u,l)}}),Gt={kernelName:r.eZ,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i,r]=e,{depthRadius:s,bias:o,alpha:a,beta:u}=n;return{x:()=>Vt(i,r,t,s,o,a,u)}}};var Xt=n(1966);function Yt(t,e,n,i){return e.rank<n.rank&&(e=(0,v.X)(e,dt.rv(e.shape,i))),t.rank<n.rank&&(t=(0,v.X)(t,dt.rv(t.shape,i))),{x:()=>(0,o.d)(t,(0,s.p)((0,Xt.D)(n,e),t.dtype))}}const Jt={kernelName:r.Yo,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const i=n,{reductionIndices:r}=i,s=e[0],o=Yt(t,e[1],s,z.EC(r,s.shape));return{x:()=>o.x()}}};var Zt=n(2359);const Kt={kernelName:r.BM,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e;return{a:()=>(0,o.d)(t,(0,s.p)((0,G.b)(n,i),"float32")),b:()=>(0,o.d)(t,(0,s.p)((0,Zt.d)(n,i),"float32"))}}},Qt=(0,T.op)({maxPool3dGrad_:function(t,e,n,i,s,o,a){const u=(0,M._1)(t,"dy","maxPool3dGrad"),l=(0,M._1)(e,"input","maxPool3dGrad"),c=(0,M._1)(n,"output","maxPool3dGrad");let h=u,f=l,d=c,p=!1;4===l.rank&&(p=!0,h=(0,v.X)(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),f=(0,v.X)(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=(0,v.X)(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),z.hu(5===h.rank,(()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`)),z.hu(5===f.rank,(()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`)),z.hu(5===d.rank,(()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`)),(0,$.m)("maxPool3dGrad",o,a);const g={dy:h,input:f,output:d},m={filterSize:i,strides:s,pad:o,dimRoundingMode:a},y=N.BV.runKernel(r.OU,g,m);return p?(0,v.X)(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}}),te={kernelName:r.OA,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i,r]=e,{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=n;return{x:()=>Qt(t,i,r,s,o,a,u)}}},ee=(0,T.op)({maxPoolGrad_:function(t,e,n,i,s,o,a){const u=(0,M._1)(t,"dy","maxPoolGrad"),l=(0,M._1)(e,"input","maxPoolGrad"),c=(0,M._1)(n,"output","maxPoolGrad");z.hu(l.rank===u.rank,(()=>`Rank of input (${l.rank}) does not match rank of dy (${u.rank})`)),z.hu(4===u.rank,(()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${u.rank}.`)),z.hu(4===l.rank,(()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`)),$.m("maxPoolGrad",o,a);const h={dy:u,input:l,output:c},f={filterSize:i,strides:s,pad:o,dimRoundingMode:a};return N.BV.runKernel(r.OV,h,f)}}),ne={kernelName:r.mT,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i,r]=e,{filterSize:s,strides:o,pad:a}=n;return{x:()=>ee(t,i,r,s,o,a)}}};var ie=n(8074);const re={kernelName:r.q2,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{axis:r}=n,s=z.EC(r,i.shape),a=(0,dt.kz)(i.shape,s)[1],u=z.NA(a);return{x:()=>{const e=i.shape.slice();s.forEach((t=>{e[t]=1}));const n=(0,v.X)(t,e);return(0,l.h)((0,o.d)(n,(0,ie.i)(i.shape,"float32")),u)}}}},se={kernelName:r.c1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const i=n,{axis:r}=i,[s,o]=e,a=Yt(t,o,s,z.EC(r,s.shape));return{x:()=>a.x()}}},oe={kernelName:r.q8,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e;return{a:()=>(0,o.d)(t,(0,s.p)((0,X.z)(n,i),"float32")),b:()=>(0,o.d)(t,(0,s.p)((0,Pt.p)(n,i),"float32"))}}};var ae=n(2565);const ue={kernelName:r.jQ,inputsToSave:["x"],gradFunc:(t,e,n)=>{const i=e[0],{paddings:r}=n,s=r.map((t=>t[0]));return{x:()=>(0,ae.t)(t,s,i.shape)}}};var le=n(7184);const ce={kernelName:r.Vb,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=(0,y.assertAndGetBroadcastShape)(n.shape,i.shape);return{a:()=>{const e=(0,y.getReductionAxes)(n.shape,r);return e.length>0?(0,v.X)((0,b.S)(t,e),n.shape):t},b:()=>{const e=(0,o.d)(t,(0,c.W)((0,le.G)((0,l.h)(n,i)))),s=(0,y.getReductionAxes)(i.shape,r);return s.length>0?(0,v.X)((0,b.S)(e,s),i.shape):e}}}},he={kernelName:r.wY,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=(0,y.assertAndGetBroadcastShape)(n.shape,i.shape);return{a:()=>{const e=(0,o.d)(t,(0,s.p)(i,"float32")),a=(0,y.getReductionAxes)(n.shape,r);return a.length>0?(0,v.X)((0,b.S)(e,a),n.shape):e},b:()=>{const e=(0,o.d)(t,(0,s.p)(n,"float32")),a=(0,y.getReductionAxes)(i.shape,r);return a.length>0?(0,v.X)((0,b.S)(e,a),i.shape):e}}}},fe={kernelName:r.ku,gradFunc:t=>({x:()=>(0,c.W)(t)})};var de=n(1434);const pe={kernelName:r.we,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>(0,de.l)(n.shape,"float32")}}},ge={kernelName:r.qW,gradFunc:t=>({x:()=>(0,A.P)(t)})};var me=n(7690);const ye={kernelName:r.Qi,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:i}=n;return(0,me.H)(t,i).map((t=>()=>t))}},ve={kernelName:r.ly,inputsToSave:["x"],gradFunc:(t,e,n)=>{const i=e[0],{paddings:r}=n,s=r.map((t=>t[0]));return{x:()=>(0,ae.t)(t,s,i.shape)}}};var be=n(3102),xe=n(3788);const we={kernelName:r.pe,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,i,r]=e,a=n,u=i,l=y.assertAndGetBroadcastShape(a.shape,u.shape);return{a:()=>{const e=(0,s.p)(u,"float32");let n=(0,o.d)(t,(0,o.d)(e,(0,xe.s)(a,(0,p.l)(e,(0,h.i)(1)))));const i=y.getReductionAxes(a.shape,l);return i.length>0&&(n=(0,b.S)(n,i)),(0,v.X)(n,a.shape)},b:()=>{const e=(0,Pt.p)(a,0),n=(0,J.a)(e,(0,be.c)(a),(0,A.P)(a));let i=(0,o.d)(t,(0,o.d)(r,n));const s=y.getReductionAxes(u.shape,l);return s.length>0&&(i=(0,b.S)(i,s)),(0,v.X)(i,u.shape)}}}},Ae={kernelName:r.o0,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,i]=e,r=(0,Pt.p)(n,0);return{x:()=>(0,J.a)(r,t,(0,o.d)(t,i)),alpha:()=>{let e=(0,J.a)(r,(0,A.P)(t),(0,o.d)(t,n));const s=(0,y.getReductionAxes)(i.shape,t.shape);return s.length>0&&(e=(0,b.S)(e,s)),(0,v.X)(e,i.shape)}}}},_e={kernelName:r.oH,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=y.assertAndGetBroadcastShape(n.shape,i.shape);return{a:()=>{const e=(0,l.h)(t,(0,s.p)(i,"float32")),o=y.getReductionAxes(n.shape,r);return o.length>0?(0,v.X)((0,b.S)(e,o),n.shape):e},b:()=>{let e=(0,o.d)(t,(0,s.p)(n,"float32"));const a=y.getReductionAxes(i.shape,r);a.length>0&&(e=(0,v.X)((0,b.S)(e,a),i.shape));const u=(0,d.h)(i);return(0,c.W)((0,l.h)(e,(0,s.p)(u,"float32")))}}}},ke={kernelName:r.$H,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,l.h)(t,(0,c.W)((0,d.h)(n)))}}},Ce={kernelName:r.Sb,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,i=(0,o.d)((0,X.z)(n,6),(0,a.N)(n));return{x:()=>(0,o.d)(t,(0,s.p)(i,"float32"))}}},Ee={kernelName:r.qk,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,o.d)(t,(0,s.p)((0,a.N)(n),"float32"))}}},De={kernelName:r.HZ,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,v.X)(t,n.shape)}}},Fe={kernelName:r._Y,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[i]=e,s={dy:t,images:i};return{images:()=>N.BV.runKernel(r.zb,s,n)}}},Se={kernelName:r.dp,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[i]=e,s={dy:t,images:i};return{images:()=>N.BV.runKernel(r.Hm,s,n)}}};var Oe=n(4330);const Ne={kernelName:r.mK,gradFunc:(t,e,n)=>{const{dims:i}=n,r=(0,z.EC)(i,t.shape);return{x:()=>(0,Oe.G)(t,r)}}},Me={kernelName:r.e0,gradFunc:t=>({x:()=>(0,A.P)(t)})},ze={kernelName:r.bV,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,c.W)((0,l.h)(t,(0,o.d)((0,xe.s)(n,1.5),2)))}}};var $e=n(1917);const Te={kernelName:r.Ph,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>(0,s.p)((0,A.P)(n),"float32"),t:()=>(0,o.d)(t,(0,s.p)(n,t.dtype)),e:()=>(0,o.d)(t,(0,s.p)((0,$e.h)(n),t.dtype))}}};var Be=n(141);const je={kernelName:r.oF,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=(0,Pt.p)(n,(0,h.i)(0)),i=(0,h.i)(Be.y),r=(0,h.i)(Be.$),a=(0,o.d)(t,r),u=(0,o.d)((0,o.d)(t,i),(0,At.Q)((0,s.p)(n,"float32")));return(0,J.a)(e,a,u)}}}},Ie={kernelName:r.a5,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,o.d)(t,(0,o.d)(n,(0,p.l)((0,h.i)(1),n)))}}},Re={kernelName:r.i5,gradFunc:t=>({x:()=>(0,A.P)(t)})};var Le=n(7838);const Pe={kernelName:r.RQ,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,o.d)((0,Le.m)((0,s.p)(n,"float32")),t)}}};var Ue=n(3159);const qe={kernelName:r.w3,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,o.d)((0,Ue.f)((0,s.p)(n,"float32")),t)}}};var We=n(7039),He=n(1269);const Ve={kernelName:r.p2,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{begin:r,size:s}=n,o=i.shape,[a,u]=(0,He.parseSliceParams)(i,r,s),l=[];for(let e=0;e<t.rank;e++)l.push([a[e],o[e]-a[e]-u[e]]);return{x:()=>(0,We.v)(t,l)}}},Ge={kernelName:r.Gc,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[i]=e,{dim:r}=n,s=(0,o.d)(t,i);return{logits:()=>(0,p.l)(s,(0,o.d)((0,b.S)(s,[r],!0),i))}}};var Xe=n(5808);const Ye={kernelName:r.MR,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,o.d)(t,(0,Xe.X)(n))}}};var Je=n(1141);const Ze={kernelName:r.TQ,gradFunc:(t,e,n)=>{const{blockShape:i,paddings:r}=n;return{x:()=>(0,Je.E)(t,i,r)}}};var Ke=n(9134);const Qe={kernelName:r.L8,gradFunc:(t,e,n)=>{const{axis:i}=n;return{x:()=>(0,Ke.z)(t,i)}}},tn={kernelName:r.FK,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,l.h)(t,(0,o.d)((0,f._)((0,s.p)(n,"float32")),2))}}},en={kernelName:r.bK,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,o.d)(t,(0,o.d)((0,s.p)(n,"float32"),2))}}},nn={kernelName:r._t,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=(0,h.i)(2);return{a:()=>(0,o.d)(t,(0,o.d)(r,(0,p.l)(n,i))),b:()=>(0,o.d)(t,(0,o.d)(r,(0,p.l)(i,n)))}}},rn={kernelName:r.h8,gradFunc:t=>({x:()=>(0,A.P)(t)})},sn={kernelName:r.Tr,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,i]=e,r=y.assertAndGetBroadcastShape(n.shape,i.shape);return{a:()=>{let e=t;const i=y.getReductionAxes(n.shape,r);return i.length>0&&(e=(0,b.S)(e,i)),(0,v.X)(e,n.shape)},b:()=>{let e=t;const n=y.getReductionAxes(i.shape,r);return n.length>0&&(e=(0,b.S)(e,n)),(0,v.X)((0,c.W)(e),i.shape)}}}},on={kernelName:r.GB,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,r=i.shape.slice(),{axis:s}=n;(0,z.EC)(s,i.shape).forEach((t=>{r[t]=1}));const a=(0,v.X)(t,r),u=(0,o.d)(a,(0,ie.i)(i.shape,"float32"));return{x:()=>u}}},an={kernelName:r.sE,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,l.h)(t,(0,d.h)((0,Le.m)(n)))}}},un={kernelName:r.MI,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>(0,o.d)((0,p.l)((0,h.i)(1),(0,d.h)(n)),t)}}},ln={kernelName:r.n9,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[i]=e,{reps:r}=n;return{x:()=>{let e=(0,A.P)(i);if(1===i.rank)for(let n=0;n<r[0];++n)e=(0,E.I)(e,(0,ae.t)(t,[n*i.shape[0]],[i.shape[0]]));else if(2===i.rank)for(let n=0;n<r[0];++n)for(let s=0;s<r[1];++s)e=(0,E.I)(e,(0,ae.t)(t,[n*i.shape[0],s*i.shape[1]],[i.shape[0],i.shape[1]]));else if(3===i.rank)for(let n=0;n<r[0];++n)for(let s=0;s<r[1];++s)for(let o=0;o<r[2];++o)e=(0,E.I)(e,(0,ae.t)(t,[n*i.shape[0],s*i.shape[1],o*i.shape[2]],[i.shape[0],i.shape[1],i.shape[2]]));else{if(4!==i.rank)throw new Error(`Gradient for tile operation is not implemented for rank-${i.rank} tensors yet.`);for(let n=0;n<r[0];++n)for(let s=0;s<r[1];++s)for(let o=0;o<r[2];++o)for(let a=0;a<r[3];++a)e=(0,E.I)(e,(0,ae.t)(t,[n*i.shape[0],s*i.shape[1],o*i.shape[2],a*i.shape[3]],[i.shape[0],i.shape[1],i.shape[2],i.shape[3]]))}return e}}}},cn={kernelName:r.G3,gradFunc:(t,e,n)=>{const i=n,{perm:r}=i,s=dt.LJ(r);return{x:()=>(0,gt.p)(t,s)}}};var hn=n(2235);const fn={kernelName:r.To,gradFunc:(t,e,n)=>{const i=n,{axis:r}=i;return{value:()=>(0,hn.k)(t,r)}}};var dn=n(1064),pn=n(5262),gn=n(3171);const mn={kernelName:r.Qv,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>function(t,e){const n=(0,gn.g)(e,(0,A.P)(e)),i=(0,pn.I)(t,n);let r=(0,G.b)(e,(0,h.i)(0,"int32"));const s=i.rank-r.rank;for(let t=0;t<s;++t)r=(0,dn.d)(r,t+1);r=(0,Y.H)(r,(0,ie.i)(i.shape,"bool"));const o=(0,A.P)(i);return(0,J.a)(r,i,o)}(t,n)}}},yn={kernelName:r.Ru,gradFunc:t=>({x:()=>(0,A.P)(t)})};var vn=n(8307);const bn=[u,g,m,x,w,_,k,C,D,F,S,O,j,R,P,q,W,H,V,Z,K,tt,st,it,ut,ct,ft,mt,bt,xt,_e,wt,_t,kt,Ct,Et,Ft,Dt,Nt,zt,Bt,jt,It,Rt,Lt,Ut,qt,Wt,Ht,Gt,Jt,Jt,Kt,te,ne,re,se,oe,ue,ce,he,fe,pe,ge,ye,ve,ve,we,Ae,ke,Ce,Ee,De,Fe,Se,Ne,Me,ze,Te,je,Ie,Re,Pe,qe,Ve,Ge,Ye,Ze,Ze,Qe,Qe,tn,nn,en,rn,sn,on,an,un,ln,cn,fn,mn,yn];for(const t of bn)(0,vn.Li)(t);let xn;function wn(){return null==xn&&(xn=(0,i.backend)().epsilon()),xn}n(4815);class An extends Error{constructor(t){super(t),Object.setPrototypeOf(this,An.prototype)}}class _n extends Error{constructor(t){super(t),Object.setPrototypeOf(this,_n.prototype)}}class kn extends Error{constructor(t){super(t),Object.setPrototypeOf(this,kn.prototype)}}class Cn extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Cn.prototype)}}class En extends Error{constructor(t){super(t),Object.setPrototypeOf(this,En.prototype)}}function Dn(t,e){if(Array.isArray(t)){let n=[];for(let i=0;i<e;i++)n=n.concat(t);return n}{const n=new Array(e);return n.fill(t),n}}function Fn(t,e){if(!t)throw new En(e)}function Sn(t,e){let n=0;for(const i of t)i===e&&n++;return n}function On(t){return 1===t.length?t[0]:t}function Nn(t){return Array.isArray(t)?t:[t]}function Mn(t){const e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==e[0]?e:"private"+e}function zn(t){return t.length<=1||-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,((t,e)=>e.toUpperCase()))}Error;let $n={};function Tn(t){if(null==t)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function Bn(t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach((t=>Bn(t)));else{const e=Object.keys(t);for(const n of e){const e=t[n];null!=e&&"object"==typeof e&&(Array.isArray(e)||"ndarray"!==e.type||"number"!=typeof e.value?Bn(e):t[n]=e.value)}}}function jn(t,e={},n={},i="object",r=!1){if("string"==typeof t){const r=t;let s;if(r in n)s=n[r];else if(r in $n)s=$n[r];else if(s=e[r],null==s)throw new kn(`Unknown ${i}: ${t}. This may be due to one of the following reasons:\n1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}{const s=t;if(null==s.className||null==s.config)throw new kn(`${i}: Improper config format: ${JSON.stringify(s)}.\n'className' and 'config' must set.`);const o=s.className;let a,u;if(o in n?[a,u]=n[o]:o in $n?[a,u]=$n.className:o in e&&([a,u]=e[o]),null==a)throw new kn(`Unknown ${i}: ${o}. This may be due to one of the following reasons:\n1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=u){const t={};for(const e of Object.keys($n))t[e]=$n[e];for(const e of Object.keys(n))t[e]=n[e];s.config.customObjects=t;const e=Object.assign({},$n);for(const t of Object.keys(n))$n[t]=n[t];Bn(s.config);const i=u(a,s.config,n,r);return $n=Object.assign({},e),i}{const t=Object.assign({},$n);for(const t of Object.keys(n))$n[t]=n[t];const e=new a(s.config);return $n=Object.assign({},t),e}}}function In(t,e){return-1*function(t,e){return t<e?-1:t>e?1:0}(t,e)}function Rn(t){if(null==t)return t;const e=[];for(const n of t)-1===e.indexOf(n)&&e.push(n);return e}function Ln(t){if(null==t)throw new kn(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function Pn(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new kn(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function Un(t,e,n=0,i=1/0){return Fn(n>=0),Fn(i>=n),Array.isArray(t)&&t.length>=n&&t.length<=i&&t.every((t=>typeof t===e))}function qn(t,e){Array.isArray(t)?(i.util.assert(t.length>0,(()=>`${e} is unexpectedly an empty array.`)),t.forEach(((t,n)=>qn(t,`element ${n+1} of ${e}`)))):i.util.assert(Number.isInteger(t)&&t>0,(()=>`Expected ${e} to be a positive integer, but got ${Wn(t)}.`))}function Wn(t){return null===t?"null":Array.isArray(t)?"["+t.map((t=>Wn(t))).join(",")+"]":"string"==typeof t?`"${t}"`:`${t}`}function Hn(t){return"relu"===t?"relu":"linear"===t?"linear":"elu"===t?"elu":null}function Vn(t,e){return(0,i.tidy)((()=>i.sqrt(i.sum(i.mul(t,t),e,!0))))}class Gn extends i.serialization.Serializable{getConfig(){return{}}}class Xn extends Gn{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return(0,i.tidy)((()=>{const e=Vn(t,this.axis),n=i.clipByValue(e,0,this.maxValue);return i.mul(t,i.div(n,i.add(wn(),e)))}))}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Xn.className="MaxNorm",i.serialization.registerClass(Xn);class Yn extends Gn{constructor(t){super(),this.defaultAxis=0,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return(0,i.tidy)((()=>i.div(t,i.add(wn(),Vn(t,this.axis)))))}getConfig(){return{axis:this.axis}}}Yn.className="UnitNorm",i.serialization.registerClass(Yn);class Jn extends Gn{apply(t){return i.relu(t)}}Jn.className="NonNeg",i.serialization.registerClass(Jn);class Zn extends Gn{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=t.minValue?t.minValue:this.defaultMinValue,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.rate=null!=t.rate?t.rate:this.defaultRate,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return(0,i.tidy)((()=>{const e=Vn(t,this.axis),n=i.add(i.mul(this.rate,i.clipByValue(e,this.minValue,this.maxValue)),i.mul(1-this.rate,e));return i.mul(t,i.div(n,i.add(wn(),e)))}))}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}Zn.className="MinMaxNorm",i.serialization.registerClass(Zn);const Kn={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Qn(t){return Tn(t)}function ti(t,e={}){return jn(t,i.serialization.SerializationMap.getMap().classNameMap,e,"constraint")}function ei(t){return null==t?null:"string"==typeof t?ti({className:t in Kn?Kn[t]:t,config:{}}):t instanceof Gn?t:ti(t)}const ni=["channelsFirst","channelsLast"],ii=["nearest","bilinear"],ri=["valid","same","causal"],si=["max","avg"],oi=["sum","mul","concat","ave"],ai=new Map;function ui(t){Pn(ni,"DataFormat",t)}function li(t){Pn(ri,"PaddingMode",t)}function ci(t){Pn(si,"PoolMode",t)}const hi=[];function fi(t,e){hi.push(t);try{const t=e();return hi.pop(),t}catch(t){throw hi.pop(),t}}function di(t){if(!mi(t))throw new Error("Not a valid tensor name: '"+t+"'");return(0===hi.length?"":hi.join("/")+"/")+t}function pi(t){if(!mi(t))throw new Error("Not a valid tensor name: '"+t+"'");ai.has(t)||ai.set(t,0);const e=ai.get(t);if(ai.set(t,ai.get(t)+1),e>0){const n=`${t}_${e}`;return ai.set(n,1),n}return t}const gi=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function mi(t){return!!t.match(gi)}function yi(t,e,n){null==e&&(e=0),null==n&&(n=t.length);let i=1;for(let r=e;r<n;++r)i*=t[r];return i}function vi(t){if(0===t.length)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const i=t[n];i<e&&(e=i)}return e}function bi(t){if(0===t.length)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const i=t[n];i>e&&(e=i)}return e}function xi(t,e){if(e<t)throw new kn(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let i=t;i<e;++i)n.push(i);return n}function wi(t,e){return i.cast(t,e)}function Ai(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),i.reshape(t,n)}function _i(t,e,n){return(0,i.tidy)((()=>{switch(t.rank){case 1:return i.slice1d(t,e,n);case 2:return i.slice2d(t,[e,0],[n,t.shape[1]]);case 3:return i.slice3d(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return i.slice4d(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return i.slice(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return i.slice(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new kn(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function ki(t,e,n){return(0,i.tidy)((()=>{switch(t.rank){case 1:return i.slice1d(t,e,n);case 2:return i.slice2d(t,[0,e],[t.shape[0],n]);case 3:return i.slice3d(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return i.slice4d(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new kn(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function Ci(t,e,n,r){return(0,i.tidy)((()=>{switch(t.rank){case 1:return i.slice1d(t,e,n);case 2:switch(r){case 1:return _i(t,e,n);case 2:return ki(t,e,n);default:throw new kn(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return _i(t,e,n);case 2:return i.slice3d(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return ki(t,e,n);default:throw new kn(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return _i(t,e,n);case 2:return i.slice4d(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return i.slice4d(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return ki(t,e,n);default:throw new kn(`The axis is not within the rank of the tensor ${r}`)}default:throw new kn(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function Ei(t,e=-1){let n;return e<0&&(n=t[0].rank,e=0!==n?n:0),e===t[0].rank&&(e=-1),i.concat(t,e)}function Di(t,e){switch(t.rank){case 1:return i.concat1d([t,e]);case 2:return i.concat2d([t,e],0);case 3:return i.concat3d([t,e],0);case 4:return i.concat4d([t,e],0);default:throw new kn(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function Fi(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new kn(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return i.tile(t,e)}function Si(t,e=0,n=1,r,s){return i.randomNormal(t,e,n,r,s)}function Oi(t,e,n,r){if(t.rank<2||e.rank<2)throw new Cn(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3&&t.shape.slice(-1)[0]!==e.shape.slice(-2)[0])throw new Cn(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`);if(2===t.rank&&2===e.rank){const s=!1,o=!1;return i.fused.matMul({a:t,b:e,transposeA:s,transposeB:o,bias:r?zi(t.rank,r,"channelsLast"):null,activation:n})}{const s=t.shape.slice(),o=s.pop();t=i.reshape(t,[-1,o]);const a=e.shape.slice(),u=a.pop(),l=a.pop(),c=[...a,u],h=Array.from({length:e.rank},((t,n)=>0===n?e.rank-2:n<=e.rank-2?n-1:n));e=i.reshape(i.transpose(e,h),[l,-1]);const f=[...s,...c],d=!1,p=!1;return i.reshape(i.fused.matMul({a:t,b:e,transposeA:d,transposeB:p,bias:r?zi(t.rank,r,"channelsLast"):null,activation:n}),f)}}function Ni(t,e,n){return(0,i.tidy)((()=>(e=Array.isArray(e)?(0,i.tensor1d)(e,"int32"):i.cast(e,"int32"),i.gather(t,e,n))))}function Mi(t){return i.mul(t,t)}function zi(t,e,n){const r=e.shape;if(1!==e.rank&&e.rank!==t)throw new kn(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(5===t){if("channelsFirst"===n)return 1===r.length?i.reshape(e,[1,r[0],1,1,1]):i.reshape(e,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?i.reshape(e,[1,1,1,1,r[0]]):i.reshape(e,[1].concat(r))}else if(4===t){if("channelsFirst"===n)return 1===r.length?i.reshape(e,[1,r[0],1,1]):i.reshape(e,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?i.reshape(e,[1,1,1,r[0]]):i.reshape(e,[1].concat(r))}else if(3===t){if("channelsFirst"===n)return 1===r.length?i.reshape(e,[1,r[0],1]):i.reshape(e,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?i.reshape(e,[1,1,r[0]]):i.reshape(e,[1].concat(r))}else if(t<3)return e;throw new kn(`Unsupported input rank by biasAdd: ${e.rank}`)}function $i(t,e,n){return(0,i.tidy)((()=>(null==n&&(n="channelsLast"),ui(n),i.add(t,zi(t.rank,e,n)))))}function Ti(t,e,n,r){return(0,i.tidy)((()=>i.dropout(t,e,n,r)))}function Bi(t,e,n=!1){return n?t():e()}const ji=["fanIn","fanOut","fanAvg"],Ii=["normal","uniform","truncatedNormal"];class Ri extends i.serialization.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class Li extends Ri{apply(t,e){return(0,i.zeros)(t,e)}}Li.className="Zeros",i.serialization.registerClass(Li);class Pi extends Ri{apply(t,e){return(0,i.ones)(t,e)}}Pi.className="Ones",i.serialization.registerClass(Pi);class Ui extends Ri{constructor(t){if(super(),"object"!=typeof t)throw new kn(`Expected argument of type ConstantConfig but got ${t}`);if(void 0===t.value)throw new kn(`config must have value set but got ${t}`);this.value=t.value}apply(t,e){return(0,i.tidy)((()=>(0,i.mul)((0,i.scalar)(this.value),(0,i.ones)(t,e))))}getConfig(){return{value:this.value}}}Ui.className="Constant",i.serialization.registerClass(Ui);class qi extends Ri{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return(0,i.randomUniform)(t,this.minval,this.maxval,e)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}qi.className="RandomUniform",i.serialization.registerClass(qi);class Wi extends Ri{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new Cn(`randomNormal does not support dType ${e}.`);return Si(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Wi.className="RandomNormal",i.serialization.registerClass(Wi);class Hi extends Ri{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new Cn(`truncatedNormal does not support dType ${e}.`);return(0,i.truncatedNormal)(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Hi.className="TruncatedNormal",i.serialization.registerClass(Hi);class Vi extends Ri{constructor(t){super(),this.gain=null!=t.gain?t.gain:1}apply(t,e){return(0,i.tidy)((()=>{if(2!==t.length||t[0]!==t[1])throw new kn("Identity matrix initializer can only be used for 2D square matrices.");return(0,i.mul)(this.gain,(0,i.eye)(t[0]))}))}getConfig(){return{gain:this.gain}}}Vi.className="Identity",i.serialization.registerClass(Vi);class Gi extends Ri{constructor(t){if(super(),t.scale<0)throw new kn(`scale must be a positive float. Got: ${t.scale}`);var e;this.scale=null==t.scale?1:t.scale,this.mode=null==t.mode?"fanIn":t.mode,e=this.mode,Pn(ji,"FanMode",e),this.distribution=null==t.distribution?"normal":t.distribution,function(t){Pn(Ii,"Distribution",t)}(this.distribution),this.seed=t.seed}apply(t,e){const n=function(t,e="channelsLast"){let n,i;if(ui(e),2===t.length)n=t[0],i=t[1];else if(-1!==[3,4,5].indexOf(t.length)){if("channelsFirst"===e){const e=yi(t,2);n=t[1]*e,i=t[0]*e}else if("channelsLast"===e){const e=yi(t,0,t.length-2);n=t[t.length-2]*e,i=t[t.length-1]*e}}else{const e=yi(t);n=Math.sqrt(e),i=Math.sqrt(e)}return[n,i]}(t),r=n[0],s=n[1];let o=this.scale;if("fanIn"===this.mode?o/=Math.max(1,r):"fanOut"===this.mode?o/=Math.max(1,s):o/=Math.max(1,(r+s)/2),"normal"===this.distribution){const n=Math.sqrt(o);if("float32"!==(e=e||"float32")&&"int32"!==e)throw new Cn(`${this.getClassName()} does not support dType ${e}.`);return(0,i.truncatedNormal)(t,0,n,e,this.seed)}{const n=Math.sqrt(3*o);return(0,i.randomUniform)(t,-n,n,e)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Gi.className="VarianceScaling",i.serialization.registerClass(Gi);class Xi extends Gi{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return Gi.className}}Xi.className="GlorotUniform",i.serialization.registerClass(Xi);class Yi extends Gi{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return Gi.className}}Yi.className="GlorotNormal",i.serialization.registerClass(Yi);class Ji extends Gi{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return Gi.className}}Ji.className="HeNormal",i.serialization.registerClass(Ji);class Zi extends Gi{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return Gi.className}}Zi.className="HeUniform",i.serialization.registerClass(Zi);class Ki extends Gi{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return Gi.className}}Ki.className="LeCunNormal",i.serialization.registerClass(Ki);class Qi extends Gi{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return Gi.className}}Qi.className="LeCunNormal",i.serialization.registerClass(Qi);class tr extends Ri{constructor(t){if(super(),this.DEFAULT_GAIN=1,this.gain=null==t.gain?this.DEFAULT_GAIN:t.gain,this.seed=t.seed,null!=this.seed)throw new Cn("Random seed is not implemented for Orthogonal Initializer yet.")}apply(t,e){return(0,i.tidy)((()=>{if(t.length<2)throw new Cn("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${t[0]*t[1]}) elements: Slowness may result.`);const e=Si(t[0]>t[1]?[t[1],t[0]]:t,0,1,"float32");let n=i.linalg.gramSchmidt(e);return t[0]>t[1]&&(n=(0,i.transpose)(n)),(0,i.mul)(this.gain,n)}))}getConfig(){return{gain:this.gain,seed:this.seed}}}tr.className="Orthogonal",i.serialization.registerClass(tr);const er={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function nr(t,e={}){return jn(t,i.serialization.SerializationMap.getMap().classNameMap,e,"initializer")}function ir(t){return Tn(t)}function rr(t){if("string"==typeof t){const e=t in er?er[t]:t;if("GlorotNormal"===e)return new Yi;if("GlorotUniform"===e)return new Xi;if("HeNormal"===e)return new Ji;if("HeUniform"===e)return new Zi;if("LeCunNormal"===e)return new Ki;if("LeCunUniform"===e)return new Qi;{const t={};return t.className=e,t.config={},nr(t)}}return t instanceof Ri?t:nr(t)}let sr=0;function or(){return sr++}const ar={};function ur(t=""){return t in ar||(ar[t]=0),ar[t]+=1,t+ar[t].toString()}function lr(t){return Array.isArray(t)&&Array.isArray(t[0])}function cr(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function hr(t){let e;if(Array.isArray(t)){if(1!==t.length)throw new kn(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function fr(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return(t=t)[0];throw new kn(`Expected exactly 1 Shape; got ${t.length}`)}return t}function dr(t){let e=0;for(const n of t)0===n.shape.length?e+=1:e+=n.shape.reduce(((t,e)=>t*e));return e}class pr{constructor(t,e="float32",n="Variable",r=!0,s=null){this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=or(),n=null==n?"Variable":n,this.originalName=di(n),this.name=pi(this.originalName),this.trainable_=r,this.constraint=s,this.val=i.variable(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),function(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function gr(t){return t.map((t=>t.read()))}function mr(t){t.forEach((t=>{t[0].write(t[1])}))}class yr{constructor(t){this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class vr{constructor(t,e,n,i,r,s,o){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=i,this.callArgs=r,this.outputTensorIndex=o,this.id=or(),null!=s&&(this.originalName=di(s),this.name=pi(this.originalName)),this.rank=e.length}}let br=0;class xr{constructor(t,e){this.callArgs=e,this.id=br++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const e of t.inboundLayers)null!=e&&e.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)null!=e?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let wr=0;class Ar extends i.serialization.Serializable{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=wr++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const t=this.getClassName();e=Mn(t)+"_"+ur(t)}if(this.name=e,this.trainable_=null==t.trainable||t.trainable,null!=t.inputShape||null!=t.batchInputShape){let e;if(null!=t.batchInputShape)e=t.batchInputShape;else if(null!=t.inputShape){let n=null;null!=t.batchSize&&(n=t.batchSize),e=[n].concat(t.inputShape)}this.batchInputShape=e;let n=t.dtype;null==n&&(n=t.inputDType),null==n&&(n="float32"),this.dtype=n}null!=t.weights?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(0===this.inboundNodes.length)throw new _n(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new kn(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return On(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return On(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new An(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(0===this.inboundNodes.length)throw new An(`Layer ${this.name} is not connected, no input to return.`);return On(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new An(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new An(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return On(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map((t=>t()))}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach((e=>e.trainable=t)),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter((t=>t.trainable)):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter((t=>!t.trainable)).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=Nn(t),null==this.inputSpec||0===this.inputSpec.length)return;const e=Nn(this.inputSpec);if(t.length!==e.length)throw new kn(`Layer ${this.name} expects ${e.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let n=0;n<t.length;n++){const i=t[n],r=e[n];if(null==r)continue;const s=i.rank;if(null!=r.ndim&&s!==r.ndim)throw new kn(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${r.ndim}, found ndim=${s}`);if(null!=r.maxNDim&&s>r.maxNDim)throw new kn(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${r.maxNDim}, found ndim=${s}`);if(null!=r.minNDim&&s<r.minNDim)throw new kn(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${r.minNDim}, found ndim=${s}.`);if(null!=r.dtype&&i.dtype!==r.dtype)throw new kn(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${r.dtype}, found dtype=${i.dtype}.`);if(r.axes){const t=i.shape;for(const e in r.axes){const i=Number(e),s=r.axes[e],o=i>=0?t[i]:t[t.length+i];if(null!=s&&-1===[s,null].indexOf(o))throw new kn(`Input ${n} is incompatible with layer ${this.name}: expected axis ${i} of input shape to have value ${s} but got shape ${t}.`)}}if(null!=r.shape)for(let t=0;t<r.shape.length;++t){const e=r.shape[t],s=i.shape[t];if(null!=e&&null!=s&&e!==s)throw new kn(`Input ${n} is incompatible with layer ${this.name}: expected shape=${r.shape}, found shape=${i.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){null!=this._callHook&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const n=Nn(t);let i=!0;for(const t of n)if(!(t instanceof vr)){i=!1;break}let r=!0;for(const t of n)if(t instanceof vr){r=!1;break}if(i===r)throw new kn("Arguments to apply() must be all SymbolicTensors or all Tensors");return fi(this.name,(()=>{if(!this.built){this.assertInputCompatibility(t);const e=[];for(const n of Nn(t))e.push(n.shape);this.build(On(e)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&r&&(this._refCount=1)}if(this.assertInputCompatibility(t),r){let i=this.call(t,e);const r=Nn(i),s=[];for(let t of r)-1!==n.indexOf(t)&&(t=t.clone()),s.push(t);if(i=On(s),null!=this.activityRegularizer)throw new Cn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}{const n=function(t){t=Nn(t);const e=[];for(const n of t)e.push(n.shape);return On(e)}(t),i=this.computeOutputShape(n);let r;const s="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(t)?n[0]:n),r=null!=i&&i.length>0&&Array.isArray(i[0])?i.map(((n,i)=>new vr(s,n,this,Nn(t),e,this.name,i))):new vr(s,i,this,Nn(t),e,this.name),this.addInboundNode(t,r,null,null,n,i,e),this._refCount++,null!=this.activityRegularizer)throw new Cn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}}))}warnOnIncompatibleInputShape(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach(((n,i)=>{null!=n&&null!=t[i]&&t[i]!==n&&(e=!0)})),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new An(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const n=JSON.stringify(e.outputShapes);-1===t.indexOf(n)&&t.push(n)}if(1===t.length){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&1===t.length?t[0]:t}throw new An(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new _n(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return dr(this.weights)}build(t){this.built=!0}getWeights(t=!1){return gr(t?this.trainableWeights:this.weights)}setWeights(t){(0,i.tidy)((()=>{const e=this.weights;if(e.length!==t.length)throw new kn(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(0===e.length)return;const n=[],r=gr(e);for(let s=0;s<r.length;++s){const o=r[s],a=e[s],u=t[s];if(!i.util.arraysEqual(o.shape,u.shape))throw new kn(`Layer weight shape ${o.shape} not compatible with provided weight shape ${u.shape}`);n.push([a,u])}mr(n)}))}addWeight(t,e,n,i,r,s,o,a){if(-1!==this._addedWeightNames.indexOf(t))throw new kn(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(i=null!=a?a():rr("zeros"));const u=i.apply(e,n),l=new pr(u,n,t,s,o);return u.dispose(),null!=r&&this.addLoss((()=>r.apply(l.read()))),null==s&&(s=!0),s?this._trainableWeights.push(l):this._nonTrainableWeights.push(l),l}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){null==t||Array.isArray(t)&&0===t.length||(t=Nn(t),void 0!==this._losses&&null!==this._losses&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);e.forEach((t=>{if(null!=t)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)}))}return null}return e}addInboundNode(t,e,n,i,r,s,o=null){const a=Nn(t);e=Nn(e),n=Nn(n),i=Nn(i),r=cr(r),s=cr(s);const u=[],l=[],c=[];for(const t of a)u.push(t.sourceLayer),l.push(t.nodeIndex),c.push(t.tensorIndex);new xr({outboundLayer:this,inboundLayers:u,nodeIndices:l,tensorIndices:c,inputTensors:a,outputTensors:e,inputMasks:n,outputMasks:i,inputShapes:r,outputShapes:s},o);for(let t=0;t<e.length;t++)e[t].sourceLayer=this,e[t].nodeIndex=this.inboundNodes.length-1,e[t].tensorIndex=t}getConfig(){const t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach((t=>t.dispose())),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return 0==--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function _r(t,e,n){if((null==e||null!=n&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),0===e.inboundNodes.length)return[t];{const t=e.inboundNodes[n];if(0===t.inboundLayers.length)return t.inputTensors;{const e=[];for(let n=0;n<t.inboundLayers.length;n++){const i=_r(t.inputTensors[n],t.inboundLayers[n],t.nodeIndices[n]);for(const t of i)-1===e.indexOf(t)&&e.push(t)}return e}}}class kr extends Ar{constructor(t){if(super({dtype:t.dtype,name:null!=t.name?t.name:ur("input").toString()}),null==t.batchSize&&(t.batchSize=null),null==t.sparse&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,null!=t.inputShape&&null!=t.batchInputShape)throw new kn("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(null==e){if(null==t.inputShape)throw new kn("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(null!=t.batchSize)throw new kn("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=t.dtype||"float32";this.batchInputShape=e,this.dtype=n,this.inputSpec=[{shape:e}];const i=new vr(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new xr({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new kn(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}async function Cr(t){if(null==t)return;const e=[],n=[],r=[];for(const i in t){const s=t[i];if("number"!=typeof s){const t=s;e.push(t.data()),n.push(i),r.push(t)}}if(e.length>0){const s=await Promise.all(e);for(let e=0;e<s.length;++e)t[n[e]]=s[e][0];(0,i.dispose)(r)}}function Er(t){if(null!=t)for(const e in t){const n=t[e];"number"!=typeof n&&n.dispose()}}var Dr;kr.className="InputLayer",i.serialization.registerClass(kr),function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"}(Dr||(Dr={}));class Fr{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class Sr{constructor(t,e=10){null==t&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochBegin(t,e)}async onEpochEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochEnd(t,e)}async onBatchBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchBegin(t,e)}async onBatchEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchEnd(t,e)}async onTrainBegin(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class Or extends Fr{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){null==e&&(e={});const n=null==e.size?0:e.size;this.seen+=n;for(const t in e){const r=e[t];if("number"==typeof r)this.totals.hasOwnProperty(t)||(this.totals[t]=0),this.totals[t]=this.totals[t]+r*n;else{let e;t in this.totals?e=this.totals[t]:this.totals[t]=0;const s=(0,i.tidy)((()=>(0,i.add)(this.totals[t],(0,i.mul)(r,n))));this.totals[t]=s,null!=e&&e.dispose()}}}async onEpochEnd(t,e){if(null!=e)for(const t of this.params.metrics)null!=this.totals[t]&&("number"==typeof this.totals[t]?e[t]=this.totals[t]/this.seen:(0,i.tidy)((()=>{const n=(0,i.mul)((0,i.div)(1,this.seen),this.totals[t]);e[t]=n,this.totals[t].dispose(),(0,i.keep)(e[t])})))}}class Nr extends Fr{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){null==e&&(e={}),this.epoch.push(t);for(const t in e)null==this.history[t]&&(this.history[t]=[]),this.history[t].push(e[t])}async syncData(){const t=[],e=[],n=[];for(const i in this.history){const r=this.history[i];for(let s=0;s<r.length;++s)if("number"!=typeof r[s]){const o=r[s];t.push(o.data()),e.push(i),n.push(s)}}const i=await Promise.all(t);for(let t=0;t<i.length;++t)this.history[e[t]][n[t]].dispose(),this.history[e[t]][n[t]]=i[t][0]}}class Mr extends Fr{constructor(t,e){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||i.nextFrame,this.yieldEvery=e||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=t.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");i.util.isNumber(this.yieldEvery)&&(this.maybeWait=function(t,e,n){let r,s=null!=n?n():i.util.now();return(...o)=>{const a=null!=n?n():i.util.now();return a-s<e||(s=a,r=t(...o)),r}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,n){const i=[];null!=this.yield&&(await Cr(n),i.push(this.yield(t,e,n))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(t,e){this.currentEpoch=t,null!=this.epochBegin&&(await Cr(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const n=[];null!=this.epochEnd&&(await Cr(e),n.push(this.epochEnd(t,e))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(t,e){null!=this.batchBegin&&(await Cr(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const n=[];null!=this.batchEnd&&(await Cr(e),n.push(this.batchEnd(t,e))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):i.util.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(n)}async onTrainBegin(t){null!=this.trainBegin&&(await Cr(t),await this.trainBegin(t))}async onTrainEnd(t){null!=this.trainEnd&&(await Cr(t),await this.trainEnd(t))}}function zr(t,e){return null==t&&(t={}),t instanceof Fr?[t]:Array.isArray(t)&&t[0]instanceof Fr?t:Nn(t).map((t=>new Mr(t,e)))}class $r{constructor(){}static registerCallbackConstructor(t,e){i.util.assert(t>=0&&Number.isInteger(t),(()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`)),$r.checkForDuplicate(e),null==$r.constructors[t]&&($r.constructors[t]=[]),$r.constructors[t].push(e)}static checkForDuplicate(t){for(const e in $r.constructors)$r.constructors[+e].forEach((e=>{if(e===t)throw new kn("Duplicate callback constructor.")}))}static clear(){$r.constructors={}}static createCallbacks(t){const e=[];for(const n in $r.constructors){const i=+n;t>=i&&e.push(...$r.constructors[i])}return e.map((t=>new t))}}function Tr(t,e,n,i,r,s,o,a,u){const l=new Nr,c=[new Or,...$r.createCallbacks(e)];null!=t&&c.push(...t),c.push(l);const h=new Sr(c);return h.setParams({epochs:n,initialEpoch:i,samples:r,steps:s,batchSize:o,verbose:e,doValidation:a,metrics:u}),{callbackList:h,history:l}}function Br(t,e={},n=!1){return jn(t,i.serialization.SerializationMap.getMap().classNameMap,e,"layer",n)}function jr(t,e){return(0,i.tidy)((()=>{"float32"!==t.dtype&&(t=i.cast(t,"float32"));const n=i.sum(Mi(t),e,!0),r=i.fill(n.shape,wn()),s=i.sqrt(i.maximum(n,r));return i.div(t,s)}))}function Ir(t,e){return(0,i.tidy)((()=>i.mean(Mi(i.sub(e,t)),-1)))}function Rr(t,e){return(0,i.tidy)((()=>i.mean(i.abs(i.sub(e,t)),-1)))}function Lr(t,e){return(0,i.tidy)((()=>{const n=i.sub(t,e),r=i.clipByValue(i.abs(t),wn(),Number.MAX_VALUE),s=i.abs(i.div(n,r));return i.mul(100,i.mean(s,-1))}))}function Pr(t,e,n=!1){return(0,i.tidy)((()=>{if(n)e=i.softmax(e);else{const t=i.sum(e,e.shape.length-1,!0);e=i.div(e,t)}return e=i.clipByValue(e,wn(),1-wn()),i.neg(i.sum(i.mul(i.cast(t,"float32"),i.log(e)),e.shape.length-1))}))}function Ur(t,e,n=!1){return(0,i.tidy)((()=>{const r=i.cast(i.floor(function(t){const e=[yi(t.shape)];return i.reshape(t,e)}(t)),"int32"),s=(e=i.clipByValue(e,wn(),1-wn())).shape;return Pr(i.reshape(i.oneHot(r,s[s.length-1]),s),e,n)}))}function qr(t,e){return(0,i.tidy)((()=>{let n;return n=i.clipByValue(e,wn(),1-wn()),n=i.log(i.div(n,i.sub(1,n))),i.mean(function(t,e){if(!i.util.arraysEqual(t.shape,e.shape))throw new kn(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return(0,i.tidy)((()=>{const n=i.relu(e),r=i.neg(i.abs(e));return i.add(i.sub(n,i.mul(e,t)),i.log1p(i.exp(r)))}))}(t,n),-1)}))}function Wr(t,e){return(0,i.tidy)((()=>{const n=jr(t,-1),r=jr(e,-1),s=i.mul(n,r);return i.neg(i.sum(s,-1))}))}$r.constructors={};const Hr={meanSquaredError:Ir,meanAbsoluteError:Rr,meanAbsolutePercentageError:Lr,meanSquaredLogarithmicError:function(t,e){return(0,i.tidy)((()=>{const n=i.clipByValue(e,wn(),Number.MAX_VALUE),r=i.log(i.add(1,n)),s=i.clipByValue(t,wn(),Number.MAX_VALUE),o=i.log(i.add(1,s));return i.mean(Mi(i.sub(r,o)),-1)}))},squaredHinge:function(t,e){return(0,i.tidy)((()=>{const n=i.maximum(0,i.sub(1,i.mul(t,e)));return i.mean(Mi(n),-1)}))},hinge:function(t,e){return(0,i.tidy)((()=>{const n=i.maximum(0,i.sub(1,i.mul(t,e)));return i.mean(n,-1)}))},categoricalHinge:function(t,e){return(0,i.tidy)((()=>{const n=i.sum(i.mul(t,e),-1),r=i.max(i.mul(i.sub(1,t),e),-1);return i.maximum(0,i.add(1,i.sub(r,n)))}))},logcosh:function(t,e){return(0,i.tidy)((()=>{const n=Math.log(2),r=i.sub(e,t),s=i.sub(i.add(r,i.softplus(i.mul(-2,r))),n);return i.mean(s,-1)}))},categoricalCrossentropy:Pr,sparseCategoricalCrossentropy:Ur,binaryCrossentropy:qr,kullbackLeiblerDivergence:function(t,e){return(0,i.tidy)((()=>{const n=i.clipByValue(t,wn(),1),r=i.clipByValue(e,wn(),1);return i.sum(i.mul(t,i.log(i.div(n,r))),-1)}))},poisson:function(t,e){return(0,i.tidy)((()=>{const n=i.log(i.add(wn(),e));return i.mean(i.sub(e,i.mul(t,n)),-1)}))},cosineProximity:Wr};function Vr(t){if("string"==typeof t){if(t in Hr)return Hr[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new kn(e)}return t}function Gr(t,e){return(0,i.tidy)((()=>{const n=i.mul(.5,i.onesLike(e)),r=wi(i.greater(e,n),t.dtype);return i.mean(i.equal(t,r),-1)}))}function Xr(t,e){return(0,i.tidy)((()=>wi(i.equal(i.argMax(t,-1),i.argMax(e,-1)),"float32")))}function Yr(t,e){return qr(t,e)}function Jr(t,e){return t.rank===e.rank&&(t=i.squeeze(t,[t.rank-1])),(e=i.argMax(e,-1)).dtype!==t.dtype&&(e=i.cast(e,t.dtype)),i.cast(i.equal(t,e),"float32")}const Zr=Pr,Kr=Ur,Qr={binaryAccuracy:Gr,categoricalAccuracy:Xr,precision:function(t,e){return(0,i.tidy)((()=>{const n=function(t,e){return(0,i.tidy)((()=>i.cast(i.sum(i.logicalAnd(i.equal(t,1),i.equal(e,1))),"float32")))}(t,e),r=function(t,e){return(0,i.tidy)((()=>i.cast(i.sum(i.logicalAnd(i.equal(t,0),i.equal(e,1))),"float32")))}(t,e),s=i.add(n,r);return i.cast(i.where(i.greater(s,0),i.div(n,s),0),"float32")}))},categoricalCrossentropy:Zr,sparseCategoricalCrossentropy:Kr,mse:Ir,MSE:Ir,mae:Rr,MAE:Rr,mape:Lr,MAPE:Lr,cosine:Wr};function ts(t){if("string"==typeof t&&t in Qr)return Qr[t];if("string"!=typeof t&&null!=t)return t;throw new kn(`Unknown metric ${t}`)}function es(t){if(Fn(null!==t,`Unknown LossOrMetricFn ${t}`),"string"==typeof t)return t;{let e;for(const n of Object.keys(Hr))if(Hr[n]===t){e=n;break}if(void 0!==e)return e;for(const n of Object.keys(Qr))if(Qr[n]===t){e=n;break}return void 0!==e?e:t.name}}function ns(t,e,n=!1){if(null==t||"object"!=typeof t||Object.getPrototypeOf(t)!==Object.prototype||!is(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(t);n.length>1048576&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function is(t){if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e){if("string"!=typeof n)return!1;if(!is(t[n]))return!1}return!0}if(Array.isArray(t)){for(const e of t)if(!is(e))return!1;return!0}return!1}{const e=typeof t;return"string"===e||"number"===e||"boolean"===e}}function rs(t,e,n=console.log){let i="";for(let n=0;n<t.length;++n)n>0&&(i=i.slice(0,i.length-1)+" "),i+=t[n],i=i.slice(0,e[n]),i+=" ".repeat(e[n]-i.length);n(i)}function ss(t,e,n){let i;try{i=JSON.stringify(t.outputShape)}catch(t){i="multiple"}rs([`${t.name} (${t.getClassName()})`,i,t.countParams().toString()],e,n)}function os(t,e,n,i){let r;try{r=JSON.stringify(t.outputShape)}catch(t){r="multiple"}const s=[];for(const e of t.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(e)))for(let t=0;t<e.inboundLayers.length;++t){const n=e.inboundLayers[t].name,i=e.nodeIndices[t],r=e.tensorIndices[t];s.push(`${n}[${i}][${r}]`)}const o=t.name,a=t.getClassName(),u=0===s.length?"":s[0];rs([`${o} (${a})`,r,t.countParams().toString(),u],e,i);for(let t=1;t<s.length;++t)rs(["","","",s[t]],e,i)}function as(t,e,n){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"==typeof n}function us(t,e){if(null===t)return null;if("string"==typeof t)return zn(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const n=[],i=t.length;for(let r=0;r<i;++r){const i=t[r];as(e,r,i)?n.push(i):n.push(us(i,e))}return n}{const e={};for(const n of Object.keys(t)){const i=t[n];if("name"===n&&"string"==typeof i)e[n]=i;else{const t=zn(n);e[t]=us(i,t)}}return e}}function ls(t,e){if(null==t)return null;if("string"==typeof t)return Mn(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const n=[],i=t.length;for(let r=0;r<i;++r){const i=t[r];as(e,r,i)?n.push(i):n.push(ls(i,e))}return n}{const e={};for(const n of Object.keys(t)){const i=t[n];e[Mn(n)]="name"!==n&&"className"!==n||"string"!=typeof i?ls(i,n):i}return e}}class cs{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof cs)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(null==t)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,n){if(null!=this.id2Value[t.id])throw new kn(`Duplicate key: name=${t.name}, id=${t.id}`);return this.id2Value[t.id]=function(t,e){if(null==t.dtype||t.dtype===e.dtype)return e;try{return(0,i.cast)(e,t.dtype)}catch(n){throw new kn(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}(t,e),this.name2Id[t.name]=t.id,null!=n&&(this.id2Mask[t.id]=n),this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return null!=this.id2Value[t.id]}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof vr){if(null==this.id2Value[t.id])throw new kn(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}{const e=this.name2Id[t];if(null==e)throw new kn(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof vr){if(null==this.id2Value[t.id])throw new kn(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}{const e=this.name2Id[t];if(null==e)throw new kn(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){null!=this.id2Mask&&(0,i.dispose)(this.id2Mask)}}const hs={},fs={};function ds(t,e,n,r){const s=null!=n&&n.training,o=Array.isArray(t),a=o?t:[t],u=a.map((t=>t.name)),l=[],c=e.names();for(const t of u)-1!==c.indexOf(t)?l.push(e.getValue(t)):l.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const h=u.join(",")+"|"+e.names().join(",");let f,d;if(null==hs[h]){const t=function(t,e){i.util.assert(null!=t&&t.length>0,(()=>"Expected at least one fetch, got none"));let n=[],r={};if(1===t.length){const i=gs(t[0],e);n=i.sorted,r=i.recipientMap}else{const i=new Set;for(const s of t){const{sorted:t,recipientMap:o}=gs(s,e);for(const e of t)i.has(e.name)||(n.push(e),i.add(e.name));for(const t in o)null==r[t]&&(r[t]=new Set),o[t].forEach((e=>r[t].add(e)))}}return{sorted:n,recipientCounts:ps(r)}}(a,e);f=t.sorted,d=t.recipientCounts,hs[h]=f,fs[h]=d}f=hs[h],d={},s||Object.assign(d,fs[h]);const p=new cs(e);for(let t=0;t<f.length;++t){if(null!=r){const t=(0,i.memory)().numTensors;t>r.maxNumTensors&&(r.maxNumTensors=t),t<r.minNumTensors&&(r.minNumTensors=t)}const o=f[t],a=o.sourceLayer;if(a instanceof kr)continue;const c=[],h=[],g=[];let m=!1;for(const t of o.inputs){const n=p.getValue(t),i=p.getMask(t);c.push(n),h.push(i),null!=i&&(m=!0),s||(d[t.name]--,0!==d[t.name]||e.hasKey(t)||-1!==u.indexOf(t.name)||n.isDisposed||!0===t.sourceLayer.stateful||g.push(n))}m&&((n=n||{}).mask=h[0]);const y=Nn(a.apply(c,n));let v=null;a.supportsMasking&&(v=a.computeMask(c,h));const b=ms(o),x=Array.isArray(b)?b:[b];for(let t=0;t<x.length;++t){p.hasKey(x[t])||p.add(x[t],y[t],Array.isArray(v)?v[0]:v);const e=u.indexOf(x[t].name);-1!==e&&(l[e]=y[t])}s||(0,i.dispose)(g)}return p.disposeMasks(),o?l:l[0]}function ps(t){const e={};for(const n in t)e[n]=t[n].size;return e}function gs(t,e){const n=new Set,i=[],r={};for(const t of e.names())n.add(t);const s=[],o=[];for(s.push(t);s.length>0;){const t=s[s.length-1];if(n.has(t.name)){s.pop();continue}const e=o[o.length-1]===s.length-1;if(0===t.inputs.length||e)s.pop(),i.push(t),n.add(t.name),e&&o.pop();else{o.push(s.length-1);for(const e of t.inputs)null==r[e.name]&&(r[e.name]=new Set),r[e.name].add(t.name),n.has(e.name)||s.push(e)}}return{sorted:i,recipientMap:r}}function ms(t){let e;if(1===t.sourceLayer.inboundNodes.length)e=t.sourceLayer.output;else{let n=null;for(let e=0;e<t.sourceLayer.inboundNodes.length;++e)for(const i of t.sourceLayer.inboundNodes[e].outputTensors)if(i.id===t.id){n=e;break}e=t.sourceLayer.getOutputAt(n)}return e}class ys extends Ar{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,null==this.name){const t=this.getClassName().toLowerCase();this.name=ur(t)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],Rn(this.inputs).length!==this.inputs.length)throw new kn(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map((t=>t.name))}`);Rn(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map((t=>t.name))}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const t of this.outputs){const e=t.sourceLayer,n=t.nodeIndex,i=t.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(n),this.outputLayersTensorIndices.push(i)}for(const t of this.inputs){const e=t.sourceLayer,n=t.nodeIndex,i=t.tensorIndex;Fn(0===n,"input layer has >1 nodes"),Fn(0===i,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(n),this.inputLayersTensorIndices.push(i)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let e=0;e<this.inputLayers.length;e++){const n=this.inputLayers[e];if(!(n instanceof kr))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${e} (0-based) originates from layer type ${n.getClassName()}.`);this.inputNames.push(n.name),this.feedInputShapes.push(n.batchInputShape),this.feedInputNames.push(n.name)}for(const t of this.outputLayers)this.outputNames.push(t.name);this.internalInputShapes=this.inputs.map((t=>t.shape)),this.internalOutputShapes=this.outputs.map((t=>t.shape));const e={},n={},i={},r={},s={},o=[],a=(t,e,n,i,r,u)=>{null!=i&&null!=r&&null!=u||(i=t.sourceLayer,r=t.nodeIndex,u=t.tensorIndex);const l=i.inboundNodes[r];if(-1!==n.indexOf(l))throw new _n(`The tensor ${t.name} at layer "${i.name}" is part of a cycle.`);if(-1!==e.indexOf(l))return;this.containerNodes.add(ys.nodeKey(i,r)),i.id in s||(s[i.id]=Object.keys(s).length),-1===n.indexOf(l)&&n.push(l);const c=l.inboundLayers.length;for(let t=0;t<c;t++){const i=l.inputTensors[t],r=l.inboundLayers[t],s=l.nodeIndices[t],o=l.tensorIndices[t];a(i,e,n,r,s,o)}for(e.push(l);n.indexOf(l)>=0;)n.splice(n.indexOf(l),1);o.push(l)},u=[],l=[];for(const t of this.outputs)a(t,u,l);const c=o.slice().reverse();for(const t of c){n[t.id]=t,t.id in e||(e[t.id]=0);let s=e[t.id];const o=null==i[t.outboundLayer.id]?0:i[t.outboundLayer.id];s=Math.max(s,o),i[t.outboundLayer.id]=s,r[t.outboundLayer.id]=t.outboundLayer,e[t.id]=s;for(let i=0;i<t.inboundLayers.length;i++){const r=t.inboundLayers[i],o=t.nodeIndices[i],a=r.inboundNodes[o],u=null==e[a.id]?0:e[a.id];e[a.id]=Math.max(s+1,u),n[a.id]=a}}const h={};for(const t in e){const i=e[t];i in h||(h[i]=[]),h[i].push(n[t])}const f={};for(const t in i){const e=i[t];e in f||(f[e]=[]),f[e].push(r[t])}let d=Object.keys(f).map((t=>parseInt(t,10))).sort(In);this.layers=[];for(const t of d){const e=f[t];e.sort(((t,e)=>{const n=s[t.id],i=s[e.id];return n<i?-1:n>i?1:0}));for(const t of e)t instanceof ys&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=f,d=Object.keys(h).map((t=>parseInt(t,10))).sort(In);const p=this.inputs.slice(),g=[];for(const t of d)for(const e of h[t]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===p.indexOf(n))throw new _n(`Graph disconnected: cannot obtain value for tensor ${n} at layer "${t.name}". The following previous layers were accessed without issue: ${g}`);for(const t of e.outputTensors)p.push(t);g.push(t.name)}}this.nodesByDepth=h;const m=this.layers.map((t=>t.name));for(const t of m){const e=m.filter((e=>e===t)).length;if(1!==e)throw new _n(`The name "${t}" is used ${e} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(m))}this.outboundNodes=[],this.inboundNodes=[],new xr({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map((t=>null)),outputMasks:this.outputs.map((t=>null)),inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs.map((t=>t.shape))}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach((e=>{e._trainableWeights.forEach((e=>e.trainable=t))})),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new kn("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.layers)e.push(...t.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const n={};let i=0;for(const t of this.layers)for(const e of t.weights){if(null!=n[e.originalName])throw new kn(`Duplicate weight name: ${e.originalName}`);n[e.originalName]=e,i++}const r=[];for(const i in t){let s=i;if(null==n[i]){const t=i.split("/");s=t.slice(0,-2).concat([t[t.length-1]]).join("/")}if(null!=n[s])r.push([n[s],t[i]]);else if(e)throw new kn(`Provided weight data has no target variable: ${i}`);delete n[s]}if(e){const t=[];for(const e in n)t.push(e);if(t.length>0)throw new kn(`${t.length} of ${i} weights are not set: ${t}`)}mr(r)}updatedConfig(){const t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion="tfjs-layers 3.13.0",e.backend="TensorFlow.js",e}toJSON(t,e=!0){const n=ls(this.updatedConfig());return e?JSON.stringify(n):n}call(t,e){return(0,i.tidy)((()=>{t=Nn(t);const n=new cs;for(let e=0;e<this.inputs.length;++e)n.add(this.inputs[e],t[e]);return ds(this.outputs,n,e)}))}computeMask(t,e){return(0,i.tidy)((()=>{let n;return t=Nn(t),n=null==e?Dn(null,t.length):Nn(e),this.runInternalGraph(t,n)[1]}))}computeOutputShape(t){const e=cr(t);if(e.length!==this.inputLayers.length)throw new kn(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let t=0;t<e.length;t++){const i=this.inputLayers[t],r=e[t];n[i.name+"_0_0"]=r}const i=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(In);if(i.length>1)for(const t of i){const e=this.nodesByDepth[t];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map((t=>t.id)).indexOf(e.id))continue;const i=[];for(let e=0;e<t.inboundLayers.length;e++){const r=t.inboundLayers[e],s=t.nodeIndices[e],o=t.tensorIndices[e],a=n[`${r.name}_${s}_${o}`];i.push(a)}const r=cr(e.computeOutputShape(On(i))),s=e.inboundNodes.indexOf(t);for(let t=0;t<r.length;t++)n[`${e.name}_${s}_${t}`]=r[t]}}const r=[],s=[];for(let t=0;t<this.outputLayers.length;t++){const e=this.outputLayers[t],n=this.outputLayersNodeIndices[t],i=this.outputLayersTensorIndices[t],r=`${e.name}_${n}_${i}`;s.push(r)}for(let t=0;t<s.length;t++){const e=s[t];Fn(e in n),r.push(n[e])}return On(r)}runInternalGraph(t,e){null==e&&(e=Dn(null,t.length));const n={};for(let i=0;i<this.inputs.length;++i){const r=this.inputs[i],s=t[i],o=e[i];n[r.id]=[s,o]}const i=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(In);for(const t of i){const e=this.nodesByDepth[t];for(const t of e){const e=t.outboundLayer,i=t.inputTensors,r=t.outputTensors,s=new Array;for(const t of i)t.id in n&&s.push(n[t.id]);if(s.length===i.length){let i,o,a,u,l={};if(null!=t.callArgs&&(l=t.callArgs),1===s.length){const[t,n]=s[0];null==l.mask&&(l.mask=n),a=Nn(e.call(t,l)),u=Nn(e.computeMask(t,n)),i=[t],o=[n]}else i=s.map((t=>t[0])),o=s.map((t=>t[1])),null==l.mask&&(l.mask=o),a=Nn(e.call(i,l)),u=Nn(e.computeMask(i,o));if(e.activityRegularizer)throw new Cn("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let t=0;t<r.length;++t){const e=r[t],i=a[t],s=u[t];n[e.id]=[i,s]}}}}const r=[],s=[],o=[];for(const t of this.outputs){Fn(t.id in n,`Could not compute output ${t.name} : ${t.id}`);const[e,i]=n[t.id];o.push(e.shape),r.push(e),s.push(i)}return[r,s,o]}buildNodeConversionMap(t){const e={};let n;for(const t of this.layers){n=t instanceof ys?1:0;for(let i=0;i<t.inboundNodes.length;i++){const r=ys.nodeKey(t,i);this.containerNodes.has(r)&&(e[r]=n,n+=1)}}return e}getLayer(t,e){if(null!=e){if(this.layers.length<=e)throw new kn(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}if(null==t)throw new kn("Provide either a layer name or layer index");for(const e of this.layers)if(e.name===t)return e;throw new kn(`No such layer: ${t}`)}calculateLosses(){return(0,i.tidy)((()=>{const t=[];for(const e of this.layers)for(let n=0;n<e.inboundNodes.length;++n){const i=ys.nodeKey(e,n);this.containerNodes.has(i)&&t.push(...e.calculateLosses())}return t}))}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),n=[];for(const t of this.layers){const i=t.getClassName(),r=t.getConfig(),s=[];for(let n=0;n<t.inboundNodes.length;n++){const i=t.inboundNodes[n],r=ys.nodeKey(t,n);let o={};if(this.containerNodes.has(r)){if(i.callArgs)try{JSON.stringify(i.callArgs),o=i.callArgs}catch(e){console.warn(`Layer ${t.name} was passed non-serializable keyword arguments: ${i.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),o={}}if(i.inboundLayers.length>0){const t=[];for(let n=0;n<i.inboundLayers.length;n++){const r=i.inboundLayers[n],s=i.nodeIndices[n],a=i.tensorIndices[n];let u=e[ys.nodeKey(r,s)];null==u&&(u=0),t.push([r.name,u,a,o])}s.push(t)}}}const o={};o.name=t.name,o.className=i,o.config=r,o.inboundNodes=s,n.push(o)}t.layers=n;const i=[];for(let t=0;t<this.inputLayers.length;t++){const n=this.inputLayers[t],r=this.inputLayersNodeIndices[t],s=ys.nodeKey(n,r);if(!this.containerNodes.has(s))continue;let o=e[s];null==o&&(o=0);const a=this.inputLayersTensorIndices[t];i.push([n.name,o,a])}t.inputLayers=i;const r=[];for(let t=0;t<this.outputLayers.length;t++){const n=this.outputLayers[t],i=this.outputLayersNodeIndices[t],s=ys.nodeKey(n,i);if(!this.containerNodes.has(s))continue;let o=e[s];null==o&&(o=0);const a=this.outputLayersTensorIndices[t];r.push([n.name,o,a])}return t.outputLayers=r,t}static fromConfig(t,e,n={},i=!1){const r={},s={};function o(t,e){t.name in s?s[t.name].push(e):s[t.name]=[e]}function a(t,e){const n=[];let i;for(const s of e){const a=s[0],u=s[1],l=s[2];if(i=null==s[3]?{}:s[3],!(a in r))return void o(t,e);const c=r[a];if(c.inboundNodes.length<=u)return void o(t,e);const h=c.inboundNodes[u];n.push(h.outputTensors[l])}n.length>0&&t.apply(On(n),i)}function u(t){const n=t.name,s=Br(t,null!=e.customObjects?e.customObjects:{});s.setFastWeightInitDuringBuild(i),r[n]=s,t.inboundNodes.forEach((t=>{if(!(t instanceof Array))throw new kn(`Corrupted configuration, expected array for nodeData: ${t}`);o(s,t)}))}const l=e.name,c=e.layers;for(const t of c)u(t);for(;!Ln(s);)for(const t of c){const e=r[t.name];if(e.name in s){const t=s[e.name];delete s[e.name];for(const n of t)a(e,n)}}const h=[],f=[],d=e.inputLayers;for(const t of d){const e=t[0],n=t[1],i=t[2];Fn(e in r);const s=r[e].inboundNodes[n].outputTensors;h.push(s[i])}const p=e.outputLayers;for(const t of p){const e=t[0],n=t[1],i=t[2];Fn(e in r);const s=r[e].inboundNodes[n].outputTensors;f.push(s[i])}return new t({inputs:h,outputs:f,name:l})}get stateful(){if(this._stateful)throw new kn("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){(0,i.tidy)((()=>{this.layers.forEach((t=>{t.stateful&&t.resetStates()}))}))}}function vs(t,e){return function(t,e,n){const i=e.length;if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>null));if(1===i)return Array.isArray(t)&&1===t.length?t:"object"==typeof t&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==i)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${i} outputs. Make sure a set of weights is provided for each model output.`);return t}if("object"==typeof t&&Object.keys(t).length>0&&"object"==typeof t[Object.keys(t)[0]]){const n=[];return e.forEach((e=>{e in t?n.push(t[e]):n.push(null)})),n}throw new Error(`The model has multiple (${i}) outputs, so ${n} must be either an array with ${i} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}(t,e,"classWeight")}async function bs(t,e,n,r){if(null!=e||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const e=(0,i.tidy)((()=>{if(1===t.shape.length)return(0,i.clone)(t);if(2===t.shape.length){if(t.shape[1]>1){const e=1;return(0,i.argMax)(t,e)}if(1===t.shape[1])return(0,i.reshape)(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)})),r=Array.from(await e.data());(0,i.dispose)(e);const s=[];return r.forEach((t=>{if(null==n[t])throw new Error(`classWeight must contain all classes in the training data. The class ${t} exists in the data but not in classWeight`);s.push(n[t])})),(0,i.tensor1d)(s,"float32")}return null}function xs(t,e){return(0,i.mul)(t,e)}function ws(t,e){let n,r;const s=e;n=s.xs,r=s.ys,i.util.assert(null!=n&&null!=r,(()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`));const o=As("input",t.inputNames,n),a=As("output",t.outputNames,r),u=o[0].shape[0];i.util.assert(o.length===t.inputs.length,(()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`)),i.util.assert(a.length===t.outputs.length,(()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${a.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`));for(let e=0;e<o.length;e++)i.util.assert(o[e].shape[0]===u,(()=>`Batch size mismatch: input ${t.inputNames[e]} has ${o[e].shape[0]}; expected  ${u} based on input ${t.inputNames[0]}.`));for(let e=0;e<a.length;e++)i.util.assert(a[e].shape[0]===u,(()=>`Batch size mismatch: output ${t.outputNames[e]} has ${a[e].shape[0]}; expected  ${u} based on input ${t.inputNames[0]}.`));return{xs:o,ys:a}}function As(t,e,n){if(n instanceof i.Tensor)return[n];if(Array.isArray(n))return i.util.assert(n.length===e.length,(()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`)),n;{const i=[];for(const r of e){if(null==n[r])throw new kn(`The feature data generated by the dataset lacks the required ${t} key '${r}'.`);i.push(n[r])}return i}}function _s(t){return"function"==typeof t.iterator}function ks(t){i.util.assert(t>0&&Number.isInteger(t),(()=>`batchSize is required to be a positive integer, but got ${t}`))}function Cs(t,e,n){return null==t?[null]:Array.isArray(t)?t.map((t=>_i(t,e,n-e))):_i(t,e,n-e)}function Es(t,e){return i.tidy((()=>null==t?null:Array.isArray(t)?t.map((t=>Es(t,e))):Ni(t,"int32"===e.dtype?e:i.cast(e,"int32"))))}function Ds(t,e){const n=[];let i=0,r=null;for(;i<t;)r=i+e,r>=t&&(r=t),n.push([i,r]),i=r;return n}function Fs(t){const e=[];t instanceof i.Tensor&&(t=[t]);for(let n=0;n<t.length;++n){const i=t[n];if(1===i.rank)e.push(Ai(i,1));else{if(0===i.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(i)}}return e}function Ss(t,e){if(null==t)return;const n=[];if(e instanceof i.Tensor)n.push(e.id);else if(Array.isArray(e))e.forEach((t=>n.push(t.id)));else if(null!=e)for(const t in e){const i=e[t];n.push(i.id)}const r=[];if(t instanceof i.Tensor)-1===n.indexOf(t.id)&&r.push(t);else if(Array.isArray(t))t.forEach((t=>{-1===n.indexOf(t.id)&&r.push(t)}));else if(null!=t)for(const e in t){const i=t[e];-1===n.indexOf(i.id)&&r.push(i)}r.forEach((t=>{t.isDisposed||t.dispose()}))}function Os(t){return Array.isArray(t)}function Ns(t){return!function(t){return t instanceof i.Tensor}(t)&&!Os(t)}function Ms(t,e,n,i=!0,r=""){if(null==e||0===e.length){if(null!=t){let e=!1;if(Os(t)&&t.length>0)e=!0;else if(Ns(t)){for(const n in t)if(t.hasOwnProperty(n)){e=!0;break}}else e=!0;if(e)throw new kn(`Error when checking model ${r} expected no data, but got ${t}`)}return[]}if(null==t)return e.map((t=>null));let s;if(Ns(t)){t=t,s=[];for(const n of e){if(null==t[n])throw new kn(`No data provided for "${n}". Need data for each key in: ${e}`);s.push(t[n])}}else if(Os(t)){if((t=t).length!==e.length)throw new kn(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);s=t}else{if(t=t,e.length>1)throw new kn(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);s=[t]}if(s=Fs(s),null!=n)for(let t=0;t<e.length;++t){if(null==n[t])continue;const o=s[t];if(o.shape.length!==n[t].length)throw new kn(`Error when checking ${r}: expected ${e[t]} to have ${n[t].length} dimension(s). but got array with shape ${o.shape}`);for(let e=0;e<n[t].length;++e){if(0===e&&!i)continue;const s=o.shape[e],a=n[t][e];if(null!=a&&a>=0&&s!==a)throw new kn(`${r} expected a batch of elements where each example has shape [${n[t].slice(1,n[t].length)}] (i.e.,tensor shape [*,${n[t].slice(1,n[t].length)}]) but the ${r} received an input with ${o.shape[0]} examples, each with shape [${o.shape.slice(1,o.shape.length)}] (tensor shape [${o.shape}])`)}}return s}function zs(t,e,n,i=!0,r=""){let s;if(Array.isArray(t)){if(t.length!==e.length)throw new kn(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);s=t}else{if(e.length>1)throw new kn(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);s=[t]}if(null!=n)for(let t=0;t<e.length;++t){if(null==n[t])continue;const o=s[t];if(o.shape.length!==n[t].length)throw new kn(`Error when checking ${r}: expected ${e[t]} to have ${n[t].length} dimension(s), but got array with shape ${JSON.stringify(o.shape)}`);for(let s=0;s<n[t].length;++s){if(0===s&&!i)continue;const a=o.shape[s],u=n[t][s];if(null!=u&&u!==a)throw new kn(`Error when checking ${r}: expected ${e[t]} to have shape ${JSON.stringify(n[t])} but got array with shape ${JSON.stringify(o.shape)}.`)}}}class $s extends ys{constructor(t){super(t),this.isTraining=!1}summary(t,e,n=console.log){if(!this.built)throw new kn("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(t,e,n,i=console.log){const r=function(t){let e=!0;const n=[],i=[];for(const e in t.nodesByDepth)n.push(t.nodesByDepth[e]);for(const t of n){if(t.length>1||1===t.length&&t[0].inboundLayers.length>1){e=!1;break}i.push(...t)}if(e)for(const n of t.layers){let t=!1;for(const r of n.inboundNodes)if(-1!==i.indexOf(r)){if(t){e=!1;break}t=!0}if(!e)break}return e}(t),s=["Layer (type)","Output shape","Param #"];let o;if(r?(e=e||65,n=n||[.45,.85,1]):(e=e||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map((t=>Math.floor(e*t)))),!r){s.push("Receives inputs"),o=[];for(const e in t.nodesByDepth)o.push(...t.nodesByDepth[e])}i("_".repeat(e)),rs(s,n,i),i("=".repeat(e));const a=t.layers;for(let t=0;t<a.length;++t)r?ss(a[t],n,i):os(a[t],n,o,i),i((t===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const u=function(t){let e;return e=null!=t.collectedTrainableWeights?dr(t.collectedTrainableWeights):dr(t.trainableWeights),e}(t),l=dr(t.nonTrainableWeights);i(`Total params: ${u+l}`),i(`Trainable params: ${u}`),i(`Non-trainable params: ${l}`),i("_".repeat(e))}(this,t,e,n)}compile(t){if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"==typeof t.optimizer)this.optimizer_=function(t){const e={Adagrad:()=>i.train.adagrad(.01),Adadelta:()=>i.train.adadelta(1,.95,wn()),Adam:()=>i.train.adam(.001,.9,.999,wn()),Adamax:()=>i.train.adamax(.002,.9,.999,wn(),0),RMSProp:()=>i.train.rmsprop(.001,.9,0,wn()),SGD:()=>i.train.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new kn(`Unknown Optimizer ${t}`)}(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof i.Optimizer))throw new kn("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(Array.isArray(t.loss)||"string"==typeof t.loss||"function"==typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new kn(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);const n=t.loss;e=n.map((t=>Vr(t)))}else{const n=Vr(t.loss);this.outputs.forEach((t=>{e.push(n)}))}else{t.loss=t.loss;for(const e in t.loss)if(-1===this.outputNames.indexOf(e))throw new kn(`Unknown entry in loss dictionary: "${e}". Only expected the following keys: ${this.outputNames}`);for(const n of this.outputNames)null==t.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),e.push(Vr(t.loss[n]))}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let t=0;t<this.outputs.length;++t){const e=this.internalOutputShapes[t],n=this.outputNames[t];this.feedOutputNames.push(n),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[t])}const n=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],fi("loss",(()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;const e=this.lossFunctions[t];this.outputs.length>1&&(this.metricsTensors.push([e,t]),this.metricsNames.push(this.outputNames[t]+"_loss"))}}));const r=function(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>[]));let n;if("string"==typeof t||"function"==typeof t)n=[t];else{if(!Array.isArray(t)&&"object"!=typeof t)throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);n=t}if(Array.isArray(n))return e.map((t=>n));{const t=[];for(const i of e){let e=n.hasOwnProperty(i)?n[i]:[];Array.isArray(e)||(e=[e]),t.push(e)}return t}}(t.metrics,this.outputNames),s=(t,e,n)=>{this.outputNames.length>1&&(e=this.outputNames[t]+"_"+e),this.metricsNames.push(e),this.metricsTensors.push([n,t])};fi("metric",(()=>{for(let t=0;t<this.outputs.length;++t)-1===n.indexOf(t)&&(e=>{let n,i,r;for(const o of e){if("string"==typeof o&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(o)){const e=this.internalOutputShapes[t];let s;1===e[e.length-1]||this.lossFunctions[t]===qr?-1!==["accuracy","acc"].indexOf(o)?i=Gr:-1!==["crossentropy","ce"].indexOf(o)&&(i=Yr):this.lossFunctions[t]===Ur?-1!==["accuracy","acc"].indexOf(o)?i=Jr:-1!==["crossentropy","ce"].indexOf(o)&&(i=Kr):-1!==["accuracy","acc"].indexOf(o)?i=Xr:-1!==["crossentropy","ce"].indexOf(o)&&(i=Zr),-1!==["accuracy","acc"].indexOf(o)?s="acc":-1!==["crossentropy","ce"].indexOf(o)&&(s="ce"),r=i,n=""+s}else{const t=ts(o);r=t,n=""+es(o)}let e;fi(n,(()=>{e=r})),s(t,n,e)}})(r[t])})),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,e,n={}){const i=null==n.batchSize?32:n.batchSize;ks(i);const r=this.standardizeUserDataXY(t,e,!0,i);try{const s=r[0].concat(r[1]);this.makeTestFunction();const o=this.testFunction;return On(this.testLoop(o,s,i,n.verbose,n.steps))}finally{Ss(r[0],t),Ss(r[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),async function(t,e,n){const r=null!=(n=n||{}).batches,s=t.testFunction;let o=[];if(n.verbose>0)throw new Cn("Verbose mode is not implemented yet.");i.util.assert(!r||n.batches>0&&Number.isInteger(n.batches),(()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`));const a="function"==typeof e.next?e:await e.iterator();let u=0,l=0;for(;!r||l<n.batches;){const e=await a.next();if(o=i.tidy((()=>{if(e.value){const{xs:n,ys:r}=ws(t,e.value),a=n.concat(r),c=i.tidy((()=>s(a)));if(i.dispose(a),0===l)for(let t=0;t<c.length;++t)o.push((0,i.scalar)(0));const h=a[0].shape[0];for(let t=0;t<c.length;++t){const e=c[t],n=o[t];o[t]=i.tidy((()=>i.add(o[t],i.mul(h,e)))),l>0&&i.dispose(n)}i.dispose(c),u+=h,++l}return o})),e.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let t=0;t<o.length;++t){const e=o[t];o[t]=i.div(o[t],u),i.dispose(e)}return On(o)}(this,t,e)}checkNumSamples(t,e,n,i="steps"){let r;if(null!=n){if(r=null,null!=e)throw new kn(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${e}`)}else{if(null==t)throw new kn(`Either the input data should have a defined shape, or ${i} shoud be specified.`);r=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return r}execute(t,e){if(Array.isArray(e)&&0===e.length)throw new kn("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(e),r=n?e:[e],s=this.retrieveSymbolicTensors(r),o=new cs;if(t instanceof i.Tensor&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new kn(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let e=0;e<this.inputs.length;++e)o.add(this.inputs[e],t[e])}else for(const e of this.inputs){const n=t[e.name];if(null==n)throw new kn(`No value is provided for the model's input ${e.name}`);o.add(e,n)}const a=ds(s,o);return n?a:a[0]}retrieveSymbolicTensors(t){const e=Dn(null,t.length);let n=t.length;for(const i of this.layers){const r=Array.isArray(i.output)?i.output:[i.output],s=r.map((t=>t.name));for(let i=0;i<t.length;++i){const o=s.indexOf(t[i]);if(-1!==o&&(e[i]=r[o],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw e.forEach(((e,i)=>{null==e&&n.push(t[i])})),new kn(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(n)}`)}return e}predictLoop(t,e=32,n=!1){return i.tidy((()=>{const r=this.checkNumSamples(t);if(n)throw new Cn("Verbose predictLoop() is not implemented yet.");const s=Ds(r,e),o=this.outputs.map((t=>[]));for(let e=0;e<s.length;++e)i.tidy((()=>{const n=s[e][0],i=s[e][1],r=Cs(t,n,i),o=[];if(Array.isArray(r))for(let t=0;t<r.length;++t)o.push({key:this.inputs[t],value:r[t]});else o.push({key:this.inputs[0],value:r});const a=new cs(o);return ds(this.outputs,a)})).forEach(((t,e)=>o[e].push(t)));return On(o.map((t=>i.concat(t,0))))}))}predict(t,e={}){const n=Fs(t);zs(n,this.inputNames,this.feedInputShapes,!1);try{const i=null==e.batchSize?32:e.batchSize;return ks(i),this.predictLoop(n,i)}finally{Ss(n,t)}}predictOnBatch(t){zs(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,n=!0,r){if(null==this.optimizer_)throw new _n("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const s=[];for(let t=0;t<this.feedOutputShapes.length;++t){const e=this.feedOutputShapes[t];this.feedLossFns[t]===Ur?s.push(e.slice(0,e.length-1).concat([1])):s.push(e)}if(function(t,e,n){const r=Rn(t.map((t=>t.shape[0])));r.sort();const s=Rn(e.map((t=>t.shape[0])));if(s.sort(),r.length>1)throw new kn(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map((t=>t.shape)))}`);if(s.length>1)throw new kn(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map((t=>t.shape)))}`);if(r.length>0&&s.length>0&&!i.util.arraysEqual(r,s))throw new kn(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${s[0]} target sample(s).`)}(t=Ms(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=Ms(e,this.feedOutputNames,s,!1,"target")),function(t,e,n){const i=[Ir,qr,Pr];for(let r=0;r<t.length;++r){const s=t[r],o=e[r],a=n[r];if(null!=o){if(o===Pr&&1===s.shape[s.shape.length-1])throw new kn(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==i.indexOf(o)){const t=s.shape.slice(1),e=a.slice(1);for(let n=0;n<t.length;++n){const i=t[n],r=e[n];if(null!=r&&i!==r)throw new kn(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&t[0].shape[0]%r!=0)throw new kn(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,n,i,r=!0,s){const[o,a]=this.standardizeUserDataXY(t,e,r,s);if(null!=n)throw new Error("sample weight is not supported yet.");let u=null;if(null!=i){const t=vs(i,this.outputNames);u=[];for(let e=0;e<t.length;++e)u.push(await bs(a[e],null,t[e]))}return[o,a,u]}testLoop(t,e,n,r=0,s){return i.tidy((()=>{const o=this.checkNumSamples(e,n,s,"steps"),a=[];if(r>0)throw new Cn("Verbose mode is not implemented yet.");if(null!=s)throw new Cn("steps mode in testLoop() is not implemented yet");{const r=Ds(o,n),s=(0,i.tensor1d)(xi(0,o));for(let n=0;n<r.length;++n){const o=r[n][0],u=r[n][1],l=_i(s,o,u-o),c=Es(e,l),h=t(c);if(0===n)for(let t=0;t<h.length;++t)a.push((0,i.scalar)(0));for(let t=0;t<h.length;++t){const e=h[t];a[t]=i.add(a[t],i.mul(u-o,e))}}for(let t=0;t<a.length;++t)a[t]=i.div(a[t],o)}return a}))}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let n=0;n<t.length;++n){const i=t[n];let r=i;Sn(t,i)>1&&(r+=`_${Sn(t.slice(0,n),i)}`),e.push(r)}return e}makeTrainFunction(){return t=>{const e=[],n=t.slice(0,this.inputs.length),r=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),o=[],a=this.collectedTrainableWeights.map((t=>t.read()));return[this.optimizer_.minimize((()=>{const t=[];for(let e=0;e<this.inputs.length;++e)t.push({key:this.inputs[e],value:n[e]});const a=new cs(t),u=ds(this.outputs,a,{training:!0});let l;for(let t=0;t<this.lossFunctions.length;++t){let n=(0,this.lossFunctions[t])(r[t],u[t]);null!=s[t]&&(n=xs(n,s[t]));const o=i.mean(n);e.push(o),l=0===t?n:i.add(l,n)}for(let t=0;t<this.metricsTensors.length;++t){let n;if(this.outputs.length>1&&t<this.outputs.length)n=e[t];else{const e=this.metricsTensors[t][0],s=this.metricsTensors[t][1];n=i.mean(e(r[s],u[s]))}i.keep(n),o.push(n)}return l=i.mean(l),this.calculateLosses().forEach((t=>{l=i.add(l,t)})),l}),!0,a)].concat(o)}}makeTestFunction(){this.testFunction=t=>i.tidy((()=>{const e=[];let n;const r=t.slice(0,this.inputs.length),s=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let t=0;t<this.inputs.length;++t)o.push({key:this.inputs[t],value:r[t]});const a=new cs(o),u=ds(this.outputs,a);for(let t=0;t<this.lossFunctions.length;++t){const r=this.lossFunctions[t],o=i.mean(r(s[t],u[t]));n=0===t?o:i.add(n,o),e.push(n)}for(let t=0;t<this.metricsTensors.length;++t){const n=this.metricsTensors[t][0],r=this.metricsTensors[t][1],o=i.mean(n(s[r],u[r]));e.push(o)}return e}))}async fit(t,e,n={}){return async function(t,e,n,r={}){if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let s,o,a,u,l,c,h,f,d;t.isTraining=!0;try{const p=null==r.batchSize?32:r.batchSize;ks(p);const g=!1,m=await t.standardizeUserData(e,n,r.sampleWeight,r.classWeight,g,p);s=m[0],o=m[1],d=m[2];let y,v=!1;if(null!=r.validationData&&r.validationData.length>0){if(v=!0,2!==r.validationData.length)throw 3===r.validationData.length?new Cn("validationData including sample weights is not supported yet."):new kn(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);l=r.validationData[0],c=r.validationData[1];const e=!0,n=await t.standardizeUserData(l,c,null,null,e,p);h=n[0],f=n[1],y=h.concat(f)}else if(null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1){v=!0;const t=Math.floor(s[0].shape[0]*(1-r.validationSplit)),e=s[0].shape[0];h=Cs(s,t,e),a=s,s=Cs(s,0,t),f=Cs(o,t,e),u=o,o=Cs(o,0,t),y=h.concat(f)}else null!=r.validationSteps&&(v=!0);const b=s.concat(o).concat(d);t.checkTrainableWeightsConsistency();const x=t.makeTrainFunction(),w=t.getDedupedMetricsNames();let A,_;v?(t.makeTestFunction(),A=t.testFunction,_=w.slice().concat(w.map((t=>"val_"+t)))):(A=null,y=[],_=w.slice());const k=zr(r.callbacks,r.yieldEvery);return await async function(t,e,n,r,s,o,a,u,l,c,h,f,d,p,g){null==s&&(s=32),null==o&&(o=1),null==h&&(h=!0),null==d&&(d=0);let m=!1;null!=l&&null!=c&&(m=!0);const y=t.checkNumSamples(n,s,p,"steps_per_epoch");let v;null!=y&&(v=xi(0,y)),null==a&&(a=1);const{callbackList:b,history:x}=Tr(u,a,o,d,y,p,s,m,f);b.setModel(t),t.history=x,await b.onTrainBegin(),t.stopTraining_=!1;for(let a=d;a<o;++a){await b.onEpochBegin(a);const o={};{if("batch"===h)throw new Cn("batch shuffling is not implemneted yet");h&&i.util.shuffle(v);const a=(0,i.tensor1d)(v),u=Ds(y,s);for(let h=0;h<u.length;++h){const f={};if(await b.onBatchBegin(h,f),i.tidy((()=>{const d=u[h][0],p=u[h][1],g=_i(a,d,p-d);f.batch=h,f.size=p-d;const y=Es(n,g),v=e(y);for(let t=0;t<r.length;++t){const e=r[t],n=v[t];f[e]=n,i.keep(n)}if(h===u.length-1&&m){const e=t.testLoop(l,c,s);for(let t=0;t<r.length;++t){const n=r[t],s=e[t];i.keep(s),o["val_"+n]=s}}})),await b.onBatchEnd(h,f),Er(f),t.stopTraining_)break}a.dispose()}if(await b.onEpochEnd(a,o),t.stopTraining_)break}return await b.onTrainEnd(),await t.history.syncData(),t.history}(t,x,b,w,p,r.epochs,r.verbose,k,A,y,r.shuffle,_,r.initialEpoch,null)}finally{t.isTraining=!1,Ss(s,e),Ss(o,n),Ss(a,e),Ss(u,n),Ss(h,l),Ss(f,c),null!=d&&i.dispose(d)}}(this,t,e,n)}async fitDataset(t,e){return async function(t,e,n){const r=null!=n.batchesPerEpoch;if(i.util.assert(null!=t.optimizer,(()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig).")),i.util.assert(null!=n,(()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call.")),i.util.assert(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`)),i.util.assert(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`)),i.util.assert(null==n.validationSplit,(()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead.")),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const s=null!=n.validationData;let o,a;if(s)if(_s(n.validationData))i.util.assert(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`));else{const t=function(t){if(3===t.length)throw new Cn("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}(n.validationData);o=t.xs,a=t.ys}const u=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let c;c=s?l.slice().concat(l.map((t=>"val_"+t))):l.slice();const h=zr(n.callbacks,n.yieldEvery),f=null==n.verbose?1:n.verbose,{callbackList:d,history:p}=Tr(h,f,n.epochs,null,null,function(t,e){let n=null;return null!=e.batchesPerEpoch?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}(e,n),null,s,c);d.setModel(t),t.history=p,await d.onTrainBegin(),t.stopTraining_=!1;let g=null==n.initialEpoch?0:n.initialEpoch,m=await e.iterator();for(;g<n.epochs;){const c={};await d.onEpochBegin(g);let h=0,f=0;for(r||(m=await e.iterator());!r||h<n.batchesPerEpoch;){const e=await m.next();if(r&&e.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${h} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, `+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset.");break}if(null!=e.value){const{xs:r,ys:s}=ws(t,e.value),o={};o.batch=f,o.size=r[0].shape[0],await d.onBatchBegin(f,o);const a=[];if(null!=n.classWeight){const e=vs(n.classWeight,t.outputNames);for(let t=0;t<e.length;++t)a.push(await bs(s[t],null,e[t]))}const c=r.concat(s).concat(a),p=u(c);i.dispose(c);for(let t=0;t<l.length;++t){const e=l[t],n=p[t];o[e]=n,i.keep(n)}await d.onBatchEnd(f,o),Er(o),f++,h++}if(r?h>=n.batchesPerEpoch:e.done){if(s){let e;e=_s(n.validationData)?Nn(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):Nn(t.evaluate(o,a,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<t.metricsNames.length;++n)c[`val_${t.metricsNames[n]}`]=e[n]}break}if(t.stopTraining_)break}if(await d.onEpochEnd(g,c),g++,t.stopTraining_)break}return await d.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}(this,t,e)}async trainOnBatch(t,e){const n=await this.standardizeUserData(t,e),r=n[0],s=n[1],o=this.makeTrainFunction()(r.concat(s)),a=[];for(const t of o){const e=await t.data();a.push(e[0])}return i.dispose(o),Ss(n[0],t),Ss(n[1],e),On(a)}getNamedWeights(t){const e=[],n=null!=t&&t.trainableOnly,i=n?this.trainableWeights:this.weights,r=this.getWeights(n);for(let t=0;t<i.length;++t)n&&!i[t].trainable||e.push({name:i[t].originalName,tensor:r[t]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(0===t.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const e=i.memory().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-i.memory().numTensors}return t}getLossIdentifiers(){let t;if("string"==typeof this.loss)t=Mn(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if("string"!=typeof t)throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map((t=>Mn(t)))}else{const e=Object.keys(this.loss);t={};const n=this.loss;for(const i of e){if("string"!=typeof n[i])throw new Error("Serialization of non-string loss is not supported.");t[i]=Mn(n[i])}}return t}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[Mn(es(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((t=>Mn(es(t))));{const t={};for(const e in this.metrics)t[e]=Mn(es(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(null!=t.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=t.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=t.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const e=Br(us(t.optimizer_config));let n,i;if("string"==typeof t.loss)n=zn(t.loss);else if(Array.isArray(t.loss))n=t.loss.map((t=>zn(t)));else if(null!=t.loss){n={};for(const e in t.loss)n[e]=zn(t.loss[e])}if(Array.isArray(t.metrics))i=t.metrics.map((t=>zn(t)));else if(null!=t.metrics){i={};for(const e in t.metrics)i[e]=zn(t.metrics[e])}this.compile({loss:n,metrics:i,optimizer:e})}async save(t,e){if("string"==typeof t){const e=i.io.getSaveHandlers(t);if(0===e.length)throw new kn(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new kn(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new kn("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await i.io.encodeWeights(this.getNamedWeights(e)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v3.13.0",convertedBy:null};if(null!=e&&e.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const t="optimizer",{data:e,specs:s}=await i.io.encodeWeights(await this.optimizer.getWeights(),t);n.specs.push(...s),n.data=i.io.concatenateArrayBuffers([n.data,e])}if(null!=this.userDefinedMetadata){const t=!0;ns(this.userDefinedMetadata,this.name,t),r.userDefinedMetadata=this.userDefinedMetadata}return r.weightData=n.data,r.weightSpecs=n.specs,t.save(r)}setUserDefinedMetadata(t){ns(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}$s.className="Model",i.serialization.registerClass($s);class Ts extends $s{}Ts.className="Functional",i.serialization.registerClass(Ts);class Bs extends $s{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=null!=t.name?t.name:ur("sequential_"),null!=t.layers)for(const e of t.layers)this.add(e)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some((t=>t<0)))throw new kn(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const e=t instanceof Bs||t instanceof $s;let n;if(e){if(n=t,1!==n.outputs.length)throw new kn("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new kn("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new kn("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const e=function(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new kn("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));let n=t.dtype;return null==n&&(n="float32"),new kr({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(e)}if(e)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==t.inboundNodes.length)throw new kn(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(1!==t.inboundNodes[0].outputTensors.length)throw new kn("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=_r(this.outputs[0])}this.inboundNodes=[],new xr({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Dn(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs[0].shape})}else{const e=t.apply(this.outputs[0]);if(Array.isArray(e))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[e],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return null==this.model&&this.build(),this.model.call(t,e)}build(t){if(fr(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new $s({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,n=console.log){this.built||this.build(),super.summary(t,e,n)}setWeights(t){null==this.model&&this.build(),this.model.setWeights(t)}evaluate(t,e,n={}){if(!this.built)throw new _n("The model needs to be compiled before being used.");return this.model.evaluate(t,e,n)}async evaluateDataset(t,e){if(!this.built)throw new _n("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return null==this.model&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,n={}){if(!this.built)throw new _n("The model needs to be compiled before being used.");return this.model.fit(t,e,n)}async fitDataset(t,e){if(!this.built)throw new _n("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,n={},r=!1){let s,o={};if(e instanceof Array){if(null==e[0].className||"Merge"===e[0].className)throw new kn("Legacy serialization format not supported yet.");s=e}else i.util.assert(null!=e.layers,(()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field.")),s=e.layers,delete e.layers,o=e;const a=new t(o);if(!(a instanceof Bs))throw new Cn(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const t of s){const e=Br(t,void 0,r);r&&e.setFastWeightInitDuringBuild(!0),a.add(e)}return a}set stopTraining(t){if(null==this.model)throw new kn("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(null==this.model)throw new kn("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const n={};n.className=e.getClassName(),n.config=e.getConfig(),t.push(n)}return{name:this.name,layers:t}}}Bs.className="Sequential",i.serialization.registerClass(Bs);class js extends i.serialization.Serializable{getConfig(){return{}}}class Is extends js{apply(t,e=1){return function(t,e=1){if(1!==e)throw new Cn(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return i.elu(t)}(t,e)}}Is.className="elu",i.serialization.registerClass(Is);class Rs extends js{apply(t){return i.selu(t)}}Rs.className="selu",i.serialization.registerClass(Rs);class Ls extends js{apply(t){return i.relu(t)}}Ls.className="relu",i.serialization.registerClass(Ls);class Ps extends js{apply(t){return(0,i.tidy)((()=>i.minimum(6,i.relu(t))))}}Ps.className="relu6",i.serialization.registerClass(Ps);class Us extends js{apply(t){return t}}Us.className="linear",i.serialization.registerClass(Us);class qs extends js{apply(t){return i.sigmoid(t)}}qs.className="sigmoid",i.serialization.registerClass(qs);class Ws extends js{apply(t){return function(t){return(0,i.tidy)((()=>{const e=i.add(.5,i.mul(.2,t));return i.clipByValue(e,0,1)}))}(t)}}Ws.className="hardSigmoid",i.serialization.registerClass(Ws);class Hs extends js{apply(t){return i.softplus(t)}}Hs.className="softplus",i.serialization.registerClass(Hs);class Vs extends js{apply(t){return function(t){return(0,i.tidy)((()=>i.div(t,i.add(i.abs(t),1))))}(t)}}Vs.className="softsign",i.serialization.registerClass(Vs);class Gs extends js{apply(t){return i.tanh(t)}}Gs.className="tanh",i.serialization.registerClass(Gs);class Xs extends js{apply(t,e=-1){return i.softmax(t,e)}}Xs.className="softmax",i.serialization.registerClass(Xs);class Ys extends js{apply(t,e=-1){return i.logSoftmax(t,e)}}Ys.className="logSoftmax",i.serialization.registerClass(Ys);class Js extends js{apply(t,e=1){return(0,i.tidy)((()=>i.mul(i.sigmoid(i.mul(t,e)),t)))}}Js.className="swish",i.serialization.registerClass(Js);class Zs extends js{apply(t){return(0,i.tidy)((()=>i.mul(t,i.tanh(i.softplus(t)))))}}function Ks(t){return t.getClassName()}function Qs(t,e={}){return jn(t,i.serialization.SerializationMap.getMap().classNameMap,e,"activation")}function to(t){if(null==t){return Qs({className:"linear",config:{}})}if("string"==typeof t){const e={};return e.className=t,e.config={},Qs(e)}return t instanceof js?t:Qs(t)}Zs.className="mish",i.serialization.registerClass(Zs);class eo extends i.serialization.Serializable{}class no extends eo{constructor(t){super(),function(t){if(null!=t&&"object"!=typeof t)throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}(t),this.l1=null==t||null==t.l1?.01:t.l1,this.l2=null==t||null==t.l2?.01:t.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(t){return(0,i.tidy)((()=>{let e=(0,i.zeros)([1]);return this.hasL1&&(e=(0,i.add)(e,(0,i.sum)(i.mul(this.l1,(0,i.abs)(t))))),this.hasL2&&(e=(0,i.add)(e,(0,i.sum)(i.mul(this.l2,Mi(t))))),i.reshape(e,[])}))}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e.l1,l2:e.l2})}}no.className="L1L2",i.serialization.registerClass(no);const io={l1l2:"L1L2"};function ro(t){return Tn(t)}function so(t,e={}){return jn(t,i.serialization.SerializationMap.getMap().classNameMap,e,"regularizer")}function oo(t){return null==t?null:"string"==typeof t?so({className:t in io?io[t]:t,config:{}}):t instanceof eo?t:so(t)}class ao extends Ar{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,null!=t&&(this.maxValue=t.maxValue)}call(t,e){t=hr(t);let n=(0,i.relu)(t);return null!=this.maxValue&&(n=(0,i.clipByValue)(n,0,this.maxValue)),n}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}ao.className="ReLU",i.serialization.registerClass(ao);class uo extends Ar{constructor(t){super(null==t?{}:t),this.DEFAULT_ALPHA=.3,null==t&&(t={}),this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=hr(t);return(0,i.leakyRelu)(n,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}uo.className="LeakyReLU",i.serialization.registerClass(uo);class lo extends Ar{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==t&&(t={}),this.supportsMasking=!0,this.alphaInitializer=rr(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=oo(t.alphaRegularizer),this.alphaConstraint=ei(t.alphaConstraint),null==t.sharedAxes)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else{if("number"!=typeof t.sharedAxes)throw new kn(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`);this.sharedAxes=[t.sharedAxes]}}build(t){const e=(t=fr(t)).slice(1);if(null!=this.sharedAxes)for(const t of this.sharedAxes)e[t-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let e=1;e<t.length;++e)n[e]=t[e];this.inputSpec=[new yr({ndim:t.length,axes:n})],this.built=!0}call(t,e){return t=hr(t),(0,i.prelu)(t,this.alpha.read())}getConfig(){const t={alphaInitializer:ir(this.alphaInitializer),alphaRegularizer:ro(this.alphaRegularizer),alphaConstraint:Qn(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}lo.className="PReLU",i.serialization.registerClass(lo);class co extends Ar{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA=1,null==t&&(t={}),null!=t.alpha&&t.alpha!==this.DEFAULT_ALPHA)throw new Cn(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=hr(t);return(0,i.elu)(n)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}co.className="ELU",i.serialization.registerClass(co);class ho extends Ar{constructor(t){super(null==t?{}:t),this.DEFAULT_THETA=1,null==t&&(t={}),this.theta=null==t.theta?this.DEFAULT_THETA:t.theta}call(t,e){const n=hr(t);return(0,i.mul)(n,(0,i.cast)((0,i.greater)(n,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}ho.className="ThresholdedReLU",i.serialization.registerClass(ho);class fo extends Ar{constructor(t){super(null==t?{}:t),this.DEFAULT_AXIS=1,null==t&&(t={}),this.softmax=(new Xs).apply,this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis}call(t,e){const n=hr(t);return this.softmax(n,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}function po(t,e,n){if("number"==typeof t)return Dn(t,e);if(t.length!==e)throw new kn(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let r=0;r<e;++r){const s=t[r];if((i=s)!==parseInt(i.toString(),10))throw new kn(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${s}`)}return t;var i}function go(t,e,n,i,r=1){if(null==t)return t;let s;return s="same"===n?t:t-(e+(e-1)*(r-1))+1,Math.floor((s+i-1)/i)}function mo(t,e,n,i){if(null==t)return null;if("valid"===i)t=t*e+bi([n-e,0]);else{if("same"!==i)throw new kn(`Unsupport padding mode: ${i}.`);t*=e}return t}function yo(t,e){return(0,i.tidy)((()=>(ui(e),"channelsFirst"===e?i.transpose(t,[0,2,3,1]):t)))}function vo(t,e){return(0,i.tidy)((()=>(ui(e),"channelsFirst"===e?i.transpose(t,[0,2,3,4,1]):t)))}function bo(t,e,n,r=[1,1],s="valid",o,a,u=null){return(0,i.tidy)((()=>{if(null==o&&(o="channelsLast"),ui(o),3!==t.rank&&4!==t.rank)throw new kn(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(3!==e.rank&&4!==e.rank)throw new kn(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=yo(t,o);if("causal"===s)throw new Cn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=i.fused.conv2d({x:l,filter:e,strides:r,pad:"same"===s?"same":"valid",dilations:a,dataFormat:"NHWC",bias:n,activation:u}),"channelsFirst"===o&&(l=i.transpose(l,[0,3,1,2])),l}))}fo.className="Softmax",i.serialization.registerClass(fo);class xo extends Ar{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",xo.verifyArgs(e),this.rank=t,qn(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new Cn(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=po(e.kernelSize,t,"kernelSize"),this.strides=po(null==e.strides?1:e.strides,t,"strides"),this.padding=null==e.padding?"valid":e.padding,li(this.padding),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,ui(this.dataFormat),this.activation=to(e.activation),this.useBias=null==e.useBias||e.useBias,this.biasInitializer=rr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=ei(e.biasConstraint),this.biasRegularizer=oo(e.biasRegularizer),this.activityRegularizer=oo(e.activityRegularizer),this.dilationRate=po(null==e.dilationRate?1:e.dilationRate,t,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new kn(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new kn(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new kn(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}static verifyArgs(t){if(Fn("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!=typeof t.kernelSize&&!Un(t.kernelSize,"number",1,3))throw new kn(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Ks(this.activation),useBias:this.useBias,biasInitializer:ir(this.biasInitializer),biasRegularizer:ro(this.biasRegularizer),activityRegularizer:ro(this.activityRegularizer),biasConstraint:Qn(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class wo extends xo{constructor(t,e){super(t,e),this.kernel=null,wo.verifyArgs(e),this.filters=e.filters,qn(this.filters,"filters"),this.kernelInitializer=rr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=ei(e.kernelConstraint),this.kernelRegularizer=oo(e.kernelRegularizer)}build(t){t=fr(t);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new kn(`The channel dimension of the input should be defined. Found ${t[e]}`);const n=t[e],i=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:n}}],this.built=!0}call(t,e){return(0,i.tidy)((()=>{let e;t=hr(t);const n=null==this.bias?null:this.bias.read(),r=Hn(this.activation.getClassName());if(null!=r&&2===this.rank)e=bo(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)e=function(t,e,n,r=1,s="valid",o,a=1){return(0,i.tidy)((()=>{if(null==o&&(o="channelsLast"),ui(o),3!==t.shape.length)throw new kn(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(3!==e.shape.length)throw new kn(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(null!=n&&1!==n.shape.length)throw new kn(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if("channelsFirst"===o&&(t=i.transpose(t,[0,2,1])),"causal"===s)throw new Cn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let u=i.conv1d(t,e,r,"same"===s?"same":"valid","NWC",a);return null!=n&&(u=$i(u,n)),u}))}(t,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)e=bo(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new Cn("convolutions greater than 3D are not implemented yet.");e=function(t,e,n,r=[1,1,1],s="valid",o,a){return(0,i.tidy)((()=>{if(null==o&&(o="channelsLast"),ui(o),4!==t.rank&&5!==t.rank)throw new kn(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(4!==e.rank&&5!==e.rank)throw new kn(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let u=vo(t,o);if("causal"===s)throw new Cn("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return u=i.conv3d(u,e,r,"same"===s?"same":"valid","NDHWC",a),null!=n&&(u=$i(u,n)),"channelsFirst"===o&&(u=i.transpose(u,[0,4,1,2,3])),u}))}(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(e=this.activation.apply(e))}return e}))}computeOutputShape(t){t=fr(t);const e=[],n="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2);for(let t=0;t<n.length;++t){const i=go(n[t],this.kernelSize[t],this.padding,this.strides[t],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[t]);e.push(i)}let i=[t[0]];return"channelsLast"===this.dataFormat?(i=i.concat(e),i.push(this.filters)):(i.push(this.filters),i=i.concat(e)),i}getConfig(){const t={filters:this.filters,kernelInitializer:ir(this.kernelInitializer),kernelRegularizer:ro(this.kernelRegularizer),kernelConstraint:Qn(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||"number"!=typeof t.filters||t.filters<1)throw new kn(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class Ao extends wo{constructor(t){super(2,t),Ao.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!Un(t.kernelSize,"number",1,2))throw new kn(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}Ao.className="Conv2D",i.serialization.registerClass(Ao);class _o extends wo{constructor(t){super(3,t),_o.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&(!Array.isArray(t.kernelSize)||1!==t.kernelSize.length&&3!==t.kernelSize.length))throw new kn(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}_o.className="Conv3D",i.serialization.registerClass(_o);class ko extends Ao{constructor(t){if(super(t),this.inputSpec=[new yr({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new kn(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(4!==(t=fr(t)).length)throw new kn("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new kn("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],i=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new yr({ndim:4,axes:{[e]:n}})],this.built=!0}call(t,e){return i.tidy((()=>{let e=hr(t);if(4!==e.shape.length)throw new kn(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${e.shape.length}`);const n=e.shape,r=n[0];let s,o;"channelsFirst"===this.dataFormat?(s=2,o=3):(s=1,o=2);const a=n[s],u=n[o],l=this.kernelSize[0],c=this.kernelSize[1],h=this.strides[0],f=this.strides[1],d=[r,mo(a,h,l,this.padding),mo(u,f,c,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(e=i.transpose(e,[0,2,3,1]));let p=i.conv2dTranspose(e,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(p=i.transpose(p,[0,3,1,2])),null!=this.bias&&(p=$i(p,this.bias.read(),this.dataFormat)),null!=this.activation&&(p=this.activation.apply(p)),p}))}computeOutputShape(t){const e=(t=fr(t)).slice();let n,i,r;"channelsFirst"===this.dataFormat?(n=1,i=2,r=3):(n=3,i=1,r=2);const s=this.kernelSize[0],o=this.kernelSize[1],a=this.strides[0],u=this.strides[1];return e[n]=this.filters,e[i]=mo(e[i],a,s,this.padding),e[r]=mo(e[r],u,o,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}ko.className="Conv2DTranspose",i.serialization.registerClass(ko);class Co extends _o{constructor(t){if(super(t),this.inputSpec=[new yr({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new kn(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(5!==(t=fr(t)).length)throw new kn("Input should have rank 5; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new kn("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],i=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new yr({ndim:5,axes:{[e]:n}})],this.built=!0}call(t,e){return i.tidy((()=>{let e=hr(t);if(5!==e.shape.length)throw new kn(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${e.shape.length}`);const n=e.shape,r=n[0];let s,o,a;"channelsFirst"===this.dataFormat?(a=2,s=3,o=4):(a=1,s=2,o=3);const u=n[a],l=n[s],c=n[o],h=this.kernelSize[0],f=this.kernelSize[1],d=this.kernelSize[2],p=this.strides[0],g=this.strides[1],m=this.strides[2],y=[r,mo(u,p,h,this.padding),mo(l,g,f,this.padding),mo(c,m,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(e=i.transpose(e,[0,2,3,4,1]));let v=i.conv3dTranspose(e,this.kernel.read(),y,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(v=i.transpose(v,[0,4,1,2,3])),null!==this.bias&&(v=$i(v,this.bias.read(),this.dataFormat)),null!==this.activation&&(v=this.activation.apply(v)),v}))}computeOutputShape(t){const e=(t=fr(t)).slice();let n,i,r,s;"channelsFirst"===this.dataFormat?(n=1,i=2,r=3,s=4):(n=4,i=1,r=2,s=3);const o=this.kernelSize[0],a=this.kernelSize[1],u=this.kernelSize[2],l=this.strides[0],c=this.strides[1],h=this.strides[2];return e[n]=this.filters,e[i]=mo(e[i],l,o,this.padding),e[r]=mo(e[r],c,a,this.padding),e[s]=mo(e[s],h,u,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}Co.className="Conv3DTranspose",i.serialization.registerClass(Co);class Eo extends wo{constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==e.filters)throw new kn("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=e.kernelInitializer||null!=e.kernelRegularizer||null!=e.kernelConstraint)throw new kn("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=e.padding&&"same"!==e.padding&&"valid"!==e.padding)throw new kn(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(e.padding)}`);this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=rr(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=oo(e.depthwiseRegularizer),this.depthwiseConstraint=ei(e.depthwiseConstraint),this.pointwiseInitializer=rr(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=oo(e.pointwiseRegularizer),this.pointwiseConstraint=ei(e.pointwiseConstraint)}build(t){if((t=fr(t)).length<this.rank+2)throw new kn(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e]||t[e]<0)throw new kn(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[e])}`);const n=t[e],i=this.kernelSize.concat([n,this.depthMultiplier]),r=[];for(let t=0;t<this.rank;++t)r.push(1);r.push(n*this.depthMultiplier,this.filters);const s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",r,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new yr({ndim:this.rank+2,axes:{[e]:n}})],this.built=!0}call(t,e){return(0,i.tidy)((()=>{let e;if(t=hr(t),1===this.rank)throw new Cn("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(t=i.transpose(t,[0,2,3,1])),e=i.separableConv2d(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(e=$i(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),"channelsFirst"===this.dataFormat&&(e=i.transpose(e,[0,3,1,2])),e}))}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=ir(this.depthwiseInitializer),t.pointwiseInitializer=ir(this.pointwiseInitializer),t.depthwiseRegularizer=ro(this.depthwiseRegularizer),t.pointwiseRegularizer=ro(this.pointwiseRegularizer),t.depthwiseConstraint=Qn(this.depthwiseConstraint),t.pointwiseConstraint=Qn(this.pointwiseConstraint),t}}Eo.className="SeparableConv";class Do extends Eo{constructor(t){super(2,t)}}Do.className="SeparableConv2D",i.serialization.registerClass(Do);class Fo extends wo{constructor(t){super(1,t),Fo.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!Un(t.kernelSize,"number",1,1))throw new kn(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}Fo.className="Conv1D",i.serialization.registerClass(Fo);class So extends Ar{constructor(t){super(t),"number"==typeof t.cropping?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:"number"==typeof t.cropping[0]?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=void 0===t.dataFormat?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return(0,i.tidy)((()=>{if(t=hr(t),"channelsLast"===this.dataFormat){const e=Ci(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Ci(e,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const e=Ci(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Ci(e,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}}))}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}So.className="Cropping2D",i.serialization.registerClass(So);class Oo extends Ar{constructor(t){var e;super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==t.size?this.DEFAULT_SIZE:t.size,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,ui(this.dataFormat),this.interpolation=null==t.interpolation?"nearest":t.interpolation,e=this.interpolation,Pn(ii,"InterpolationFormat",e)}computeOutputShape(t){if("channelsFirst"===this.dataFormat){const e=null==t[2]?null:this.size[0]*t[2],n=null==t[3]?null:this.size[1]*t[3];return[t[0],t[1],e,n]}{const e=null==t[1]?null:this.size[0]*t[1],n=null==t[2]?null:this.size[1]*t[2];return[t[0],e,n,t[3]]}}call(t,e){return i.tidy((()=>{let e=hr(t);const n=e.shape;if("channelsFirst"===this.dataFormat){e=i.transpose(e,[0,2,3,1]);const t=this.size[0]*n[2],r=this.size[1]*n[3],s="nearest"===this.interpolation?i.image.resizeNearestNeighbor(e,[t,r]):i.image.resizeBilinear(e,[t,r]);return i.transpose(s,[0,3,1,2])}{const t=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?i.image.resizeNearestNeighbor(e,[t,r]):i.image.resizeBilinear(e,[t,r])}}))}getConfig(){const t={size:this.size,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}Oo.className="UpSampling2D",i.serialization.registerClass(Oo);class No extends xo{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=rr(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=ei(t.depthwiseConstraint),this.depthwiseRegularizer=oo(t.depthwiseRegularizer)}build(t){if((t=fr(t)).length<4)throw new kn(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new kn(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const n=t[e],i=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return(0,i.tidy)((()=>{let e=function(t,e,n=[1,1],r="valid",s,o){return(0,i.tidy)((()=>{null==s&&(s="channelsLast"),ui(s);let a=yo(t,s);if(4!==t.rank)throw new kn(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(4!==e.rank)throw new kn(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return a=i.depthwiseConv2d(a,e,n,"same"===r?"same":"valid","NHWC",o),"channelsFirst"===s&&(a=i.transpose(a,[0,3,1,2])),a}))}(t=hr(t),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(e=$i(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),e}))}computeOutputShape(t){t=fr(t);const e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],i="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,r=go(e,this.kernelSize[0],this.padding,this.strides[0]),s=go(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],i,r,s]:[t[0],r,s,i]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=ir(this.depthwiseInitializer),t.depthwiseRegularizer=ro(this.depthwiseRegularizer),t.depthwiseConstraint=Qn(this.depthwiseRegularizer),t}}function Mo(t,e,n,i){if(Array.isArray(t)){if(null!=e||null!=n)throw new kn("When inputs is an array, neither initialState or constants should be provided");null!=i&&(n=t.slice(t.length-i,t.length),t=t.slice(0,t.length-i)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function r(t){return null==t||Array.isArray(t)?t:[t]}return{inputs:t,initialState:e=r(e),constants:n=r(n)}}function zo(t,e,n,r=!1,s,o,a=!1,u=!1){return i.tidy((()=>{const l=e.shape.length;if(l<3)throw new kn(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(xi(2,l));if(e=i.transpose(e,c),null!=o)throw new Cn("The rnn() functoin of the deeplearn.js backend does not support constants yet.");a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=s&&((s=i.cast(i.cast(s,"bool"),"float32")).rank===l-1&&(s=i.expandDims(s,-1)),s=i.transpose(s,c)),r&&(e=i.reverse(e,0),null!=s&&(s=i.reverse(s,0)));const h=[];let f,d=n;const p=e.shape[0],g=i.unstack(e);let m,y;null!=s&&(m=i.unstack(s));for(let e=0;e<p;++e){const n=g[e],r=i.tidy((()=>t(n,d)));if(null==s)f=r[0],d=r[1];else{const t=i.tidy((()=>{const t=m[e],n=i.sub(i.onesLike(t),t);return{output:i.add(i.mul(r[0],t),i.mul(d[0],n)),newStates:d.map(((e,s)=>i.add(i.mul(r[1][s],t),i.mul(e,n))))}}));f=t.output,d=t.newStates}u&&h.push(f)}if(u){const t=1;y=i.stack(h,t)}return[f,y,d]}))}No.className="DepthwiseConv2D",i.serialization.registerClass(No);class $o extends Ar{constructor(t){let e;if(super(t),null==t.cell)throw new kn("cell property is missing for the constructor of RNN.");if(e=Array.isArray(t.cell)?new Uo({cells:t.cell}):t.cell,null==e.stateSize)throw new kn("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=null!=t.returnSequences&&t.returnSequences,this.returnState=null!=t.returnState&&t.returnState,this.goBackwards=null!=t.goBackwards&&t.goBackwards,this._stateful=null!=t.stateful&&t.stateful,this.unroll=null!=t.unroll&&t.unroll,this.supportsMasking=!0,this.inputSpec=[new yr({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){return null==this.states_?xi(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((t=>null)):this.states_}setStates(t){this.states_=t}computeOutputShape(t){lr(t)&&(t=t[0]),t=t;let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const n=e[0];let i;if(i=this.returnSequences?[t[0],t[1],n]:[t[0],n],this.returnState){const n=[];for(const i of e)n.push([t[0],i]);return[i].concat(n)}return i}computeMask(t,e){return i.tidy((()=>{Array.isArray(e)&&(e=e[0]);const t=this.returnSequences?e:null;if(this.returnState){const e=this.states.map((t=>null));return[t].concat(e)}return t}))}get states(){if(null==this.states_){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let n=0;n<t;++n)e.push(null);return e}return this.states_}set states(t){this.states_=t}build(t){if(null!=this.numConstants)throw new Cn("Constants support is not implemented in RNN yet.");lr(t)&&(t=t[0]),t=t;const e=this.stateful?t[0]:null,n=t.slice(2);this.inputSpec[0]=new yr({shape:[e,null,...n]});const r=[t[0]].concat(t.slice(2));let s;if(this.cell.build(r),s=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!i.util.arraysEqual(this.stateSpec.map((t=>t.shape[t.shape.length-1])),s))throw new kn(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=s.map((t=>new yr({shape:[null,t]})));this.stateful&&this.resetStates()}resetStates(t,e=!1){(0,i.tidy)((()=>{if(!this.stateful)throw new An("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new kn("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>i.zeros([n,t]))):this.states_=[i.zeros([n,this.cell.stateSize])];else if(null==t)i.dispose(this.states_),null!=this.keptStates&&(i.dispose(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>i.zeros([n,t]))):this.states_[0]=i.zeros([n,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new kn(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);!0===e?this.keptStates.push(this.states_.slice()):i.dispose(this.states_);for(let e=0;e<this.states_.length;++e){const r=t[e],s=Array.isArray(this.cell.stateSize)?this.cell.stateSize[e]:this.cell.stateSize,o=[n,s];if(!i.util.arraysEqual(r.shape,o))throw new kn(`State ${e} is incompatible with layer ${this.name}: expected shape=${o}, received shape=${r.shape}`);this.states_[e]=r}}this.states_=this.states_.map((t=>i.keep(t.clone())))}))}apply(t,e){let n=null==e?null:e.initialState,i=null==e?null:e.constants;null==e&&(e={});const r=Mo(t,n,i,this.numConstants);t=r.inputs,n=r.initialState,i=r.constants;let s=[],o=[];if(null!=n){e.initialState=n,s=s.concat(n),this.stateSpec=[];for(const t of n)this.stateSpec.push(new yr({shape:t.shape}));o=o.concat(this.stateSpec)}if(null!=i&&(e.constants=i,s=s.concat(i),this.numConstants=i.length),s[0]instanceof vr){const n=[t].concat(s),i=this.inputSpec.concat(o),r=this.inputSpec;this.inputSpec=i;const a=super.apply(n,e);return this.inputSpec=r,a}return super.apply(t,e)}call(t,e){return(0,i.tidy)((()=>{const n=null==e?null:e.mask,i=null==e?null:e.training;let r=null==e?null:e.initialState;t=hr(t),null==r&&(r=this.stateful?this.states_:this.getInitialState(t));const s=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(r.length!==s)throw new kn(`RNN Layer has ${s} state(s) but was passed ${r.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const o={training:i},a=zo(((t,e)=>{const n=this.cell.call([t].concat(e),o);return[n[0],n.slice(1)]}),t,r,this.goBackwards,n,null,this.unroll,this.returnSequences),u=a[0],l=a[1],c=a[2];this.stateful&&this.resetStates(c,i);const h=this.returnSequences?l:u;return this.returnState?[h].concat(c):h}))}getInitialState(t){return(0,i.tidy)((()=>{let e=i.zeros(t.shape);return e=i.sum(e,[1,2]),e=Ai(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map((t=>t>1?Fi(e,[1,t]):e)):this.cell.stateSize>1?[Fi(e,[1,this.cell.stateSize])]:[e]}))}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===$o.className&&(e.cell={className:this.cell.getClassName(),config:n}),Object.assign({},n,t,e)}static fromConfig(t,e,n={}){const i=Br(e.cell,n);return new t(Object.assign(e,{cell:i}))}}$o.className="RNN",i.serialization.registerClass($o);class To extends Ar{}class Bo extends To{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,qn(this.units,"units"),this.activation=to(null==t.activation?this.DEFAULT_ACTIVATION:t.activation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=rr(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rr(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rr(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=oo(t.kernelRegularizer),this.recurrentRegularizer=oo(t.recurrentRegularizer),this.biasRegularizer=oo(t.biasRegularizer),this.kernelConstraint=ei(t.kernelConstraint),this.recurrentConstraint=ei(t.recurrentConstraint),this.biasConstraint=ei(t.biasConstraint),this.dropout=vi([1,bi([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=vi([1,bi([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=fr(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return(0,i.tidy)((()=>{if(2!==(t=t).length)throw new kn(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let n=t[1];t=t[0];const r=null!=e.training&&e.training;let s;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=qo({ones:()=>i.onesLike(t),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=qo({ones:()=>i.onesLike(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;s=Oi(null!=o?i.mul(t,o):t,this.kernel.read()),null!=this.bias&&(s=$i(s,this.bias.read())),null!=a&&(n=i.mul(n,a));let u=i.add(s,Oi(n,this.recurrentKernel.read()));return null!=this.activation&&(u=this.activation.apply(u)),[u,u]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:Ks(this.activation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),kernelRegularizer:ro(this.kernelRegularizer),recurrentRegularizer:ro(this.recurrentRegularizer),biasRegularizer:ro(this.biasRegularizer),activityRegularizer:ro(this.activityRegularizer),kernelConstraint:Qn(this.kernelConstraint),recurrentConstraint:Qn(this.recurrentConstraint),biasConstraint:Qn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},t,e)}}Bo.className="SimpleRNNCell",i.serialization.registerClass(Bo);class jo extends $o{constructor(t){t.cell=new Bo(t),super(t)}call(t,e){return(0,i.tidy)((()=>{null!=this.cell.dropoutMask&&(i.dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(i.dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,s=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:s})}))}static fromConfig(t,e){return new t(e)}}jo.className="SimpleRNN",i.serialization.registerClass(jo);class Io extends To{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new kn("GRUCell does not support reset_after parameter set to true.");this.units=t.units,qn(this.units,"units"),this.activation=to(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=to(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=rr(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rr(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rr(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=oo(t.kernelRegularizer),this.recurrentRegularizer=oo(t.recurrentRegularizer),this.biasRegularizer=oo(t.biasRegularizer),this.kernelConstraint=ei(t.kernelConstraint),this.recurrentConstraint=ei(t.recurrentConstraint),this.biasConstraint=ei(t.biasConstraint),this.dropout=vi([1,bi([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=vi([1,bi([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){const e=(t=fr(t))[t.length-1];this.kernel=this.addWeight("kernel",[e,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return(0,i.tidy)((()=>{if(2!==(t=t).length)throw new kn(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const n=null!=e.training&&e.training;let r=t[1];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=qo({ones:()=>i.onesLike(t),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=qo({ones:()=>i.onesLike(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=this.recurrentDropoutMask;let a,u,l;0<this.dropout&&this.dropout<1&&(t=i.mul(t,s[0]));let c=Oi(t,this.kernel.read());this.useBias&&(c=$i(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=i.mul(r,o[0]));const h=this.recurrentKernel.read(),[f,d]=i.split(h,[2*this.units,this.units],h.rank-1),p=Oi(r,f),[g,m,y]=i.split(c,3,c.rank-1),[v,b]=i.split(p,2,p.rank-1);a=this.recurrentActivation.apply(i.add(g,v)),u=this.recurrentActivation.apply(i.add(m,b));const x=Oi(i.mul(u,r),d);l=this.activation.apply(i.add(y,x));const w=i.add(i.mul(a,r),i.mul(i.add(1,i.neg(a)),l));return[w,w]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:Ks(this.activation),recurrentActivation:Ks(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),kernelRegularizer:ro(this.kernelRegularizer),recurrentRegularizer:ro(this.recurrentRegularizer),biasRegularizer:ro(this.biasRegularizer),activityRegularizer:ro(this.activityRegularizer),kernelConstraint:Qn(this.kernelConstraint),recurrentConstraint:Qn(this.recurrentConstraint),biasConstraint:Qn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},t,e)}}Io.className="GRUCell",i.serialization.registerClass(Io);class Ro extends $o{constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Io(t),super(t)}call(t,e){return(0,i.tidy)((()=>{null!=this.cell.dropoutMask&&(i.dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(i.dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,s=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:s})}))}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}Ro.className="GRU",i.serialization.registerClass(Ro);class Lo extends To{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,qn(this.units,"units"),this.activation=to(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=to(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=rr(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rr(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rr(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=oo(t.kernelRegularizer),this.recurrentRegularizer=oo(t.recurrentRegularizer),this.biasRegularizer=oo(t.biasRegularizer),this.kernelConstraint=ei(t.kernelConstraint),this.recurrentConstraint=ei(t.recurrentConstraint),this.biasConstraint=ei(t.biasConstraint),this.dropout=vi([1,bi([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=vi([1,bi([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;const n=(t=fr(t))[t.length-1];let i;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const t=this.biasInitializer,n=this.units;i=new((e=class extends Ri{apply(e,i){const r=t.apply([n]),s=(new Pi).apply([n]),o=t.apply([2*n]);return Di(Di(r,s),o)}}).className="CustomInit",e)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return(0,i.tidy)((()=>{const n=null!=e.training&&e.training;if(3!==(t=t).length)throw new kn(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let r=t[1];const s=t[2];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=qo({ones:()=>i.onesLike(t),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=qo({ones:()=>i.onesLike(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let u,l,c,h;0<this.dropout&&this.dropout<1&&(t=i.mul(t,o[0]));let f=Oi(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=i.mul(r,a[0])),f=i.add(f,Oi(r,this.recurrentKernel.read())),this.useBias&&(f=$i(f,this.bias.read()));const[d,p,g,m]=i.split(f,4,f.rank-1);u=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(p),c=i.add(i.mul(l,s),i.mul(u,this.activation.apply(g))),h=this.recurrentActivation.apply(m);const y=i.mul(h,this.activation.apply(c));return[y,y,c]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:Ks(this.activation),recurrentActivation:Ks(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),recurrentInitializer:ir(this.recurrentInitializer),biasInitializer:ir(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:ro(this.kernelRegularizer),recurrentRegularizer:ro(this.recurrentRegularizer),biasRegularizer:ro(this.biasRegularizer),activityRegularizer:ro(this.activityRegularizer),kernelConstraint:Qn(this.kernelConstraint),recurrentConstraint:Qn(this.recurrentConstraint),biasConstraint:Qn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},t,e)}}Lo.className="LSTMCell",i.serialization.registerClass(Lo);class Po extends $o{constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Lo(t),super(t)}call(t,e){return(0,i.tidy)((()=>{null!=this.cell.dropoutMask&&(i.dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(i.dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,s=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:s})}))}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}Po.className="LSTM",i.serialization.registerClass(Po);class Uo extends To{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return(0,i.tidy)((()=>{let n=(t=t).slice(1);const i=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?i.push(n.splice(0,t.stateSize.length)):i.push(n.splice(0,1));i.reverse();const r=[];let s;for(let o=0;o<this.cells.length;++o){const a=this.cells[o];n=i[o],s=0===o?[t[0]].concat(n):[s[0]].concat(n),s=a.call(s,e),r.push(s.slice(1))}n=[];for(const t of r.slice().reverse())n.push(...t);return[s[0]].concat(n)}))}build(t){let e;lr(t)&&(t=t[0]),t=t,this.cells.forEach(((n,i)=>{fi(`RNNCell_${i}`,(()=>{n.build(t),e=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,t=[t[0],e]}))})),this.built=!0}getConfig(){const t=super.getConfig(),e={cells:this.cells.map((t=>({className:t.getClassName(),config:t.getConfig()})))};return Object.assign({},t,e)}static fromConfig(t,e,n={}){const i=[];for(const t of e.cells)i.push(Br(t,n));return new t({cells:i})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return gr(t)}setWeights(t){const e=[];for(const n of this.cells){const i=n.weights.length,r=t.splice(i);for(let t=0;t<n.weights.length;++t)e.push([n.weights[t],r[t]])}mr(e)}}function qo(t){const{ones:e,rate:n,training:r=!1,count:s=1,dropoutFunc:o}=t,a=()=>null!=o?o(e(),n):Ti(e(),n),u=()=>Bi(a,e,r);return!s||s<=1?i.keep(u().clone()):Array(s).fill(void 0).map(u).map((t=>i.keep(t.clone())))}Uo.className="StackedRNNCells",i.serialization.registerClass(Uo);class Wo extends $o{constructor(t){if(t.unroll)throw new Cn("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new Cn("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new yr({ndim:5})]}call(t,e){return i.tidy((()=>{if(null!=this.cell.dropoutMask&&(i.dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(i.dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),e&&e.constants)throw new kn("ConvRNN2D cell does not support constants");const n=null==e?null:e.mask,r=null==e?null:e.training,s=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:s})}))}computeOutputShape(t){let e=this.computeSingleOutputShape(t);return this.returnSequences||(e=[e[0],...e.slice(2)]),this.returnState&&(e=[e,...Array(2).fill([t[0],...e.slice(-3)])]),e}getInitialState(t){return i.tidy((()=>{const{stateSize:e}=this.cell,n=t.shape,r=this.computeSingleOutputShape(n),s=[r[0],...r.slice(2)],o=i.zeros(s);return Array.isArray(e)?Array(e.length).fill(o):[o]}))}resetStates(t,e=!1){i.tidy((()=>{if(!this.stateful)throw new An("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),s=[r[0],...r.slice(2)];if(null==n[0])throw new kn("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>i.zeros(s))):this.states_=[i.zeros(s)];else if(null==t)i.dispose(this.states_),null!=this.keptStates&&(i.dispose(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>i.zeros(s))):this.states_[0]=i.zeros(s);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new kn(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e?this.keptStates.push(this.states_.slice()):i.dispose(this.states_);for(let e=0;e<this.states_.length;++e){const n=t[e],r=s;if(!i.util.arraysEqual(n.shape,r))throw new kn(`State ${e} is incompatible with layer ${this.name}: expected shape=${r}, received shape=${n.shape}`);this.states_[e]=n}}this.states_=this.states_.map((t=>i.keep(t.clone())))}))}computeSingleOutputShape(t){const{dataFormat:e,filters:n,kernelSize:i,padding:r,strides:s,dilationRate:o}=this.cell,a="channelsFirst"===e,u=t[a?3:2],l=t[a?4:3],c=go(u,i[0],r,s[0],o[0]),h=go(l,i[1],r,s[1],o[1]);return[...t.slice(0,2),...a?[n,c,h]:[c,h,n]]}}Wo.className="ConvRNN2D";class Ho extends Lo{constructor(t){const{filters:e,kernelSize:n,strides:i,padding:r,dataFormat:s,dilationRate:o}=t;super(Object.assign({},t,{units:e})),this.filters=e,qn(this.filters,"filters"),this.kernelSize=po(n,2,"kernelSize"),this.kernelSize.forEach((t=>qn(t,"kernelSize"))),this.strides=po(i||1,2,"strides"),this.strides.forEach((t=>qn(t,"strides"))),this.padding=r||"valid",li(this.padding),this.dataFormat=s||"channelsLast",ui(this.dataFormat),this.dilationRate=po(o||1,2,"dilationRate"),this.dilationRate.forEach((t=>qn(t,"dilationRate")))}build(t){var e;t=fr(t);const n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new kn(`The channel dimension of the input should be defined. Found ${t[n]}`);const r=t[n],s=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const o=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",o,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let t;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;t=new((e=class extends Ri{apply(t,e){return Ei([n.apply([r]),i.ones([r]),n.apply([2*r])])}}).className="CustomInit",e)}else t=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,t,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,e){return i.tidy((()=>{if(3!==t.length)throw new kn(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const n=e.training||!1,r=t[0],s=t[1],o=t[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=qo({ones:()=>i.onesLike(r),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,u=(t,e,n)=>e&&e[n]?i.mul(e[n],t):t;let l=u(r,a,0),c=u(r,a,1),h=u(r,a,2),f=u(r,a,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=qo({ones:()=>i.onesLike(s),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const d=this.recurrentDropoutMask;let p=u(s,d,0),g=u(s,d,1),m=u(s,d,2),y=u(s,d,3);const[v,b,x,w]=i.split(this.kernel.read(),4,3),[A,_,k,C]=this.useBias?i.split(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,v,A,this.padding),c=this.inputConv(c,b,_,this.padding),h=this.inputConv(h,x,k,this.padding),f=this.inputConv(f,w,C,this.padding);const[E,D,F,S]=i.split(this.recurrentKernel.read(),4,3);p=this.recurrentConv(p,E),g=this.recurrentConv(g,D),m=this.recurrentConv(m,F),y=this.recurrentConv(y,S);const O=this.recurrentActivation.apply(i.add(l,p)),N=this.recurrentActivation.apply(i.add(c,g)),M=i.add(i.mul(N,o),i.mul(O,this.activation.apply(i.add(h,m)))),z=i.mul(this.recurrentActivation.apply(i.add(f,y)),this.activation.apply(M));return[z,z,M]}))}getConfig(){const t=super.getConfig(),{units:e}=t,n=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}(t,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},n,i)}inputConv(t,e,n,r){const s=i.conv2d(t,e,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?$i(s,n,this.dataFormat):s}recurrentConv(t,e){return i.conv2d(t,e,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}Ho.className="ConvLSTM2DCell",i.serialization.registerClass(Ho);class Vo extends Wo{constructor(t){const e=new Ho(t);super(Object.assign({},t,{cell:e}))}static fromConfig(t,e){return new t(e)}}Vo.className="ConvLSTM2D",i.serialization.registerClass(Vo);class Go extends Ar{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(null==this.noiseShape)return this.noiseShape;const e=t.shape,n=[];for(let t=0;t<this.noiseShape.length;++t)n.push(null==this.noiseShape[t]?e[t]:this.noiseShape[t]);return n}call(t,e){return(0,i.tidy)((()=>{this.invokeCallHook(t,e);const n=hr(t);if(0<this.rate&&this.rate<1){const t=null!=e.training&&e.training,i=this.getNoiseShape(n);return Bi((()=>Ti(n,this.rate,i,this.seed)),(()=>n),t)}return t}))}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}Go.className="Dropout",i.serialization.registerClass(Go);class Xo extends Go{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}Xo.className="SpatialDropout1D",i.serialization.registerClass(Xo);class Yo extends Ar{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==t.batchInputShape&&null==t.inputShape&&null!=t.inputDim){let e=null;null!=t.batchSize&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,qn(this.units,"units"),this.activation=to(t.activation),null!=t.useBias&&(this.useBias=t.useBias),this.kernelInitializer=rr(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=rr(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=ei(t.kernelConstraint),this.biasConstraint=ei(t.biasConstraint),this.kernelRegularizer=oo(t.kernelRegularizer),this.biasRegularizer=oo(t.biasRegularizer),this.activityRegularizer=oo(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){const e=(t=fr(t))[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){const e=(t=fr(t)).slice();return e[e.length-1]=this.units,e}call(t,e){return(0,i.tidy)((()=>{this.invokeCallHook(t,e);const n=hr(t),i=Hn(this.activation.getClassName());let r;return null!=i?r=Oi(n,this.kernel.read(),i,this.bias?this.bias.read():null):(r=Oi(n,this.kernel.read()),null!=this.bias&&(r=$i(r,this.bias.read())),null!=this.activation&&(r=this.activation.apply(r))),r}))}getConfig(){const t={units:this.units,activation:Ks(this.activation),useBias:this.useBias,kernelInitializer:ir(this.kernelInitializer),biasInitializer:ir(this.biasInitializer),kernelRegularizer:ro(this.kernelRegularizer),biasRegularizer:ro(this.biasRegularizer),activityRegularizer:ro(this.activityRegularizer),kernelConstraint:Qn(this.kernelConstraint),biasConstraint:Qn(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}Yo.className="Dense",i.serialization.registerClass(Yo);class Jo extends Ar{constructor(t){super(t=t||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=fr(t);for(const e of t.slice(1))if(null==e)throw new kn(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],yi(t,1)]}call(t,e){return(0,i.tidy)((()=>{this.invokeCallHook(t,e);let n=hr(t);if("channelsFirst"===this.dataFormat&&n.rank>1){const t=[0];for(let e=2;e<n.rank;++e)t.push(e);t.push(1),n=(0,i.transpose)(n,t)}return function(t){if(t.rank<=1)throw new kn(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],yi(t.shape,1)];return i.reshape(t,e)}(n)}))}getConfig(){const t={};null!=this.dataFormat&&(t.dataFormat=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}Jo.className="Flatten",i.serialization.registerClass(Jo);class Zo extends Ar{constructor(t){super(t),this.supportsMasking=!0,this.activation=to(t.activation)}call(t,e){return(0,i.tidy)((()=>{this.invokeCallHook(t,e);const n=hr(t);return this.activation.apply(n)}))}getConfig(){const t={activation:Ks(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}Zo.className="Activation",i.serialization.registerClass(Zo);class Ko extends Ar{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return(0,i.tidy)((()=>{return t=hr(t),e=t,n=this.n,(0,i.tidy)((()=>{if(2!==e.shape.length)throw new kn(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);return Fi(Ai(e,1),[1,n,1])}));var e,n}))}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}Ko.className="RepeatVector",i.serialization.registerClass(Ko);class Qo extends Ar{constructor(t){super(t),this.targetShape=t.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(t){return t<0||null==t}fixUnknownDimension(t,e){const n="Total size of new array must be unchanged.",i=e.slice();let r=1,s=null;for(let t=0;t<i.length;++t){const e=i[t];if(this.isUnknown(e)){if(null!==s)throw new kn("Can only specifiy one unknown dimension.");s=t}else r*=e}const o=yi(t);if(null!==s){if(0===r||o%r!=0)throw new kn(n);i[s]=o/r}else if(o!==r)throw new kn(n);return i}computeOutputShape(t){let e=!1;for(let n=0;n<t.length;++n)if(this.isUnknown(t[n])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return(0,i.tidy)((()=>{this.invokeCallHook(t,e);const n=hr(t),r=n.shape,s=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return(0,i.reshape)(n,s)}))}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}Qo.className="Reshape",i.serialization.registerClass(Qo);class ta extends Ar{constructor(t){if(super(t),null==t.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const e=xi(1,t.dims.length+1);if(!i.util.arraysEqual(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new yr({ndim:this.dims.length+1})]}computeOutputShape(t){const e=(t=fr(t)).slice();return this.dims.forEach(((n,i)=>{e[i+1]=t[n]})),e}call(t,e){return(0,i.transpose)(hr(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}ta.className="Permute",i.serialization.registerClass(ta);class ea extends Ar{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,this.maskValue=null!=t?null==t.maskValue?0:t.maskValue:0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const n=hr(t);return(0,i.any)((0,i.notEqual)(n,this.maskValue),-1)}call(t,e){return(0,i.tidy)((()=>{this.invokeCallHook(t,e);const n=hr(t),r=(0,i.any)((0,i.notEqual)(n,this.maskValue),-1,!0);return(0,i.mul)(n,(0,i.cast)(r,n.dtype))}))}}ea.className="Masking",i.serialization.registerClass(ea);class na extends Ar{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==t.batchInputShape&&null==t.inputShape){let e=null;null!=t.batchSize&&(e=t.batchSize),null==t.inputLength?this.batchInputShape=[e,null]:this.batchInputShape=[e].concat(Nn(t.inputLength))}this.inputDim=t.inputDim,qn(this.inputDim,"inputDim"),this.outputDim=t.outputDim,qn(this.outputDim,"outputDim"),this.embeddingsInitializer=rr(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=oo(t.embeddingsRegularizer),this.activityRegularizer=oo(t.activityRegularizer),this.embeddingsConstraint=ei(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return(0,i.tidy)((()=>this.maskZero?(t=hr(t),(0,i.notEqual)(t,(0,i.zerosLike)(t))):null))}computeOutputShape(t){if(t=fr(t),null==this.inputLength)return[...t,this.outputDim];const e=Nn(this.inputLength);if(e.length!==t.length-1)throw new kn(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let n=0;for(let i=0;i<e.length;++i){const r=e[i],s=t[i+1];if(null!=r&&null!=s&&r!==s)throw new kn(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);null==r&&(e[n]=s),n++}}return[t[0],...e,this.outputDim]}call(t,e){return(0,i.tidy)((()=>{this.invokeCallHook(t,e);let n=hr(t);"int32"!==n.dtype&&(n=wi(n,"int32"));const r=Ni(this.embeddings.read(),(0,i.reshape)(n,[n.size]));return(0,i.reshape)(r,fr(this.computeOutputShape(n.shape)))}))}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:ir(this.embeddingsInitializer),embeddingsRegularizer:ro(this.embeddingsRegularizer),activityRegularizer:ro(this.activityRegularizer),embeddingsConstraint:Qn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}na.className="Embedding",i.serialization.registerClass(na);class ia extends Ar{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new Cn}computeElementwiseOpOutputShape(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;const n=t.slice(0,t.length-e.length);for(let i=0;i<e.length;++i){const r=t[t.length-e.length+i],s=e[i];if(null==r||null==s||r<0||s<0)n.push(null);else if(1===r)n.push(s);else if(1===s)n.push(r);else{if(r!==s)throw new kn("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));n.push(r)}}return n}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[fr(t)]),(t=t).length<2)throw new kn(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const n of t)null!=n&&null!==n[0]&&e.push(n[0]);if(e=Rn(e),e.length>1)throw new kn(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let n=null==t[0]?null:t[0].slice(1);for(let e=1;e<t.length;++e){const i=null==t[e]?null:t[e].slice(1);n=this.computeElementwiseOpOutputShape(n,i)}const i=t.map((t=>t.length));-1===t.indexOf(null)&&1===Rn(i).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return(0,i.tidy)((()=>{if(t=t,this.reshapeRequired){const e=[],n=t.map((t=>t.rank));if(-1===n.indexOf(null)){const i=bi(n);for(let n of t){const t=n.rank;for(let e=0;e<i-t;++e)n=Ai(n,1);e.push(n)}return this.mergeFunction(e)}{let n=!1;for(const r of t){const t=r.rank;if(null==t){const t=r.shape,s=t[0],o=t.slice(1).concat([s]);let a=i.reshape(r,[s].concat(yi(t.slice(1))));a=i.transpose(a,[1,0]),a=i.reshape(a,o),e.push(a),n=!0}else if(t>1){const s=xi(1,t).concat([0]);e.push(i.transpose(r,s)),n=!0}else e.push(r)}let r=this.mergeFunction(e);const s=r.rank;if(n)if(null==s){const t=r.shape,e=t[t.length-1],n=[e].concat(t.slice(0,t.length-1));r=i.reshape(i.transpose(i.reshape(r,[-1,e]),[1,0]),n)}else if(s>1){const t=[s-1].concat(xi(0,s-1));r=i.transpose(r,t)}return r}}return this.mergeFunction(t)}))}computeOutputShape(t){let e;e=null==(t=t)[0]?null:t[0].slice(1);for(let n=1;n<t.length;++n){const i=null==t[n]?null:t[n].slice(1);e=this.computeElementwiseOpOutputShape(e,i)}let n=[];for(const e of t)null!=e&&null!==e[0]&&n.push(e[0]);return n=Rn(n),e=1===n.length?n.concat(e):[null].concat(e),e}computeMask(t,e){return i.tidy((()=>{if(null==e)return null;if(!Array.isArray(e))throw new kn("`mask` should be an Array");if(!Array.isArray(t))throw new kn("`inputs` should be an Array");if(e.length!==t.length)throw new kn(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every((t=>null==t)))return null;let n=(e=e.map((t=>null==t?t:i.expandDims(t,0))))[0];for(let t=1;t<e.length-1;++t)n=i.logicalAnd(n,e[t]);return n}))}}class ra extends ia{constructor(t){super(t)}mergeFunction(t){return(0,i.tidy)((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=i.add(e,t[n]);return e}))}}ra.className="Add",i.serialization.registerClass(ra);class sa extends ia{constructor(t){super(t)}mergeFunction(t){return(0,i.tidy)((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=i.mul(e,t[n]);return e}))}}sa.className="Multiply",i.serialization.registerClass(sa);class oa extends ia{constructor(t){super(t)}mergeFunction(t){return(0,i.tidy)((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=i.add(e,t[n]);return i.mul(1/t.length,e)}))}}oa.className="Average",i.serialization.registerClass(oa);class aa extends ia{constructor(t){super(t)}mergeFunction(t){return(0,i.tidy)((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=i.maximum(e,t[n]);return e}))}}aa.className="Maximum",i.serialization.registerClass(aa);class ua extends ia{constructor(t){super(t)}mergeFunction(t){return(0,i.tidy)((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=i.minimum(e,t[n]);return e}))}}ua.className="Minimum",i.serialization.registerClass(ua);class la extends ia{constructor(t){super(t),this.DEFAULT_AXIS=-1,null==t&&(t={}),this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new kn("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let e=!0;for(const n of t)if(null!=n){e=!1;break}if(e)return;const n=[];for(let e=0;e<t.length;++e){const r=t[e].slice();r.splice(this.axis,1);let s=!1;for(const t of n)if(i.util.arraysEqual(t,r)){s=!0;break}s||n.push(r)}if(n.length>1)throw new kn("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return(0,i.tidy)((()=>Ei(t,this.axis)))}computeOutputShape(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new kn("A `Concatenate` layer should be called on a list of inputs.");const e=t,n=e[0].slice(),i=this.axis<0?n.length+this.axis:this.axis;for(const t of e.slice(1)){if(null==n[i]||null==t[i]){n[i]=null;break}n[i]+=t[i]}return n}computeMask(t,e){if(null==e)return null;if(!Array.isArray(e))throw new kn("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new kn("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new kn(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return i.tidy((()=>{let n=!0;if(e.forEach((t=>{null==t||(n=!1)})),n)return null;const r=[];for(let n=0;n<t.length;++n)null==e[n]?r.push(i.cast(i.onesLike(t[n]),"bool")):e[n].rank<t[n].rank?r.push(i.expandDims(e[n],-1)):r.push(e[n]);const s=i.concat(r,this.axis);return i.all(s,-1,!1)}))}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}function ca(t,e){for(;t<0;)t+=e;return t}la.className="Concatenate",i.serialization.registerClass(la);class ha extends ia{constructor(t){super(t),this.axes=t.axes,this.normalize=null!=t.normalize&&t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){i.util.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0],n=t[1];if(e.length>3||n.length>3)throw new Cn("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,n);if(e[r[0]]!==n[r[1]])throw new kn(`Dimension incompatibility: ${e[r[0]]} !== ${n[r[1]]}`)}mergeFunction(t){if(2!==t.length)throw new kn(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e,n=t[0],r=t[1];return e=Array.isArray(this.axes)?this.axes.map(((e,n)=>ca(e,t[n].shape.length))):[ca(this.axes,n.shape.length),ca(this.axes,r.shape.length)],this.normalize&&(n=jr(n,e[0]),r=jr(r,e[1])),function(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new Cn("batchDot is not implemented for tensors of 4D or higher rank yet");if(i.util.assert(t.shape.length>=2,(()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`)),i.util.assert(t.shape.length>=2,(()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`)),"number"==typeof n&&(n=[n,n]),"complex64"===t.dtype||"complex64"===e.dtype)throw new Cn("batchDot is not implemented for complex64-type Tensors yet.");const r=t.shape.length,s=e.shape.length;null==n&&(n=[r-1,s-2]);const o=n;return i.tidy((()=>{let n,a;if(r>s){n=r-s;const t=[];for(let e=0;e<n;++e)t.push(1);e=i.reshape(e,e.shape.concat(t))}else if(s>r){n=s-r;const e=[];for(let t=0;t<n;++t)e.push(1);t=i.reshape(t,t.shape.concat(e))}else n=0;if(2===t.shape.length&&2===e.shape.length)a=o[0]===o[1]?i.sum(i.mul(t,e),o[0]):i.sum(i.mul(i.transpose(t,[1,0]),e),o[1]);else{const n=o[0]!==t.shape.length-1,r=o[1]===e.shape.length-1;a=i.matMul(t,e,n,r)}if(n>0){let t;t=r>s?r+s-3:r-1;const e=[];for(let i=t;i<t+n;++i)e.push(i);a=i.squeeze(a,e)}return 1===a.shape.length&&(a=i.expandDims(a,1)),a}))}(n,r,e)}interpretAxes(t,e){let n;return n=Array.isArray(this.axes)?this.axes:[ca(this.axes,t.length),ca(this.axes,e.length)],n}computeOutputShape(t){i.util.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0].slice(),n=t[1].slice();if(e.length>3||n.length>3)throw new Cn("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,n);e.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const s=e.concat(n);return 1===s.length&&s.push(1),s}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}ha.className="Dot",i.serialization.registerClass(ha);class fa extends Ar{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return(0,i.tidy)((()=>{this.invokeCallHook(t,e);const n=hr(t);return Bi((()=>(0,i.add)(Si(n.shape,0,this.stddev),n)),(()=>n),e.training||!1)}))}}fa.className="GaussianNoise",i.serialization.registerClass(fa);class da extends Ar{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return(0,i.tidy)((()=>{this.invokeCallHook(t,e);const n=hr(t);return this.rate>0&&this.rate<1?Bi((()=>{const t=Math.sqrt(this.rate/(1-this.rate));return(0,i.mul)(n,Si(n.shape,1,t))}),(()=>n),e.training||!1):n}))}}da.className="GaussianDropout",i.serialization.registerClass(da);class pa extends Ar{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||hr(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return(0,i.tidy)((()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(t);return Bi((()=>{const e=hr(t),r=-1.7580993408473766;let s=(0,i.greaterEqual)((0,i.randomUniform)(n),this.rate);s=wi(s,"float32");const o=((1-this.rate)*(1+this.rate*r**2))**-.5,a=-o*r*this.rate,u=(0,i.add)((0,i.mul)(e,s),(0,i.mul)((0,i.add)(s,-1),r));return(0,i.add)((0,i.mul)(u,o),a)}),(()=>hr(t)),e.training||!1)}return t}))}}function ga(t,e,n,r,s,o=.001){let a;if(2===t.rank)a=i.batchNorm2d(t,e,n,r,s,o);else if(3===t.rank)a=i.batchNorm3d(t,e,n,r,s,o);else{if(4!==t.rank)throw new Cn(`batchNormalization is not implemented for array of rank ${t.rank} yet`);a=i.batchNorm4d(t,e,n,r,s,o)}return a}pa.className="AlphaDropout",i.serialization.registerClass(pa);class ma extends Ar{constructor(t){null==t&&(t={}),super(t),this.supportsMasking=!0,this.axis=null==t.axis?-1:t.axis,this.momentum=null==t.momentum?.99:t.momentum,this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=rr(t.betaInitializer||"zeros"),this.gammaInitializer=rr(t.gammaInitializer||"ones"),this.movingMeanInitializer=rr(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=rr(t.movingVarianceInitializer||"ones"),this.betaConstraint=ei(t.betaConstraint),this.gammaConstraint=ei(t.gammaConstraint),this.betaRegularizer=oo(t.betaRegularizer),this.gammaRegularizer=oo(t.gammaRegularizer)}build(t){t=fr(t);const e=this.axis>=0?this.axis:this.axis+t.length,n=t[e];if(null==n)throw new kn(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new yr({ndim:t.length,axes:{[e]:n}})];const i=[n];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return(0,i.tidy)((()=>{const n=null!=e.training&&e.training,r=hr(t),s=r.shape,o=s.length,a=xi(0,o),u=this.axis>=0?this.axis:this.axis+o;a.splice(u,1);const l=Dn(1,o);l[u]=s[u];const c=a.slice();c.sort();const h=!i.util.arraysEqual(c,xi(0,o).slice(0,o-1));if(!n)return(()=>{if(h){const t=(0,i.reshape)(this.movingMean.read(),l),e=(0,i.reshape)(this.movingVariance.read(),l),n=this.center?(0,i.reshape)(this.beta.read(),l):null,s=this.scale?(0,i.reshape)(this.gamma.read(),l):null;return ga(r,t,e,n,s,this.epsilon)}return ga(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[f,d,p]=function(t,e,n,r,s=.001){return i.util.arraysEqual(r.slice().sort(),xi(0,t.rank-1))?function(t,e,n,r,s=.001){return(0,i.tidy)((()=>{const o=i.moments(t,r),a=o.mean,u=o.variance;return[ga(t,a,u,n,e,s),a,u]}))}(t,e,n,r,s):function(t,e,n,r,s=.001){return(0,i.tidy)((()=>{const o=i.moments(t,r),a=o.mean,u=o.variance,l=[];for(const e of xi(0,t.rank))-1!==r.indexOf(e)?l.push(1):l.push(t.shape[e]);const c=(0,i.reshape)(a,l),h=(0,i.reshape)(u,l),f=null==e?null:(0,i.reshape)(e,l),d=null==n?null:(0,i.reshape)(n,l);return[ga(t,c,h,d,f,s),a,u]}))}(t,e,n,r,s)}(r,this.gamma.read(),this.beta.read(),a,this.epsilon),g=(t,e,n)=>{i.tidy((()=>{const r=1-n,s=t.read(),o=i.mul(i.sub(s,e),r);t.write(i.sub(s,o))}))};return(()=>{g(this.movingMean,d,this.momentum),g(this.movingVariance,p,this.momentum)})(),f}))}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ir(this.betaInitializer),gammaInitializer:ir(this.gammaInitializer),movingMeanInitializer:ir(this.movingMeanInitializer),movingVarianceInitializer:ir(this.movingVarianceInitializer),betaRegularizer:ro(this.betaRegularizer),gammaRegularizer:ro(this.gammaRegularizer),betaConstraint:Qn(this.betaConstraint),gammaConstraint:Qn(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}ma.className="BatchNormalization",i.serialization.registerClass(ma);class ya extends Ar{constructor(t){if(null==t&&(t={}),super(t),this.axis=null==t.axis?-1:t.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else{if(!Array.isArray(this.axis))throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=rr(t.betaInitializer||"zeros"),this.gammaInitializer=rr(t.gammaInitializer||"ones"),this.betaRegularizer=oo(t.betaRegularizer),this.gammaRegularizer=oo(t.gammaRegularizer),this.supportsMasking=!0}build(t){const e=(t=fr(t)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let t=0;t<this.axis.length;++t)this.axis[t]<0&&(this.axis[t]+=e);for(const t of this.axis)if(t<0||t>=e)throw new Error(`Invalid axis: ${t}`);if(this.axis.length!==Rn(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const n=this.axis.map((e=>t[e]));this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0}call(t,e){const n=hr(t),r=n.shape,s=r.length;return(0,i.tidy)((()=>{let{mean:t,variance:e}=(0,i.moments)(n,this.axis,!0);const o=Dn(1,s);for(const t of this.axis)o[t]=r[t];const a=t=>null!=t&&t.shape.length!==s?i.reshape(t,o):t;let u=a(this.gamma.read()),l=a(this.beta.read());const c=[],h=[];for(let t=0;t<s;++t)-1!==this.axis.indexOf(t)?(c.push(r[t]),h.push(1)):(c.push(1),h.push(r[t]));return t=i.tile(t,c),e=i.tile(e,c),u=i.tile(u,h),l=i.tile(l,h),ga(n,t,e,l,u,this.epsilon)}))}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ir(this.betaInitializer),gammaInitializer:ir(this.gammaInitializer),betaRegularizer:ro(this.betaRegularizer),gammaRegularizer:ro(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}ya.className="LayerNormalization",i.serialization.registerClass(ya);class va extends Ar{constructor(t){if(null==t&&(t={}),super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,null==t.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof t.padding)this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,2!==t.padding.length)throw new kn(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,n;if("number"==typeof t.padding[0])e=[t.padding[0],t.padding[0]],n=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,2!==t.padding[0].length)throw new kn(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],2!==t.padding[1].length)throw new kn(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);n=t.padding[1]}this.padding=[e,n]}this.inputSpec=[new yr({ndim:4})]}computeOutputShape(t){let e,n;return t=fr(t),"channelsFirst"===this.dataFormat?(e=null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],e,n]):(e=null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],e,n,t[3]])}call(t,e){return(0,i.tidy)((()=>{return e=hr(t),n=this.padding,r=this.dataFormat,(0,i.tidy)((()=>{if(4!==e.rank)throw new kn(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new kn("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==r&&(r="channelsLast"),"channelsLast"!==r&&"channelsFirst"!==r)throw new kn(`Unknown data format: ${r}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let t;return t="channelsFirst"===r?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],i.pad(e,t)}));var e,n,r}))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}function ba(t,e,n,r,s,o){return(0,i.tidy)((()=>{let a;ui(s),ci(o),li(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==s&&(s="channelsLast"),null==o&&(o="max"),t=yo(t,s);const u="same"===r?"same":"valid";return a="max"===o?i.maxPool(t,e,n,u):i.avgPool(t,e,n,u),"channelsFirst"===s&&(a=i.transpose(a,[0,3,1,2])),a}))}function xa(t,e,n,r,s,o){return(0,i.tidy)((()=>{let a;ui(s),ci(o),li(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==s&&(s="channelsLast"),null==o&&(o="max"),t=vo(t,s);const u="same"===r?"same":"valid";return a="max"===o?i.maxPool3d(t,e,n,u):i.avgPool3d(t,e,n,u),"channelsFirst"===s&&(a=i.transpose(a,[0,4,1,2,3])),a}))}va.className="ZeroPadding2D",i.serialization.registerClass(va);class wa extends Ar{constructor(t){if(null==t.poolSize&&(t.poolSize=2),super(t),"number"==typeof t.poolSize)this.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||1!==t.poolSize.length||"number"!=typeof t.poolSize[0])throw new kn(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);this.poolSize=t.poolSize}if(qn(this.poolSize,"poolSize"),null==t.strides)this.strides=this.poolSize;else if("number"==typeof t.strides)this.strides=[t.strides];else{if(!Array.isArray(t.strides)||1!==t.strides.length||"number"!=typeof t.strides[0])throw new kn(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);this.strides=t.strides}qn(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,li(this.padding),this.inputSpec=[new yr({ndim:3})]}computeOutputShape(t){const e=go((t=fr(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return(0,i.tidy)((()=>{this.invokeCallHook(t,e),t=Ai(hr(t),2);const n=this.poolingFunction(hr(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return i.squeeze(n,[2])}))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class Aa extends wa{constructor(t){super(t)}poolingFunction(t,e,n,i,r){return ui(r),li(i),ba(t,e,n,i,r,"max")}}Aa.className="MaxPooling1D",i.serialization.registerClass(Aa);class _a extends wa{constructor(t){super(t)}poolingFunction(t,e,n,i,r){return ui(r),li(i),ba(t,e,n,i,r,"avg")}}_a.className="AveragePooling1D",i.serialization.registerClass(_a);class ka extends Ar{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(2!==t.strides.length)throw new kn(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];qn(this.poolSize,"poolSize"),qn(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,ui(this.dataFormat),li(this.padding),this.inputSpec=[new yr({ndim:4})]}computeOutputShape(t){t=fr(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2];return e=go(e,this.poolSize[0],this.padding,this.strides[0]),n=go(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n]:[t[0],e,n,t[3]]}call(t,e){return(0,i.tidy)((()=>(this.invokeCallHook(t,e),this.poolingFunction(hr(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class Ca extends ka{constructor(t){super(t)}poolingFunction(t,e,n,i,r){return ui(r),li(i),ba(t,e,n,i,r,"max")}}Ca.className="MaxPooling2D",i.serialization.registerClass(Ca);class Ea extends ka{constructor(t){super(t)}poolingFunction(t,e,n,i,r){return ui(r),li(i),ba(t,e,n,i,r,"avg")}}Ea.className="AveragePooling2D",i.serialization.registerClass(Ea);class Da extends Ar{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(3!==t.strides.length)throw new kn(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];qn(this.poolSize,"poolSize"),qn(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,ui(this.dataFormat),li(this.padding),this.inputSpec=[new yr({ndim:5})]}computeOutputShape(t){t=fr(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],i="channelsFirst"===this.dataFormat?t[4]:t[3];return e=go(e,this.poolSize[0],this.padding,this.strides[0]),n=go(n,this.poolSize[1],this.padding,this.strides[1]),i=go(i,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n,i]:[t[0],e,n,i,t[4]]}call(t,e){return(0,i.tidy)((()=>(this.invokeCallHook(t,e),this.poolingFunction(hr(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class Fa extends Da{constructor(t){super(t)}poolingFunction(t,e,n,i,r){return ui(r),li(i),xa(t,e,n,i,r,"max")}}Fa.className="MaxPooling3D",i.serialization.registerClass(Fa);class Sa extends Da{constructor(t){super(t)}poolingFunction(t,e,n,i,r){return ui(r),li(i),xa(t,e,n,i,r,"avg")}}Sa.className="AveragePooling3D",i.serialization.registerClass(Sa);class Oa extends Ar{constructor(t){super(t),this.inputSpec=[new yr({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new Cn}}class Na extends Oa{constructor(t){super(t||{})}call(t,e){return(0,i.tidy)((()=>{const e=hr(t);return i.mean(e,1)}))}}Na.className="GlobalAveragePooling1D",i.serialization.registerClass(Na);class Ma extends Oa{constructor(t){super(t||{})}call(t,e){return(0,i.tidy)((()=>{const e=hr(t);return i.max(e,1)}))}}Ma.className="GlobalMaxPooling1D",i.serialization.registerClass(Ma);class za extends Ar{constructor(t){super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,ui(this.dataFormat),this.inputSpec=[new yr({ndim:4})]}computeOutputShape(t){return t=t,"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new Cn}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class $a extends za{call(t,e){return(0,i.tidy)((()=>{const e=hr(t);return"channelsLast"===this.dataFormat?i.mean(e,[1,2]):i.mean(e,[2,3])}))}}$a.className="GlobalAveragePooling2D",i.serialization.registerClass($a);class Ta extends za{call(t,e){return(0,i.tidy)((()=>{const e=hr(t);return"channelsLast"===this.dataFormat?i.max(e,[1,2]):i.max(e,[2,3])}))}}Ta.className="GlobalMaxPooling2D",i.serialization.registerClass(Ta);class Ba extends Ar{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(t){null!=this.layer&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,n={}){const i=Br(e.layer,n);delete e.layer;const r={layer:i};return Object.assign(r,e),new t(r)}}class ja extends Ba{constructor(t){super(t),this.supportsMasking=!0}build(t){if((t=fr(t)).length<3)throw new kn(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){const e=[(t=fr(t))[0]].concat(t.slice(2)),n=this.layer.computeOutputShape(e),i=t[1];return[n[0],i].concat(n.slice(1))}call(t,e){return(0,i.tidy)((()=>zo(((t,n)=>[hr(this.layer.call(t,e)),[]]),t=hr(t),[],!1,null,null,!1,!0)[1]))}}ja.className="TimeDistributed",i.serialization.registerClass(ja);class Ia extends Ba{constructor(t){super(t);const e=t.layer.getConfig(),n={};n.className=t.layer.getClassName(),n.config=e,this.forwardLayer=Br(n),e.goBackwards=!0!==e.goBackwards;const i={};var r;if(i.className=t.layer.getClassName(),i.config=e,this.backwardLayer=Br(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===t.mergeMode?"concat":t.mergeMode,r=this.mergeMode,Pn(oi,"BidirectionalMergeMode",r),t.weights)throw new Cn("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=t.length,n=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,n)),this.backwardLayer.setWeights(t.slice(n))}computeOutputShape(t){let e,n,i,r=this.forwardLayer.computeOutputShape(t);return Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r,this.returnState?(i=r.slice(1),e=r[0]):e=r[0],e=e,"concat"===this.mergeMode?(e[e.length-1]*=2,n=[e]):n=null==this.mergeMode?[e,e.slice()]:[e],this.returnState?null==this.mergeMode?n.concat(i).concat(i.slice()):[e].concat(i).concat(i.slice()):On(n)}apply(t,e){let n=null==e?null:e.initialState,i=null==e?null:e.constants;null==e&&(e={});const r=Mo(t,n,i,this.numConstants);if(t=r.inputs,n=r.initialState,i=r.constants,Array.isArray(t)&&(n=t.slice(1),t=t[0]),(null==n||0===n.length)&&null==i)return super.apply(t,e);const s=[],o=[];if(null!=n){const t=n.length;if(t%2>0)throw new kn("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e.initialState=n,s.push(...n);const i=n.map((t=>new yr({shape:t.shape})));this.forwardLayer.stateSpec=i.slice(0,t/2),this.backwardLayer.stateSpec=i.slice(t/2),o.push(...i)}if(null!=i)throw new Cn("Support for constants in Bidirectional layers is not implemented yet.");const a=s[0]instanceof vr;for(const t of s)if(t instanceof vr!==a)throw new kn("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(a){const n=[t].concat(s),i=this.inputSpec.concat(o),r=this.inputSpec;this.inputSpec=i;const a=super.apply(n,e);return this.inputSpec=r,a}return super.apply(t,e)}call(t,e){return(0,i.tidy)((()=>{const n=e.initialState;let r,s,o,a;if(null==n)r=this.forwardLayer.call(t,e),s=this.backwardLayer.call(t,e);else{const i=n.slice(0,n.length/2),o=n.slice(n.length/2);r=this.forwardLayer.call(t,Object.assign(e,{initialState:i})),s=this.backwardLayer.call(t,Object.assign(e,{initialState:o}))}return this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(s.slice(1))),r=r[0],s=s[0]),this.returnSequences&&(s=i.reverse(s,1)),"concat"===this.mergeMode?a=Ei([r,s]):"sum"===this.mergeMode?a=i.add(r,s):"ave"===this.mergeMode?a=i.mul(.5,i.add(r,s)):"mul"===this.mergeMode?a=i.mul(r,s):null==this.mergeMode&&(a=[r,s]),this.returnState?null==this.mergeMode?a.concat(o):[a].concat(o):a}))}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){fi(this.forwardLayer.name,(()=>{this.forwardLayer.build(t)})),fi(this.backwardLayer.name,(()=>{this.backwardLayer.build(t)})),this.built=!0}computeMask(t,e){let n;if(Array.isArray(e)&&(e=e[0]),n=this.returnSequences?null==this.mergeMode?[e,e]:e:null==this.mergeMode?[null,null]:null,this.returnState){const t=this.forwardLayer.states.map((t=>null));return Array.isArray(n)?n.concat(t).concat(t):[n].concat(t).concat(t)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(t),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const n=Br(e.layer);if(delete e.layer,null!=e.numConstants)throw new Cn("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=e;return i.layer=n,new t(i)}}Ia.className="Bidirectional",i.serialization.registerClass(Ia);var Ra,La,Pa=n(8264),Ua=n(521);function qa(t,e,n=new Map,i=new Set){if(null==t)return null;if("function"==typeof Blob&&t instanceof Blob)return t.slice();if(i.has(t))throw new Error("Circular references are not supported.");if(n.has(t))return n.get(t);const r=e(t);if(r.recurse&&null!==r.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(r.recurse){if(Ga(t)){const r=Array.isArray(t)?[]:{};i.add(t);for(const s in t){const o=qa(t[s],e,n,i);r[s]=o}return i.delete(t),t.__proto__&&(r.__proto__=t.__proto__),r}throw new Error(`Can't recurse into non-iterable type: ${t}`)}return n.set(t,r.value),r.value}function Wa(t,e=Va){return Ha(t,e)}function Ha(t,e,n=new Set){const i=t[0];if(n.has(i))throw new Error("Circular references are not supported.");const r=e(t);if(r.recurse&&null!==r.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(r.recurse){if(Ga(i)){const r=Array.isArray(i)?[]:{};n.add(i);for(const s in i){const i=Ha(t.map((t=>t[s])),e,n);r[s]=i}return n.delete(i),r}throw new Error(`Can't recurse into non-iterable type: ${i}`)}return r.value}function Va(t){return null===t?null:Ga(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}function Ga(t){let e=!1;if(i.env().get("IS_BROWSER"))e=t instanceof TextDecoder;else{const{StringDecoder:i}=n(9182);e=t instanceof i}return null!=t&&!ArrayBuffer.isView(t)&&(Array.isArray(t)||"object"==typeof t&&!(t instanceof i.Tensor)&&!(t instanceof Promise)&&!e)}function Xa(t){return qa(t,Ya)}function Ya(t){return t instanceof i.Tensor?{value:t.clone(),recurse:!1}:Ga(t)?{value:null,recurse:!0}:{value:t,recurse:!1}}class Ja{constructor(t){if(this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}wrap(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity}get(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]}set(t,e){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=e}length(){let t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)}pushAll(t){for(const e of t)this.push(e)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const t=this.get(this.end);return this.set(this.end,void 0),t}unshift(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t}shuffleExcise(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.wrap(this.begin+t),n=this.get(e);return this.set(e,this.pop()),n}}class Za extends Ja{constructor(){super(Za.INITIAL_CAPACITY)}isFull(){return!1}push(t){super.isFull()&&this.expand(),super.push(t)}unshift(t){super.isFull()&&this.expand(),super.unshift(t)}expand(){const t=2*this.capacity,e=new Array(t),n=this.length();for(let t=0;t<n;t++)e[t]=this.get(this.wrap(this.begin+t));this.data=e,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}Za.INITIAL_CAPACITY=32;class Ka{async toArray(){const t=[];let e=await this.next();for(;!e.done;)t.push(e.value),e=await this.next();return t}async toArrayForTest(){const t=this.prefetch(100),e=[];let n=await t.next();for(;!n.done;)e.push(n.value),n=await t.next();return e}async resolveFully(){let t=await this.next();for(;!t.done;)t=await this.next()}async resolveWhile(t){let e=await this.next(),n=t(e.value);for(;!e.done&&n;)e=await this.next(),n=t(e.value)}handleErrors(t){return new au(this,t)}filter(t){return new su(this,t)}map(t){return new ou(this,t)}mapAsync(t){return new uu(this,t)}serialMapAsync(t){return new uu(this,t).serial()}flatmap(t){return new cu(this,t)}async forEachAsync(t){return this.map(t).resolveFully()}async serialForEach(t){return this.serialMapAsync(t).resolveWhile((t=>!0===t))}rowMajorBatch(t,e=!0){return new ru(this,t,e)}columnMajorBatch(t,e=!0,n=Va){return this.rowMajorBatch(t,e).map((t=>Wa(t,n)))}concatenate(t,e){return new hu(new Qa([this,t]),e)}take(t){return t<0||null==t?this:new iu(this,t)}skip(t){return t<0||null==t?this:new nu(this,t)}prefetch(t){return new fu(this,t)}shuffle(t,e){return new du(this,t,e)}serial(){return new eu(this)}}class Qa extends Ka{constructor(t){super(),this.items=t,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const t=this.items[this.trav];return this.trav++,{value:Xa(t),done:!1}}}class tu extends Ka{constructor(t){super(),this.nextFn=t}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(t){throw t.message=`Error thrown while iterating through a dataset: ${t.message}`,t}}}class eu extends Ka{constructor(t){super(),this.upstream=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){return this.upstream.next()}}class nu extends Ka{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const t=await this.upstream.next();if(t.done)return t;i.dispose(t.value)}return this.upstream.next()}}class iu extends Ka{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class ru extends Ka{constructor(t,e,n=!0){super(),this.upstream=t,this.batchSize=e,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){const t=[];for(;t.length<this.batchSize;){const e=await this.upstream.next();if(e.done)return this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0};t.push(e.value)}return{value:t,done:!1}}}class su extends Ka{constructor(t,e){super(),this.upstream=t,this.predicate=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;){const t=await this.upstream.next();if(t.done||this.predicate(t.value))return t;i.dispose(t.value)}}}class ou extends Ka{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Map`}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=i.tensor_util.getTensorsInContainer(t.value),n=this.transform(t.value),r=i.tensor_util.getTensorsInContainer(n);for(const t of e)i.tensor_util.isTensorInList(t,r)||t.dispose();return{value:n,done:!1}}}class au extends Ka{constructor(t,e){super(),this.upstream=t,this.handler=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(t){if(!this.handler(t))return{value:null,done:!0}}}}class uu extends Ka{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=i.tensor_util.getTensorsInContainer(t.value),n=await this.transform(t.value),r=i.tensor_util.getTensorsInContainer(n);for(const t of e)i.tensor_util.isTensorInList(t,r)||t.dispose();return{value:n,done:!1}}}class lu extends Ka{constructor(){super(),this.outputQueue=new Za,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class cu extends lu{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const t=await this.upstream.next();if(t.done)return!1;const e=i.tensor_util.getTensorsInContainer(t.value),n=this.transform(t.value),r=i.tensor_util.getTensorsInContainer(n);this.outputQueue.pushAll(n);for(const t of e)i.tensor_util.isTensorInList(t,r)||t.dispose();return!0}}class hu extends Ka{constructor(t,e){super(),this.baseErrorHandler=e,this.lastRead=null,this.iterator=null,this.moreIterators=t}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(t){if(await t,null==this.iterator){const t=await this.moreIterators.next();if(t.done)return{value:null,done:!0};this.iterator=t.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const e=await this.iterator.next();return e.done?(this.iterator=null,this.readFromChain(t)):e}}(La=Ra||(Ra={}))[La.FAIL=0]="FAIL",La[La.SHORTEST=1]="SHORTEST",La[La.LONGEST=2]="LONGEST";class fu extends Ka{constructor(t,e){super(),this.upstream=t,this.bufferSize=e,this.buffer=new Ja(e)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){const t=this.upstream.next();this.buffer.push(t)}}next(){return this.refill(),this.buffer.shift()}}class du extends fu{constructor(t,e,n){super(t,e),this.upstream=t,this.windowSize=e,this.upstreamExhausted=!1,this.random=Ua.alea(n||i.util.now().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}randomInt(t){return Math.floor(this.random()*t)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const t=this.chooseIndex(),e=await this.buffer.shuffleExcise(t);if(!e.done)return this.refill(),e;this.upstreamExhausted=!0}return{value:null,done:!0}}}class pu{constructor(){this.size=null}batch(t,e=!0){const n=this;let r;return i.util.assert(t>0,(()=>`batchSize needs to be positive, but it is\n      ${t}`)),r=this.size===1/0||null==this.size?this.size:e?Math.ceil(this.size/t):Math.floor(this.size/t),gu((async()=>(await n.iterator()).columnMajorBatch(t,e,mu)),r)}concatenate(t){const e=this;let n;return n=this.size===1/0||t.size===1/0?1/0:null!=this.size&&null!=t.size?this.size+t.size:null,gu((async()=>(await e.iterator()).concatenate(await t.iterator())),n)}filter(t){const e=this;let n;return n=this.size===1/0?1/0:null,gu((async()=>(await e.iterator()).filter((e=>i.tidy((()=>t(e)))))),n)}async forEachAsync(t){return(await this.iterator()).forEachAsync(t)}map(t){const e=this;return gu((async()=>(await e.iterator()).map((e=>i.tidy((()=>t(e)))))),this.size)}mapAsync(t){const e=this;return gu((async()=>(await e.iterator()).mapAsync(t)),this.size)}prefetch(t){if(null==t)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const e=this;return gu((async()=>(await e.iterator()).prefetch(t)),this.size)}repeat(t){const e=this;let n;return n=null!=this.size&&t>0?this.size*t:0===t?0:null!=this.size&&(void 0===t||t<0)?1/0:null,gu((async()=>{return n=(r=async()=>({value:await e.iterator(),done:!1}),new tu(r)).take(t),new hu(n,i);var n,i,r}),n)}skip(t){const e=this;let n;return n=null!=this.size&&t>=0&&this.size>=t?this.size-t:null!=this.size&&(this.size<t||void 0===t||t<0)?0:null,gu((async()=>(await e.iterator()).skip(t)),n)}shuffle(t,e,n=!0){if(null==t||t<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const r=this,s=Ua.alea(e||i.util.now().toString());return gu((async()=>{let e=s.int32();return n&&(e+=s.int32()),(await r.iterator()).shuffle(t,e.toString())}),this.size)}take(t){const e=this;let n;return n=null!=this.size&&this.size>t?t:null!=this.size&&this.size<=t?this.size:null,gu((async()=>(await e.iterator()).take(t)),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function gu(t,e=null){return new class extends pu{constructor(){super(...arguments),this.size=e}async iterator(){return t()}}}function mu(t){if(null===t)return null;return null==(e=t[0])||null===(n=e)||"object"!=typeof n&&"function"!=typeof n||Array.isArray(e)||"object"==typeof e&&e instanceof i.Tensor||i.util.isTypedArray(e)?{value:function(t){if(0===t.length)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof i.Tensor?i.stack(t):i.tensor(t)}(t),recurse:!1}:{value:null,recurse:!0};var e,n}pu.MAX_BUFFER_SIZE=1e4,Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote"),n(8834).Buffer;var yu=n(317),vu=n(5218);i.version_core,yu.P6,vu.ic,Pa.version_converter},2779:(t,e)=>{var n;!function(){"use strict";var i={}.hasOwnProperty;function r(){for(var t=[],e=0;e<arguments.length;e++){var n=arguments[e];if(n){var s=typeof n;if("string"===s||"number"===s)t.push(n);else if(Array.isArray(n)){if(n.length){var o=r.apply(null,n);o&&t.push(o)}}else if("object"===s){if(n.toString!==Object.prototype.toString&&!n.toString.toString().includes("[native code]")){t.push(n.toString());continue}for(var a in n)i.call(n,a)&&n[a]&&t.push(a)}}}return t.join(" ")}t.exports?(r.default=r,t.exports=r):void 0===(n=function(){return r}.apply(e,[]))||(t.exports=n)}()},8138:(t,e,n)=>{var i=n(8834).Buffer,r=function(){"use strict";function t(t,e){return null!=e&&t instanceof e}var e,n,r;try{e=Map}catch(t){e=function(){}}try{n=Set}catch(t){n=function(){}}try{r=Promise}catch(t){r=function(){}}function s(o,u,l,c,h){"object"==typeof u&&(l=u.depth,c=u.prototype,h=u.includeNonEnumerable,u=u.circular);var f=[],d=[],p=void 0!==i;return void 0===u&&(u=!0),void 0===l&&(l=1/0),function o(l,g){if(null===l)return null;if(0===g)return l;var m,y;if("object"!=typeof l)return l;if(t(l,e))m=new e;else if(t(l,n))m=new n;else if(t(l,r))m=new r((function(t,e){l.then((function(e){t(o(e,g-1))}),(function(t){e(o(t,g-1))}))}));else if(s.__isArray(l))m=[];else if(s.__isRegExp(l))m=new RegExp(l.source,a(l)),l.lastIndex&&(m.lastIndex=l.lastIndex);else if(s.__isDate(l))m=new Date(l.getTime());else{if(p&&i.isBuffer(l))return m=i.allocUnsafe?i.allocUnsafe(l.length):new i(l.length),l.copy(m),m;t(l,Error)?m=Object.create(l):void 0===c?(y=Object.getPrototypeOf(l),m=Object.create(y)):(m=Object.create(c),y=c)}if(u){var v=f.indexOf(l);if(-1!=v)return d[v];f.push(l),d.push(m)}for(var b in t(l,e)&&l.forEach((function(t,e){var n=o(e,g-1),i=o(t,g-1);m.set(n,i)})),t(l,n)&&l.forEach((function(t){var e=o(t,g-1);m.add(e)})),l){var x;y&&(x=Object.getOwnPropertyDescriptor(y,b)),x&&null==x.set||(m[b]=o(l[b],g-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(l);for(b=0;b<w.length;b++){var A=w[b];(!(k=Object.getOwnPropertyDescriptor(l,A))||k.enumerable||h)&&(m[A]=o(l[A],g-1),k.enumerable||Object.defineProperty(m,A,{enumerable:!1}))}}if(h){var _=Object.getOwnPropertyNames(l);for(b=0;b<_.length;b++){var k,C=_[b];(k=Object.getOwnPropertyDescriptor(l,C))&&k.enumerable||(m[C]=o(l[C],g-1),Object.defineProperty(m,C,{enumerable:!1}))}}return m}(o,l)}function o(t){return Object.prototype.toString.call(t)}function a(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return s.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},s.__objToStr=o,s.__isDate=function(t){return"object"==typeof t&&"[object Date]"===o(t)},s.__isArray=function(t){return"object"==typeof t&&"[object Array]"===o(t)},s.__isRegExp=function(t){return"object"==typeof t&&"[object RegExp]"===o(t)},s.__getRegExpFlags=a,s}();t.exports&&(t.exports=r)},9977:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return(0,r.default)(t)};var i,r=(i=n(3603))&&i.__esModule?i:{default:i};t.exports=e.default},522:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return"string"==typeof t&&n.test(t)};var n=/-webkit-|-moz-|-ms-/;t.exports=e.default},9735:(t,e,n)=>{"use strict";n.r(e),n.d(e,{clientPoint:()=>_t,create:()=>vt,creator:()=>u,customEvent:()=>lt,event:()=>it,local:()=>xt,matcher:()=>m,mouse:()=>kt,namespace:()=>s,namespaces:()=>r,select:()=>yt,selectAll:()=>Ct,selection:()=>mt,selector:()=>c,selectorAll:()=>f,style:()=>M,touch:()=>Et,touches:()=>Dt,window:()=>F});var i="http://www.w3.org/1999/xhtml";const r={svg:"http://www.w3.org/2000/svg",xhtml:i,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function s(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),r.hasOwnProperty(e)?{space:r[e],local:t}:t}function o(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===i&&e.documentElement.namespaceURI===i?e.createElement(t):e.createElementNS(n,t)}}function a(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function u(t){var e=s(t);return(e.local?a:o)(e)}function l(){}function c(t){return null==t?l:function(){return this.querySelector(t)}}function h(){return[]}function f(t){return null==t?h:function(){return this.querySelectorAll(t)}}var d=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var p=document.documentElement;if(!p.matches){var g=p.webkitMatchesSelector||p.msMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector;d=function(t){return function(){return g.call(this,t)}}}}const m=d;function y(t){return new Array(t.length)}function v(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function b(t,e,n,i,r,s){for(var o,a=0,u=e.length,l=s.length;a<l;++a)(o=e[a])?(o.__data__=s[a],i[a]=o):n[a]=new v(t,s[a]);for(;a<u;++a)(o=e[a])&&(r[a]=o)}function x(t,e,n,i,r,s,o){var a,u,l,c={},h=e.length,f=s.length,d=new Array(h);for(a=0;a<h;++a)(u=e[a])&&(d[a]=l="$"+o.call(u,u.__data__,a,e),l in c?r[a]=u:c[l]=u);for(a=0;a<f;++a)(u=c[l="$"+o.call(t,s[a],a,s)])?(i[a]=u,u.__data__=s[a],c[l]=null):n[a]=new v(t,s[a]);for(a=0;a<h;++a)(u=e[a])&&c[d[a]]===u&&(r[a]=u)}function w(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function A(t){return function(){this.removeAttribute(t)}}function _(t){return function(){this.removeAttributeNS(t.space,t.local)}}function k(t,e){return function(){this.setAttribute(t,e)}}function C(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function E(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function D(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function F(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function S(t){return function(){this.style.removeProperty(t)}}function O(t,e,n){return function(){this.style.setProperty(t,e,n)}}function N(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function M(t,e){return t.style.getPropertyValue(e)||F(t).getComputedStyle(t,null).getPropertyValue(e)}function z(t){return function(){delete this[t]}}function $(t,e){return function(){this[t]=e}}function T(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function B(t){return t.trim().split(/^|\s+/)}function j(t){return t.classList||new I(t)}function I(t){this._node=t,this._names=B(t.getAttribute("class")||"")}function R(t,e){for(var n=j(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function L(t,e){for(var n=j(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function P(t){return function(){R(this,t)}}function U(t){return function(){L(this,t)}}function q(t,e){return function(){(e.apply(this,arguments)?R:L)(this,t)}}function W(){this.textContent=""}function H(t){return function(){this.textContent=t}}function V(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function G(){this.innerHTML=""}function X(t){return function(){this.innerHTML=t}}function Y(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function J(){this.nextSibling&&this.parentNode.appendChild(this)}function Z(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function K(){return null}function Q(){var t=this.parentNode;t&&t.removeChild(this)}function tt(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function et(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}v.prototype={constructor:v,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},I.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var nt={},it=null;function rt(t,e,n){return t=st(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function st(t,e,n){return function(i){var r=it;it=i;try{t.call(this,this.__data__,e,n)}finally{it=r}}}function ot(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function at(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,s=e.length;i<s;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.capture);++r?e.length=r:delete this.__on}}}function ut(t,e,n){var i=nt.hasOwnProperty(t.type)?rt:st;return function(r,s,o){var a,u=this.__on,l=i(e,s,o);if(u)for(var c=0,h=u.length;c<h;++c)if((a=u[c]).type===t.type&&a.name===t.name)return this.removeEventListener(a.type,a.listener,a.capture),this.addEventListener(a.type,a.listener=l,a.capture=n),void(a.value=e);this.addEventListener(t.type,l,n),a={type:t.type,name:t.name,value:e,listener:l,capture:n},u?u.push(a):this.__on=[a]}}function lt(t,e,n,i){var r=it;t.sourceEvent=it,it=t;try{return e.apply(n,i)}finally{it=r}}function ct(t,e,n){var i=F(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function ht(t,e){return function(){return ct(this,t,e)}}function ft(t,e){return function(){return ct(this,t,e.apply(this,arguments))}}"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(nt={mouseenter:"mouseover",mouseleave:"mouseout"}));var dt=[null];function pt(t,e){this._groups=t,this._parents=e}function gt(){return new pt([[document.documentElement]],dt)}pt.prototype=gt.prototype={constructor:pt,select:function(t){"function"!=typeof t&&(t=c(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s,o,a=e[r],u=a.length,l=i[r]=new Array(u),h=0;h<u;++h)(s=a[h])&&(o=t.call(s,s.__data__,h,a))&&("__data__"in s&&(o.__data__=s.__data__),l[h]=o);return new pt(i,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=f(t));for(var e=this._groups,n=e.length,i=[],r=[],s=0;s<n;++s)for(var o,a=e[s],u=a.length,l=0;l<u;++l)(o=a[l])&&(i.push(t.call(o,o.__data__,l,a)),r.push(o));return new pt(i,r)},filter:function(t){"function"!=typeof t&&(t=m(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var s,o=e[r],a=o.length,u=i[r]=[],l=0;l<a;++l)(s=o[l])&&t.call(s,s.__data__,l,o)&&u.push(s);return new pt(i,this._parents)},data:function(t,e){if(!t)return p=new Array(this.size()),c=-1,this.each((function(t){p[++c]=t})),p;var n,i=e?x:b,r=this._parents,s=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var o=s.length,a=new Array(o),u=new Array(o),l=new Array(o),c=0;c<o;++c){var h=r[c],f=s[c],d=f.length,p=t.call(h,h&&h.__data__,c,r),g=p.length,m=u[c]=new Array(g),y=a[c]=new Array(g);i(h,f,m,y,l[c]=new Array(d),p,e);for(var v,w,A=0,_=0;A<g;++A)if(v=m[A]){for(A>=_&&(_=A+1);!(w=y[_])&&++_<g;);v._next=w||null}}return(a=new pt(a,r))._enter=u,a._exit=l,a},enter:function(){return new pt(this._enter||this._groups.map(y),this._parents)},exit:function(){return new pt(this._exit||this._groups.map(y),this._parents)},merge:function(t){for(var e=this._groups,n=t._groups,i=e.length,r=n.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var u,l=e[a],c=n[a],h=l.length,f=o[a]=new Array(h),d=0;d<h;++d)(u=l[d]||c[d])&&(f[d]=u);for(;a<i;++a)o[a]=e[a];return new pt(o,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],s=r.length-1,o=r[s];--s>=0;)(i=r[s])&&(o&&o!==i.nextSibling&&o.parentNode.insertBefore(i,o),o=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=w);for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o,a=n[s],u=a.length,l=r[s]=new Array(u),c=0;c<u;++c)(o=a[c])&&(l[c]=o);l.sort(e)}return new pt(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each((function(){t[++e]=this})),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null},size:function(){var t=0;return this.each((function(){++t})),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,s=e[n],o=0,a=s.length;o<a;++o)(r=s[o])&&t.call(r,r.__data__,o,s);return this},attr:function(t,e){var n=s(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?_:A:"function"==typeof e?n.local?D:E:n.local?C:k)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?S:"function"==typeof e?N:O)(t,e,null==n?"":n)):M(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?z:"function"==typeof e?T:$)(t,e)):this.node()[t]},classed:function(t,e){var n=B(t+"");if(arguments.length<2){for(var i=j(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?q:e?P:U)(n,e))},text:function(t){return arguments.length?this.each(null==t?W:("function"==typeof t?V:H)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?G:("function"==typeof t?Y:X)(t)):this.node().innerHTML},raise:function(){return this.each(J)},lower:function(){return this.each(Z)},append:function(t){var e="function"==typeof t?t:u(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:u(t),i=null==e?K:"function"==typeof e?e:c(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(Q)},clone:function(t){return this.select(t?et:tt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,s=ot(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?ut:at,null==n&&(n=!1),i=0;i<o;++i)this.each(a(s[i],e,n));return this}var a=this.node().__on;if(a)for(var u,l=0,c=a.length;l<c;++l)for(i=0,u=a[l];i<o;++i)if((r=s[i]).type===u.type&&r.name===u.name)return u.value},dispatch:function(t,e){return this.each(("function"==typeof e?ft:ht)(t,e))}};const mt=gt;function yt(t){return"string"==typeof t?new pt([[document.querySelector(t)]],[document.documentElement]):new pt([[t]],dt)}function vt(t){return yt(u(t).call(document.documentElement))}var bt=0;function xt(){return new wt}function wt(){this._="@"+(++bt).toString(36)}function At(){for(var t,e=it;t=e.sourceEvent;)e=t;return e}function _t(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}function kt(t){var e=At();return e.changedTouches&&(e=e.changedTouches[0]),_t(t,e)}function Ct(t){return"string"==typeof t?new pt([document.querySelectorAll(t)],[document.documentElement]):new pt([null==t?[]:t],dt)}function Et(t,e,n){arguments.length<3&&(n=e,e=At().changedTouches);for(var i,r=0,s=e?e.length:0;r<s;++r)if((i=e[r]).identifier===n)return _t(t,i);return null}function Dt(t,e){null==e&&(e=At().touches);for(var n=0,i=e?e.length:0,r=new Array(i);n<i;++n)r[n]=_t(t,e[n]);return r}wt.prototype=xt.prototype={constructor:wt,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}}},9378:t=>{"use strict";t.exports=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){if(e.constructor!==n.constructor)return!1;var i,r,s;if(Array.isArray(e)){if((i=e.length)!=n.length)return!1;for(r=i;0!=r--;)if(!t(e[r],n[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if((i=(s=Object.keys(e)).length)!==Object.keys(n).length)return!1;for(r=i;0!=r--;)if(!Object.prototype.hasOwnProperty.call(n,s[r]))return!1;for(r=i;0!=r--;){var o=s[r];if(!t(e[o],n[o]))return!1}return!0}return e!=e&&n!=n}},5695:t=>{"use strict";t.exports=function(t,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var n,i="boolean"==typeof e.cycles&&e.cycles,r=e.cmp&&(n=e.cmp,function(t){return function(e,i){var r={key:e,value:t[e]},s={key:i,value:t[i]};return n(r,s)}}),s=[];return function t(e){if(e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0!==e){if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);var n,o;if(Array.isArray(e)){for(o="[",n=0;n<e.length;n++)n&&(o+=","),o+=t(e[n])||"null";return o+"]"}if(null===e)return"null";if(-1!==s.indexOf(e)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=s.push(e)-1,u=Object.keys(e).sort(r&&r(e));for(o="",n=0;n<u.length;n++){var l=u[n],c=t(e[l]);c&&(o&&(o+=","),o+=JSON.stringify(l)+":"+c)}return s.splice(a,1),"{"+o+"}"}}(t)}},3594:t=>{"use strict";var e=/-(.)/g;t.exports=function(t){return t.replace(e,(function(t,e){return e.toUpperCase()}))}},6542:(t,e,n)=>{"use strict";var i=n(3594),r=/^-ms-/;t.exports=function(t){return i(t.replace(r,"ms-"))}},7201:t=>{"use strict";function e(t){return function(){return t}}var n=function(){};n.thatReturns=e,n.thatReturnsFalse=e(!1),n.thatReturnsTrue=e(!0),n.thatReturnsNull=e(null),n.thatReturnsThis=function(){return this},n.thatReturnsArgument=function(t){return t},t.exports=n},2501:t=>{"use strict";var e=/([A-Z])/g;t.exports=function(t){return t.replace(e,"-$1").toLowerCase()}},5901:(t,e,n)=>{"use strict";var i=n(2501),r=/^ms-/;t.exports=function(t){return i(t).replace(r,"-ms-")}},9846:t=>{"use strict";t.exports=function(t){var e={};return function(n){return e.hasOwnProperty(n)||(e[n]=t.call(this,n)),e[n]}}},6590:(t,e,n)=>{"use strict";var i=n(7201);t.exports=i},4079:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},i=["Webkit","ms","Moz","O"];Object.keys(n).forEach((function(t){i.forEach((function(e){n[function(t,e){return t+e.charAt(0).toUpperCase()+e.substring(1)}(e,t)]=n[t]}))}));var r={isUnitlessNumber:n,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}};e.default=r},9291:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(4079));function r(t){return t&&t.__esModule?t:{default:t}}r(n(6590));var s=i.default.isUnitlessNumber;e.default=function(t,e,n){return null==e||"boolean"==typeof e||""===e?"":isNaN(e)||0===e||s.hasOwnProperty(t)&&s[t]?""+e:("string"==typeof e&&(e=e.trim()),e+"px")}},787:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.processStyleName=void 0,e.createMarkupForStyles=function(t,e){var n="";for(var r in t){var s=0===r.indexOf("--");if(t.hasOwnProperty(r)&&"label"!==r){var o=t[r];null!=o&&(s?n+=r+":"+o+";":(n+=a(r)+":",n+=(0,i.default)(r,o,e)+";"))}}return n||null},o(n(6542));var i=o(n(9291)),r=o(n(5901)),s=o(n(9846));function o(t){return t&&t.__esModule?t:{default:t}}o(n(6590));var a=e.processStyleName=(0,s.default)(r.default)},5096:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function i(t){return Array.isArray(t)?(r=!1,s=[],(e=t).forEach((function(t){var e=i(t);null!==e&&e===t||(r=!0),null!==e&&s.push(e)})),0==s.length?null:r?s:e):function(t){if(function(t){return null==t||!1===t||"object"===(void 0===t?"undefined":n(t))&&0===Object.keys(t).length}(t))return null;if("object"!==(void 0===t?"undefined":n(t)))return t;for(var e={},r=Object.keys(t),s=!1,o=0;o<r.length;o++){var a=t[r[o]],u=i(a);null!==u&&u===a||(s=!0),null!==u&&(e[r[o]]=u)}return 0===Object.keys(e).length?null:s?e:t}(t);var e,r,s}e.default=i},5902:(t,e)=>{"use strict";function n(t,e){return t.charCodeAt(e++)+(t.charCodeAt(e++)<<8)+(t.charCodeAt(e++)<<16)+(t.charCodeAt(e)<<24)}function i(t,e){return t.charCodeAt(e++)+(t.charCodeAt(e++)<<8)}function r(t,e){return(65535&(t|=0))*(e|=0)+(((t>>>16)*e&65535)<<16)|0}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){for(var s=1540483477,o=e^t.length,a=t.length,u=0;a>=4;){var l=n(t,u);l=r(l,s),l=r(l^=l>>>24,s),o=r(o,s),o^=l,u+=4,a-=4}switch(a){case 3:o^=i(t,u),o=r(o^=t.charCodeAt(u+2)<<16,s);break;case 2:o=r(o^=i(t,u),s);break;case 1:o=r(o^=t.charCodeAt(u),s)}return o=r(o^=o>>>13,s),(o^=o>>>15)>>>0}},1978:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.compose=e.merge=e.$=e.style=e.presets=e.keyframes=e.fontFace=e.insertGlobal=e.insertRule=e.plugins=e.styleSheet=void 0,e.speedy=function(t){return h.speedy(t)},e.simulations=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];p=!!t},e.simulate=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return(e=(0,o.default)(e))?p?e.reduce((function(t,e){return t["data-simulate-"+v(e)]="",t}),{}):(g||(console.warn("can't simulate without once calling simulations(true)"),g=!0),m||(console.warn("don't use simulation outside dev"),m=!0),{}):{}},e.cssLabels=function(t){y=!!t},e.isLikeRule=x,e.idFor=w,e.css=U,e.rehydrate=function(t){(0,i.default)(F,t.reduce((function(t,e){return t[e]=!0,t}),{}))},e.flush=function(){F=h.inserted={},S=h.registered={},N={},h.flush(),h.inject()},e.select=W,e.parent=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return U(c({},t+" &",n))},e.media=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return U(c({},"@media "+t,n))},e.pseudo=H,e.active=function(t){return H(":active",t)},e.any=function(t){return H(":any",t)},e.checked=function(t){return H(":checked",t)},e.disabled=function(t){return H(":disabled",t)},e.empty=function(t){return H(":empty",t)},e.enabled=function(t){return H(":enabled",t)},e._default=function(t){return H(":default",t)},e.first=function(t){return H(":first",t)},e.firstChild=function(t){return H(":first-child",t)},e.firstOfType=function(t){return H(":first-of-type",t)},e.fullscreen=function(t){return H(":fullscreen",t)},e.focus=function(t){return H(":focus",t)},e.hover=function(t){return H(":hover",t)},e.indeterminate=function(t){return H(":indeterminate",t)},e.inRange=function(t){return H(":in-range",t)},e.invalid=function(t){return H(":invalid",t)},e.lastChild=function(t){return H(":last-child",t)},e.lastOfType=function(t){return H(":last-of-type",t)},e.left=function(t){return H(":left",t)},e.link=function(t){return H(":link",t)},e.onlyChild=function(t){return H(":only-child",t)},e.onlyOfType=function(t){return H(":only-of-type",t)},e.optional=function(t){return H(":optional",t)},e.outOfRange=function(t){return H(":out-of-range",t)},e.readOnly=function(t){return H(":read-only",t)},e.readWrite=function(t){return H(":read-write",t)},e.required=function(t){return H(":required",t)},e.right=function(t){return H(":right",t)},e.root=function(t){return H(":root",t)},e.scope=function(t){return H(":scope",t)},e.target=function(t){return H(":target",t)},e.valid=function(t){return H(":valid",t)},e.visited=function(t){return H(":visited",t)},e.dir=function(t,e){return H(":dir("+t+")",e)},e.lang=function(t,e){return H(":lang("+t+")",e)},e.not=function(t,e){var n=t.split(",").map((function(t){return t.trim()})).map((function(t){return":not("+t+")"}));return 1===n.length?H(":not("+t+")",e):W(n.join(""),e)},e.nthChild=function(t,e){return H(":nth-child("+t+")",e)},e.nthLastChild=function(t,e){return H(":nth-last-child("+t+")",e)},e.nthLastOfType=function(t,e){return H(":nth-last-of-type("+t+")",e)},e.nthOfType=function(t,e){return H(":nth-of-type("+t+")",e)},e.after=function(t){return H("::after",t)},e.before=function(t){return H("::before",t)},e.firstLetter=function(t){return H("::first-letter",t)},e.firstLine=function(t){return H("::first-line",t)},e.selection=function(t){return H("::selection",t)},e.backdrop=function(t){return H("::backdrop",t)},e.placeholder=function(t){return U({"::placeholder":t})},e.cssFor=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return(e=(0,o.default)(e))?e.map((function(t){var e={label:[]};return B(e,{src:t}),D(b(e),E(e)).join("")})).join(""):""},e.attribsFor=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=(e=(0,o.default)(e))?e.map((function(t){w(t);var e=Object.keys(t)[0];return e+'="'+(t[e]||"")+'"'})).join(" "):"";return i};var i=l(n(7320)),r=n(3873),s=n(787),o=l(n(5096)),a=n(7543),u=l(n(5902));function l(t){return t&&t.__esModule?t:{default:t}}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var h=e.styleSheet=new r.StyleSheet;h.inject();var f=e.plugins=h.plugins=new a.PluginSet([a.prefixes,a.contentWrap,a.fallbacks]);f.media=new a.PluginSet,f.fontFace=new a.PluginSet,f.keyframes=new a.PluginSet([a.prefixes,a.fallbacks]);var d="undefined"!=typeof window,p=false,g=!1,m=!1,y=false;function v(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t.toLowerCase().replace(/[^a-z0-9]/g,e)}function b(t){var e=JSON.stringify(t),n=(0,u.default)(e).toString(36);return t.label&&t.label.length,n}function x(t){var e=Object.keys(t).filter((function(t){return"toString"!==t}));return 1===e.length&&!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(e[0])}function w(t){var e=Object.keys(t).filter((function(t){return"toString"!==t}));if(1!==e.length)throw new Error("not a rule");var n=/data\-css\-([a-zA-Z0-9\-_]+)/.exec(e[0]);if(!n)throw new Error("not a rule");return n[1]}var A=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function _(t){if(-1===t.indexOf(","))return[t];for(var e,n=[],i=[],r=0;e=A.exec(t);)switch(e[0]){case"(":r++;break;case")":r--;break;case",":if(r)break;n.push(e.index)}for(e=n.length;e--;)i.unshift(t.slice(n[e]+1)),t=t.slice(0,n[e]);return i.unshift(t),i}function k(t,e){if(!t)return e.replace(/\&/g,"");if(!e)return".css-"+t+",[data-css-"+t+"]";var n=_(e).map((function(e){return e.indexOf("&")>=0?[e.replace(/\&/gm,".css-"+t),e.replace(/\&/gm,"[data-css-"+t+"]")].join(","):".css-"+t+e+",[data-css-"+t+"]"+e})).join(",");return p&&/^\&\:/.exec(e)&&!/\s/.exec(e)&&(n+=",.css-"+t+"[data-simulate-"+v(e)+"],[data-css-"+t+"][data-simulate-"+v(e)+"]"),n}function C(t){var e=t.selector,n=t.style,i=f.transform({selector:e,style:n});return i.selector+"{"+(0,s.createMarkupForStyles)(i.style)+"}"}function E(t){var e=void 0,n=void 0,i=void 0,r=void 0;return Object.keys(t).forEach((function(s){s.indexOf("&")>=0?(n=n||{})[s]=t[s]:0===s.indexOf("@media")?(i=i||{})[s]=E(t[s]):0===s.indexOf("@supports")?(r=r||{})[s]=E(t[s]):"label"===s?t.label.length>0&&((e=e||{}).label=y?t.label.join("."):""):(e=e||{})[s]=t[s]})),{plain:e,selects:n,medias:i,supports:r}}function D(t,e){var n=[],i=e.plain,r=e.selects,s=e.medias,o=e.supports;return i&&n.push(C({style:i,selector:k(t)})),r&&Object.keys(r).forEach((function(e){return n.push(C({style:r[e],selector:k(t,e)}))})),s&&Object.keys(s).forEach((function(e){return n.push(e+"{"+D(t,s[e]).join("")+"}")})),o&&Object.keys(o).forEach((function(e){return n.push(e+"{"+D(t,o[e]).join("")+"}")})),n}var F=h.inserted={},S=h.registered={};function O(t){S[t.id]||(S[t.id]=t)}var N={};function M(t,e){var n=_(t).map((function(t){return t.indexOf("&")>=0?t:"&"+t}));return _(e).map((function(t){return t.indexOf("&")>=0?t:"&"+t})).reduce((function(t,e){return t.concat(n.map((function(t){return e.replace(/\&/g,t)})))}),[]).join(",")}function z(t,e){return t?"@supports "+t.substring(9)+" and "+e.substring(9):e}function $(t){for(var e=[],n=0;n<t.length;n++)e=Array.isArray(t[n])?e.concat($(t[n])):e.concat(t[n]);return e}var T={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function B(t,e){var n=e.selector,i=void 0===n?"":n,r=e.mq,s=void 0===r?"":r,a=e.supp,u=void 0===a?"":a,l=e.src,c=void 0===l?{}:l;Array.isArray(c)||(c=[c]),(c=$(c)).forEach((function(e){if(x(e)){var n=function(t){if(x(t)){var e=S[w(t)];if(null==e)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return e}return t}(e);if("css"!==n.type)throw new Error("cannot merge this rule");e=n.style}(e=(0,o.default)(e))&&e.composes&&B(t,{selector:i,mq:s,supp:u,src:e.composes}),Object.keys(e||{}).forEach((function(n){if(function(t){for(var e=[":",".","[",">"," "],n=!1,i=t.charAt(0),r=0;r<e.length;r++)if(i===e[r]){n=!0;break}return n||t.indexOf("&")>=0}(n))T[n]&&T[n].forEach((function(r){return B(t,{selector:M(i,r),mq:s,supp:u,src:e[n]})})),B(t,{selector:M(i,n),mq:s,supp:u,src:e[n]});else if(function(t){return 0===t.indexOf("@media")}(n))B(t,{selector:i,mq:(o=s,a=n,o?"@media "+o.substring(6)+" and "+a.substring(6):a),supp:u,src:e[n]});else if(function(t){return 0===t.indexOf("@supports")}(n))B(t,{selector:i,mq:s,supp:z(u,n),src:e[n]});else if("composes"===n);else{var r=t;u&&(r[u]=r[u]||{},r=r[u]),s&&(r[s]=r[s]||{},r=r[s]),i&&(r[i]=r[i]||{},r=r[i]),"label"===n?y&&(t.label=t.label.concat(e.label)):r[n]=e[n]}var o,a}))}))}function j(t){var e={label:[]};return B(e,{src:t}),function(t){if(O(t),function(t){if(!F[t.id]){F[t.id]=!0;var e=E(t.style),n=D(t.id,e);F[t.id]=!!d||n,n.forEach((function(t){return h.insert(t)}))}}(t),N[t.id])return N[t.id];var e=c({},"data-css-"+t.id,y&&t.label||"");return Object.defineProperty(e,"toString",{enumerable:!1,value:function(){return"css-"+t.id}}),N[t.id]=e,e}({id:b(e),style:e,label:y?e.label.join("."):"",type:"css"})}var I={};Object.defineProperty(I,"toString",{enumerable:!1,value:function(){return"css-nil"}});var R,L="undefined"!=typeof WeakMap?[I,new WeakMap,new WeakMap,new WeakMap]:[I],P="undefined"!=typeof WeakMap?(R=j,function(t){if(L[t.length]){for(var e=L[t.length],n=0;n<t.length-1;)e.has(t[n])||e.set(t[n],new WeakMap),e=e.get(t[n]),n++;if(e.has(t[t.length-1])){var i=e.get(t[n]);if(S[i.toString().substring(4)])return i}}var r=R(t);if(L[t.length]){for(var s=0,o=L[t.length];s<t.length-1;)o=o.get(t[s]),s++;try{o.set(t[s],r)}catch(t){}}return r}):j;function U(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e[0]&&e[0].length&&e[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return(e=(0,o.default)(e))?P(e):I}U.insert=function(t){var e={id:b(t),css:t,type:"raw"};O(e),F[e.id]||(h.insert(e.css),F[e.id]=!!d||[e.css])},e.insertRule=U.insert,U.global=function(t,e){if(e=(0,o.default)(e))return U.insert(C({selector:t,style:e}))},e.insertGlobal=U.global,U.keyframes=function(t,e){e||(e=t,t="animation");var n={id:b({name:t,kfs:e=(0,o.default)(e)||{}}),type:"keyframes",name:t,keyframes:e};return O(n),function(t){if(!F[t.id]){var e=Object.keys(t.keyframes).map((function(e){var n=f.keyframes.transform({id:t.id,name:e,style:t.keyframes[e]});return n.name+"{"+(0,s.createMarkupForStyles)(n.style)+"}"})).join(""),n=["-webkit-","-moz-","-o-",""].map((function(n){return"@"+n+"keyframes "+t.name+"_"+t.id+"{"+e+"}"}));n.forEach((function(t){return h.insert(t)})),F[t.id]=!!d||n}}(n),t+"_"+n.id},U.fontFace=function(t){var e={id:b(t=(0,o.default)(t)),type:"font-face",font:t};return O(e),function(t){if(!F[t.id]){var e="@font-face{"+(0,s.createMarkupForStyles)(t.font)+"}";h.insert(e),F[t.id]=!!d||[e]}}(e),t.fontFamily},e.fontFace=U.fontFace,e.keyframes=U.keyframes,e.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var q=e.style=U;function W(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return t?U(c({},t,n)):q(n)}function H(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return U(c({},t,n))}e.$=W,e.merge=U,e.compose=U},7543:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};e.PluginSet=u,e.fallbacks=function(t){if(Object.keys(t.style).map((function(e){return Array.isArray(t.style[e])})).indexOf(!0)>=0){var e=t.style,n=Object.keys(e).reduce((function(t,n){return t[n]=Array.isArray(e[n])?e[n].join("; "+(0,s.processStyleName)(n)+": "):e[n],t}),{});return(0,r.default)({},t,{style:n})}return t},e.contentWrap=function(t){if(t.style.content){var e=t.style.content;return l.indexOf(e)>=0||/^(attr|calc|counters?|url)\(/.test(e)?t:e.charAt(0)!==e.charAt(e.length-1)||'"'!==e.charAt(0)&&"'"!==e.charAt(0)?i({},t,{style:i({},t.style,{content:'"'+e+'"'})}):t}return t},e.prefixes=function(t){return(0,r.default)({},t,{style:(0,o.default)(i({},t.style))})};var r=a(n(7320)),s=n(787),o=a(n(6626));function a(t){return t&&t.__esModule?t:{default:t}}function u(t){this.fns=t||[]}(0,r.default)(u.prototype,{add:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach((function(e){t.fns.indexOf(e)>=0||(t.fns=[e].concat(t.fns))}))},remove:function(t){this.fns=this.fns.filter((function(e){return e!==t}))},clear:function(){this.fns=[]},transform:function(t){return this.fns.reduce((function(t,e){return e(t)}),t)}});var l=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"]},6626:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){for(var e in t){var n=t[e],i=(0,s.default)(y,e,n,t,v);i&&(t[e]=i),(0,r.default)(v,e,t)}return t};var i=m(n(6218)),r=m(n(3720)),s=m(n(1408)),o=m(n(6139)),a=m(n(7237)),u=m(n(7451)),l=m(n(487)),c=m(n(9806)),h=m(n(8480)),f=m(n(1727)),d=m(n(7670)),p=m(n(6849)),g=m(n(5633));function m(t){return t&&t.__esModule?t:{default:t}}var y=[a.default,o.default,u.default,c.default,h.default,f.default,d.default,p.default,g.default,l.default],v=i.default.prefixMap},3873:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StyleSheet=c;var i,r=(i=n(7320))&&i.__esModule?i:{default:i};function s(t){return t[t.length-1]}function o(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}var a="undefined"!=typeof window,u=function(){if(a){var t=document.createElement("div");return t.innerHTML="\x3c!--[if lt IE 10]><i></i><![endif]--\x3e",1===t.getElementsByTagName("i").length}}();function l(){var t=document.createElement("style");return t.type="text/css",t.setAttribute("data-glamor",""),t.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(t),t}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.speedy,n=void 0===e||e,i=t.maxLength,r=void 0===i?a&&u?4e3:65e3:i;this.isSpeedy=n,this.sheet=void 0,this.tags=[],this.maxLength=r,this.ctr=0}(0,r.default)(c.prototype,{getSheet:function(){return o(s(this.tags))},inject:function(){var t=this;if(this.injected)throw new Error("already injected stylesheet!");a?this.tags[0]=l():this.sheet={cssRules:[],insertRule:function(e){t.sheet.cssRules.push({cssText:e})}},this.injected=!0},speedy:function(t){if(0!==this.ctr)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+t+") earlier in your app, or call flush() before speedy("+t+")");this.isSpeedy=!!t},_insert:function(t){try{var e=this.getSheet();e.insertRule(t,-1!==t.indexOf("@import")?0:e.cssRules.length)}catch(t){}},insert:function(t){if(a)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(t);else if(-1!==t.indexOf("@import")){var e=s(this.tags);e.insertBefore(document.createTextNode(t),e.firstChild)}else s(this.tags).appendChild(document.createTextNode(t));else this.sheet.insertRule(t,-1!==t.indexOf("@import")?0:this.sheet.cssRules.length);return this.ctr++,a&&this.ctr%this.maxLength==0&&this.tags.push(l()),this.ctr-1},delete:function(t){return this.replace(t,"")},flush:function(){a?(this.tags.forEach((function(t){return t.parentNode.removeChild(t)})),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!a)return this.sheet.cssRules;var t=[];return this.tags.forEach((function(e){return t.splice.apply(t,[t.length,0].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(Array.from(o(e).cssRules))))})),t}})},3603:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var i=/[A-Z]/g,r=/^ms-/,s={};function o(t){return"-"+t.toLowerCase()}const a=function(t){if(s.hasOwnProperty(t))return s[t];var e=t.replace(i,o);return s[t]=r.test(e)?"-"+e:e}},7237:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,r.default)(e)&&e.indexOf("cross-fade(")>-1)return s.map((function(t){return e.replace(/cross-fade\(/g,t+"cross-fade(")}))};var i,r=(i=n(522))&&i.__esModule?i:{default:i},s=["-webkit-",""];t.exports=e.default},6139:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("cursor"===t&&i.hasOwnProperty(e))return n.map((function(t){return t+e}))};var n=["-webkit-","-moz-",""],i={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};t.exports=e.default},7451:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,r.default)(e)&&e.indexOf("filter(")>-1)return s.map((function(t){return e.replace(/filter\(/g,t+"filter(")}))};var i,r=(i=n(522))&&i.__esModule?i:{default:i},s=["-webkit-",""];t.exports=e.default},487:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("display"===t&&n.hasOwnProperty(e))return n[e]};var n={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};t.exports=e.default},9806:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,r){"flexDirection"===t&&"string"==typeof e&&(e.indexOf("column")>-1?r.WebkitBoxOrient="vertical":r.WebkitBoxOrient="horizontal",e.indexOf("reverse")>-1?r.WebkitBoxDirection="reverse":r.WebkitBoxDirection="normal"),i.hasOwnProperty(t)&&(r[i[t]]=n[e]||e)};var n={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},i={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};t.exports=e.default},8480:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,r.default)(e)&&o.test(e))return s.map((function(t){return t+e}))};var i,r=(i=n(522))&&i.__esModule?i:{default:i},s=["-webkit-","-moz-",""],o=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;t.exports=e.default},1727:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,r.default)(e)&&e.indexOf("image-set(")>-1)return s.map((function(t){return e.replace(/image-set\(/g,t+"image-set(")}))};var i,r=(i=n(522))&&i.__esModule?i:{default:i},s=["-webkit-",""];t.exports=e.default},7670:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("position"===t&&"sticky"===e)return["-webkit-sticky","sticky"]},t.exports=e.default},6849:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(i.hasOwnProperty(t)&&r.hasOwnProperty(e))return n.map((function(t){return t+e}))};var n=["-webkit-","-moz-",""],i={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},r={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};t.exports=e.default},5633:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,o){if("string"==typeof e&&a.hasOwnProperty(t)){var l=function(t,e){if((0,r.default)(t))return t;for(var n=t.split(/,(?![^()]*(?:\([^()]*\))?\))/g),s=0,o=n.length;s<o;++s){var a=n[s],l=[a];for(var c in e){var h=(0,i.default)(c);if(a.indexOf(h)>-1&&"order"!==h)for(var f=e[c],d=0,p=f.length;d<p;++d)l.unshift(a.replace(h,u[f[d]]+h))}n[s]=l.join(",")}return n.join(",")}(e,o),c=l.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(t){return!/-moz-|-ms-/.test(t)})).join(",");if(t.indexOf("Webkit")>-1)return c;var h=l.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(t){return!/-webkit-|-ms-/.test(t)})).join(",");return t.indexOf("Moz")>-1?h:(n["Webkit"+(0,s.default)(t)]=c,n["Moz"+(0,s.default)(t)]=h,l)}};var i=o(n(9977)),r=o(n(522)),s=o(n(3741));function o(t){return t&&t.__esModule?t:{default:t}}var a={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},u={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};t.exports=e.default},6218:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=["Webkit"],i=["Moz"],r=["ms"],s=["Webkit","Moz"],o=["Webkit","ms"],a=["Webkit","Moz","ms"];e.default={plugins:[],prefixMap:{appearance:s,userSelect:a,textEmphasisPosition:n,textEmphasis:n,textEmphasisStyle:n,textEmphasisColor:n,boxDecorationBreak:n,clipPath:n,maskImage:n,maskMode:n,maskRepeat:n,maskPosition:n,maskClip:n,maskOrigin:n,maskSize:n,maskComposite:n,mask:n,maskBorderSource:n,maskBorderMode:n,maskBorderSlice:n,maskBorderWidth:n,maskBorderOutset:n,maskBorderRepeat:n,maskBorder:n,maskType:n,textDecorationStyle:n,textDecorationSkip:n,textDecorationLine:n,textDecorationColor:n,filter:n,fontFeatureSettings:n,breakAfter:a,breakBefore:a,breakInside:a,columnCount:s,columnFill:s,columnGap:s,columnRule:s,columnRuleColor:s,columnRuleStyle:s,columnRuleWidth:s,columns:s,columnSpan:s,columnWidth:s,writingMode:o,flex:n,flexBasis:n,flexDirection:n,flexGrow:n,flexFlow:n,flexShrink:n,flexWrap:n,alignContent:n,alignItems:n,alignSelf:n,justifyContent:n,order:n,transform:n,transformOrigin:n,transformOriginX:n,transformOriginY:n,backfaceVisibility:n,perspective:n,perspectiveOrigin:n,transformStyle:n,transformOriginZ:n,animation:n,animationDelay:n,animationDirection:n,animationFillMode:n,animationDuration:n,animationIterationCount:n,animationName:n,animationPlayState:n,animationTimingFunction:n,backdropFilter:n,fontKerning:n,scrollSnapType:o,scrollSnapPointsX:o,scrollSnapPointsY:o,scrollSnapDestination:o,scrollSnapCoordinate:o,shapeImageThreshold:n,shapeImageMargin:n,shapeImageOutside:n,hyphens:a,flowInto:o,flowFrom:o,regionFragment:o,textAlignLast:i,tabSize:i,wrapFlow:r,wrapThrough:r,wrapMargin:r,gridTemplateColumns:r,gridTemplateRows:r,gridTemplateAreas:r,gridTemplate:r,gridAutoColumns:r,gridAutoRows:r,gridAutoFlow:r,grid:r,gridRowStart:r,gridColumnStart:r,gridRowEnd:r,gridRow:r,gridColumn:r,gridColumnEnd:r,gridColumnGap:r,gridRowGap:r,gridArea:r,gridGap:r,textSizeAdjust:o,borderImage:n,borderImageOutset:n,borderImageRepeat:n,borderImageSlice:n,borderImageSource:n,borderImageWidth:n,transitionDelay:n,transitionDuration:n,transitionProperty:n,transitionTimingFunction:n}},t.exports=e.default},3741:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},t.exports=e.default},3720:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){if(t.hasOwnProperty(e))for(var i=t[e],s=0,o=i.length;s<o;++s)n[i[s]+(0,r.default)(e)]=n[e]};var i,r=(i=n(3741))&&i.__esModule?i:{default:i};t.exports=e.default},1408:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,i,r){for(var s=0,o=t.length;s<o;++s){var a=t[s](e,n,i,r);if(a)return a}},t.exports=e.default},7105:(t,e,n)=>{"use strict";const i=n(8006),r=Symbol("max"),s=Symbol("length"),o=Symbol("lengthCalculator"),a=Symbol("allowStale"),u=Symbol("maxAge"),l=Symbol("dispose"),c=Symbol("noDisposeOnSet"),h=Symbol("lruList"),f=Symbol("cache"),d=Symbol("updateAgeOnGet"),p=()=>1,g=(t,e,n)=>{const i=t[f].get(e);if(i){const e=i.value;if(m(t,e)){if(v(t,i),!t[a])return}else n&&(t[d]&&(i.value.now=Date.now()),t[h].unshiftNode(i));return e.value}},m=(t,e)=>{if(!e||!e.maxAge&&!t[u])return!1;const n=Date.now()-e.now;return e.maxAge?n>e.maxAge:t[u]&&n>t[u]},y=t=>{if(t[s]>t[r])for(let e=t[h].tail;t[s]>t[r]&&null!==e;){const n=e.prev;v(t,e),e=n}},v=(t,e)=>{if(e){const n=e.value;t[l]&&t[l](n.key,n.value),t[s]-=n.length,t[f].delete(n.key),t[h].removeNode(e)}};class b{constructor(t,e,n,i,r){this.key=t,this.value=e,this.length=n,this.now=i,this.maxAge=r||0}}const x=(t,e,n,i)=>{let r=n.value;m(t,r)&&(v(t,n),t[a]||(r=void 0)),r&&e.call(i,r.value,r.key,t)};t.exports=class{constructor(t){if("number"==typeof t&&(t={max:t}),t||(t={}),t.max&&("number"!=typeof t.max||t.max<0))throw new TypeError("max must be a non-negative number");this[r]=t.max||1/0;const e=t.length||p;if(this[o]="function"!=typeof e?p:e,this[a]=t.stale||!1,t.maxAge&&"number"!=typeof t.maxAge)throw new TypeError("maxAge must be a number");this[u]=t.maxAge||0,this[l]=t.dispose,this[c]=t.noDisposeOnSet||!1,this[d]=t.updateAgeOnGet||!1,this.reset()}set max(t){if("number"!=typeof t||t<0)throw new TypeError("max must be a non-negative number");this[r]=t||1/0,y(this)}get max(){return this[r]}set allowStale(t){this[a]=!!t}get allowStale(){return this[a]}set maxAge(t){if("number"!=typeof t)throw new TypeError("maxAge must be a non-negative number");this[u]=t,y(this)}get maxAge(){return this[u]}set lengthCalculator(t){"function"!=typeof t&&(t=p),t!==this[o]&&(this[o]=t,this[s]=0,this[h].forEach((t=>{t.length=this[o](t.value,t.key),this[s]+=t.length}))),y(this)}get lengthCalculator(){return this[o]}get length(){return this[s]}get itemCount(){return this[h].length}rforEach(t,e){e=e||this;for(let n=this[h].tail;null!==n;){const i=n.prev;x(this,t,n,e),n=i}}forEach(t,e){e=e||this;for(let n=this[h].head;null!==n;){const i=n.next;x(this,t,n,e),n=i}}keys(){return this[h].toArray().map((t=>t.key))}values(){return this[h].toArray().map((t=>t.value))}reset(){this[l]&&this[h]&&this[h].length&&this[h].forEach((t=>this[l](t.key,t.value))),this[f]=new Map,this[h]=new i,this[s]=0}dump(){return this[h].map((t=>!m(this,t)&&{k:t.key,v:t.value,e:t.now+(t.maxAge||0)})).toArray().filter((t=>t))}dumpLru(){return this[h]}set(t,e,n){if((n=n||this[u])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const i=n?Date.now():0,a=this[o](e,t);if(this[f].has(t)){if(a>this[r])return v(this,this[f].get(t)),!1;const o=this[f].get(t).value;return this[l]&&(this[c]||this[l](t,o.value)),o.now=i,o.maxAge=n,o.value=e,this[s]+=a-o.length,o.length=a,this.get(t),y(this),!0}const d=new b(t,e,a,i,n);return d.length>this[r]?(this[l]&&this[l](t,e),!1):(this[s]+=d.length,this[h].unshift(d),this[f].set(t,this[h].head),y(this),!0)}has(t){if(!this[f].has(t))return!1;const e=this[f].get(t).value;return!m(this,e)}get(t){return g(this,t,!0)}peek(t){return g(this,t,!1)}pop(){const t=this[h].tail;return t?(v(this,t),t.value):null}del(t){v(this,this[f].get(t))}load(t){this.reset();const e=Date.now();for(let n=t.length-1;n>=0;n--){const i=t[n],r=i.e||0;if(0===r)this.set(i.k,i.v);else{const t=r-e;t>0&&this.set(i.k,i.v,t)}}}prune(){this[f].forEach(((t,e)=>g(this,e,!1)))}}},7320:t=>{"use strict";var e=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function r(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(t){i[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(t){return!1}}()?Object.assign:function(t,s){for(var o,a,u=r(t),l=1;l<arguments.length;l++){for(var c in o=Object(arguments[l]))n.call(o,c)&&(u[c]=o[c]);if(e){a=e(o);for(var h=0;h<a.length;h++)i.call(o,a[h])&&(u[a[h]]=o[a[h]])}}return u}},2427:(t,e,n)=>{"use strict";function i(){}n.r(e),n.d(e,{Component:()=>B,cloneElement:()=>c,createElement:()=>a,default:()=>I,h:()=>a,options:()=>r,render:()=>j,rerender:()=>p});var r={},s=[],o=[];function a(t,e){var n,a,u,l,c=o;for(l=arguments.length;l-- >2;)s.push(arguments[l]);for(e&&null!=e.children&&(s.length||s.push(e.children),delete e.children);s.length;)if((a=s.pop())&&void 0!==a.pop)for(l=a.length;l--;)s.push(a[l]);else"boolean"==typeof a&&(a=null),(u="function"!=typeof t)&&(null==a?a="":"number"==typeof a?a=String(a):"string"!=typeof a&&(u=!1)),u&&n?c[c.length-1]+=a:c===o?c=[a]:c.push(a),n=u;var h=new i;return h.nodeName=t,h.children=c,h.attributes=null==e?void 0:e,h.key=null==e?void 0:e.key,void 0!==r.vnode&&r.vnode(h),h}function u(t,e){for(var n in e)t[n]=e[n];return t}var l="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function c(t,e){return a(t.nodeName,u(u({},t.attributes),e),arguments.length>2?[].slice.call(arguments,2):t.children)}var h=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,f=[];function d(t){!t._dirty&&(t._dirty=!0)&&1==f.push(t)&&(r.debounceRendering||l)(p)}function p(){var t,e=f;for(f=[];t=e.pop();)t._dirty&&$(t)}function g(t,e,n){return"string"==typeof e||"number"==typeof e?void 0!==t.splitText:"string"==typeof e.nodeName?!t._componentConstructor&&m(t,e.nodeName):n||t._componentConstructor===e.nodeName}function m(t,e){return t.normalizedNodeName===e||t.nodeName.toLowerCase()===e.toLowerCase()}function y(t){var e=u({},t.attributes);e.children=t.children;var n=t.nodeName.defaultProps;if(void 0!==n)for(var i in n)void 0===e[i]&&(e[i]=n[i]);return e}function v(t){var e=t.parentNode;e&&e.removeChild(t)}function b(t,e,n,i,r){if("className"===e&&(e="class"),"key"===e);else if("ref"===e)n&&n(null),i&&i(t);else if("class"!==e||r)if("style"===e){if(i&&"string"!=typeof i&&"string"!=typeof n||(t.style.cssText=i||""),i&&"object"==typeof i){if("string"!=typeof n)for(var s in n)s in i||(t.style[s]="");for(var s in i)t.style[s]="number"==typeof i[s]&&!1===h.test(s)?i[s]+"px":i[s]}}else if("dangerouslySetInnerHTML"===e)i&&(t.innerHTML=i.__html||"");else if("o"==e[0]&&"n"==e[1]){var o=e!==(e=e.replace(/Capture$/,""));e=e.toLowerCase().substring(2),i?n||t.addEventListener(e,x,o):t.removeEventListener(e,x,o),(t._listeners||(t._listeners={}))[e]=i}else if("list"!==e&&"type"!==e&&!r&&e in t)!function(t,e,n){try{t[e]=n}catch(t){}}(t,e,null==i?"":i),null!=i&&!1!==i||t.removeAttribute(e);else{var a=r&&e!==(e=e.replace(/^xlink:?/,""));null==i||!1===i?a?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.removeAttribute(e):"function"!=typeof i&&(a?t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),i):t.setAttribute(e,i))}else t.className=i||""}function x(t){return this._listeners[t.type](r.event&&r.event(t)||t)}var w=[],A=0,_=!1,k=!1;function C(){for(var t;t=w.pop();)r.afterMount&&r.afterMount(t),t.componentDidMount&&t.componentDidMount()}function E(t,e,n,i,r,s){A++||(_=null!=r&&void 0!==r.ownerSVGElement,k=null!=t&&!("__preactattr_"in t));var o=D(t,e,n,i,s);return r&&o.parentNode!==r&&r.appendChild(o),--A||(k=!1,s||C()),o}function D(t,e,n,i,r){var s=t,o=_;if(null!=e&&"boolean"!=typeof e||(e=""),"string"==typeof e||"number"==typeof e)return t&&void 0!==t.splitText&&t.parentNode&&(!t._component||r)?t.nodeValue!=e&&(t.nodeValue=e):(s=document.createTextNode(e),t&&(t.parentNode&&t.parentNode.replaceChild(s,t),F(t,!0))),s.__preactattr_=!0,s;var a,u,l=e.nodeName;if("function"==typeof l)return function(t,e,n,i){for(var r=t&&t._component,s=r,o=t,a=r&&t._componentConstructor===e.nodeName,u=a,l=y(e);r&&!u&&(r=r._parentComponent);)u=r.constructor===e.nodeName;return r&&u&&(!i||r._component)?(z(r,l,3,n,i),t=r.base):(s&&!a&&(T(s),t=o=null),r=N(e.nodeName,l,n),t&&!r.nextBase&&(r.nextBase=t,o=null),z(r,l,1,n,i),t=r.base,o&&t!==o&&(o._component=null,F(o,!1))),t}(t,e,n,i);if(_="svg"===l||"foreignObject"!==l&&_,l=String(l),(!t||!m(t,l))&&(a=l,(u=_?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a)).normalizedNodeName=a,s=u,t)){for(;t.firstChild;)s.appendChild(t.firstChild);t.parentNode&&t.parentNode.replaceChild(s,t),F(t,!0)}var c=s.firstChild,h=s.__preactattr_,f=e.children;if(null==h){h=s.__preactattr_={};for(var d=s.attributes,p=d.length;p--;)h[d[p].name]=d[p].value}return!k&&f&&1===f.length&&"string"==typeof f[0]&&null!=c&&void 0!==c.splitText&&null==c.nextSibling?c.nodeValue!=f[0]&&(c.nodeValue=f[0]):(f&&f.length||null!=c)&&function(t,e,n,i,r){var s,o,a,u,l,c=t.childNodes,h=[],f={},d=0,p=0,m=c.length,y=0,b=e?e.length:0;if(0!==m)for(var x=0;x<m;x++){var w=c[x],A=w.__preactattr_;null!=(_=b&&A?w._component?w._component.__key:A.key:null)?(d++,f[_]=w):(A||(void 0!==w.splitText?!r||w.nodeValue.trim():r))&&(h[y++]=w)}if(0!==b)for(x=0;x<b;x++){var _;if(l=null,null!=(_=(u=e[x]).key))d&&void 0!==f[_]&&(l=f[_],f[_]=void 0,d--);else if(!l&&p<y)for(s=p;s<y;s++)if(void 0!==h[s]&&g(o=h[s],u,r)){l=o,h[s]=void 0,s===y-1&&y--,s===p&&p++;break}l=D(l,u,n,i),a=c[x],l&&l!==t&&l!==a&&(null==a?t.appendChild(l):l===a.nextSibling?v(a):t.insertBefore(l,a))}if(d)for(var x in f)void 0!==f[x]&&F(f[x],!1);for(;p<=y;)void 0!==(l=h[y--])&&F(l,!1)}(s,f,n,i,k||null!=h.dangerouslySetInnerHTML),function(t,e,n){var i;for(i in n)e&&null!=e[i]||null==n[i]||b(t,i,n[i],n[i]=void 0,_);for(i in e)"children"===i||"innerHTML"===i||i in n&&e[i]===("value"===i||"checked"===i?t[i]:n[i])||b(t,i,n[i],n[i]=e[i],_)}(s,e.attributes,h),_=o,s}function F(t,e){var n=t._component;n?T(n):(null!=t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),!1!==e&&null!=t.__preactattr_||v(t),S(t))}function S(t){for(t=t.lastChild;t;){var e=t.previousSibling;F(t,!0),t=e}}var O={};function N(t,e,n){var i,r=O[t.name];if(t.prototype&&t.prototype.render?(i=new t(e,n),B.call(i,e,n)):((i=new B(e,n)).constructor=t,i.render=M),r)for(var s=r.length;s--;)if(r[s].constructor===t){i.nextBase=r[s].nextBase,r.splice(s,1);break}return i}function M(t,e,n){return this.constructor(t,n)}function z(t,e,n,i,s){t._disable||(t._disable=!0,(t.__ref=e.ref)&&delete e.ref,(t.__key=e.key)&&delete e.key,!t.base||s?t.componentWillMount&&t.componentWillMount():t.componentWillReceiveProps&&t.componentWillReceiveProps(e,i),i&&i!==t.context&&(t.prevContext||(t.prevContext=t.context),t.context=i),t.prevProps||(t.prevProps=t.props),t.props=e,t._disable=!1,0!==n&&(1!==n&&!1===r.syncComponentUpdates&&t.base?d(t):$(t,1,s)),t.__ref&&t.__ref(t))}function $(t,e,n,i){if(!t._disable){var s,o,a,l=t.props,c=t.state,h=t.context,f=t.prevProps||l,d=t.prevState||c,p=t.prevContext||h,g=t.base,m=t.nextBase,v=g||m,b=t._component,x=!1;if(g&&(t.props=f,t.state=d,t.context=p,2!==e&&t.shouldComponentUpdate&&!1===t.shouldComponentUpdate(l,c,h)?x=!0:t.componentWillUpdate&&t.componentWillUpdate(l,c,h),t.props=l,t.state=c,t.context=h),t.prevProps=t.prevState=t.prevContext=t.nextBase=null,t._dirty=!1,!x){s=t.render(l,c,h),t.getChildContext&&(h=u(u({},h),t.getChildContext()));var _,k,D=s&&s.nodeName;if("function"==typeof D){var S=y(s);(o=b)&&o.constructor===D&&S.key==o.__key?z(o,S,1,h,!1):(_=o,t._component=o=N(D,S,h),o.nextBase=o.nextBase||m,o._parentComponent=t,z(o,S,0,h,!1),$(o,1,n,!0)),k=o.base}else a=v,(_=b)&&(a=t._component=null),(v||1===e)&&(a&&(a._component=null),k=E(a,s,h,n||!g,v&&v.parentNode,!0));if(v&&k!==v&&o!==b){var O=v.parentNode;O&&k!==O&&(O.replaceChild(k,v),_||(v._component=null,F(v,!1)))}if(_&&T(_),t.base=k,k&&!i){for(var M=t,B=t;B=B._parentComponent;)(M=B).base=k;k._component=M,k._componentConstructor=M.constructor}}if(!g||n?w.unshift(t):x||(t.componentDidUpdate&&t.componentDidUpdate(f,d,p),r.afterUpdate&&r.afterUpdate(t)),null!=t._renderCallbacks)for(;t._renderCallbacks.length;)t._renderCallbacks.pop().call(t);A||i||C()}}function T(t){r.beforeUnmount&&r.beforeUnmount(t);var e=t.base;t._disable=!0,t.componentWillUnmount&&t.componentWillUnmount(),t.base=null;var n=t._component;n?T(n):e&&(e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),t.nextBase=e,v(e),function(t){var e=t.constructor.name;(O[e]||(O[e]=[])).push(t)}(t),S(e)),t.__ref&&t.__ref(null)}function B(t,e){this._dirty=!0,this.context=e,this.props=t,this.state=this.state||{}}function j(t,e,n){return E(n,t,{},!1,e,!1)}u(B.prototype,{setState:function(t,e){var n=this.state;this.prevState||(this.prevState=u({},n)),u(n,"function"==typeof t?t(n,this.props):t),e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),d(this)},forceUpdate:function(t){t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),$(this,2)},render:function(){}});const I={h:a,createElement:a,cloneElement:c,Component:B,render:j,rerender:p,options:r}},9570:(t,e,n)=>{"use strict";n.d(e,{x:()=>g});var i=n(2784);function r(t,e,n,i,r,s,o){try{var a=t[s](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(i,r)}function s(){return(s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var o={exports:{}};!function(t){var e=function(t){var e,n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,i){var r=e&&e.prototype instanceof m?e:m,s=Object.create(r.prototype),o=new F(i||[]);return s._invoke=function(t,e,n){var i=h;return function(r,s){if(i===d)throw new Error("Generator is already running");if(i===p){if("throw"===r)throw s;return O()}for(n.method=r,n.arg=s;;){var o=n.delegate;if(o){var a=C(o,n);if(a){if(a===g)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=d;var u=c(t,e,n);if("normal"===u.type){if(i=n.done?p:f,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=p,n.method="throw",n.arg=u.arg)}}}(t,n,o),s}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var h="suspendedStart",f="suspendedYield",d="executing",p="completed",g={};function m(){}function y(){}function v(){}var b={};u(b,s,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(S([])));w&&w!==n&&i.call(w,s)&&(b=w);var A=v.prototype=m.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(r,s,o,a){var u=c(t[r],t,s);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==typeof h&&i.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(h).then((function(t){l.value=t,o(l)}),(function(t){return n("throw",t,o,a)}))}a(u.arg)}var r;this._invoke=function(t,i){function s(){return new e((function(e,r){n(t,i,e,r)}))}return r=r?r.then(s,s):s()}}function C(t,n){var i=t.iterator[n.method];if(i===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method))return g;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var r=c(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,g;var s=r.arg;return s?s.done?(n[t.resultName]=s.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function D(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function F(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:O}}function O(){return{value:e,done:!0}}return y.prototype=v,u(A,"constructor",v),u(v,"constructor",y),y.displayName=u(v,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,u(t,a,"GeneratorFunction")),t.prototype=Object.create(A),t},t.awrap=function(t){return{__await:t}},_(k.prototype),u(k.prototype,o,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,i,r,s){void 0===s&&(s=Promise);var o=new k(l(e,n,i,r),s);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},_(A),u(A,a,"Generator"),u(A,s,(function(){return this})),u(A,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=S,F.prototype={constructor:F,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(D),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return a.type="throw",a.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),D(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;D(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:S(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),g}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(o);var a=o.exports,u=function(t){var e=t.paths,n=t.id,r=t.strokeWidth,s=t.strokeColor,o=t.command,a=void 0===o?c:o;if(1===e.length){var u=e[0],l=u.x,h=u.y,f=r/2;return i.createElement("circle",{key:n,id:n,cx:l,cy:h,r:f,stroke:s,fill:s})}var d=e.reduce((function(t,e,n,i){return 0===n?"M "+e.x+","+e.y:t+" "+a(e,n,i)}),"");return i.createElement("path",{key:n,id:n,d,fill:"none",strokeLinecap:"round",stroke:s,strokeWidth:r})},l=function(t){var e,n,i,r,s=t.current,o=t.next,a=t.previous,u=t.reverse,l=(e=a||s,i=(n=o||s).x-e.x,r=n.y-e.y,{length:Math.sqrt(Math.pow(i,2)+Math.pow(r,2)),angle:Math.atan2(r,i)}),c=l.angle+(u?Math.PI:0),h=.2*l.length;return[s.x+Math.cos(c)*h,s.y+Math.sin(c)*h]},c=function(t,e,n){var i=null,r=null;switch(e){case 0:var s=l({current:t});i=s[0],r=s[1];break;case 1:var o=l({current:n[e-1],next:t});i=o[0],r=o[1];break;default:var a=l({current:n[e-1],previous:n[e-2],next:t});i=a[0],r=a[1]}var u=l({current:t,previous:n[e-1],next:n[e+1],reverse:!0});return"C "+i+","+r+" "+u[0]+","+u[1]+" "+t.x+", "+t.y},h=function(t){var e=t.id,n=t.paths;return i.createElement(i.Fragment,null,n.map((function(t,n){return i.createElement(u,{key:e+"__"+n,paths:t.paths,id:e+"__"+n,strokeWidth:t.strokeWidth,strokeColor:t.strokeColor,command:c})})))},f=function(t){return new Promise((function(e,n){var i=new Image;i.addEventListener("load",(function(){i.width>0&&e(i),n("Image not found")})),i.addEventListener("error",(function(t){return n(t)})),i.src=t,i.setAttribute("crossorigin","anonymous")}))};function d(t){var e,n=null==(e=t.firstChild)?void 0:e.cloneNode(!0),i=t.offsetWidth,r=t.offsetHeight;return n.setAttribute("viewBox","0 0 "+i+" "+r),n.setAttribute("width",i.toString()),n.setAttribute("height",r.toString()),{svgCanvas:n,width:i,height:r}}var p=i.forwardRef((function(t,e){var n=t.paths,o=t.isDrawing,l=t.onPointerDown,c=t.onPointerMove,p=t.onPointerUp,g=t.id,m=void 0===g?"react-sketch-canvas":g,y=t.width,v=void 0===y?"100%":y,b=t.height,x=void 0===b?"100%":b,w=t.className,A=void 0===w?"react-sketch-canvas":w,_=t.canvasColor,k=void 0===_?"red":_,C=t.backgroundImage,E=void 0===C?"":C,D=t.exportWithBackgroundImage,F=void 0!==D&&D,S=t.preserveBackgroundImageAspectRatio,O=void 0===S?"none":S,N=t.allowOnlyPointerType,M=void 0===N?"all":N,z=t.style,$=void 0===z?{border:"0.0625rem solid #9c9c9c",borderRadius:"0.25rem"}:z,T=t.svgStyle,B=void 0===T?{}:T,j=i.useRef(null),I=function(t){var e,n,i,r=null==(e=j.current)?void 0:e.getBoundingClientRect(),s=null!=(n=window.scrollX)?n:0,o=null!=(i=window.scrollY)?i:0;return r?{x:t.pageX-r.left-s,y:t.pageY-r.top-o}:{x:0,y:0}},R=function(t){"mouse"===t.pointerType&&0!==t.button||"all"!==M&&t.pointerType!==M||p()};i.useImperativeHandle(e,(function(){return{exportImage:function(t){return new Promise(function(){var e,n=(e=a.mark((function e(n,i){var r,s,o,u,l,c,h,p;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=j.current){e.next=4;break}throw Error("Canvas not rendered yet");case 4:return s=d(r),o=s.svgCanvas,u=s.width,l=s.height,c="data:image/svg+xml;base64,"+btoa(o.outerHTML),e.next=8,f(c);case 8:if(e.t0=e.sent,h=[e.t0],!F){e.next=21;break}return e.prev=11,e.next=14,f(E);case 14:p=e.sent,h.push(p),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(11),console.warn("exportWithBackgroundImage props is set without a valid background image URL. This option is ignored");case 21:Promise.all(h).then((function(e){var i=document.createElement("canvas");i.setAttribute("width",u.toString()),i.setAttribute("height",l.toString());var r=i.getContext("2d");if(!r)throw Error("Canvas not rendered yet");e.reverse().forEach((function(t){r.drawImage(t,0,0)})),n(i.toDataURL("image/"+t))})).catch((function(t){throw t})),e.next=27;break;case 24:e.prev=24,e.t2=e.catch(0),i(e.t2);case 27:case"end":return e.stop()}}),e,null,[[0,24],[11,18]])})),function(){var t=this,n=arguments;return new Promise((function(i,s){var o=e.apply(t,n);function a(t){r(o,i,s,a,u,"next",t)}function u(t){r(o,i,s,a,u,"throw",t)}a(void 0)}))});return function(t,e){return n.apply(this,arguments)}}())},exportSvg:function(){return new Promise((function(t,e){try{var n,i=null!=(n=j.current)?n:null;if(null!==i){var r,s,o=d(i).svgCanvas;if(F)return void t(o.outerHTML);null==(r=o.querySelector("#"+m+"__background"))||r.remove(),null==(s=o.querySelector("#"+m+"__canvas-background"))||s.setAttribute("fill",k),t(o.outerHTML)}e(new Error("Canvas not loaded"))}catch(t){e(t)}}))}}})),i.useEffect((function(){return document.addEventListener("pointerup",R),function(){document.removeEventListener("pointerup",R)}}),[R]);var L=n.filter((function(t){return!t.drawMode})),P=0,U=n.reduce((function(t,e){return e.drawMode?(void 0===t[P]&&(t[P]=[]),t[P].push(e),t):(P+=1,t)}),[[]]);return i.createElement("div",{role:"presentation",ref:j,className:A,style:s({touchAction:"none",width:v,height:x},$),"touch-action":"none",onPointerDown:function(t){if(!("all"!==M&&t.pointerType!==M||"mouse"===t.pointerType&&0!==t.button)){var e=I(t);l(e)}},onPointerMove:function(t){if(o&&("all"===M||t.pointerType===M)){var e=I(t);c(e)}},onPointerUp:R},i.createElement("svg",{version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",style:s({width:"100%",height:"100%"},B),id:m},i.createElement("g",{id:m+"__eraser-stroke-group",display:"none"},i.createElement("rect",{id:m+"__mask-background",x:"0",y:"0",width:"100%",height:"100%",fill:"white"}),L.map((function(t,e){return i.createElement(u,{key:m+"__eraser-"+e,id:m+"__eraser-"+e,paths:t.paths,strokeColor:"#000000",strokeWidth:t.strokeWidth})}))),i.createElement("defs",null,E&&i.createElement("pattern",{id:m+"__background",x:"0",y:"0",width:"100%",height:"100%",patternUnits:"userSpaceOnUse"},i.createElement("image",{x:"0",y:"0",width:"100%",height:"100%",xlinkHref:E,preserveAspectRatio:O})),L.map((function(t,e){return i.createElement("mask",{id:m+"__eraser-mask-"+e,key:m+"__eraser-mask-"+e,maskUnits:"userSpaceOnUse"},i.createElement("use",{href:"#"+m+"__mask-background"}),Array.from({length:L.length-e},(function(t,n){return n+e})).map((function(t){return i.createElement("use",{key:t.toString(),href:"#"+m+"__eraser-"+t.toString()})})))}))),i.createElement("g",{id:m+"__canvas-background-group"},i.createElement("rect",{id:m+"__canvas-background",x:"0",y:"0",width:"100%",height:"100%",fill:E?"url(#"+m+"__background)":k})),U.map((function(t,e){return i.createElement("g",{id:m+"__stroke-group-"+e,key:m+"__stroke-group-"+e,mask:"url(#"+m+"__eraser-mask-"+e+")"},i.createElement(h,{id:m,paths:t}))}))))})),g=i.forwardRef((function(t,e){var n=t.id,r=void 0===n?"react-sketch-canvas":n,o=t.width,a=void 0===o?"100%":o,u=t.height,l=void 0===u?"100%":u,c=t.className,h=void 0===c?"":c,f=t.canvasColor,d=void 0===f?"white":f,g=t.strokeColor,m=void 0===g?"red":g,y=t.backgroundImage,v=void 0===y?"":y,b=t.exportWithBackgroundImage,x=void 0!==b&&b,w=t.preserveBackgroundImageAspectRatio,A=void 0===w?"none":w,_=t.strokeWidth,k=void 0===_?4:_,C=t.eraserWidth,E=void 0===C?8:C,D=t.allowOnlyPointerType,F=void 0===D?"all":D,S=t.style,O=void 0===S?{border:"0.0625rem solid #9c9c9c",borderRadius:"0.25rem"}:S,N=t.svgStyle,M=void 0===N?{}:N,z=t.onChange,$=void 0===z?function(t){}:z,T=t.onStroke,B=void 0===T?function(t,e){}:T,j=t.withTimestamp,I=void 0!==j&&j,R=i.createRef(),L=i.useState(!0),P=L[0],U=L[1],q=i.useState(!1),W=q[0],H=q[1],V=i.useState([]),G=V[0],X=V[1],Y=i.useState([]),J=Y[0],Z=Y[1],K=i.useState([]),Q=K[0],tt=K[1],et=i.useCallback((function(){var t,e,n=null!=(t=null==(e=Q.slice(-1))?void 0:e[0])?t:null;null!==n?B(n,!n.drawMode):console.warn("No stroke found!")}),[W]);return i.useEffect((function(){et()}),[W]),i.useEffect((function(){$(Q)}),[Q]),i.useImperativeHandle(e,(function(){return{eraseMode:function(t){U(!t)},clearCanvas:function(){X([].concat(Q)),tt([])},undo:function(){if(0!==G.length)return tt([].concat(G)),void X([]);Z((function(t){return[].concat(t,Q.slice(-1))})),tt((function(t){return t.slice(0,-1)}))},redo:function(){0!==J.length&&(tt((function(t){return[].concat(t,J.slice(-1))})),Z((function(t){return t.slice(0,-1)})))},exportImage:function(t){var e,n=null==(e=R.current)?void 0:e.exportImage;if(n)return n(t);throw Error("Export function called before canvas loaded")},exportSvg:function(){return new Promise((function(t,e){var n,i=null==(n=R.current)?void 0:n.exportSvg;i?i().then((function(e){t(e)})).catch((function(t){e(t)})):e(Error("Export function called before canvas loaded"))}))},exportPaths:function(){return new Promise((function(t,e){try{t(Q)}catch(t){e(t)}}))},loadPaths:function(t){tt((function(e){return[].concat(e,t)}))},getSketchingTime:function(){return new Promise((function(t,e){I||e(new Error("Set 'withTimestamp' prop to get sketching time"));try{t(Q.reduce((function(t,e){var n,i,r=null!=(n=e.startTimestamp)?n:0;return t+((null!=(i=e.endTimestamp)?i:0)-r)}),0))}catch(t){e(t)}}))},resetCanvas:function(){X([]),Z([]),tt([])}}})),i.createElement(p,{ref:R,id:r,width:a,height:l,className:h,canvasColor:d,backgroundImage:v,exportWithBackgroundImage:x,preserveBackgroundImageAspectRatio:A,allowOnlyPointerType:F,style:O,svgStyle:M,paths:Q,isDrawing:W,onPointerDown:function(t){H(!0),Z([]);var e={drawMode:P,strokeColor:P?m:"#000000",strokeWidth:P?k:E,paths:[t]};I&&(e=s({},e,{startTimestamp:Date.now(),endTimestamp:0})),tt((function(t){return[].concat(t,[e])}))},onPointerMove:function(t){if(W){var e=Q.slice(-1)[0],n=s({},e,{paths:[].concat(e.paths,[t])});tt((function(t){return[].concat(t.slice(0,-1),[n])}))}},onPointerUp:function(){var t,e;if(W&&(H(!1),I)){var n=null!=(t=null==(e=Q.slice(-1))?void 0:e[0])?t:null;if(null!==n){var i=s({},n,{endTimestamp:Date.now()});tt((function(t){return[].concat(t.slice(0,-1),[i])}))}}}})}))},3851:(t,e,n)=>{"use strict";n.d(e,{x:()=>m});var i=n(5163),r=n(7551),s=n(124),o="function"==typeof Symbol&&Symbol.observable||"@@observable";function a(t){return t}function u(t){return 0===t.length?a:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var l=n(4020),c=n(9126),h=n(4831),f=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var i,o=this,a=(i=t)&&i instanceof r.Lv||function(t){return t&&(0,c.m)(t.next)&&(0,c.m)(t.error)&&(0,c.m)(t.complete)}(i)&&(0,s.Nn)(i)?t:new r.Hp(t,e,n);return(0,h.x)((function(){var t=o,e=t.operator,n=t.source;a.add(e?e.call(a,n):n?o._subscribe(a):o._trySubscribe(a))})),a},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=d(e))((function(e,i){var s=new r.Hp({next:function(e){try{t(e)}catch(t){i(t),s.unsubscribe()}},error:i,complete:e});n.subscribe(s)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[o]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return u(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=d(t))((function(t,n){var i;e.subscribe((function(t){return i=t}),(function(t){return n(t)}),(function(){return t(i)}))}))},t.create=function(e){return new t(e)},t}();function d(t){var e;return null!==(e=null!=t?t:l.v.Promise)&&void 0!==e?e:Promise}var p=(0,n(5589).d)((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),g=n(7990),m=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return(0,i.ZT)(e,t),e.prototype.lift=function(t){var e=new y(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new p},e.prototype.next=function(t){var e=this;(0,h.x)((function(){var n,r;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var s=(0,i.XA)(e.currentObservers),o=s.next();!o.done;o=s.next())o.value.next(t)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}))},e.prototype.error=function(t){var e=this;(0,h.x)((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}}))},e.prototype.complete=function(){var t=this;(0,h.x)((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,n=this,i=n.hasError,r=n.isStopped,o=n.observers;return i||r?s.Lc:(this.currentObservers=null,o.push(t),new s.w0((function(){e.currentObservers=null,(0,g.P)(o,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,i=e.thrownError,r=e.isStopped;n?t.error(i):r&&t.complete()},e.prototype.asObservable=function(){var t=new f;return t.source=this,t},e.create=function(t,e){return new y(t,e)},e}(f),y=function(t){function e(e,n){var i=t.call(this)||this;return i.destination=e,i.source=n,i}return(0,i.ZT)(e,t),e.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},e.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:s.Lc},e}(m)},7551:(t,e,n)=>{"use strict";n.d(e,{Hp:()=>m,Lv:()=>f});var i=n(5163),r=n(9126),s=n(124),o=n(4020),a={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var s=a.delegate;return(null==s?void 0:s.setTimeout)?s.setTimeout.apply(s,(0,i.ev)([t,e],(0,i.CR)(n))):setTimeout.apply(void 0,(0,i.ev)([t,e],(0,i.CR)(n)))},clearTimeout:function(t){var e=a.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function u(){}var l=c("C",void 0,void 0);function c(t,e,n){return{kind:t,value:e,error:n}}var h=n(4831),f=function(t){function e(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,(0,s.Nn)(e)&&e.add(n)):n.destination=b,n}return(0,i.ZT)(e,t),e.create=function(t,e,n){return new m(t,e,n)},e.prototype.next=function(t){this.isStopped?v(function(t){return c("N",t,void 0)}(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?v(c("E",void 0,t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?v(l,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(s.w0),d=Function.prototype.bind;function p(t,e){return d.call(t,e)}var g=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){y(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){y(t)}else y(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){y(t)}},t}(),m=function(t){function e(e,n,i){var s,a,u=t.call(this)||this;return(0,r.m)(e)||!e?s={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=i?i:void 0}:u&&o.v.useDeprecatedNextContext?((a=Object.create(e)).unsubscribe=function(){return u.unsubscribe()},s={next:e.next&&p(e.next,a),error:e.error&&p(e.error,a),complete:e.complete&&p(e.complete,a)}):s=e,u.destination=new g(s),u}return(0,i.ZT)(e,t),e}(f);function y(t){var e;o.v.useDeprecatedSynchronousErrorHandling?(0,h.O)(t):(e=t,a.setTimeout((function(){var t=o.v.onUnhandledError;if(!t)throw e;t(e)})))}function v(t,e){var n=o.v.onStoppedNotification;n&&a.setTimeout((function(){return n(t,e)}))}var b={closed:!0,next:u,error:function(t){throw t},complete:u}},124:(t,e,n)=>{"use strict";n.d(e,{Lc:()=>u,w0:()=>a,Nn:()=>l});var i=n(5163),r=n(9126),s=(0,n(5589).d)((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}})),o=n(7990),a=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}var e;return t.prototype.unsubscribe=function(){var t,e,n,o,a;if(!this.closed){this.closed=!0;var u=this._parentage;if(u)if(this._parentage=null,Array.isArray(u))try{for(var l=(0,i.XA)(u),h=l.next();!h.done;h=l.next())h.value.remove(this)}catch(e){t={error:e}}finally{try{h&&!h.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}else u.remove(this);var f=this.initialTeardown;if((0,r.m)(f))try{f()}catch(t){a=t instanceof s?t.errors:[t]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var p=(0,i.XA)(d),g=p.next();!g.done;g=p.next()){var m=g.value;try{c(m)}catch(t){a=null!=a?a:[],t instanceof s?a=(0,i.ev)((0,i.ev)([],(0,i.CR)(a)),(0,i.CR)(t.errors)):a.push(t)}}}catch(t){n={error:t}}finally{try{g&&!g.done&&(o=p.return)&&o.call(p)}finally{if(n)throw n.error}}}if(a)throw new s(a)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)c(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&(0,o.P)(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&(0,o.P)(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}(),u=a.EMPTY;function l(t){return t instanceof a||t&&"closed"in t&&(0,r.m)(t.remove)&&(0,r.m)(t.add)&&(0,r.m)(t.unsubscribe)}function c(t){(0,r.m)(t)?t():t.unsubscribe()}},4020:(t,e,n)=>{"use strict";n.d(e,{v:()=>i});var i={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},3833:(t,e,n)=>{"use strict";n.d(e,{b:()=>d});var i=n(5163),r=function(t){function e(e,n){return t.call(this)||this}return(0,i.ZT)(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(n(124).w0),s={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=s.delegate;return(null==o?void 0:o.setInterval)?o.setInterval.apply(o,(0,i.ev)([t,e],(0,i.CR)(n))):setInterval.apply(void 0,(0,i.ev)([t,e],(0,i.CR)(n)))},clearInterval:function(t){var e=s.delegate;return((null==e?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},o=n(7990),a=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.pending=!1,i}return(0,i.ZT)(e,t),e.prototype.schedule=function(t,e){var n;if(void 0===e&&(e=0),this.closed)return this;this.state=t;var i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,e)),this.pending=!0,this.delay=e,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),s.setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return e;null!=e&&s.clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n,i=!1;try{this.work(t)}catch(t){i=!0,n=t||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),n},e.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,n=this.scheduler,i=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,(0,o.P)(i,this),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(r),u={now:function(){return(u.delegate||Date).now()},delegate:void 0},l=function(){function t(e,n){void 0===n&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(n,e)},t.now=u.now,t}(),c=new(function(t){function e(e,n){void 0===n&&(n=l.now);var i=t.call(this,e,n)||this;return i.actions=[],i._active=!1,i}return(0,i.ZT)(e,t),e.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(l))(a),h=n(9126);var f=function(t){function e(e,n,i,r,s,o){var a=t.call(this,e)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=n?function(t){try{n(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=r?function(t){try{r(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=i?function(){try{i()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return(0,i.ZT)(e,t),e.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},e}(n(7551).Lv);function d(t,e){return void 0===e&&(e=c),n=function(n,i){var r=null,s=null,o=null,a=function(){if(r){r.unsubscribe(),r=null;var t=s;s=null,i.next(t)}};function u(){var n=o+t,s=e.now();if(s<n)return r=this.schedule(void 0,n-s),void i.add(r);a()}n.subscribe(new f(i,(function(n){s=n,o=e.now(),r||(r=e.schedule(u,t),i.add(r))}),(function(){a(),i.complete()}),void 0,(function(){s=r=null})))},function(t){if(function(t){return(0,h.m)(null==t?void 0:t.lift)}(t))return t.lift((function(t){try{return n(t,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")};var n}},7990:(t,e,n)=>{"use strict";function i(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}n.d(e,{P:()=>i})},5589:(t,e,n)=>{"use strict";function i(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}n.d(e,{d:()=>i})},4831:(t,e,n)=>{"use strict";n.d(e,{O:()=>o,x:()=>s});var i=n(4020),r=null;function s(t){if(i.v.useDeprecatedSynchronousErrorHandling){var e=!r;if(e&&(r={errorThrown:!1,error:null}),t(),e){var n=r,s=n.errorThrown,o=n.error;if(r=null,s)throw o}}else t()}function o(t){i.v.useDeprecatedSynchronousErrorHandling&&r&&(r.errorThrown=!0,r.error=t)}},9126:(t,e,n)=>{"use strict";function i(t){return"function"==typeof t}n.d(e,{m:()=>i})},7847:(t,e,n)=>{const i=Symbol("SemVer ANY");class r{static get ANY(){return i}constructor(t,e){if(e=s(e),t instanceof r){if(t.loose===!!e.loose)return t;t=t.value}l("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===i?this.value="":this.value=this.operator+this.semver.version,l("comp",this)}parse(t){const e=this.options.loose?o[a.COMPARATORLOOSE]:o[a.COMPARATOR],n=t.match(e);if(!n)throw new TypeError(`Invalid comparator: ${t}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new c(n[2],this.options.loose):this.semver=i}toString(){return this.value}test(t){if(l("Comparator.test",t,this.options.loose),this.semver===i||t===i)return!0;if("string"==typeof t)try{t=new c(t,this.options)}catch(t){return!1}return u(t,this.operator,this.semver,this.options)}intersects(t,e){if(!(t instanceof r))throw new TypeError("a Comparator is required");if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),""===this.operator)return""===this.value||new h(t.value,e).test(this.value);if(""===t.operator)return""===t.value||new h(this.value,e).test(t.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==t.operator&&">"!==t.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==t.operator&&"<"!==t.operator),s=this.semver.version===t.semver.version,o=!(">="!==this.operator&&"<="!==this.operator||">="!==t.operator&&"<="!==t.operator),a=u(this.semver,"<",t.semver,e)&&(">="===this.operator||">"===this.operator)&&("<="===t.operator||"<"===t.operator),l=u(this.semver,">",t.semver,e)&&("<="===this.operator||"<"===this.operator)&&(">="===t.operator||">"===t.operator);return n||i||s&&o||a||l}}t.exports=r;const s=n(1388),{re:o,t:a}=n(4808),u=n(3125),l=n(952),c=n(2435),h=n(2013)},2013:(t,e,n)=>{class i{constructor(t,e){if(e=s(e),t instanceof i)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new i(t.raw,e);if(t instanceof o)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t,this.set=t.split("||").map((t=>this.parseRange(t.trim()))).filter((t=>t.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${t}`);if(this.set.length>1){const t=this.set[0];if(this.set=this.set.filter((t=>!p(t[0]))),0===this.set.length)this.set=[t];else if(this.set.length>1)for(const t of this.set)if(1===t.length&&g(t[0])){this.set=[t];break}}this.format()}format(){return this.range=this.set.map((t=>t.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(t){t=t.trim();const e=`parseRange:${Object.keys(this.options).join(",")}:${t}`,n=r.get(e);if(n)return n;const i=this.options.loose,s=i?l[c.HYPHENRANGELOOSE]:l[c.HYPHENRANGE];t=t.replace(s,D(this.options.includePrerelease)),a("hyphen replace",t),t=t.replace(l[c.COMPARATORTRIM],h),a("comparator trim",t);let u=(t=(t=(t=t.replace(l[c.TILDETRIM],f)).replace(l[c.CARETTRIM],d)).split(/\s+/).join(" ")).split(" ").map((t=>y(t,this.options))).join(" ").split(/\s+/).map((t=>E(t,this.options)));i&&(u=u.filter((t=>(a("loose invalid filter",t,this.options),!!t.match(l[c.COMPARATORLOOSE]))))),a("range list",u);const g=new Map,m=u.map((t=>new o(t,this.options)));for(const t of m){if(p(t))return[t];g.set(t.value,t)}g.size>1&&g.has("")&&g.delete("");const v=[...g.values()];return r.set(e,v),v}intersects(t,e){if(!(t instanceof i))throw new TypeError("a Range is required");return this.set.some((n=>m(n,e)&&t.set.some((t=>m(t,e)&&n.every((n=>t.every((t=>n.intersects(t,e)))))))))}test(t){if(!t)return!1;if("string"==typeof t)try{t=new u(t,this.options)}catch(t){return!1}for(let e=0;e<this.set.length;e++)if(F(this.set[e],t,this.options))return!0;return!1}}t.exports=i;const r=new(n(7105))({max:1e3}),s=n(1388),o=n(7847),a=n(952),u=n(2435),{re:l,t:c,comparatorTrimReplace:h,tildeTrimReplace:f,caretTrimReplace:d}=n(4808),p=t=>"<0.0.0-0"===t.value,g=t=>""===t.value,m=(t,e)=>{let n=!0;const i=t.slice();let r=i.pop();for(;n&&i.length;)n=i.every((t=>r.intersects(t,e))),r=i.pop();return n},y=(t,e)=>(a("comp",t,e),t=w(t,e),a("caret",t),t=b(t,e),a("tildes",t),t=_(t,e),a("xrange",t),t=C(t,e),a("stars",t),t),v=t=>!t||"x"===t.toLowerCase()||"*"===t,b=(t,e)=>t.trim().split(/\s+/).map((t=>x(t,e))).join(" "),x=(t,e)=>{const n=e.loose?l[c.TILDELOOSE]:l[c.TILDE];return t.replace(n,((e,n,i,r,s)=>{let o;return a("tilde",t,e,n,i,r,s),v(n)?o="":v(i)?o=`>=${n}.0.0 <${+n+1}.0.0-0`:v(r)?o=`>=${n}.${i}.0 <${n}.${+i+1}.0-0`:s?(a("replaceTilde pr",s),o=`>=${n}.${i}.${r}-${s} <${n}.${+i+1}.0-0`):o=`>=${n}.${i}.${r} <${n}.${+i+1}.0-0`,a("tilde return",o),o}))},w=(t,e)=>t.trim().split(/\s+/).map((t=>A(t,e))).join(" "),A=(t,e)=>{a("caret",t,e);const n=e.loose?l[c.CARETLOOSE]:l[c.CARET],i=e.includePrerelease?"-0":"";return t.replace(n,((e,n,r,s,o)=>{let u;return a("caret",t,e,n,r,s,o),v(n)?u="":v(r)?u=`>=${n}.0.0${i} <${+n+1}.0.0-0`:v(s)?u="0"===n?`>=${n}.${r}.0${i} <${n}.${+r+1}.0-0`:`>=${n}.${r}.0${i} <${+n+1}.0.0-0`:o?(a("replaceCaret pr",o),u="0"===n?"0"===r?`>=${n}.${r}.${s}-${o} <${n}.${r}.${+s+1}-0`:`>=${n}.${r}.${s}-${o} <${n}.${+r+1}.0-0`:`>=${n}.${r}.${s}-${o} <${+n+1}.0.0-0`):(a("no pr"),u="0"===n?"0"===r?`>=${n}.${r}.${s}${i} <${n}.${r}.${+s+1}-0`:`>=${n}.${r}.${s}${i} <${n}.${+r+1}.0-0`:`>=${n}.${r}.${s} <${+n+1}.0.0-0`),a("caret return",u),u}))},_=(t,e)=>(a("replaceXRanges",t,e),t.split(/\s+/).map((t=>k(t,e))).join(" ")),k=(t,e)=>{t=t.trim();const n=e.loose?l[c.XRANGELOOSE]:l[c.XRANGE];return t.replace(n,((n,i,r,s,o,u)=>{a("xRange",t,n,i,r,s,o,u);const l=v(r),c=l||v(s),h=c||v(o),f=h;return"="===i&&f&&(i=""),u=e.includePrerelease?"-0":"",l?n=">"===i||"<"===i?"<0.0.0-0":"*":i&&f?(c&&(s=0),o=0,">"===i?(i=">=",c?(r=+r+1,s=0,o=0):(s=+s+1,o=0)):"<="===i&&(i="<",c?r=+r+1:s=+s+1),"<"===i&&(u="-0"),n=`${i+r}.${s}.${o}${u}`):c?n=`>=${r}.0.0${u} <${+r+1}.0.0-0`:h&&(n=`>=${r}.${s}.0${u} <${r}.${+s+1}.0-0`),a("xRange return",n),n}))},C=(t,e)=>(a("replaceStars",t,e),t.trim().replace(l[c.STAR],"")),E=(t,e)=>(a("replaceGTE0",t,e),t.trim().replace(l[e.includePrerelease?c.GTE0PRE:c.GTE0],"")),D=t=>(e,n,i,r,s,o,a,u,l,c,h,f,d)=>`${n=v(i)?"":v(r)?`>=${i}.0.0${t?"-0":""}`:v(s)?`>=${i}.${r}.0${t?"-0":""}`:o?`>=${n}`:`>=${n}${t?"-0":""}`} ${u=v(l)?"":v(c)?`<${+l+1}.0.0-0`:v(h)?`<${l}.${+c+1}.0-0`:f?`<=${l}.${c}.${h}-${f}`:t?`<${l}.${c}.${+h+1}-0`:`<=${u}`}`.trim(),F=(t,e,n)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!n.includePrerelease){for(let n=0;n<t.length;n++)if(a(t[n].semver),t[n].semver!==o.ANY&&t[n].semver.prerelease.length>0){const i=t[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}},2435:(t,e,n)=>{const i=n(952),{MAX_LENGTH:r,MAX_SAFE_INTEGER:s}=n(5558),{re:o,t:a}=n(4808),u=n(1388),{compareIdentifiers:l}=n(4935);class c{constructor(t,e){if(e=u(e),t instanceof c){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if("string"!=typeof t)throw new TypeError(`Invalid Version: ${t}`);if(t.length>r)throw new TypeError(`version is longer than ${r} characters`);i("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const n=t.trim().match(e.loose?o[a.LOOSE]:o[a.FULL]);if(!n)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((t=>{if(/^[0-9]+$/.test(t)){const e=+t;if(e>=0&&e<s)return e}return t})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(i("SemVer.compare",this.version,this.options,t),!(t instanceof c)){if("string"==typeof t&&t===this.version)return 0;t=new c(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof c||(t=new c(t,this.options)),l(this.major,t.major)||l(this.minor,t.minor)||l(this.patch,t.patch)}comparePre(t){if(t instanceof c||(t=new c(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{const n=this.prerelease[e],r=t.prerelease[e];if(i("prerelease compare",e,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return l(n,r)}while(++e)}compareBuild(t){t instanceof c||(t=new c(t,this.options));let e=0;do{const n=this.build[e],r=t.build[e];if(i("prerelease compare",e,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return l(n,r)}while(++e)}inc(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",e),this.inc("pre",e);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let t=this.prerelease.length;for(;--t>=0;)"number"==typeof this.prerelease[t]&&(this.prerelease[t]++,t=-2);-1===t&&this.prerelease.push(0)}e&&(0===l(this.prerelease[0],e)?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error(`invalid increment argument: ${t}`)}return this.format(),this.raw=this.version,this}}t.exports=c},6694:(t,e,n)=>{const i=n(9943);t.exports=(t,e)=>{const n=i(t.trim().replace(/^[=v]+/,""),e);return n?n.version:null}},3125:(t,e,n)=>{const i=n(3276),r=n(7893),s=n(6379),o=n(8463),a=n(1897),u=n(506);t.exports=(t,e,n,l)=>{switch(e){case"===":return"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),t===n;case"!==":return"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),t!==n;case"":case"=":case"==":return i(t,n,l);case"!=":return r(t,n,l);case">":return s(t,n,l);case">=":return o(t,n,l);case"<":return a(t,n,l);case"<=":return u(t,n,l);default:throw new TypeError(`Invalid operator: ${e}`)}}},8686:(t,e,n)=>{const i=n(2435),r=n(9943),{re:s,t:o}=n(4808);t.exports=(t,e)=>{if(t instanceof i)return t;if("number"==typeof t&&(t=String(t)),"string"!=typeof t)return null;let n=null;if((e=e||{}).rtl){let e;for(;(e=s[o.COERCERTL].exec(t))&&(!n||n.index+n[0].length!==t.length);)n&&e.index+e[0].length===n.index+n[0].length||(n=e),s[o.COERCERTL].lastIndex=e.index+e[1].length+e[2].length;s[o.COERCERTL].lastIndex=-1}else n=t.match(s[o.COERCE]);return null===n?null:r(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,e)}},5914:(t,e,n)=>{const i=n(2435);t.exports=(t,e,n)=>{const r=new i(t,n),s=new i(e,n);return r.compare(s)||r.compareBuild(s)}},5404:(t,e,n)=>{const i=n(2271);t.exports=(t,e)=>i(t,e,!0)},2271:(t,e,n)=>{const i=n(2435);t.exports=(t,e,n)=>new i(t,n).compare(new i(e,n))},6007:(t,e,n)=>{const i=n(9943),r=n(3276);t.exports=(t,e)=>{if(r(t,e))return null;{const n=i(t),r=i(e),s=n.prerelease.length||r.prerelease.length,o=s?"pre":"",a=s?"prerelease":"";for(const t in n)if(("major"===t||"minor"===t||"patch"===t)&&n[t]!==r[t])return o+t;return a}}},3276:(t,e,n)=>{const i=n(2271);t.exports=(t,e,n)=>0===i(t,e,n)},6379:(t,e,n)=>{const i=n(2271);t.exports=(t,e,n)=>i(t,e,n)>0},8463:(t,e,n)=>{const i=n(2271);t.exports=(t,e,n)=>i(t,e,n)>=0},6360:(t,e,n)=>{const i=n(2435);t.exports=(t,e,n,r)=>{"string"==typeof n&&(r=n,n=void 0);try{return new i(t instanceof i?t.version:t,n).inc(e,r).version}catch(t){return null}}},1897:(t,e,n)=>{const i=n(2271);t.exports=(t,e,n)=>i(t,e,n)<0},506:(t,e,n)=>{const i=n(2271);t.exports=(t,e,n)=>i(t,e,n)<=0},4551:(t,e,n)=>{const i=n(2435);t.exports=(t,e)=>new i(t,e).major},469:(t,e,n)=>{const i=n(2435);t.exports=(t,e)=>new i(t,e).minor},7893:(t,e,n)=>{const i=n(2271);t.exports=(t,e,n)=>0!==i(t,e,n)},9943:(t,e,n)=>{const{MAX_LENGTH:i}=n(5558),{re:r,t:s}=n(4808),o=n(2435),a=n(1388);t.exports=(t,e)=>{if(e=a(e),t instanceof o)return t;if("string"!=typeof t)return null;if(t.length>i)return null;if(!(e.loose?r[s.LOOSE]:r[s.FULL]).test(t))return null;try{return new o(t,e)}catch(t){return null}}},4250:(t,e,n)=>{const i=n(2435);t.exports=(t,e)=>new i(t,e).patch},8204:(t,e,n)=>{const i=n(9943);t.exports=(t,e)=>{const n=i(t,e);return n&&n.prerelease.length?n.prerelease:null}},733:(t,e,n)=>{const i=n(2271);t.exports=(t,e,n)=>i(e,t,n)},2961:(t,e,n)=>{const i=n(5914);t.exports=(t,e)=>t.sort(((t,n)=>i(n,t,e)))},9844:(t,e,n)=>{const i=n(2013);t.exports=(t,e,n)=>{try{e=new i(e,n)}catch(t){return!1}return e.test(t)}},1116:(t,e,n)=>{const i=n(5914);t.exports=(t,e)=>t.sort(((t,n)=>i(t,n,e)))},7230:(t,e,n)=>{const i=n(9943);t.exports=(t,e)=>{const n=i(t,e);return n?n.version:null}},7699:(t,e,n)=>{const i=n(4808),r=n(5558),s=n(2435),o=n(4935),a=n(9943),u=n(7230),l=n(6694),c=n(6360),h=n(6007),f=n(4551),d=n(469),p=n(4250),g=n(8204),m=n(2271),y=n(733),v=n(5404),b=n(5914),x=n(1116),w=n(2961),A=n(6379),_=n(1897),k=n(3276),C=n(7893),E=n(8463),D=n(506),F=n(3125),S=n(8686),O=n(7847),N=n(2013),M=n(9844),z=n(8865),$=n(3727),T=n(4338),B=n(1542),j=n(576),I=n(9106),R=n(995),L=n(7805),P=n(3214),U=n(1338),q=n(3122);t.exports={parse:a,valid:u,clean:l,inc:c,diff:h,major:f,minor:d,patch:p,prerelease:g,compare:m,rcompare:y,compareLoose:v,compareBuild:b,sort:x,rsort:w,gt:A,lt:_,eq:k,neq:C,gte:E,lte:D,cmp:F,coerce:S,Comparator:O,Range:N,satisfies:M,toComparators:z,maxSatisfying:$,minSatisfying:T,minVersion:B,validRange:j,outside:I,gtr:R,ltr:L,intersects:P,simplifyRange:U,subset:q,SemVer:s,re:i.re,src:i.src,tokens:i.t,SEMVER_SPEC_VERSION:r.SEMVER_SPEC_VERSION,compareIdentifiers:o.compareIdentifiers,rcompareIdentifiers:o.rcompareIdentifiers}},5558:t=>{const e=Number.MAX_SAFE_INTEGER||9007199254740991;t.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:e,MAX_SAFE_COMPONENT_LENGTH:16}},952:t=>{const e="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};t.exports=e},4935:t=>{const e=/^[0-9]+$/,n=(t,n)=>{const i=e.test(t),r=e.test(n);return i&&r&&(t=+t,n=+n),t===n?0:i&&!r?-1:r&&!i?1:t<n?-1:1};t.exports={compareIdentifiers:n,rcompareIdentifiers:(t,e)=>n(e,t)}},1388:t=>{const e=["includePrerelease","loose","rtl"];t.exports=t=>t?"object"!=typeof t?{loose:!0}:e.filter((e=>t[e])).reduce(((t,e)=>(t[e]=!0,t)),{}):{}},4808:(t,e,n)=>{const{MAX_SAFE_COMPONENT_LENGTH:i}=n(5558),r=n(952),s=(e=t.exports={}).re=[],o=e.src=[],a=e.t={};let u=0;const l=(t,e,n)=>{const i=u++;r(t,i,e),a[t]=i,o[i]=e,s[i]=new RegExp(e,n?"g":void 0)};l("NUMERICIDENTIFIER","0|[1-9]\\d*"),l("NUMERICIDENTIFIERLOOSE","[0-9]+"),l("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),l("MAINVERSION",`(${o[a.NUMERICIDENTIFIER]})\\.(${o[a.NUMERICIDENTIFIER]})\\.(${o[a.NUMERICIDENTIFIER]})`),l("MAINVERSIONLOOSE",`(${o[a.NUMERICIDENTIFIERLOOSE]})\\.(${o[a.NUMERICIDENTIFIERLOOSE]})\\.(${o[a.NUMERICIDENTIFIERLOOSE]})`),l("PRERELEASEIDENTIFIER",`(?:${o[a.NUMERICIDENTIFIER]}|${o[a.NONNUMERICIDENTIFIER]})`),l("PRERELEASEIDENTIFIERLOOSE",`(?:${o[a.NUMERICIDENTIFIERLOOSE]}|${o[a.NONNUMERICIDENTIFIER]})`),l("PRERELEASE",`(?:-(${o[a.PRERELEASEIDENTIFIER]}(?:\\.${o[a.PRERELEASEIDENTIFIER]})*))`),l("PRERELEASELOOSE",`(?:-?(${o[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[a.PRERELEASEIDENTIFIERLOOSE]})*))`),l("BUILDIDENTIFIER","[0-9A-Za-z-]+"),l("BUILD",`(?:\\+(${o[a.BUILDIDENTIFIER]}(?:\\.${o[a.BUILDIDENTIFIER]})*))`),l("FULLPLAIN",`v?${o[a.MAINVERSION]}${o[a.PRERELEASE]}?${o[a.BUILD]}?`),l("FULL",`^${o[a.FULLPLAIN]}$`),l("LOOSEPLAIN",`[v=\\s]*${o[a.MAINVERSIONLOOSE]}${o[a.PRERELEASELOOSE]}?${o[a.BUILD]}?`),l("LOOSE",`^${o[a.LOOSEPLAIN]}$`),l("GTLT","((?:<|>)?=?)"),l("XRANGEIDENTIFIERLOOSE",`${o[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),l("XRANGEIDENTIFIER",`${o[a.NUMERICIDENTIFIER]}|x|X|\\*`),l("XRANGEPLAIN",`[v=\\s]*(${o[a.XRANGEIDENTIFIER]})(?:\\.(${o[a.XRANGEIDENTIFIER]})(?:\\.(${o[a.XRANGEIDENTIFIER]})(?:${o[a.PRERELEASE]})?${o[a.BUILD]}?)?)?`),l("XRANGEPLAINLOOSE",`[v=\\s]*(${o[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[a.XRANGEIDENTIFIERLOOSE]})(?:${o[a.PRERELEASELOOSE]})?${o[a.BUILD]}?)?)?`),l("XRANGE",`^${o[a.GTLT]}\\s*${o[a.XRANGEPLAIN]}$`),l("XRANGELOOSE",`^${o[a.GTLT]}\\s*${o[a.XRANGEPLAINLOOSE]}$`),l("COERCE",`(^|[^\\d])(\\d{1,${i}})(?:\\.(\\d{1,${i}}))?(?:\\.(\\d{1,${i}}))?(?:$|[^\\d])`),l("COERCERTL",o[a.COERCE],!0),l("LONETILDE","(?:~>?)"),l("TILDETRIM",`(\\s*)${o[a.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",l("TILDE",`^${o[a.LONETILDE]}${o[a.XRANGEPLAIN]}$`),l("TILDELOOSE",`^${o[a.LONETILDE]}${o[a.XRANGEPLAINLOOSE]}$`),l("LONECARET","(?:\\^)"),l("CARETTRIM",`(\\s*)${o[a.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",l("CARET",`^${o[a.LONECARET]}${o[a.XRANGEPLAIN]}$`),l("CARETLOOSE",`^${o[a.LONECARET]}${o[a.XRANGEPLAINLOOSE]}$`),l("COMPARATORLOOSE",`^${o[a.GTLT]}\\s*(${o[a.LOOSEPLAIN]})$|^$`),l("COMPARATOR",`^${o[a.GTLT]}\\s*(${o[a.FULLPLAIN]})$|^$`),l("COMPARATORTRIM",`(\\s*)${o[a.GTLT]}\\s*(${o[a.LOOSEPLAIN]}|${o[a.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",l("HYPHENRANGE",`^\\s*(${o[a.XRANGEPLAIN]})\\s+-\\s+(${o[a.XRANGEPLAIN]})\\s*$`),l("HYPHENRANGELOOSE",`^\\s*(${o[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[a.XRANGEPLAINLOOSE]})\\s*$`),l("STAR","(<|>)?=?\\s*\\*"),l("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),l("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},995:(t,e,n)=>{const i=n(9106);t.exports=(t,e,n)=>i(t,e,">",n)},3214:(t,e,n)=>{const i=n(2013);t.exports=(t,e,n)=>(t=new i(t,n),e=new i(e,n),t.intersects(e))},7805:(t,e,n)=>{const i=n(9106);t.exports=(t,e,n)=>i(t,e,"<",n)},3727:(t,e,n)=>{const i=n(2435),r=n(2013);t.exports=(t,e,n)=>{let s=null,o=null,a=null;try{a=new r(e,n)}catch(t){return null}return t.forEach((t=>{a.test(t)&&(s&&-1!==o.compare(t)||(s=t,o=new i(s,n)))})),s}},4338:(t,e,n)=>{const i=n(2435),r=n(2013);t.exports=(t,e,n)=>{let s=null,o=null,a=null;try{a=new r(e,n)}catch(t){return null}return t.forEach((t=>{a.test(t)&&(s&&1!==o.compare(t)||(s=t,o=new i(s,n)))})),s}},1542:(t,e,n)=>{const i=n(2435),r=n(2013),s=n(6379);t.exports=(t,e)=>{t=new r(t,e);let n=new i("0.0.0");if(t.test(n))return n;if(n=new i("0.0.0-0"),t.test(n))return n;n=null;for(let e=0;e<t.set.length;++e){const r=t.set[e];let o=null;r.forEach((t=>{const e=new i(t.semver.version);switch(t.operator){case">":0===e.prerelease.length?e.patch++:e.prerelease.push(0),e.raw=e.format();case"":case">=":o&&!s(e,o)||(o=e);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${t.operator}`)}})),!o||n&&!s(n,o)||(n=o)}return n&&t.test(n)?n:null}},9106:(t,e,n)=>{const i=n(2435),r=n(7847),{ANY:s}=r,o=n(2013),a=n(9844),u=n(6379),l=n(1897),c=n(506),h=n(8463);t.exports=(t,e,n,f)=>{let d,p,g,m,y;switch(t=new i(t,f),e=new o(e,f),n){case">":d=u,p=c,g=l,m=">",y=">=";break;case"<":d=l,p=h,g=u,m="<",y="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(t,e,f))return!1;for(let n=0;n<e.set.length;++n){const i=e.set[n];let o=null,a=null;if(i.forEach((t=>{t.semver===s&&(t=new r(">=0.0.0")),o=o||t,a=a||t,d(t.semver,o.semver,f)?o=t:g(t.semver,a.semver,f)&&(a=t)})),o.operator===m||o.operator===y)return!1;if((!a.operator||a.operator===m)&&p(t,a.semver))return!1;if(a.operator===y&&g(t,a.semver))return!1}return!0}},1338:(t,e,n)=>{const i=n(9844),r=n(2271);t.exports=(t,e,n)=>{const s=[];let o=null,a=null;const u=t.sort(((t,e)=>r(t,e,n)));for(const t of u)i(t,e,n)?(a=t,o||(o=t)):(a&&s.push([o,a]),a=null,o=null);o&&s.push([o,null]);const l=[];for(const[t,e]of s)t===e?l.push(t):e||t!==u[0]?e?t===u[0]?l.push(`<=${e}`):l.push(`${t} - ${e}`):l.push(`>=${t}`):l.push("*");const c=l.join(" || "),h="string"==typeof e.raw?e.raw:String(e);return c.length<h.length?c:e}},3122:(t,e,n)=>{const i=n(2013),r=n(7847),{ANY:s}=r,o=n(9844),a=n(2271),u=(t,e,n)=>{if(t===e)return!0;if(1===t.length&&t[0].semver===s){if(1===e.length&&e[0].semver===s)return!0;t=n.includePrerelease?[new r(">=0.0.0-0")]:[new r(">=0.0.0")]}if(1===e.length&&e[0].semver===s){if(n.includePrerelease)return!0;e=[new r(">=0.0.0")]}const i=new Set;let u,h,f,d,p,g,m;for(const e of t)">"===e.operator||">="===e.operator?u=l(u,e,n):"<"===e.operator||"<="===e.operator?h=c(h,e,n):i.add(e.semver);if(i.size>1)return null;if(u&&h){if(f=a(u.semver,h.semver,n),f>0)return null;if(0===f&&(">="!==u.operator||"<="!==h.operator))return null}for(const t of i){if(u&&!o(t,String(u),n))return null;if(h&&!o(t,String(h),n))return null;for(const i of e)if(!o(t,String(i),n))return!1;return!0}let y=!(!h||n.includePrerelease||!h.semver.prerelease.length)&&h.semver,v=!(!u||n.includePrerelease||!u.semver.prerelease.length)&&u.semver;y&&1===y.prerelease.length&&"<"===h.operator&&0===y.prerelease[0]&&(y=!1);for(const t of e){if(m=m||">"===t.operator||">="===t.operator,g=g||"<"===t.operator||"<="===t.operator,u)if(v&&t.semver.prerelease&&t.semver.prerelease.length&&t.semver.major===v.major&&t.semver.minor===v.minor&&t.semver.patch===v.patch&&(v=!1),">"===t.operator||">="===t.operator){if(d=l(u,t,n),d===t&&d!==u)return!1}else if(">="===u.operator&&!o(u.semver,String(t),n))return!1;if(h)if(y&&t.semver.prerelease&&t.semver.prerelease.length&&t.semver.major===y.major&&t.semver.minor===y.minor&&t.semver.patch===y.patch&&(y=!1),"<"===t.operator||"<="===t.operator){if(p=c(h,t,n),p===t&&p!==h)return!1}else if("<="===h.operator&&!o(h.semver,String(t),n))return!1;if(!t.operator&&(h||u)&&0!==f)return!1}return!(u&&g&&!h&&0!==f||h&&m&&!u&&0!==f||v||y)},l=(t,e,n)=>{if(!t)return e;const i=a(t.semver,e.semver,n);return i>0?t:i<0||">"===e.operator&&">="===t.operator?e:t},c=(t,e,n)=>{if(!t)return e;const i=a(t.semver,e.semver,n);return i<0?t:i>0||"<"===e.operator&&"<="===t.operator?e:t};t.exports=(t,e,n={})=>{if(t===e)return!0;t=new i(t,n),e=new i(e,n);let r=!1;t:for(const i of t.set){for(const t of e.set){const e=u(i,t,n);if(r=r||null!==e,e)continue t}if(r)return!1}return!0}},8865:(t,e,n)=>{const i=n(2013);t.exports=(t,e)=>new i(t,e).set.map((t=>t.map((t=>t.value)).join(" ").trim().split(" ")))},576:(t,e,n)=>{const i=n(2013);t.exports=(t,e)=>{try{return new i(t,e).range||"*"}catch(t){return null}}},5163:(t,e,n)=>{"use strict";n.d(e,{CR:()=>o,XA:()=>s,ZT:()=>r,ev:()=>a});var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function s(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}function a(t,e,n){if(n||2===arguments.length)for(var i,r=0,s=e.length;r<s;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}Object.create,Object.create},4731:(t,e,n)=>{"use strict";n.r(e),n.d(e,{DEFAULT_ACTIONS:()=>b1,default:()=>S1,guessMode:()=>C1,vega:()=>m1,vegaLite:()=>y1});var i={};n.r(i),n.d(i,{JsonPatchError:()=>M,_areEquals:()=>U,applyOperation:()=>j,applyPatch:()=>I,applyReducer:()=>R,deepClone:()=>z,getValueByPointer:()=>B,validate:()=>P,validator:()=>L});var r={};n.r(r),n.d(r,{compare:()=>J,generate:()=>X,observe:()=>G,unobserve:()=>V});var s={};n.r(s),n.d(s,{aggregate:()=>Kl,bin:()=>Ql,collect:()=>ec,compare:()=>nc,countpattern:()=>rc,cross:()=>sc,density:()=>uc,dotbin:()=>dc,expression:()=>pc,extent:()=>mc,facet:()=>vc,field:()=>bc,filter:()=>wc,flatten:()=>Ac,fold:()=>_c,formula:()=>kc,generate:()=>Cc,impute:()=>Fc,joinaggregate:()=>Sc,kde:()=>Oc,key:()=>Nc,load:()=>zc,lookup:()=>Tc,multiextent:()=>Bc,multivalues:()=>Ic,params:()=>Lc,pivot:()=>Pc,prefacet:()=>Uc,project:()=>qc,proxy:()=>Wc,quantile:()=>Hc,relay:()=>Vc,sample:()=>Gc,sequence:()=>Xc,sieve:()=>Yc,subflow:()=>yc,timeunit:()=>Jc,tupleindex:()=>Kc,values:()=>Qc,window:()=>rh});var o={};n.r(o),n.d(o,{interpolate:()=>zd,interpolateArray:()=>Cd,interpolateBasis:()=>dd,interpolateBasisClosed:()=>pd,interpolateCubehelix:()=>mg,interpolateCubehelixLong:()=>yg,interpolateDate:()=>Dd,interpolateDiscrete:()=>Ap,interpolateHcl:()=>ng,interpolateHclLong:()=>ig,interpolateHsl:()=>$p,interpolateHslLong:()=>Tp,interpolateHue:()=>_p,interpolateLab:()=>tg,interpolateNumber:()=>Fd,interpolateNumberArray:()=>_d,interpolateObject:()=>Sd,interpolateRgb:()=>bd,interpolateRgbBasis:()=>wd,interpolateRgbBasisClosed:()=>Ad,interpolateRound:()=>$d,interpolateString:()=>Md,interpolateTransformCss:()=>Sp,interpolateTransformSvg:()=>Op,interpolateZoom:()=>Mp,piecewise:()=>bp,quantize:()=>vg});var a={};n.r(a),n.d(a,{bound:()=>Mw,identifier:()=>Tw,mark:()=>Bw,overlap:()=>jw,render:()=>Ww,viewlayout:()=>hA});var u={};n.r(u),n.d(u,{axisticks:()=>dA,datajoin:()=>pA,encode:()=>mA,legendentries:()=>yA,linkpath:()=>AA,pie:()=>DA,scale:()=>OA,sortitems:()=>$A,stack:()=>RA});var l={};n.r(l),n.d(l,{contour:()=>mE,geojson:()=>bE,geopath:()=>xE,geopoint:()=>wE,geoshape:()=>AE,graticule:()=>_E,heatmap:()=>kE,isocontour:()=>oE,kde2d:()=>dE,projection:()=>EE});var c={};n.r(c),n.d(c,{force:()=>wD});var h={};n.r(h),n.d(h,{nest:()=>wF,pack:()=>DF,partition:()=>SF,stratify:()=>OF,tree:()=>zF,treelinks:()=>$F,treemap:()=>jF});var f={};n.r(f),n.d(f,{label:()=>nS});var d={};n.r(d),n.d(d,{loess:()=>rS,regression:()=>oS});var p={};n.r(p),n.d(p,{voronoi:()=>SS});var g={};n.r(g),n.d(g,{wordcloud:()=>qS});var m={};n.r(m),n.d(m,{crossfilter:()=>JS,resolvefilter:()=>ZS});var y={};n.r(y),n.d(y,{Bounds:()=>Oy,CanvasHandler:()=>sx,CanvasRenderer:()=>cx,DATE:()=>Nr,DAY:()=>Mr,DAYOFYEAR:()=>zr,Dataflow:()=>Fu,Debug:()=>xt,Error:()=>yt,EventStream:()=>pu,Gradient:()=>jm,GroupItem:()=>My,HOURS:()=>$r,Handler:()=>Pb,Info:()=>bt,Item:()=>Ny,MILLISECONDS:()=>jr,MINUTES:()=>Tr,MONTH:()=>Sr,Marks:()=>Cb,MultiPulse:()=>ku,None:()=>mt,Operator:()=>hu,Parameters:()=>uu,Pulse:()=>xu,QUARTER:()=>Fr,RenderType:()=>Zx,Renderer:()=>qb,ResourceLoader:()=>zy,SECONDS:()=>Br,SVGHandler:()=>fx,SVGRenderer:()=>Bx,SVGStringRenderer:()=>Jx,Scenegraph:()=>zb,TIME_UNITS:()=>Ir,Transform:()=>Ou,View:()=>Qz,WEEK:()=>Or,Warn:()=>vt,YEAR:()=>Dr,accessor:()=>tt,accessorFields:()=>nt,accessorName:()=>et,array:()=>Gt,ascending:()=>Zt,bandwidthNRD:()=>Hu,bin:()=>Vu,bootstrapCI:()=>Yu,boundClip:()=>sw,boundContext:()=>tv,boundItem:()=>Eb,boundMark:()=>Fb,boundStroke:()=>By,changeset:()=>ou,clampRange:()=>Xt,codegenExpression:()=>QI,compare:()=>Jt,constant:()=>ee,cumulativeLogNormal:()=>cl,cumulativeNormal:()=>rl,cumulativeUniform:()=>ml,dayofyear:()=>Hr,debounce:()=>ne,defaultLocale:()=>va,definition:()=>Mu,densityLogNormal:()=>ll,densityNormal:()=>il,densityUniform:()=>gl,domChild:()=>jb,domClear:()=>Ib,domCreate:()=>Tb,domFind:()=>Bb,dotbin:()=>Ju,error:()=>ot,expressionFunction:()=>ez,extend:()=>ie,extent:()=>re,extentIndex:()=>se,falsy:()=>pt,fastmap:()=>le,field:()=>ut,flush:()=>ce,font:()=>bb,fontFamily:()=>vb,fontSize:()=>db,format:()=>Ua,formatLocale:()=>ca,formats:()=>qa,hasOwnProperty:()=>ae,id:()=>lt,identity:()=>ct,inferType:()=>Ta,inferTypes:()=>Ba,ingest:()=>tu,inherits:()=>he,inrange:()=>fe,interpolate:()=>um,interpolateColors:()=>sm,interpolateRange:()=>rm,intersect:()=>tw,intersectBoxLine:()=>hv,intersectPath:()=>av,intersectPoint:()=>uv,intersectRule:()=>cv,isArray:()=>At,isBoolean:()=>de,isDate:()=>pe,isFunction:()=>Yt,isIterable:()=>ge,isNumber:()=>me,isObject:()=>_t,isRegExp:()=>ye,isString:()=>ve,isTuple:()=>Za,key:()=>be,lerp:()=>xe,lineHeight:()=>pb,loader:()=>Va,locale:()=>ya,logger:()=>wt,lruCache:()=>we,markup:()=>Sx,merge:()=>Ae,mergeConfig:()=>Ct,multiLineOffset:()=>mb,one:()=>ft,pad:()=>ke,panLinear:()=>Bt,panLog:()=>jt,panPow:()=>It,panSymlog:()=>Rt,parse:()=>Rj,parseExpression:()=>JI,parseSelector:()=>rR,pathCurves:()=>Rm,pathEqual:()=>aw,pathParse:()=>Um,pathRectangle:()=>fy,pathRender:()=>Qm,pathSymbols:()=>iy,pathTrail:()=>dy,peek:()=>Ft,point:()=>Lb,projection:()=>XC,quantileLogNormal:()=>hl,quantileNormal:()=>sl,quantileUniform:()=>yl,quantiles:()=>qu,quantizeInterpolator:()=>om,quarter:()=>Ht,quartiles:()=>Wu,random:()=>Gu,randomInteger:()=>Ku,randomKDE:()=>al,randomLCG:()=>Zu,randomLogNormal:()=>fl,randomMixture:()=>dl,randomNormal:()=>ol,randomUniform:()=>vl,read:()=>Ha,regressionExp:()=>Cl,regressionLinear:()=>_l,regressionLoess:()=>Ol,regressionLog:()=>kl,regressionPoly:()=>Fl,regressionPow:()=>El,regressionQuad:()=>Dl,renderModule:()=>Qx,repeat:()=>_e,resetDefaultLocale:()=>ba,resetSVGClipId:()=>Fy,resetSVGDefIds:()=>uw,responseType:()=>Wa,runtimeContext:()=>hz,sampleCurve:()=>$l,sampleLogNormal:()=>ul,sampleNormal:()=>nl,sampleUniform:()=>pl,scale:()=>Xg,sceneEqual:()=>ow,sceneFromJSON:()=>Nb,scenePickVisit:()=>Av,sceneToJSON:()=>Ob,sceneVisit:()=>wv,sceneZOrder:()=>xv,scheme:()=>fm,serializeXML:()=>Ox,setRandom:()=>Xu,span:()=>Ce,splitAccessPath:()=>at,stringValue:()=>Ee,textMetrics:()=>ab,timeBin:()=>Os,timeFloor:()=>as,timeFormatLocale:()=>ga,timeInterval:()=>ds,timeOffset:()=>ms,timeSequence:()=>bs,timeUnitSpecifier:()=>Ur,timeUnits:()=>Lr,toBoolean:()=>De,toDate:()=>Se,toNumber:()=>St,toSet:()=>Ne,toString:()=>Oe,transform:()=>zu,transforms:()=>Nu,truncate:()=>Me,truthy:()=>dt,tupleid:()=>Ka,typeParsers:()=>Ma,utcFloor:()=>cs,utcInterval:()=>ps,utcOffset:()=>ys,utcSequence:()=>xs,utcdayofyear:()=>Zr,utcquarter:()=>Vt,utcweek:()=>Kr,version:()=>uR,visitArray:()=>ze,week:()=>Vr,writeConfig:()=>Et,zero:()=>ht,zoomLinear:()=>Pt,zoomLog:()=>Ut,zoomPow:()=>qt,zoomSymlog:()=>Wt});var v={};n.r(v),n.d(v,{compile:()=>k0,extractTransforms:()=>E0,normalize:()=>ZG,version:()=>D0});var b={};n.r(b),n.d(b,{dark:()=>O0,excel:()=>M0,fivethirtyeight:()=>j0,ggplot2:()=>R0,googlecharts:()=>o1,latimes:()=>H0,quartz:()=>X0,urbaninstitute:()=>n1,version:()=>a1,vox:()=>J0});var x,w=(x=function(t,e){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}x(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),A=Object.prototype.hasOwnProperty;function _(t,e){return A.call(t,e)}function k(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);for(var i in e=[],t)_(t,i)&&e.push(i);return e}function C(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function E(t){for(var e,n=0,i=t.length;n<i;){if(!((e=t.charCodeAt(n))>=48&&e<=57))return!1;n++}return!0}function D(t){return-1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function F(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function S(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(S(t[e]))return!0}else if("object"==typeof t){var i=k(t),r=i.length;for(e=0;e<r;e++)if(S(t[i[e]]))return!0}return!1}function O(t,e){var n=[t];for(var i in e){var r="object"==typeof e[i]?JSON.stringify(e[i],null,2):e[i];void 0!==r&&n.push(i+": "+r)}return n.join("\n")}var N=function(t){function e(e,n,i,r,s){var o=this.constructor,a=t.call(this,O(e,{name:n,index:i,operation:r,tree:s}))||this;return a.name=n,a.index=i,a.operation=r,a.tree=s,Object.setPrototypeOf(a,o.prototype),a.message=O(e,{name:n,index:i,operation:r,tree:s}),a}return w(e,t),e}(Error),M=N,z=C,$={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var i=t[e];return delete t[e],{newDocument:n,removed:i}},replace:function(t,e,n){var i=t[e];return t[e]=this.value,{newDocument:n,removed:i}},move:function(t,e,n){var i=B(n,this.path);i&&(i=C(i));var r=j(n,{op:"remove",path:this.from}).removed;return j(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(t,e,n){var i=B(n,this.from);return j(n,{op:"add",path:this.path,value:C(i)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:U(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},T={add:function(t,e,n){return E(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){return{newDocument:n,removed:t.splice(e,1)[0]}},replace:function(t,e,n){var i=t[e];return t[e]=this.value,{newDocument:n,removed:i}},move:$.move,copy:$.copy,test:$.test,_get:$._get};function B(t,e){if(""==e)return t;var n={op:"_get",path:e};return j(t,n),n.value}function j(t,e,n,i,r,s){if(void 0===n&&(n=!1),void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===s&&(s=0),n&&("function"==typeof n?n(e,0,t,e.path):L(e,0)),""===e.path){var o={newDocument:t};if("add"===e.op)return o.newDocument=e.value,o;if("replace"===e.op)return o.newDocument=e.value,o.removed=t,o;if("move"===e.op||"copy"===e.op)return o.newDocument=B(t,e.from),"move"===e.op&&(o.removed=t),o;if("test"===e.op){if(o.test=U(t,e.value),!1===o.test)throw new M("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}if("remove"===e.op)return o.removed=t,o.newDocument=null,o;if("_get"===e.op)return e.value=t,o;if(n)throw new M("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}i||(t=C(t));var a=(e.path||"").split("/"),u=t,l=1,c=a.length,h=void 0,f=void 0,d=void 0;for(d="function"==typeof n?n:L;;){if((f=a[l])&&-1!=f.indexOf("~")&&(f=F(f)),r&&"__proto__"==f)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===h&&(void 0===u[f]?h=a.slice(0,l).join("/"):l==c-1&&(h=e.path),void 0!==h&&d(e,0,t,h)),l++,Array.isArray(u)){if("-"===f)f=u.length;else{if(n&&!E(f))throw new M("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);E(f)&&(f=~~f)}if(l>=c){if(n&&"add"===e.op&&f>u.length)throw new M("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);if(!1===(o=T[e.op].call(e,u,f,t)).test)throw new M("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(l>=c){if(!1===(o=$[e.op].call(e,u,f,t)).test)throw new M("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(u=u[f],n&&l<c&&(!u||"object"!=typeof u))throw new M("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}function I(t,e,n,i,r){if(void 0===i&&(i=!0),void 0===r&&(r=!0),n&&!Array.isArray(e))throw new M("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(t=C(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=j(t,e[o],n,!0,r,o),t=s[o].newDocument;return s.newDocument=t,s}function R(t,e,n){var i=j(t,e);if(!1===i.test)throw new M("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return i.newDocument}function L(t,e,n,i){if("object"!=typeof t||null===t||Array.isArray(t))throw new M("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(!$[t.op])throw new M("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n);if("string"!=typeof t.path)throw new M("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new M('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new M("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new M("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&S(t.value))throw new M("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n)if("add"==t.op){var r=t.path.split("/").length,s=i.split("/").length;if(r!==s+1&&r!==s)throw new M("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==i)throw new M("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if("move"===t.op||"copy"===t.op){var o=P([{op:"_get",path:t.from,value:void 0}],n);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new M("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}function P(t,e,n){try{if(!Array.isArray(t))throw new M("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)I(C(e),C(t),n||!0);else{n=n||L;for(var i=0;i<t.length;i++)n(t[i],i,e,void 0)}}catch(t){if(t instanceof M)return t;throw t}}function U(t,e){if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){var n,i,r,s=Array.isArray(t),o=Array.isArray(e);if(s&&o){if((i=t.length)!=e.length)return!1;for(n=i;0!=n--;)if(!U(t[n],e[n]))return!1;return!0}if(s!=o)return!1;var a=Object.keys(t);if((i=a.length)!==Object.keys(e).length)return!1;for(n=i;0!=n--;)if(!e.hasOwnProperty(a[n]))return!1;for(n=i;0!=n--;)if(!U(t[r=a[n]],e[r]))return!1;return!0}return t!=t&&e!=e}var q=new WeakMap,W=function(t){this.observers=new Map,this.obj=t},H=function(t,e){this.callback=t,this.observer=e};function V(t,e){e.unobserve()}function G(t,e){var n,i=function(t){return q.get(t)}(t);if(i){var r=function(t,e){return t.observers.get(e)}(i,e);n=r&&r.observer}else i=new W(t),q.set(t,i);if(n)return n;if(n={},i.value=C(t),e){n.callback=e,n.next=null;var s=function(){X(n)},o=function(){clearTimeout(n.next),n.next=setTimeout(s)};"undefined"!=typeof window&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return n.patches=[],n.object=t,n.unobserve=function(){X(n),clearTimeout(n.next),function(t,e){t.observers.delete(e.callback)}(i,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},i.observers.set(e,new H(e,n)),n}function X(t,e){void 0===e&&(e=!1);var n=q.get(t.object);Y(n.value,t.object,t.patches,"",e),t.patches.length&&I(n.value,t.patches);var i=t.patches;return i.length>0&&(t.patches=[],t.callback&&t.callback(i)),i}function Y(t,e,n,i,r){if(e!==t){"function"==typeof e.toJSON&&(e=e.toJSON());for(var s=k(e),o=k(t),a=!1,u=o.length-1;u>=0;u--){var l=t[h=o[u]];if(!_(e,h)||void 0===e[h]&&void 0!==l&&!1===Array.isArray(e))Array.isArray(t)===Array.isArray(e)?(r&&n.push({op:"test",path:i+"/"+D(h),value:C(l)}),n.push({op:"remove",path:i+"/"+D(h)}),a=!0):(r&&n.push({op:"test",path:i,value:t}),n.push({op:"replace",path:i,value:e}));else{var c=e[h];"object"==typeof l&&null!=l&&"object"==typeof c&&null!=c&&Array.isArray(l)===Array.isArray(c)?Y(l,c,n,i+"/"+D(h),r):l!==c&&(r&&n.push({op:"test",path:i+"/"+D(h),value:C(l)}),n.push({op:"replace",path:i+"/"+D(h),value:C(c)}))}}if(a||s.length!=o.length)for(u=0;u<s.length;u++){var h;_(t,h=s[u])||void 0===e[h]||n.push({op:"add",path:i+"/"+D(h),value:C(e[h])})}}}function J(t,e,n){void 0===n&&(n=!1);var i=[];return Y(t,e,i,"",n),i}Object.assign({},i,r,{JsonPatchError:N,deepClone:C,escapePathComponent:D,unescapePathComponent:F});var Z=n(6058),K=n.n(Z),Q=n(7699);function tt(t,e,n){return t.fields=e||[],t.fname=n,t}function et(t){return null==t?null:t.fname}function nt(t){return null==t?null:t.fields}function it(t){return 1===t.length?rt(t[0]):st(t)}const rt=t=>function(e){return e[t]},st=t=>{const e=t.length;return function(n){for(let i=0;i<e;++i)n=n[t[i]];return n}};function ot(t){throw Error(t)}function at(t){const e=[],n=t.length;let i,r,s,o=null,a=0,u="";function l(){e.push(u+t.substring(i,r)),u="",i=r+1}for(t+="",i=r=0;r<n;++r)if(s=t[r],"\\"===s)u+=t.substring(i,r),u+=t.substring(++r,++r),i=r;else if(s===o)l(),o=null,a=-1;else{if(o)continue;i===a&&'"'===s||i===a&&"'"===s?(i=r+1,o=s):"."!==s||a?"["===s?(r>i&&l(),a=i=r+1):"]"===s&&(a||ot("Access path missing open bracket: "+t),a>0&&l(),a=0,i=r+1):r>i?l():i=r+1}return a&&ot("Access path missing closing bracket: "+t),o&&ot("Access path missing closing quote: "+t),r>i&&(r++,l()),e}function ut(t,e,n){const i=at(t);return t=1===i.length?i[0]:t,tt((n&&n.get||it)(i),[t],e||t)}const lt=ut("id"),ct=tt((t=>t),[],"identity"),ht=tt((()=>0),[],"zero"),ft=tt((()=>1),[],"one"),dt=tt((()=>!0),[],"true"),pt=tt((()=>!1),[],"false");function gt(t,e,n){const i=[e].concat([].slice.call(n));console[t].apply(console,i)}const mt=0,yt=1,vt=2,bt=3,xt=4;function wt(t,e){let n=t||mt;return{level(t){return arguments.length?(n=+t,this):n},error(){return n>=yt&&gt(e||"error","ERROR",arguments),this},warn(){return n>=vt&&gt(e||"warn","WARN",arguments),this},info(){return n>=bt&&gt(e||"log","INFO",arguments),this},debug(){return n>=xt&&gt(e||"log","DEBUG",arguments),this}}}var At=Array.isArray;function _t(t){return t===Object(t)}const kt=t=>"__proto__"!==t;function Ct(...t){return t.reduce(((t,e)=>{for(const n in e)if("signals"===n)t.signals=Dt(t.signals,e.signals);else{const i="legend"===n?{layout:1}:"style"===n||null;Et(t,n,e[n],i)}return t}),{})}function Et(t,e,n,i){if(!kt(e))return;let r,s;if(_t(n)&&!At(n))for(r in s=_t(t[e])?t[e]:t[e]={},n)i&&(!0===i||i[r])?Et(s,r,n[r]):kt(r)&&(s[r]=n[r]);else t[e]=n}function Dt(t,e){if(null==t)return e;const n={},i=[];function r(t){n[t.name]||(n[t.name]=1,i.push(t))}return e.forEach(r),t.forEach(r),i}function Ft(t){return t[t.length-1]}function St(t){return null==t||""===t?null:+t}const Ot=t=>e=>t*Math.exp(e),Nt=t=>e=>Math.log(t*e),Mt=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),zt=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t,$t=t=>e=>e<0?-Math.pow(-e,t):Math.pow(e,t);function Tt(t,e,n,i){const r=n(t[0]),s=n(Ft(t)),o=(s-r)*e;return[i(r-o),i(s-o)]}function Bt(t,e){return Tt(t,e,St,ct)}function jt(t,e){var n=Math.sign(t[0]);return Tt(t,e,Nt(n),Ot(n))}function It(t,e,n){return Tt(t,e,$t(n),$t(1/n))}function Rt(t,e,n){return Tt(t,e,Mt(n),zt(n))}function Lt(t,e,n,i,r){const s=i(t[0]),o=i(Ft(t)),a=null!=e?i(e):(s+o)/2;return[r(a+(s-a)*n),r(a+(o-a)*n)]}function Pt(t,e,n){return Lt(t,e,n,St,ct)}function Ut(t,e,n){const i=Math.sign(t[0]);return Lt(t,e,n,Nt(i),Ot(i))}function qt(t,e,n,i){return Lt(t,e,n,$t(i),$t(1/i))}function Wt(t,e,n,i){return Lt(t,e,n,Mt(i),zt(i))}function Ht(t){return 1+~~(new Date(t).getMonth()/3)}function Vt(t){return 1+~~(new Date(t).getUTCMonth()/3)}function Gt(t){return null!=t?At(t)?t:[t]:[]}function Xt(t,e,n){let i,r=t[0],s=t[1];return s<r&&(i=s,s=r,r=i),i=s-r,i>=n-e?[e,n]:[r=Math.min(Math.max(r,e),n-i),r+i]}function Yt(t){return"function"==typeof t}function Jt(t,e,n){n=n||{},e=Gt(e)||[];const i=[],r=[],s={},o=n.comparator||Kt;return Gt(t).forEach(((t,o)=>{null!=t&&(i.push("descending"===e[o]?-1:1),r.push(t=Yt(t)?t:ut(t,null,n)),(nt(t)||[]).forEach((t=>s[t]=1)))})),0===r.length?null:tt(o(r,i),Object.keys(s))}const Zt=(t,e)=>(t<e||null==t)&&null!=e?-1:(t>e||null==e)&&null!=t?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e==e?-1:e!=e&&t==t?1:0),Kt=(t,e)=>1===t.length?Qt(t[0],e[0]):te(t,e,t.length),Qt=(t,e)=>function(n,i){return Zt(t(n),t(i))*e},te=(t,e,n)=>(e.push(0),function(i,r){let s,o=0,a=-1;for(;0===o&&++a<n;)s=t[a],o=Zt(s(i),s(r));return o*e[a]});function ee(t){return Yt(t)?t:()=>t}function ne(t,e){let n;return i=>{n&&clearTimeout(n),n=setTimeout((()=>(e(i),n=null)),t)}}function ie(t){for(let e,n,i=1,r=arguments.length;i<r;++i)for(n in e=arguments[i],e)t[n]=e[n];return t}function re(t,e){let n,i,r,s,o=0;if(t&&(n=t.length))if(null==e){for(i=t[o];o<n&&(null==i||i!=i);i=t[++o]);for(r=s=i;o<n;++o)i=t[o],null!=i&&(i<r&&(r=i),i>s&&(s=i))}else{for(i=e(t[o]);o<n&&(null==i||i!=i);i=e(t[++o]));for(r=s=i;o<n;++o)i=e(t[o]),null!=i&&(i<r&&(r=i),i>s&&(s=i))}return[r,s]}function se(t,e){const n=t.length;let i,r,s,o,a,u=-1;if(null==e){for(;++u<n;)if(r=t[u],null!=r&&r>=r){i=s=r;break}if(u===n)return[-1,-1];for(o=a=u;++u<n;)r=t[u],null!=r&&(i>r&&(i=r,o=u),s<r&&(s=r,a=u))}else{for(;++u<n;)if(r=e(t[u],u,t),null!=r&&r>=r){i=s=r;break}if(u===n)return[-1,-1];for(o=a=u;++u<n;)r=e(t[u],u,t),null!=r&&(i>r&&(i=r,o=u),s<r&&(s=r,a=u))}return[o,a]}const oe=Object.prototype.hasOwnProperty;function ae(t,e){return oe.call(t,e)}const ue={};function le(t){let e,n={};function i(t){return ae(n,t)&&n[t]!==ue}const r={size:0,empty:0,object:n,has:i,get:t=>i(t)?n[t]:void 0,set(t,e){return i(t)||(++r.size,n[t]===ue&&--r.empty),n[t]=e,this},delete(t){return i(t)&&(--r.size,++r.empty,n[t]=ue),this},clear(){r.size=r.empty=0,r.object=n={}},test(t){return arguments.length?(e=t,r):e},clean(){const t={};let i=0;for(const r in n){const s=n[r];s===ue||e&&e(s)||(t[r]=s,++i)}r.size=i,r.empty=0,r.object=n=t}};return t&&Object.keys(t).forEach((e=>{r.set(e,t[e])})),r}function ce(t,e,n,i,r,s){if(!n&&0!==n)return s;const o=+n;let a,u=t[0],l=Ft(t);l<u&&(a=u,u=l,l=a),a=Math.abs(e-u);const c=Math.abs(l-e);return a<c&&a<=o?i:c<=o?r:s}function he(t,e,n){const i=t.prototype=Object.create(e.prototype);return Object.defineProperty(i,"constructor",{value:t,writable:!0,enumerable:!0,configurable:!0}),ie(i,n)}function fe(t,e,n,i){let r,s=e[0],o=e[e.length-1];return s>o&&(r=s,s=o,o=r),i=void 0===i||i,((n=void 0===n||n)?s<=t:s<t)&&(i?t<=o:t<o)}function de(t){return"boolean"==typeof t}function pe(t){return"[object Date]"===Object.prototype.toString.call(t)}function ge(t){return t&&Yt(t[Symbol.iterator])}function me(t){return"number"==typeof t}function ye(t){return"[object RegExp]"===Object.prototype.toString.call(t)}function ve(t){return"string"==typeof t}function be(t,e,n){t&&(t=e?Gt(t).map((t=>t.replace(/\\(.)/g,"$1"))):Gt(t));const i=t&&t.length,r=n&&n.get||it,s=t=>r(e?[t]:at(t));let o;if(i)if(1===i){const e=s(t[0]);o=function(t){return""+e(t)}}else{const e=t.map(s);o=function(t){let n=""+e[0](t),r=0;for(;++r<i;)n+="|"+e[r](t);return n}}else o=function(){return""};return tt(o,t,"key")}function xe(t,e){const n=t[0],i=Ft(t),r=+e;return r?1===r?i:n+r*(i-n):n}function we(t){let e,n,i;t=+t||1e4;const r=()=>{e={},n={},i=0},s=(r,s)=>(++i>t&&(n=e,e={},i=1),e[r]=s);return r(),{clear:r,has:t=>ae(e,t)||ae(n,t),get:t=>ae(e,t)?e[t]:ae(n,t)?s(t,n[t]):void 0,set:(t,n)=>ae(e,t)?e[t]=n:s(t,n)}}function Ae(t,e,n,i){const r=e.length,s=n.length;if(!s)return e;if(!r)return n;const o=i||new e.constructor(r+s);let a=0,u=0,l=0;for(;a<r&&u<s;++l)o[l]=t(e[a],n[u])>0?n[u++]:e[a++];for(;a<r;++a,++l)o[l]=e[a];for(;u<s;++u,++l)o[l]=n[u];return o}function _e(t,e){let n="";for(;--e>=0;)n+=t;return n}function ke(t,e,n,i){const r=n||" ",s=t+"",o=e-s.length;return o<=0?s:"left"===i?_e(r,o)+s:"center"===i?_e(r,~~(o/2))+s+_e(r,Math.ceil(o/2)):s+_e(r,o)}function Ce(t){return t&&Ft(t)-t[0]||0}function Ee(t){return At(t)?"["+t.map(Ee)+"]":_t(t)||ve(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function De(t){return null==t||""===t?null:!(!t||"false"===t||"0"===t||!t)}const Fe=t=>me(t)||pe(t)?t:Date.parse(t);function Se(t,e){return e=e||Fe,null==t||""===t?null:e(t)}function Oe(t){return null==t||""===t?null:t+""}function Ne(t){const e={},n=t.length;for(let i=0;i<n;++i)e[t[i]]=!0;return e}function Me(t,e,n,i){const r=null!=i?i:"",s=t+"",o=s.length,a=Math.max(0,e-r.length);return o<=e?s:"left"===n?r+s.slice(o-a):"center"===n?s.slice(0,Math.ceil(a/2))+r+s.slice(o-~~(a/2)):s.slice(0,a)+r}function ze(t,e,n){if(t)if(e){const i=t.length;for(let r=0;r<i;++r){const i=e(t[r]);i&&n(i,r,t)}}else t.forEach(n)}function $e(t,e,n){return t.fields=e||[],t.fname=n,t}function Te(t){return null==t?null:t.fname}function Be(t){return null==t?null:t.fields}function je(t){return 1===t.length?Ie(t[0]):Re(t)}const Ie=t=>function(e){return e[t]},Re=t=>{const e=t.length;return function(n){for(let i=0;i<e;++i)n=n[t[i]];return n}};function Le(t){throw Error(t)}function Pe(t){const e=[],n=t.length;let i,r,s,o=null,a=0,u="";function l(){e.push(u+t.substring(i,r)),u="",i=r+1}for(t+="",i=r=0;r<n;++r)if(s=t[r],"\\"===s)u+=t.substring(i,r),u+=t.substring(++r,++r),i=r;else if(s===o)l(),o=null,a=-1;else{if(o)continue;i===a&&'"'===s||i===a&&"'"===s?(i=r+1,o=s):"."!==s||a?"["===s?(r>i&&l(),a=i=r+1):"]"===s&&(a||Le("Access path missing open bracket: "+t),a>0&&l(),a=0,i=r+1):r>i?l():i=r+1}return a&&Le("Access path missing closing bracket: "+t),o&&Le("Access path missing closing quote: "+t),r>i&&(r++,l()),e}function Ue(t,e,n){const i=Pe(t);return t=1===i.length?i[0]:t,$e((n&&n.get||je)(i),[t],e||t)}const qe=Ue("id"),We=$e((t=>t),[],"identity"),He=$e((()=>0),[],"zero"),Ve=$e((()=>1),[],"one"),Ge=$e((()=>!0),[],"true"),Xe=$e((()=>!1),[],"false");function Ye(t,e,n){const i=[e].concat([].slice.call(n));console[t].apply(console,i)}function Je(t,e,n=Ye){let i=t||0;return{level(t){return arguments.length?(i=+t,this):i},error(){return i>=1&&n(e||"error","ERROR",arguments),this},warn(){return i>=2&&n(e||"warn","WARN",arguments),this},info(){return i>=3&&n(e||"log","INFO",arguments),this},debug(){return i>=4&&n(e||"log","DEBUG",arguments),this}}}var Ze=Array.isArray;function Ke(t){return t===Object(t)}const Qe=t=>"__proto__"!==t;function tn(t,e,n,i){if(!Qe(e))return;let r,s;if(Ke(n)&&!Ze(n))for(r in s=Ke(t[e])?t[e]:t[e]={},n)i&&(!0===i||i[r])?tn(s,r,n[r]):Qe(r)&&(s[r]=n[r]);else t[e]=n}function en(t,e){if(null==t)return e;const n={},i=[];function r(t){n[t.name]||(n[t.name]=1,i.push(t))}return e.forEach(r),t.forEach(r),i}function nn(t){return t[t.length-1]}function rn(t){return null==t||""===t?null:+t}const sn=t=>e=>t*Math.exp(e),on=t=>e=>Math.log(t*e),an=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),un=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t,ln=t=>e=>e<0?-Math.pow(-e,t):Math.pow(e,t);function cn(t,e,n,i){const r=n(t[0]),s=n(nn(t)),o=(s-r)*e;return[i(r-o),i(s-o)]}function hn(t,e,n,i,r){const s=i(t[0]),o=i(nn(t)),a=null!=e?i(e):(s+o)/2;return[r(a+(s-a)*n),r(a+(o-a)*n)]}function fn(t,e,n){return hn(t,e,n,rn,We)}function dn(t,e,n){const i=Math.sign(t[0]);return hn(t,e,n,on(i),sn(i))}function pn(t,e,n,i){return hn(t,e,n,ln(i),ln(1/i))}function gn(t,e,n,i){return hn(t,e,n,an(i),un(i))}function mn(t){return null!=t?Ze(t)?t:[t]:[]}function yn(t){return"function"==typeof t}function vn(t,e,n){n=n||{},e=mn(e)||[];const i=[],r=[],s={},o=n.comparator||xn;return mn(t).forEach(((t,o)=>{null!=t&&(i.push("descending"===e[o]?-1:1),r.push(t=yn(t)?t:Ue(t,null,n)),(Be(t)||[]).forEach((t=>s[t]=1)))})),0===r.length?null:$e(o(r,i),Object.keys(s))}const bn=(t,e)=>(t<e||null==t)&&null!=e?-1:(t>e||null==e)&&null!=t?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e==e?-1:e!=e&&t==t?1:0),xn=(t,e)=>1===t.length?wn(t[0],e[0]):An(t,e,t.length),wn=(t,e)=>function(n,i){return bn(t(n),t(i))*e},An=(t,e,n)=>(e.push(0),function(i,r){let s,o=0,a=-1;for(;0===o&&++a<n;)s=t[a],o=bn(s(i),s(r));return o*e[a]});function _n(t){return yn(t)?t:()=>t}function kn(t,e){let n;return i=>{n&&clearTimeout(n),n=setTimeout((()=>(e(i),n=null)),t)}}function Cn(t){for(let e,n,i=1,r=arguments.length;i<r;++i)for(n in e=arguments[i],e)t[n]=e[n];return t}function En(t,e){let n,i,r,s,o=0;if(t&&(n=t.length))if(null==e){for(i=t[o];o<n&&(null==i||i!=i);i=t[++o]);for(r=s=i;o<n;++o)i=t[o],null!=i&&(i<r&&(r=i),i>s&&(s=i))}else{for(i=e(t[o]);o<n&&(null==i||i!=i);i=e(t[++o]));for(r=s=i;o<n;++o)i=e(t[o]),null!=i&&(i<r&&(r=i),i>s&&(s=i))}return[r,s]}const Dn=Object.prototype.hasOwnProperty;function Fn(t,e){return Dn.call(t,e)}const Sn={};function On(t){let e,n={};function i(t){return Fn(n,t)&&n[t]!==Sn}const r={size:0,empty:0,object:n,has:i,get:t=>i(t)?n[t]:void 0,set(t,e){return i(t)||(++r.size,n[t]===Sn&&--r.empty),n[t]=e,this},delete(t){return i(t)&&(--r.size,++r.empty,n[t]=Sn),this},clear(){r.size=r.empty=0,r.object=n={}},test(t){return arguments.length?(e=t,r):e},clean(){const t={};let i=0;for(const r in n){const s=n[r];s===Sn||e&&e(s)||(t[r]=s,++i)}r.size=i,r.empty=0,r.object=n=t}};return t&&Object.keys(t).forEach((e=>{r.set(e,t[e])})),r}function Nn(t,e,n){const i=t.prototype=Object.create(e.prototype);return Object.defineProperty(i,"constructor",{value:t,writable:!0,enumerable:!0,configurable:!0}),Cn(i,n)}function Mn(t,e,n,i){let r,s=e[0],o=e[e.length-1];return s>o&&(r=s,s=o,o=r),i=void 0===i||i,((n=void 0===n||n)?s<=t:s<t)&&(i?t<=o:t<o)}function zn(t){return"[object Date]"===Object.prototype.toString.call(t)}function $n(t){return"number"==typeof t}function Tn(t){return"string"==typeof t}function Bn(t,e,n){t&&(t=e?mn(t).map((t=>t.replace(/\\(.)/g,"$1"))):mn(t));const i=t&&t.length,r=n&&n.get||je,s=t=>r(e?[t]:Pe(t));let o;if(i)if(1===i){const e=s(t[0]);o=function(t){return""+e(t)}}else{const e=t.map(s);o=function(t){let n=""+e[0](t),r=0;for(;++r<i;)n+="|"+e[r](t);return n}}else o=function(){return""};return $e(o,t,"key")}function jn(t,e){let n="";for(;--e>=0;)n+=t;return n}function In(t){return t&&nn(t)-t[0]||0}function Rn(t){return Ze(t)?"["+t.map(Rn)+"]":Ke(t)||Tn(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function Ln(t){return null==t||""===t?null:!(!t||"false"===t||"0"===t||!t)}const Pn=t=>$n(t)||zn(t)?t:Date.parse(t);function Un(t,e){return e=e||Pn,null==t||""===t?null:e(t)}function qn(t){return null==t||""===t?null:t+""}function Wn(t){const e={},n=t.length;for(let i=0;i<n;++i)e[t[i]]=!0;return e}function Hn(t,e,n){if(t)if(e){const i=t.length;for(let r=0;r<i;++r){const i=e(t[r]);i&&n(i,r,t)}}else t.forEach(n)}var Vn={},Gn={};function Xn(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function Yn(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var i in t)i in e||n.push(e[i]=i)})),n}function Jn(t,e){var n=t+"",i=n.length;return i<e?new Array(e-i+1).join(0)+n:n}function Zn(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function i(t,e){var i,r=[],s=t.length,o=0,a=0,u=s<=0,l=!1;function c(){if(u)return Gn;if(l)return l=!1,Vn;var e,i,r=o;if(34===t.charCodeAt(r)){for(;o++<s&&34!==t.charCodeAt(o)||34===t.charCodeAt(++o););return(e=o)>=s?u=!0:10===(i=t.charCodeAt(o++))?l=!0:13===i&&(l=!0,10===t.charCodeAt(o)&&++o),t.slice(r+1,e-1).replace(/""/g,'"')}for(;o<s;){if(10===(i=t.charCodeAt(e=o++)))l=!0;else if(13===i)l=!0,10===t.charCodeAt(o)&&++o;else if(i!==n)continue;return t.slice(r,e)}return u=!0,t.slice(r,s)}for(10===t.charCodeAt(s-1)&&--s,13===t.charCodeAt(s-1)&&--s;(i=c())!==Gn;){for(var h=[];i!==Vn&&i!==Gn;)h.push(i),i=c();e&&null==(h=e(h,a++))||r.push(h)}return r}function r(e,n){return e.map((function(e){return n.map((function(t){return o(e[t])})).join(t)}))}function s(e){return e.map(o).join(t)}function o(t){return null==t?"":t instanceof Date?function(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),i=t.getUTCSeconds(),r=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":function(t){return t<0?"-"+Jn(-t,6):t>9999?"+"+Jn(t,6):Jn(t,4)}(t.getUTCFullYear())+"-"+Jn(t.getUTCMonth()+1,2)+"-"+Jn(t.getUTCDate(),2)+(r?"T"+Jn(e,2)+":"+Jn(n,2)+":"+Jn(i,2)+"."+Jn(r,3)+"Z":i?"T"+Jn(e,2)+":"+Jn(n,2)+":"+Jn(i,2)+"Z":n||e?"T"+Jn(e,2)+":"+Jn(n,2)+"Z":"")}(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,r,s=i(t,(function(t,i){if(n)return n(t,i-1);r=t,n=e?function(t,e){var n=Xn(t);return function(i,r){return e(n(i),r,t)}}(t,e):Xn(t)}));return s.columns=r||[],s},parseRows:i,format:function(e,n){return null==n&&(n=Yn(e)),[n.map(o).join(t)].concat(r(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=Yn(t)),r(t,e).join("\n")},formatRows:function(t){return t.map(s).join("\n")},formatRow:s,formatValue:o}}function Kn(t){return t}function Qn(t,e){return"string"==typeof e&&(e=t.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return ti(t,e)}))}:ti(t,e)}function ti(t,e){var n=e.id,i=e.bbox,r=null==e.properties?{}:e.properties,s=ei(t,e);return null==n&&null==i?{type:"Feature",properties:r,geometry:s}:null==i?{type:"Feature",id:n,properties:r,geometry:s}:{type:"Feature",id:n,bbox:i,properties:r,geometry:s}}function ei(t,e){var n=function(t){if(null==t)return Kn;var e,n,i=t.scale[0],r=t.scale[1],s=t.translate[0],o=t.translate[1];return function(t,a){a||(e=n=0);var u=2,l=t.length,c=new Array(l);for(c[0]=(e+=t[0])*i+s,c[1]=(n+=t[1])*r+o;u<l;)c[u]=t[u],++u;return c}}(t.transform),i=t.arcs;function r(t,e){e.length&&e.pop();for(var r=i[t<0?~t:t],s=0,o=r.length;s<o;++s)e.push(n(r[s],s));t<0&&function(t,e){for(var n,i=t.length,r=i-e;r<--i;)n=t[r],t[r++]=t[i],t[i]=n}(e,o)}function s(t){return n(t)}function o(t){for(var e=[],n=0,i=t.length;n<i;++n)r(t[n],e);return e.length<2&&e.push(e[0]),e}function a(t){for(var e=o(t);e.length<4;)e.push(e[0]);return e}function u(t){return t.map(a)}return function t(e){var n,i=e.type;switch(i){case"GeometryCollection":return{type:i,geometries:e.geometries.map(t)};case"Point":n=s(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(s);break;case"LineString":n=o(e.arcs);break;case"MultiLineString":n=e.arcs.map(o);break;case"Polygon":n=u(e.arcs);break;case"MultiPolygon":n=e.arcs.map(u);break;default:return null}return{type:i,coordinates:n}}(e)}function ni(t,e){var n={},i={},r={},s=[],o=-1;function a(t,e){for(var i in t){var r=t[i];delete e[r.start],delete r.start,delete r.end,r.forEach((function(t){n[t<0?~t:t]=1})),s.push(r)}}return e.forEach((function(n,i){var r,s=t.arcs[n<0?~n:n];s.length<3&&!s[1][0]&&!s[1][1]&&(r=e[++o],e[o]=n,e[i]=r)})),e.forEach((function(e){var n,s,o=function(e){var n,i=t.arcs[e<0?~e:e],r=i[0];return t.transform?(n=[0,0],i.forEach((function(t){n[0]+=t[0],n[1]+=t[1]}))):n=i[i.length-1],e<0?[n,r]:[r,n]}(e),a=o[0],u=o[1];if(n=r[a])if(delete r[n.end],n.push(e),n.end=u,s=i[u]){delete i[s.start];var l=s===n?n:n.concat(s);i[l.start=n.start]=r[l.end=s.end]=l}else i[n.start]=r[n.end]=n;else if(n=i[u])if(delete i[n.start],n.unshift(e),n.start=a,s=r[a]){delete r[s.end];var c=s===n?n:s.concat(n);i[c.start=s.start]=r[c.end=n.end]=c}else i[n.start]=r[n.end]=n;else i[(n=[e]).start=a]=r[n.end=u]=n})),a(r,i),a(i,r),e.forEach((function(t){n[t<0?~t:t]||s.push([t])})),s}function ii(t){return ei(t,ri.apply(this,arguments))}function ri(t,e,n){var i,r,s;if(arguments.length>1)i=si(0,e,n);else for(r=0,i=new Array(s=t.arcs.length);r<s;++r)i[r]=r;return{type:"MultiLineString",arcs:ni(t,i)}}function si(t,e,n){var i,r=[],s=[];function o(t){var e=t<0?~t:t;(s[e]||(s[e]=[])).push({i:t,g:i})}function a(t){t.forEach(o)}function u(t){t.forEach(a)}return function t(e){switch(i=e,e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"LineString":a(e.arcs);break;case"MultiLineString":case"Polygon":u(e.arcs);break;case"MultiPolygon":!function(t){t.forEach(u)}(e.arcs)}}(e),s.forEach(null==n?function(t){r.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&r.push(t[0].i)}),r}var oi=Math.sqrt(50),ai=Math.sqrt(10),ui=Math.sqrt(2);function li(t,e,n){var i,r,s,o,a=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((i=e<t)&&(r=t,t=e,e=r),0===(o=ci(t,e,n))||!isFinite(o))return[];if(o>0){let n=Math.round(t/o),i=Math.round(e/o);for(n*o<t&&++n,i*o>e&&--i,s=new Array(r=i-n+1);++a<r;)s[a]=(n+a)*o}else{o=-o;let n=Math.round(t*o),i=Math.round(e*o);for(n/o<t&&++n,i/o>e&&--i,s=new Array(r=i-n+1);++a<r;)s[a]=(n+a)/o}return i&&s.reverse(),s}function ci(t,e,n){var i=(e-t)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),s=i/Math.pow(10,r);return r>=0?(s>=oi?10:s>=ai?5:s>=ui?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(s>=oi?10:s>=ai?5:s>=ui?2:1)}function hi(t,e,n){var i=Math.abs(e-t)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),s=i/r;return s>=oi?r*=10:s>=ai?r*=5:s>=ui&&(r*=2),e<t?-r:r}var fi,di=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function pi(t){if(!(e=di.exec(t)))throw new Error("invalid format: "+t);var e;return new gi({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function gi(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function mi(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function yi(t){return(t=mi(Math.abs(t)))?t[1]:NaN}function vi(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(yi(e)/3)))-yi(Math.abs(t)))}function bi(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,yi(e)-yi(t))+1}function xi(t){return Math.max(0,-yi(Math.abs(t)))}function wi(t,e){var n=mi(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}pi.prototype=gi.prototype,gi.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Ai={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>wi(100*t,e),r:wi,s:function(t,e){var n=mi(t,e);if(!n)return t+"";var i=n[0],r=n[1],s=r-(fi=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+mi(t,Math.max(0,e+s-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function _i(t){return t}var ki,Ci,Ei,Di=Array.prototype.map,Fi=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Si(t){var e,n,i=void 0===t.grouping||void 0===t.thousands?_i:(e=Di.call(t.grouping,Number),n=t.thousands+"",function(t,i){for(var r=t.length,s=[],o=0,a=e[0],u=0;r>0&&a>0&&(u+a+1>i&&(a=Math.max(1,i-u)),s.push(t.substring(r-=a,r+a)),!((u+=a+1)>i));)a=e[o=(o+1)%e.length];return s.reverse().join(n)}),r=void 0===t.currency?"":t.currency[0]+"",s=void 0===t.currency?"":t.currency[1]+"",o=void 0===t.decimal?".":t.decimal+"",a=void 0===t.numerals?_i:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(Di.call(t.numerals,String)),u=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=pi(t)).fill,n=t.align,h=t.sign,f=t.symbol,d=t.zero,p=t.width,g=t.comma,m=t.precision,y=t.trim,v=t.type;"n"===v?(g=!0,v="g"):Ai[v]||(void 0===m&&(m=12),y=!0,v="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var b="$"===f?r:"#"===f&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===f?s:/[%p]/.test(v)?u:"",w=Ai[v],A=/[defgprs%]/.test(v);function _(t){var r,s,u,f=b,_=x;if("c"===v)_=w(t)+_,t="";else{var k=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:w(Math.abs(t),m),y&&(t=function(t){t:for(var e,n=t.length,i=1,r=-1;i<n;++i)switch(t[i]){case".":r=e=i;break;case"0":0===r&&(r=i),e=i;break;default:if(!+t[i])break t;r>0&&(r=0)}return r>0?t.slice(0,r)+t.slice(e+1):t}(t)),k&&0==+t&&"+"!==h&&(k=!1),f=(k?"("===h?h:l:"-"===h||"("===h?"":h)+f,_=("s"===v?Fi[8+fi/3]:"")+_+(k&&"("===h?")":""),A)for(r=-1,s=t.length;++r<s;)if(48>(u=t.charCodeAt(r))||u>57){_=(46===u?o+t.slice(r+1):t.slice(r))+_,t=t.slice(0,r);break}}g&&!d&&(t=i(t,1/0));var C=f.length+t.length+_.length,E=C<p?new Array(p-C+1).join(e):"";switch(g&&d&&(t=i(E+t,E.length?p-_.length:1/0),E=""),n){case"<":t=f+t+_+E;break;case"=":t=f+E+t+_;break;case"^":t=E.slice(0,C=E.length>>1)+f+t+_+E.slice(C);break;default:t=E+f+t+_}return a(t)}return m=void 0===m?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),_.toString=function(){return t+""},_}return{format:h,formatPrefix:function(t,e){var n=h(((t=pi(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(yi(e)/3))),r=Math.pow(10,-i),s=Fi[8+i/3];return function(t){return n(r*t)+s}}}}ki=Si({thousands:",",grouping:[3],currency:["$",""]}),Ci=ki.format,Ei=ki.formatPrefix;var Oi=new Date,Ni=new Date;function Mi(t,e,n,i){function r(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return r.floor=function(e){return t(e=new Date(+e)),e},r.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},r.round=function(t){var e=r(t),n=r.ceil(t);return t-e<n-t?e:n},r.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},r.range=function(n,i,s){var o,a=[];if(n=r.ceil(n),s=null==s?1:Math.floor(s),!(n<i&&s>0))return a;do{a.push(o=new Date(+n)),e(n,s),t(n)}while(o<n&&n<i);return a},r.filter=function(n){return Mi((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,i){if(t>=t)if(i<0)for(;++i<=0;)for(;e(t,-1),!n(t););else for(;--i>=0;)for(;e(t,1),!n(t););}))},n&&(r.count=function(e,i){return Oi.setTime(+e),Ni.setTime(+i),t(Oi),t(Ni),Math.floor(n(Oi,Ni))},r.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?r.filter(i?function(e){return i(e)%t==0}:function(e){return r.count(0,e)%t==0}):r:null}),r}const zi=1e3,$i=6e4,Ti=36e5,Bi=864e5,ji=6048e5,Ii=31536e6;var Ri=Mi((t=>t.setHours(0,0,0,0)),((t,e)=>t.setDate(t.getDate()+e)),((t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*$i)/Bi),(t=>t.getDate()-1));const Li=Ri;function Pi(t){return Mi((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*$i)/ji}))}Ri.range;var Ui=Pi(0),qi=Pi(1),Wi=Pi(2),Hi=Pi(3),Vi=Pi(4),Gi=Pi(5),Xi=Pi(6),Yi=(Ui.range,qi.range,Wi.range,Hi.range,Vi.range,Gi.range,Xi.range,Mi((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/Bi}),(function(t){return t.getUTCDate()-1})));const Ji=Yi;function Zi(t){return Mi((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/ji}))}Yi.range;var Ki=Zi(0),Qi=Zi(1),tr=Zi(2),er=Zi(3),nr=Zi(4),ir=Zi(5),rr=Zi(6),sr=(Ki.range,Qi.range,tr.range,er.range,nr.range,ir.range,rr.range,Mi((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()})));sr.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Mi((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};const or=sr;sr.range;var ar=Mi((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()}));const ur=ar;ar.range;var lr=Mi((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*zi-t.getMinutes()*$i)}),(function(t,e){t.setTime(+t+e*Ti)}),(function(t,e){return(e-t)/Ti}),(function(t){return t.getHours()}));const cr=lr;lr.range;var hr=Mi((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*zi)}),(function(t,e){t.setTime(+t+e*$i)}),(function(t,e){return(e-t)/$i}),(function(t){return t.getMinutes()}));const fr=hr;hr.range;var dr=Mi((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+e*zi)}),(function(t,e){return(e-t)/zi}),(function(t){return t.getUTCSeconds()}));const pr=dr;dr.range;var gr=Mi((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));gr.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?Mi((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):gr:null};const mr=gr;gr.range;var yr=Mi((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));yr.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Mi((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};const vr=yr;yr.range;var br=Mi((function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCMonth(t.getUTCMonth()+e)}),(function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())}),(function(t){return t.getUTCMonth()}));const xr=br;br.range;var wr=Mi((function(t){t.setUTCMinutes(0,0,0)}),(function(t,e){t.setTime(+t+e*Ti)}),(function(t,e){return(e-t)/Ti}),(function(t){return t.getUTCHours()}));const Ar=wr;wr.range;var _r=Mi((function(t){t.setUTCSeconds(0,0)}),(function(t,e){t.setTime(+t+e*$i)}),(function(t,e){return(e-t)/$i}),(function(t){return t.getUTCMinutes()}));const kr=_r;function Cr(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Er(t){let e=t,n=t;function i(t,e,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){const s=i+r>>>1;n(t[s],e)<0?i=s+1:r=s}return i}return 1===t.length&&(e=(e,n)=>t(e)-n,n=function(t){return(e,n)=>Cr(t(e),n)}(t)),{left:i,center:function(t,n,r,s){null==r&&(r=0),null==s&&(s=t.length);const o=i(t,n,r,s-1);return o>r&&e(t[o-1],n)>-e(t[o],n)?o-1:o},right:function(t,e,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){const s=i+r>>>1;n(t[s],e)>0?r=s:i=s+1}return i}}}_r.range;const Dr="year",Fr="quarter",Sr="month",Or="week",Nr="date",Mr="day",zr="dayofyear",$r="hours",Tr="minutes",Br="seconds",jr="milliseconds",Ir=[Dr,Fr,Sr,Or,Nr,Mr,zr,$r,Tr,Br,jr],Rr=Ir.reduce(((t,e,n)=>(t[e]=1+n,t)),{});function Lr(t){const e=mn(t).slice(),n={};return e.length||Le("Missing time unit."),e.forEach((t=>{Fn(Rr,t)?n[t]=1:Le("Invalid time unit: ".concat(t,"."))})),(n[Or]||n[Mr]?1:0)+(n[Fr]||n[Sr]||n[Nr]?1:0)+(n[zr]?1:0)>1&&Le("Incompatible time units: ".concat(t)),e.sort(((t,e)=>Rr[t]-Rr[e])),e}const Pr={[Dr]:"%Y ",[Fr]:"Q%q ",[Sr]:"%b ",[Nr]:"%d ",[Or]:"W%U ",[Mr]:"%a ",[zr]:"%j ",[$r]:"%H:00",[Tr]:"00:%M",[Br]:":%S",[jr]:".%L",["".concat(Dr,"-").concat(Sr)]:"%Y-%m ",["".concat(Dr,"-").concat(Sr,"-").concat(Nr)]:"%Y-%m-%d ",["".concat($r,"-").concat(Tr)]:"%H:%M"};function Ur(t,e){const n=Cn({},Pr,e),i=Lr(t),r=i.length;let s,o,a="",u=0;for(u=0;u<r;)for(s=i.length;s>u;--s)if(o=i.slice(u,s).join("-"),null!=n[o]){a+=n[o],u=s;break}return a.trim()}const qr=new Date;function Wr(t){return qr.setFullYear(t),qr.setMonth(0),qr.setDate(1),qr.setHours(0,0,0,0),qr}function Hr(t){return Gr(new Date(t))}function Vr(t){return Xr(new Date(t))}function Gr(t){return Li.count(Wr(t.getFullYear())-1,t)}function Xr(t){return Ui.count(Wr(t.getFullYear())-1,t)}function Yr(t){return Wr(t).getDay()}function Jr(t,e,n,i,r,s,o){if(0<=t&&t<100){const a=new Date(-1,e,n,i,r,s,o);return a.setFullYear(t),a}return new Date(t,e,n,i,r,s,o)}function Zr(t){return Qr(new Date(t))}function Kr(t){return ts(new Date(t))}function Qr(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return Ji.count(e-1,t)}function ts(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return Ki.count(e-1,t)}function es(t){return qr.setTime(Date.UTC(t,0,1)),qr.getUTCDay()}function ns(t,e,n,i,r,s,o){if(0<=t&&t<100){const t=new Date(Date.UTC(-1,e,n,i,r,s,o));return t.setUTCFullYear(n.y),t}return new Date(Date.UTC(t,e,n,i,r,s,o))}function is(t,e,n,i,r){const s=e||1,o=nn(t),a=(t,e,r)=>function(t,e,n,i){const r=n<=1?t:i?(e,r)=>i+n*Math.floor((t(e,r)-i)/n):(e,i)=>n*Math.floor(t(e,i)/n);return e?(t,n)=>e(r(t,n),n):r}(n[r=r||t],i[r],t===o&&s,e),u=new Date,l=Wn(t),c=l[Dr]?a(Dr):_n(2012),h=l[Sr]?a(Sr):l[Fr]?a(Fr):He,f=l[Or]&&l[Mr]?a(Mr,1,Or+Mr):l[Or]?a(Or,1):l[Mr]?a(Mr,1):l[Nr]?a(Nr,1):l[zr]?a(zr,1):Ve,d=l[$r]?a($r):He,p=l[Tr]?a(Tr):He,g=l[Br]?a(Br):He,m=l[jr]?a(jr):He;return function(t){u.setTime(+t);const e=c(u);return r(e,h(u),f(u,e),d(u),p(u),g(u),m(u))}}function rs(t,e,n){return e+7*t-(n+6)%7}const ss={[Dr]:t=>t.getFullYear(),[Fr]:t=>Math.floor(t.getMonth()/3),[Sr]:t=>t.getMonth(),[Nr]:t=>t.getDate(),[$r]:t=>t.getHours(),[Tr]:t=>t.getMinutes(),[Br]:t=>t.getSeconds(),[jr]:t=>t.getMilliseconds(),[zr]:t=>Gr(t),[Or]:t=>Xr(t),[Or+Mr]:(t,e)=>rs(Xr(t),t.getDay(),Yr(e)),[Mr]:(t,e)=>rs(1,t.getDay(),Yr(e))},os={[Fr]:t=>3*t,[Or]:(t,e)=>rs(t,0,Yr(e))};function as(t,e){return is(t,e||1,ss,os,Jr)}const us={[Dr]:t=>t.getUTCFullYear(),[Fr]:t=>Math.floor(t.getUTCMonth()/3),[Sr]:t=>t.getUTCMonth(),[Nr]:t=>t.getUTCDate(),[$r]:t=>t.getUTCHours(),[Tr]:t=>t.getUTCMinutes(),[Br]:t=>t.getUTCSeconds(),[jr]:t=>t.getUTCMilliseconds(),[zr]:t=>Qr(t),[Or]:t=>ts(t),[Mr]:(t,e)=>rs(1,t.getUTCDay(),es(e)),[Or+Mr]:(t,e)=>rs(ts(t),t.getUTCDay(),es(e))},ls={[Fr]:t=>3*t,[Or]:(t,e)=>rs(t,0,es(e))};function cs(t,e){return is(t,e||1,us,ls,ns)}const hs={[Dr]:or,[Fr]:ur.every(3),[Sr]:ur,[Or]:Ui,[Nr]:Li,[Mr]:Li,[zr]:Li,[$r]:cr,[Tr]:fr,[Br]:pr,[jr]:mr},fs={[Dr]:vr,[Fr]:xr.every(3),[Sr]:xr,[Or]:Ki,[Nr]:Ji,[Mr]:Ji,[zr]:Ji,[$r]:Ar,[Tr]:kr,[Br]:pr,[jr]:mr};function ds(t){return hs[t]}function ps(t){return fs[t]}function gs(t,e,n){return t?t.offset(e,n):void 0}function ms(t,e,n){return gs(ds(t),e,n)}function ys(t,e,n){return gs(ps(t),e,n)}function vs(t,e,n,i){return t?t.range(e,n,i):void 0}function bs(t,e,n,i){return vs(ds(t),e,n,i)}function xs(t,e,n,i){return vs(ps(t),e,n,i)}const ws=31536e6,As=[Dr,Sr,Nr,$r,Tr,Br,jr],_s=As.slice(0,-1),ks=_s.slice(0,-1),Cs=ks.slice(0,-1),Es=Cs.slice(0,-1),Ds=[Dr,Sr],Fs=[Dr],Ss=[[_s,1,1e3],[_s,5,5e3],[_s,15,15e3],[_s,30,3e4],[ks,1,6e4],[ks,5,3e5],[ks,15,9e5],[ks,30,18e5],[Cs,1,36e5],[Cs,3,108e5],[Cs,6,216e5],[Cs,12,432e5],[Es,1,864e5],[[Dr,Or],1,6048e5],[Ds,1,2592e6],[Ds,3,7776e6],[Fs,1,ws]];function Os(t){const e=t.extent,n=t.maxbins||40,i=Math.abs(In(e))/n;let r,s,o=Er((t=>t[2])).right(Ss,i);return o===Ss.length?(r=Fs,s=hi(e[0]/ws,e[1]/ws,n)):o?(o=Ss[i/Ss[o-1][2]<Ss[o][2]/i?o-1:o],r=o[0],s=o[1]):(r=As,s=Math.max(hi(e[0],e[1],n),1)),{units:r,step:s}}function Ns(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Ms(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function zs(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function $s(t){var e=t.dateTime,n=t.date,i=t.time,r=t.periods,s=t.days,o=t.shortDays,a=t.months,u=t.shortMonths,l=Vs(r),c=Gs(r),h=Vs(s),f=Gs(s),d=Vs(o),p=Gs(o),g=Vs(a),m=Gs(a),y=Vs(u),v=Gs(u),b={a:function(t){return o[t.getDay()]},A:function(t){return s[t.getDay()]},b:function(t){return u[t.getMonth()]},B:function(t){return a[t.getMonth()]},c:null,d:go,e:go,f:xo,g:No,G:zo,H:mo,I:yo,j:vo,L:bo,m:wo,M:Ao,p:function(t){return r[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:na,s:ia,S:_o,u:ko,U:Co,V:Do,w:Fo,W:So,x:null,X:null,y:Oo,Y:Mo,Z:$o,"%":ea},x={a:function(t){return o[t.getUTCDay()]},A:function(t){return s[t.getUTCDay()]},b:function(t){return u[t.getUTCMonth()]},B:function(t){return a[t.getUTCMonth()]},c:null,d:To,e:To,f:Lo,g:Zo,G:Qo,H:Bo,I:jo,j:Io,L:Ro,m:Po,M:Uo,p:function(t){return r[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:na,s:ia,S:qo,u:Wo,U:Ho,V:Go,w:Xo,W:Yo,x:null,X:null,y:Jo,Y:Ko,Z:ta,"%":ea},w={a:function(t,e,n){var i=d.exec(e.slice(n));return i?(t.w=p.get(i[0].toLowerCase()),n+i[0].length):-1},A:function(t,e,n){var i=h.exec(e.slice(n));return i?(t.w=f.get(i[0].toLowerCase()),n+i[0].length):-1},b:function(t,e,n){var i=y.exec(e.slice(n));return i?(t.m=v.get(i[0].toLowerCase()),n+i[0].length):-1},B:function(t,e,n){var i=g.exec(e.slice(n));return i?(t.m=m.get(i[0].toLowerCase()),n+i[0].length):-1},c:function(t,n,i){return k(t,e,n,i)},d:ro,e:ro,f:co,g:to,G:Qs,H:oo,I:oo,j:so,L:lo,m:io,M:ao,p:function(t,e,n){var i=l.exec(e.slice(n));return i?(t.p=c.get(i[0].toLowerCase()),n+i[0].length):-1},q:no,Q:fo,s:po,S:uo,u:Ys,U:Js,V:Zs,w:Xs,W:Ks,x:function(t,e,i){return k(t,n,e,i)},X:function(t,e,n){return k(t,i,e,n)},y:to,Y:Qs,Z:eo,"%":ho};function A(t,e){return function(n){var i,r,s,o=[],a=-1,u=0,l=t.length;for(n instanceof Date||(n=new Date(+n));++a<l;)37===t.charCodeAt(a)&&(o.push(t.slice(u,a)),null!=(r=Ls[i=t.charAt(++a)])?i=t.charAt(++a):r="e"===i?" ":"0",(s=e[i])&&(i=s(n,r)),o.push(i),u=a+1);return o.push(t.slice(u,a)),o.join("")}}function _(t,e){return function(n){var i,r,s=zs(1900,void 0,1);if(k(s,t,n+="",0)!=n.length)return null;if("Q"in s)return new Date(s.Q);if("s"in s)return new Date(1e3*s.s+("L"in s?s.L:0));if(e&&!("Z"in s)&&(s.Z=0),"p"in s&&(s.H=s.H%12+12*s.p),void 0===s.m&&(s.m="q"in s?s.q:0),"V"in s){if(s.V<1||s.V>53)return null;"w"in s||(s.w=1),"Z"in s?(r=(i=Ms(zs(s.y,0,1))).getUTCDay(),i=r>4||0===r?Qi.ceil(i):Qi(i),i=Ji.offset(i,7*(s.V-1)),s.y=i.getUTCFullYear(),s.m=i.getUTCMonth(),s.d=i.getUTCDate()+(s.w+6)%7):(r=(i=Ns(zs(s.y,0,1))).getDay(),i=r>4||0===r?qi.ceil(i):qi(i),i=Li.offset(i,7*(s.V-1)),s.y=i.getFullYear(),s.m=i.getMonth(),s.d=i.getDate()+(s.w+6)%7)}else("W"in s||"U"in s)&&("w"in s||(s.w="u"in s?s.u%7:"W"in s?1:0),r="Z"in s?Ms(zs(s.y,0,1)).getUTCDay():Ns(zs(s.y,0,1)).getDay(),s.m=0,s.d="W"in s?(s.w+6)%7+7*s.W-(r+5)%7:s.w+7*s.U-(r+6)%7);return"Z"in s?(s.H+=s.Z/100|0,s.M+=s.Z%100,Ms(s)):Ns(s)}}function k(t,e,n,i){for(var r,s,o=0,a=e.length,u=n.length;o<a;){if(i>=u)return-1;if(37===(r=e.charCodeAt(o++))){if(r=e.charAt(o++),!(s=w[r in Ls?e.charAt(o++):r])||(i=s(t,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}return b.x=A(n,b),b.X=A(i,b),b.c=A(e,b),x.x=A(n,x),x.X=A(i,x),x.c=A(e,x),{format:function(t){var e=A(t+="",b);return e.toString=function(){return t},e},parse:function(t){var e=_(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=A(t+="",x);return e.toString=function(){return t},e},utcParse:function(t){var e=_(t+="",!0);return e.toString=function(){return t},e}}}var Ts,Bs,js,Is,Rs,Ls={"-":"",_:" ",0:"0"},Ps=/^\s*\d+/,Us=/^%/,qs=/[\\^$*+?|[\]().{}]/g;function Ws(t,e,n){var i=t<0?"-":"",r=(i?-t:t)+"",s=r.length;return i+(s<n?new Array(n-s+1).join(e)+r:r)}function Hs(t){return t.replace(qs,"\\$&")}function Vs(t){return new RegExp("^(?:"+t.map(Hs).join("|")+")","i")}function Gs(t){return new Map(t.map(((t,e)=>[t.toLowerCase(),e])))}function Xs(t,e,n){var i=Ps.exec(e.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function Ys(t,e,n){var i=Ps.exec(e.slice(n,n+1));return i?(t.u=+i[0],n+i[0].length):-1}function Js(t,e,n){var i=Ps.exec(e.slice(n,n+2));return i?(t.U=+i[0],n+i[0].length):-1}function Zs(t,e,n){var i=Ps.exec(e.slice(n,n+2));return i?(t.V=+i[0],n+i[0].length):-1}function Ks(t,e,n){var i=Ps.exec(e.slice(n,n+2));return i?(t.W=+i[0],n+i[0].length):-1}function Qs(t,e,n){var i=Ps.exec(e.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function to(t,e,n){var i=Ps.exec(e.slice(n,n+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function eo(t,e,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function no(t,e,n){var i=Ps.exec(e.slice(n,n+1));return i?(t.q=3*i[0]-3,n+i[0].length):-1}function io(t,e,n){var i=Ps.exec(e.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function ro(t,e,n){var i=Ps.exec(e.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function so(t,e,n){var i=Ps.exec(e.slice(n,n+3));return i?(t.m=0,t.d=+i[0],n+i[0].length):-1}function oo(t,e,n){var i=Ps.exec(e.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function ao(t,e,n){var i=Ps.exec(e.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function uo(t,e,n){var i=Ps.exec(e.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function lo(t,e,n){var i=Ps.exec(e.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function co(t,e,n){var i=Ps.exec(e.slice(n,n+6));return i?(t.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function ho(t,e,n){var i=Us.exec(e.slice(n,n+1));return i?n+i[0].length:-1}function fo(t,e,n){var i=Ps.exec(e.slice(n));return i?(t.Q=+i[0],n+i[0].length):-1}function po(t,e,n){var i=Ps.exec(e.slice(n));return i?(t.s=+i[0],n+i[0].length):-1}function go(t,e){return Ws(t.getDate(),e,2)}function mo(t,e){return Ws(t.getHours(),e,2)}function yo(t,e){return Ws(t.getHours()%12||12,e,2)}function vo(t,e){return Ws(1+Li.count(or(t),t),e,3)}function bo(t,e){return Ws(t.getMilliseconds(),e,3)}function xo(t,e){return bo(t,e)+"000"}function wo(t,e){return Ws(t.getMonth()+1,e,2)}function Ao(t,e){return Ws(t.getMinutes(),e,2)}function _o(t,e){return Ws(t.getSeconds(),e,2)}function ko(t){var e=t.getDay();return 0===e?7:e}function Co(t,e){return Ws(Ui.count(or(t)-1,t),e,2)}function Eo(t){var e=t.getDay();return e>=4||0===e?Vi(t):Vi.ceil(t)}function Do(t,e){return t=Eo(t),Ws(Vi.count(or(t),t)+(4===or(t).getDay()),e,2)}function Fo(t){return t.getDay()}function So(t,e){return Ws(qi.count(or(t)-1,t),e,2)}function Oo(t,e){return Ws(t.getFullYear()%100,e,2)}function No(t,e){return Ws((t=Eo(t)).getFullYear()%100,e,2)}function Mo(t,e){return Ws(t.getFullYear()%1e4,e,4)}function zo(t,e){var n=t.getDay();return Ws((t=n>=4||0===n?Vi(t):Vi.ceil(t)).getFullYear()%1e4,e,4)}function $o(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Ws(e/60|0,"0",2)+Ws(e%60,"0",2)}function To(t,e){return Ws(t.getUTCDate(),e,2)}function Bo(t,e){return Ws(t.getUTCHours(),e,2)}function jo(t,e){return Ws(t.getUTCHours()%12||12,e,2)}function Io(t,e){return Ws(1+Ji.count(vr(t),t),e,3)}function Ro(t,e){return Ws(t.getUTCMilliseconds(),e,3)}function Lo(t,e){return Ro(t,e)+"000"}function Po(t,e){return Ws(t.getUTCMonth()+1,e,2)}function Uo(t,e){return Ws(t.getUTCMinutes(),e,2)}function qo(t,e){return Ws(t.getUTCSeconds(),e,2)}function Wo(t){var e=t.getUTCDay();return 0===e?7:e}function Ho(t,e){return Ws(Ki.count(vr(t)-1,t),e,2)}function Vo(t){var e=t.getUTCDay();return e>=4||0===e?nr(t):nr.ceil(t)}function Go(t,e){return t=Vo(t),Ws(nr.count(vr(t),t)+(4===vr(t).getUTCDay()),e,2)}function Xo(t){return t.getUTCDay()}function Yo(t,e){return Ws(Qi.count(vr(t)-1,t),e,2)}function Jo(t,e){return Ws(t.getUTCFullYear()%100,e,2)}function Zo(t,e){return Ws((t=Vo(t)).getUTCFullYear()%100,e,2)}function Ko(t,e){return Ws(t.getUTCFullYear()%1e4,e,4)}function Qo(t,e){var n=t.getUTCDay();return Ws((t=n>=4||0===n?nr(t):nr.ceil(t)).getUTCFullYear()%1e4,e,4)}function ta(){return"+0000"}function ea(){return"%"}function na(t){return+t}function ia(t){return Math.floor(+t/1e3)}function ra(t){const e={};return n=>e[n]||(e[n]=t(n))}function sa(t){const e=ra(t.format),n=t.formatPrefix;return{format:e,formatPrefix:n,formatFloat(t){const n=pi(t||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return function(t,e){return n=>{const i=t(n),r=i.indexOf(e);if(r<0)return i;let s=function(t,e){let n,i=t.lastIndexOf("e");if(i>0)return i;for(i=t.length;--i>e;)if(n=t.charCodeAt(i),n>=48&&n<=57)return i+1}(i,r);const o=s<i.length?i.slice(s):"";for(;--s>r;)if("0"!==i[s]){++s;break}return i.slice(0,s)+o}}(e(n),e(".1f")(1)[1])}return e(n)},formatSpan(t,i,r,s){s=pi(null==s?",f":s);const o=hi(t,i,r),a=Math.max(Math.abs(t),Math.abs(i));let u;if(null==s.precision)switch(s.type){case"s":return isNaN(u=vi(o,a))||(s.precision=u),n(s,a);case"":case"e":case"g":case"p":case"r":isNaN(u=bi(o,a))||(s.precision=u-("e"===s.type));break;case"f":case"%":isNaN(u=xi(o))||(s.precision=u-2*("%"===s.type))}return e(s)}}}let oa,aa;function ua(){return oa=sa({format:Ci,formatPrefix:Ei})}function la(t){return sa(Si(t))}function ca(t){return arguments.length?oa=la(t):oa}function ha(t,e,n){Ke(n=n||{})||Le("Invalid time multi-format specifier: ".concat(n));const i=e(Br),r=e(Tr),s=e($r),o=e(Nr),a=e(Or),u=e(Sr),l=e(Fr),c=e(Dr),h=t(n[jr]||".%L"),f=t(n[Br]||":%S"),d=t(n[Tr]||"%I:%M"),p=t(n[$r]||"%I %p"),g=t(n[Nr]||n[Mr]||"%a %d"),m=t(n[Or]||"%b %d"),y=t(n[Sr]||"%B"),v=t(n[Fr]||"%B"),b=t(n[Dr]||"%Y");return t=>(i(t)<t?h:r(t)<t?f:s(t)<t?d:o(t)<t?p:u(t)<t?a(t)<t?g:m:c(t)<t?l(t)<t?y:v:b)(t)}function fa(t){const e=ra(t.format),n=ra(t.utcFormat);return{timeFormat:t=>Tn(t)?e(t):ha(e,ds,t),utcFormat:t=>Tn(t)?n(t):ha(n,ps,t),timeParse:ra(t.parse),utcParse:ra(t.utcParse)}}function da(){return aa=fa({format:Bs,parse:js,utcFormat:Is,utcParse:Rs})}function pa(t){return fa($s(t))}function ga(t){return arguments.length?aa=pa(t):aa}Ts=$s({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),Bs=Ts.format,js=Ts.parse,Is=Ts.utcFormat,Rs=Ts.utcParse,ua(),da();const ma=(t,e)=>Cn({},t,e);function ya(t,e){const n=t?la(t):ca(),i=e?pa(e):ga();return ma(n,i)}function va(t,e){const n=arguments.length;return n&&2!==n&&Le("defaultLocale expects either zero or two arguments."),n?ma(ca(t),ga(e)):ma(ca(),ga())}function ba(){return ua(),da(),va()}var xa=n(8834).Buffer;const wa=/^(data:|([A-Za-z]+:)?\/\/)/,Aa=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,_a=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,ka="file://";async function Ca(t,e){const n=await this.sanitize(t,e),i=n.href;return n.localFile?this.file(i):this.http(i,e)}async function Ea(t,e){e=Cn({},this.options,e);const n=this.fileAccess,i={href:null};let r,s,o;const a=Aa.test(t.replace(_a,""));null!=t&&"string"==typeof t&&a||Le("Sanitize failure, invalid URI: "+Rn(t));const u=wa.test(t);return(o=e.baseURL)&&!u&&(t.startsWith("/")||o.endsWith("/")||(t="/"+t),t=o+t),s=(r=t.startsWith(ka))||"file"===e.mode||"http"!==e.mode&&!u&&n,r?t=t.slice(ka.length):t.startsWith("//")&&("file"===e.defaultProtocol?(t=t.slice(2),s=!0):t=(e.defaultProtocol||"http")+":"+t),Object.defineProperty(i,"localFile",{value:!!s}),i.href=t,e.target&&(i.target=e.target+""),e.rel&&(i.rel=e.rel+""),"image"===e.context&&e.crossOrigin&&(i.crossOrigin=e.crossOrigin+""),i}function Da(t){return t?e=>new Promise(((n,i)=>{t.readFile(e,((t,e)=>{t?i(t):n(e)}))})):Fa}async function Fa(){Le("No file system access.")}function Sa(t){return t?async function(e,n){const i=Cn({},this.options.http,n),r=n&&n.response,s=await t(e,i);return s.ok?yn(s[r])?s[r]():s.text():Le(s.status+""+s.statusText)}:Oa}async function Oa(){Le("No HTTP fetch method available.")}const Na=t=>!(Number.isNaN(+t)||t instanceof Date),Ma={boolean:Ln,integer:rn,number:rn,date:Un,string:qn,unknown:We},za=[t=>"true"===t||"false"===t||!0===t||!1===t,t=>Na(t)&&Number.isInteger(+t),Na,t=>!Number.isNaN(Date.parse(t))],$a=["boolean","integer","number","date"];function Ta(t,e){if(!t||!t.length)return"unknown";const n=t.length,i=za.length,r=za.map(((t,e)=>e+1));for(let o,a,u=0,l=0;u<n;++u)for(a=e?t[u][e]:t[u],o=0;o<i;++o)if(r[o]&&null!=(s=a)&&s==s&&!za[o](a)&&(r[o]=0,++l,l===za.length))return"string";var s;return $a[r.reduce(((t,e)=>0===t?e:t),0)-1]}function Ba(t,e){return e.reduce(((e,n)=>(e[n]=Ta(t,n),e)),{})}function ja(t){const e=function(e,n){const i={delimiter:t};return Ia(e,n?Cn(n,i):i)};return e.responseType="text",e}function Ia(t,e){return e.header&&(t=e.header.map(Rn).join(e.delimiter)+"\n"+t),Zn(e.delimiter).parse(t+"")}function Ra(t,e){const n=e&&e.property?Ue(e.property):We;return!Ke(t)||(i=t,"function"==typeof xa&&yn(xa.isBuffer)&&xa.isBuffer(i))?n(JSON.parse(t)):function(t,e){return!Ze(t)&&function(t){return t&&yn(t[Symbol.iterator])}(t)&&(t=[...t]),e&&e.copy?JSON.parse(JSON.stringify(t)):t}(n(t),e);var i}Ia.responseType="text",Ra.responseType="json";const La={interior:(t,e)=>t!==e,exterior:(t,e)=>t===e};function Pa(t,e){let n,i,r,s;return t=Ra(t,e),e&&e.feature?(n=Qn,r=e.feature):e&&e.mesh?(n=ii,r=e.mesh,s=La[e.filter]):Le("Missing TopoJSON feature or mesh parameter."),i=(i=t.objects[r])?n(t,i,s):Le("Invalid TopoJSON object: "+r),i&&i.features||[i]}Pa.responseType="json";const Ua={dsv:Ia,csv:ja(","),tsv:ja("\t"),json:Ra,topojson:Pa};function qa(t,e){return arguments.length>1?(Ua[t]=e,this):Fn(Ua,t)?Ua[t]:null}function Wa(t){const e=qa(t);return e&&e.responseType||"text"}function Ha(t,e,n,i){const r=qa((e=e||{}).type||"json");return r||Le("Unknown data format type: "+e.type),t=r(t,e),e.parse&&function(t,e,n,i){if(!t.length)return;const r=ga();n=n||r.timeParse,i=i||r.utcParse;let s,o,a,u,l,c,h=t.columns||Object.keys(t[0]);"auto"===e&&(e=Ba(t,h)),h=Object.keys(e);const f=h.map((t=>{const r=e[t];let s,o;if(r&&(r.startsWith("date:")||r.startsWith("utc:")))return s=r.split(/:(.+)?/,2),o=s[1],("'"===o[0]&&"'"===o[o.length-1]||'"'===o[0]&&'"'===o[o.length-1])&&(o=o.slice(1,-1)),("utc"===s[0]?i:n)(o);if(!Ma[r])throw Error("Illegal format pattern: "+t+":"+r);return Ma[r]}));for(a=0,l=t.length,c=h.length;a<l;++a)for(s=t[a],u=0;u<c;++u)o=h[u],s[o]=f[u](s[o])}(t,e.parse,n,i),Fn(t,"columns")&&delete t.columns,t}const Va=function(t,e){return e=>({options:e||{},sanitize:Ea,load:Ca,fileAccess:!1,file:Da(null),http:Sa(t)})}("undefined"!=typeof fetch&&fetch);function Ga(t){const e=t||We,n=[],i={};return n.add=t=>{const r=e(t);return i[r]||(i[r]=1,n.push(t)),n},n.remove=t=>{const r=e(t);if(i[r]){i[r]=0;const e=n.indexOf(t);e>=0&&n.splice(e,1)}return n},n}async function Xa(t,e){try{await e(t)}catch(e){t.error(e)}}const Ya=Symbol("vega_id");let Ja=1;function Za(t){return!(!t||!Ka(t))}function Ka(t){return t[Ya]}function Qa(t,e){return t[Ya]=e,t}function tu(t){const e=t===Object(t)?t:{data:t};return Ka(e)?e:Qa(e,Ja++)}function eu(t){return nu(t,tu({}))}function nu(t,e){for(const n in t)e[n]=t[n];return e}function iu(t,e){return Qa(e,Ka(t))}function ru(t,e){return t?e?(n,i)=>t(n,i)||Ka(e(n))-Ka(e(i)):(e,n)=>t(e,n)||Ka(e)-Ka(n):null}function su(t){return t&&t.constructor===ou}function ou(){const t=[],e=[],n=[],i=[],r=[];let s=null,o=!1;return{constructor:ou,insert(e){const n=mn(e),i=n.length;for(let e=0;e<i;++e)t.push(n[e]);return this},remove(t){const n=yn(t)?i:e,r=mn(t),s=r.length;for(let t=0;t<s;++t)n.push(r[t]);return this},modify(t,e,i){const s={field:e,value:_n(i)};return yn(t)?(s.filter=t,r.push(s)):(s.tuple=t,n.push(s)),this},encode(t,e){return yn(t)?r.push({filter:t,field:e}):n.push({tuple:t,field:e}),this},clean(t){return s=t,this},reflow(){return o=!0,this},pulse(a,u){const l={},c={};let h,f,d,p,g,m;for(h=0,f=u.length;h<f;++h)l[Ka(u[h])]=1;for(h=0,f=e.length;h<f;++h)g=e[h],l[Ka(g)]=-1;for(h=0,f=i.length;h<f;++h)p=i[h],u.forEach((t=>{p(t)&&(l[Ka(t)]=-1)}));for(h=0,f=t.length;h<f;++h)g=t[h],m=Ka(g),l[m]?l[m]=1:a.add.push(tu(t[h]));for(h=0,f=u.length;h<f;++h)g=u[h],l[Ka(g)]<0&&a.rem.push(g);function y(t,e,n){n?t[e]=n(t):a.encode=e,o||(c[Ka(t)]=t)}for(h=0,f=n.length;h<f;++h)d=n[h],g=d.tuple,p=d.field,m=l[Ka(g)],m>0&&(y(g,p,d.value),a.modifies(p));for(h=0,f=r.length;h<f;++h)d=r[h],p=d.filter,u.forEach((t=>{p(t)&&l[Ka(t)]>0&&y(t,d.field,d.value)})),a.modifies(d.field);if(o)a.mod=e.length||i.length?u.filter((t=>l[Ka(t)]>0)):u.slice();else for(m in c)a.mod.push(c[m]);return(s||null==s&&(e.length||i.length))&&a.clean(!0),a}}}const au="_:mod:_";function uu(){Object.defineProperty(this,au,{writable:!0,value:{}})}uu.prototype={set(t,e,n,i){const r=this,s=r[t],o=r[au];return null!=e&&e>=0?(s[e]!==n||i)&&(s[e]=n,o[e+":"+t]=-1,o[t]=-1):(s!==n||i)&&(r[t]=n,o[t]=Ze(n)?1+n.length:-1),r},modified(t,e){const n=this[au];if(!arguments.length){for(const t in n)if(n[t])return!0;return!1}if(Ze(t)){for(let e=0;e<t.length;++e)if(n[t[e]])return!0;return!1}return null!=e&&e>=0?e+1<n[t]||!!n[e+":"+t]:!!n[t]},clear(){return this[au]={},this}};let lu=0;const cu=new uu;function hu(t,e,n,i){this.id=++lu,this.value=t,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,e&&(this._update=e),n&&this.parameters(n,i)}function fu(t){return function(e){const n=this.flags;return 0===arguments.length?!!(n&t):(this.flags=e?n|t:n&~t,this)}}hu.prototype={targets(){return this._targets||(this._targets=Ga(qe))},set(t){return this.value!==t?(this.value=t,1):0},skip:fu(1),modified:fu(2),parameters(t,e,n){e=!1!==e;const i=this._argval=this._argval||new uu,r=this._argops=this._argops||[],s=[];let o,a,u,l;const c=(t,n,o)=>{o instanceof hu?(o!==this&&(e&&o.targets().add(this),s.push(o)),r.push({op:o,name:t,index:n})):i.set(t,n,o)};for(o in t)if(a=t[o],"pulse"===o)mn(a).forEach((t=>{t instanceof hu?t!==this&&(t.targets().add(this),s.push(t)):Le("Pulse parameters must be operator instances.")})),this.source=a;else if(Ze(a))for(i.set(o,-1,Array(u=a.length)),l=0;l<u;++l)c(o,l,a[l]);else c(o,-1,a);return this.marshall().clear(),n&&(r.initonly=!0),s},marshall(t){const e=this._argval||cu,n=this._argops;let i,r,s,o;if(n){const a=n.length;for(r=0;r<a;++r)i=n[r],s=i.op,o=s.modified()&&s.stamp===t,e.set(i.name,i.index,s.value,o);if(n.initonly){for(r=0;r<a;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return e},detach(){const t=this._argops;let e,n,i,r;if(t)for(e=0,n=t.length;e<n;++e)i=t[e],r=i.op,r._targets&&r._targets.remove(this);this.pulse=null,this.source=null},evaluate(t){const e=this._update;if(e){const n=this.marshall(t.stamp),i=e.call(this,n,t);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return t.StopPropagation}},run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?(this.skip(!1),e=0):e=this.evaluate(t),this.pulse=e||t}};let du=0;function pu(t,e,n){this.id=++du,this.value=null,n&&(this.receive=n),t&&(this._filter=t),e&&(this._apply=e)}function gu(t,e,n){return new pu(t,e,n)}pu.prototype={_filter:Ge,_apply:We,targets(){return this._targets||(this._targets=Ga(qe))},consume(t){return arguments.length?(this._consume=!!t,this):!!this._consume},receive(t){if(this._filter(t)){const e=this.value=this._apply(t),n=this._targets,i=n?n.length:0;for(let t=0;t<i;++t)n[t].receive(e);this._consume&&(t.preventDefault(),t.stopPropagation())}},filter(t){const e=gu(t);return this.targets().add(e),e},apply(t){const e=gu(null,t);return this.targets().add(e),e},merge(){const t=gu();this.targets().add(t);for(let e=0,n=arguments.length;e<n;++e)arguments[e].targets().add(t);return t},throttle(t){let e=-1;return this.filter((()=>{const n=Date.now();return n-e>t?(e=n,1):0}))},debounce(t){const e=gu();return this.targets().add(gu(null,null,kn(t,(t=>{const n=t.dataflow;e.receive(t),n&&n.run&&n.run()})))),e},between(t,e){let n=!1;return t.targets().add(gu(null,null,(()=>n=!0))),e.targets().add(gu(null,null,(()=>n=!1))),this.filter((()=>n))},detach(){this._filter=Ge,this._targets=null}};const mu={skip:!0};function yu(t,e,n,i,r,s){const o=Cn({},s,mu);let a,u;yn(n)||(n=_n(n)),void 0===i?a=e=>t.touch(n(e)):yn(i)?(u=new hu(null,i,r,!1),a=e=>{u.evaluate(e);const i=n(e),r=u.value;su(r)?t.pulse(i,r,s):t.update(i,r,o)}):a=e=>t.update(n(e),i,o),e.apply(a)}function vu(t,e,n,i,r,s){if(void 0===i)e.targets().add(n);else{const o=s||{},a=new hu(null,function(t,e){return e=yn(e)?e:_n(e),t?function(n,i){const r=e(n,i);return t.skip()||(t.skip(r!==this.value).value=r),r}:e}(n,i),r,!1);a.modified(o.force),a.rank=e.rank,e.targets().add(a),n&&(a.skip(!0),a.value=n.value,a.targets().add(n),t.connect(n,[a]))}}const bu={};function xu(t,e,n){this.dataflow=t,this.stamp=null==e?-1:e,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function wu(t,e){const n=[];return Hn(t,e,(t=>n.push(t))),n}function Au(t,e){const n={};return t.visit(e,(t=>{n[Ka(t)]=1})),t=>n[Ka(t)]?null:t}function _u(t,e){return t?(n,i)=>t(n,i)&&e(n,i):e}function ku(t,e,n,i){const r=this,s=n.length;let o=0;this.dataflow=t,this.stamp=e,this.fields=null,this.encode=i||null,this.pulses=n;for(let t=0;t<s;++t){const i=n[t];if(i.stamp===e){if(i.fields){const t=r.fields||(r.fields={});for(const e in i.fields)t[e]=1}i.changed(r.ADD)&&(o|=r.ADD),i.changed(r.REM)&&(o|=r.REM),i.changed(r.MOD)&&(o|=r.MOD)}}this.changes=o}function Cu(t){return t.error("Dataflow already running. Use runAsync() to chain invocations."),t}xu.prototype={StopPropagation:bu,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(t){return new xu(this.dataflow).init(this,t)},clone(){const t=this.fork(7);return t.add=t.add.slice(),t.rem=t.rem.slice(),t.mod=t.mod.slice(),t.source&&(t.source=t.source.slice()),t.materialize(23)},addAll(){let t=this;return!t.source||t.add===t.rem||!t.rem.length&&t.source.length===t.add.length||(t=new xu(this.dataflow).init(this),t.add=t.source,t.rem=[]),t},init(t,e){const n=this;return n.stamp=t.stamp,n.encode=t.encode,!t.fields||64&e||(n.fields=t.fields),1&e?(n.addF=t.addF,n.add=t.add):(n.addF=null,n.add=[]),2&e?(n.remF=t.remF,n.rem=t.rem):(n.remF=null,n.rem=[]),4&e?(n.modF=t.modF,n.mod=t.mod):(n.modF=null,n.mod=[]),32&e?(n.srcF=null,n.source=null):(n.srcF=t.srcF,n.source=t.source,t.cleans&&(n.cleans=t.cleans)),n},runAfter(t){this.dataflow.runAfter(t)},changed(t){const e=t||7;return 1&e&&this.add.length||2&e&&this.rem.length||4&e&&this.mod.length},reflow(t){if(t)return this.fork(7).reflow();const e=this.add.length,n=this.source&&this.source.length;return n&&n!==e&&(this.mod=this.source,e&&this.filter(4,Au(this,1))),this},clean(t){return arguments.length?(this.cleans=!!t,this):this.cleans},modifies(t){const e=this.fields||(this.fields={});return Ze(t)?t.forEach((t=>e[t]=!0)):e[t]=!0,this},modified(t,e){const n=this.fields;return!(!e&&!this.mod.length||!n)&&(arguments.length?Ze(t)?t.some((t=>n[t])):n[t]:!!n)},filter(t,e){const n=this;return 1&t&&(n.addF=_u(n.addF,e)),2&t&&(n.remF=_u(n.remF,e)),4&t&&(n.modF=_u(n.modF,e)),16&t&&(n.srcF=_u(n.srcF,e)),n},materialize(t){const e=this;return 1&(t=t||7)&&e.addF&&(e.add=wu(e.add,e.addF),e.addF=null),2&t&&e.remF&&(e.rem=wu(e.rem,e.remF),e.remF=null),4&t&&e.modF&&(e.mod=wu(e.mod,e.modF),e.modF=null),16&t&&e.srcF&&(e.source=e.source.filter(e.srcF),e.srcF=null),e},visit(t,e){const n=this,i=e;if(16&t)return Hn(n.source,n.srcF,i),n;1&t&&Hn(n.add,n.addF,i),2&t&&Hn(n.rem,n.remF,i),4&t&&Hn(n.mod,n.modF,i);const r=n.source;if(8&t&&r){const t=n.add.length+n.mod.length;t===r.length||Hn(r,t?Au(n,5):n.srcF,i)}return n}},Nn(ku,xu,{fork(t){const e=new xu(this.dataflow).init(this,t&this.NO_FIELDS);return void 0!==t&&(t&e.ADD&&this.visit(e.ADD,(t=>e.add.push(t))),t&e.REM&&this.visit(e.REM,(t=>e.rem.push(t))),t&e.MOD&&this.visit(e.MOD,(t=>e.mod.push(t)))),e},changed(t){return this.changes&t},modified(t){const e=this,n=e.fields;return n&&e.changes&e.MOD?Ze(t)?t.some((t=>n[t])):n[t]:0},filter(){Le("MultiPulse does not support filtering.")},materialize(){Le("MultiPulse does not support materialization.")},visit(t,e){const n=this,i=n.pulses,r=i.length;let s=0;if(t&n.SOURCE)for(;s<r;++s)i[s].visit(t,e);else for(;s<r;++s)i[s].stamp===n.stamp&&i[s].visit(t,e);return n}});const Eu={skip:!1,force:!1};function Du(t,e,n,i){let r,s;const o=t[n];for(;n>e&&(s=n-1>>1,r=t[s],i(o,r)<0);)t[n]=r,n=s;return t[n]=o}function Fu(){this.logger(Je()),this.logLevel(1),this._clock=0,this._rank=0,this._locale=va();try{this._loader=Va()}catch(t){}this._touched=Ga(qe),this._input={},this._pulse=null,this._heap=function(t){let e=[];return{clear:()=>e=[],size:()=>e.length,peek:()=>e[0],push:n=>(e.push(n),Du(e,0,e.length-1,t)),pop:()=>{const n=e.pop();let i;return e.length?(i=e[0],e[0]=n,function(t,e,n){const i=e,r=t.length,s=t[e];let o,a=1+(e<<1);for(;a<r;)o=a+1,o<r&&n(t[a],t[o])>=0&&(a=o),t[e]=t[a],a=1+((e=a)<<1);t[e]=s,Du(t,i,e,n)}(e,0,t)):i=n,i}}}(((t,e)=>t.qrank-e.qrank)),this._postrun=[]}function Su(t){return function(){return this._log[t].apply(this,arguments)}}function Ou(t,e){hu.call(this,t,null,e)}Fu.prototype={stamp(){return this._clock},loader(t){return arguments.length?(this._loader=t,this):this._loader},locale(t){return arguments.length?(this._locale=t,this):this._locale},logger(t){return arguments.length?(this._log=t,this):this._log},error:Su("error"),warn:Su("warn"),info:Su("info"),debug:Su("debug"),logLevel:Su("level"),cleanThreshold:1e4,add:function(t,e,n,i){let r,s=1;return t instanceof hu?r=t:t&&t.prototype instanceof hu?r=new t:yn(t)?r=new hu(null,t):(s=0,r=new hu(t,e)),this.rank(r),s&&(i=n,n=e),n&&this.connect(r,r.parameters(n,i)),this.touch(r),r},connect:function(t,e){const n=t.rank,i=e.length;for(let r=0;r<i;++r)if(n<e[r].rank)return void this.rerank(t)},rank:function(t){t.rank=++this._rank},rerank:function(t){const e=[t];let n,i,r;for(;e.length;)if(this.rank(n=e.pop()),i=n._targets)for(r=i.length;--r>=0;)e.push(n=i[r]),n===t&&Le("Cycle detected in dataflow graph.")},pulse:function(t,e,n){this.touch(t,n||Eu);const i=new xu(this,this._clock+(this._pulse?0:1)),r=t.pulse&&t.pulse.source||[];return i.target=t,this._input[t.id]=e.pulse(i,r),this},touch:function(t,e){const n=e||Eu;return this._pulse?this._enqueue(t):this._touched.add(t),n.skip&&t.skip(!0),this},update:function(t,e,n){const i=n||Eu;return(t.set(e)||i.force)&&this.touch(t,i),this},changeset:ou,ingest:function(t,e,n){return e=this.parse(e,n),this.pulse(t,this.changeset().insert(e))},parse:function(t,e){const n=this.locale();return Ha(t,e,n.timeParse,n.utcParse)},preload:async function(t,e,n){const i=this,r=i._pending||function(t){let e;const n=new Promise((t=>e=t));return n.requests=0,n.done=()=>{0==--n.requests&&(t._pending=null,e(t))},t._pending=n}(i);r.requests+=1;const s=await i.request(e,n);return i.pulse(t,i.changeset().remove(Ge).insert(s.data||[])),r.done(),s},request:async function(t,e){const n=this;let i,r=0;try{i=await n.loader().load(t,{context:"dataflow",response:Wa(e&&e.type)});try{i=n.parse(i,e)}catch(e){r=-2,n.warn("Data ingestion failed",t,e)}}catch(e){r=-1,n.warn("Loading failed",t,e)}return{data:i,status:r}},events:function(t,e,n,i){const r=this,s=gu(n,i),o=function(t){t.dataflow=r;try{s.receive(t)}catch(t){r.error(t)}finally{r.run()}};let a;a="string"==typeof t&&"undefined"!=typeof document?document.querySelectorAll(t):mn(t);const u=a.length;for(let t=0;t<u;++t)a[t].addEventListener(e,o);return s},on:function(t,e,n,i,r){return(t instanceof hu?vu:yu)(this,t,e,n,i,r),this},evaluate:async function(t,e,n){const i=this,r=[];if(i._pulse)return Cu(i);if(i._pending&&await i._pending,e&&await Xa(i,e),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const s=++i._clock;i._pulse=new xu(i,s,t),i._touched.forEach((t=>i._enqueue(t,!0))),i._touched=Ga(qe);let o,a,u,l=0;try{for(;i._heap.size()>0;)o=i._heap.pop(),o.rank===o.qrank?(a=o.run(i._getPulse(o,t)),a.then?a=await a:a.async&&(r.push(a.async),a=bu),a!==bu&&o._targets&&o._targets.forEach((t=>i._enqueue(t))),++l):i._enqueue(o,!0)}catch(t){i._heap.clear(),u=t}if(i._input={},i._pulse=null,i.debug(`Pulse ${s}: ${l} operators`),u&&(i._postrun=[],i.error(u)),i._postrun.length){const t=i._postrun.sort(((t,e)=>e.priority-t.priority));i._postrun=[];for(let e=0;e<t.length;++e)await Xa(i,t[e].callback)}return n&&await Xa(i,n),r.length&&Promise.all(r).then((t=>i.runAsync(null,(()=>{t.forEach((t=>{try{t(i)}catch(t){i.error(t)}}))})))),i},run:function(t,e,n){return this._pulse?Cu(this):(this.evaluate(t,e,n),this)},runAsync:async function(t,e,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(t,e,n)).then(i,i),this._running},runAfter:function(t,e,n){if(this._pulse||e)this._postrun.push({priority:n||0,callback:t});else try{t(this)}catch(t){this.error(t)}},_enqueue:function(t,e){const n=t.stamp<this._clock;n&&(t.stamp=this._clock),(n||e)&&(t.qrank=t.rank,this._heap.push(t))},_getPulse:function(t,e){const n=t.source,i=this._clock;return n&&Ze(n)?new ku(this,i,n.map((t=>t.pulse)),e):this._input[t.id]||function(t,e){return e&&e.stamp===t.stamp?e:(t=t.fork(),e&&e!==bu&&(t.source=e.source),t)}(this._pulse,n&&n.pulse)}},Nn(Ou,hu,{run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?this.skip(!1):e=this.evaluate(t),e=e||t,e.then?e=e.then((t=>this.pulse=t)):e!==t.StopPropagation&&(this.pulse=e),e},evaluate(t){const e=this.marshall(t.stamp),n=this.transform(e,t);return e.clear(),n},transform(){}});const Nu={};function Mu(t){const e=zu(t);return e&&e.Definition||null}function zu(t){return t=t&&t.toLowerCase(),Fn(Nu,t)?Nu[t]:null}function $u(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function Tu(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}function Bu(t,e,n=0,i=t.length-1,r=Cr){for(;i>n;){if(i-n>600){const s=i-n+1,o=e-n+1,a=Math.log(s),u=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*u*(s-u)/s)*(o-s/2<0?-1:1);Bu(t,e,Math.max(n,Math.floor(e-o*u/s+l)),Math.min(i,Math.floor(e+(s-o)*u/s+l)),r)}const s=t[e];let o=n,a=i;for(ju(t,n,e),r(t[i],s)>0&&ju(t,n,i);o<a;){for(ju(t,o,a),++o,--a;r(t[o],s)<0;)++o;for(;r(t[a],s)>0;)--a}0===r(t[n],s)?ju(t,n,a):(++a,ju(t,a,i)),a<=e&&(n=a+1),e<=a&&(i=a-1)}return t}function ju(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function Iu(t){return null===t?NaN:+t}function Ru(t,e,n){if(i=(t=Float64Array.from(function*(t,e){if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let i of t)null!=(i=e(i,++n,t))&&(i=+i)>=i&&(yield i)}}(t,n))).length){if((e=+e)<=0||i<2)return Tu(t);if(e>=1)return $u(t);var i,r=(i-1)*e,s=Math.floor(r),o=$u(Bu(t,s).subarray(0,s+1));return o+(Tu(t.subarray(s+1))-o)*(r-s)}}function Lu(t,e,n=Iu){if(i=t.length){if((e=+e)<=0||i<2)return+n(t[0],0,t);if(e>=1)return+n(t[i-1],i-1,t);var i,r=(i-1)*e,s=Math.floor(r),o=+n(t[s],s,t);return o+(+n(t[s+1],s+1,t)-o)*(r-s)}}function Pu(t,e){return Ru(t,.5,e)}function*Uu(t,e){if(null==e)for(let e of t)null!=e&&""!==e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let i of t)i=e(i,++n,t),null!=i&&""!==i&&(i=+i)>=i&&(yield i)}}function qu(t,e,n){const i=Float64Array.from(Uu(t,n));return i.sort(Cr),e.map((t=>Lu(i,t)))}function Wu(t,e){return qu(t,[.25,.5,.75],e)}function Hu(t,e){const n=t.length,i=function(t,e){const n=function(t,e){let n,i=0,r=0,s=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(n=e-r,r+=n/++i,s+=n*(e-r));else{let o=-1;for(let a of t)null!=(a=e(a,++o,t))&&(a=+a)>=a&&(n=a-r,r+=n/++i,s+=n*(a-r))}if(i>1)return s/(i-1)}(t,e);return n?Math.sqrt(n):n}(t,e),r=Wu(t,e),s=(r[2]-r[0])/1.34;return 1.06*(Math.min(i,s)||i||Math.abs(r[0])||1)*Math.pow(n,-.2)}function Vu(t){const e=t.maxbins||20,n=t.base||10,i=Math.log(n),r=t.divide||[5,2];let s,o,a,u,l,c,h=t.extent[0],f=t.extent[1];const d=t.span||f-h||Math.abs(h)||1;if(t.step)s=t.step;else if(t.steps){for(u=d/e,l=0,c=t.steps.length;l<c&&t.steps[l]<u;++l);s=t.steps[Math.max(0,l-1)]}else{for(o=Math.ceil(Math.log(e)/i),a=t.minstep||0,s=Math.max(a,Math.pow(n,Math.round(Math.log(d)/i)-o));Math.ceil(d/s)>e;)s*=n;for(l=0,c=r.length;l<c;++l)u=s/r[l],u>=a&&d/u<=e&&(s=u)}u=Math.log(s);const p=u>=0?0:1+~~(-u/i),g=Math.pow(n,-p-1);return(t.nice||void 0===t.nice)&&(u=Math.floor(h/s+g)*s,h=h<u?u-s:u,f=Math.ceil(f/s)*s),{start:h,stop:f===h?h+s:f,step:s}}var Gu=Math.random;function Xu(t){Gu=t}function Yu(t,e,n,i){if(!t.length)return[void 0,void 0];const r=Float64Array.from(Uu(t,i)),s=r.length,o=e;let a,u,l,c;for(l=0,c=Array(o);l<o;++l){for(a=0,u=0;u<s;++u)a+=r[~~(Gu()*s)];c[l]=a/s}return c.sort(Cr),[Ru(c,n/2),Ru(c,1-n/2)]}function Ju(t,e,n,i){i=i||(t=>t);const r=t.length,s=new Float64Array(r);let o,a=0,u=1,l=i(t[0]),c=l,h=l+e;for(;u<r;++u){if(o=i(t[u]),o>=h){for(c=(l+c)/2;a<u;++a)s[a]=c;h=o+e,l=o}c=o}for(c=(l+c)/2;a<u;++a)s[a]=c;return n?function(t,e){const n=t.length;let i,r,s=0,o=1;for(;t[s]===t[o];)++o;for(;o<n;){for(i=o+1;t[o]===t[i];)++i;if(t[o]-t[o-1]<e){for(r=o+(s+i-o-o>>1);r<o;)t[r++]=t[o];for(;r>o;)t[r--]=t[s]}s=o,o=i}return t}(s,e+e/4):s}function Zu(t){return function(){return(t=(1103515245*t+12345)%2147483647)/2147483647}}function Ku(t,e){let n,i,r;null==e&&(e=t,t=0);const s={min(t){return arguments.length?(n=t||0,r=i-n,s):n},max(t){return arguments.length?(i=t||0,r=i-n,s):i},sample:()=>n+Math.floor(r*Gu()),pdf:t=>t===Math.floor(t)&&t>=n&&t<i?1/r:0,cdf(t){const e=Math.floor(t);return e<n?0:e>=i?1:(e-n+1)/r},icdf:t=>t>=0&&t<=1?n-1+Math.floor(t*r):NaN};return s.min(t).max(e)}const Qu=Math.sqrt(2*Math.PI),tl=Math.SQRT2;let el=NaN;function nl(t,e){t=t||0,e=null==e?1:e;let n,i,r=0,s=0;if(el==el)r=el,el=NaN;else{do{r=2*Gu()-1,s=2*Gu()-1,n=r*r+s*s}while(0===n||n>1);i=Math.sqrt(-2*Math.log(n)/n),r*=i,el=s*i}return t+r*e}function il(t,e,n){const i=(t-(e||0))/(n=null==n?1:n);return Math.exp(-.5*i*i)/(n*Qu)}function rl(t,e,n){const i=(t-(e=e||0))/(n=null==n?1:n),r=Math.abs(i);let s;if(r>37)s=0;else{const t=Math.exp(-r*r/2);let e;r<7.07106781186547?(e=.0352624965998911*r+.700383064443688,e=e*r+6.37396220353165,e=e*r+33.912866078383,e=e*r+112.079291497871,e=e*r+221.213596169931,e=e*r+220.206867912376,s=t*e,e=.0883883476483184*r+1.75566716318264,e=e*r+16.064177579207,e=e*r+86.7807322029461,e=e*r+296.564248779674,e=e*r+637.333633378831,e=e*r+793.826512519948,e=e*r+440.413735824752,s/=e):(e=r+.65,e=r+4/e,e=r+3/e,e=r+2/e,e=r+1/e,s=t/e/2.506628274631)}return i>0?1-s:s}function sl(t,e,n){return t<0||t>1?NaN:(e||0)+(null==n?1:n)*tl*function(t){let e,n=-Math.log((1-t)*(1+t));return n<6.25?(n-=3.125,e=-364441206401782e-35,e=e*n-16850591381820166e-35,e=128584807152564e-32+e*n,e=11157877678025181e-33+e*n,e=e*n-1333171662854621e-31,e=20972767875968562e-33+e*n,e=6637638134358324e-30+e*n,e=e*n-4054566272975207e-29,e=e*n-8151934197605472e-29,e=26335093153082323e-28+e*n,e=e*n-12975133253453532e-27,e=e*n-5415412054294628e-26,e=1.0512122733215323e-9+e*n,e=e*n-4.112633980346984e-9,e=e*n-2.9070369957882005e-8,e=4.2347877827932404e-7+e*n,e=e*n-13654692000834679e-22,e=e*n-13882523362786469e-21,e=.00018673420803405714+e*n,e=e*n-.000740702534166267,e=e*n-.006033670871430149,e=.24015818242558962+e*n,e=1.6536545626831027+e*n):n<16?(n=Math.sqrt(n)-3.25,e=2.2137376921775787e-9,e=9.075656193888539e-8+e*n,e=e*n-2.7517406297064545e-7,e=1.8239629214389228e-8+e*n,e=15027403968909828e-22+e*n,e=e*n-4013867526981546e-21,e=29234449089955446e-22+e*n,e=12475304481671779e-21+e*n,e=e*n-47318229009055734e-21,e=6828485145957318e-20+e*n,e=24031110387097894e-21+e*n,e=e*n-.0003550375203628475,e=.0009532893797373805+e*n,e=e*n-.0016882755560235047,e=.002491442096107851+e*n,e=e*n-.003751208507569241,e=.005370914553590064+e*n,e=1.0052589676941592+e*n,e=3.0838856104922208+e*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,e=-27109920616438573e-27,e=e*n-2.555641816996525e-10,e=1.5076572693500548e-9+e*n,e=e*n-3.789465440126737e-9,e=7.61570120807834e-9+e*n,e=e*n-1.496002662714924e-8,e=2.914795345090108e-8+e*n,e=e*n-6.771199775845234e-8,e=2.2900482228026655e-7+e*n,e=e*n-9.9298272942317e-7,e=4526062597223154e-21+e*n,e=e*n-1968177810553167e-20,e=7599527703001776e-20+e*n,e=e*n-.00021503011930044477,e=e*n-.00013871931833623122,e=1.0103004648645344+e*n,e=4.849906401408584+e*n):e=1/0,e*t}(2*t-1)}function ol(t,e){let n,i;const r={mean(t){return arguments.length?(n=t||0,r):n},stdev(t){return arguments.length?(i=null==t?1:t,r):i},sample:()=>nl(n,i),pdf:t=>il(t,n,i),cdf:t=>rl(t,n,i),icdf:t=>sl(t,n,i)};return r.mean(t).stdev(e)}function al(t,e){const n=ol();let i=0;const r={data(n){return arguments.length?(t=n,i=n?n.length:0,r.bandwidth(e)):t},bandwidth(n){return arguments.length?(!(e=n)&&t&&(e=Hu(t)),r):e},sample:()=>t[~~(Gu()*i)]+e*n.sample(),pdf(r){let s=0,o=0;for(;o<i;++o)s+=n.pdf((r-t[o])/e);return s/e/i},cdf(r){let s=0,o=0;for(;o<i;++o)s+=n.cdf((r-t[o])/e);return s/i},icdf(){throw Error("KDE icdf not supported.")}};return r.data(t)}function ul(t,e){return t=t||0,e=null==e?1:e,Math.exp(t+nl()*e)}function ll(t,e,n){if(t<=0)return 0;e=e||0,n=null==n?1:n;const i=(Math.log(t)-e)/n;return Math.exp(-.5*i*i)/(n*Qu*t)}function cl(t,e,n){return rl(Math.log(t),e,n)}function hl(t,e,n){return Math.exp(sl(t,e,n))}function fl(t,e){let n,i;const r={mean(t){return arguments.length?(n=t||0,r):n},stdev(t){return arguments.length?(i=null==t?1:t,r):i},sample:()=>ul(n,i),pdf:t=>ll(t,n,i),cdf:t=>cl(t,n,i),icdf:t=>hl(t,n,i)};return r.mean(t).stdev(e)}function dl(t,e){let n,i=0;const r={weights(t){return arguments.length?(n=function(t){const e=[];let n,r=0;for(n=0;n<i;++n)r+=e[n]=null==t[n]?1:+t[n];for(n=0;n<i;++n)e[n]/=r;return e}(e=t||[]),r):e},distributions(n){return arguments.length?(n?(i=n.length,t=n):(i=0,t=[]),r.weights(e)):t},sample(){const e=Gu();let r=t[i-1],s=n[0],o=0;for(;o<i-1;s+=n[++o])if(e<s){r=t[o];break}return r.sample()},pdf(e){let r=0,s=0;for(;s<i;++s)r+=n[s]*t[s].pdf(e);return r},cdf(e){let r=0,s=0;for(;s<i;++s)r+=n[s]*t[s].cdf(e);return r},icdf(){throw Error("Mixture icdf not supported.")}};return r.distributions(t).weights(e)}function pl(t,e){return null==e&&(e=null==t?1:t,t=0),t+(e-t)*Gu()}function gl(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=e&&t<=n?1/(n-e):0}function ml(t,e,n){return null==n&&(n=null==e?1:e,e=0),t<e?0:t>n?1:(t-e)/(n-e)}function yl(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=0&&t<=1?e+t*(n-e):NaN}function vl(t,e){let n,i;const r={min(t){return arguments.length?(n=t||0,r):n},max(t){return arguments.length?(i=null==t?1:t,r):i},sample:()=>pl(n,i),pdf:t=>gl(t,n,i),cdf:t=>ml(t,n,i),icdf:t=>yl(t,n,i)};return null==e&&(e=null==t?1:t,t=0),r.min(t).max(e)}function bl(t,e,n,i){const r=i-t*t,s=Math.abs(r)<1e-24?0:(n-t*e)/r;return[e-s*t,s]}function xl(t,e,n,i){t=t.filter((t=>{let i=e(t),r=n(t);return null!=i&&(i=+i)>=i&&null!=r&&(r=+r)>=r})),i&&t.sort(((t,n)=>e(t)-e(n)));const r=t.length,s=new Float64Array(r),o=new Float64Array(r);let a,u,l,c=0,h=0,f=0;for(l of t)s[c]=a=+e(l),o[c]=u=+n(l),++c,h+=(a-h)/c,f+=(u-f)/c;for(c=0;c<r;++c)s[c]-=h,o[c]-=f;return[s,o,h,f]}function wl(t,e,n,i){let r,s,o=-1;for(const a of t)r=e(a),s=n(a),null!=r&&(r=+r)>=r&&null!=s&&(s=+s)>=s&&i(r,s,++o)}function Al(t,e,n,i,r){let s=0,o=0;return wl(t,e,n,((t,e)=>{const n=e-r(t),a=e-i;s+=n*n,o+=a*a})),1-s/o}function _l(t,e,n){let i=0,r=0,s=0,o=0,a=0;wl(t,e,n,((t,e)=>{++a,i+=(t-i)/a,r+=(e-r)/a,s+=(t*e-s)/a,o+=(t*t-o)/a}));const u=bl(i,r,s,o),l=t=>u[0]+u[1]*t;return{coef:u,predict:l,rSquared:Al(t,e,n,r,l)}}function kl(t,e,n){let i=0,r=0,s=0,o=0,a=0;wl(t,e,n,((t,e)=>{++a,t=Math.log(t),i+=(t-i)/a,r+=(e-r)/a,s+=(t*e-s)/a,o+=(t*t-o)/a}));const u=bl(i,r,s,o),l=t=>u[0]+u[1]*Math.log(t);return{coef:u,predict:l,rSquared:Al(t,e,n,r,l)}}function Cl(t,e,n){const[i,r,s,o]=xl(t,e,n);let a,u,l,c=0,h=0,f=0,d=0,p=0;wl(t,e,n,((t,e)=>{a=i[p++],u=Math.log(e),l=a*e,c+=(e*u-c)/p,h+=(l-h)/p,f+=(l*u-f)/p,d+=(a*l-d)/p}));const[g,m]=bl(h/o,c/o,f/o,d/o),y=t=>Math.exp(g+m*(t-s));return{coef:[Math.exp(g-m*s),m],predict:y,rSquared:Al(t,e,n,o,y)}}function El(t,e,n){let i=0,r=0,s=0,o=0,a=0,u=0;wl(t,e,n,((t,e)=>{const n=Math.log(t),l=Math.log(e);++u,i+=(n-i)/u,r+=(l-r)/u,s+=(n*l-s)/u,o+=(n*n-o)/u,a+=(e-a)/u}));const l=bl(i,r,s,o),c=t=>l[0]*Math.pow(t,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:Al(t,e,n,a,c)}}function Dl(t,e,n){const[i,r,s,o]=xl(t,e,n),a=i.length;let u,l,c,h,f=0,d=0,p=0,g=0,m=0;for(u=0;u<a;)l=i[u],c=r[u++],h=l*l,f+=(h-f)/u,d+=(h*l-d)/u,p+=(h*h-p)/u,g+=(l*c-g)/u,m+=(h*c-m)/u;const y=p-f*f,v=f*y-d*d,b=(m*f-g*d)/v,x=(g*y-m*d)/v,w=-b*f,A=t=>b*(t-=s)*t+x*t+w+o;return{coef:[w-x*s+b*s*s+o,x-2*b*s,b],predict:A,rSquared:Al(t,e,n,o,A)}}function Fl(t,e,n,i){if(1===i)return _l(t,e,n);if(2===i)return Dl(t,e,n);const[r,s,o,a]=xl(t,e,n),u=r.length,l=[],c=[],h=i+1;let f,d,p,g,m;for(f=0;f<h;++f){for(p=0,g=0;p<u;++p)g+=Math.pow(r[p],f)*s[p];for(l.push(g),m=new Float64Array(h),d=0;d<h;++d){for(p=0,g=0;p<u;++p)g+=Math.pow(r[p],f+d);m[d]=g}c.push(m)}c.push(l);const y=function(t){const e=t.length-1,n=[];let i,r,s,o,a;for(i=0;i<e;++i){for(o=i,r=i+1;r<e;++r)Math.abs(t[i][r])>Math.abs(t[i][o])&&(o=r);for(s=i;s<e+1;++s)a=t[s][i],t[s][i]=t[s][o],t[s][o]=a;for(r=i+1;r<e;++r)for(s=e;s>=i;s--)t[s][r]-=t[s][i]*t[i][r]/t[i][i]}for(r=e-1;r>=0;--r){for(a=0,s=r+1;s<e;++s)a+=t[s][r]*n[s];n[r]=(t[e][r]-a)/t[r][r]}return n}(c),v=t=>{t-=o;let e=a+y[0]+y[1]*t+y[2]*t*t;for(f=3;f<h;++f)e+=y[f]*Math.pow(t,f);return e};return{coef:Sl(h,y,-o,a),predict:v,rSquared:Al(t,e,n,a,v)}}function Sl(t,e,n,i){const r=Array(t);let s,o,a,u;for(s=0;s<t;++s)r[s]=0;for(s=t-1;s>=0;--s)for(a=e[s],u=1,r[s]+=a,o=1;o<=s;++o)u*=(s+1-o)/o,r[s-o]+=a*Math.pow(n,o)*u;return r[0]+=i,r}function Ol(t,e,n,i){const[r,s,o,a]=xl(t,e,n,!0),u=r.length,l=Math.max(2,~~(i*u)),c=new Float64Array(u),h=new Float64Array(u),f=new Float64Array(u).fill(1);for(let t=-1;++t<=2;){const e=[0,l-1];for(let t=0;t<u;++t){const n=r[t],i=e[0],o=e[1],a=n-r[i]>r[o]-n?i:o;let u=0,l=0,d=0,p=0,g=0;const m=1/Math.abs(r[a]-n||1);for(let t=i;t<=o;++t){const e=r[t],i=s[t],o=Nl(Math.abs(n-e)*m)*f[t],a=e*o;u+=o,l+=a,d+=i*o,p+=i*a,g+=e*a}const[y,v]=bl(l/u,d/u,p/u,g/u);c[t]=y+v*n,h[t]=Math.abs(s[t]-c[t]),Ml(r,t+1,e)}if(2===t)break;const n=Pu(h);if(Math.abs(n)<1e-12)break;for(let t,e,i=0;i<u;++i)t=h[i]/(6*n),f[i]=t>=1?1e-12:(e=1-t*t)*e}return function(t,e,n,i){const r=t.length,s=[];let o,a=0,u=0,l=[];for(;a<r;++a)o=t[a]+n,l[0]===o?l[1]+=(e[a]-l[1])/++u:(u=0,l[1]+=i,l=[o,e[a]],s.push(l));return l[1]+=i,s}(r,c,o,a)}function Nl(t){return(t=1-t*t*t)*t*t}function Ml(t,e,n){const i=t[e];let r=n[0],s=n[1]+1;if(!(s>=t.length))for(;e>r&&t[s]-i<=i-t[r];)n[0]=++r,n[1]=s,++s}const zl=.5*Math.PI/180;function $l(t,e,n,i){n=n||25,i=Math.max(n,i||200);const r=e=>[e,t(e)],s=e[0],o=e[1],a=o-s,u=a/i,l=[r(s)],c=[];if(n===i){for(let t=1;t<i;++t)l.push(r(s+t/n*a));return l.push(r(o)),l}c.push(r(o));for(let t=n;--t>0;)c.push(r(s+t/n*a));let h=l[0],f=c[c.length-1];const d=1/a,p=function(t,e){let n=t,i=t;const r=e.length;for(let t=0;t<r;++t){const r=e[t][1];r<n&&(n=r),r>i&&(i=r)}return 1/(i-n)}(h[1],c);for(;f;){const t=r((h[0]+f[0])/2);t[0]-h[0]>=u&&Tl(h,t,f,d,p)>zl?c.push(t):(h=f,l.push(f),c.pop()),f=c[c.length-1]}return l}function Tl(t,e,n,i,r){const s=Math.atan2(r*(n[1]-t[1]),i*(n[0]-t[0])),o=Math.atan2(r*(e[1]-t[1]),i*(e[0]-t[0]));return Math.abs(s-o)}function Bl(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=0|Math.max(0,Math.ceil((e-t)/n)),s=new Array(r);++i<r;)s[i]=t+i*n;return s}function jl(t){return t&&t.length?1===t.length?t[0]:(e=t,t=>{const n=e.length;let i=1,r=String(e[0](t));for(;i<n;++i)r+="|"+e[i](t);return r}):function(){return""};var e}function Il(t,e,n){return n||t+(e?"_"+e:"")}const Rl=()=>{},Ll={init:Rl,add:Rl,rem:Rl,idx:0},Pl={values:{init:t=>t.cell.store=!0,value:t=>t.cell.data.values(),idx:-1},count:{value:t=>t.cell.num},__count__:{value:t=>t.missing+t.valid},missing:{value:t=>t.missing},valid:{value:t=>t.valid},sum:{init:t=>t.sum=0,value:t=>t.sum,add:(t,e)=>t.sum+=+e,rem:(t,e)=>t.sum-=e},product:{init:t=>t.product=1,value:t=>t.valid?t.product:void 0,add:(t,e)=>t.product*=e,rem:(t,e)=>t.product/=e},mean:{init:t=>t.mean=0,value:t=>t.valid?t.mean:void 0,add:(t,e)=>(t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid),rem:(t,e)=>(t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean)},average:{value:t=>t.valid?t.mean:void 0,req:["mean"],idx:1},variance:{init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):void 0,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean),req:["mean"],idx:1},variancep:{value:t=>t.valid>1?t.dev/t.valid:void 0,req:["variance"],idx:2},stdev:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):void 0,req:["variance"],idx:2},stderr:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid*(t.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:t=>t.cell.data.distinct(t.get),req:["values"],idx:3},ci0:{value:t=>t.cell.data.ci0(t.get),req:["values"],idx:3},ci1:{value:t=>t.cell.data.ci1(t.get),req:["values"],idx:3},median:{value:t=>t.cell.data.q2(t.get),req:["values"],idx:3},q1:{value:t=>t.cell.data.q1(t.get),req:["values"],idx:3},q3:{value:t=>t.cell.data.q3(t.get),req:["values"],idx:3},min:{init:t=>t.min=void 0,value:t=>t.min=Number.isNaN(t.min)?t.cell.data.min(t.get):t.min,add:(t,e)=>{(e<t.min||void 0===t.min)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)},req:["values"],idx:4},max:{init:t=>t.max=void 0,value:t=>t.max=Number.isNaN(t.max)?t.cell.data.max(t.get):t.max,add:(t,e)=>{(e>t.max||void 0===t.max)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)},req:["values"],idx:4},argmin:{init:t=>t.argmin=void 0,value:t=>t.argmin||t.cell.data.argmin(t.get),add:(t,e,n)=>{e<t.min&&(t.argmin=n)},rem:(t,e)=>{e<=t.min&&(t.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:t=>t.argmax=void 0,value:t=>t.argmax||t.cell.data.argmax(t.get),add:(t,e,n)=>{e>t.max&&(t.argmax=n)},rem:(t,e)=>{e>=t.max&&(t.argmax=void 0)},req:["max","values"],idx:3}},Ul=Object.keys(Pl);function ql(t,e){return Pl[t](e)}function Wl(t,e){return t.idx-e.idx}function Hl(){this.valid=0,this.missing=0,this._ops.forEach((t=>t.init(this)))}function Vl(t,e){null!=t&&""!==t?t==t&&(++this.valid,this._ops.forEach((n=>n.add(this,t,e)))):++this.missing}function Gl(t,e){null!=t&&""!==t?t==t&&(--this.valid,this._ops.forEach((n=>n.rem(this,t,e)))):--this.missing}function Xl(t){return this._out.forEach((e=>t[e.out]=e.value(this))),t}function Yl(t,e){const n=e||We,i=function(t){const e={};t.forEach((t=>e[t.name]=t));const n=t=>{t.req&&t.req.forEach((t=>{e[t]||n(e[t]=Pl[t]())}))};return t.forEach(n),Object.values(e).sort(Wl)}(t),r=t.slice().sort(Wl);function s(t){this._ops=i,this._out=r,this.cell=t,this.init()}return s.prototype.init=Hl,s.prototype.add=Vl,s.prototype.rem=Gl,s.prototype.set=Xl,s.prototype.get=n,s.fields=t.map((t=>t.out)),s}function Jl(t){this._key=t?Ue(t):Ka,this.reset()}Ul.forEach((t=>{Pl[t]=function(t,e){return n=>Cn({name:t,out:n||t},Ll,e)}(t,Pl[t])}));const Zl=Jl.prototype;function Kl(t){Ou.call(this,null,t),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}function Ql(t){Ou.call(this,null,t)}function tc(t,e,n){const i=t;let r=e||[],s=n||[],o={},a=0;return{add:t=>s.push(t),remove:t=>o[i(t)]=++a,size:()=>r.length,data:(t,e)=>(a&&(r=r.filter((t=>!o[i(t)])),o={},a=0),e&&t&&r.sort(t),s.length&&(r=t?function(t,e,n,i){const r=e.length,s=n.length;if(!s)return e;if(!r)return n;const o=new e.constructor(r+s);let a=0,u=0,l=0;for(;a<r&&u<s;++l)o[l]=t(e[a],n[u])>0?n[u++]:e[a++];for(;a<r;++a,++l)o[l]=e[a];for(;u<s;++u,++l)o[l]=n[u];return o}(t,r,s.sort(t)):r.concat(s),s=[]),r)}}function ec(t){Ou.call(this,[],t)}function nc(t){hu.call(this,null,ic,t)}function ic(t){return this.value&&!t.modified()?this.value:vn(t.fields,t.orders)}function rc(t){Ou.call(this,null,t)}function sc(t){Ou.call(this,null,t)}Zl.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Zl.add=function(t){this._add.push(t)},Zl.rem=function(t){this._rem.push(t)},Zl.values=function(){if(this._get=null,0===this._rem.length)return this._add;const t=this._add,e=this._rem,n=this._key,i=t.length,r=e.length,s=Array(i-r),o={};let a,u,l;for(a=0;a<r;++a)o[n(e[a])]=1;for(a=0,u=0;a<i;++a)o[n(l=t[a])]?o[n(l)]=0:s[u++]=l;return this._rem=[],this._add=s},Zl.distinct=function(t){const e=this.values(),n={};let i,r=e.length,s=0;for(;--r>=0;)i=t(e[r])+"",Fn(n,i)||(n[i]=1,++s);return s},Zl.extent=function(t){if(this._get!==t||!this._ext){const e=this.values(),n=function(t,e){const n=t.length;let i,r,s,o,a,u=-1;if(null==e){for(;++u<n;)if(r=t[u],null!=r&&r>=r){i=s=r;break}if(u===n)return[-1,-1];for(o=a=u;++u<n;)r=t[u],null!=r&&(i>r&&(i=r,o=u),s<r&&(s=r,a=u))}else{for(;++u<n;)if(r=e(t[u],u,t),null!=r&&r>=r){i=s=r;break}if(u===n)return[-1,-1];for(o=a=u;++u<n;)r=e(t[u],u,t),null!=r&&(i>r&&(i=r,o=u),s<r&&(s=r,a=u))}return[o,a]}(e,t);this._ext=[e[n[0]],e[n[1]]],this._get=t}return this._ext},Zl.argmin=function(t){return this.extent(t)[0]||{}},Zl.argmax=function(t){return this.extent(t)[1]||{}},Zl.min=function(t){const e=this.extent(t)[0];return null!=e?t(e):void 0},Zl.max=function(t){const e=this.extent(t)[1];return null!=e?t(e):void 0},Zl.quartile=function(t){return this._get===t&&this._q||(this._q=Wu(this.values(),t),this._get=t),this._q},Zl.q1=function(t){return this.quartile(t)[0]},Zl.q2=function(t){return this.quartile(t)[1]},Zl.q3=function(t){return this.quartile(t)[2]},Zl.ci=function(t){return this._get===t&&this._ci||(this._ci=Yu(this.values(),1e3,.05,t),this._get=t),this._ci},Zl.ci0=function(t){return this.ci(t)[0]},Zl.ci1=function(t){return this.ci(t)[1]},Kl.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Ul},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},Nn(Kl,Ou,{transform(t,e){const n=this,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=t.modified();return n.stamp=i.stamp,n.value&&(r||e.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(t):{},e.visit(e.SOURCE,(t=>n.add(t)))):(n.value=n.value||n.init(t),e.visit(e.REM,(t=>n.rem(t))),e.visit(e.ADD,(t=>n.add(t)))),i.modifies(n._outputs),n._drop=!1!==t.drop,t.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),e.clean()&&n._drop&&i.clean(!0).runAfter((()=>this.clean())),n.changes(i)},cross(){const t=this,e=t.value,n=t._dnames,i=n.map((()=>({}))),r=n.length;function s(t){let e,s,o,a;for(e in t)for(o=t[e].tuple,s=0;s<r;++s)i[s][a=o[n[s]]]=a}s(t._prev),s(e),function s(o,a,u){const l=n[u],c=i[u++];for(const n in c){const i=o?o+"|"+n:n;a[l]=c[n],u<r?s(i,a,u):e[i]||t.cell(i,a)}}("",{},0)},init(t){const e=this._inputs=[],n=this._outputs=[],i={};function r(t){const n=mn(Be(t)),r=n.length;let s,o=0;for(;o<r;++o)i[s=n[o]]||(i[s]=1,e.push(s))}this._dims=mn(t.groupby),this._dnames=this._dims.map((t=>{const e=Te(t);return r(t),n.push(e),e})),this.cellkey=t.key?t.key:jl(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const s=t.fields||[null],o=t.ops||["count"],a=t.as||[],u=s.length,l={};let c,h,f,d,p,g;for(u!==o.length&&Le("Unmatched number of fields and aggregate ops."),g=0;g<u;++g)c=s[g],h=o[g],null==c&&"count"!==h&&Le("Null aggregate field specified."),d=Te(c),p=Il(h,d,a[g]),n.push(p),"count"!==h?(f=l[d],f||(r(c),f=l[d]=[],f.field=c,this._measures.push(f)),"count"!==h&&(this._countOnly=!1),f.push(ql(h,p))):this._counts.push(p);return this._measures=this._measures.map((t=>Yl(t,t.field))),{}},cellkey:jl(),cell(t,e){let n=this.value[t];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[t]=this.newcell(t,e),this._adds[this._alen++]=n),n},newcell(t,e){const n={key:t,num:0,agg:null,tuple:this.newtuple(e,this._prev&&this._prev[t]),stamp:this.stamp,store:!1};if(!this._countOnly){const t=this._measures,e=t.length;n.agg=Array(e);for(let i=0;i<e;++i)n.agg[i]=new t[i](n)}return n.store&&(n.data=new Jl),n},newtuple(t,e){const n=this._dnames,i=this._dims,r=i.length,s={};for(let e=0;e<r;++e)s[n[e]]=i[e](t);return e?iu(e.tuple,s):tu(s)},clean(){const t=this.value;for(const e in t)0===t[e].num&&delete t[e]},add(t){const e=this.cellkey(t),n=this.cell(e,t);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(t);const i=n.agg;for(let e=0,n=i.length;e<n;++e)i[e].add(i[e].get(t),t)},rem(t){const e=this.cellkey(t),n=this.cell(e,t);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(t);const i=n.agg;for(let e=0,n=i.length;e<n;++e)i[e].rem(i[e].get(t),t)},celltuple(t){const e=t.tuple,n=this._counts;t.store&&t.data.values();for(let i=0,r=n.length;i<r;++i)e[n[i]]=t.num;if(!this._countOnly){const n=t.agg;for(let t=0,i=n.length;t<i;++t)n[t].set(e)}return e},changes(t){const e=this._adds,n=this._mods,i=this._prev,r=this._drop,s=t.add,o=t.rem,a=t.mod;let u,l,c,h;if(i)for(l in i)u=i[l],r&&!u.num||o.push(u.tuple);for(c=0,h=this._alen;c<h;++c)s.push(this.celltuple(e[c])),e[c]=null;for(c=0,h=this._mlen;c<h;++c)u=n[c],(0===u.num&&r?o:a).push(this.celltuple(u)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,t}}),Ql.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},Nn(Ql,Ou,{transform(t,e){const n=!1!==t.interval,i=this._bins(t),r=i.start,s=i.step,o=t.as||["bin0","bin1"],a=o[0],u=o[1];let l;return l=t.modified()?(e=e.reflow(!0)).SOURCE:e.modified(Be(t.field))?e.ADD_MOD:e.ADD,e.visit(l,n?t=>{const e=i(t);t[a]=e,t[u]=null==e?null:r+s*(1+(e-r)/s)}:t=>t[a]=i(t)),e.modifies(n?o:a)},_bins(t){if(this.value&&!t.modified())return this.value;const e=t.field,n=Vu(t),i=n.step;let r,s,o=n.start,a=o+Math.ceil((n.stop-o)/i)*i;null!=(r=t.anchor)&&(s=r-(o+i*Math.floor((r-o)/i)),o+=s,a+=s);const u=function(t){let n=rn(e(t));return null==n?null:n<o?-1/0:n>a?1/0:(n=Math.max(o,Math.min(n,a-i)),o+i*Math.floor(1e-14+(n-o)/i))};return u.start=o,u.stop=n.stop,u.step=i,this.value=$e(u,Be(e),t.name||"bin_"+Te(e))}}),ec.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},Nn(ec,Ou,{transform(t,e){const n=e.fork(e.ALL),i=tc(Ka,this.value,n.materialize(n.ADD).add),r=t.sort,s=e.changed()||r&&(t.modified("sort")||e.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(s),this.value=n.source=i.data(ru(r),s),e.source&&e.source.root&&(this.value.root=e.source.root),n}}),Nn(nc,hu),rc.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},Nn(rc,Ou,{transform(t,e){const n=e=>n=>{for(var i,r=function(t,e,n){switch(e){case"upper":t=t.toUpperCase();break;case"lower":t=t.toLowerCase()}return t.match(n)}(a(n),t.case,s)||[],u=0,l=r.length;u<l;++u)o.test(i=r[u])||e(i)},i=this._parameterCheck(t,e),r=this._counts,s=this._match,o=this._stop,a=t.field,u=t.as||["text","count"],l=n((t=>r[t]=1+(r[t]||0))),c=n((t=>r[t]-=1));return i?e.visit(e.SOURCE,l):(e.visit(e.ADD,l),e.visit(e.REM,c)),this._finish(e,u)},_parameterCheck(t,e){let n=!1;return!t.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(t.stopwords||"")+"$","i"),n=!0),!t.modified("pattern")&&this._match||(this._match=new RegExp(t.pattern||"[\\w']+","g"),n=!0),(t.modified("field")||e.modified(t.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(t,e){const n=this._counts,i=this._tuples||(this._tuples={}),r=e[0],s=e[1],o=t.fork(t.NO_SOURCE|t.NO_FIELDS);let a,u,l;for(a in n)u=i[a],l=n[a]||0,!u&&l?(i[a]=u=tu({}),u[r]=a,u[s]=l,o.add.push(u)):0===l?(u&&o.rem.push(u),n[a]=null,i[a]=null):u[s]!==l&&(u[s]=l,o.mod.push(u));return o.modifies(e)}}),sc.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},Nn(sc,Ou,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.as||["a","b"],r=i[0],s=i[1],o=!this.value||e.changed(e.ADD_REM)||t.modified("as")||t.modified("filter");let a=this.value;return o?(a&&(n.rem=a),a=e.materialize(e.SOURCE).source,n.add=this.value=function(t,e,n,i){for(var r,s,o=[],a={},u=t.length,l=0;l<u;++l)for(a[e]=s=t[l],r=0;r<u;++r)a[n]=t[r],i(a)&&(o.push(tu(a)),(a={})[e]=s);return o}(a,r,s,t.filter||Ge)):n.mod=a,n.source=this.value,n.modifies(i)}});const oc={kde:al,mixture:dl,normal:ol,lognormal:fl,uniform:vl};function ac(t,e){const n=t.function;Fn(oc,n)||Le("Unknown distribution function: "+n);const i=oc[n]();for(const n in t)"field"===n?i.data((t.from||e()).map(t[n])):"distributions"===n?i[n](t[n].map((t=>ac(t,e)))):"function"==typeof i[n]&&i[n](t[n]);return i}function uc(t){Ou.call(this,null,t)}const lc=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],cc={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:lc},{name:"weights",type:"number",array:!0}]};function hc(t,e){return t?t.map(((t,n)=>e[n]||Te(t))):null}function fc(t,e,n){const i=[],r=t=>t(u);let s,o,a,u,l,c;if(null==e)i.push(t.map(n));else for(s={},o=0,a=t.length;o<a;++o)u=t[o],l=e.map(r),c=s[l],c||(s[l]=c=[],c.dims=l,i.push(c)),c.push(n(u));return i}function dc(t){Ou.call(this,null,t)}function pc(t){hu.call(this,null,gc,t),this.modified(!0)}function gc(t){const e=t.expr;return this.value&&!t.modified("expr")?this.value:$e((n=>e(n,t)),Be(e),Te(e))}function mc(t){Ou.call(this,[void 0,void 0],t)}function yc(t,e){hu.call(this,t),this.parent=e,this.count=0}function vc(t){Ou.call(this,{},t),this._keys=On();const e=this._targets=[];e.active=0,e.forEach=t=>{for(let n=0,i=e.active;n<i;++n)t(e[n],n,e)}}function bc(t){hu.call(this,null,xc,t)}function xc(t){return this.value&&!t.modified()?this.value:Ze(t.name)?mn(t.name).map((t=>Ue(t))):Ue(t.name,t.as)}function wc(t){Ou.call(this,On(),t)}function Ac(t){Ou.call(this,[],t)}function _c(t){Ou.call(this,[],t)}function kc(t){Ou.call(this,null,t)}function Cc(t){Ou.call(this,[],t)}uc.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:lc.concat(cc)},{name:"as",type:"string",array:!0,default:["value","density"]}]},Nn(uc,Ou,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=ac(t.distribution,function(t){return()=>t.materialize(t.SOURCE).source}(e)),r=t.steps||t.minsteps||25,s=t.steps||t.maxsteps||200;let o=t.method||"pdf";"pdf"!==o&&"cdf"!==o&&Le("Invalid density method: "+o),t.extent||i.data||Le("Missing density extent parameter."),o=i[o];const a=t.as||["value","density"],u=$l(o,t.extent||En(i.data()),r,s).map((t=>{const e={};return e[a[0]]=t[0],e[a[1]]=t[1],tu(e)}));this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),dc.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]},Nn(dc,Ou,{transform(t,e){if(this.value&&!t.modified()&&!e.changed())return e;const n=e.materialize(e.SOURCE).source,i=fc(e.source,t.groupby,We),r=t.smooth||!1,s=t.field,o=t.step||((t,e)=>In(En(t,e))/30)(n,s),a=ru(((t,e)=>s(t)-s(e))),u=t.as||"bin",l=i.length;let c,h=1/0,f=-1/0,d=0;for(;d<l;++d){const t=i[d].sort(a);c=-1;for(const e of Ju(t,o,r,s))e<h&&(h=e),e>f&&(f=e),t[++c][u]=e}return this.value={start:h,stop:f,step:o},e.reflow(!0).modifies(u)}}),Nn(pc,hu),mc.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},Nn(mc,Ou,{transform(t,e){const n=this.value,i=t.field,r=e.changed()||e.modified(i.fields)||t.modified("field");let s=n[0],o=n[1];if((r||null==s)&&(s=1/0,o=-1/0),e.visit(r?e.SOURCE:e.ADD,(t=>{const e=rn(i(t));null!=e&&(e<s&&(s=e),e>o&&(o=e))})),!Number.isFinite(s)||!Number.isFinite(o)){let t=Te(i);t&&(t=` for field "${t}"`),e.dataflow.warn(`Infinite extent${t}: [${s}, ${o}]`),s=o=void 0}this.value=[s,o]}}),Nn(yc,hu,{connect(t){return this.detachSubflow=t.detachSubflow,this.targets().add(t),t.source=this},add(t){this.count+=1,this.value.add.push(t)},rem(t){this.count-=1,this.value.rem.push(t)},mod(t){this.value.mod.push(t)},init(t){this.value.init(t,t.NO_SOURCE)},evaluate(){return this.value}}),Nn(vc,Ou,{activate(t){this._targets[this._targets.active++]=t},subflow(t,e,n,i){const r=this.value;let s,o,a=Fn(r,t)&&r[t];return a?a.value.stamp<n.stamp&&(a.init(n),this.activate(a)):(o=i||(o=this._group[t])&&o.tuple,s=n.dataflow,a=new yc(n.fork(n.NO_SOURCE),this),s.add(a).connect(e(s,t,o)),r[t]=a,this.activate(a)),a},clean(){const t=this.value;let e=0;for(const n in t)if(0===t[n].count){const i=t[n].detachSubflow;i&&i(),delete t[n],++e}if(e){const t=this._targets.filter((t=>t&&t.count>0));this.initTargets(t)}},initTargets(t){const e=this._targets,n=e.length,i=t?t.length:0;let r=0;for(;r<i;++r)e[r]=t[r];for(;r<n&&null!=e[r];++r)e[r]=null;e.active=i},transform(t,e){const n=e.dataflow,i=t.key,r=t.subflow,s=this._keys,o=t.modified("key"),a=t=>this.subflow(t,r,e);return this._group=t.group||{},this.initTargets(),e.visit(e.REM,(t=>{const e=Ka(t),n=s.get(e);void 0!==n&&(s.delete(e),a(n).rem(t))})),e.visit(e.ADD,(t=>{const e=i(t);s.set(Ka(t),e),a(e).add(t)})),o||e.modified(i.fields)?e.visit(e.MOD,(t=>{const e=Ka(t),n=s.get(e),r=i(t);n===r?a(r).mod(t):(s.set(e,r),a(n).rem(t),a(r).add(t))})):e.changed(e.MOD)&&e.visit(e.MOD,(t=>{a(s.get(Ka(t))).mod(t)})),o&&e.visit(e.REFLOW,(t=>{const e=Ka(t),n=s.get(e),r=i(t);n!==r&&(s.set(e,r),a(n).rem(t),a(r).add(t))})),e.clean()?n.runAfter((()=>{this.clean(),s.clean()})):s.empty>n.cleanThreshold&&n.runAfter(s.clean),e}}),Nn(bc,hu),wc.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},Nn(wc,Ou,{transform(t,e){const n=e.dataflow,i=this.value,r=e.fork(),s=r.add,o=r.rem,a=r.mod,u=t.expr;let l=!0;function c(e){const n=Ka(e),r=u(e,t),c=i.get(n);r&&c?(i.delete(n),s.push(e)):r||c?l&&r&&!c&&a.push(e):(i.set(n,1),o.push(e))}return e.visit(e.REM,(t=>{const e=Ka(t);i.has(e)?i.delete(e):o.push(t)})),e.visit(e.ADD,(e=>{u(e,t)?s.push(e):i.set(Ka(e),1)})),e.visit(e.MOD,c),t.modified()&&(l=!1,e.visit(e.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r}}),Ac.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},Nn(Ac,Ou,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.fields,r=hc(i,t.as||[]),s=t.index||null,o=r.length;return n.rem=this.value,e.visit(e.SOURCE,(t=>{const e=i.map((e=>e(t))),a=e.reduce(((t,e)=>Math.max(t,e.length)),0);let u,l,c,h=0;for(;h<a;++h){for(l=eu(t),u=0;u<o;++u)l[r[u]]=null==(c=e[u][h])?null:c;s&&(l[s]=h),n.add.push(l)}})),this.value=n.source=n.add,s&&n.modifies(s),n.modifies(r)}}),_c.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},Nn(_c,Ou,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.fields,r=i.map(Te),s=t.as||["key","value"],o=s[0],a=s[1],u=i.length;return n.rem=this.value,e.visit(e.SOURCE,(t=>{for(let e,s=0;s<u;++s)e=eu(t),e[o]=r[s],e[a]=i[s](t),n.add.push(e)})),this.value=n.source=n.add,n.modifies(s)}}),kc.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},Nn(kc,Ou,{transform(t,e){const n=t.expr,i=t.as,r=t.modified(),s=t.initonly?e.ADD:r?e.SOURCE:e.modified(n.fields)||e.modified(i)?e.ADD_MOD:e.ADD;return r&&(e=e.materialize().reflow(!0)),t.initonly||e.modifies(i),e.visit(s,(e=>e[i]=n(e,t)))}}),Nn(Cc,Ou,{transform(t,e){const n=e.fork(e.ALL),i=t.generator;let r,s,o,a=this.value,u=t.size-a.length;if(u>0){for(r=[];--u>=0;)r.push(o=tu(i(t))),a.push(o);n.add=n.add.length?n.materialize(n.ADD).add.concat(r):r}else s=a.slice(0,-u),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(s):s,a=a.slice(-u);return n.source=this.value=a,n}});const Ec={value:"value",median:Pu,mean:function(t,e){let n=0,i=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(++n,i+=e);else{let r=-1;for(let s of t)null!=(s=e(s,++r,t))&&(s=+s)>=s&&(++n,i+=s)}if(n)return i/n},min:Tu,max:$u},Dc=[];function Fc(t){Ou.call(this,[],t)}function Sc(t){Kl.call(this,t)}function Oc(t){Ou.call(this,null,t)}function Nc(t){hu.call(this,null,Mc,t)}function Mc(t){return this.value&&!t.modified()?this.value:Bn(t.fields,t.flat)}function zc(t){Ou.call(this,[],t),this._pending=null}function $c(t,e,n){n.forEach(tu);const i=e.fork(e.NO_FIELDS&e.NO_SOURCE);return i.rem=t.value,t.value=i.source=i.add=n,t._pending=null,i.rem.length&&i.clean(!0),i}function Tc(t){Ou.call(this,{},t)}function Bc(t){hu.call(this,null,jc,t)}function jc(t){if(this.value&&!t.modified())return this.value;const e=t.extents,n=e.length;let i,r,s=1/0,o=-1/0;for(i=0;i<n;++i)r=e[i],r[0]<s&&(s=r[0]),r[1]>o&&(o=r[1]);return[s,o]}function Ic(t){hu.call(this,null,Rc,t)}function Rc(t){return this.value&&!t.modified()?this.value:t.values.reduce(((t,e)=>t.concat(e)),[])}function Lc(t){Ou.call(this,null,t)}function Pc(t){Kl.call(this,t)}function Uc(t){vc.call(this,t)}function qc(t){Ou.call(this,null,t)}function Wc(t){Ou.call(this,null,t)}function Hc(t){Ou.call(this,null,t)}function Vc(t){Ou.call(this,null,t)}function Gc(t){Ou.call(this,[],t),this.count=0}function Xc(t){Ou.call(this,null,t)}function Yc(t){Ou.call(this,null,t),this.modified(!0)}function Jc(t){Ou.call(this,null,t)}Fc.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},Nn(Fc,Ou,{transform(t,e){var n,i,r,s,o,a,u,l,c,h,f=e.fork(e.ALL),d=function(t){var e,n=t.method||Ec.value;if(null!=Ec[n])return n===Ec.value?(e=void 0!==t.value?t.value:0,()=>e):Ec[n];Le("Unrecognized imputation method: "+n)}(t),p=function(t){const e=t.field;return t=>t?e(t):NaN}(t),g=Te(t.field),m=Te(t.key),y=(t.groupby||[]).map(Te),v=function(t,e,n,i){var r,s,o,a,u,l,c,h,f=t=>t(h),d=[],p=i?i.slice():[],g={},m={};for(p.forEach(((t,e)=>g[t]=e+1)),a=0,c=t.length;a<c;++a)l=n(h=t[a]),u=g[l]||(g[l]=p.push(l)),(o=m[s=(r=e?e.map(f):Dc)+""])||(o=m[s]=[],d.push(o),o.values=r),o[u-1]=h;return d.domain=p,d}(e.source,t.groupby,t.key,t.keyvals),b=[],x=this.value,w=v.domain.length;for(o=0,l=v.length;o<l;++o)for(r=(n=v[o]).values,i=NaN,u=0;u<w;++u)if(null==n[u]){for(s=v.domain[u],h={_impute:!0},a=0,c=r.length;a<c;++a)h[y[a]]=r[a];h[m]=s,h[g]=Number.isNaN(i)?i=d(n,p):i,b.push(tu(h))}return b.length&&(f.add=f.materialize(f.ADD).add.concat(b)),x.length&&(f.rem=f.materialize(f.REM).rem.concat(x)),this.value=b,f}}),Sc.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Ul},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},Nn(Sc,Kl,{transform(t,e){const n=this,i=t.modified();let r;return n.value&&(i||e.modified(n._inputs,!0))?(r=n.value=i?n.init(t):{},e.visit(e.SOURCE,(t=>n.add(t)))):(r=n.value=n.value||this.init(t),e.visit(e.REM,(t=>n.rem(t))),e.visit(e.ADD,(t=>n.add(t)))),n.changes(),e.visit(e.SOURCE,(t=>{Cn(t,r[n.cellkey(t)].tuple)})),e.reflow(i).modifies(this._outputs)},changes(){const t=this._adds,e=this._mods;let n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(t[n]),t[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(e[n]),e[n]=null;this._alen=this._mlen=0}}),Oc.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},Nn(Oc,Ou,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=e.materialize(e.SOURCE).source,r=fc(i,t.groupby,t.field),s=(t.groupby||[]).map(Te),o=t.bandwidth,a=t.cumulative?"cdf":"pdf",u=t.as||["value","density"],l=[];let c=t.extent,h=t.steps||t.minsteps||25,f=t.steps||t.maxsteps||200;"pdf"!==a&&"cdf"!==a&&Le("Invalid density method: "+a),"shared"===t.resolve&&(c||(c=En(i,t.field)),h=f=t.steps||f),r.forEach((e=>{const n=al(e,o)[a],i=t.counts?e.length:1;$l(n,c||En(e),h,f).forEach((t=>{const n={};for(let t=0;t<s.length;++t)n[s[t]]=e.dims[t];n[u[0]]=t[0],n[u[1]]=t[1]*i,l.push(tu(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}}),Nn(Nc,hu),Nn(zc,Ou,{transform(t,e){const n=e.dataflow;return this._pending?$c(this,e,this._pending):function(t){return t.modified("async")&&!(t.modified("values")||t.modified("url")||t.modified("format"))}(t)?e.StopPropagation:t.values?$c(this,e,n.parse(t.values,t.format)):t.async?{async:n.request(t.url,t.format).then((t=>(this._pending=mn(t.data),t=>t.touch(this))))}:n.request(t.url,t.format).then((t=>$c(this,e,mn(t.data))))}}),Tc.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},Nn(Tc,Ou,{transform(t,e){const n=t.fields,i=t.index,r=t.values,s=null==t.default?null:t.default,o=t.modified(),a=n.length;let u,l,c,h=o?e.SOURCE:e.ADD,f=e,d=t.as;return r?(l=r.length,a>1&&!d&&Le('Multi-field lookup requires explicit "as" parameter.'),d&&d.length!==a*l&&Le('The "as" parameter has too few output field names.'),d=d||r.map(Te),u=function(t){for(var e,o,u=0,c=0;u<a;++u)if(null==(o=i.get(n[u](t))))for(e=0;e<l;++e,++c)t[d[c]]=s;else for(e=0;e<l;++e,++c)t[d[c]]=r[e](o)}):(d||Le("Missing output field names."),u=function(t){for(var e,r=0;r<a;++r)e=i.get(n[r](t)),t[d[r]]=null==e?s:e}),o?f=e.reflow(!0):(c=n.some((t=>e.modified(t.fields))),h|=c?e.MOD:0),e.visit(h,u),f.modifies(d)}}),Nn(Bc,hu),Nn(Ic,hu),Nn(Lc,Ou,{transform(t,e){return this.modified(t.modified()),this.value=t,e.fork(e.NO_SOURCE|e.NO_FIELDS)}}),Pc.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Ul,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},Nn(Pc,Kl,{_transform:Kl.prototype.transform,transform(t,e){return this._transform(function(t,e){const n=t.field,i=t.value,r=("count"===t.op?"__count__":t.op)||"sum",s=Be(n).concat(Be(i)),o=function(t,e,n){const i={},r=[];return n.visit(n.SOURCE,(e=>{const n=t(e);i[n]||(i[n]=1,r.push(n))})),r.sort(bn),e?r.slice(0,e):r}(n,t.limit||0,e);return e.changed()&&t.set("__pivot__",null,null,!0),{key:t.key,groupby:t.groupby,ops:o.map((()=>r)),fields:o.map((t=>function(t,e,n,i){return $e((i=>e(i)===t?n(i):NaN),i,t+"")}(t,n,i,s))),as:o.map((t=>t+"")),modified:t.modified.bind(t)}}(t,e),e)}}),Nn(Uc,vc,{transform(t,e){const n=t.subflow,i=t.field,r=t=>this.subflow(Ka(t),n,e,t);return(t.modified("field")||i&&e.modified(Be(i)))&&Le("PreFacet does not support field modification."),this.initTargets(),i?(e.visit(e.MOD,(t=>{const e=r(t);i(t).forEach((t=>e.mod(t)))})),e.visit(e.ADD,(t=>{const e=r(t);i(t).forEach((t=>e.add(tu(t))))})),e.visit(e.REM,(t=>{const e=r(t);i(t).forEach((t=>e.rem(t)))}))):(e.visit(e.MOD,(t=>r(t).mod(t))),e.visit(e.ADD,(t=>r(t).add(t))),e.visit(e.REM,(t=>r(t).rem(t)))),e.clean()&&e.runAfter((()=>this.clean())),e}}),qc.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},Nn(qc,Ou,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.fields,r=hc(t.fields,t.as||[]),s=i?(t,e)=>function(t,e,n,i){for(let r=0,s=n.length;r<s;++r)e[i[r]]=n[r](t);return e}(t,e,i,r):nu;let o;return this.value?o=this.value:(e=e.addAll(),o=this.value={}),e.visit(e.REM,(t=>{const e=Ka(t);n.rem.push(o[e]),o[e]=null})),e.visit(e.ADD,(t=>{const e=s(t,tu({}));o[Ka(t)]=e,n.add.push(e)})),e.visit(e.MOD,(t=>{n.mod.push(s(t,o[Ka(t)]))})),n}}),Nn(Wc,Ou,{transform(t,e){return this.value=t.value,t.modified("value")?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}}),Hc.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]},Nn(Hc,Ou,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.as||["prob","value"];if(this.value&&!t.modified()&&!e.changed())return n.source=this.value,n;const r=fc(e.materialize(e.SOURCE).source,t.groupby,t.field),s=(t.groupby||[]).map(Te),o=[],a=t.step||.01,u=t.probs||Bl(a/2,1-1e-14,a),l=u.length;return r.forEach((t=>{const e=qu(t,u);for(let n=0;n<l;++n){const r={};for(let e=0;e<s.length;++e)r[s[e]]=t.dims[e];r[i[0]]=u[n],r[i[1]]=e[n],o.push(tu(r))}})),this.value&&(n.rem=this.value),this.value=n.add=n.source=o,n}}),Nn(Vc,Ou,{transform(t,e){let n,i;return this.value?i=this.value:(n=e=e.addAll(),i=this.value={}),t.derive&&(n=e.fork(e.NO_SOURCE),e.visit(e.REM,(t=>{const e=Ka(t);n.rem.push(i[e]),i[e]=null})),e.visit(e.ADD,(t=>{const e=eu(t);i[Ka(t)]=e,n.add.push(e)})),e.visit(e.MOD,(t=>{const e=i[Ka(t)];for(const i in t)e[i]=t[i],n.modifies(i);n.mod.push(e)}))),n}}),Gc.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},Nn(Gc,Ou,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.modified("size"),r=t.size,s=this.value.reduce(((t,e)=>(t[Ka(e)]=1,t)),{});let o=this.value,a=this.count,u=0;function l(t){let e,i;o.length<r?o.push(t):(i=~~((a+1)*Gu()),i<o.length&&i>=u&&(e=o[i],s[Ka(e)]&&n.rem.push(e),o[i]=t)),++a}if(e.rem.length&&(e.visit(e.REM,(t=>{const e=Ka(t);s[e]&&(s[e]=-1,n.rem.push(t)),--a})),o=o.filter((t=>-1!==s[Ka(t)]))),(e.rem.length||i)&&o.length<r&&e.source&&(u=a=o.length,e.visit(e.SOURCE,(t=>{s[Ka(t)]||l(t)})),u=-1),i&&o.length>r){const t=o.length-r;for(let e=0;e<t;++e)s[Ka(o[e])]=-1,n.rem.push(o[e]);o=o.slice(t)}return e.mod.length&&e.visit(e.MOD,(t=>{s[Ka(t)]&&n.mod.push(t)})),e.add.length&&e.visit(e.ADD,l),(e.add.length||u<0)&&(n.add=o.filter((t=>!s[Ka(t)]))),this.count=a,this.value=n.source=o,n}}),Xc.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},Nn(Xc,Ou,{transform(t,e){if(this.value&&!t.modified())return;const n=e.materialize().fork(e.MOD),i=t.as||"data";return n.rem=this.value?e.rem.concat(this.value):e.rem,this.value=Bl(t.start,t.stop,t.step||1).map((t=>{const e={};return e[i]=t,tu(e)})),n.add=e.add.concat(this.value),n}}),Nn(Yc,Ou,{transform(t,e){return this.value=e.source,e.changed()?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}});const Zc=["unit0","unit1"];function Kc(t){Ou.call(this,On(),t)}function Qc(t){Ou.call(this,null,t)}Jc.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:Ir,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Zc}]},Nn(Jc,Ou,{transform(t,e){const n=t.field,i=!1!==t.interval,r="utc"===t.timezone,s=this._floor(t,e),o=(r?ps:ds)(s.unit).offset,a=t.as||Zc,u=a[0],l=a[1],c=s.step;let h=s.start||1/0,f=s.stop||-1/0,d=e.ADD;return(t.modified()||e.modified(Be(n)))&&(d=(e=e.reflow(!0)).SOURCE,h=1/0,f=-1/0),e.visit(d,(t=>{const e=n(t);let r,a;null==e?(t[u]=null,i&&(t[l]=null)):(t[u]=r=a=s(e),i&&(t[l]=a=o(r,c)),r<h&&(h=r),a>f&&(f=a))})),s.start=h,s.stop=f,e.modifies(i?a:u)},_floor(t,e){const n="utc"===t.timezone,{units:i,step:r}=t.units?{units:t.units,step:t.step||1}:Os({extent:t.extent||En(e.materialize(e.SOURCE).source,t.field),maxbins:t.maxbins}),s=Lr(i),o=this.value||{},a=(n?cs:as)(s,r);return a.unit=nn(s),a.units=s,a.step=r,a.start=o.start,a.stop=o.stop,this.value=a}}),Nn(Kc,Ou,{transform(t,e){const n=e.dataflow,i=t.field,r=this.value,s=t=>r.set(i(t),t);let o=!0;return t.modified("field")||e.modified(i.fields)?(r.clear(),e.visit(e.SOURCE,s)):e.changed()?(e.visit(e.REM,(t=>r.delete(i(t)))),e.visit(e.ADD,s)):o=!1,this.modified(o),r.empty>n.cleanThreshold&&n.runAfter(r.clean),e.fork()}}),Nn(Qc,Ou,{transform(t,e){(!this.value||t.modified("field")||t.modified("sort")||e.changed()||t.sort&&e.modified(t.sort.fields))&&(this.value=(t.sort?e.source.slice().sort(ru(t.sort)):e.source).map(t.field))}});const th={row_number:function(){return{next:t=>t.index+1}},rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,i=e.data;return n&&e.compare(i[n-1],i[n])?t=n+1:t}}},dense_rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,i=e.data;return n&&e.compare(i[n-1],i[n])?++t:t}}},percent_rank:function(){const t=th.rank(),e=t.next;return{init:t.init,next:t=>(e(t)-1)/(t.data.length-1)}},cume_dist:function(){let t;return{init:()=>t=0,next:e=>{const n=e.data,i=e.compare;let r=e.index;if(t<r){for(;r+1<n.length&&!i(n[r],n[r+1]);)++r;t=r}return(1+t)/n.length}}},ntile:function(t,e){(e=+e)>0||Le("ntile num must be greater than zero.");const n=th.cume_dist(),i=n.next;return{init:n.init,next:t=>Math.ceil(e*i(t))}},lag:function(t,e){return e=+e||1,{next:n=>{const i=n.index-e;return i>=0?t(n.data[i]):null}}},lead:function(t,e){return e=+e||1,{next:n=>{const i=n.index+e,r=n.data;return i<r.length?t(r[i]):null}}},first_value:function(t){return{next:e=>t(e.data[e.i0])}},last_value:function(t){return{next:e=>t(e.data[e.i1-1])}},nth_value:function(t,e){return(e=+e)>0||Le("nth_value nth must be greater than zero."),{next:n=>{const i=n.i0+(e-1);return i<n.i1?t(n.data[i]):null}}},prev_value:function(t){let e;return{init:()=>e=null,next:n=>{const i=t(n.data[n.index]);return null!=i?e=i:e}}},next_value:function(t){let e,n;return{init:()=>(e=null,n=-1),next:i=>{const r=i.data;return i.index<=n?e:(n=function(t,e,n){for(let i=e.length;n<i;++n)if(null!=t(e[n]))return n;return-1}(t,r,i.index))<0?(n=r.length,e=null):e=t(r[n])}}}},eh=Object.keys(th);function nh(t){const e=mn(t.ops),n=mn(t.fields),i=mn(t.params),r=mn(t.as),s=this.outputs=[],o=this.windows=[],a={},u={},l=[],c=[];let h=!0;function f(t){mn(Be(t)).forEach((t=>a[t]=1))}f(t.sort),e.forEach(((t,e)=>{const a=n[e],d=Te(a),p=Il(t,d,r[e]);if(f(a),s.push(p),Fn(th,t))o.push(function(t,e,n,i){const r=th[t](e,n);return{init:r.init||He,update:function(t,e){e[i]=r.next(t)}}}(t,n[e],i[e],p));else{if(null==a&&"count"!==t&&Le("Null aggregate field specified."),"count"===t)return void l.push(p);h=!1;let e=u[d];e||(e=u[d]=[],e.field=a,c.push(e)),e.push(ql(t,p))}})),(l.length||c.length)&&(this.cell=function(t,e,n){t=t.map((t=>Yl(t,t.field)));const i={num:0,agg:null,store:!1,count:e};if(!n)for(var r=t.length,s=i.agg=Array(r),o=0;o<r;++o)s[o]=new t[o](i);if(i.store)var a=i.data=new Jl;return i.add=function(t){if(i.num+=1,!n){a&&a.add(t);for(let e=0;e<r;++e)s[e].add(s[e].get(t),t)}},i.rem=function(t){if(i.num-=1,!n){a&&a.rem(t);for(let e=0;e<r;++e)s[e].rem(s[e].get(t),t)}},i.set=function(t){let r,o;for(a&&a.values(),r=0,o=e.length;r<o;++r)t[e[r]]=i.num;if(!n)for(r=0,o=s.length;r<o;++r)s[r].set(t)},i.init=function(){i.num=0,a&&a.reset();for(let t=0;t<r;++t)s[t].init()},i}(c,l,h)),this.inputs=Object.keys(a)}const ih=nh.prototype;function rh(t){Ou.call(this,{},t),this._mlen=0,this._mods=[]}function sh(t,e,n,i){const r=i.sort,s=r&&!i.ignorePeers,o=i.frame||[null,0],a=t.data(n),u=a.length,l=s?Er(r):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:a,compare:r||_n(-1)};e.init();for(let t=0;t<u;++t)oh(c,o,t,u),s&&ah(c,l),e.update(c,a[t])}function oh(t,e,n,i){t.p0=t.i0,t.p1=t.i1,t.i0=null==e[0]?0:Math.max(0,n-Math.abs(e[0])),t.i1=null==e[1]?i:Math.min(i,n+Math.abs(e[1])+1),t.index=n}function ah(t,e){const n=t.i0,i=t.i1-1,r=t.compare,s=t.data,o=s.length-1;n>0&&!r(s[n],s[n-1])&&(t.i0=e.left(s,s[n])),i<o&&!r(s[i],s[i+1])&&(t.i1=e.right(s,s[i]))}function uh(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function lh(t){this._context=t}function ch(){}function hh(t){this._context=t}function fh(t){this._context=t}function dh(t,e){this._basis=new lh(t),this._beta=e}ih.init=function(){this.windows.forEach((t=>t.init())),this.cell&&this.cell.init()},ih.update=function(t,e){const n=this.cell,i=this.windows,r=t.data,s=i&&i.length;let o;if(n){for(o=t.p0;o<t.i0;++o)n.rem(r[o]);for(o=t.p1;o<t.i1;++o)n.add(r[o]);n.set(e)}for(o=0;o<s;++o)i[o].update(t,e)},rh.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:eh.concat(Ul)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},Nn(rh,Ou,{transform(t,e){this.stamp=e.stamp;const n=t.modified(),i=ru(t.sort),r=jl(t.groupby),s=t=>this.group(r(t));let o=this.state;o&&!n||(o=this.state=new nh(t)),n||e.modified(o.inputs)?(this.value={},e.visit(e.SOURCE,(t=>s(t).add(t)))):(e.visit(e.REM,(t=>s(t).remove(t))),e.visit(e.ADD,(t=>s(t).add(t))));for(let e=0,n=this._mlen;e<n;++e)sh(this._mods[e],o,i,t);return this._mlen=0,this._mods=[],e.reflow(n).modifies(o.outputs)},group(t){let e=this.value[t];return e||(e=this.value[t]=tc(Ka),e.stamp=-1),e.stamp<this.stamp&&(e.stamp=this.stamp,this._mods[this._mlen++]=e),e}}),lh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:uh(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:uh(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},hh.prototype={areaStart:ch,areaEnd:ch,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:uh(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},fh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,i=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:uh(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},dh.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var i,r=t[0],s=e[0],o=t[n]-r,a=e[n]-s,u=-1;++u<=n;)i=u/n,this._basis.point(this._beta*t[u]+(1-this._beta)*(r+i*o),this._beta*e[u]+(1-this._beta)*(s+i*a));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};const ph=function t(e){function n(t){return 1===e?new lh(t):new dh(t,e)}return n.beta=function(e){return t(+e)},n}(.85);function gh(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function mh(t,e){this._context=t,this._k=(1-e)/6}mh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:gh(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:gh(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const yh=function t(e){function n(t){return new mh(t,e)}return n.tension=function(e){return t(+e)},n}(0);function vh(t,e){this._context=t,this._k=(1-e)/6}vh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:gh(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const bh=function t(e){function n(t){return new vh(t,e)}return n.tension=function(e){return t(+e)},n}(0);function xh(t,e){this._context=t,this._k=(1-e)/6}xh.prototype={areaStart:ch,areaEnd:ch,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:gh(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const wh=function t(e){function n(t){return new xh(t,e)}return n.tension=function(e){return t(+e)},n}(0);var Ah=Math.abs,_h=Math.atan2,kh=Math.cos,Ch=Math.max,Eh=Math.min,Dh=Math.sin,Fh=Math.sqrt,Sh=1e-12,Oh=Math.PI,Nh=Oh/2,Mh=2*Oh;function zh(t){return t>1?0:t<-1?Oh:Math.acos(t)}function $h(t){return t>=1?Nh:t<=-1?-Nh:Math.asin(t)}function Th(t,e,n){var i=t._x1,r=t._y1,s=t._x2,o=t._y2;if(t._l01_a>Sh){var a=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,u=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*a-t._x0*t._l12_2a+t._x2*t._l01_2a)/u,r=(r*a-t._y0*t._l12_2a+t._y2*t._l01_2a)/u}if(t._l23_a>Sh){var l=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,c=3*t._l23_a*(t._l23_a+t._l12_a);s=(s*l+t._x1*t._l23_2a-e*t._l12_2a)/c,o=(o*l+t._y1*t._l23_2a-n*t._l12_2a)/c}t._context.bezierCurveTo(i,r,s,o,t._x2,t._y2)}function Bh(t,e){this._context=t,this._alpha=e}Bh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:Th(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const jh=function t(e){function n(t){return e?new Bh(t,e):new mh(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Ih(t,e){this._context=t,this._alpha=e}Ih.prototype={areaStart:ch,areaEnd:ch,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Th(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Rh=function t(e){function n(t){return e?new Ih(t,e):new xh(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Lh(t,e){this._context=t,this._alpha=e}Lh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Th(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Ph=function t(e){function n(t){return e?new Lh(t,e):new vh(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Uh(t){this._context=t}function qh(t){return new Uh(t)}function Wh(t){this._context=t}function Hh(t){return t<0?-1:1}function Vh(t,e,n){var i=t._x1-t._x0,r=e-t._x1,s=(t._y1-t._y0)/(i||r<0&&-0),o=(n-t._y1)/(r||i<0&&-0),a=(s*r+o*i)/(i+r);return(Hh(s)+Hh(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function Gh(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function Xh(t,e,n){var i=t._x0,r=t._y0,s=t._x1,o=t._y1,a=(s-i)/3;t._context.bezierCurveTo(i+a,r+a*e,s-a,o-a*n,s,o)}function Yh(t){this._context=t}function Jh(t){this._context=new Zh(t)}function Zh(t){this._context=t}function Kh(t){this._context=t}function Qh(t){var e,n,i=t.length-1,r=new Array(i),s=new Array(i),o=new Array(i);for(r[0]=0,s[0]=2,o[0]=t[0]+2*t[1],e=1;e<i-1;++e)r[e]=1,s[e]=4,o[e]=4*t[e]+2*t[e+1];for(r[i-1]=2,s[i-1]=7,o[i-1]=8*t[i-1]+t[i],e=1;e<i;++e)n=r[e]/s[e-1],s[e]-=n,o[e]-=n*o[e-1];for(r[i-1]=o[i-1]/s[i-1],e=i-2;e>=0;--e)r[e]=(o[e]-r[e+1])/s[e];for(s[i-1]=(t[i]+r[i-1])/2,e=0;e<i-1;++e)s[e]=2*t[e+1]-r[e+1];return[r,s]}function tf(t,e){this._context=t,this._t=e}Uh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}},Wh.prototype={areaStart:ch,areaEnd:ch,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}},Yh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Xh(this,this._t0,Gh(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,Xh(this,Gh(this,n=Vh(this,t,e)),n);break;default:Xh(this,this._t0,n=Vh(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(Jh.prototype=Object.create(Yh.prototype)).point=function(t,e){Yh.prototype.point.call(this,e,t)},Zh.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,i,r,s){this._context.bezierCurveTo(e,t,i,n,s,r)}},Kh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===n)this._context.lineTo(t[1],e[1]);else for(var i=Qh(t),r=Qh(e),s=0,o=1;o<n;++s,++o)this._context.bezierCurveTo(i[0][s],r[0][s],i[1][s],r[1][s],t[o],e[o]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}},tf.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};const ef=Math.PI,nf=2*ef,rf=1e-6,sf=nf-rf;function of(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function af(){return new of}of.prototype=af.prototype={constructor:of,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(t,e,n,i,r,s){this._+="C"+ +t+","+ +e+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+s)},arcTo:function(t,e,n,i,r){t=+t,e=+e,n=+n,i=+i,r=+r;var s=this._x1,o=this._y1,a=n-t,u=i-e,l=s-t,c=o-e,h=l*l+c*c;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(h>rf)if(Math.abs(c*a-u*l)>rf&&r){var f=n-s,d=i-o,p=a*a+u*u,g=f*f+d*d,m=Math.sqrt(p),y=Math.sqrt(h),v=r*Math.tan((ef-Math.acos((p+h-g)/(2*m*y)))/2),b=v/y,x=v/m;Math.abs(b-1)>rf&&(this._+="L"+(t+b*l)+","+(e+b*c)),this._+="A"+r+","+r+",0,0,"+ +(c*f>l*d)+","+(this._x1=t+x*a)+","+(this._y1=e+x*u)}else this._+="L"+(this._x1=t)+","+(this._y1=e)},arc:function(t,e,n,i,r,s){t=+t,e=+e,s=!!s;var o=(n=+n)*Math.cos(i),a=n*Math.sin(i),u=t+o,l=e+a,c=1^s,h=s?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+u+","+l:(Math.abs(this._x1-u)>rf||Math.abs(this._y1-l)>rf)&&(this._+="L"+u+","+l),n&&(h<0&&(h=h%nf+nf),h>sf?this._+="A"+n+","+n+",0,1,"+c+","+(t-o)+","+(e-a)+"A"+n+","+n+",0,1,"+c+","+(this._x1=u)+","+(this._y1=l):h>rf&&(this._+="A"+n+","+n+",0,"+ +(h>=ef)+","+c+","+(this._x1=t+n*Math.cos(r))+","+(this._y1=e+n*Math.sin(r))))},rect:function(t,e,n,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};const uf=af;function lf(t){return function(){return t}}function cf(t){return t.innerRadius}function hf(t){return t.outerRadius}function ff(t){return t.startAngle}function df(t){return t.endAngle}function pf(t){return t&&t.padAngle}function gf(t,e,n,i,r,s,o,a){var u=n-t,l=i-e,c=o-r,h=a-s,f=h*u-c*l;if(!(f*f<Sh))return[t+(f=(c*(e-s)-h*(t-r))/f)*u,e+f*l]}function mf(t,e,n,i,r,s,o){var a=t-n,u=e-i,l=(o?s:-s)/Fh(a*a+u*u),c=l*u,h=-l*a,f=t+c,d=e+h,p=n+c,g=i+h,m=(f+p)/2,y=(d+g)/2,v=p-f,b=g-d,x=v*v+b*b,w=r-s,A=f*g-p*d,_=(b<0?-1:1)*Fh(Ch(0,w*w*x-A*A)),k=(A*b-v*_)/x,C=(-A*v-b*_)/x,E=(A*b+v*_)/x,D=(-A*v+b*_)/x,F=k-m,S=C-y,O=E-m,N=D-y;return F*F+S*S>O*O+N*N&&(k=E,C=D),{cx:k,cy:C,x01:-c,y01:-h,x11:k*(r/w-1),y11:C*(r/w-1)}}function yf(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function vf(t){return t[0]}function bf(t){return t[1]}function xf(t,e){var n=lf(!0),i=null,r=qh,s=null;function o(o){var a,u,l,c=(o=yf(o)).length,h=!1;for(null==i&&(s=r(l=uf())),a=0;a<=c;++a)!(a<c&&n(u=o[a],a,o))===h&&((h=!h)?s.lineStart():s.lineEnd()),h&&s.point(+t(u,a,o),+e(u,a,o));if(l)return s=null,l+""||null}return t="function"==typeof t?t:void 0===t?vf:lf(t),e="function"==typeof e?e:void 0===e?bf:lf(e),o.x=function(e){return arguments.length?(t="function"==typeof e?e:lf(+e),o):t},o.y=function(t){return arguments.length?(e="function"==typeof t?t:lf(+t),o):e},o.defined=function(t){return arguments.length?(n="function"==typeof t?t:lf(!!t),o):n},o.curve=function(t){return arguments.length?(r=t,null!=i&&(s=r(i)),o):r},o.context=function(t){return arguments.length?(null==t?i=s=null:s=r(i=t),o):i},o}function wf(t,e,n){var i=null,r=lf(!0),s=null,o=qh,a=null;function u(u){var l,c,h,f,d,p=(u=yf(u)).length,g=!1,m=new Array(p),y=new Array(p);for(null==s&&(a=o(d=uf())),l=0;l<=p;++l){if(!(l<p&&r(f=u[l],l,u))===g)if(g=!g)c=l,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),h=l-1;h>=c;--h)a.point(m[h],y[h]);a.lineEnd(),a.areaEnd()}g&&(m[l]=+t(f,l,u),y[l]=+e(f,l,u),a.point(i?+i(f,l,u):m[l],n?+n(f,l,u):y[l]))}if(d)return a=null,d+""||null}function l(){return xf().defined(r).curve(o).context(s)}return t="function"==typeof t?t:void 0===t?vf:lf(+t),e="function"==typeof e?e:lf(void 0===e?0:+e),n="function"==typeof n?n:void 0===n?bf:lf(+n),u.x=function(e){return arguments.length?(t="function"==typeof e?e:lf(+e),i=null,u):t},u.x0=function(e){return arguments.length?(t="function"==typeof e?e:lf(+e),u):t},u.x1=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:lf(+t),u):i},u.y=function(t){return arguments.length?(e="function"==typeof t?t:lf(+t),n=null,u):e},u.y0=function(t){return arguments.length?(e="function"==typeof t?t:lf(+t),u):e},u.y1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:lf(+t),u):n},u.lineX0=u.lineY0=function(){return l().x(t).y(e)},u.lineY1=function(){return l().x(t).y(n)},u.lineX1=function(){return l().x(i).y(e)},u.defined=function(t){return arguments.length?(r="function"==typeof t?t:lf(!!t),u):r},u.curve=function(t){return arguments.length?(o=t,null!=s&&(a=o(s)),u):o},u.context=function(t){return arguments.length?(null==t?s=a=null:a=o(s=t),u):s},u}Array.prototype.slice;const Af={draw:function(t,e){var n=Math.sqrt(e/Oh);t.moveTo(n,0),t.arc(0,0,n,0,Mh)}};Math.sqrt(1/3);Math.sin(Oh/10),Math.sin(7*Oh/10);function _f(t,e){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=t,n.height=e,n}return null}Math.sin(Mh/10),Math.cos(Mh/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12);const kf=()=>"undefined"!=typeof Image?Image:null,Cf=Er(Cr),Ef=Cf.right,Df=Cf.left,Ff=(Er(Iu).center,Ef);function Sf(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function Of(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}const Nf=Symbol("implicit");function Mf(){var t=new Map,e=[],n=[],i=Nf;function r(r){var s=r+"",o=t.get(s);if(!o){if(i!==Nf)return i;t.set(s,o=e.push(r))}return n[(o-1)%n.length]}return r.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new Map;for(const i of n){const n=i+"";t.has(n)||t.set(n,e.push(i))}return r},r.range=function(t){return arguments.length?(n=Array.from(t),r):n.slice()},r.unknown=function(t){return arguments.length?(i=t,r):i},r.copy=function(){return Mf(e,n).unknown(i)},Sf.apply(r,arguments),r}function zf(t,e,n,i){var r,s=hi(t,e,n);switch((i=pi(null==i?",f":i)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=i.precision||isNaN(r=vi(s,o))||(i.precision=r),Ei(i,o);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=bi(s,Math.max(Math.abs(t),Math.abs(e))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=xi(s))||(i.precision=r-2*("%"===i.type))}return Ci(i)}function $f(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Tf(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function Bf(){}var jf=.7,If=1/jf,Rf="\\s*([+-]?\\d+)\\s*",Lf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Uf=/^#([0-9a-f]{3,8})$/,qf=new RegExp("^rgb\\("+[Rf,Rf,Rf]+"\\)$"),Wf=new RegExp("^rgb\\("+[Pf,Pf,Pf]+"\\)$"),Hf=new RegExp("^rgba\\("+[Rf,Rf,Rf,Lf]+"\\)$"),Vf=new RegExp("^rgba\\("+[Pf,Pf,Pf,Lf]+"\\)$"),Gf=new RegExp("^hsl\\("+[Lf,Pf,Pf]+"\\)$"),Xf=new RegExp("^hsla\\("+[Lf,Pf,Pf,Lf]+"\\)$"),Yf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Jf(){return this.rgb().formatHex()}function Zf(){return this.rgb().formatRgb()}function Kf(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Uf.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Qf(e):3===n?new id(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?td(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?td(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=qf.exec(t))?new id(e[1],e[2],e[3],1):(e=Wf.exec(t))?new id(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Hf.exec(t))?td(e[1],e[2],e[3],e[4]):(e=Vf.exec(t))?td(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Gf.exec(t))?ad(e[1],e[2]/100,e[3]/100,1):(e=Xf.exec(t))?ad(e[1],e[2]/100,e[3]/100,e[4]):Yf.hasOwnProperty(t)?Qf(Yf[t]):"transparent"===t?new id(NaN,NaN,NaN,0):null}function Qf(t){return new id(t>>16&255,t>>8&255,255&t,1)}function td(t,e,n,i){return i<=0&&(t=e=n=NaN),new id(t,e,n,i)}function ed(t){return t instanceof Bf||(t=Kf(t)),t?new id((t=t.rgb()).r,t.g,t.b,t.opacity):new id}function nd(t,e,n,i){return 1===arguments.length?ed(t):new id(t,e,n,null==i?1:i)}function id(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function rd(){return"#"+od(this.r)+od(this.g)+od(this.b)}function sd(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function od(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function ad(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new cd(t,e,n,i)}function ud(t){if(t instanceof cd)return new cd(t.h,t.s,t.l,t.opacity);if(t instanceof Bf||(t=Kf(t)),!t)return new cd;if(t instanceof cd)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=NaN,a=s-r,u=(s+r)/2;return a?(o=e===s?(n-i)/a+6*(n<i):n===s?(i-e)/a+2:(e-n)/a+4,a/=u<.5?s+r:2-s-r,o*=60):a=u>0&&u<1?0:o,new cd(o,a,u,t.opacity)}function ld(t,e,n,i){return 1===arguments.length?ud(t):new cd(t,e,n,null==i?1:i)}function cd(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function hd(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function fd(t,e,n,i,r){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*n+(1+3*t+3*s-3*o)*i+o*r)/6}function dd(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],s=t[i+1],o=i>0?t[i-1]:2*r-s,a=i<e-1?t[i+2]:2*s-r;return fd((n-i/e)*e,o,r,s,a)}}function pd(t){var e=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*e),r=t[(i+e-1)%e],s=t[i%e],o=t[(i+1)%e],a=t[(i+2)%e];return fd((n-i/e)*e,r,s,o,a)}}$f(Bf,Kf,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Jf,formatHex:Jf,formatHsl:function(){return ud(this).formatHsl()},formatRgb:Zf,toString:Zf}),$f(id,nd,Tf(Bf,{brighter:function(t){return t=null==t?If:Math.pow(If,t),new id(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?jf:Math.pow(jf,t),new id(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rd,formatHex:rd,formatRgb:sd,toString:sd})),$f(cd,ld,Tf(Bf,{brighter:function(t){return t=null==t?If:Math.pow(If,t),new cd(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?jf:Math.pow(jf,t),new cd(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new id(hd(t>=240?t-240:t+120,r,i),hd(t,r,i),hd(t<120?t+240:t-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));const gd=t=>()=>t;function md(t,e){return function(n){return t+n*e}}function yd(t,e){var n=e-t;return n?md(t,n>180||n<-180?n-360*Math.round(n/360):n):gd(isNaN(t)?e:t)}function vd(t,e){var n=e-t;return n?md(t,n):gd(isNaN(t)?e:t)}const bd=function t(e){var n=function(t){return 1==(t=+t)?vd:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):gd(isNaN(e)?n:e)}}(e);function i(t,e){var i=n((t=nd(t)).r,(e=nd(e)).r),r=n(t.g,e.g),s=n(t.b,e.b),o=vd(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=s(e),t.opacity=o(e),t+""}}return i.gamma=t,i}(1);function xd(t){return function(e){var n,i,r=e.length,s=new Array(r),o=new Array(r),a=new Array(r);for(n=0;n<r;++n)i=nd(e[n]),s[n]=i.r||0,o[n]=i.g||0,a[n]=i.b||0;return s=t(s),o=t(o),a=t(a),i.opacity=1,function(t){return i.r=s(t),i.g=o(t),i.b=a(t),i+""}}}var wd=xd(dd),Ad=xd(pd);function _d(t,e){e||(e=[]);var n,i=t?Math.min(e.length,t.length):0,r=e.slice();return function(s){for(n=0;n<i;++n)r[n]=t[n]*(1-s)+e[n]*s;return r}}function kd(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Cd(t,e){return(kd(e)?_d:Ed)(t,e)}function Ed(t,e){var n,i=e?e.length:0,r=t?Math.min(i,t.length):0,s=new Array(r),o=new Array(i);for(n=0;n<r;++n)s[n]=zd(t[n],e[n]);for(;n<i;++n)o[n]=e[n];return function(t){for(n=0;n<r;++n)o[n]=s[n](t);return o}}function Dd(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Fd(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Sd(t,e){var n,i={},r={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?i[n]=zd(t[n],e[n]):r[n]=e[n];return function(t){for(n in i)r[n]=i[n](t);return r}}var Od=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Nd=new RegExp(Od.source,"g");function Md(t,e){var n,i,r,s=Od.lastIndex=Nd.lastIndex=0,o=-1,a=[],u=[];for(t+="",e+="";(n=Od.exec(t))&&(i=Nd.exec(e));)(r=i.index)>s&&(r=e.slice(s,r),a[o]?a[o]+=r:a[++o]=r),(n=n[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,u.push({i:o,x:Fd(n,i)})),s=Nd.lastIndex;return s<e.length&&(r=e.slice(s),a[o]?a[o]+=r:a[++o]=r),a.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,i=0;i<e;++i)a[(n=u[i]).i]=n.x(t);return a.join("")})}function zd(t,e){var n,i=typeof e;return null==e||"boolean"===i?gd(e):("number"===i?Fd:"string"===i?(n=Kf(e))?(e=n,bd):Md:e instanceof Kf?bd:e instanceof Date?Dd:kd(e)?_d:Array.isArray(e)?Ed:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?Sd:Fd)(t,e)}function $d(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Td(t){return+t}var Bd=[0,1];function jd(t){return t}function Id(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:function(t){return function(){return t}}(isNaN(e)?NaN:.5)}function Rd(t,e,n){var i=t[0],r=t[1],s=e[0],o=e[1];return r<i?(i=Id(r,i),s=n(o,s)):(i=Id(i,r),s=n(s,o)),function(t){return s(i(t))}}function Ld(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),s=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=Id(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(e){var n=Ff(t,e,1,i)-1;return s[n](r[n](e))}}function Pd(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Ud(){var t,e,n,i,r,s,o=Bd,a=Bd,u=zd,l=jd;function c(){var t=Math.min(o.length,a.length);return l!==jd&&(l=function(t,e){var n;return t>e&&(n=t,t=e,e=n),function(n){return Math.max(t,Math.min(e,n))}}(o[0],o[t-1])),i=t>2?Ld:Rd,r=s=null,h}function h(e){return null==e||isNaN(e=+e)?n:(r||(r=i(o.map(t),a,u)))(t(l(e)))}return h.invert=function(n){return l(e((s||(s=i(a,o.map(t),Fd)))(n)))},h.domain=function(t){return arguments.length?(o=Array.from(t,Td),c()):o.slice()},h.range=function(t){return arguments.length?(a=Array.from(t),c()):a.slice()},h.rangeRound=function(t){return a=Array.from(t),u=$d,c()},h.clamp=function(t){return arguments.length?(l=!!t||jd,c()):l!==jd},h.interpolate=function(t){return arguments.length?(u=t,c()):u},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,i){return t=n,e=i,c()}}function qd(){return Ud()(jd,jd)}function Wd(t){var e=t.domain;return t.ticks=function(t){var n=e();return li(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var i=e();return zf(i[0],i[i.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var i,r,s=e(),o=0,a=s.length-1,u=s[o],l=s[a],c=10;for(l<u&&(r=u,u=l,l=r,r=o,o=a,a=r);c-- >0;){if((r=ci(u,l,n))===i)return s[o]=u,s[a]=l,e(s);if(r>0)u=Math.floor(u/r)*r,l=Math.ceil(l/r)*r;else{if(!(r<0))break;u=Math.ceil(u*r)/r,l=Math.floor(l*r)/r}i=r}return t},t}function Hd(t,e){var n,i=0,r=(t=t.slice()).length-1,s=t[i],o=t[r];return o<s&&(n=i,i=r,r=n,n=s,s=o,o=n),t[i]=e.floor(s),t[r]=e.ceil(o),t}function Vd(t){return Math.log(t)}function Gd(t){return Math.exp(t)}function Xd(t){return-Math.log(-t)}function Yd(t){return-Math.exp(-t)}function Jd(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Zd(t){return function(e){return-t(-e)}}function Kd(t){var e,n,i=t(Vd,Gd),r=i.domain,s=10;function o(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(s),n=function(t){return 10===t?Jd:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(s),r()[0]<0?(e=Zd(e),n=Zd(n),t(Xd,Yd)):t(Vd,Gd),i}return i.base=function(t){return arguments.length?(s=+t,o()):s},i.domain=function(t){return arguments.length?(r(t),o()):r()},i.ticks=function(t){var i,o=r(),a=o[0],u=o[o.length-1];(i=u<a)&&(f=a,a=u,u=f);var l,c,h,f=e(a),d=e(u),p=null==t?10:+t,g=[];if(!(s%1)&&d-f<p){if(f=Math.floor(f),d=Math.ceil(d),a>0){for(;f<=d;++f)for(c=1,l=n(f);c<s;++c)if(!((h=l*c)<a)){if(h>u)break;g.push(h)}}else for(;f<=d;++f)for(c=s-1,l=n(f);c>=1;--c)if(!((h=l*c)<a)){if(h>u)break;g.push(h)}2*g.length<p&&(g=li(a,u,p))}else g=li(f,d,Math.min(d-f,p)).map(n);return i?g.reverse():g},i.tickFormat=function(t,r){if(null==r&&(r=10===s?".0e":","),"function"!=typeof r&&(r=Ci(r)),t===1/0)return r;null==t&&(t=10);var o=Math.max(1,s*t/i.ticks().length);return function(t){var i=t/n(Math.round(e(t)));return i*s<s-.5&&(i*=s),i<=o?r(t):""}},i.nice=function(){return r(Hd(r(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},i}function Qd(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function tp(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function ep(t){return t<0?-t*t:t*t}function np(t){var e=t(jd,jd),n=1;function i(){return 1===n?t(jd,jd):.5===n?t(tp,ep):t(Qd(n),Qd(1/n))}return e.exponent=function(t){return arguments.length?(n=+t,i()):n},Wd(e)}function ip(){var t=np(Ud());return t.copy=function(){return Pd(t,ip()).exponent(t.exponent())},Sf.apply(t,arguments),t}function rp(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function sp(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function op(t){var e=1,n=t(rp(e),sp(e));return n.constant=function(n){return arguments.length?t(rp(e=+n),sp(e)):e},Wd(n)}function ap(t,e,n,i,r,s){const o=[[pr,1,zi],[pr,5,5e3],[pr,15,15e3],[pr,30,3e4],[s,1,$i],[s,5,3e5],[s,15,9e5],[s,30,18e5],[r,1,Ti],[r,3,108e5],[r,6,216e5],[r,12,432e5],[i,1,Bi],[i,2,1728e5],[n,1,ji],[e,1,2592e6],[e,3,7776e6],[t,1,Ii]];function a(e,n,i){const r=Math.abs(n-e)/i,s=Er((([,,t])=>t)).right(o,r);if(s===o.length)return t.every(hi(e/Ii,n/Ii,i));if(0===s)return mr.every(Math.max(hi(e,n,i),1));const[a,u]=o[r/o[s-1][2]<o[s][2]/r?s-1:s];return a.every(u)}return[function(t,e,n){const i=e<t;i&&([t,e]=[e,t]);const r=n&&"function"==typeof n.range?n:a(t,e,n),s=r?r.range(t,+e+1):[];return i?s.reverse():s},a]}const[up,lp]=ap(vr,xr,Ki,Ji,Ar,kr),[cp,hp]=ap(or,ur,Ui,Li,cr,fr);function fp(t){return new Date(t)}function dp(t){return t instanceof Date?+t:+new Date(+t)}function pp(t,e,n,i,r,s,o,a,u,l){var c=qd(),h=c.invert,f=c.domain,d=l(".%L"),p=l(":%S"),g=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),v=l("%b %d"),b=l("%B"),x=l("%Y");function w(t){return(u(t)<t?d:a(t)<t?p:o(t)<t?g:s(t)<t?m:i(t)<t?r(t)<t?y:v:n(t)<t?b:x)(t)}return c.invert=function(t){return new Date(h(t))},c.domain=function(t){return arguments.length?f(Array.from(t,dp)):f().map(fp)},c.ticks=function(e){var n=f();return t(n[0],n[n.length-1],null==e?10:e)},c.tickFormat=function(t,e){return null==e?w:l(e)},c.nice=function(t){var n=f();return t&&"function"==typeof t.range||(t=e(n[0],n[n.length-1],null==t?10:t)),t?f(Hd(n,t)):c},c.copy=function(){return Pd(c,pp(t,e,n,i,r,s,o,a,u,l))},c}function gp(){var t,e,n,i,r,s=0,o=1,a=jd,u=!1;function l(e){return null==e||isNaN(e=+e)?r:a(0===n?.5:(e=(i(e)-t)*n,u?Math.max(0,Math.min(1,e)):e))}function c(t){return function(e){var n,i;return arguments.length?([n,i]=e,a=t(n,i),l):[a(0),a(1)]}}return l.domain=function(r){return arguments.length?([s,o]=r,t=i(s=+s),e=i(o=+o),n=t===e?0:1/(e-t),l):[s,o]},l.clamp=function(t){return arguments.length?(u=!!t,l):u},l.interpolator=function(t){return arguments.length?(a=t,l):a},l.range=c(zd),l.rangeRound=c($d),l.unknown=function(t){return arguments.length?(r=t,l):r},function(r){return i=r,t=r(s),e=r(o),n=t===e?0:1/(e-t),l}}function mp(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function yp(){var t=Wd(gp()(jd));return t.copy=function(){return mp(t,yp())},Of.apply(t,arguments)}function vp(){var t=np(gp());return t.copy=function(){return mp(t,vp()).exponent(t.exponent())},Of.apply(t,arguments)}function bp(t,e){void 0===e&&(e=t,t=zd);for(var n=0,i=e.length-1,r=e[0],s=new Array(i<0?0:i);n<i;)s[n]=t(r,r=e[++n]);return function(t){var e=Math.max(0,Math.min(i-1,Math.floor(t*=i)));return s[e](t-e)}}function xp(){var t,e,n,i,r,s,o,a=0,u=.5,l=1,c=1,h=jd,f=!1;function d(t){return isNaN(t=+t)?o:(t=.5+((t=+s(t))-e)*(c*t<c*e?i:r),h(f?Math.max(0,Math.min(1,t)):t))}function p(t){return function(e){var n,i,r;return arguments.length?([n,i,r]=e,h=bp(t,[n,i,r]),d):[h(0),h(.5),h(1)]}}return d.domain=function(o){return arguments.length?([a,u,l]=o,t=s(a=+a),e=s(u=+u),n=s(l=+l),i=t===e?0:.5/(e-t),r=e===n?0:.5/(n-e),c=e<t?-1:1,d):[a,u,l]},d.clamp=function(t){return arguments.length?(f=!!t,d):f},d.interpolator=function(t){return arguments.length?(h=t,d):h},d.range=p(zd),d.rangeRound=p($d),d.unknown=function(t){return arguments.length?(o=t,d):o},function(o){return s=o,t=o(a),e=o(u),n=o(l),i=t===e?0:.5/(e-t),r=e===n?0:.5/(n-e),c=e<t?-1:1,d}}function wp(){var t=np(xp());return t.copy=function(){return mp(t,wp()).exponent(t.exponent())},Of.apply(t,arguments)}function Ap(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}function _p(t,e){var n=yd(+t,+e);return function(t){var e=n(t);return e-360*Math.floor(e/360)}}var kp,Cp=180/Math.PI,Ep={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Dp(t,e,n,i,r,s){var o,a,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*i)&&(n-=t*u,i-=e*u),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,u/=a),t*i<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(e,t)*Cp,skewX:Math.atan(u)*Cp,scaleX:o,scaleY:a}}function Fp(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(s,o){var a=[],u=[];return s=t(s),o=t(o),function(t,i,r,s,o,a){if(t!==r||i!==s){var u=o.push("translate(",null,e,null,n);a.push({i:u-4,x:Fd(t,r)},{i:u-2,x:Fd(i,s)})}else(r||s)&&o.push("translate("+r+e+s+n)}(s.translateX,s.translateY,o.translateX,o.translateY,a,u),function(t,e,n,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:n.push(r(n)+"rotate(",null,i)-2,x:Fd(t,e)})):e&&n.push(r(n)+"rotate("+e+i)}(s.rotate,o.rotate,a,u),function(t,e,n,s){t!==e?s.push({i:n.push(r(n)+"skewX(",null,i)-2,x:Fd(t,e)}):e&&n.push(r(n)+"skewX("+e+i)}(s.skewX,o.skewX,a,u),function(t,e,n,i,s,o){if(t!==n||e!==i){var a=s.push(r(s)+"scale(",null,",",null,")");o.push({i:a-4,x:Fd(t,n)},{i:a-2,x:Fd(e,i)})}else 1===n&&1===i||s.push(r(s)+"scale("+n+","+i+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,a,u),s=o=null,function(t){for(var e,n=-1,i=u.length;++n<i;)a[(e=u[n]).i]=e.x(t);return a.join("")}}}var Sp=Fp((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Ep:Dp(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),Op=Fp((function(t){return null==t?Ep:(kp||(kp=document.createElementNS("http://www.w3.org/2000/svg","g")),kp.setAttribute("transform",t),(t=kp.transform.baseVal.consolidate())?Dp((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):Ep)}),", ",")",")");function Np(t){return((t=Math.exp(t))+1/t)/2}const Mp=function t(e,n,i){function r(t,r){var s,o,a=t[0],u=t[1],l=t[2],c=r[0],h=r[1],f=r[2],d=c-a,p=h-u,g=d*d+p*p;if(g<1e-12)o=Math.log(f/l)/e,s=function(t){return[a+t*d,u+t*p,l*Math.exp(e*t*o)]};else{var m=Math.sqrt(g),y=(f*f-l*l+i*g)/(2*l*n*m),v=(f*f-l*l-i*g)/(2*f*n*m),b=Math.log(Math.sqrt(y*y+1)-y),x=Math.log(Math.sqrt(v*v+1)-v);o=(x-b)/e,s=function(t){var i=t*o,r=Np(b),s=l/(n*m)*(r*function(t){return((t=Math.exp(2*t))-1)/(t+1)}(e*i+b)-function(t){return((t=Math.exp(t))-1/t)/2}(b));return[a+s*d,u+s*p,l*r/Np(e*i+b)]}}return s.duration=1e3*o*e/Math.SQRT2,s}return r.rho=function(e){var n=Math.max(.001,+e),i=n*n;return t(n,i,i*i)},r}(Math.SQRT2,2,4);function zp(t){return function(e,n){var i=t((e=ld(e)).h,(n=ld(n)).h),r=vd(e.s,n.s),s=vd(e.l,n.l),o=vd(e.opacity,n.opacity);return function(t){return e.h=i(t),e.s=r(t),e.l=s(t),e.opacity=o(t),e+""}}}const $p=zp(yd);var Tp=zp(vd);const Bp=Math.PI/180,jp=180/Math.PI,Ip=.96422,Rp=.82521,Lp=4/29,Pp=6/29,Up=3*Pp*Pp;function qp(t){if(t instanceof Hp)return new Hp(t.l,t.a,t.b,t.opacity);if(t instanceof Kp)return Qp(t);t instanceof id||(t=ed(t));var e,n,i=Yp(t.r),r=Yp(t.g),s=Yp(t.b),o=Vp((.2225045*i+.7168786*r+.0606169*s)/1);return i===r&&r===s?e=n=o:(e=Vp((.4360747*i+.3850649*r+.1430804*s)/Ip),n=Vp((.0139322*i+.0971045*r+.7141733*s)/Rp)),new Hp(116*o-16,500*(e-o),200*(o-n),t.opacity)}function Wp(t,e,n,i){return 1===arguments.length?qp(t):new Hp(t,e,n,null==i?1:i)}function Hp(t,e,n,i){this.l=+t,this.a=+e,this.b=+n,this.opacity=+i}function Vp(t){return t>.008856451679035631?Math.pow(t,1/3):t/Up+Lp}function Gp(t){return t>Pp?t*t*t:Up*(t-Lp)}function Xp(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Yp(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Jp(t){if(t instanceof Kp)return new Kp(t.h,t.c,t.l,t.opacity);if(t instanceof Hp||(t=qp(t)),0===t.a&&0===t.b)return new Kp(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*jp;return new Kp(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function Zp(t,e,n,i){return 1===arguments.length?Jp(t):new Kp(t,e,n,null==i?1:i)}function Kp(t,e,n,i){this.h=+t,this.c=+e,this.l=+n,this.opacity=+i}function Qp(t){if(isNaN(t.h))return new Hp(t.l,0,0,t.opacity);var e=t.h*Bp;return new Hp(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}function tg(t,e){var n=vd((t=Wp(t)).l,(e=Wp(e)).l),i=vd(t.a,e.a),r=vd(t.b,e.b),s=vd(t.opacity,e.opacity);return function(e){return t.l=n(e),t.a=i(e),t.b=r(e),t.opacity=s(e),t+""}}function eg(t){return function(e,n){var i=t((e=Zp(e)).h,(n=Zp(n)).h),r=vd(e.c,n.c),s=vd(e.l,n.l),o=vd(e.opacity,n.opacity);return function(t){return e.h=i(t),e.c=r(t),e.l=s(t),e.opacity=o(t),e+""}}}$f(Hp,Wp,Tf(Bf,{brighter:function(t){return new Hp(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new Hp(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new id(Xp(3.1338561*(e=Ip*Gp(e))-1.6168667*(t=1*Gp(t))-.4906146*(n=Rp*Gp(n))),Xp(-.9787684*e+1.9161415*t+.033454*n),Xp(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),$f(Kp,Zp,Tf(Bf,{brighter:function(t){return new Kp(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new Kp(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return Qp(this).rgb()}}));const ng=eg(yd);var ig=eg(vd),rg=-.14861,sg=1.78277,og=-.29227,ag=-.90649,ug=1.97294,lg=ug*ag,cg=ug*sg,hg=sg*og-ag*rg;function fg(t){if(t instanceof pg)return new pg(t.h,t.s,t.l,t.opacity);t instanceof id||(t=ed(t));var e=t.r/255,n=t.g/255,i=t.b/255,r=(hg*i+lg*e-cg*n)/(hg+lg-cg),s=i-r,o=(ug*(n-r)-og*s)/ag,a=Math.sqrt(o*o+s*s)/(ug*r*(1-r)),u=a?Math.atan2(o,s)*jp-120:NaN;return new pg(u<0?u+360:u,a,r,t.opacity)}function dg(t,e,n,i){return 1===arguments.length?fg(t):new pg(t,e,n,null==i?1:i)}function pg(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function gg(t){return function e(n){function i(e,i){var r=t((e=dg(e)).h,(i=dg(i)).h),s=vd(e.s,i.s),o=vd(e.l,i.l),a=vd(e.opacity,i.opacity);return function(t){return e.h=r(t),e.s=s(t),e.l=o(Math.pow(t,n)),e.opacity=a(t),e+""}}return n=+n,i.gamma=e,i}(1)}$f(pg,dg,Tf(Bf,{brighter:function(t){return t=null==t?If:Math.pow(If,t),new pg(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?jf:Math.pow(jf,t),new pg(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*Bp,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),r=Math.sin(t);return new id(255*(e+n*(rg*i+sg*r)),255*(e+n*(og*i+ag*r)),255*(e+n*(ug*i)),this.opacity)}}));const mg=gg(yd);var yg=gg(vd);function vg(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t(i/(e-1));return n}function bg(t,e,n){const i=t-e+2*n;return t?i>0?i:1:0}const xg="linear",wg="log",Ag="pow",_g="sqrt",kg="symlog",Cg="time",Eg="utc",Dg="sequential",Fg="diverging",Sg="quantile",Og="quantize",Ng="threshold",Mg="ordinal",zg="point",$g="band",Tg="bin-ordinal",Bg="continuous",jg="discrete",Ig="discretizing",Rg="interpolating",Lg="temporal";function Pg(){const t=Mf().unknown(void 0),e=t.domain,n=t.range;let i,r,s=[0,1],o=!1,a=0,u=0,l=.5;function c(){const t=e().length,c=s[1]<s[0],h=s[1-c],f=bg(t,a,u);let d=s[c-0];i=(h-d)/(f||1),o&&(i=Math.floor(i)),d+=(h-d-i*(t-a))*l,r=i*(1-a),o&&(d=Math.round(d),r=Math.round(r));const p=Bl(t).map((t=>d+i*t));return n(c?p.reverse():p)}return delete t.unknown,t.domain=function(t){return arguments.length?(e(t),c()):e()},t.range=function(t){return arguments.length?(s=[+t[0],+t[1]],c()):s.slice()},t.rangeRound=function(t){return s=[+t[0],+t[1]],o=!0,c()},t.bandwidth=function(){return r},t.step=function(){return i},t.round=function(t){return arguments.length?(o=!!t,c()):o},t.padding=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),a=u,c()):a},t.paddingInner=function(t){return arguments.length?(a=Math.max(0,Math.min(1,t)),c()):a},t.paddingOuter=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),c()):u},t.align=function(t){return arguments.length?(l=Math.max(0,Math.min(1,t)),c()):l},t.invertRange=function(t){if(null==t[0]||null==t[1])return;const i=s[1]<s[0],o=i?n().reverse():n(),a=o.length-1;let u,l,c,h=+t[0],f=+t[1];return h!=h||f!=f||(f<h&&(c=h,h=f,f=c),f<o[0]||h>s[1-i])?void 0:(u=Math.max(0,Ef(o,h)-1),l=h===f?u:Ef(o,f)-1,h-o[u]>r+1e-10&&++u,i&&(c=u,u=a-l,l=a-c),u>l?void 0:e().slice(u,l+1))},t.invert=function(e){const n=t.invertRange([e,e]);return n?n[0]:n},t.copy=function(){return Pg().domain(e()).range(s).round(o).paddingInner(a).paddingOuter(u).align(l)},c()}function Ug(t){const e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return Ug(e())},t}var qg=Array.prototype.map;function Wg(t){return qg.call(t,rn)}const Hg=Array.prototype.slice,Vg={};function Gg(t,e,n){const i=function(){const n=e();return n.invertRange||(n.invertRange=n.invert?(i=n,function(t){let e,n=t[0],r=t[1];return r<n&&(e=n,n=r,r=e),[i.invert(n),i.invert(r)]}):n.invertExtent?function(t){return function(e){const n=t.range();let i,r,s,o,a=e[0],u=e[1],l=-1;for(u<a&&(r=a,a=u,u=r),s=0,o=n.length;s<o;++s)n[s]>=a&&n[s]<=u&&(l<0&&(l=s),i=s);if(!(l<0))return a=t.invertExtent(n[l]),u=t.invertExtent(n[i]),[void 0===a[0]?a[1]:a[0],void 0===u[1]?u[0]:u[1]]}}(n):void 0),n.type=t,n;var i};return i.metadata=Wn(mn(n)),i}function Xg(t,e,n){return arguments.length>1?(Vg[t]=Gg(t,e,n),this):Yg(t)?Vg[t]:void 0}function Yg(t){return Fn(Vg,t)}function Jg(t,e){const n=Vg[t];return n&&n.metadata[e]}function Zg(t){return Jg(t,Bg)}function Kg(t){return Jg(t,jg)}function Qg(t){return Jg(t,Ig)}function tm(t){return Jg(t,wg)}function em(t){return Jg(t,Rg)}function nm(t){return Jg(t,Sg)}Xg("identity",(function t(e){var n;function i(t){return null==t||isNaN(t=+t)?n:t}return i.invert=i,i.domain=i.range=function(t){return arguments.length?(e=Array.from(t,Td),i):e.slice()},i.unknown=function(t){return arguments.length?(n=t,i):n},i.copy=function(){return t(e).unknown(n)},e=arguments.length?Array.from(e,Td):[0,1],Wd(i)})),Xg(xg,(function t(){var e=qd();return e.copy=function(){return Pd(e,t())},Sf.apply(e,arguments),Wd(e)}),Bg),Xg(wg,(function t(){var e=Kd(Ud()).domain([1,10]);return e.copy=function(){return Pd(e,t()).base(e.base())},Sf.apply(e,arguments),e}),[Bg,wg]),Xg(Ag,ip,Bg),Xg(_g,(function(){return ip.apply(null,arguments).exponent(.5)}),Bg),Xg(kg,(function t(){var e=op(Ud());return e.copy=function(){return Pd(e,t()).constant(e.constant())},Sf.apply(e,arguments)}),Bg),Xg(Cg,(function(){return Sf.apply(pp(cp,hp,or,ur,Ui,Li,cr,fr,pr,Bs).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[Bg,Lg]),Xg(Eg,(function(){return Sf.apply(pp(up,lp,vr,xr,Ki,Ji,Ar,kr,pr,Is).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[Bg,Lg]),Xg(Dg,yp,[Bg,Rg]),Xg("".concat(Dg,"-").concat(xg),yp,[Bg,Rg]),Xg("".concat(Dg,"-").concat(wg),(function t(){var e=Kd(gp()).domain([1,10]);return e.copy=function(){return mp(e,t()).base(e.base())},Of.apply(e,arguments)}),[Bg,Rg,wg]),Xg("".concat(Dg,"-").concat(Ag),vp,[Bg,Rg]),Xg("".concat(Dg,"-").concat(_g),(function(){return vp.apply(null,arguments).exponent(.5)}),[Bg,Rg]),Xg("".concat(Dg,"-").concat(kg),(function t(){var e=op(gp());return e.copy=function(){return mp(e,t()).constant(e.constant())},Of.apply(e,arguments)}),[Bg,Rg]),Xg("".concat(Fg,"-").concat(xg),(function t(){var e=Wd(xp()(jd));return e.copy=function(){return mp(e,t())},Of.apply(e,arguments)}),[Bg,Rg]),Xg("".concat(Fg,"-").concat(wg),(function t(){var e=Kd(xp()).domain([.1,1,10]);return e.copy=function(){return mp(e,t()).base(e.base())},Of.apply(e,arguments)}),[Bg,Rg,wg]),Xg("".concat(Fg,"-").concat(Ag),wp,[Bg,Rg]),Xg("".concat(Fg,"-").concat(_g),(function(){return wp.apply(null,arguments).exponent(.5)}),[Bg,Rg]),Xg("".concat(Fg,"-").concat(kg),(function t(){var e=op(xp());return e.copy=function(){return mp(e,t()).constant(e.constant())},Of.apply(e,arguments)}),[Bg,Rg]),Xg(Sg,(function t(){var e,n=[],i=[],r=[];function s(){var t=0,e=Math.max(1,i.length);for(r=new Array(e-1);++t<e;)r[t-1]=Lu(n,t/e);return o}function o(t){return null==t||isNaN(t=+t)?e:i[Ff(r,t)]}return o.invertExtent=function(t){var e=i.indexOf(t);return e<0?[NaN,NaN]:[e>0?r[e-1]:n[0],e<r.length?r[e]:n[n.length-1]]},o.domain=function(t){if(!arguments.length)return n.slice();n=[];for(let e of t)null==e||isNaN(e=+e)||n.push(e);return n.sort(Cr),s()},o.range=function(t){return arguments.length?(i=Array.from(t),s()):i.slice()},o.unknown=function(t){return arguments.length?(e=t,o):e},o.quantiles=function(){return r.slice()},o.copy=function(){return t().domain(n).range(i).unknown(e)},Sf.apply(o,arguments)}),[Ig,Sg]),Xg(Og,(function t(){var e,n=0,i=1,r=1,s=[.5],o=[0,1];function a(t){return null!=t&&t<=t?o[Ff(s,t,0,r)]:e}function u(){var t=-1;for(s=new Array(r);++t<r;)s[t]=((t+1)*i-(t-r)*n)/(r+1);return a}return a.domain=function(t){return arguments.length?([n,i]=t,n=+n,i=+i,u()):[n,i]},a.range=function(t){return arguments.length?(r=(o=Array.from(t)).length-1,u()):o.slice()},a.invertExtent=function(t){var e=o.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,s[0]]:e>=r?[s[r-1],i]:[s[e-1],s[e]]},a.unknown=function(t){return arguments.length?(e=t,a):a},a.thresholds=function(){return s.slice()},a.copy=function(){return t().domain([n,i]).range(o).unknown(e)},Sf.apply(Wd(a),arguments)}),Ig),Xg(Ng,(function t(){var e,n=[.5],i=[0,1],r=1;function s(t){return null!=t&&t<=t?i[Ff(n,t,0,r)]:e}return s.domain=function(t){return arguments.length?(n=Array.from(t),r=Math.min(n.length,i.length-1),s):n.slice()},s.range=function(t){return arguments.length?(i=Array.from(t),r=Math.min(n.length,i.length-1),s):i.slice()},s.invertExtent=function(t){var e=i.indexOf(t);return[n[e-1],n[e]]},s.unknown=function(t){return arguments.length?(e=t,s):e},s.copy=function(){return t().domain(n).range(i).unknown(e)},Sf.apply(s,arguments)}),Ig),Xg(Tg,(function t(){let e=[],n=[];function i(t){return null==t||t!=t?void 0:n[(Ff(e,t)-1)%n.length]}return i.domain=function(t){return arguments.length?(e=Wg(t),i):e.slice()},i.range=function(t){return arguments.length?(n=Hg.call(t),i):n.slice()},i.tickFormat=function(t,n){return zf(e[0],nn(e),null==t?10:t,n)},i.copy=function(){return t().domain(i.domain()).range(i.range())},i}),[jg,Ig]),Xg(Mg,Mf,jg),Xg($g,Pg,jg),Xg(zg,(function(){return Ug(Pg().paddingInner(1))}),jg);const im=["clamp","base","constant","exponent"];function rm(t,e){const n=e[0],i=nn(e)-n;return function(e){return t(n+e*i)}}function sm(t,e,n){return bp(um(e||"rgb",n),t)}function om(t,e){const n=new Array(e),i=e+1;for(let r=0;r<e;)n[r]=t(++r/i);return n}function am(t,e,n){const i=n-e;let r,s,o;return i&&Number.isFinite(i)?(r=(s=t.type).indexOf("-"),s=r<0?s:s.slice(r+1),o=Xg(s)().domain([e,n]).range([0,1]),im.forEach((e=>t[e]?o[e](t[e]()):0)),o):_n(.5)}function um(t,e){const n=o[function(t){return"interpolate"+t.toLowerCase().split("-").map((t=>t[0].toUpperCase()+t.slice(1))).join("")}(t)];return null!=e&&n&&n.gamma?n.gamma(e):n}function lm(t){const e=t.length/6|0,n=new Array(e);for(let i=0;i<e;)n[i]="#"+t.slice(6*i,6*++i);return n}function cm(t,e){for(const n in t)fm(n,e(t[n]))}const hm={};function fm(t,e){return t=t&&t.toLowerCase(),arguments.length>1?(hm[t]=e,this):hm[t]}cm({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},lm),cm({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},(t=>sm(lm(t))));const dm="symbol",pm=t=>Ze(t)?t.map((t=>String(t))):String(t),gm=(t,e)=>t[1]-e[1],mm=(t,e)=>e[1]-t[1];function ym(t,e,n){let i;return $n(e)&&(t.bins&&(e=Math.max(e,t.bins.length)),null!=n&&(e=Math.min(e,Math.floor(In(t.domain())/n||1)))),Ke(e)&&(i=e.step,e=e.interval),Tn(e)&&(e=t.type===Cg?ds(e):t.type==Eg?ps(e):Le("Only time and utc scales accept interval strings."),i&&(e=e.every(i))),e}function vm(t,e,n){let i=t.range(),r=i[0],s=nn(i),o=gm;if(r>s&&(i=s,s=r,r=i,o=mm),r=Math.floor(r),s=Math.ceil(s),e=e.map((e=>[e,t(e)])).filter((t=>r<=t[1]&&t[1]<=s)).sort(o).map((t=>t[0])),n>0&&e.length>1){const t=[e[0],nn(e)];for(;e.length>n&&e.length>=3;)e=e.filter(((t,e)=>!(e%2)));e.length<3&&(e=t)}return e}function bm(t,e){return t.bins?vm(t,t.bins):t.ticks?t.ticks(e):t.domain()}function xm(t,e,n,i,r,s){const o=e.type;let a=pm;if(o===Cg||r===Cg)a=t.timeFormat(i);else if(o===Eg||r===Eg)a=t.utcFormat(i);else if(tm(o)){const r=t.formatFloat(i);if(s||e.bins)a=r;else{const t=wm(e,n,!1);a=e=>t(e)?r(e):""}}else if(e.tickFormat){const r=e.domain();a=t.formatSpan(r[0],r[r.length-1],n,i)}else i&&(a=t.format(i));return a}function wm(t,e,n){const i=bm(t,e),r=t.base(),s=Math.log(r),o=Math.max(1,r*e/i.length),a=t=>{let e=t/Math.pow(r,Math.round(Math.log(t)/s));return e*r<r-.5&&(e*=r),e<=o};return n?i.filter(a):a}const Am={[Sg]:"quantiles",[Og]:"thresholds",[Ng]:"domain"},_m={[Sg]:"quantiles",[Og]:"domain"};function km(t,e){return t.bins?function(t){const e=t.slice(0,-1);return e.max=nn(t),e}(t.bins):t.type===wg?wm(t,e,!0):Am[t.type]?function(t){const e=[-1/0].concat(t);return e.max=1/0,e}(t[Am[t.type]]()):bm(t,e)}function Cm(t,e,n,i,r,s,o){const a=_m[e.type]&&s!==Cg&&s!==Eg?function(t,e,n){const i=e[_m[e.type]](),r=i.length;let s,o=r>1?i[1]-i[0]:i[0];for(s=1;s<r;++s)o=Math.min(o,i[s]-i[s-1]);return t.formatSpan(0,o,30,n)}(t,e,r):xm(t,e,n,r,s,o);return i===dm&&(t=>Am[t.type]||t.bins)(e)?Em(a):"discrete"===i?Fm(a):Sm(a)}const Em=t=>(e,n,i)=>{const r=Dm(i[n+1],Dm(i.max,1/0)),s=Om(e,t),o=Om(r,t);return s&&o?s+"  "+o:o?"< "+o:" "+s},Dm=(t,e)=>null!=t?t:e,Fm=t=>(e,n)=>n?t(e):null,Sm=t=>e=>t(e),Om=(t,e)=>Number.isFinite(t)?e(t):null;function Nm(t,e,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=function(t,e,n,i){const r=i||e.type;return Tn(n)&&function(t){return Jg(t,Lg)}(r)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||r!==Cg?n||r!==Eg?Cm(t,e,5,null,n,i,!0):t.utcFormat("%A, %d %B %Y, %X UTC"):t.timeFormat("%A, %d %B %Y, %X")}(t,e,n.format,n.formatType);if(Qg(e.type)){const t=km(e).slice(1).map(r),n=t.length;return"".concat(n," boundar").concat(1===n?"y":"ies",": ").concat(t.join(", "))}if(Kg(e.type)){const t=e.domain(),n=t.length,s=n>i?t.slice(0,i-2).map(r).join(", ")+", ending with "+t.slice(-1).map(r):t.map(r).join(", ");return"".concat(n," value").concat(1===n?"":"s",": ").concat(s)}{const t=e.domain();return"values from ".concat(r(t[0])," to ").concat(r(nn(t)))}}let Mm=0;const zm="p_";function $m(t){return t&&t.gradient}function Tm(t,e,n){const i=t.gradient;let r=t.id,s="radial"===i?zm:"";return r||(r=t.id="gradient_"+Mm++,"radial"===i?(t.x1=Bm(t.x1,.5),t.y1=Bm(t.y1,.5),t.r1=Bm(t.r1,0),t.x2=Bm(t.x2,.5),t.y2=Bm(t.y2,.5),t.r2=Bm(t.r2,.5),s=zm):(t.x1=Bm(t.x1,0),t.y1=Bm(t.y1,0),t.x2=Bm(t.x2,1),t.y2=Bm(t.y2,0))),e[r]=t,"url("+(n||"")+"#"+s+r+")"}function Bm(t,e){return null!=t?t:e}function jm(t,e){var n,i=[];return n={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:i,stop:function(t,e){return i.push({offset:t,color:e}),n}}}const Im={basis:{curve:function(t){return new lh(t)}},"basis-closed":{curve:function(t){return new hh(t)}},"basis-open":{curve:function(t){return new fh(t)}},bundle:{curve:ph,tension:"beta",value:.85},cardinal:{curve:yh,tension:"tension",value:0},"cardinal-open":{curve:bh,tension:"tension",value:0},"cardinal-closed":{curve:wh,tension:"tension",value:0},"catmull-rom":{curve:jh,tension:"alpha",value:.5},"catmull-rom-closed":{curve:Rh,tension:"alpha",value:.5},"catmull-rom-open":{curve:Ph,tension:"alpha",value:.5},linear:{curve:qh},"linear-closed":{curve:function(t){return new Wh(t)}},monotone:{horizontal:function(t){return new Jh(t)},vertical:function(t){return new Yh(t)}},natural:{curve:function(t){return new Kh(t)}},step:{curve:function(t){return new tf(t,.5)}},"step-after":{curve:function(t){return new tf(t,1)}},"step-before":{curve:function(t){return new tf(t,0)}}};function Rm(t,e,n){var i=Fn(Im,t)&&Im[t],r=null;return i&&(r=i.curve||i[e||"vertical"],i.tension&&null!=n&&(r=r[i.tension](n))),r}const Lm={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Pm=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function Um(t){const e=[];let n,i,r,s,o,a,u,l,c,h;const f=t.slice().replace(Pm[0],"###$1").split(Pm[1]).slice(1);for(u=0,c=f.length;u<c;++u){for(n=f[u],i=n.slice(1).trim().replace(Pm[2],"$1###$2").replace(Pm[3],"$1###$2").split(Pm[4]),o=n.charAt(0),r=[o],l=0,h=i.length;l<h;++l)(s=+i[l])===s&&r.push(s);if(a=Lm[o.toLowerCase()],r.length-1>a){const t=r.length;for(l=1,e.push([o].concat(r.slice(l,l+=a))),o="M"===o?"L":"m"===o?"l":o;l<t;l+=a)e.push([o].concat(r.slice(l,l+a)))}else e.push(r)}return e}const qm=Math.PI/180,Wm=Math.PI/2,Hm=2*Math.PI,Vm=Math.sqrt(3)/2;var Gm={},Xm={},Ym=[].join;function Jm(t){const e=Ym.call(t);if(Xm[e])return Xm[e];var n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],u=t[6],l=t[7];const c=l*o,h=-u*a,f=u*o,d=l*a,p=Math.cos(r),g=Math.sin(r),m=Math.cos(s),y=Math.sin(s),v=.5*(s-r),b=Math.sin(.5*v),x=8/3*b*b/Math.sin(v),w=n+p-x*g,A=i+g+x*p,_=n+m,k=i+y,C=_+x*y,E=k-x*m;return Xm[e]=[c*w+h*A,f*w+d*A,c*C+h*E,f*C+d*E,c*_+h*k,f*_+d*k]}const Zm=["l",0,0,0,0,0,0,0];function Km(t,e,n){const i=Zm[0]=t[0];if("a"===i||"A"===i)Zm[1]=e*t[1],Zm[2]=n*t[2],Zm[3]=t[3],Zm[4]=t[4],Zm[5]=t[5],Zm[6]=e*t[6],Zm[7]=n*t[7];else if("h"===i||"H"===i)Zm[1]=e*t[1];else if("v"===i||"V"===i)Zm[1]=n*t[1];else for(var r=1,s=t.length;r<s;++r)Zm[r]=(r%2==1?e:n)*t[r];return Zm}function Qm(t,e,n,i,r,s){var o,a,u,l,c,h=null,f=0,d=0,p=0,g=0;null==n&&(n=0),null==i&&(i=0),null==r&&(r=1),null==s&&(s=r),t.beginPath&&t.beginPath();for(var m=0,y=e.length;m<y;++m){switch(o=e[m],1===r&&1===s||(o=Km(o,r,s)),o[0]){case"l":f+=o[1],d+=o[2],t.lineTo(f+n,d+i);break;case"L":f=o[1],d=o[2],t.lineTo(f+n,d+i);break;case"h":f+=o[1],t.lineTo(f+n,d+i);break;case"H":f=o[1],t.lineTo(f+n,d+i);break;case"v":d+=o[1],t.lineTo(f+n,d+i);break;case"V":d=o[1],t.lineTo(f+n,d+i);break;case"m":f+=o[1],d+=o[2],t.moveTo(f+n,d+i);break;case"M":f=o[1],d=o[2],t.moveTo(f+n,d+i);break;case"c":a=f+o[5],u=d+o[6],p=f+o[3],g=d+o[4],t.bezierCurveTo(f+o[1]+n,d+o[2]+i,p+n,g+i,a+n,u+i),f=a,d=u;break;case"C":f=o[5],d=o[6],p=o[3],g=o[4],t.bezierCurveTo(o[1]+n,o[2]+i,p+n,g+i,f+n,d+i);break;case"s":a=f+o[3],u=d+o[4],p=2*f-p,g=2*d-g,t.bezierCurveTo(p+n,g+i,f+o[1]+n,d+o[2]+i,a+n,u+i),p=f+o[1],g=d+o[2],f=a,d=u;break;case"S":a=o[3],u=o[4],p=2*f-p,g=2*d-g,t.bezierCurveTo(p+n,g+i,o[1]+n,o[2]+i,a+n,u+i),f=a,d=u,p=o[1],g=o[2];break;case"q":a=f+o[3],u=d+o[4],p=f+o[1],g=d+o[2],t.quadraticCurveTo(p+n,g+i,a+n,u+i),f=a,d=u;break;case"Q":a=o[3],u=o[4],t.quadraticCurveTo(o[1]+n,o[2]+i,a+n,u+i),f=a,d=u,p=o[1],g=o[2];break;case"t":a=f+o[1],u=d+o[2],null===h[0].match(/[QqTt]/)?(p=f,g=d):"t"===h[0]?(p=2*f-l,g=2*d-c):"q"===h[0]&&(p=2*f-p,g=2*d-g),l=p,c=g,t.quadraticCurveTo(p+n,g+i,a+n,u+i),d=u,p=(f=a)+o[1],g=d+o[2];break;case"T":a=o[1],u=o[2],p=2*f-p,g=2*d-g,t.quadraticCurveTo(p+n,g+i,a+n,u+i),f=a,d=u;break;case"a":ty(t,f+n,d+i,[o[1],o[2],o[3],o[4],o[5],o[6]+f+n,o[7]+d+i]),f+=o[6],d+=o[7];break;case"A":ty(t,f+n,d+i,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+i]),f=o[6],d=o[7];break;case"z":case"Z":t.closePath()}h=o}}function ty(t,e,n,i){const r=function(t,e,n,i,r,s,o,a,u){const l=Ym.call(arguments);if(Gm[l])return Gm[l];const c=o*qm,h=Math.sin(c),f=Math.cos(c),d=f*(a-t)*.5+h*(u-e)*.5,p=f*(u-e)*.5-h*(a-t)*.5;let g=d*d/((n=Math.abs(n))*n)+p*p/((i=Math.abs(i))*i);g>1&&(g=Math.sqrt(g),n*=g,i*=g);const m=f/n,y=h/n,v=-h/i,b=f/i,x=m*a+y*u,w=v*a+b*u,A=m*t+y*e,_=v*t+b*e;let k=1/((A-x)*(A-x)+(_-w)*(_-w))-.25;k<0&&(k=0);let C=Math.sqrt(k);s==r&&(C=-C);const E=.5*(x+A)-C*(_-w),D=.5*(w+_)+C*(A-x),F=Math.atan2(w-D,x-E);let S=Math.atan2(_-D,A-E)-F;S<0&&1===s?S+=Hm:S>0&&0===s&&(S-=Hm);const O=Math.ceil(Math.abs(S/(Wm+.001))),N=[];for(let t=0;t<O;++t){const e=F+t*S/O,r=F+(t+1)*S/O;N[t]=[E,D,e,r,n,i,h,f]}return Gm[l]=N}(i[5],i[6],i[0],i[1],i[3],i[4],i[2],e,n);for(let e=0;e<r.length;++e){const n=Jm(r[e]);t.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}const ey=.5773502691896257,ny={circle:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(n,0),t.arc(0,0,n,0,Hm)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/2.5;t.moveTo(-n,-i),t.lineTo(-n,i),t.lineTo(-i,i),t.lineTo(-i,n),t.lineTo(i,n),t.lineTo(i,i),t.lineTo(n,i),t.lineTo(n,-i),t.lineTo(i,-i),t.lineTo(i,-n),t.lineTo(-i,-n),t.lineTo(-i,-i),t.closePath()}},diamond:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),i=-n/2;t.rect(i,i,n,n)}},arrow:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/7,r=n/2.5,s=n/8;t.moveTo(-i,n),t.lineTo(i,n),t.lineTo(i,-s),t.lineTo(r,-s),t.lineTo(0,-n),t.lineTo(-r,-s),t.lineTo(-i,-s),t.closePath()}},wedge:{draw:function(t,e){var n=Math.sqrt(e)/2,i=Vm*n,r=i-n*ey,s=n/4;t.moveTo(0,-i-r),t.lineTo(-s,i-r),t.lineTo(s,i-r),t.closePath()}},triangle:{draw:function(t,e){var n=Math.sqrt(e)/2,i=Vm*n,r=i-n*ey;t.moveTo(0,-i-r),t.lineTo(-n,i-r),t.lineTo(n,i-r),t.closePath()}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,i=Vm*n;t.moveTo(0,-i),t.lineTo(-n,i),t.lineTo(n,i),t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,i=Vm*n;t.moveTo(0,i),t.lineTo(-n,-i),t.lineTo(n,-i),t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,i=Vm*n;t.moveTo(i,0),t.lineTo(-i,-n),t.lineTo(-i,n),t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,i=Vm*n;t.moveTo(-i,0),t.lineTo(i,-n),t.lineTo(i,n),t.closePath()}},stroke:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(n,0)}}};function iy(t){return Fn(ny,t)?ny[t]:function(t){if(!Fn(ry,t)){const e=Um(t);ry[t]={draw:function(t,n){Qm(t,e,0,0,Math.sqrt(n)/2)}}}return ry[t]}(t)}var ry={};const sy=.448084975506;function oy(t){return t.x}function ay(t){return t.y}function uy(t){return t.width}function ly(t){return t.height}function cy(t){return"function"==typeof t?t:()=>+t}function hy(t,e,n){return Math.max(e,Math.min(t,n))}function fy(){var t=oy,e=ay,n=uy,i=ly,r=cy(0),s=r,o=r,a=r,u=null;function l(l,c,h){var f,d=null!=c?c:+t.call(this,l),p=null!=h?h:+e.call(this,l),g=+n.call(this,l),m=+i.call(this,l),y=Math.min(g,m)/2,v=hy(+r.call(this,l),0,y),b=hy(+s.call(this,l),0,y),x=hy(+o.call(this,l),0,y),w=hy(+a.call(this,l),0,y);if(u||(u=f=uf()),v<=0&&b<=0&&x<=0&&w<=0)u.rect(d,p,g,m);else{var A=d+g,_=p+m;u.moveTo(d+v,p),u.lineTo(A-b,p),u.bezierCurveTo(A-sy*b,p,A,p+sy*b,A,p+b),u.lineTo(A,_-w),u.bezierCurveTo(A,_-sy*w,A-sy*w,_,A-w,_),u.lineTo(d+x,_),u.bezierCurveTo(d+sy*x,_,d,_-sy*x,d,_-x),u.lineTo(d,p+v),u.bezierCurveTo(d,p+sy*v,d+sy*v,p,d+v,p),u.closePath()}if(f)return u=null,f+""||null}return l.x=function(e){return arguments.length?(t=cy(e),l):t},l.y=function(t){return arguments.length?(e=cy(t),l):e},l.width=function(t){return arguments.length?(n=cy(t),l):n},l.height=function(t){return arguments.length?(i=cy(t),l):i},l.cornerRadius=function(t,e,n,i){return arguments.length?(r=cy(t),s=null!=e?cy(e):r,a=null!=n?cy(n):r,o=null!=i?cy(i):s,l):r},l.context=function(t){return arguments.length?(u=null==t?null:t,l):u},l}function dy(){var t,e,n,i,r,s,o,a,u=null;function l(t,e,n){const i=n/2;if(r){var l=o-e,c=t-s;if(l||c){var h=Math.sqrt(l*l+c*c),f=(l/=h)*a,d=(c/=h)*a,p=Math.atan2(c,l);u.moveTo(s-f,o-d),u.lineTo(t-l*i,e-c*i),u.arc(t,e,i,p-Math.PI,p),u.lineTo(s+f,o+d),u.arc(s,o,a,p,p+Math.PI)}else u.arc(t,e,i,0,Hm);u.closePath()}else r=1;s=t,o=e,a=i}function c(s){var o,a,c,h=s.length,f=!1;for(null==u&&(u=c=uf()),o=0;o<=h;++o)!(o<h&&i(a=s[o],o,s))===f&&(f=!f)&&(r=0),f&&l(+t(a,o,s),+e(a,o,s),+n(a,o,s));if(c)return u=null,c+""||null}return c.x=function(e){return arguments.length?(t=e,c):t},c.y=function(t){return arguments.length?(e=t,c):e},c.size=function(t){return arguments.length?(n=t,c):n},c.defined=function(t){return arguments.length?(i=t,c):i},c.context=function(t){return arguments.length?(u=null==t?null:t,c):u},c}function py(t,e){return null!=t?t:e}const gy=t=>t.x||0,my=t=>t.y||0,yy=t=>!(!1===t.defined),vy=function(){var t=cf,e=hf,n=lf(0),i=null,r=ff,s=df,o=pf,a=null;function u(){var u,l,c=+t.apply(this,arguments),h=+e.apply(this,arguments),f=r.apply(this,arguments)-Nh,d=s.apply(this,arguments)-Nh,p=Ah(d-f),g=d>f;if(a||(a=u=uf()),h<c&&(l=h,h=c,c=l),h>Sh)if(p>Mh-Sh)a.moveTo(h*kh(f),h*Dh(f)),a.arc(0,0,h,f,d,!g),c>Sh&&(a.moveTo(c*kh(d),c*Dh(d)),a.arc(0,0,c,d,f,g));else{var m,y,v=f,b=d,x=f,w=d,A=p,_=p,k=o.apply(this,arguments)/2,C=k>Sh&&(i?+i.apply(this,arguments):Fh(c*c+h*h)),E=Eh(Ah(h-c)/2,+n.apply(this,arguments)),D=E,F=E;if(C>Sh){var S=$h(C/c*Dh(k)),O=$h(C/h*Dh(k));(A-=2*S)>Sh?(x+=S*=g?1:-1,w-=S):(A=0,x=w=(f+d)/2),(_-=2*O)>Sh?(v+=O*=g?1:-1,b-=O):(_=0,v=b=(f+d)/2)}var N=h*kh(v),M=h*Dh(v),z=c*kh(w),$=c*Dh(w);if(E>Sh){var T,B=h*kh(b),j=h*Dh(b),I=c*kh(x),R=c*Dh(x);if(p<Oh&&(T=gf(N,M,I,R,B,j,z,$))){var L=N-T[0],P=M-T[1],U=B-T[0],q=j-T[1],W=1/Dh(zh((L*U+P*q)/(Fh(L*L+P*P)*Fh(U*U+q*q)))/2),H=Fh(T[0]*T[0]+T[1]*T[1]);D=Eh(E,(c-H)/(W-1)),F=Eh(E,(h-H)/(W+1))}}_>Sh?F>Sh?(m=mf(I,R,N,M,h,F,g),y=mf(B,j,z,$,h,F,g),a.moveTo(m.cx+m.x01,m.cy+m.y01),F<E?a.arc(m.cx,m.cy,F,_h(m.y01,m.x01),_h(y.y01,y.x01),!g):(a.arc(m.cx,m.cy,F,_h(m.y01,m.x01),_h(m.y11,m.x11),!g),a.arc(0,0,h,_h(m.cy+m.y11,m.cx+m.x11),_h(y.cy+y.y11,y.cx+y.x11),!g),a.arc(y.cx,y.cy,F,_h(y.y11,y.x11),_h(y.y01,y.x01),!g))):(a.moveTo(N,M),a.arc(0,0,h,v,b,!g)):a.moveTo(N,M),c>Sh&&A>Sh?D>Sh?(m=mf(z,$,B,j,c,-D,g),y=mf(N,M,I,R,c,-D,g),a.lineTo(m.cx+m.x01,m.cy+m.y01),D<E?a.arc(m.cx,m.cy,D,_h(m.y01,m.x01),_h(y.y01,y.x01),!g):(a.arc(m.cx,m.cy,D,_h(m.y01,m.x01),_h(m.y11,m.x11),!g),a.arc(0,0,c,_h(m.cy+m.y11,m.cx+m.x11),_h(y.cy+y.y11,y.cx+y.x11),g),a.arc(y.cx,y.cy,D,_h(y.y11,y.x11),_h(y.y01,y.x01),!g))):a.arc(0,0,c,w,x,g):a.lineTo(z,$)}else a.moveTo(0,0);if(a.closePath(),u)return a=null,u+""||null}return u.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,i=(+r.apply(this,arguments)+ +s.apply(this,arguments))/2-Oh/2;return[kh(i)*n,Dh(i)*n]},u.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:lf(+e),u):t},u.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:lf(+t),u):e},u.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:lf(+t),u):n},u.padRadius=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:lf(+t),u):i},u.startAngle=function(t){return arguments.length?(r="function"==typeof t?t:lf(+t),u):r},u.endAngle=function(t){return arguments.length?(s="function"==typeof t?t:lf(+t),u):s},u.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:lf(+t),u):o},u.context=function(t){return arguments.length?(a=null==t?null:t,u):a},u}().startAngle((t=>t.startAngle||0)).endAngle((t=>t.endAngle||0)).padAngle((t=>t.padAngle||0)).innerRadius((t=>t.innerRadius||0)).outerRadius((t=>t.outerRadius||0)).cornerRadius((t=>t.cornerRadius||0)),by=wf().x(gy).y1(my).y0((t=>(t.y||0)+(t.height||0))).defined(yy),xy=wf().y(my).x1(gy).x0((t=>(t.x||0)+(t.width||0))).defined(yy),wy=xf().x(gy).y(my).defined(yy),Ay=fy().x(gy).y(my).width((t=>t.width||0)).height((t=>t.height||0)).cornerRadius((t=>py(t.cornerRadiusTopLeft,t.cornerRadius)||0),(t=>py(t.cornerRadiusTopRight,t.cornerRadius)||0),(t=>py(t.cornerRadiusBottomRight,t.cornerRadius)||0),(t=>py(t.cornerRadiusBottomLeft,t.cornerRadius)||0)),_y=function(t,e){var n=null;function i(){var i;if(n||(n=i=uf()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),i)return n=null,i+""||null}return t="function"==typeof t?t:lf(t||Af),e="function"==typeof e?e:lf(void 0===e?64:+e),i.type=function(e){return arguments.length?(t="function"==typeof e?e:lf(e),i):t},i.size=function(t){return arguments.length?(e="function"==typeof t?t:lf(+t),i):e},i.context=function(t){return arguments.length?(n=null==t?null:t,i):n},i}().type((t=>iy(t.shape||"circle"))).size((t=>py(t.size,64))),ky=dy().x(gy).y(my).defined(yy).size((t=>t.size||1));function Cy(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function Ey(t,e,n,i){return Ay.context(t)(e,n,i)}var Dy=1;function Fy(){Dy=1}function Sy(t,e,n){var i=e.clip,r=t._defs,s=e.clip_id||(e.clip_id="clip"+Dy++),o=r.clipping[s]||(r.clipping[s]={id:s});return yn(i)?o.path=i(null):Cy(n)?o.path=Ey(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+s+")"}function Oy(t){this.clear(),t&&this.union(t)}function Ny(t){this.mark=t,this.bounds=this.bounds||new Oy}function My(t){Ny.call(this,t),this.items=this.items||[]}function zy(t){this._pending=0,this._loader=t||Va()}function $y(t){t._pending+=1}function Ty(t){t._pending-=1}function By(t,e,n){if(e.stroke&&0!==e.opacity&&0!==e.strokeOpacity){const i=null!=e.strokeWidth?+e.strokeWidth:1;t.expand(i+(n?function(t,e){return t.strokeJoin&&"miter"!==t.strokeJoin?0:e}(e,i):0))}return t}Oy.prototype={clone(){return new Oy(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},set(t,e,n,i){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),i<e?(this.y2=e,this.y1=i):(this.y1=e,this.y2=i),this},add(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},expand(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(t){return this.x1*=t,this.y1*=t,this.x2*=t,this.y2*=t,this},translate(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},rotate(t,e,n){const i=this.rotatedPoints(t,e,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(t,e,n){var{x1:i,y1:r,x2:s,y2:o}=this,a=Math.cos(t),u=Math.sin(t),l=e-e*a+n*u,c=n-e*u-n*a;return[a*i-u*r+l,u*i+a*r+c,a*i-u*o+l,u*i+a*o+c,a*s-u*r+l,u*s+a*r+c,a*s-u*o+l,u*s+a*o+c]},union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},alignsWith(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},contains(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},Nn(My,Ny),zy.prototype={pending(){return this._pending},sanitizeURL(t){const e=this;return $y(e),e._loader.sanitize(t,{context:"href"}).then((t=>(Ty(e),t))).catch((()=>(Ty(e),null)))},loadImage(t){const e=this,n=kf();return $y(e),e._loader.sanitize(t,{context:"image"}).then((t=>{const i=t.href;if(!i||!n)throw{url:i};const r=new n,s=Fn(t,"crossOrigin")?t.crossOrigin:"anonymous";return null!=s&&(r.crossOrigin=s),r.onload=()=>Ty(e),r.onerror=()=>Ty(e),r.src=i,r})).catch((t=>(Ty(e),{complete:!1,width:0,height:0,src:t&&t.url||""})))},ready(){const t=this;return new Promise((e=>{!function n(i){t.pending()?setTimeout((()=>{n(!0)}),10):e(i)}(!1)}))}};const jy=Hm-1e-8;let Iy,Ry,Ly,Py,Uy,qy,Wy,Hy;const Vy=(t,e)=>Iy.add(t,e),Gy=(t,e)=>Vy(Ry=t,Ly=e),Xy=t=>Vy(t,Iy.y1),Yy=t=>Vy(Iy.x1,t),Jy=(t,e)=>Uy*t+Wy*e,Zy=(t,e)=>qy*t+Hy*e,Ky=(t,e)=>Vy(Jy(t,e),Zy(t,e)),Qy=(t,e)=>Gy(Jy(t,e),Zy(t,e));function tv(t,e){return Iy=t,e?(Py=e*qm,Uy=Hy=Math.cos(Py),qy=Math.sin(Py),Wy=-qy):(Uy=Hy=1,Py=qy=Wy=0),ev}const ev={beginPath(){},closePath(){},moveTo:Qy,lineTo:Qy,rect(t,e,n,i){Py?(Ky(t+n,e),Ky(t+n,e+i),Ky(t,e+i),Qy(t,e)):(Vy(t+n,e+i),Gy(t,e))},quadraticCurveTo(t,e,n,i){const r=Jy(t,e),s=Zy(t,e),o=Jy(n,i),a=Zy(n,i);nv(Ry,r,o,Xy),nv(Ly,s,a,Yy),Gy(o,a)},bezierCurveTo(t,e,n,i,r,s){const o=Jy(t,e),a=Zy(t,e),u=Jy(n,i),l=Zy(n,i),c=Jy(r,s),h=Zy(r,s);iv(Ry,o,u,c,Xy),iv(Ly,a,l,h,Yy),Gy(c,h)},arc(t,e,n,i,r,s){if(i+=Py,r+=Py,Ry=n*Math.cos(r)+t,Ly=n*Math.sin(r)+e,Math.abs(r-i)>jy)Vy(t-n,e-n),Vy(t+n,e+n);else{const o=i=>Vy(n*Math.cos(i)+t,n*Math.sin(i)+e);let a,u;if(o(i),o(r),r!==i)if((i%=Hm)<0&&(i+=Hm),(r%=Hm)<0&&(r+=Hm),r<i&&(s=!s,a=i,i=r,r=a),s)for(r-=Hm,a=i-i%Wm,u=0;u<4&&a>r;++u,a-=Wm)o(a);else for(a=i-i%Wm+Wm,u=0;u<4&&a<r;++u,a+=Wm)o(a)}}};function nv(t,e,n,i){const r=(t-e)/(t+n-2*e);0<r&&r<1&&i(t+(e-t)*r)}function iv(t,e,n,i,r){const s=i-t+3*e-3*n,o=t+n-2*e,a=t-e;let u,l=0,c=0;Math.abs(s)>1e-14?(u=o*o+a*s,u>=0&&(u=Math.sqrt(u),l=(-o+u)/s,c=(-o-u)/s)):l=.5*a/o,0<l&&l<1&&r(rv(l,t,e,n,i)),0<c&&c<1&&r(rv(c,t,e,n,i))}function rv(t,e,n,i,r){const s=1-t,o=s*s,a=t*t;return o*s*e+3*o*t*n+3*s*a*i+a*t*r}var sv=(sv=_f(1,1))?sv.getContext("2d"):null;const ov=new Oy;function av(t){return function(e,n){if(!sv)return!0;t(sv,e),ov.clear().union(e.bounds).intersect(n).round();const{x1:i,y1:r,x2:s,y2:o}=ov;for(let t=r;t<=o;++t)for(let e=i;e<=s;++e)if(sv.isPointInPath(e,t))return!0;return!1}}function uv(t,e){return e.contains(t.x||0,t.y||0)}function lv(t,e){const n=t.x||0,i=t.y||0,r=t.width||0,s=t.height||0;return e.intersects(ov.set(n,i,n+r,i+s))}function cv(t,e){const n=t.x||0,i=t.y||0;return hv(e,n,i,null!=t.x2?t.x2:n,null!=t.y2?t.y2:i)}function hv(t,e,n,i,r){const{x1:s,y1:o,x2:a,y2:u}=t,l=i-e,c=r-n;let h,f,d,p,g=0,m=1;for(p=0;p<4;++p){if(0===p&&(h=-l,f=-(s-e)),1===p&&(h=l,f=a-e),2===p&&(h=-c,f=-(o-n)),3===p&&(h=c,f=u-n),Math.abs(h)<1e-10&&f<0)return!1;if(d=f/h,h<0){if(d>m)return!1;d>g&&(g=d)}else if(h>0){if(d<g)return!1;d<m&&(m=d)}}return!0}function fv(t,e){t.globalCompositeOperation=e.blend||"source-over"}function dv(t,e){return null==t?e:t}function pv(t,e){const n=e.length;for(let i=0;i<n;++i)t.addColorStop(e[i].offset,e[i].color);return t}function gv(t,e,n){return $m(n)?function(t,e,n){const i=n.width(),r=n.height();let s;if("radial"===e.gradient)s=t.createRadialGradient(n.x1+dv(e.x1,.5)*i,n.y1+dv(e.y1,.5)*r,Math.max(i,r)*dv(e.r1,0),n.x1+dv(e.x2,.5)*i,n.y1+dv(e.y2,.5)*r,Math.max(i,r)*dv(e.r2,.5));else{const o=dv(e.x1,0),a=dv(e.y1,0),u=dv(e.x2,1),l=dv(e.y2,0);if(o!==u&&a!==l&&i!==r){const n=_f(Math.ceil(i),Math.ceil(r)),s=n.getContext("2d");return s.scale(i,r),s.fillStyle=pv(s.createLinearGradient(o,a,u,l),e.stops),s.fillRect(0,0,i,r),t.createPattern(n,"no-repeat")}s=t.createLinearGradient(n.x1+o*i,n.y1+a*r,n.x1+u*i,n.y1+l*r)}return pv(s,e.stops)}(t,n,e.bounds):n}function mv(t,e,n){return(n*=null==e.fillOpacity?1:e.fillOpacity)>0&&(t.globalAlpha=n,t.fillStyle=gv(t,e,e.fill),!0)}var yv=[];function vv(t,e,n){var i=null!=(i=e.strokeWidth)?i:1;return!(i<=0)&&(n*=null==e.strokeOpacity?1:e.strokeOpacity)>0&&(t.globalAlpha=n,t.strokeStyle=gv(t,e,e.stroke),t.lineWidth=i,t.lineCap=e.strokeCap||"butt",t.lineJoin=e.strokeJoin||"miter",t.miterLimit=e.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(e.strokeDash||yv),t.lineDashOffset=e.strokeDashOffset||0),!0)}function bv(t,e){return t.zindex-e.zindex||t.index-e.index}function xv(t){if(!t.zdirty)return t.zitems;var e,n,i,r=t.items,s=[];for(n=0,i=r.length;n<i;++n)(e=r[n]).index=n,e.zindex&&s.push(e);return t.zdirty=!1,t.zitems=s.sort(bv)}function wv(t,e){var n,i,r=t.items;if(!r||!r.length)return;const s=xv(t);if(s&&s.length){for(n=0,i=r.length;n<i;++n)r[n].zindex||e(r[n]);r=s}for(n=0,i=r.length;n<i;++n)e(r[n])}function Av(t,e){var n,i,r=t.items;if(!r||!r.length)return null;const s=xv(t);for(s&&s.length&&(r=s),i=r.length;--i>=0;)if(n=e(r[i]))return n;if(r===s)for(i=(r=t.items).length;--i>=0;)if(!r[i].zindex&&(n=e(r[i])))return n;return null}function _v(t){return function(e,n,i){wv(n,(n=>{i&&!i.intersects(n.bounds)||Cv(t,e,n,n)}))}}function kv(t){return function(e,n,i){!n.items.length||i&&!i.intersects(n.bounds)||Cv(t,e,n.items[0],n.items)}}function Cv(t,e,n,i){var r=null==n.opacity?1:n.opacity;0!==r&&(t(e,i)||(fv(e,n),n.fill&&mv(e,n,r)&&e.fill(),n.stroke&&vv(e,n,r)&&e.stroke()))}function Ev(t){return t=t||Ge,function(e,n,i,r,s,o){return i*=e.pixelRatio,r*=e.pixelRatio,Av(n,(n=>{const a=n.bounds;if((!a||a.contains(s,o))&&a)return t(e,n,i,r,s,o)?n:void 0}))}}function Dv(t,e){return function(n,i,r,s){var o,a,u=Array.isArray(i)?i[0]:i,l=null==e?u.fill:e,c=u.stroke&&n.isPointInStroke;return c&&(o=u.strokeWidth,a=u.strokeCap,n.lineWidth=null!=o?o:1,n.lineCap=null!=a?a:"butt"),!t(n,i)&&(l&&n.isPointInPath(r,s)||c&&n.isPointInStroke(r,s))}}function Fv(t){return Ev(Dv(t))}function Sv(t,e){return"translate("+t+","+e+")"}function Ov(t){return"rotate("+t+")"}function Nv(t){return Sv(t.x||0,t.y||0)}function Mv(t,e,n){function i(t,n){var i=n.x||0,r=n.y||0,s=n.angle||0;t.translate(i,r),s&&t.rotate(s*=qm),t.beginPath(),e(t,n),s&&t.rotate(-s),t.translate(-i,-r)}return{type:t,tag:"path",nested:!1,attr:function(t,n){t("transform",function(t){return Sv(t.x||0,t.y||0)+(t.angle?" "+Ov(t.angle):"")}(n)),t("d",e(null,n))},bound:function(t,n){return e(tv(t,n.angle),n),By(t,n).translate(n.x||0,n.y||0)},draw:_v(i),pick:Fv(i),isect:n||av(i)}}var zv=Mv("arc",(function(t,e){return vy.context(t)(e)}));function $v(t,e,n){function i(t,n){t.beginPath(),e(t,n)}const r=Dv(i);return{type:t,tag:"path",nested:!0,attr:function(t,n){var i=n.mark.items;i.length&&t("d",e(null,i))},bound:function(t,n){var i=n.items;return 0===i.length?t:(e(tv(t),i),By(t,i[0]))},draw:kv(i),pick:function(t,e,n,i,s,o){var a=e.items,u=e.bounds;return!a||!a.length||u&&!u.contains(s,o)?null:(n*=t.pixelRatio,i*=t.pixelRatio,r(t,a,n,i)?a[0]:null)},isect:uv,tip:n}}var Tv=$v("area",(function(t,e){const n=e[0],i=n.interpolate||"linear";return("horizontal"===n.orient?xy:by).curve(Rm(i,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,i,r="horizontal"===t[0].orient?e[1]:e[0],s="horizontal"===t[0].orient?"y":"x",o=t.length,a=1/0;--o>=0;)!1!==t[o].defined&&(i=Math.abs(t[o][s]-r))<a&&(a=i,n=t[o]);return n}));function Bv(t,e){t.beginPath(),Cy(e)?Ey(t,e,0,0):t.rect(0,0,e.width||0,e.height||0),t.clip()}function jv(t){const e=dv(t.strokeWidth,1);return null!=t.strokeOffset?t.strokeOffset:t.stroke&&e>.5&&e<1.5?.5-Math.abs(e-1):0}function Iv(t,e){const n=jv(e);t("d",Ey(null,e,n,n))}function Rv(t,e,n,i){const r=jv(e);t.beginPath(),Ey(t,e,(n||0)+r,(i||0)+r)}const Lv=Dv(Rv),Pv=Dv(Rv,!1),Uv=Dv(Rv,!0);var qv={type:"group",tag:"g",nested:!1,attr:function(t,e){t("transform",Nv(e))},bound:function(t,e){if(!e.clip&&e.items){const n=e.items,i=n.length;for(let e=0;e<i;++e)t.union(n[e].bounds)}return(e.clip||e.width||e.height)&&!e.noBound&&t.add(0,0).add(e.width||0,e.height||0),By(t,e),t.translate(e.x||0,e.y||0)},draw:function(t,e,n){wv(e,(e=>{const i=e.x||0,r=e.y||0,s=e.strokeForeground,o=null==e.opacity?1:e.opacity;(e.stroke||e.fill)&&o&&(Rv(t,e,i,r),fv(t,e),e.fill&&mv(t,e,o)&&t.fill(),e.stroke&&!s&&vv(t,e,o)&&t.stroke()),t.save(),t.translate(i,r),e.clip&&Bv(t,e),n&&n.translate(-i,-r),wv(e,(e=>{this.draw(t,e,n)})),n&&n.translate(i,r),t.restore(),s&&e.stroke&&o&&(Rv(t,e,i,r),fv(t,e),vv(t,e,o)&&t.stroke())}))},pick:function(t,e,n,i,r,s){if(e.bounds&&!e.bounds.contains(r,s)||!e.items)return null;const o=n*t.pixelRatio,a=i*t.pixelRatio;return Av(e,(u=>{let l,c,h;const f=u.bounds;if(f&&!f.contains(r,s))return;c=u.x||0,h=u.y||0;const d=c+(u.width||0),p=h+(u.height||0),g=u.clip;if(g&&(r<c||r>d||s<h||s>p))return;if(t.save(),t.translate(c,h),c=r-c,h=s-h,g&&Cy(u)&&!Uv(t,u,o,a))return t.restore(),null;const m=u.strokeForeground,y=!1!==e.interactive;return y&&m&&u.stroke&&Pv(t,u,o,a)?(t.restore(),u):(l=Av(u,(t=>function(t,e,n){return(!1!==t.interactive||"group"===t.marktype)&&t.bounds&&t.bounds.contains(e,n)}(t,c,h)?this.pick(t,n,i,c,h):null)),!l&&y&&(u.fill||!m&&u.stroke)&&Lv(t,u,o,a)&&(l=u),t.restore(),l||null)}))},isect:lv,content:function(t,e,n){t("clip-path",e.clip?Sy(n,e,e):null)},background:function(t,e){t("class","background"),t("aria-hidden",!0),Iv(t,e)},foreground:function(t,e){t("class","foreground"),t("aria-hidden",!0),e.strokeForeground?Iv(t,e):t("d","")}},Wv={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Hv(t,e){var n=t.image;return(!n||t.url&&t.url!==n.url)&&(n={complete:!1,width:0,height:0},e.loadImage(t.url).then((e=>{t.image=e,t.image.url=t.url}))),n}function Vv(t,e){return null!=t.width?t.width:e&&e.width?!1!==t.aspect&&t.height?t.height*e.width/e.height:e.width:0}function Gv(t,e){return null!=t.height?t.height:e&&e.height?!1!==t.aspect&&t.width?t.width*e.height/e.width:e.height:0}function Xv(t,e){return"center"===t?e/2:"right"===t?e:0}function Yv(t,e){return"middle"===t?e/2:"bottom"===t?e:0}var Jv={type:"image",tag:"image",nested:!1,attr:function(t,e,n){const i=Hv(e,n),r=Vv(e,i),s=Gv(e,i),o=(e.x||0)-Xv(e.align,r),a=(e.y||0)-Yv(e.baseline,s);t("href",!i.src&&i.toDataURL?i.toDataURL():i.src||"",Wv["xmlns:xlink"],"xlink:href"),t("transform",Sv(o,a)),t("width",r),t("height",s),t("preserveAspectRatio",!1===e.aspect?"none":"xMidYMid")},bound:function(t,e){const n=e.image,i=Vv(e,n),r=Gv(e,n),s=(e.x||0)-Xv(e.align,i),o=(e.y||0)-Yv(e.baseline,r);return t.set(s,o,s+i,o+r)},draw:function(t,e,n){wv(e,(e=>{if(n&&!n.intersects(e.bounds))return;const i=Hv(e,this);let r=Vv(e,i),s=Gv(e,i);if(0===r||0===s)return;let o,a,u,l,c=(e.x||0)-Xv(e.align,r),h=(e.y||0)-Yv(e.baseline,s);!1!==e.aspect&&(a=i.width/i.height,u=e.width/e.height,a==a&&u==u&&a!==u&&(u<a?(l=r/a,h+=(s-l)/2,s=l):(l=s*a,c+=(r-l)/2,r=l))),(i.complete||i.toDataURL)&&(fv(t,e),t.globalAlpha=null!=(o=e.opacity)?o:1,t.imageSmoothingEnabled=!1!==e.smooth,t.drawImage(i,c,h,r,s))}))},pick:Ev(),isect:Ge,get:Hv,xOffset:Xv,yOffset:Yv},Zv=$v("line",(function(t,e){const n=e[0],i=n.interpolate||"linear";return wy.curve(Rm(i,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,i,r=Math.pow(t[0].strokeWidth||1,2),s=t.length;--s>=0;)if(!1!==t[s].defined&&(n=t[s].x-e[0])*n+(i=t[s].y-e[1])*i<r)return t[s];return null}));function Kv(t,e){var n=e.path;if(null==n)return!0;var i=e.x||0,r=e.y||0,s=e.scaleX||1,o=e.scaleY||1,a=(e.angle||0)*qm,u=e.pathCache;u&&u.path===n||((e.pathCache=u=Um(n)).path=n),a&&t.rotate&&t.translate?(t.translate(i,r),t.rotate(a),Qm(t,u,0,0,s,o),t.rotate(-a),t.translate(-i,-r)):Qm(t,u,i,r,s,o)}var Qv={type:"path",tag:"path",nested:!1,attr:function(t,e){var n=e.scaleX||1,i=e.scaleY||1;1===n&&1===i||t("vector-effect","non-scaling-stroke"),t("transform",function(t){return Sv(t.x||0,t.y||0)+(t.angle?" "+Ov(t.angle):"")+(t.scaleX||t.scaleY?" "+(e=t.scaleX||1,n=t.scaleY||1,"scale("+e+","+n+")"):"");var e,n}(e)),t("d",e.path)},bound:function(t,e){return Kv(tv(t,e.angle),e)?t.set(0,0,0,0):By(t,e,!0)},draw:_v(Kv),pick:Fv(Kv),isect:av(Kv)};function tb(t,e){t.beginPath(),Ey(t,e)}var eb={type:"rect",tag:"path",nested:!1,attr:function(t,e){t("d",Ey(null,e))},bound:function(t,e){var n,i;return By(t.set(n=e.x||0,i=e.y||0,n+e.width||0,i+e.height||0),e)},draw:_v(tb),pick:Fv(tb),isect:lv};function nb(t,e,n){var i,r,s,o;return!(!e.stroke||!vv(t,e,n)||(i=e.x||0,r=e.y||0,s=null!=e.x2?e.x2:i,o=null!=e.y2?e.y2:r,t.beginPath(),t.moveTo(i,r),t.lineTo(s,o),0))}var ib={type:"rule",tag:"line",nested:!1,attr:function(t,e){t("transform",Nv(e)),t("x2",null!=e.x2?e.x2-(e.x||0):0),t("y2",null!=e.y2?e.y2-(e.y||0):0)},bound:function(t,e){var n,i;return By(t.set(n=e.x||0,i=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:i),e)},draw:function(t,e,n){wv(e,(e=>{if(!n||n.intersects(e.bounds)){var i=null==e.opacity?1:e.opacity;i&&nb(t,e,i)&&(fv(t,e),t.stroke())}}))},pick:Ev((function(t,e,n,i){return!!t.isPointInStroke&&nb(t,e,1)&&t.isPointInStroke(n,i)})),isect:cv},rb=Mv("shape",(function(t,e){return(e.mark.shape||e.shape).context(t)(e)})),sb=Mv("symbol",(function(t,e){return _y.context(t)(e)}),uv);const ob=function(t){let e,n,i;t=+t||1e4;const r=()=>{e={},n={},i=0},s=(r,s)=>(++i>t&&(n=e,e={},i=1),e[r]=s);return r(),{clear:r,has:t=>Fn(e,t)||Fn(n,t),get:t=>Fn(e,t)?e[t]:Fn(n,t)?s(t,n[t]):void 0,set:(t,n)=>Fn(e,t)?e[t]=n:s(t,n)}}();var ab={height:db,measureWidth:hb,estimateWidth:lb,width:lb,canvas:ub};function ub(t){ab.width=t&&sv?hb:lb}function lb(t,e){return cb(yb(t,e),db(t))}function cb(t,e){return~~(.8*t.length*e)}function hb(t,e){return db(t)<=0||!(e=yb(t,e))?0:fb(e,bb(t))}function fb(t,e){const n=`(${e}) ${t}`;let i=ob.get(n);return void 0===i&&(sv.font=e,i=sv.measureText(t).width,ob.set(n,i)),i}function db(t){return null!=t.fontSize?+t.fontSize||0:11}function pb(t){return null!=t.lineHeight?t.lineHeight:db(t)+2}function gb(t){return e=t.lineBreak&&t.text&&!Ze(t.text)?t.text.split(t.lineBreak):t.text,Ze(e)?e.length>1?e:e[0]:e;var e}function mb(t){const e=gb(t);return(Ze(e)?e.length-1:0)*pb(t)}function yb(t,e){const n=null==e?"":(e+"").trim();return t.limit>0&&n.length?function(t,e){var n=+t.limit,i=function(t){if(ab.width===hb){const e=bb(t);return t=>fb(t,e)}{const e=db(t);return t=>cb(t,e)}}(t);if(i(e)<n)return e;var r,s=t.ellipsis||"",o="rtl"===t.dir,a=0,u=e.length;if(n-=i(s),o){for(;a<u;)r=a+u>>>1,i(e.slice(r))>n?a=r+1:u=r;return s+e.slice(a)}for(;a<u;)r=1+(a+u>>>1),i(e.slice(0,r))<n?a=r:u=r-1;return e.slice(0,a)+s}(t,n):n}function vb(t,e){var n=t.font;return(e&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function bb(t,e){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+db(t)+"px "+vb(t,e)}function xb(t){var e=t.baseline,n=db(t);return Math.round("top"===e?.79*n:"middle"===e?.3*n:"bottom"===e?-.21*n:"line-top"===e?.29*n+.5*pb(t):"line-bottom"===e?.29*n-.5*pb(t):0)}ub(!0);const wb={left:"start",center:"middle",right:"end"},Ab=new Oy;function _b(t){var e,n=t.x||0,i=t.y||0,r=t.radius||0;return r&&(e=(t.theta||0)-Wm,n+=r*Math.cos(e),i+=r*Math.sin(e)),Ab.x1=n,Ab.y1=i,Ab}function kb(t,e,n){var i,r=ab.height(e),s=e.align,o=_b(e),a=o.x1,u=o.y1,l=e.dx||0,c=(e.dy||0)+xb(e)-Math.round(.8*r),h=gb(e);if(Ze(h)?(r+=pb(e)*(h.length-1),i=h.reduce(((t,n)=>Math.max(t,ab.width(e,n))),0)):i=ab.width(e,h),"center"===s?l-=i/2:"right"===s&&(l-=i),t.set(l+=a,c+=u,l+i,c+r),e.angle&&!n)t.rotate(e.angle*qm,a,u);else if(2===n)return t.rotatedPoints(e.angle*qm,a,u);return t}var Cb={arc:zv,area:Tv,group:qv,image:Jv,line:Zv,path:Qv,rect:eb,rule:ib,shape:rb,symbol:sb,text:{type:"text",tag:"text",nested:!1,attr:function(t,e){var n,i=e.dx||0,r=(e.dy||0)+xb(e),s=_b(e),o=s.x1,a=s.y1,u=e.angle||0;t("text-anchor",wb[e.align]||"start"),u?(n=Sv(o,a)+" "+Ov(u),(i||r)&&(n+=" "+Sv(i,r))):n=Sv(o+i,a+r),t("transform",n)},bound:kb,draw:function(t,e,n){wv(e,(e=>{var i,r,s,o,a,u,l,c=null==e.opacity?1:e.opacity;if(!(n&&!n.intersects(e.bounds)||0===c||e.fontSize<=0||null==e.text||0===e.text.length)){if(t.font=bb(e),t.textAlign=e.align||"left",r=(i=_b(e)).x1,s=i.y1,e.angle&&(t.save(),t.translate(r,s),t.rotate(e.angle*qm),r=s=0),r+=e.dx||0,s+=(e.dy||0)+xb(e),u=gb(e),fv(t,e),Ze(u))for(a=pb(e),o=0;o<u.length;++o)l=yb(e,u[o]),e.fill&&mv(t,e,c)&&t.fillText(l,r,s),e.stroke&&vv(t,e,c)&&t.strokeText(l,r,s),s+=a;else l=yb(e,u),e.fill&&mv(t,e,c)&&t.fillText(l,r,s),e.stroke&&vv(t,e,c)&&t.strokeText(l,r,s);e.angle&&t.restore()}}))},pick:Ev((function(t,e,n,i,r,s){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var o=_b(e),a=o.x1,u=o.y1,l=kb(Ab,e,1),c=-e.angle*qm,h=Math.cos(c),f=Math.sin(c),d=h*r-f*s+(a-h*a+f*u),p=f*r+h*s+(u-f*a-h*u);return l.contains(d,p)})),isect:function(t,e){const n=kb(Ab,t,2);return hv(e,n[0],n[1],n[2],n[3])||hv(e,n[0],n[1],n[4],n[5])||hv(e,n[4],n[5],n[6],n[7])||hv(e,n[2],n[3],n[6],n[7])}},trail:$v("trail",(function(t,e){return ky.context(t)(e)}),(function(t,e){for(var n,i,r=t.length;--r>=0;)if(!1!==t[r].defined&&(n=t[r].x-e[0])*n+(i=t[r].y-e[1])*i<(n=t[r].size||1)*n)return t[r];return null}))};function Eb(t,e,n){var i=Cb[t.mark.marktype],r=e||i.bound;return i.nested&&(t=t.mark),r(t.bounds||(t.bounds=new Oy),t,n)}var Db={mark:null};function Fb(t,e,n){var i,r,s,o,a=Cb[t.marktype],u=a.bound,l=t.items,c=l&&l.length;if(a.nested)return c?s=l[0]:(Db.mark=t,s=Db),o=Eb(s,u,n),e&&e.union(o)||o;if(e=e||t.bounds&&t.bounds.clear()||new Oy,c)for(i=0,r=l.length;i<r;++i)e.union(Eb(l[i],u,n));return t.bounds=e}const Sb=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Ob(t,e){return JSON.stringify(t,Sb,e)}function Nb(t){return Mb("string"==typeof t?JSON.parse(t):t)}function Mb(t){var e,n,i,r=t.marktype,s=t.items;if(s)for(n=0,i=s.length;n<i;++n)e=r?"mark":"group",s[n][e]=t,s[n].zindex&&(s[n][e].zdirty=!0),"group"===(r||e)&&Mb(s[n]);return r&&Fb(t),t}function zb(t){arguments.length?this.root=Nb(t):(this.root=$b({marktype:"group",name:"root",role:"frame"}),this.root.items=[new My(this.root)])}function $b(t,e){const n={bounds:new Oy,clip:!!t.clip,group:e,interactive:!1!==t.interactive,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0};return null!=t.aria&&(n.aria=t.aria),t.description&&(n.description=t.description),n}function Tb(t,e,n){return!t&&"undefined"!=typeof document&&document.createElement&&(t=document),t?n?t.createElementNS(n,e):t.createElement(e):null}function Bb(t,e){e=e.toLowerCase();for(var n=t.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===e)return n[i]}function jb(t,e,n,i){var r,s=t.childNodes[e];return s&&s.tagName.toLowerCase()===n.toLowerCase()||(r=s||null,s=Tb(t.ownerDocument,n,i),t.insertBefore(s,r)),s}function Ib(t,e){for(var n=t.childNodes,i=n.length;i>e;)t.removeChild(n[--i]);return t}function Rb(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function Lb(t,e){const n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]}function Pb(t,e){this._active=null,this._handlers={},this._loader=t||Va(),this._tooltip=e||Ub}function Ub(t,e,n,i){t.element().setAttribute("title",i||"")}function qb(t){this._el=null,this._bgcolor=null,this._loader=new zy(t)}zb.prototype={toJSON(t){return Ob(this.root,t||0)},mark(t,e,n){const i=$b(t,e=e||this.root.items[0]);return e.items[n]=i,i.zindex&&(i.group.zdirty=!0),i}},Pb.prototype={initialize(t,e,n){return this._el=t,this._obj=n||null,this.origin(e)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()},scene(t){return arguments.length?(this._scene=t,this):this._scene},on(){},off(){},_handlerIndex(t,e,n){for(let i=t?t.length:0;--i>=0;)if(t[i].type===e&&(!n||t[i].handler===n))return i;return-1},handlers(t){const e=this._handlers,n=[];if(t)n.push(...e[this.eventName(t)]);else for(const t in e)n.push(...e[t]);return n},eventName(t){const e=t.indexOf(".");return e<0?t:t.slice(0,e)},handleHref(t,e,n){this._loader.sanitize(n,{context:"href"}).then((e=>{const n=new MouseEvent(t.type,t),i=Tb(null,"a");for(const t in e)i.setAttribute(t,e[t]);i.dispatchEvent(n)})).catch((()=>{}))},handleTooltip(t,e,n){if(e&&null!=e.tooltip){e=function(t,e,n,i){var r,s,o=t&&t.mark;if(o&&(r=Cb[o.marktype]).tip){for((s=Lb(e,n))[0]-=i[0],s[1]-=i[1];t=t.mark.group;)s[0]-=t.x||0,s[1]-=t.y||0;t=r.tip(o.items,s)}return t}(e,t,this.canvas(),this._origin);const i=n&&e&&e.tooltip||null;this._tooltip.call(this._obj,this,t,e,i)}},getItemBoundingClientRect(t){const e=this.canvas();if(!e)return;const n=e.getBoundingClientRect(),i=this._origin,r=t.bounds,s=r.width(),o=r.height();let a=r.x1+i[0]+n.left,u=r.y1+i[1]+n.top;for(;t.mark&&(t=t.mark.group);)a+=t.x||0,u+=t.y||0;return{x:a,y:u,width:s,height:o,left:a,top:u,right:a+s,bottom:u+o}}},qb.prototype={initialize(t,e,n,i,r){return this._el=t,this.resize(e,n,i,r)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(t){return 0===arguments.length?this._bgcolor:(this._bgcolor=t,this)},resize(t,e,n,i){return this._width=t,this._height=e,this._origin=n||[0,0],this._scale=i||1,this},dirty(){},render(t){const e=this;return e._call=function(){e._render(t)},e._call(),e._call=null,e},_render(){},renderAsync(t){const e=this.render(t);return this._ready?this._ready.then((()=>e)):Promise.resolve(e)},_load(t,e){var n=this,i=n._loader[t](e);if(!n._ready){const t=n._call;n._ready=n._loader.ready().then((e=>{e&&t(),n._ready=null}))}return i},sanitizeURL(t){return this._load("sanitizeURL",t)},loadImage(t){return this._load("loadImage",t)}};const Wb="dragenter",Hb="dragleave",Vb="dragover",Gb="mousedown",Xb="mousemove",Yb="mouseout",Jb="mouseover",Zb="click",Kb="mousewheel",Qb="touchstart",tx="touchmove",ex="touchend",nx=Xb,ix=Yb,rx=Zb;function sx(t,e){Pb.call(this,t,e),this._down=null,this._touch=null,this._first=!0,this._events={}}function ox(t,e){(t=>t===Qb||t===tx||t===ex?[Qb,tx,ex]:[t])(e).forEach((e=>function(t,e){const n=t.canvas();n&&!t._events[e]&&(t._events[e]=1,n.addEventListener(e,t[e]?n=>t[e](n):n=>t.fire(e,n)))}(t,e)))}function ax(t,e,n){return function(i){const r=this._active,s=this.pickEvent(i);s===r||(r&&r.exit||this.fire(n,i),this._active=s,this.fire(e,i)),this.fire(t,i)}}function ux(t){return function(e){this.fire(t,e),this._active=null}}Nn(sx,Pb,{initialize(t,e,n){return this._canvas=t&&Bb(t,"canvas"),[Zb,Gb,Xb,Yb,Hb].forEach((t=>ox(this,t))),Pb.prototype.initialize.call(this,t,e,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup",Wb,Hb,Vb,Gb,"mouseup",Xb,Yb,Jb,Zb,"dblclick","wheel",Kb,Qb,tx,ex],DOMMouseScroll(t){this.fire(Kb,t)},mousemove:ax(Xb,Jb,Yb),dragover:ax(Vb,Wb,Hb),mouseout:ux(Yb),dragleave:ux(Hb),mousedown(t){this._down=this._active,this.fire(Gb,t)},click(t){this._down===this._active&&(this.fire(Zb,t),this._down=null)},touchstart(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(Qb,t,!0)},touchmove(t){this.fire(tx,t,!0)},touchend(t){this.fire(ex,t,!0),this._touch=null},fire(t,e,n){const i=n?this._touch:this._active,r=this._handlers[t];if(e.vegaType=t,t===rx&&i&&i.href?this.handleHref(e,i,i.href):t!==nx&&t!==ix||this.handleTooltip(e,i,t!==ix),r)for(let t=0,n=r.length;t<n;++t)r[t].handler.call(this._obj,e,i)},on(t,e){const n=this.eventName(t),i=this._handlers;return this._handlerIndex(i[n],t,e)<0&&(ox(this,t),(i[n]||(i[n]=[])).push({type:t,handler:e})),this},off(t,e){const n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);return r>=0&&i.splice(r,1),this},pickEvent(t){const e=Lb(t,this._canvas),n=this._origin;return this.pick(this._scene,e[0],e[1],e[0]-n[0],e[1]-n[1])},pick(t,e,n,i,r){const s=this.context();return Cb[t.marktype].pick.call(this,s,t,e,n,i,r)}});var lx="undefined"!=typeof window&&window.devicePixelRatio||1;function cx(t){qb.call(this,t),this._options={},this._redraw=!1,this._dirty=new Oy,this._tempb=new Oy}const hx=qb.prototype;function fx(t,e){Pb.call(this,t,e);const n=this;n._hrefHandler=dx(n,((t,e)=>{e&&e.href&&n.handleHref(t,e,e.href)})),n._tooltipHandler=dx(n,((t,e)=>{n.handleTooltip(t,e,t.type!==ix)}))}Nn(cx,qb,{initialize(t,e,n,i,r,s){return this._options=s||{},this._canvas=this._options.externalContext?null:_f(1,1,this._options.type),t&&this._canvas&&(Ib(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),hx.initialize.call(this,t,e,n,i,r)},resize(t,e,n,i){if(hx.resize.call(this,t,e,n,i),this._canvas)!function(t,e,n,i,r,s){const o="undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&null!=t.parentNode,a=t.getContext("2d"),u=o?lx:r;t.width=e*u,t.height=n*u;for(const t in s)a[t]=s[t];o&&1!==u&&(t.style.width=e+"px",t.style.height=n+"px"),a.pixelRatio=u,a.setTransform(u,0,0,u,u*i[0],u*i[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const t=this._options.externalContext;t||Le("CanvasRenderer is missing a valid canvas or context"),t.scale(this._scale,this._scale),t.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(t){const e=this._tempb.clear().union(t.bounds);let n=t.mark.group;for(;n;)e.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(e)},_render(t){const e=this.context(),n=this._origin,i=this._width,r=this._height,s=this._dirty,o=((t,e,n)=>(new Oy).set(0,0,e,n).translate(-t[0],-t[1]))(n,i,r);e.save();const a=this._redraw||s.empty()?(this._redraw=!1,o.expand(1)):function(t,e,n){return e.expand(1).round(),t.pixelRatio%1&&e.scale(t.pixelRatio).round().scale(1/t.pixelRatio),e.translate(-n[0]%1,-n[1]%1),t.beginPath(),t.rect(e.x1,e.y1,e.width(),e.height()),t.clip(),e}(e,o.intersect(s),n);return this.clear(-n[0],-n[1],i,r),this.draw(e,t,a),e.restore(),s.clear(),this},draw(t,e,n){const i=Cb[e.marktype];e.clip&&function(t,e){var n=e.clip;t.save(),yn(n)?(t.beginPath(),n(t),t.clip()):Bv(t,e.group)}(t,e),i.draw.call(this,t,e,n),e.clip&&t.restore()},clear(t,e,n,i){const r=this._options,s=this.context();"pdf"===r.type||r.externalContext||s.clearRect(t,e,n,i),null!=this._bgcolor&&(s.fillStyle=this._bgcolor,s.fillRect(t,e,n,i))}});const dx=(t,e)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,e.call(t._obj,n,i)};Nn(fx,Pb,{initialize(t,e,n){let i=this._svg;return i&&(i.removeEventListener(rx,this._hrefHandler),i.removeEventListener(nx,this._tooltipHandler),i.removeEventListener(ix,this._tooltipHandler)),this._svg=i=t&&Bb(t,"svg"),i&&(i.addEventListener(rx,this._hrefHandler),i.addEventListener(nx,this._tooltipHandler),i.addEventListener(ix,this._tooltipHandler)),Pb.prototype.initialize.call(this,t,e,n)},canvas(){return this._svg},on(t,e){const n=this.eventName(t),i=this._handlers;if(this._handlerIndex(i[n],t,e)<0){const r={type:t,handler:e,listener:dx(this,e)};(i[n]||(i[n]=[])).push(r),this._svg&&this._svg.addEventListener(n,r.listener)}return this},off(t,e){const n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this}});const px="aria-hidden",gx="aria-label",mx="role",yx="aria-roledescription",vx="graphics-object",bx="graphics-symbol",xx=(t,e,n)=>({[mx]:t,[yx]:e,[gx]:n||void 0}),wx=Wn(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),Ax={axis:{desc:"axis",caption:function(t){const e=t.datum,n=t.orient,i=e.title?Dx(t):null,r=t.context,s=r.scales[e.scale].value,o=r.dataflow.locale(),a=s.type;return("left"===n||"right"===n?"Y":"X")+"-axis"+(i?` titled '${i}'`:"")+` for a ${Kg(a)?"discrete":a} scale`+` with ${Nm(o,s,t)}`}},legend:{desc:"legend",caption:function(t){const e=t.datum,n=e.title?Dx(t):null,i=`${e.type||""} legend`.trim(),r=e.scales,s=Object.keys(r),o=t.context,a=o.scales[r[s[0]]].value,u=o.dataflow.locale();return((l=i).length?l[0].toUpperCase()+l.slice(1):l)+(n?` titled '${n}'`:"")+` for ${function(t){return(t=t.map((t=>t+("fill"===t||"stroke"===t?" color":"")))).length<2?t[0]:t.slice(0,-1).join(", ")+" and "+nn(t)}(s)}`+` with ${Nm(u,a,t)}`;var l}},"title-text":{desc:"title",caption:t=>`Title text '${Ex(t)}'`},"title-subtitle":{desc:"subtitle",caption:t=>`Subtitle text '${Ex(t)}'`}},_x={ariaRole:mx,ariaRoleDescription:yx,description:gx};function kx(t,e){const n=!1===e.aria;if(t(px,n||void 0),n||null==e.description)for(const e in _x)t(_x[e],void 0);else{const n=e.mark.marktype;t(gx,e.description),t(mx,e.ariaRole||("group"===n?vx:bx)),t(yx,e.ariaRoleDescription||`${n} mark`)}}function Cx(t){return!1===t.aria?{[px]:!0}:wx[t.role]?null:Ax[t.role]?function(t,e){try{const n=t.items[0],i=e.caption||(()=>"");return xx(e.role||bx,e.desc,n.description||i(n))}catch(t){return null}}(t,Ax[t.role]):function(t){const e=t.marktype,n="group"===e||"text"===e||t.items.some((t=>null!=t.description&&!1!==t.aria));return xx(n?vx:bx,`${e} mark container`,t.description)}(t)}function Ex(t){return mn(t.text).join(" ")}function Dx(t){try{return mn(nn(t.items).items[0].text).join(" ")}catch(t){return null}}const Fx=t=>(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function Sx(){let t="",e="",n="";const i=[],r=()=>e=n="",s=(t,n)=>{var i;return null!=n&&(e+=` ${t}="${i=n,Fx(i).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}"`),o},o={open(a,...u){(s=>{e&&(t+=`${e}>${n}`,r()),i.push(s)})(a),e="<"+a;for(const t of u)for(const e in t)s(e,t[e]);return o},close(){const s=i.pop();return t+=e?e+(n?`>${n}</${s}>`:"/>"):`</${s}>`,r(),o},attr:s,text:t=>(n+=Fx(t),o),toString:()=>t};return o}const Ox=t=>Nx(Sx(),t)+"";function Nx(t,e){if(t.open(e.tagName),e.hasAttributes()){const n=e.attributes,i=n.length;for(let e=0;e<i;++e)t.attr(n[e].name,n[e].value)}if(e.hasChildNodes()){const n=e.childNodes,i=n.length;for(let e=0;e<i;e++){const i=n[e];3===i.nodeType?t.text(i.nodeValue):Nx(t,i)}}return t.close()}const Mx={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},zx={fill:"none","stroke-miterlimit":10},$x="http://www.w3.org/2000/xmlns/",Tx=Wv.xmlns;function Bx(t){qb.call(this,t),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const jx=qb.prototype;function Ix(t,e){for(;t&&t.dirty!==e;t=t.mark.group){if(t.dirty=e,!t.mark||t.mark.dirty===e)return;t.mark.dirty=e}}function Rx(t,e,n){let i,r,s;if("radial"===e.gradient){let i=jb(t,n++,"pattern",Tx);Gx(i,{id:zm+e.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),i=jb(i,0,"rect",Tx),Gx(i,{width:1,height:1,fill:`url(${Yx()}#${e.id})`}),Gx(t=jb(t,n++,"radialGradient",Tx),{id:e.id,fx:e.x1,fy:e.y1,fr:e.r1,cx:e.x2,cy:e.y2,r:e.r2})}else Gx(t=jb(t,n++,"linearGradient",Tx),{id:e.id,x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2});for(i=0,r=e.stops.length;i<r;++i)s=jb(t,i,"stop",Tx),s.setAttribute("offset",e.stops[i].offset),s.setAttribute("stop-color",e.stops[i].color);return Ib(t,i),n}function Lx(t,e,n){let i;return(t=jb(t,n,"clipPath",Tx)).setAttribute("id",e.id),e.path?(i=jb(t,0,"path",Tx),i.setAttribute("d",e.path)):(i=jb(t,0,"rect",Tx),Gx(i,{x:0,y:0,width:e.width,height:e.height})),Ib(t,1),n+1}function Px(t,e,n,i,r){let s,o=t._svg;if(!o&&(s=e.ownerDocument,o=Tb(s,i,Tx),t._svg=o,t.mark&&(o.__data__=t,o.__values__={fill:"default"},"g"===i))){const e=Tb(s,"path",Tx);o.appendChild(e),e.__data__=t;const n=Tb(s,"g",Tx);o.appendChild(n),n.__data__=t;const i=Tb(s,"path",Tx);o.appendChild(i),i.__data__=t,i.__values__={fill:"default"}}return(o.ownerSVGElement!==r||function(t,e){return t.parentNode&&t.parentNode.childNodes.length>1&&t.previousSibling!=e}(o,n))&&e.insertBefore(o,n?n.nextSibling:e.firstChild),o}Nn(Bx,qb,{initialize(t,e,n,i,r){return this._defs={},this._clearDefs(),t&&(this._svg=jb(t,0,"svg",Tx),this._svg.setAttributeNS($x,"xmlns",Tx),this._svg.setAttributeNS($x,"xmlns:xlink",Wv["xmlns:xlink"]),this._svg.setAttribute("version",Wv.version),this._svg.setAttribute("class","marks"),Ib(t,1),this._root=jb(this._svg,0,"g",Tx),Gx(this._root,zx),Ib(this._svg,1)),this.background(this._bgcolor),jx.initialize.call(this,t,e,n,i,r)},background(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),jx.background.apply(this,arguments)},resize(t,e,n,i){return jx.resize.call(this,t,e,n,i),this._svg&&(Gx(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const t=this._svg,e=this._bgcolor;if(!t)return null;let n;e&&(t.removeAttribute("style"),n=jb(t,0,"rect",Tx),Gx(n,{width:this._width,height:this._height,fill:e}));const i=Ox(t);return e&&(t.removeChild(n),this._svg.style.setProperty("background-color",e)),i},_render(t){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,t),Ib(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))},isDirty(t){return this._dirtyAll||!t._svg||t.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const t=this._dirty;if(!t.length||!this._dirtyID)return!0;const e=++this._dirtyID;let n,i,r,s,o,a,u;for(o=0,a=t.length;o<a;++o)n=t[o],i=n.mark,i.marktype!==r&&(r=i.marktype,s=Cb[r]),i.zdirty&&i.dirty!==e&&(this._dirtyAll=!1,Ix(n,e),i.items.forEach((t=>{t.dirty=e}))),i.zdirty||(n.exit?(s.nested&&i.items.length?(u=i.items[0],u._svg&&this._update(s,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null):(n=s.nested?i.items[0]:n,n._update!==e&&(n._svg&&n._svg.ownerSVGElement?this._update(s,n._svg,n):(this._dirtyAll=!1,Ix(n,e)),n._update=e)));return!this._dirtyAll},mark(t,e,n){if(!this.isDirty(e))return e._svg;const i=this._svg,r=Cb[e.marktype],s=!1===e.interactive?"none":null,o="g"===r.tag;let a=null,u=0;const l=Px(e,t,n,"g",i);l.setAttribute("class",Rb(e));const c=Cx(e);for(const t in c)Xx(l,t,c[t]);o||Xx(l,"pointer-events",s),Xx(l,"clip-path",e.clip?Sy(this,e,e.group):null);const h=t=>{const e=this.isDirty(t),n=Px(t,l,a,r.tag,i);e&&(this._update(r,n,t),o&&function(t,e,n){e=e.lastChild.previousSibling;let i,r=0;wv(n,(n=>{i=t.mark(e,n,i),++r})),Ib(e,1+r)}(this,n,t)),a=n,++u};return r.nested?e.items.length&&h(e.items[0]):wv(e,h),Ib(l,u),l},_update(t,e,n){Ux=e,qx=e.__values__,kx(Hx,n),t.attr(Hx,n,this);const i=Wx[t.type];i&&i.call(this,t,e,n),Ux&&this.style(Ux,n)},style(t,e){if(null!=e)for(const n in Mx){let i="font"===n?vb(e):e[n];if(i===qx[n])continue;const r=Mx[n];null==i?t.removeAttribute(r):($m(i)&&(i=Tm(i,this._defs.gradient,Yx())),t.setAttribute(r,i+"")),qx[n]=i}},defs(){const t=this._svg,e=this._defs;let n=e.el,i=0;for(const r in e.gradient)n||(e.el=n=jb(t,1,"defs",Tx)),i=Rx(n,e.gradient[r],i);for(const r in e.clipping)n||(e.el=n=jb(t,1,"defs",Tx)),i=Lx(n,e.clipping[r],i);n&&(0===i?(t.removeChild(n),e.el=null):Ib(n,i))},_clearDefs(){const t=this._defs;t.gradient={},t.clipping={}}});let Ux=null,qx=null;const Wx={group(t,e,n){const i=Ux=e.childNodes[2];qx=i.__values__,t.foreground(Hx,n,this),qx=e.__values__,Ux=e.childNodes[1],t.content(Hx,n,this);const r=Ux=e.childNodes[0];t.background(Hx,n,this);const s=!1===n.mark.interactive?"none":null;if(s!==qx.events&&(Xx(i,"pointer-events",s),Xx(r,"pointer-events",s),qx.events=s),n.strokeForeground&&n.stroke){const t=n.fill;Xx(i,"display",null),this.style(r,n),Xx(r,"stroke",null),t&&(n.fill=null),qx=i.__values__,this.style(i,n),t&&(n.fill=t),Ux=null}else Xx(i,"display","none")},image(t,e,n){!1===n.smooth?(Vx(e,"image-rendering","optimizeSpeed"),Vx(e,"image-rendering","pixelated")):Vx(e,"image-rendering",null)},text(t,e,n){const i=gb(n);let r,s,o,a;Ze(i)?(s=i.map((t=>yb(n,t))),r=s.join("\n"),r!==qx.text&&(Ib(e,0),o=e.ownerDocument,a=pb(n),s.forEach(((t,i)=>{const r=Tb(o,"tspan",Tx);r.__data__=n,r.textContent=t,i&&(r.setAttribute("x",0),r.setAttribute("dy",a)),e.appendChild(r)})),qx.text=r)):(s=yb(n,i),s!==qx.text&&(e.textContent=s,qx.text=s)),Xx(e,"font-family",vb(n)),Xx(e,"font-size",db(n)+"px"),Xx(e,"font-style",n.fontStyle),Xx(e,"font-variant",n.fontVariant),Xx(e,"font-weight",n.fontWeight)}};function Hx(t,e,n){e!==qx[t]&&(n?function(t,e,n,i){null!=n?t.setAttributeNS(i,e,n):t.removeAttributeNS(i,e)}(Ux,t,e,n):Xx(Ux,t,e),qx[t]=e)}function Vx(t,e,n){n!==qx[e]&&(null==n?t.style.removeProperty(e):t.style.setProperty(e,n+""),qx[e]=n)}function Gx(t,e){for(const n in e)Xx(t,n,e[n])}function Xx(t,e,n){null!=n?t.setAttribute(e,n):t.removeAttribute(e)}function Yx(){let t;return"undefined"==typeof window?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}function Jx(t){qb.call(this,t),this._text=null,this._defs={gradient:{},clipping:{}}}Nn(Jx,qb,{svg(){return this._text},_render(t){const e=Sx();e.open("svg",Cn({},Wv,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&e.open("rect",{width:this._width,height:this._height,fill:n}).close(),e.open("g",zx,{transform:"translate("+this._origin+")"}),this.mark(e,t),e.close(),this.defs(e),this._text=e.close()+"",this},mark(t,e){const n=Cb[e.marktype],i=n.tag,r=[kx,n.attr];t.open("g",{class:Rb(e),"clip-path":e.clip?Sy(this,e,e.group):null},Cx(e),{"pointer-events":"g"!==i&&!1===e.interactive?"none":null});const s=s=>{const o=this.href(s);if(o&&t.open("a",o),t.open(i,this.attr(e,s,r,"g"!==i?i:null)),"text"===i){const e=gb(s);if(Ze(e)){const n={x:0,dy:pb(s)};for(let i=0;i<e.length;++i)t.open("tspan",i?n:null).text(yb(s,e[i])).close()}else t.text(yb(s,e))}else if("g"===i){const i=s.strokeForeground,r=s.fill,o=s.stroke;i&&o&&(s.stroke=null),t.open("path",this.attr(e,s,n.background,"bgrect")).close(),t.open("g",this.attr(e,s,n.content)),wv(s,(e=>this.mark(t,e))),t.close(),i&&o?(r&&(s.fill=null),s.stroke=o,t.open("path",this.attr(e,s,n.foreground,"bgrect")).close(),r&&(s.fill=r)):t.open("path",this.attr(e,s,n.foreground,"bgfore")).close()}t.close(),o&&t.close()};return n.nested?e.items&&e.items.length&&s(e.items[0]):wv(e,s),t.close()},href(t){const e=t.href;let n;if(e){if(n=this._hrefs&&this._hrefs[e])return n;this.sanitizeURL(e).then((t=>{t["xlink:href"]=t.href,t.href=null,(this._hrefs||(this._hrefs={}))[e]=t}))}return null},attr(t,e,n,i){const r={},s=(t,e,n,i)=>{r[i||t]=e};return Array.isArray(n)?n.forEach((t=>t(s,e,this))):n(s,e,this),i&&function(t,e,n,i,r){if(null==e)return t;if("bgrect"===i&&!1===n.interactive&&(t["pointer-events"]="none"),"bgfore"===i&&(!1===n.interactive&&(t["pointer-events"]="none"),t.display="none",null!==e.fill))return t;"image"===i&&!1===e.smooth&&(t.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),"text"===i&&(t["font-family"]=vb(e),t["font-size"]=db(e)+"px",t["font-style"]=e.fontStyle,t["font-variant"]=e.fontVariant,t["font-weight"]=e.fontWeight);for(const n in Mx){let i=e[n];const s=Mx[n];("transparent"!==i||"fill"!==s&&"stroke"!==s)&&null!=i&&($m(i)&&(i=Tm(i,r.gradient,"")),t[s]=i)}}(r,e,t,i,this._defs),r},defs(t){const e=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(e).length+Object.keys(n).length){t.open("defs");for(const n in e){const i=e[n],r=i.stops;"radial"===i.gradient?(t.open("pattern",{id:zm+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),t.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),t.close(),t.open("radialGradient",{id:n,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})):t.open("linearGradient",{id:n,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(let e=0;e<r.length;++e)t.open("stop",{offset:r[e].offset,"stop-color":r[e].color}).close();t.close()}for(const e in n){const i=n[e];t.open("clipPath",{id:e}),i.path?t.open("path",{d:i.path}).close():t.open("rect",{x:0,y:0,width:i.width,height:i.height}).close(),t.close()}t.close()}}});const Zx={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},Kx={};function Qx(t,e){return t=String(t||"").toLowerCase(),arguments.length>1?(Kx[t]=e,this):Kx[t]}function tw(t,e,n){const i=[],r=(new Oy).union(e),s=t.marktype;return s?ew(t,r,n,i):"group"===s?nw(t,r,n,i):Le("Intersect scene must be mark node or group item.")}function ew(t,e,n,i){if(function(t,e,n){return t.bounds&&e.intersects(t.bounds)&&("group"===t.marktype||!1!==t.interactive&&(!n||n(t)))}(t,e,n)){const r=t.items,s=t.marktype,o=r.length;let a=0;if("group"===s)for(;a<o;++a)nw(r[a],e,n,i);else for(const t=Cb[s].isect;a<o;++a){const n=r[a];iw(n,e,t)&&i.push(n)}}return i}function nw(t,e,n,i){n&&n(t.mark)&&iw(t,e,Cb.group.isect)&&i.push(t);const r=t.items,s=r&&r.length;if(s){const o=t.x||0,a=t.y||0;e.translate(-o,-a);for(let t=0;t<s;++t)ew(r[t],e,n,i);e.translate(o,a)}return i}function iw(t,e,n){const i=t.bounds;return e.encloses(i)||e.intersects(i)&&n(t,e)}Kx.canvas=Kx.png={renderer:cx,headless:cx,handler:sx},Kx.svg={renderer:Bx,headless:Jx,handler:fx},Kx.none={};const rw=new Oy;function sw(t){const e=t.clip;if(yn(e))e(tv(rw.clear()));else{if(!e)return;rw.set(0,0,t.group.width,t.group.height)}t.bounds.intersect(rw)}function ow(t,e,n){return t===e||("path"===n?aw(t,e):t instanceof Date&&e instanceof Date?+t==+e:$n(t)&&$n(e)?Math.abs(t-e)<=1e-9:t&&e&&(Ke(t)||Ke(e))?function(t,e){var n,i,r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(r.sort(),s.sort(),i=r.length-1;i>=0;i--)if(r[i]!=s[i])return!1;for(i=r.length-1;i>=0;i--)if(!ow(t[n=r[i]],e[n],n))return!1;return typeof t==typeof e}(t,e):t==e)}function aw(t,e){return ow(Um(t),Um(e))}function uw(){Fy(),Mm=0}const lw="top",cw="left",hw="right",fw="bottom",dw="start",pw="middle",gw="end",mw="group",yw="axis",vw="title",bw="legend",xw="row-header",ww="row-footer",Aw="row-title",_w="column-header",kw="column-footer",Cw="column-title",Ew="none",Dw="all",Fw="each",Sw="flush",Ow="column",Nw="row";function Mw(t){Ou.call(this,null,t)}function zw(t,e,n){return e(t.bounds.clear(),t,n)}Nn(Mw,Ou,{transform(t,e){const n=e.dataflow,i=t.mark,r=i.marktype,s=Cb[r],o=s.bound;let a,u=i.bounds;if(s.nested)i.items.length&&n.dirty(i.items[0]),u=zw(i,o),i.items.forEach((t=>{t.bounds.clear().union(u)}));else if(r===mw||t.modified())switch(e.visit(e.MOD,(t=>n.dirty(t))),u.clear(),i.items.forEach((t=>u.union(zw(t,o)))),i.role){case yw:case bw:case vw:e.reflow()}else a=e.changed(e.REM),e.visit(e.ADD,(t=>{u.union(zw(t,o))})),e.visit(e.MOD,(t=>{a=a||u.alignsWith(t.bounds),n.dirty(t),u.union(zw(t,o))})),a&&(u.clear(),i.items.forEach((t=>u.union(t.bounds))));return sw(i),e.modifies("bounds")}});const $w=":vega_identifier:";function Tw(t){Ou.call(this,0,t)}function Bw(t){Ou.call(this,null,t)}function jw(t){Ou.call(this,null,t)}Tw.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},Nn(Tw,Ou,{transform(t,e){const n=(r=e.dataflow)._signals[$w]||(r._signals[$w]=r.add(0)),i=t.as;var r;let s=n.value;return e.visit(e.ADD,(t=>t[i]=t[i]||++s)),n.set(this.value=s),e}}),Nn(Bw,Ou,{transform(t,e){let n=this.value;n||(n=e.dataflow.scenegraph().mark(t.markdef,function(t){const e=t.groups,n=t.parent;return e&&1===e.size?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}(t),t.index),n.group.context=t.context,t.context.group||(t.context.group=n.group),n.source=this.source,n.clip=t.clip,n.interactive=t.interactive,this.value=n);const i=n.marktype===mw?My:Ny;return e.visit(e.ADD,(t=>i.call(t,n))),(t.modified("clip")||t.modified("interactive"))&&(n.clip=t.clip,n.interactive=!!t.interactive,n.zdirty=!0,e.reflow()),n.items=e.source,e}});const Iw={parity:t=>t.filter(((t,e)=>e%2?t.opacity=0:1)),greedy:(t,e)=>{let n;return t.filter(((t,i)=>i&&Rw(n.bounds,t.bounds,e)?t.opacity=0:(n=t,1)))}},Rw=(t,e,n)=>n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2),Lw=(t,e)=>{for(var n,i=1,r=t.length,s=t[0].bounds;i<r;s=n,++i)if(Rw(s,n=t[i].bounds,e))return!0},Pw=t=>{const e=t.bounds;return e.width()>1&&e.height()>1},Uw=t=>(t.forEach((t=>t.opacity=1)),t),qw=(t,e)=>t.reflow(e.modified()).modifies("opacity");function Ww(t){Ou.call(this,null,t)}Nn(jw,Ou,{transform(t,e){const n=Iw[t.method]||Iw.parity,i=t.separation||0;let r,s,o=e.materialize(e.SOURCE).source;if(!o||!o.length)return;if(!t.method)return t.modified("method")&&(Uw(o),e=qw(e,t)),e;if(o=o.filter(Pw),!o.length)return;if(t.sort&&(o=o.slice().sort(t.sort)),r=Uw(o),e=qw(e,t),r.length>=3&&Lw(r,i)){do{r=n(r,i)}while(r.length>=3&&Lw(r,i));r.length<3&&!nn(o).opacity&&(r.length>1&&(nn(r).opacity=0),nn(o).opacity=1)}t.boundScale&&t.boundTolerance>=0&&(s=((t,e,n)=>{var i=t.range(),r=new Oy;return e===lw||e===fw?r.set(i[0],-1/0,i[1],1/0):r.set(-1/0,i[0],1/0,i[1]),r.expand(n||1),t=>r.encloses(t.bounds)})(t.boundScale,t.boundOrient,+t.boundTolerance),o.forEach((t=>{s(t)||(t.opacity=0)})));const a=r[0].mark.bounds.clear();return o.forEach((t=>{t.opacity&&a.union(t.bounds)})),e}}),Nn(Ww,Ou,{transform(t,e){const n=e.dataflow;if(e.visit(e.ALL,(t=>n.dirty(t))),e.fields&&e.fields.zindex){const t=e.source&&e.source[0];t&&(t.mark.zdirty=!0)}}});const Hw=new Oy;function Vw(t,e,n){return t[e]===n?0:(t[e]=n,1)}function Gw(t){var e=t.items[0].orient;return e===cw||e===hw}function Xw(t,e,n,i){var r,s,o=e.items[0],a=o.datum,u=null!=o.translate?o.translate:.5,l=o.orient,c=function(t){let e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}(a),h=o.range,f=o.offset,d=o.position,p=o.minExtent,g=o.maxExtent,m=a.title&&o.items[c[2]].items[0],y=o.titlePadding,v=o.bounds,b=m&&mb(m),x=0,w=0;switch(Hw.clear().union(v),v.clear(),(r=c[0])>-1&&v.union(o.items[r].bounds),(r=c[1])>-1&&v.union(o.items[r].bounds),l){case lw:x=d||0,w=-f,s=Math.max(p,Math.min(g,-v.y1)),v.add(0,-s).add(h,0),m&&Yw(t,m,s,y,b,0,-1,v);break;case cw:x=-f,w=d||0,s=Math.max(p,Math.min(g,-v.x1)),v.add(-s,0).add(0,h),m&&Yw(t,m,s,y,b,1,-1,v);break;case hw:x=n+f,w=d||0,s=Math.max(p,Math.min(g,v.x2)),v.add(0,0).add(s,h),m&&Yw(t,m,s,y,b,1,1,v);break;case fw:x=d||0,w=i+f,s=Math.max(p,Math.min(g,v.y2)),v.add(0,0).add(h,s),m&&Yw(t,m,s,y,0,0,1,v);break;default:x=o.x,w=o.y}return By(v.translate(x,w),o),Vw(o,"x",x+u)|Vw(o,"y",w+u)&&(o.bounds=Hw,t.dirty(o),o.bounds=v,t.dirty(o)),o.mark.bounds.clear().union(v)}function Yw(t,e,n,i,r,s,o,a){const u=e.bounds;if(e.auto){const a=o*(n+r+i);let l=0,c=0;t.dirty(e),s?l=(e.x||0)-(e.x=a):c=(e.y||0)-(e.y=a),e.mark.bounds.clear().union(u.translate(-l,-c)),t.dirty(e)}a.union(u)}const Jw=(t,e)=>Math.floor(Math.min(t,e)),Zw=(t,e)=>Math.ceil(Math.max(t,e));function Kw(t){return(new Oy).set(0,0,t.width||0,t.height||0)}function Qw(t){const e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function tA(t,e,n){const i=Ke(t)?t[e]:t;return null!=i?i:void 0!==n?n:0}function eA(t){return t<0?Math.ceil(-t):0}function nA(t,e,n){var i,r,s,o,a,u,l,c,h,f,d,p=!n.nodirty,g=n.bounds===Sw?Kw:Qw,m=Hw.set(0,0,0,0),y=tA(n.align,Ow),v=tA(n.align,Nw),b=tA(n.padding,Ow),x=tA(n.padding,Nw),w=n.columns||e.length,A=w<=0?1:Math.ceil(e.length/w),_=e.length,k=Array(_),C=Array(w),E=0,D=Array(_),F=Array(A),S=0,O=Array(_),N=Array(_),M=Array(_);for(r=0;r<w;++r)C[r]=0;for(r=0;r<A;++r)F[r]=0;for(r=0;r<_;++r)u=e[r],a=M[r]=g(u),u.x=u.x||0,O[r]=0,u.y=u.y||0,N[r]=0,s=r%w,o=~~(r/w),E=Math.max(E,l=Math.ceil(a.x2)),S=Math.max(S,c=Math.ceil(a.y2)),C[s]=Math.max(C[s],l),F[o]=Math.max(F[o],c),k[r]=b+eA(a.x1),D[r]=x+eA(a.y1),p&&t.dirty(e[r]);for(r=0;r<_;++r)r%w==0&&(k[r]=0),r<w&&(D[r]=0);if(y===Fw)for(s=1;s<w;++s){for(d=0,r=s;r<_;r+=w)d<k[r]&&(d=k[r]);for(r=s;r<_;r+=w)k[r]=d+C[s-1]}else if(y===Dw){for(d=0,r=0;r<_;++r)r%w&&d<k[r]&&(d=k[r]);for(r=0;r<_;++r)r%w&&(k[r]=d+E)}else for(y=!1,s=1;s<w;++s)for(r=s;r<_;r+=w)k[r]+=C[s-1];if(v===Fw)for(o=1;o<A;++o){for(d=0,i=(r=o*w)+w;r<i;++r)d<D[r]&&(d=D[r]);for(r=o*w;r<i;++r)D[r]=d+F[o-1]}else if(v===Dw){for(d=0,r=w;r<_;++r)d<D[r]&&(d=D[r]);for(r=w;r<_;++r)D[r]=d+S}else for(v=!1,o=1;o<A;++o)for(i=(r=o*w)+w;r<i;++r)D[r]+=F[o-1];for(h=0,r=0;r<_;++r)h=k[r]+(r%w?h:0),O[r]+=h-e[r].x;for(s=0;s<w;++s)for(f=0,r=s;r<_;r+=w)f+=D[r],N[r]+=f-e[r].y;if(y&&tA(n.center,Ow)&&A>1)for(r=0;r<_;++r)(h=(a=y===Dw?E:C[r%w])-M[r].x2-e[r].x-O[r])>0&&(O[r]+=h/2);if(v&&tA(n.center,Nw)&&1!==w)for(r=0;r<_;++r)(f=(a=v===Dw?S:F[~~(r/w)])-M[r].y2-e[r].y-N[r])>0&&(N[r]+=f/2);for(r=0;r<_;++r)m.union(M[r].translate(O[r],N[r]));switch(h=tA(n.anchor,"x"),f=tA(n.anchor,"y"),tA(n.anchor,Ow)){case gw:h-=m.width();break;case pw:h-=m.width()/2}switch(tA(n.anchor,Nw)){case gw:f-=m.height();break;case pw:f-=m.height()/2}for(h=Math.round(h),f=Math.round(f),m.clear(),r=0;r<_;++r)e[r].mark.bounds.clear();for(r=0;r<_;++r)(u=e[r]).x+=O[r]+=h,u.y+=N[r]+=f,m.union(u.mark.bounds.union(u.bounds.translate(O[r],N[r]))),p&&t.dirty(u);return m}function iA(t,e){return"x1"===e?t.x||0:"y1"===e?t.y||0:"x2"===e?(t.x||0)+(t.width||0):"y2"===e?(t.y||0)+(t.height||0):void 0}function rA(t,e){return t.bounds[e]}function sA(t,e,n,i,r,s,o,a,u,l,c,h,f,d){var p,g,m,y,v,b,x,w,A,_=n.length,k=0,C=0;if(!_)return k;for(p=c;p<_;p+=h)n[p]&&(k=o(k,u(n[p],l)));if(!e.length)return k;for(e.length>r&&(t.warn("Grid headers exceed limit: "+r),e=e.slice(0,r)),k+=s,g=0,y=e.length;g<y;++g)t.dirty(e[g]),e[g].mark.bounds.clear();for(p=c,g=0,y=e.length;g<y;++g,p+=h){for(v=(b=e[g]).mark.bounds,m=p;m>=0&&null==(x=n[m]);m-=f);a?(w=null==d?x.x:Math.round(x.bounds.x1+d*x.bounds.width()),A=k):(w=k,A=null==d?x.y:Math.round(x.bounds.y1+d*x.bounds.height())),v.union(b.bounds.translate(w-(b.x||0),A-(b.y||0))),b.x=w,b.y=A,t.dirty(b),C=o(C,v[l])}return C}function oA(t,e,n,i,r,s){if(e){t.dirty(e);var o=n,a=n;i?o=Math.round(r.x1+s*r.width()):a=Math.round(r.y1+s*r.height()),e.bounds.translate(o-(e.x||0),a-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=o,e.y=a,t.dirty(e)}}function aA(t,e,n,i,r,s,o){const a=function(t,e){const n=t[e]||{};return(e,i)=>null!=n[e]?n[e]:null!=t[e]?t[e]:i}(n,e),u=function(t,e){let n=-1/0;return t.forEach((t=>{null!=t.offset&&(n=Math.max(n,t.offset))})),n>-1/0?n:e}(t,a("offset",0)),l=a("anchor",dw),c=l===gw?1:l===pw?.5:0,h={align:Fw,bounds:a("bounds",Sw),columns:"vertical"===a("direction")?1:t.length,padding:a("margin",8),center:a("center"),nodirty:!0};switch(e){case cw:h.anchor={x:Math.floor(i.x1)-u,column:gw,y:c*(o||i.height()+2*i.y1),row:l};break;case hw:h.anchor={x:Math.ceil(i.x2)+u,y:c*(o||i.height()+2*i.y1),row:l};break;case lw:h.anchor={y:Math.floor(r.y1)-u,row:gw,x:c*(s||r.width()+2*r.x1),column:l};break;case fw:h.anchor={y:Math.ceil(r.y2)+u,x:c*(s||r.width()+2*r.x1),column:l};break;case"top-left":h.anchor={x:u,y:u};break;case"top-right":h.anchor={x:s-u,y:u,column:gw};break;case"bottom-left":h.anchor={x:u,y:o-u,row:gw};break;case"bottom-right":h.anchor={x:s-u,y:o-u,column:gw,row:gw}}return h}function uA(t,e){var n,i,r=e.items[0],s=r.datum,o=r.orient,a=r.bounds,u=r.x,l=r.y;return r._bounds?r._bounds.clear().union(a):r._bounds=a.clone(),a.clear(),function(t,e,n){var i=e.padding,r=i-n.x,s=i-n.y;if(e.datum.title){var o=e.items[1].items[0],a=o.anchor,u=e.titlePadding||0,l=i-o.x,c=i-o.y;switch(o.orient){case cw:r+=Math.ceil(o.bounds.width())+u;break;case hw:case fw:break;default:s+=o.bounds.height()+u}switch((r||s)&&cA(t,n,r,s),o.orient){case cw:c+=lA(e,n,o,a,1,1);break;case hw:l+=lA(e,n,o,gw,0,0)+u,c+=lA(e,n,o,a,1,1);break;case fw:l+=lA(e,n,o,a,0,0),c+=lA(e,n,o,gw,-1,0,1)+u;break;default:l+=lA(e,n,o,a,0,0)}(l||c)&&cA(t,o,l,c),(l=Math.round(o.bounds.x1-i))<0&&(cA(t,n,-l,0),cA(t,o,-l,0))}else(r||s)&&cA(t,n,r,s)}(t,r,r.items[0].items[0]),a=function(t,e){return t.items.forEach((t=>e.union(t.bounds))),e.x1=t.padding,e.y1=t.padding,e}(r,a),n=2*r.padding,i=2*r.padding,a.empty()||(n=Math.ceil(a.width()+n),i=Math.ceil(a.height()+i)),"symbol"===s.type&&function(t){const e=t.reduce(((t,e)=>(t[e.column]=Math.max(e.bounds.x2-e.x,t[e.column]||0),t)),{});t.forEach((t=>{t.width=e[t.column],t.height=t.bounds.y2-t.y}))}(r.items[0].items[0].items[0].items),o!==Ew&&(r.x=u=0,r.y=l=0),r.width=n,r.height=i,By(a.set(u,l,u+n,l+i),r),r.mark.bounds.clear().union(a),r}function lA(t,e,n,i,r,s,o){const a="symbol"!==t.datum.type,u=n.datum.vgrad,l=(!a||!s&&u||o?e:e.items[0]).bounds[r?"y2":"x2"]-t.padding,c=u&&s?l:0,h=u&&s?0:l,f=r<=0?0:mb(n);return Math.round(i===dw?c:i===gw?h-f:.5*(l-f))}function cA(t,e,n,i){e.x+=n,e.y+=i,e.bounds.translate(n,i),e.mark.bounds.translate(n,i),t.dirty(e)}function hA(t){Ou.call(this,null,t)}function fA(t,e){let n=0;if(void 0===e)for(let e of t)(e=+e)&&(n+=e);else{let i=-1;for(let r of t)(r=+e(r,++i,t))&&(n+=r)}return n}function dA(t){Ou.call(this,null,t)}function pA(t){Ou.call(this,null,t)}function gA(){return tu({})}function mA(t){Ou.call(this,null,t)}function yA(t){Ou.call(this,[],t)}Nn(hA,Ou,{transform(t,e){const n=e.dataflow;return t.mark.items.forEach((e=>{t.layout&&function(t,e,n){var i,r,s,o,a,u,l,c=function(t){var e,n,i=t.items,r=i.length,s=0;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;s<r;++s)if(n=(e=i[s]).items,e.marktype===mw)switch(e.role){case yw:case bw:case vw:break;case xw:o.rowheaders.push(...n);break;case ww:o.rowfooters.push(...n);break;case _w:o.colheaders.push(...n);break;case kw:o.colfooters.push(...n);break;case Aw:o.rowtitle=n[0];break;case Cw:o.coltitle=n[0];break;default:o.marks.push(...n)}return o}(e),h=c.marks,f=n.bounds===Sw?iA:rA,d=n.offset,p=n.columns||h.length,g=p<=0?1:Math.ceil(h.length/p),m=g*p;const y=nA(t,h,n);y.empty()&&y.set(0,0,0,0),c.rowheaders&&(u=tA(n.headerBand,Nw,null),i=sA(t,c.rowheaders,h,0,g,-tA(d,"rowHeader"),Jw,0,f,"x1",0,p,1,u)),c.colheaders&&(u=tA(n.headerBand,Ow,null),r=sA(t,c.colheaders,h,0,p,-tA(d,"columnHeader"),Jw,1,f,"y1",0,1,p,u)),c.rowfooters&&(u=tA(n.footerBand,Nw,null),s=sA(t,c.rowfooters,h,0,g,tA(d,"rowFooter"),Zw,0,f,"x2",p-1,p,1,u)),c.colfooters&&(u=tA(n.footerBand,Ow,null),o=sA(t,c.colfooters,h,0,p,tA(d,"columnFooter"),Zw,1,f,"y2",m-p,1,p,u)),c.rowtitle&&(a=tA(n.titleAnchor,Nw),l=tA(d,"rowTitle"),l=a===gw?s+l:i-l,u=tA(n.titleBand,Nw,.5),oA(t,c.rowtitle,l,0,y,u)),c.coltitle&&(a=tA(n.titleAnchor,Ow),l=tA(d,"columnTitle"),l=a===gw?o+l:r-l,u=tA(n.titleBand,Ow,.5),oA(t,c.coltitle,l,1,y,u))}(n,e,t.layout),function(t,e,n){var i,r,s,o,a,u=e.items,l=Math.max(0,e.width||0),c=Math.max(0,e.height||0),h=(new Oy).set(0,0,l,c),f=h.clone(),d=h.clone(),p=[];for(o=0,a=u.length;o<a;++o)switch((r=u[o]).role){case yw:(Gw(r)?f:d).union(Xw(t,r,l,c));break;case vw:i=r;break;case bw:p.push(uA(t,r));break;case"frame":case"scope":case xw:case ww:case Aw:case _w:case kw:case Cw:f.union(r.bounds),d.union(r.bounds);break;default:h.union(r.bounds)}if(p.length){const e={};p.forEach((t=>{(s=t.orient||hw)!==Ew&&(e[s]||(e[s]=[])).push(t)}));for(const i in e){const r=e[i];nA(t,r,aA(r,i,n.legends,f,d,l,c))}p.forEach((e=>{const i=e.bounds;if(i.equals(e._bounds)||(e.bounds=e._bounds,t.dirty(e),e.bounds=i,t.dirty(e)),n.autosize&&"fit"===n.autosize.type)switch(e.orient){case cw:case hw:h.add(i.x1,0).add(i.x2,0);break;case lw:case fw:h.add(0,i.y1).add(0,i.y2)}else h.union(i)}))}h.union(f).union(d),i&&h.union(function(t,e,n,i,r){var s,o=e.items[0],a=o.frame,u=o.orient,l=o.anchor,c=o.offset,h=o.padding,f=o.items[0].items[0],d=o.items[1]&&o.items[1].items[0],p=u===cw||u===hw?i:n,g=0,m=0,y=0,v=0,b=0;if(a!==mw?u===cw?(g=r.y2,p=r.y1):u===hw?(g=r.y1,p=r.y2):(g=r.x1,p=r.x2):u===cw&&(g=i,p=0),s=l===dw?g:l===gw?p:(g+p)/2,d&&d.text){switch(u){case lw:case fw:b=f.bounds.height()+h;break;case cw:v=f.bounds.width()+h;break;case hw:v=-f.bounds.width()-h}Hw.clear().union(d.bounds),Hw.translate(v-(d.x||0),b-(d.y||0)),Vw(d,"x",v)|Vw(d,"y",b)&&(t.dirty(d),d.bounds.clear().union(Hw),d.mark.bounds.clear().union(Hw),t.dirty(d)),Hw.clear().union(d.bounds)}else Hw.clear();switch(Hw.union(f.bounds),u){case lw:m=s,y=r.y1-Hw.height()-c;break;case cw:m=r.x1-Hw.width()-c,y=s;break;case hw:m=r.x2+Hw.width()+c,y=s;break;case fw:m=s,y=r.y2+c;break;default:m=o.x,y=o.y}return Vw(o,"x",m)|Vw(o,"y",y)&&(Hw.translate(m,y),t.dirty(o),o.bounds.clear().union(Hw),e.bounds.clear().union(Hw),t.dirty(o)),o.bounds}(t,i,l,c,h)),e.clip&&h.set(0,0,e.width||0,e.height||0),function(t,e,n,i){const r=i.autosize||{},s=r.type;if(t._autosize<1||!s)return;let o=t._width,a=t._height,u=Math.max(0,e.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,e.height||0),h=Math.max(0,Math.ceil(-n.y1));const f=Math.max(0,Math.ceil(n.x2-u)),d=Math.max(0,Math.ceil(n.y2-c));if("padding"===r.contains){const e=t.padding();o-=e.left+e.right,a-=e.top+e.bottom}s===Ew?(l=0,h=0,u=o,c=a):"fit"===s?(u=Math.max(0,o-l-f),c=Math.max(0,a-h-d)):"fit-x"===s?(u=Math.max(0,o-l-f),a=c+h+d):"fit-y"===s?(o=u+l+f,c=Math.max(0,a-h-d)):"pad"===s&&(o=u+l+f,a=c+h+d),t._resizeView(o,a,u,c,[l,h],r.resize)}(t,e,h,n)}(n,e,t)})),function(t){return t&&"legend-entry"!==t.mark.role}(t.mark.group)?e.reflow():e}}),Nn(dA,Ou,{transform(t,e){if(this.value&&!t.modified())return e.StopPropagation;var n=e.dataflow.locale(),i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=this.value,s=t.scale,o=ym(s,null==t.count?t.values?t.values.length:10:t.count,t.minstep),a=t.format||xm(n,s,o,t.formatSpecifier,t.formatType,!!t.values),u=t.values?vm(s,t.values,o):bm(s,o);return r&&(i.rem=r),r=u.map(((t,e)=>tu({index:e/(u.length-1||1),value:t,label:a(t)}))),t.extra&&r.length&&r.push(tu({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i}}),Nn(pA,Ou,{transform(t,e){var n=e.dataflow,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=t.item||gA,s=t.key||Ka,o=this.value;return Ze(i.encode)&&(i.encode=null),o&&(t.modified("key")||e.modified(s))&&Le("DataJoin does not support modified key function or fields."),o||(e=e.addAll(),this.value=o=function(t){const e=On().test((t=>t.exit));return e.lookup=n=>e.get(t(n)),e}(s)),e.visit(e.ADD,(t=>{const e=s(t);let n=o.get(e);n?n.exit?(o.empty--,i.add.push(n)):i.mod.push(n):(n=r(t),o.set(e,n),i.add.push(n)),n.datum=t,n.exit=!1})),e.visit(e.MOD,(t=>{const e=s(t),n=o.get(e);n&&(n.datum=t,i.mod.push(n))})),e.visit(e.REM,(t=>{const e=s(t),n=o.get(e);t!==n.datum||n.exit||(i.rem.push(n),n.exit=!0,++o.empty)})),e.changed(e.ADD_MOD)&&i.modifies("datum"),(e.clean()||t.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),i}}),Nn(mA,Ou,{transform(t,e){var n=e.fork(e.ADD_REM),i=t.mod||!1,r=t.encoders,s=e.encode;if(Ze(s)){if(!n.changed()&&!s.every((t=>r[t])))return e.StopPropagation;s=s[0],n.encode=null}var o="enter"===s,a=r.update||Xe,u=r.enter||Xe,l=r.exit||Xe,c=(s&&!o?r[s]:a)||Xe;if(e.changed(e.ADD)&&(e.visit(e.ADD,(e=>{u(e,t),a(e,t)})),n.modifies(u.output),n.modifies(a.output),c!==Xe&&c!==a&&(e.visit(e.ADD,(e=>{c(e,t)})),n.modifies(c.output))),e.changed(e.REM)&&l!==Xe&&(e.visit(e.REM,(e=>{l(e,t)})),n.modifies(l.output)),o||c!==Xe){const r=e.MOD|(t.modified()?e.REFLOW:0);o?(e.visit(r,(e=>{const r=u(e,t)||i;(c(e,t)||r)&&n.mod.push(e)})),n.mod.length&&n.modifies(u.output)):e.visit(r,(e=>{(c(e,t)||i)&&n.mod.push(e)})),n.mod.length&&n.modifies(c.output)}return n.changed()?n:e.StopPropagation}}),Nn(yA,Ou,{transform(t,e){if(null!=this.value&&!t.modified())return e.StopPropagation;var n,i,r,s,o,a=e.dataflow.locale(),u=e.fork(e.NO_SOURCE|e.NO_FIELDS),l=this.value,c=t.type||dm,h=t.scale,f=+t.limit,d=ym(h,null==t.count?5:t.count,t.minstep),p=!!t.values||c===dm,g=t.format||Cm(a,h,d,c,t.formatSpecifier,t.formatType,p),m=t.values||km(h,d);return l&&(u.rem=l),c===dm?(f&&m.length>f?(e.dataflow.warn("Symbol legend count exceeds limit, filtering items."),l=m.slice(0,f-1),o=!0):l=m,yn(r=t.size)?(t.values||0!==h(l[0])||(l=l.slice(1)),s=l.reduce(((e,n)=>Math.max(e,r(n,t))),0)):r=_n(s=r||8),l=l.map(((e,n)=>tu({index:n,label:g(e,n,l),value:e,offset:s,size:r(e,t)}))),o&&(o=m[l.length],l.push(tu({index:l.length,label:"".concat(m.length-l.length," entries"),value:o,offset:s,size:r(o,t)})))):"gradient"===c?(n=h.domain(),i=am(h,n[0],nn(n)),m.length<3&&!t.values&&n[0]!==nn(n)&&(m=[n[0],nn(n)]),l=m.map(((t,e)=>tu({index:e,label:g(t,e,m),value:t,perc:i(t)})))):(r=m.length-1,i=function(t){const e=t.domain(),n=e.length-1;let i=+e[0],r=+nn(e),s=r-i;if(t.type===Ng){const t=n?s/n:.1;i-=t,r+=t,s=r-i}return t=>(t-i)/s}(h),l=m.map(((t,e)=>tu({index:e,label:g(t,e,m),value:t,perc:e?i(t):0,perc2:e===r?1:i(m[e+1])})))),u.source=l,u.add=l,this.value=l,u}});const vA=t=>t.source.x,bA=t=>t.source.y,xA=t=>t.target.x,wA=t=>t.target.y;function AA(t){Ou.call(this,{},t)}AA.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},Nn(AA,Ou,{transform(t,e){var n=t.sourceX||vA,i=t.sourceY||bA,r=t.targetX||xA,s=t.targetY||wA,o=t.as||"path",a=t.orient||"vertical",u=t.shape||"line",l=EA.get(u+"-"+a)||EA.get(u);return l||Le("LinkPath unsupported type: "+t.shape+(t.orient?"-"+t.orient:"")),e.visit(e.SOURCE,(t=>{t[o]=l(n(t),i(t),r(t),s(t))})),e.reflow(t.modified()).modifies(o)}});const _A=(t,e,n,i)=>"M"+t+","+e+"L"+n+","+i,kA=(t,e,n,i)=>{var r=n-t,s=i-e,o=Math.sqrt(r*r+s*s)/2;return"M"+t+","+e+"A"+o+","+o+" "+180*Math.atan2(s,r)/Math.PI+" 0 1 "+n+","+i},CA=(t,e,n,i)=>{const r=n-t,s=i-e,o=.2*(r+s),a=.2*(s-r);return"M"+t+","+e+"C"+(t+o)+","+(e+a)+" "+(n+a)+","+(i-o)+" "+n+","+i},EA=On({line:_A,"line-radial":(t,e,n,i)=>_A(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n)),arc:kA,"arc-radial":(t,e,n,i)=>kA(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n)),curve:CA,"curve-radial":(t,e,n,i)=>CA(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n)),"orthogonal-horizontal":(t,e,n,i)=>"M"+t+","+e+"V"+i+"H"+n,"orthogonal-vertical":(t,e,n,i)=>"M"+t+","+e+"H"+n+"V"+i,"orthogonal-radial":(t,e,n,i)=>{const r=Math.cos(t),s=Math.sin(t),o=Math.cos(n),a=Math.sin(n);return"M"+e*r+","+e*s+"A"+e+","+e+" 0 0,"+((Math.abs(n-t)>Math.PI?n<=t:n>t)?1:0)+" "+e*o+","+e*a+"L"+i*o+","+i*a},"diagonal-horizontal":(t,e,n,i)=>{const r=(t+n)/2;return"M"+t+","+e+"C"+r+","+e+" "+r+","+i+" "+n+","+i},"diagonal-vertical":(t,e,n,i)=>{const r=(e+i)/2;return"M"+t+","+e+"C"+t+","+r+" "+n+","+r+" "+n+","+i},"diagonal-radial":(t,e,n,i)=>{const r=Math.cos(t),s=Math.sin(t),o=Math.cos(n),a=Math.sin(n),u=(e+i)/2;return"M"+e*r+","+e*s+"C"+u*r+","+u*s+" "+u*o+","+u*a+" "+i*o+","+i*a}});function DA(t){Ou.call(this,null,t)}function FA(t){return Zg(t)&&t!==Dg}DA.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},Nn(DA,Ou,{transform(t,e){var n,i,r,s=t.as||["startAngle","endAngle"],o=s[0],a=s[1],u=t.field||Ve,l=t.startAngle||0,c=null!=t.endAngle?t.endAngle:2*Math.PI,h=e.source,f=h.map(u),d=f.length,p=l,g=(c-l)/fA(f),m=Bl(d);for(t.sort&&m.sort(((t,e)=>f[t]-f[e])),n=0;n<d;++n)r=f[m[n]],(i=h[m[n]])[o]=p,i[a]=p+=r*g;return this.value=f,e.reflow(t.modified()).modifies(s)}});const SA=Wn(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function OA(t){Ou.call(this,null,t),this.modified(!0)}function NA(t,e,n){return tm(t)&&Math.abs(e.reduce(((t,e)=>t+(e<0?-1:e>0?1:0)),0))!==e.length&&n.warn("Log scale domain includes zero: "+Rn(e)),e}function MA(t,e,n){return yn(t)&&(e||n)?rm(t,zA(e||[0,1],n)):t}function zA(t,e){return e?t.slice().reverse():t}function $A(t){Ou.call(this,null,t)}Nn(OA,Ou,{transform(t,e){var n=e.dataflow,i=this.value,r=function(t){var e,n=t.type,i="";return n===Dg?"sequential-linear":(function(t){const e=t.type;return Zg(e)&&e!==Cg&&e!==Eg&&(t.scheme||t.range&&t.range.length&&t.range.every(Tn))}(t)&&(i=2===(e=t.rawDomain?t.rawDomain.length:t.domain?t.domain.length+ +(null!=t.domainMid):0)?"sequential-":3===e?"diverging-":""),(i+n||xg).toLowerCase())}(t);for(r in i&&r===i.type||(this.value=i=Xg(r)()),t)if(!SA[r]){if("padding"===r&&FA(i.type))continue;yn(i[r])?i[r](t[r]):n.warn("Unsupported scale property: "+r)}return function(t,e,n){var i=t.type,r=e.round||!1,s=e.range;if(null!=e.rangeStep)s=function(t,e,n){t!==$g&&t!==zg&&Le("Only band and point scales support rangeStep.");var i=(null!=e.paddingOuter?e.paddingOuter:e.padding)||0,r=t===zg?1:(null!=e.paddingInner?e.paddingInner:e.padding)||0;return[0,e.rangeStep*bg(n,r,i)]}(i,e,n);else if(e.scheme&&(s=function(t,e,n){var i,r=e.schemeExtent;return Ze(e.scheme)?i=sm(e.scheme,e.interpolate,e.interpolateGamma):(i=fm(e.scheme.toLowerCase()))||Le("Unrecognized scheme name: ".concat(e.scheme)),n=t===Ng?n+1:t===Tg?n-1:t===Sg||t===Og?+e.schemeCount||5:n,em(t)?MA(i,r,e.reverse):yn(i)?om(MA(i,r),n):t===Mg?i:i.slice(0,n)}(i,e,n),yn(s))){if(t.interpolator)return t.interpolator(s);Le("Scale type ".concat(i," does not support interpolating color schemes."))}if(s&&em(i))return t.interpolator(sm(zA(s,e.reverse),e.interpolate,e.interpolateGamma));s&&e.interpolate&&t.interpolate?t.interpolate(um(e.interpolate,e.interpolateGamma)):yn(t.round)?t.round(r):yn(t.rangeRound)&&t.interpolate(r?$d:zd),s&&t.range(zA(s,e.reverse))}(i,t,function(t,e,n){let i=e.bins;if(i&&!Ze(i)){const e=t.domain(),n=e[0],r=nn(e),s=i.step;let o=null==i.start?n:i.start,a=null==i.stop?r:i.stop;s||Le("Scale bins parameter missing step property."),o<n&&(o=s*Math.ceil(n/s)),a>r&&(a=s*Math.floor(r/s)),i=Bl(o,a+s/2,s)}return i?t.bins=i:t.bins&&delete t.bins,t.type===Tg&&(i?e.domain||e.domainRaw||(t.domain(i),n=i.length):t.bins=t.domain()),n}(i,t,function(t,e,n){const i=function(t,e,n){return e?(t.domain(NA(t.type,e,n)),e.length):-1}(t,e.domainRaw,n);if(i>-1)return i;var r,s,o=e.domain,a=t.type,u=e.zero||void 0===e.zero&&function(t){const e=t.type;return!t.bins&&(e===xg||e===Ag||e===_g)}(t);if(!o)return 0;if(FA(a)&&e.padding&&o[0]!==nn(o)&&(o=function(t,e,n,i,r,s){var o=Math.abs(nn(n)-n[0]),a=o/(o-2*i),u=t===wg?dn(e,null,a):t===_g?pn(e,null,a,.5):t===Ag?pn(e,null,a,r||1):t===kg?gn(e,null,a,s||1):fn(e,null,a);return(e=e.slice())[0]=u[0],e[e.length-1]=u[1],e}(a,o,e.range,e.padding,e.exponent,e.constant)),(u||null!=e.domainMin||null!=e.domainMax||null!=e.domainMid)&&(r=(o=o.slice()).length-1||1,u&&(o[0]>0&&(o[0]=0),o[r]<0&&(o[r]=0)),null!=e.domainMin&&(o[0]=e.domainMin),null!=e.domainMax&&(o[r]=e.domainMax),null!=e.domainMid)){const t=(s=e.domainMid)>o[r]?r+1:s<o[0]?0:r;t!==r&&n.warn("Scale domainMid exceeds domain min or max.",s),o.splice(t,0,s)}return t.domain(NA(a,o,n)),a===Mg&&t.unknown(e.domainImplicit?Nf:void 0),e.nice&&t.nice&&t.nice(!0!==e.nice&&ym(t,e.nice)||null),o.length}(i,t,n))),e.fork(e.NO_SOURCE|e.NO_FIELDS)}}),Nn($A,Ou,{transform(t,e){const n=t.modified("sort")||e.changed(e.ADD)||e.modified(t.sort.fields)||e.modified("datum");return n&&e.source.sort(ru(t.sort)),this.modified(n),e}});const TA="zero",BA="center",jA="normalize",IA=["y0","y1"];function RA(t){Ou.call(this,null,t)}function LA(t,e,n,i,r){for(var s,o=(e-t.sum)/2,a=t.length,u=0;u<a;++u)(s=t[u])[i]=o,s[r]=o+=Math.abs(n(s))}function PA(t,e,n,i,r){for(var s,o=1/t.sum,a=0,u=t.length,l=0,c=0;l<u;++l)(s=t[l])[i]=a,s[r]=a=o*(c+=Math.abs(n(s)))}function UA(t,e,n,i,r){for(var s,o,a=0,u=0,l=t.length,c=0;c<l;++c)(s=+n(o=t[c]))<0?(o[i]=u,o[r]=u+=s):(o[i]=a,o[r]=a+=s)}RA.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:TA,values:[TA,BA,jA]},{name:"as",type:"string",array:!0,length:2,default:IA}]},Nn(RA,Ou,{transform(t,e){var n,i,r,s,o=t.as||IA,a=o[0],u=o[1],l=ru(t.sort),c=t.field||Ve,h=t.offset===BA?LA:t.offset===jA?PA:UA;for(n=function(t,e,n,i){var r,s,o,a,u,l,c,h,f,d=[],p=t=>t(u);if(null==e)d.push(t.slice());else for(r={},s=0,o=t.length;s<o;++s)u=t[s],(c=r[l=e.map(p)])||(r[l]=c=[],d.push(c)),c.push(u);for(l=0,f=0,a=d.length;l<a;++l){for(s=0,h=0,o=(c=d[l]).length;s<o;++s)h+=Math.abs(i(c[s]));c.sum=h,h>f&&(f=h),n&&c.sort(n)}return d.max=f,d}(e.source,t.groupby,l,c),i=0,r=n.length,s=n.max;i<r;++i)h(n[i],s,c,a,u);return e.reflow(t.modified()).modifies(o)}});const qA=t=>t;function WA(t,e){t&&VA.hasOwnProperty(t.type)&&VA[t.type](t,e)}var HA={Feature:function(t,e){WA(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)WA(n[i].geometry,e)}},VA={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){GA(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)GA(n[i],e,0)},Polygon:function(t,e){XA(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)XA(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)WA(n[i],e)}};function GA(t,e,n){var i,r=-1,s=t.length-n;for(e.lineStart();++r<s;)i=t[r],e.point(i[0],i[1],i[2]);e.lineEnd()}function XA(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)GA(t[n],e,1);e.polygonEnd()}function YA(t,e){t&&HA.hasOwnProperty(t.type)?HA[t.type](t,e):WA(t,e)}class JA{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let i=0;i<this._n&&i<32;i++){const r=e[i],s=t+r,o=Math.abs(t)<Math.abs(r)?t-(s-r):r-(s-t);o&&(e[n++]=o),t=s}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,i,r=this._n,s=0;if(r>0){for(s=t[--r];r>0&&(e=s,n=t[--r],s=e+n,i=n-(s-e),!i););r>0&&(i<0&&t[r-1]<0||i>0&&t[r-1]>0)&&(n=2*i,e=s+n,n==e-s&&(s=e))}return s}}var ZA=1e-6,KA=1e-12,QA=Math.PI,t_=QA/2,e_=QA/4,n_=2*QA,i_=180/QA,r_=QA/180,s_=Math.abs,o_=Math.atan,a_=Math.atan2,u_=Math.cos,l_=Math.ceil,c_=Math.exp,h_=(Math.floor,Math.hypot),f_=Math.log,d_=Math.pow,p_=Math.sin,g_=Math.sign||function(t){return t>0?1:t<0?-1:0},m_=Math.sqrt,y_=Math.tan;function v_(t){return t>1?0:t<-1?QA:Math.acos(t)}function b_(t){return t>1?t_:t<-1?-t_:Math.asin(t)}function x_(){}var w_,A_,__,k_,C_=new JA,E_=new JA,D_={point:x_,lineStart:x_,lineEnd:x_,polygonStart:function(){D_.lineStart=F_,D_.lineEnd=N_},polygonEnd:function(){D_.lineStart=D_.lineEnd=D_.point=x_,C_.add(s_(E_)),E_=new JA},result:function(){var t=C_/2;return C_=new JA,t}};function F_(){D_.point=S_}function S_(t,e){D_.point=O_,w_=__=t,A_=k_=e}function O_(t,e){E_.add(k_*t-__*e),__=t,k_=e}function N_(){O_(w_,A_)}const M_=D_;var z_=1/0,$_=z_,T_=-z_,B_=T_;const j_={point:function(t,e){t<z_&&(z_=t),t>T_&&(T_=t),e<$_&&($_=e),e>B_&&(B_=e)},lineStart:x_,lineEnd:x_,polygonStart:x_,polygonEnd:x_,result:function(){var t=[[z_,$_],[T_,B_]];return T_=B_=-($_=z_=1/0),t}};var I_,R_,L_,P_,U_=0,q_=0,W_=0,H_=0,V_=0,G_=0,X_=0,Y_=0,J_=0,Z_={point:K_,lineStart:Q_,lineEnd:nk,polygonStart:function(){Z_.lineStart=ik,Z_.lineEnd=rk},polygonEnd:function(){Z_.point=K_,Z_.lineStart=Q_,Z_.lineEnd=nk},result:function(){var t=J_?[X_/J_,Y_/J_]:G_?[H_/G_,V_/G_]:W_?[U_/W_,q_/W_]:[NaN,NaN];return U_=q_=W_=H_=V_=G_=X_=Y_=J_=0,t}};function K_(t,e){U_+=t,q_+=e,++W_}function Q_(){Z_.point=tk}function tk(t,e){Z_.point=ek,K_(L_=t,P_=e)}function ek(t,e){var n=t-L_,i=e-P_,r=m_(n*n+i*i);H_+=r*(L_+t)/2,V_+=r*(P_+e)/2,G_+=r,K_(L_=t,P_=e)}function nk(){Z_.point=K_}function ik(){Z_.point=sk}function rk(){ok(I_,R_)}function sk(t,e){Z_.point=ok,K_(I_=L_=t,R_=P_=e)}function ok(t,e){var n=t-L_,i=e-P_,r=m_(n*n+i*i);H_+=r*(L_+t)/2,V_+=r*(P_+e)/2,G_+=r,X_+=(r=P_*t-L_*e)*(L_+t),Y_+=r*(P_+e),J_+=3*r,K_(L_=t,P_=e)}const ak=Z_;function uk(t){this._context=t}uk.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,n_)}},result:x_};var lk,ck,hk,fk,dk,pk=new JA,gk={point:x_,lineStart:function(){gk.point=mk},lineEnd:function(){lk&&yk(ck,hk),gk.point=x_},polygonStart:function(){lk=!0},polygonEnd:function(){lk=null},result:function(){var t=+pk;return pk=new JA,t}};function mk(t,e){gk.point=yk,ck=fk=t,hk=dk=e}function yk(t,e){fk-=t,dk-=e,pk.add(m_(fk*fk+dk*dk)),fk=t,dk=e}const vk=gk;function bk(){this._string=[]}function xk(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function wk(t,e){var n,i,r=4.5;function s(t){return t&&("function"==typeof r&&i.pointRadius(+r.apply(this,arguments)),YA(t,n(i))),i.result()}return s.area=function(t){return YA(t,n(M_)),M_.result()},s.measure=function(t){return YA(t,n(vk)),vk.result()},s.bounds=function(t){return YA(t,n(j_)),j_.result()},s.centroid=function(t){return YA(t,n(ak)),ak.result()},s.projection=function(e){return arguments.length?(n=null==e?(t=null,qA):(t=e).stream,s):t},s.context=function(t){return arguments.length?(i=null==t?(e=null,new bk):new uk(e=t),"function"!=typeof r&&i.pointRadius(r),s):e},s.pointRadius=function(t){return arguments.length?(r="function"==typeof t?t:(i.pointRadius(+t),+t),s):r},s.projection(t).context(e)}function Ak(){var t,e=[];return{point:function(e,n,i){t.push([e,n,i])},lineStart:function(){e.push(t=[])},lineEnd:x_,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function _k(t,e){return s_(t[0]-e[0])<ZA&&s_(t[1]-e[1])<ZA}function kk(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function Ck(t,e,n,i,r){var s,o,a=[],u=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,i=t[0],o=t[e];if(_k(i,o)){if(!i[2]&&!o[2]){for(r.lineStart(),s=0;s<e;++s)r.point((i=t[s])[0],i[1]);return void r.lineEnd()}o[0]+=2e-6}a.push(n=new kk(i,t,null,!0)),u.push(n.o=new kk(i,null,n,!1)),a.push(n=new kk(o,t,null,!1)),u.push(n.o=new kk(o,null,n,!0))}})),a.length){for(u.sort(e),Ek(a),Ek(u),s=0,o=u.length;s<o;++s)u[s].e=n=!n;for(var l,c,h=a[0];;){for(var f=h,d=!0;f.v;)if((f=f.n)===h)return;l=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(s=0,o=l.length;s<o;++s)r.point((c=l[s])[0],c[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(d)for(l=f.p.z,s=l.length-1;s>=0;--s)r.point((c=l[s])[0],c[1]);else i(f.x,f.p.x,-1,r);f=f.p}l=(f=f.o).z,d=!d}while(!f.v);r.lineEnd()}}}function Ek(t){if(e=t.length){for(var e,n,i=0,r=t[0];++i<e;)r.n=n=t[i],n.p=r,r=n;r.n=n=t[0],n.p=r}}function Dk(t){return[a_(t[1],t[0]),b_(t[2])]}function Fk(t){var e=t[0],n=t[1],i=u_(n);return[i*u_(e),i*p_(e),p_(n)]}function Sk(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ok(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Nk(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Mk(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function zk(t){var e=m_(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function $k(t){return s_(t[0])<=QA?t[0]:g_(t[0])*((s_(t[0])+QA)%n_-QA)}function Tk(t){return Array.from(function*(t){for(const e of t)yield*e}(t))}function Bk(t,e,n,i){return function(r){var s,o,a,u=e(r),l=Ak(),c=e(l),h=!1,f={point:d,lineStart:g,lineEnd:m,polygonStart:function(){f.point=y,f.lineStart=v,f.lineEnd=b,o=[],s=[]},polygonEnd:function(){f.point=d,f.lineStart=g,f.lineEnd=m,o=Tk(o);var t=function(t,e){var n=$k(e),i=e[1],r=p_(i),s=[p_(n),-u_(n),0],o=0,a=0,u=new JA;1===r?i=t_+ZA:-1===r&&(i=-t_-ZA);for(var l=0,c=t.length;l<c;++l)if(f=(h=t[l]).length)for(var h,f,d=h[f-1],p=$k(d),g=d[1]/2+e_,m=p_(g),y=u_(g),v=0;v<f;++v,p=x,m=A,y=_,d=b){var b=h[v],x=$k(b),w=b[1]/2+e_,A=p_(w),_=u_(w),k=x-p,C=k>=0?1:-1,E=C*k,D=E>QA,F=m*A;if(u.add(a_(F*C*p_(E),y*_+F*u_(E))),o+=D?k+C*n_:k,D^p>=n^x>=n){var S=Ok(Fk(d),Fk(b));zk(S);var O=Ok(s,S);zk(O);var N=(D^k>=0?-1:1)*b_(O[2]);(i>N||i===N&&(S[0]||S[1]))&&(a+=D^k>=0?1:-1)}}return(o<-1e-6||o<ZA&&u<-1e-12)^1&a}(s,i);o.length?(h||(r.polygonStart(),h=!0),Ck(o,Ik,t,n,r)):t&&(h||(r.polygonStart(),h=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),h&&(r.polygonEnd(),h=!1),o=s=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function d(e,n){t(e,n)&&r.point(e,n)}function p(t,e){u.point(t,e)}function g(){f.point=p,u.lineStart()}function m(){f.point=d,u.lineEnd()}function y(t,e){a.push([t,e]),c.point(t,e)}function v(){c.lineStart(),a=[]}function b(){y(a[0][0],a[0][1]),c.lineEnd();var t,e,n,i,u=c.clean(),f=l.result(),d=f.length;if(a.pop(),s.push(a),a=null,d)if(1&u){if((e=(n=f[0]).length-1)>0){for(h||(r.polygonStart(),h=!0),r.lineStart(),t=0;t<e;++t)r.point((i=n[t])[0],i[1]);r.lineEnd()}}else d>1&&2&u&&f.push(f.pop().concat(f.shift())),o.push(f.filter(jk))}return f}}function jk(t){return t.length>1}function Ik(t,e){return((t=t.x)[0]<0?t[1]-t_-ZA:t_-t[1])-((e=e.x)[0]<0?e[1]-t_-ZA:t_-e[1])}bk.prototype={_radius:4.5,_circle:xk(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=xk(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};const Rk=Bk((function(){return!0}),(function(t){var e,n=NaN,i=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(s,o){var a=s>0?QA:-QA,u=s_(s-n);s_(u-QA)<ZA?(t.point(n,i=(i+o)/2>0?t_:-t_),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(a,i),t.point(s,i),e=0):r!==a&&u>=QA&&(s_(n-r)<ZA&&(n-=r*ZA),s_(s-a)<ZA&&(s-=a*ZA),i=function(t,e,n,i){var r,s,o=p_(t-n);return s_(o)>ZA?o_((p_(e)*(s=u_(i))*p_(n)-p_(i)*(r=u_(e))*p_(t))/(r*s*o)):(e+i)/2}(n,i,s,o),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(a,i),e=0),t.point(n=s,i=o),r=a},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}),(function(t,e,n,i){var r;if(null==t)r=n*t_,i.point(-QA,r),i.point(0,r),i.point(QA,r),i.point(QA,0),i.point(QA,-r),i.point(0,-r),i.point(-QA,-r),i.point(-QA,0),i.point(-QA,r);else if(s_(t[0]-e[0])>ZA){var s=t[0]<e[0]?QA:-QA;r=n*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(e[0],e[1])}),[-QA,-t_]);function Lk(t,e){(e=Fk(e))[0]-=t,zk(e);var n=v_(-e[1]);return((-e[2]<0?-n:n)+n_-ZA)%n_}function Pk(t){var e=u_(t),n=6*r_,i=e>0,r=s_(e)>ZA;function s(t,n){return u_(t)*u_(n)>e}function o(t,n,i){var r=[1,0,0],s=Ok(Fk(t),Fk(n)),o=Sk(s,s),a=s[0],u=o-a*a;if(!u)return!i&&t;var l=e*o/u,c=-e*a/u,h=Ok(r,s),f=Mk(r,l);Nk(f,Mk(s,c));var d=h,p=Sk(f,d),g=Sk(d,d),m=p*p-g*(Sk(f,f)-1);if(!(m<0)){var y=m_(m),v=Mk(d,(-p-y)/g);if(Nk(v,f),v=Dk(v),!i)return v;var b,x=t[0],w=n[0],A=t[1],_=n[1];w<x&&(b=x,x=w,w=b);var k=w-x,C=s_(k-QA)<ZA;if(!C&&_<A&&(b=A,A=_,_=b),C||k<ZA?C?A+_>0^v[1]<(s_(v[0]-x)<ZA?A:_):A<=v[1]&&v[1]<=_:k>QA^(x<=v[0]&&v[0]<=w)){var E=Mk(d,(-p+y)/g);return Nk(E,f),[v,Dk(E)]}}}function a(e,n){var r=i?t:QA-t,s=0;return e<-r?s|=1:e>r&&(s|=2),n<-r?s|=4:n>r&&(s|=8),s}return Bk(s,(function(t){var e,n,u,l,c;return{lineStart:function(){l=u=!1,c=1},point:function(h,f){var d,p=[h,f],g=s(h,f),m=i?g?0:a(h,f):g?a(h+(h<0?QA:-QA),f):0;if(!e&&(l=u=g)&&t.lineStart(),g!==u&&(!(d=o(e,p))||_k(e,d)||_k(p,d))&&(p[2]=1),g!==u)c=0,g?(t.lineStart(),d=o(p,e),t.point(d[0],d[1])):(d=o(e,p),t.point(d[0],d[1],2),t.lineEnd()),e=d;else if(r&&e&&i^g){var y;m&n||!(y=o(p,e,!0))||(c=0,i?(t.lineStart(),t.point(y[0][0],y[0][1]),t.point(y[1][0],y[1][1]),t.lineEnd()):(t.point(y[1][0],y[1][1]),t.lineEnd(),t.lineStart(),t.point(y[0][0],y[0][1],3)))}!g||e&&_k(e,p)||t.point(p[0],p[1]),e=p,u=g,n=m},lineEnd:function(){u&&t.lineEnd(),e=null},clean:function(){return c|(l&&u)<<1}}}),(function(e,i,r,s){!function(t,e,n,i,r,s){if(n){var o=u_(e),a=p_(e),u=i*n;null==r?(r=e+i*n_,s=e-u/2):(r=Lk(o,r),s=Lk(o,s),(i>0?r<s:r>s)&&(r+=i*n_));for(var l,c=r;i>0?c>s:c<s;c-=u)l=Dk([o,-a*u_(c),-a*p_(c)]),t.point(l[0],l[1])}}(s,t,n,r,e,i)}),i?[0,-t]:[-QA,t-QA])}var Uk=1e9,qk=-Uk;function Wk(t,e,n,i){function r(r,s){return t<=r&&r<=n&&e<=s&&s<=i}function s(r,s,a,l){var c=0,h=0;if(null==r||(c=o(r,a))!==(h=o(s,a))||u(r,s)<0^a>0)do{l.point(0===c||3===c?t:n,c>1?i:e)}while((c=(c+a+4)%4)!==h);else l.point(s[0],s[1])}function o(i,r){return s_(i[0]-t)<ZA?r>0?0:3:s_(i[0]-n)<ZA?r>0?2:1:s_(i[1]-e)<ZA?r>0?1:0:r>0?3:2}function a(t,e){return u(t.x,e.x)}function u(t,e){var n=o(t,1),i=o(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(o){var u,l,c,h,f,d,p,g,m,y,v,b=o,x=Ak(),w={point:A,lineStart:function(){w.point=_,l&&l.push(c=[]),y=!0,m=!1,p=g=NaN},lineEnd:function(){u&&(_(h,f),d&&m&&x.rejoin(),u.push(x.result())),w.point=A,m&&b.lineEnd()},polygonStart:function(){b=x,u=[],l=[],v=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,r=l.length;n<r;++n)for(var s,o,a=l[n],u=1,c=a.length,h=a[0],f=h[0],d=h[1];u<c;++u)s=f,o=d,f=(h=a[u])[0],d=h[1],o<=i?d>i&&(f-s)*(i-o)>(d-o)*(t-s)&&++e:d<=i&&(f-s)*(i-o)<(d-o)*(t-s)&&--e;return e}(),n=v&&e,r=(u=Tk(u)).length;(n||r)&&(o.polygonStart(),n&&(o.lineStart(),s(null,null,1,o),o.lineEnd()),r&&Ck(u,a,e,s,o),o.polygonEnd()),b=o,u=l=c=null}};function A(t,e){r(t,e)&&b.point(t,e)}function _(s,o){var a=r(s,o);if(l&&c.push([s,o]),y)h=s,f=o,d=a,y=!1,a&&(b.lineStart(),b.point(s,o));else if(a&&m)b.point(s,o);else{var u=[p=Math.max(qk,Math.min(Uk,p)),g=Math.max(qk,Math.min(Uk,g))],x=[s=Math.max(qk,Math.min(Uk,s)),o=Math.max(qk,Math.min(Uk,o))];!function(t,e,n,i,r,s){var o,a=t[0],u=t[1],l=0,c=1,h=e[0]-a,f=e[1]-u;if(o=n-a,h||!(o>0)){if(o/=h,h<0){if(o<l)return;o<c&&(c=o)}else if(h>0){if(o>c)return;o>l&&(l=o)}if(o=r-a,h||!(o<0)){if(o/=h,h<0){if(o>c)return;o>l&&(l=o)}else if(h>0){if(o<l)return;o<c&&(c=o)}if(o=i-u,f||!(o>0)){if(o/=f,f<0){if(o<l)return;o<c&&(c=o)}else if(f>0){if(o>c)return;o>l&&(l=o)}if(o=s-u,f||!(o<0)){if(o/=f,f<0){if(o>c)return;o>l&&(l=o)}else if(f>0){if(o<l)return;o<c&&(c=o)}return l>0&&(t[0]=a+l*h,t[1]=u+l*f),c<1&&(e[0]=a+c*h,e[1]=u+c*f),!0}}}}}(u,x,t,e,n,i)?a&&(b.lineStart(),b.point(s,o),v=!1):(m||(b.lineStart(),b.point(u[0],u[1])),b.point(x[0],x[1]),a||b.lineEnd(),v=!1)}p=s,g=o,m=a}return w}}function Hk(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return(n=e.invert(n,i))&&t.invert(n[0],n[1])}),n}function Vk(t,e){return[s_(t)>QA?t+Math.round(-t/n_)*n_:t,e]}function Gk(t,e,n){return(t%=n_)?e||n?Hk(Yk(t),Jk(e,n)):Yk(t):e||n?Jk(e,n):Vk}function Xk(t){return function(e,n){return[(e+=t)>QA?e-n_:e<-QA?e+n_:e,n]}}function Yk(t){var e=Xk(t);return e.invert=Xk(-t),e}function Jk(t,e){var n=u_(t),i=p_(t),r=u_(e),s=p_(e);function o(t,e){var o=u_(e),a=u_(t)*o,u=p_(t)*o,l=p_(e),c=l*n+a*i;return[a_(u*r-c*s,a*n-l*i),b_(c*r+u*s)]}return o.invert=function(t,e){var o=u_(e),a=u_(t)*o,u=p_(t)*o,l=p_(e),c=l*r-u*s;return[a_(u*r+l*s,a*n+c*i),b_(c*n-a*i)]},o}function Zk(t){return function(e){var n=new Kk;for(var i in t)n[i]=t[i];return n.stream=e,n}}function Kk(){}function Qk(t,e,n){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=i&&t.clipExtent(null),YA(n,t.stream(j_)),e(j_.result()),null!=i&&t.clipExtent(i),t}function tC(t,e,n){return Qk(t,(function(n){var i=e[1][0]-e[0][0],r=e[1][1]-e[0][1],s=Math.min(i/(n[1][0]-n[0][0]),r/(n[1][1]-n[0][1])),o=+e[0][0]+(i-s*(n[1][0]+n[0][0]))/2,a=+e[0][1]+(r-s*(n[1][1]+n[0][1]))/2;t.scale(150*s).translate([o,a])}),n)}function eC(t,e,n){return tC(t,[[0,0],e],n)}function nC(t,e,n){return Qk(t,(function(n){var i=+e,r=i/(n[1][0]-n[0][0]),s=(i-r*(n[1][0]+n[0][0]))/2,o=-r*n[0][1];t.scale(150*r).translate([s,o])}),n)}function iC(t,e,n){return Qk(t,(function(n){var i=+e,r=i/(n[1][1]-n[0][1]),s=-r*n[0][0],o=(i-r*(n[1][1]+n[0][1]))/2;t.scale(150*r).translate([s,o])}),n)}Vk.invert=Vk,Kk.prototype={constructor:Kk,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var rC=u_(30*r_);function sC(t,e){return+e?function(t,e){function n(i,r,s,o,a,u,l,c,h,f,d,p,g,m){var y=l-i,v=c-r,b=y*y+v*v;if(b>4*e&&g--){var x=o+f,w=a+d,A=u+p,_=m_(x*x+w*w+A*A),k=b_(A/=_),C=s_(s_(A)-1)<ZA||s_(s-h)<ZA?(s+h)/2:a_(w,x),E=t(C,k),D=E[0],F=E[1],S=D-i,O=F-r,N=v*S-y*O;(N*N/b>e||s_((y*S+v*O)/b-.5)>.3||o*f+a*d+u*p<rC)&&(n(i,r,s,o,a,u,D,F,C,x/=_,w/=_,A,g,m),m.point(D,F),n(D,F,C,x,w,A,l,c,h,f,d,p,g,m))}}return function(e){var i,r,s,o,a,u,l,c,h,f,d,p,g={point:m,lineStart:y,lineEnd:b,polygonStart:function(){e.polygonStart(),g.lineStart=x},polygonEnd:function(){e.polygonEnd(),g.lineStart=y}};function m(n,i){n=t(n,i),e.point(n[0],n[1])}function y(){c=NaN,g.point=v,e.lineStart()}function v(i,r){var s=Fk([i,r]),o=t(i,r);n(c,h,l,f,d,p,c=o[0],h=o[1],l=i,f=s[0],d=s[1],p=s[2],16,e),e.point(c,h)}function b(){g.point=m,e.lineEnd()}function x(){y(),g.point=w,g.lineEnd=A}function w(t,e){v(i=t,e),r=c,s=h,o=f,a=d,u=p,g.point=v}function A(){n(c,h,l,f,d,p,r,s,i,o,a,u,16,e),g.lineEnd=b,b()}return g}}(t,e):function(t){return Zk({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)}var oC=Zk({point:function(t,e){this.stream.point(t*r_,e*r_)}});function aC(t,e,n,i,r,s){if(!s)return function(t,e,n,i,r){function s(s,o){return[e+t*(s*=i),n-t*(o*=r)]}return s.invert=function(s,o){return[(s-e)/t*i,(n-o)/t*r]},s}(t,e,n,i,r);var o=u_(s),a=p_(s),u=o*t,l=a*t,c=o/t,h=a/t,f=(a*n-o*e)/t,d=(a*e+o*n)/t;function p(t,s){return[u*(t*=i)-l*(s*=r)+e,n-l*t-u*s]}return p.invert=function(t,e){return[i*(c*t-h*e+f),r*(d-h*t-c*e)]},p}function uC(t){return lC((function(){return t}))()}function lC(t){var e,n,i,r,s,o,a,u,l,c,h=150,f=480,d=250,p=0,g=0,m=0,y=0,v=0,b=0,x=1,w=1,A=null,_=Rk,k=null,C=qA,E=.5;function D(t){return u(t[0]*r_,t[1]*r_)}function F(t){return(t=u.invert(t[0],t[1]))&&[t[0]*i_,t[1]*i_]}function S(){var t=aC(h,0,0,x,w,b).apply(null,e(p,g)),i=aC(h,f-t[0],d-t[1],x,w,b);return n=Gk(m,y,v),a=Hk(e,i),u=Hk(n,a),o=sC(a,E),O()}function O(){return l=c=null,D}return D.stream=function(t){return l&&c===t?l:l=oC(function(t){return Zk({point:function(e,n){var i=t(e,n);return this.stream.point(i[0],i[1])}})}(n)(_(o(C(c=t)))))},D.preclip=function(t){return arguments.length?(_=t,A=void 0,O()):_},D.postclip=function(t){return arguments.length?(C=t,k=i=r=s=null,O()):C},D.clipAngle=function(t){return arguments.length?(_=+t?Pk(A=t*r_):(A=null,Rk),O()):A*i_},D.clipExtent=function(t){return arguments.length?(C=null==t?(k=i=r=s=null,qA):Wk(k=+t[0][0],i=+t[0][1],r=+t[1][0],s=+t[1][1]),O()):null==k?null:[[k,i],[r,s]]},D.scale=function(t){return arguments.length?(h=+t,S()):h},D.translate=function(t){return arguments.length?(f=+t[0],d=+t[1],S()):[f,d]},D.center=function(t){return arguments.length?(p=t[0]%360*r_,g=t[1]%360*r_,S()):[p*i_,g*i_]},D.rotate=function(t){return arguments.length?(m=t[0]%360*r_,y=t[1]%360*r_,v=t.length>2?t[2]%360*r_:0,S()):[m*i_,y*i_,v*i_]},D.angle=function(t){return arguments.length?(b=t%360*r_,S()):b*i_},D.reflectX=function(t){return arguments.length?(x=t?-1:1,S()):x<0},D.reflectY=function(t){return arguments.length?(w=t?-1:1,S()):w<0},D.precision=function(t){return arguments.length?(o=sC(a,E=t*t),O()):m_(E)},D.fitExtent=function(t,e){return tC(D,t,e)},D.fitSize=function(t,e){return eC(D,t,e)},D.fitWidth=function(t,e){return nC(D,t,e)},D.fitHeight=function(t,e){return iC(D,t,e)},function(){return e=t.apply(this,arguments),D.invert=e.invert&&F,S()}}function cC(t){var e=0,n=QA/3,i=lC(t),r=i(e,n);return r.parallels=function(t){return arguments.length?i(e=t[0]*r_,n=t[1]*r_):[e*i_,n*i_]},r}function hC(t,e){var n=p_(t),i=(n+p_(e))/2;if(s_(i)<ZA)return function(t){var e=u_(t);function n(t,n){return[t*e,p_(n)/e]}return n.invert=function(t,n){return[t/e,b_(n*e)]},n}(t);var r=1+n*(2*i-n),s=m_(r)/i;function o(t,e){var n=m_(r-2*i*p_(e))/i;return[n*p_(t*=i),s-n*u_(t)]}return o.invert=function(t,e){var n=s-e,o=a_(t,s_(n))*g_(n);return n*i<0&&(o-=QA*g_(t)*g_(n)),[o/i,b_((r-(t*t+n*n)*i*i)/(2*i))]},o}function fC(){return cC(hC).scale(155.424).center([0,33.6442])}function dC(){return fC().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function pC(t){return function(e,n){var i=u_(e),r=u_(n),s=t(i*r);return s===1/0?[2,0]:[s*r*p_(e),s*p_(n)]}}function gC(t){return function(e,n){var i=m_(e*e+n*n),r=t(i),s=p_(r),o=u_(r);return[a_(e*s,i*o),b_(i&&n*s/i)]}}var mC=pC((function(t){return m_(2/(1+t))}));mC.invert=gC((function(t){return 2*b_(t/2)}));var yC=pC((function(t){return(t=v_(t))&&t/p_(t)}));function vC(t,e){return[t,f_(y_((t_+e)/2))]}function bC(t){var e,n,i,r=uC(t),s=r.center,o=r.scale,a=r.translate,u=r.clipExtent,l=null;function c(){var s=QA*o(),a=r(function(t){function e(e){return(e=t(e[0]*r_,e[1]*r_))[0]*=i_,e[1]*=i_,e}return t=Gk(t[0]*r_,t[1]*r_,t.length>2?t[2]*r_:0),e.invert=function(e){return(e=t.invert(e[0]*r_,e[1]*r_))[0]*=i_,e[1]*=i_,e},e}(r.rotate()).invert([0,0]));return u(null==l?[[a[0]-s,a[1]-s],[a[0]+s,a[1]+s]]:t===vC?[[Math.max(a[0]-s,l),e],[Math.min(a[0]+s,n),i]]:[[l,Math.max(a[1]-s,e)],[n,Math.min(a[1]+s,i)]])}return r.scale=function(t){return arguments.length?(o(t),c()):o()},r.translate=function(t){return arguments.length?(a(t),c()):a()},r.center=function(t){return arguments.length?(s(t),c()):s()},r.clipExtent=function(t){return arguments.length?(null==t?l=e=n=i=null:(l=+t[0][0],e=+t[0][1],n=+t[1][0],i=+t[1][1]),c()):null==l?null:[[l,e],[n,i]]},c()}function xC(t){return y_((t_+t)/2)}function wC(t,e){var n=u_(t),i=t===e?p_(t):f_(n/u_(e))/f_(xC(e)/xC(t)),r=n*d_(xC(t),i)/i;if(!i)return vC;function s(t,e){r>0?e<-t_+ZA&&(e=-t_+ZA):e>t_-ZA&&(e=t_-ZA);var n=r/d_(xC(e),i);return[n*p_(i*t),r-n*u_(i*t)]}return s.invert=function(t,e){var n=r-e,s=g_(i)*m_(t*t+n*n),o=a_(t,s_(n))*g_(n);return n*i<0&&(o-=QA*g_(t)*g_(n)),[o/i,2*o_(d_(r/s,1/i))-t_]},s}function AC(t,e){return[t,e]}function _C(t,e){var n=u_(t),i=t===e?p_(t):(n-u_(e))/(e-t),r=n/i+t;if(s_(i)<ZA)return AC;function s(t,e){var n=r-e,s=i*t;return[n*p_(s),r-n*u_(s)]}return s.invert=function(t,e){var n=r-e,s=a_(t,s_(n))*g_(n);return n*i<0&&(s-=QA*g_(t)*g_(n)),[s/i,r-g_(i)*m_(t*t+n*n)]},s}yC.invert=gC((function(t){return t})),vC.invert=function(t,e){return[t,2*o_(c_(e))-t_]},AC.invert=AC;var kC=1.340264,CC=-.081106,EC=893e-6,DC=.003796,FC=m_(3)/2;function SC(t,e){var n=b_(FC*p_(e)),i=n*n,r=i*i*i;return[t*u_(n)/(FC*(kC+3*CC*i+r*(7*EC+9*DC*i))),n*(kC+CC*i+r*(EC+DC*i))]}function OC(t,e){var n=u_(e),i=u_(t)*n;return[n*p_(t)/i,p_(e)/i]}function NC(t,e){var n=e*e,i=n*n;return[t*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791)),e*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))]}function MC(t,e){return[u_(e)*p_(t),p_(e)]}function zC(t,e){var n=u_(e),i=1+u_(t)*n;return[n*p_(t)/i,p_(e)/i]}function $C(t,e){return[f_(y_((t_+e)/2)),-t]}SC.invert=function(t,e){for(var n,i=e,r=i*i,s=r*r*r,o=0;o<12&&(s=(r=(i-=n=(i*(kC+CC*r+s*(EC+DC*r))-e)/(kC+3*CC*r+s*(7*EC+9*DC*r)))*i)*r*r,!(s_(n)<KA));++o);return[FC*t*(kC+3*CC*r+s*(7*EC+9*DC*r))/u_(i),b_(p_(i)/FC)]},OC.invert=gC(o_),NC.invert=function(t,e){var n,i=e,r=25;do{var s=i*i,o=s*s;i-=n=(i*(1.007226+s*(.015085+o*(.028874*s-.044475-.005916*o)))-e)/(1.007226+s*(.045255+o*(.259866*s-.311325-.005916*11*o)))}while(s_(n)>ZA&&--r>0);return[t/(.8707+(s=i*i)*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979)),i]},MC.invert=gC(b_),zC.invert=gC((function(t){return 2*o_(t)})),$C.invert=function(t,e){return[-e,2*o_(c_(t))-t_]};var TC=Math.abs,BC=(Math.atan,Math.atan2,Math.ceil,Math.cos),jC=(Math.exp,Math.floor,Math.log,Math.max,Math.min,Math.pow,Math.round,Math.sign,Math.sin),IC=(Math.tan,Math.PI),RC=IC/2,LC=(Math.SQRT1_2,UC(2));function PC(t){return t>1?RC:t<-1?-RC:Math.asin(t)}function UC(t){return t>0?Math.sqrt(t):0}function qC(t,e){var n,i=t*jC(e),r=30;do{e-=n=(e+jC(e)-i)/(1+BC(e))}while(TC(n)>1e-6&&--r>0);return e/2}UC(IC);var WC=function(t,e,n){function i(i,r){return[t*i*BC(r=qC(n,r)),e*jC(r)]}return i.invert=function(i,r){return r=PC(r/e),[i/(t*BC(r)),PC((2*r+jC(2*r))/n)]},i}(LC/RC,LC,IC);const HC=wk(),VC=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function GC(t,e){return function n(){const i=e();return i.type=t,i.path=wk().projection(i),i.copy=i.copy||function(){const t=n();return VC.forEach((e=>{i[e]&&t[e](i[e]())})),t.path.pointRadius(i.path.pointRadius()),t},i}}function XC(t,e){if(!t||"string"!=typeof t)throw new Error("Projection type must be a name string.");return t=t.toLowerCase(),arguments.length>1?(JC[t]=GC(t,e),this):JC[t]||null}function YC(t){return t&&t.path||HC}const JC={albers:dC,albersusa:function(){var t,e,n,i,r,s,o=dC(),a=fC().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=fC().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(t,e){s=[t,e]}};function c(t){var e=t[0],o=t[1];return s=null,n.point(e,o),s||(i.point(e,o),s)||(r.point(e,o),s)}function h(){return t=e=null,c}return c.invert=function(t){var e=o.scale(),n=o.translate(),i=(t[0]-n[0])/e,r=(t[1]-n[1])/e;return(r>=.12&&r<.234&&i>=-.425&&i<-.214?a:r>=.166&&r<.234&&i>=-.214&&i<-.115?u:o).invert(t)},c.stream=function(n){return t&&e===n?t:(i=[o.stream(e=n),a.stream(n),u.stream(n)],r=i.length,t={point:function(t,e){for(var n=-1;++n<r;)i[n].point(t,e)},sphere:function(){for(var t=-1;++t<r;)i[t].sphere()},lineStart:function(){for(var t=-1;++t<r;)i[t].lineStart()},lineEnd:function(){for(var t=-1;++t<r;)i[t].lineEnd()},polygonStart:function(){for(var t=-1;++t<r;)i[t].polygonStart()},polygonEnd:function(){for(var t=-1;++t<r;)i[t].polygonEnd()}});var i,r},c.precision=function(t){return arguments.length?(o.precision(t),a.precision(t),u.precision(t),h()):o.precision()},c.scale=function(t){return arguments.length?(o.scale(t),a.scale(.35*t),u.scale(t),c.translate(o.translate())):o.scale()},c.translate=function(t){if(!arguments.length)return o.translate();var e=o.scale(),s=+t[0],c=+t[1];return n=o.translate(t).clipExtent([[s-.455*e,c-.238*e],[s+.455*e,c+.238*e]]).stream(l),i=a.translate([s-.307*e,c+.201*e]).clipExtent([[s-.425*e+ZA,c+.12*e+ZA],[s-.214*e-ZA,c+.234*e-ZA]]).stream(l),r=u.translate([s-.205*e,c+.212*e]).clipExtent([[s-.214*e+ZA,c+.166*e+ZA],[s-.115*e-ZA,c+.234*e-ZA]]).stream(l),h()},c.fitExtent=function(t,e){return tC(c,t,e)},c.fitSize=function(t,e){return eC(c,t,e)},c.fitWidth=function(t,e){return nC(c,t,e)},c.fitHeight=function(t,e){return iC(c,t,e)},c.scale(1070)},azimuthalequalarea:function(){return uC(mC).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return uC(yC).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return cC(wC).scale(109.5).parallels([30,30])},conicequalarea:fC,conicequidistant:function(){return cC(_C).scale(131.154).center([0,13.9389])},equalEarth:function(){return uC(SC).scale(177.158)},equirectangular:function(){return uC(AC).scale(152.63)},gnomonic:function(){return uC(OC).scale(144.049).clipAngle(60)},identity:function(){var t,e,n,i,r,s,o,a=1,u=0,l=0,c=1,h=1,f=0,d=null,p=1,g=1,m=Zk({point:function(t,e){var n=b([t,e]);this.stream.point(n[0],n[1])}}),y=qA;function v(){return p=a*c,g=a*h,s=o=null,b}function b(n){var i=n[0]*p,r=n[1]*g;if(f){var s=r*t-i*e;i=i*t+r*e,r=s}return[i+u,r+l]}return b.invert=function(n){var i=n[0]-u,r=n[1]-l;if(f){var s=r*t+i*e;i=i*t-r*e,r=s}return[i/p,r/g]},b.stream=function(t){return s&&o===t?s:s=m(y(o=t))},b.postclip=function(t){return arguments.length?(y=t,d=n=i=r=null,v()):y},b.clipExtent=function(t){return arguments.length?(y=null==t?(d=n=i=r=null,qA):Wk(d=+t[0][0],n=+t[0][1],i=+t[1][0],r=+t[1][1]),v()):null==d?null:[[d,n],[i,r]]},b.scale=function(t){return arguments.length?(a=+t,v()):a},b.translate=function(t){return arguments.length?(u=+t[0],l=+t[1],v()):[u,l]},b.angle=function(n){return arguments.length?(e=p_(f=n%360*r_),t=u_(f),v()):f*i_},b.reflectX=function(t){return arguments.length?(c=t?-1:1,v()):c<0},b.reflectY=function(t){return arguments.length?(h=t?-1:1,v()):h<0},b.fitExtent=function(t,e){return tC(b,t,e)},b.fitSize=function(t,e){return eC(b,t,e)},b.fitWidth=function(t,e){return nC(b,t,e)},b.fitHeight=function(t,e){return iC(b,t,e)},b},mercator:function(){return bC(vC).scale(961/n_)},mollweide:function(){return uC(WC).scale(169.529)},naturalEarth1:function(){return uC(NC).scale(175.295)},orthographic:function(){return uC(MC).scale(249.5).clipAngle(90.000001)},stereographic:function(){return uC(zC).scale(250).clipAngle(142)},transversemercator:function(){var t=bC($C),e=t.center,n=t.rotate;return t.center=function(t){return arguments.length?e([-t[1],t[0]]):[(t=e())[1],-t[0]]},t.rotate=function(t){return arguments.length?n([t[0],t[1],t.length>2?t[2]+90:90]):[(t=n())[0],t[1],t[2]-90]},n([0,0,90]).scale(159.155)}};for(const t in JC)XC(t,JC[t]);function ZC(t,e,n){var i=Bl(t,e-ZA,n).concat(e);return function(t){return i.map((function(e){return[t,e]}))}}function KC(t,e,n){var i=Bl(t,e-ZA,n).concat(e);return function(t){return i.map((function(e){return[e,t]}))}}function QC(){}const tE=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function eE(){var t=1,e=1,n=o;function i(t,e){return e.map((e=>r(t,e)))}function r(i,r){var o=[],a=[];return function(n,i,r){var o,a,u,l,c,h,f=new Array,d=new Array;for(o=a=-1,l=n[0]>=i,tE[l<<1].forEach(p);++o<t-1;)u=l,l=n[o+1]>=i,tE[u|l<<1].forEach(p);for(tE[l<<0].forEach(p);++a<e-1;){for(o=-1,l=n[a*t+t]>=i,c=n[a*t]>=i,tE[l<<1|c<<2].forEach(p);++o<t-1;)u=l,l=n[a*t+t+o+1]>=i,h=c,c=n[a*t+o+1]>=i,tE[u|l<<1|c<<2|h<<3].forEach(p);tE[l|c<<3].forEach(p)}for(o=-1,c=n[a*t]>=i,tE[c<<2].forEach(p);++o<t-1;)h=c,c=n[a*t+o+1]>=i,tE[c<<2|h<<3].forEach(p);function p(t){var e,n,i=[t[0][0]+o,t[0][1]+a],u=[t[1][0]+o,t[1][1]+a],l=s(i),c=s(u);(e=d[l])?(n=f[c])?(delete d[e.end],delete f[n.start],e===n?(e.ring.push(u),r(e.ring)):f[e.start]=d[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete d[e.end],e.ring.push(u),d[e.end=c]=e):(e=f[c])?(n=d[l])?(delete f[e.start],delete d[n.end],e===n?(e.ring.push(u),r(e.ring)):f[n.start]=d[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete f[e.start],e.ring.unshift(i),f[e.start=l]=e):f[l]=d[c]={start:l,end:c,ring:[i,u]}}tE[c<<3].forEach(p)}(i,r,(t=>{n(t,i,r),function(t){for(var e=0,n=t.length,i=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)i+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return i}(t)>0?o.push([t]):a.push(t)})),a.forEach((t=>{for(var e,n=0,i=o.length;n<i;++n)if(-1!==nE((e=o[n])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:r,coordinates:o}}function s(e){return 2*e[0]+e[1]*(t+1)*4}function o(n,i,r){n.forEach((n=>{var s,o=n[0],a=n[1],u=0|o,l=0|a,c=i[l*t+u];o>0&&o<t&&u===o&&(s=i[l*t+u-1],n[0]=o+(r-s)/(c-s)-.5),a>0&&a<e&&l===a&&(s=i[(l-1)*t+u],n[1]=a+(r-s)/(c-s)-.5)}))}return i.contour=r,i.size=function(n){if(!arguments.length)return[t,e];var r=Math.floor(n[0]),s=Math.floor(n[1]);return r>=0&&s>=0||Le("invalid size"),t=r,e=s,i},i.smooth=function(t){return arguments.length?(n=t?o:QC,i):n===o},i}function nE(t,e){for(var n,i=-1,r=e.length;++i<r;)if(n=iE(t,e[i]))return n;return 0}function iE(t,e){for(var n=e[0],i=e[1],r=-1,s=0,o=t.length,a=o-1;s<o;a=s++){var u=t[s],l=u[0],c=u[1],h=t[a],f=h[0],d=h[1];if(rE(u,h,e))return 0;c>i!=d>i&&n<(f-l)*(i-c)/(d-c)+l&&(r=-r)}return r}function rE(t,e,n){var i,r,s,o;return function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])}(t,e,n)&&(r=t[i=+(t[0]===e[0])],s=n[i],o=e[i],r<=s&&s<=o||o<=s&&s<=r)}function sE(t,e,n){return function(i){var r=En(i),s=n?Math.min(r[0],0):r[0],o=r[1],a=o-s,u=e?hi(s,o,t):a/(t+1);return Bl(s+u,o,u)}}function oE(t){Ou.call(this,null,t)}function aE(t,e,n,i,r){const s=t.x1||0,o=t.y1||0,a=e*n<0;function u(t){t.forEach(l)}function l(t){a&&t.reverse(),t.forEach(c)}function c(t){t[0]=(t[0]-s)*e+i,t[1]=(t[1]-o)*n+r}return function(t){return t.coordinates.forEach(u),t}}function uE(t,e,n){const i=t>=0?t:Hu(e,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function lE(t){return yn(t)?t:_n(+t)}function cE(){var t=t=>t[0],e=t=>t[1],n=Ve,i=[-1,-1],r=960,s=500,o=2;function a(a,u){const l=uE(i[0],a,t)>>o,c=uE(i[1],a,e)>>o,h=l?l+2:0,f=c?c+2:0,d=2*h+(r>>o),p=2*f+(s>>o),g=new Float32Array(d*p),m=new Float32Array(d*p);let y=g;a.forEach((i=>{const r=h+(+t(i)>>o),s=f+(+e(i)>>o);r>=0&&r<d&&s>=0&&s<p&&(g[r+s*d]+=+n(i))})),l>0&&c>0?(hE(d,p,g,m,l),fE(d,p,m,g,c),hE(d,p,g,m,l),fE(d,p,m,g,c),hE(d,p,g,m,l),fE(d,p,m,g,c)):l>0?(hE(d,p,g,m,l),hE(d,p,m,g,l),hE(d,p,g,m,l),y=m):c>0&&(fE(d,p,g,m,c),fE(d,p,m,g,c),fE(d,p,g,m,c),y=m);const v=u?Math.pow(2,-2*o):1/fA(y);for(let t=0,e=d*p;t<e;++t)y[t]*=v;return{values:y,scale:1<<o,width:d,height:p,x1:h,y1:f,x2:h+(r>>o),y2:f+(s>>o)}}return a.x=function(e){return arguments.length?(t=lE(e),a):t},a.y=function(t){return arguments.length?(e=lE(t),a):e},a.weight=function(t){return arguments.length?(n=lE(t),a):n},a.size=function(t){if(!arguments.length)return[r,s];var e=+t[0],n=+t[1];return e>=0&&n>=0||Le("invalid size"),r=e,s=n,a},a.cellSize=function(t){return arguments.length?((t=+t)>=1||Le("invalid cell size"),o=Math.floor(Math.log(t)/Math.LN2),a):1<<o},a.bandwidth=function(t){return arguments.length?(1===(t=mn(t)).length&&(t=[+t[0],+t[0]]),2!==t.length&&Le("invalid bandwidth"),i=t,a):i},a}function hE(t,e,n,i,r){const s=1+(r<<1);for(let o=0;o<e;++o)for(let e=0,a=0;e<t+r;++e)e<t&&(a+=n[e+o*t]),e>=r&&(e>=s&&(a-=n[e-s+o*t]),i[e-r+o*t]=a/Math.min(e+1,t-1+s-e,s))}function fE(t,e,n,i,r){const s=1+(r<<1);for(let o=0;o<t;++o)for(let a=0,u=0;a<e+r;++a)a<e&&(u+=n[o+a*t]),a>=r&&(a>=s&&(u-=n[o+(a-s)*t]),i[o+(a-r)*t]=u/Math.min(a+1,e-1+s-a,s))}function dE(t){Ou.call(this,null,t)}oE.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},Nn(oE,Ou,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=e.materialize(e.SOURCE).source,r=t.field||We,s=eE().smooth(!1!==t.smooth),o=t.thresholds||function(t,e,n){const i=sE(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?i:i(t.map((t=>$u(e(t).values))))}(i,r,t),a=null===t.as?null:t.as||"contour",u=[];return i.forEach((e=>{const n=r(e),i=s.size([n.width,n.height])(n.values,Ze(o)?o:o(n.values));!function(t,e,n,i){let r=i.scale||e.scale,s=i.translate||e.translate;if(yn(r)&&(r=r(n,i)),yn(s)&&(s=s(n,i)),(1===r||null==r)&&!s)return;const o=($n(r)?r:r[0])||1,a=($n(r)?r:r[1])||1,u=s&&s[0]||0,l=s&&s[1]||0;t.forEach(aE(e,o,a,u,l))}(i,n,e,t),i.forEach((t=>{u.push(nu(e,tu(null!=a?{[a]:t}:t)))}))})),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}}),dE.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const pE=["x","y","weight","size","cellSize","bandwidth"];function gE(t,e){return pE.forEach((n=>null!=e[n]?t[n](e[n]):0)),t}function mE(t){Ou.call(this,null,t)}Nn(dE,Ou,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=function(t,e){var n,i,r,s,o,a,u=[],l=t=>t(s);if(null==e)u.push(t);else for(n={},i=0,r=t.length;i<r;++i)s=t[i],(a=n[o=e.map(l)])||(n[o]=a=[],a.dims=o,u.push(a)),a.push(s);return u}(e.materialize(e.SOURCE).source,t.groupby),s=(t.groupby||[]).map(Te),o=gE(cE(),t),a=t.as||"grid";return n=r.map((e=>tu(function(t,e){for(let n=0;n<s.length;++n)t[s[n]]=e[n];return t}({[a]:o(e,t.counts)},e.dims)))),this.value&&(i.rem=this.value),this.value=i.source=i.add=n,i}}),mE.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},Nn(mE,Ou,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n,i,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),s=eE().smooth(!1!==t.smooth),o=t.values,a=t.thresholds||sE(t.count||10,t.nice,!!o),u=t.size;return o||(o=e.materialize(e.SOURCE).source,i=aE(n=gE(cE(),t)(o,!0),n.scale||1,n.scale||1,0,0),u=[n.width,n.height],o=n.values),a=Ze(a)?a:a(o),o=s.size(u)(o,a),i&&o.forEach(i),this.value&&(r.rem=this.value),this.value=r.source=r.add=(o||[]).map(tu),r}});const yE="Feature",vE="FeatureCollection";function bE(t){Ou.call(this,null,t)}function xE(t){Ou.call(this,null,t)}function wE(t){Ou.call(this,null,t)}function AE(t){Ou.call(this,null,t)}function _E(t){Ou.call(this,[],t),this.generator=function(){var t,e,n,i,r,s,o,a,u,l,c,h,f=10,d=f,p=90,g=360,m=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return Bl(l_(i/p)*p,n,p).map(c).concat(Bl(l_(a/g)*g,o,g).map(h)).concat(Bl(l_(e/f)*f,t,f).filter((function(t){return s_(t%p)>ZA})).map(u)).concat(Bl(l_(s/d)*d,r,d).filter((function(t){return s_(t%g)>ZA})).map(l))}return y.lines=function(){return v().map((function(t){return{type:"LineString",coordinates:t}}))},y.outline=function(){return{type:"Polygon",coordinates:[c(i).concat(h(o).slice(1),c(n).reverse().slice(1),h(a).reverse().slice(1))]}},y.extent=function(t){return arguments.length?y.extentMajor(t).extentMinor(t):y.extentMinor()},y.extentMajor=function(t){return arguments.length?(i=+t[0][0],n=+t[1][0],a=+t[0][1],o=+t[1][1],i>n&&(t=i,i=n,n=t),a>o&&(t=a,a=o,o=t),y.precision(m)):[[i,a],[n,o]]},y.extentMinor=function(n){return arguments.length?(e=+n[0][0],t=+n[1][0],s=+n[0][1],r=+n[1][1],e>t&&(n=e,e=t,t=n),s>r&&(n=s,s=r,r=n),y.precision(m)):[[e,s],[t,r]]},y.step=function(t){return arguments.length?y.stepMajor(t).stepMinor(t):y.stepMinor()},y.stepMajor=function(t){return arguments.length?(p=+t[0],g=+t[1],y):[p,g]},y.stepMinor=function(t){return arguments.length?(f=+t[0],d=+t[1],y):[f,d]},y.precision=function(f){return arguments.length?(m=+f,u=ZC(s,r,90),l=KC(e,t,m),c=ZC(a,o,90),h=KC(i,n,m),y):m},y.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function kE(t){Ou.call(this,null,t)}function CE(t){if(!yn(t))return!1;const e=Wn(Be(t));return e.$x||e.$y||e.$value||e.$max}function EE(t){Ou.call(this,null,t),this.modified(!0)}function DE(t,e,n){yn(t[e])&&t[e](n)}function FE(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,s,o,a,u,l,c,h,f,d=t._root,p={data:i},g=t._x0,m=t._y0,y=t._x1,v=t._y1;if(!d)return t._root=p,t;for(;d.length;)if((l=e>=(s=(g+y)/2))?g=s:y=s,(c=n>=(o=(m+v)/2))?m=o:v=o,r=d,!(d=d[h=c<<1|l]))return r[h]=p,t;if(a=+t._x.call(null,d.data),u=+t._y.call(null,d.data),e===a&&n===u)return p.next=d,r?r[h]=p:t._root=p,t;do{r=r?r[h]=new Array(4):t._root=new Array(4),(l=e>=(s=(g+y)/2))?g=s:y=s,(c=n>=(o=(m+v)/2))?m=o:v=o}while((h=c<<1|l)==(f=(u>=o)<<1|a>=s));return r[f]=d,r[h]=p,t}function SE(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function OE(t){return t[0]}function NE(t){return t[1]}function ME(t,e,n){var i=new zE(null==e?OE:e,null==n?NE:n,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function zE(t,e,n,i,r,s){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function $E(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}bE.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},Nn(bE,Ou,{transform(t,e){var n,i=this._features,r=this._points,s=t.fields,o=s&&s[0],a=s&&s[1],u=t.geojson||!s&&We,l=e.ADD;n=t.modified()||e.changed(e.REM)||e.modified(Be(u))||o&&e.modified(Be(o))||a&&e.modified(Be(a)),this.value&&!n||(l=e.SOURCE,this._features=i=[],this._points=r=[]),u&&e.visit(l,(t=>i.push(u(t)))),o&&a&&(e.visit(l,(t=>{var e=o(t),n=a(t);null!=e&&null!=n&&(e=+e)===e&&(n=+n)===n&&r.push([e,n])})),i=i.concat({type:yE,geometry:{type:"MultiPoint",coordinates:r}})),this.value={type:vE,features:i}}}),xE.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},Nn(xE,Ou,{transform(t,e){var n=e.fork(e.ALL),i=this.value,r=t.field||We,s=t.as||"path",o=n.SOURCE;!i||t.modified()?(this.value=i=YC(t.projection),n.materialize().reflow()):o=r===We||e.modified(r.fields)?n.ADD_MOD:n.ADD;const a=function(t,e){const n=t.pointRadius();return t.context(null),null!=e&&t.pointRadius(e),n}(i,t.pointRadius);return n.visit(o,(t=>t[s]=i(r(t)))),i.pointRadius(a),n.modifies(s)}}),wE.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},Nn(wE,Ou,{transform(t,e){var n,i=t.projection,r=t.fields[0],s=t.fields[1],o=t.as||["x","y"],a=o[0],u=o[1];function l(t){const e=i([r(t),s(t)]);e?(t[a]=e[0],t[u]=e[1]):(t[a]=void 0,t[u]=void 0)}return t.modified()?e=e.materialize().reflow(!0).visit(e.SOURCE,l):(n=e.modified(r.fields)||e.modified(s.fields),e.visit(n?e.ADD_MOD:e.ADD,l)),e.modifies(o)}}),AE.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},Nn(AE,Ou,{transform(t,e){var n=e.fork(e.ALL),i=this.value,r=t.as||"shape",s=n.ADD;return i&&!t.modified()||(this.value=i=function(t,e,n){const i=null==n?n=>t(e(n)):i=>{var r=t.pointRadius(),s=t.pointRadius(n)(e(i));return t.pointRadius(r),s};return i.context=e=>(t.context(e),i),i}(YC(t.projection),t.field||Ue("datum"),t.pointRadius),n.materialize().reflow(),s=n.SOURCE),n.visit(s,(t=>t[r]=i)),n.modifies(r)}}),_E.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},Nn(_E,Ou,{transform(t,e){var n,i=this.value,r=this.generator;if(!i.length||t.modified())for(const e in t)yn(r[e])&&r[e](t[e]);return n=r(),i.length?e.mod.push(iu(i[0],n)):e.add.push(tu(n)),i[0]=n,e}}),kE.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},Nn(kE,Ou,{transform(t,e){if(!e.changed()&&!t.modified())return e.StopPropagation;var n=e.materialize(e.SOURCE).source,i="shared"===t.resolve,r=t.field||We,s=function(t,e){let n;return yn(t)?(n=n=>t(n,e),n.dep=CE(t)):t?n=_n(t):(n=t=>t.$value/t.$max||0,n.dep=!0),n}(t.opacity,t),o=function(t,e){let n;return yn(t)?(n=n=>nd(t(n,e)),n.dep=CE(t)):n=_n(nd(t||"#888")),n}(t.color,t),a=t.as||"image",u={$x:0,$y:0,$value:0,$max:i?$u(n.map((t=>$u(r(t).values)))):0};return n.forEach((t=>{const e=r(t),n=Cn({},t,u);i||(n.$max=$u(e.values||[])),t[a]=function(t,e,n,i){const r=t.width,s=t.height,o=t.x1||0,a=t.y1||0,u=t.x2||r,l=t.y2||s,c=t.values,h=c?t=>c[t]:He,f=_f(u-o,l-a),d=f.getContext("2d"),p=d.getImageData(0,0,u-o,l-a),g=p.data;for(let t=a,s=0;t<l;++t){e.$y=t-a;for(let a=o,l=t*r;a<u;++a,s+=4){e.$x=a-o,e.$value=h(a+l);const t=n(e);g[s+0]=t.r,g[s+1]=t.g,g[s+2]=t.b,g[s+3]=~~(255*i(e))}}return d.putImageData(p,0,0),f}(e,n,o.dep?o:_n(o(n)),s.dep?s:_n(s(n)))})),e.reflow(!0).modifies(a)}}),Nn(EE,Ou,{transform(t,e){let n=this.value;return!n||t.modified("type")?(this.value=n=function(t){const e=XC((t||"mercator").toLowerCase());return e||Le("Unrecognized projection type: "+t),e()}(t.type),VC.forEach((e=>{null!=t[e]&&DE(n,e,t[e])}))):VC.forEach((e=>{t.modified(e)&&DE(n,e,t[e])})),null!=t.pointRadius&&n.path.pointRadius(t.pointRadius),t.fit&&function(t,e){const n=function(t){return 1===(t=mn(t)).length?t[0]:{type:vE,features:t.reduce(((t,e)=>t.concat(function(t){return t.type===vE?t.features:mn(t).filter((t=>null!=t)).map((t=>t.type===yE?t:{type:yE,geometry:t}))}(e))),[])}}(e.fit);e.extent?t.fitExtent(e.extent,n):e.size&&t.fitSize(e.size,n)}(n,t),e.fork(e.NO_SOURCE|e.NO_FIELDS)}});var TE=ME.prototype=zE.prototype;function BE(t){return function(){return t}}function jE(t){return 1e-6*(t()-.5)}function IE(t){return t.x+t.vx}function RE(t){return t.y+t.vy}TE.copy=function(){var t,e,n=new zE(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return n;if(!i.length)return n._root=$E(i),n;for(t=[{source:i,target:n._root=new Array(4)}];i=t.pop();)for(var r=0;r<4;++r)(e=i.source[r])&&(e.length?t.push({source:e,target:i.target[r]=new Array(4)}):i.target[r]=$E(e));return n},TE.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return FE(this.cover(e,n),e,n,t)},TE.addAll=function(t){var e,n,i,r,s=t.length,o=new Array(s),a=new Array(s),u=1/0,l=1/0,c=-1/0,h=-1/0;for(n=0;n<s;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(r=+this._y.call(null,e))||(o[n]=i,a[n]=r,i<u&&(u=i),i>c&&(c=i),r<l&&(l=r),r>h&&(h=r));if(u>c||l>h)return this;for(this.cover(u,l).cover(c,h),n=0;n<s;++n)FE(this,o[n],a[n],t[n]);return this},TE.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,s=(i=Math.floor(e))+1;else{for(var o,a,u=r-n||1,l=this._root;n>t||t>=r||i>e||e>=s;)switch(a=(e<i)<<1|t<n,(o=new Array(4))[a]=l,l=o,u*=2,a){case 0:r=n+u,s=i+u;break;case 1:n=r-u,s=i+u;break;case 2:r=n+u,i=s-u;break;case 3:n=r-u,i=s-u}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this},TE.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},TE.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},TE.find=function(t,e,n){var i,r,s,o,a,u,l,c=this._x0,h=this._y0,f=this._x1,d=this._y1,p=[],g=this._root;for(g&&p.push(new SE(g,c,h,f,d)),null==n?n=1/0:(c=t-n,h=e-n,f=t+n,d=e+n,n*=n);u=p.pop();)if(!(!(g=u.node)||(r=u.x0)>f||(s=u.y0)>d||(o=u.x1)<c||(a=u.y1)<h))if(g.length){var m=(r+o)/2,y=(s+a)/2;p.push(new SE(g[3],m,y,o,a),new SE(g[2],r,y,m,a),new SE(g[1],m,s,o,y),new SE(g[0],r,s,m,y)),(l=(e>=y)<<1|t>=m)&&(u=p[p.length-1],p[p.length-1]=p[p.length-1-l],p[p.length-1-l]=u)}else{var v=t-+this._x.call(null,g.data),b=e-+this._y.call(null,g.data),x=v*v+b*b;if(x<n){var w=Math.sqrt(n=x);c=t-w,h=e-w,f=t+w,d=e+w,i=g.data}}return i},TE.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,n,i,r,s,o,a,u,l,c,h,f,d=this._root,p=this._x0,g=this._y0,m=this._x1,y=this._y1;if(!d)return this;if(d.length)for(;;){if((l=s>=(a=(p+m)/2))?p=a:m=a,(c=o>=(u=(g+y)/2))?g=u:y=u,e=d,!(d=d[h=c<<1|l]))return this;if(!d.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,f=h)}for(;d.data!==t;)if(i=d,!(d=d.next))return this;return(r=d.next)&&delete d.next,i?(r?i.next=r:delete i.next,this):e?(r?e[h]=r:delete e[h],(d=e[0]||e[1]||e[2]||e[3])&&d===(e[3]||e[2]||e[1]||e[0])&&!d.length&&(n?n[f]=d:this._root=d),this):(this._root=r,this)},TE.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},TE.root=function(){return this._root},TE.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},TE.visit=function(t){var e,n,i,r,s,o,a=[],u=this._root;for(u&&a.push(new SE(u,this._x0,this._y0,this._x1,this._y1));e=a.pop();)if(!t(u=e.node,i=e.x0,r=e.y0,s=e.x1,o=e.y1)&&u.length){var l=(i+s)/2,c=(r+o)/2;(n=u[3])&&a.push(new SE(n,l,c,s,o)),(n=u[2])&&a.push(new SE(n,i,c,l,o)),(n=u[1])&&a.push(new SE(n,l,r,s,c)),(n=u[0])&&a.push(new SE(n,i,r,l,c))}return this},TE.visitAfter=function(t){var e,n=[],i=[];for(this._root&&n.push(new SE(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var r=e.node;if(r.length){var s,o=e.x0,a=e.y0,u=e.x1,l=e.y1,c=(o+u)/2,h=(a+l)/2;(s=r[0])&&n.push(new SE(s,o,a,c,h)),(s=r[1])&&n.push(new SE(s,c,a,u,h)),(s=r[2])&&n.push(new SE(s,o,h,c,l)),(s=r[3])&&n.push(new SE(s,c,h,u,l))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},TE.x=function(t){return arguments.length?(this._x=t,this):this._x},TE.y=function(t){return arguments.length?(this._y=t,this):this._y};var LE={value:()=>{}};function PE(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new UE(i)}function UE(t){this._=t}function qE(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",i=t.indexOf(".");if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function WE(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}function HE(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=LE,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}UE.prototype=PE.prototype={constructor:UE,on:function(t,e){var n,i=this._,r=qE(t+"",i),s=-1,o=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++s<o;)if(n=(t=r[s]).type)i[n]=HE(i[n],t.name,e);else if(null==e)for(n in i)i[n]=HE(i[n],t.name,null);return this}for(;++s<o;)if((n=(t=r[s]).type)&&(n=WE(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new UE(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),s=0;s<n;++s)r[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,n=(i=this._[t]).length;s<n;++s)i[s].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,s=i.length;r<s;++r)i[r].value.apply(e,n)}};const VE=PE;var GE,XE,YE=0,JE=0,ZE=0,KE=0,QE=0,tD=0,eD="object"==typeof performance&&performance.now?performance:Date,nD="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function iD(){return QE||(nD(rD),QE=eD.now()+tD)}function rD(){QE=0}function sD(){this._call=this._time=this._next=null}function oD(t,e,n){var i=new sD;return i.restart(t,e,n),i}function aD(){QE=(KE=eD.now())+tD,YE=JE=0;try{!function(){iD(),++YE;for(var t,e=GE;e;)(t=QE-e._time)>=0&&e._call.call(null,t),e=e._next;--YE}()}finally{YE=0,function(){for(var t,e,n=GE,i=1/0;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:GE=e);XE=t,lD(i)}(),QE=0}}function uD(){var t=eD.now(),e=t-KE;e>1e3&&(tD-=e,KE=t)}function lD(t){YE||(JE&&(JE=clearTimeout(JE)),t-QE>24?(t<1/0&&(JE=setTimeout(aD,t-eD.now()-tD)),ZE&&(ZE=clearInterval(ZE))):(ZE||(KE=eD.now(),ZE=setInterval(uD,1e3)),YE=1,nD(aD)))}sD.prototype=oD.prototype={constructor:sD,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?iD():+n)+(null==e?0:+e),this._next||XE===this||(XE?XE._next=this:GE=this,XE=this),this._call=t,this._time=n,lD()},stop:function(){this._call&&(this._call=null,this._time=1/0,lD())}};const cD=4294967296;function hD(t){return t.x}function fD(t){return t.y}var dD=Math.PI*(3-Math.sqrt(5));function pD(t){return t.index}function gD(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}const mD={center:function(t,e){var n,i=1;function r(){var r,s,o=n.length,a=0,u=0;for(r=0;r<o;++r)a+=(s=n[r]).x,u+=s.y;for(a=(a/o-t)*i,u=(u/o-e)*i,r=0;r<o;++r)(s=n[r]).x-=a,s.y-=u}return null==t&&(t=0),null==e&&(e=0),r.initialize=function(t){n=t},r.x=function(e){return arguments.length?(t=+e,r):t},r.y=function(t){return arguments.length?(e=+t,r):e},r.strength=function(t){return arguments.length?(i=+t,r):i},r},collide:function(t){var e,n,i,r=1,s=1;function o(){for(var t,o,u,l,c,h,f,d=e.length,p=0;p<s;++p)for(o=ME(e,IE,RE).visitAfter(a),t=0;t<d;++t)u=e[t],h=n[u.index],f=h*h,l=u.x+u.vx,c=u.y+u.vy,o.visit(g);function g(t,e,n,s,o){var a=t.data,d=t.r,p=h+d;if(!a)return e>l+p||s<l-p||n>c+p||o<c-p;if(a.index>u.index){var g=l-a.x-a.vx,m=c-a.y-a.vy,y=g*g+m*m;y<p*p&&(0===g&&(y+=(g=jE(i))*g),0===m&&(y+=(m=jE(i))*m),y=(p-(y=Math.sqrt(y)))/y*r,u.vx+=(g*=y)*(p=(d*=d)/(f+d)),u.vy+=(m*=y)*p,a.vx-=g*(p=1-p),a.vy-=m*p)}}}function a(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function u(){if(e){var i,r,s=e.length;for(n=new Array(s),i=0;i<s;++i)r=e[i],n[r.index]=+t(r,i,e)}}return"function"!=typeof t&&(t=BE(null==t?1:+t)),o.initialize=function(t,n){e=t,i=n,u()},o.iterations=function(t){return arguments.length?(s=+t,o):s},o.strength=function(t){return arguments.length?(r=+t,o):r},o.radius=function(e){return arguments.length?(t="function"==typeof e?e:BE(+e),u(),o):t},o},nbody:function(){var t,e,n,i,r,s=BE(-30),o=1,a=1/0,u=.81;function l(n){var r,s=t.length,o=ME(t,hD,fD).visitAfter(h);for(i=n,r=0;r<s;++r)e=t[r],o.visit(f)}function c(){if(t){var e,n,i=t.length;for(r=new Array(i),e=0;e<i;++e)n=t[e],r[n.index]=+s(n,e,t)}}function h(t){var e,n,i,s,o,a=0,u=0;if(t.length){for(i=s=o=0;o<4;++o)(e=t[o])&&(n=Math.abs(e.value))&&(a+=e.value,u+=n,i+=n*e.x,s+=n*e.y);t.x=i/u,t.y=s/u}else{(e=t).x=e.data.x,e.y=e.data.y;do{a+=r[e.data.index]}while(e=e.next)}t.value=a}function f(t,s,l,c){if(!t.value)return!0;var h=t.x-e.x,f=t.y-e.y,d=c-s,p=h*h+f*f;if(d*d/u<p)return p<a&&(0===h&&(p+=(h=jE(n))*h),0===f&&(p+=(f=jE(n))*f),p<o&&(p=Math.sqrt(o*p)),e.vx+=h*t.value*i/p,e.vy+=f*t.value*i/p),!0;if(!(t.length||p>=a)){(t.data!==e||t.next)&&(0===h&&(p+=(h=jE(n))*h),0===f&&(p+=(f=jE(n))*f),p<o&&(p=Math.sqrt(o*p)));do{t.data!==e&&(d=r[t.data.index]*i/p,e.vx+=h*d,e.vy+=f*d)}while(t=t.next)}}return l.initialize=function(e,i){t=e,n=i,c()},l.strength=function(t){return arguments.length?(s="function"==typeof t?t:BE(+t),c(),l):s},l.distanceMin=function(t){return arguments.length?(o=t*t,l):Math.sqrt(o)},l.distanceMax=function(t){return arguments.length?(a=t*t,l):Math.sqrt(a)},l.theta=function(t){return arguments.length?(u=t*t,l):Math.sqrt(u)},l},link:function(t){var e,n,i,r,s,o,a=pD,u=function(t){return 1/Math.min(r[t.source.index],r[t.target.index])},l=BE(30),c=1;function h(i){for(var r=0,a=t.length;r<c;++r)for(var u,l,h,f,d,p,g,m=0;m<a;++m)l=(u=t[m]).source,f=(h=u.target).x+h.vx-l.x-l.vx||jE(o),d=h.y+h.vy-l.y-l.vy||jE(o),f*=p=((p=Math.sqrt(f*f+d*d))-n[m])/p*i*e[m],d*=p,h.vx-=f*(g=s[m]),h.vy-=d*g,l.vx+=f*(g=1-g),l.vy+=d*g}function f(){if(i){var o,u,l=i.length,c=t.length,h=new Map(i.map(((t,e)=>[a(t,e,i),t])));for(o=0,r=new Array(l);o<c;++o)(u=t[o]).index=o,"object"!=typeof u.source&&(u.source=gD(h,u.source)),"object"!=typeof u.target&&(u.target=gD(h,u.target)),r[u.source.index]=(r[u.source.index]||0)+1,r[u.target.index]=(r[u.target.index]||0)+1;for(o=0,s=new Array(c);o<c;++o)u=t[o],s[o]=r[u.source.index]/(r[u.source.index]+r[u.target.index]);e=new Array(c),d(),n=new Array(c),p()}}function d(){if(i)for(var n=0,r=t.length;n<r;++n)e[n]=+u(t[n],n,t)}function p(){if(i)for(var e=0,r=t.length;e<r;++e)n[e]=+l(t[e],e,t)}return null==t&&(t=[]),h.initialize=function(t,e){i=t,o=e,f()},h.links=function(e){return arguments.length?(t=e,f(),h):t},h.id=function(t){return arguments.length?(a=t,h):a},h.iterations=function(t){return arguments.length?(c=+t,h):c},h.strength=function(t){return arguments.length?(u="function"==typeof t?t:BE(+t),d(),h):u},h.distance=function(t){return arguments.length?(l="function"==typeof t?t:BE(+t),p(),h):l},h},x:function(t){var e,n,i,r=BE(.1);function s(t){for(var r,s=0,o=e.length;s<o;++s)(r=e[s]).vx+=(i[s]-r.x)*n[s]*t}function o(){if(e){var s,o=e.length;for(n=new Array(o),i=new Array(o),s=0;s<o;++s)n[s]=isNaN(i[s]=+t(e[s],s,e))?0:+r(e[s],s,e)}}return"function"!=typeof t&&(t=BE(null==t?0:+t)),s.initialize=function(t){e=t,o()},s.strength=function(t){return arguments.length?(r="function"==typeof t?t:BE(+t),o(),s):r},s.x=function(e){return arguments.length?(t="function"==typeof e?e:BE(+e),o(),s):t},s},y:function(t){var e,n,i,r=BE(.1);function s(t){for(var r,s=0,o=e.length;s<o;++s)(r=e[s]).vy+=(i[s]-r.y)*n[s]*t}function o(){if(e){var s,o=e.length;for(n=new Array(o),i=new Array(o),s=0;s<o;++s)n[s]=isNaN(i[s]=+t(e[s],s,e))?0:+r(e[s],s,e)}}return"function"!=typeof t&&(t=BE(null==t?0:+t)),s.initialize=function(t){e=t,o()},s.strength=function(t){return arguments.length?(r="function"==typeof t?t:BE(+t),o(),s):r},s.y=function(e){return arguments.length?(t="function"==typeof e?e:BE(+e),o(),s):t},s}},yD="forces",vD=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],bD=["static","iterations"],xD=["x","y","vx","vy"];function wD(t){Ou.call(this,null,t)}function AD(t,e,n,i){var r,s,o,a,u=mn(e.forces);for(r=0,s=vD.length;r<s;++r)(o=vD[r])!==yD&&e.modified(o)&&t[o](e[o]);for(r=0,s=u.length;r<s;++r)a=yD+r,(o=n||e.modified(yD,r)?kD(u[r]):i&&_D(u[r],i)?t.force(a):null)&&t.force(a,o);for(s=t.numForces||0;r<s;++r)t.force(yD+r,null);return t.numForces=u.length,t}function _D(t,e){var n,i;for(n in t)if(yn(i=t[n])&&e.modified(Be(i)))return 1;return 0}function kD(t){var e,n;for(n in Fn(mD,t.force)||Le("Unrecognized force: "+t.force),e=mD[t.force](),t)yn(e[n])&&CD(e[n],t[n],t);return e}function CD(t,e,n){t(yn(e)?t=>e(t,n):e)}function ED(t){var e=0,n=t.children,i=n&&n.length;if(i)for(;--i>=0;)e+=n[i].value;else e=1;t.value=e}function DD(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=SD)):void 0===e&&(e=FD);for(var n,i,r,s,o,a=new MD(t),u=[a];n=u.pop();)if((r=e(n.data))&&(o=(r=Array.from(r)).length))for(n.children=r,s=o-1;s>=0;--s)u.push(i=r[s]=new MD(r[s])),i.parent=n,i.depth=n.depth+1;return a.eachBefore(ND)}function FD(t){return t.children}function SD(t){return Array.isArray(t)?t[1]:null}function OD(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function ND(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function MD(t){this.data=t,this.depth=this.height=0,this.parent=null}function zD(t,e){var n,i;if(BD(e,t))return[e];for(n=0;n<t.length;++n)if($D(e,t[n])&&BD(ID(t[n],e),t))return[t[n],e];for(n=0;n<t.length-1;++n)for(i=n+1;i<t.length;++i)if($D(ID(t[n],t[i]),e)&&$D(ID(t[n],e),t[i])&&$D(ID(t[i],e),t[n])&&BD(RD(t[n],t[i],e),t))return[t[n],t[i],e];throw new Error}function $D(t,e){var n=t.r-e.r,i=e.x-t.x,r=e.y-t.y;return n<0||n*n<i*i+r*r}function TD(t,e){var n=t.r-e.r+1e-9*Math.max(t.r,e.r,1),i=e.x-t.x,r=e.y-t.y;return n>0&&n*n>i*i+r*r}function BD(t,e){for(var n=0;n<e.length;++n)if(!TD(t,e[n]))return!1;return!0}function jD(t){switch(t.length){case 1:return{x:(e=t[0]).x,y:e.y,r:e.r};case 2:return ID(t[0],t[1]);case 3:return RD(t[0],t[1],t[2])}var e}function ID(t,e){var n=t.x,i=t.y,r=t.r,s=e.x,o=e.y,a=e.r,u=s-n,l=o-i,c=a-r,h=Math.sqrt(u*u+l*l);return{x:(n+s+u/h*c)/2,y:(i+o+l/h*c)/2,r:(h+r+a)/2}}function RD(t,e,n){var i=t.x,r=t.y,s=t.r,o=e.x,a=e.y,u=e.r,l=n.x,c=n.y,h=n.r,f=i-o,d=i-l,p=r-a,g=r-c,m=u-s,y=h-s,v=i*i+r*r-s*s,b=v-o*o-a*a+u*u,x=v-l*l-c*c+h*h,w=d*p-f*g,A=(p*x-g*b)/(2*w)-i,_=(g*m-p*y)/w,k=(d*b-f*x)/(2*w)-r,C=(f*y-d*m)/w,E=_*_+C*C-1,D=2*(s+A*_+k*C),F=A*A+k*k-s*s,S=-(E?(D+Math.sqrt(D*D-4*E*F))/(2*E):F/D);return{x:i+A+_*S,y:r+k+C*S,r:S}}function LD(t,e,n){var i,r,s,o,a=t.x-e.x,u=t.y-e.y,l=a*a+u*u;l?(r=e.r+n.r,r*=r,o=t.r+n.r,r>(o*=o)?(i=(l+o-r)/(2*l),s=Math.sqrt(Math.max(0,o/l-i*i)),n.x=t.x-i*a-s*u,n.y=t.y-i*u+s*a):(i=(l+r-o)/(2*l),s=Math.sqrt(Math.max(0,r/l-i*i)),n.x=e.x+i*a-s*u,n.y=e.y+i*u+s*a)):(n.x=e.x+n.r,n.y=e.y)}function PD(t,e){var n=t.r+e.r-1e-6,i=e.x-t.x,r=e.y-t.y;return n>0&&n*n>i*i+r*r}function UD(t){var e=t._,n=t.next._,i=e.r+n.r,r=(e.x*n.r+n.x*e.r)/i,s=(e.y*n.r+n.y*e.r)/i;return r*r+s*s}function qD(t){this._=t,this.next=null,this.previous=null}function WD(t){if(!(r=(t=function(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}(t)).length))return 0;var e,n,i,r,s,o,a,u,l,c,h;if((e=t[0]).x=0,e.y=0,!(r>1))return e.r;if(n=t[1],e.x=-n.r,n.x=e.r,n.y=0,!(r>2))return e.r+n.r;LD(n,e,i=t[2]),e=new qD(e),n=new qD(n),i=new qD(i),e.next=i.previous=n,n.next=e.previous=i,i.next=n.previous=e;t:for(a=3;a<r;++a){LD(e._,n._,i=t[a]),i=new qD(i),u=n.next,l=e.previous,c=n._.r,h=e._.r;do{if(c<=h){if(PD(u._,i._)){n=u,e.next=n,n.previous=e,--a;continue t}c+=u._.r,u=u.next}else{if(PD(l._,i._)){(e=l).next=n,n.previous=e,--a;continue t}h+=l._.r,l=l.previous}}while(u!==l.next);for(i.previous=e,i.next=n,e.next=n.previous=n=i,s=UD(e);(i=i.next)!==n;)(o=UD(i))<s&&(e=i,s=o);n=e.next}for(e=[n._],i=n;(i=i.next)!==n;)e.push(i._);for(i=function(t){for(var e,n,i=0,r=(t=function(t){for(var e,n,i=t.length;i;)n=Math.random()*i--|0,e=t[i],t[i]=t[n],t[n]=e;return t}(Array.from(t))).length,s=[];i<r;)e=t[i],n&&TD(n,e)?++i:(n=jD(s=zD(s,e)),i=0);return n}(e),a=0;a<r;++a)(e=t[a]).x-=i.x,e.y-=i.y;return i.r}function HD(t){return null==t?null:VD(t)}function VD(t){if("function"!=typeof t)throw new Error;return t}function GD(){return 0}function XD(t){return function(){return t}}function YD(t){return Math.sqrt(t.value)}function JD(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function ZD(t,e){return function(n){if(i=n.children){var i,r,s,o=i.length,a=t(n)*e||0;if(a)for(r=0;r<o;++r)i[r].r+=a;if(s=WD(i),a)for(r=0;r<o;++r)i[r].r-=a;n.r=s+a}}}function KD(t){return function(e){var n=e.parent;e.r*=t,n&&(e.x=n.x+t*e.x,e.y=n.y+t*e.y)}}function QD(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function tF(t,e,n,i,r){for(var s,o=t.children,a=-1,u=o.length,l=t.value&&(i-e)/t.value;++a<u;)(s=o[a]).y0=n,s.y1=r,s.x0=e,s.x1=e+=s.value*l}wD.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:xD}]},Nn(wD,Ou,{transform(t,e){var n,i,r=this.value,s=e.changed(e.ADD_REM),o=t.modified(vD),a=t.iterations||300;if(r?(s&&(e.modifies("index"),r.nodes(e.source)),(o||e.changed(e.MOD))&&AD(r,t,0,e)):(this.value=r=function(t,e){const n=function(t){var e,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,a=new Map,u=oD(h),l=VE("tick","end"),c=function(){let t=1;return()=>(t=(1664525*t+1013904223)%cD)/cD}();function h(){f(),l.call("tick",e),n<i&&(u.stop(),l.call("end",e))}function f(i){var u,l,c=t.length;void 0===i&&(i=1);for(var h=0;h<i;++h)for(n+=(s-n)*r,a.forEach((function(t){t(n)})),u=0;u<c;++u)null==(l=t[u]).fx?l.x+=l.vx*=o:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=o:(l.y=l.fy,l.vy=0);return e}function d(){for(var e,n=0,i=t.length;n<i;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var r=10*Math.sqrt(.5+n),s=n*dD;e.x=r*Math.cos(s),e.y=r*Math.sin(s)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function p(e){return e.initialize&&e.initialize(t,c),e}return null==t&&(t=[]),d(),e={tick:f,restart:function(){return u.restart(h),e},stop:function(){return u.stop(),e},nodes:function(n){return arguments.length?(t=n,d(),a.forEach(p),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(i=+t,e):i},alphaDecay:function(t){return arguments.length?(r=+t,e):+r},alphaTarget:function(t){return arguments.length?(s=+t,e):s},velocityDecay:function(t){return arguments.length?(o=1-t,e):1-o},randomSource:function(t){return arguments.length?(c=t,a.forEach(p),e):c},force:function(t,n){return arguments.length>1?(null==n?a.delete(t):a.set(t,p(n)),e):a.get(t)},find:function(e,n,i){var r,s,o,a,u,l=0,c=t.length;for(null==i?i=1/0:i*=i,l=0;l<c;++l)(o=(r=e-(a=t[l]).x)*r+(s=n-a.y)*s)<i&&(u=a,i=o);return u},on:function(t,n){return arguments.length>1?(l.on(t,n),e):l.on(t)}}}(t),i=n.stop,r=n.restart;let s=!1;return n.stopped=()=>s,n.restart=()=>(s=!1,r()),n.stop=()=>(s=!0,i()),AD(n,e,!0).on("end",(()=>s=!0))}(e.source,t),r.on("tick",(n=e.dataflow,i=this,()=>n.touch(i).run())),t.static||(s=!0,r.tick()),e.modifies("index")),o||s||t.modified(bD)||e.changed()&&t.restart)if(r.alpha(Math.max(r.alpha(),t.alpha||1)).alphaDecay(1-Math.pow(r.alphaMin(),1/a)),t.static)for(r.stop();--a>=0;)r.tick();else if(r.stopped()&&r.restart(),!s)return e.StopPropagation;return this.finish(t,e)},finish(t,e){const n=e.dataflow;for(let t,e=this._argops,a=0,u=e.length;a<u;++a)if(t=e[a],t.name===yD&&"link"===t.op._argval.force)for(var i,r=t.op._argops,s=0,o=r.length;s<o;++s)if("links"===r[s].name&&(i=r[s].op.source)){n.pulse(i,n.changeset().reflow());break}return e.reflow(t.modified()).modifies(xD)}}),MD.prototype=DD.prototype={constructor:MD,count:function(){return this.eachAfter(ED)},each:function(t,e){let n=-1;for(const i of this)t.call(e,i,++n,this);return this},eachAfter:function(t,e){for(var n,i,r,s=this,o=[s],a=[],u=-1;s=o.pop();)if(a.push(s),n=s.children)for(i=0,r=n.length;i<r;++i)o.push(n[i]);for(;s=a.pop();)t.call(e,s,++u,this);return this},eachBefore:function(t,e){for(var n,i,r=this,s=[r],o=-1;r=s.pop();)if(t.call(e,r,++o,this),n=r.children)for(i=n.length-1;i>=0;--i)s.push(n[i]);return this},find:function(t,e){let n=-1;for(const i of this)if(t.call(e,i,++n,this))return i},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,i=e.children,r=i&&i.length;--r>=0;)n+=i[r].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),i=e.ancestors(),r=null;for(t=n.pop(),e=i.pop();t===e;)r=t,t=n.pop(),e=i.pop();return r}(e,t),i=[e];e!==n;)e=e.parent,i.push(e);for(var r=i.length;t!==n;)i.splice(r,0,t),t=t.parent;return i},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return DD(this).eachBefore(OD)},[Symbol.iterator]:function*(){var t,e,n,i,r=this,s=[r];do{for(t=s.reverse(),s=[];r=t.pop();)if(yield r,e=r.children)for(n=0,i=e.length;n<i;++n)s.push(e[n])}while(s.length)}};var eF={depth:-1},nF={};function iF(t){return t.id}function rF(t){return t.parentId}function sF(){var t=iF,e=rF;function n(n){var i,r,s,o,a,u,l,c=Array.from(n),h=c.length,f=new Map;for(r=0;r<h;++r)i=c[r],a=c[r]=new MD(i),null!=(u=t(i,r,n))&&(u+="")&&(l=a.id=u,f.set(l,f.has(l)?nF:a)),null!=(u=e(i,r,n))&&(u+="")&&(a.parent=u);for(r=0;r<h;++r)if(u=(a=c[r]).parent){if(!(o=f.get(u)))throw new Error("missing: "+u);if(o===nF)throw new Error("ambiguous: "+u);o.children?o.children.push(a):o.children=[a],a.parent=o}else{if(s)throw new Error("multiple roots");s=a}if(!s)throw new Error("no root");if(s.parent=eF,s.eachBefore((function(t){t.depth=t.parent.depth+1,--h})).eachBefore(ND),s.parent=null,h>0)throw new Error("cycle");return s}return n.id=function(e){return arguments.length?(t=VD(e),n):t},n.parentId=function(t){return arguments.length?(e=VD(t),n):e},n}function oF(t,e){return t.parent===e.parent?1:2}function aF(t){var e=t.children;return e?e[0]:t.t}function uF(t){var e=t.children;return e?e[e.length-1]:t.t}function lF(t,e,n){var i=n/(e.i-t.i);e.c-=i,e.s+=n,t.c+=i,e.z+=n,e.m+=n}function cF(t,e,n){return t.a.parent===e.parent?t.a:n}function hF(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}function fF(t,e){return t.parent===e.parent?1:2}function dF(t,e){return t+e.x}function pF(t,e){return Math.max(t,e.y)}function gF(t,e,n,i,r){for(var s,o=t.children,a=-1,u=o.length,l=t.value&&(r-n)/t.value;++a<u;)(s=o[a]).x0=e,s.x1=i,s.y0=n,s.y1=n+=s.value*l}hF.prototype=Object.create(MD.prototype);var mF=(1+Math.sqrt(5))/2;function yF(t,e,n,i,r,s){for(var o,a,u,l,c,h,f,d,p,g,m,y=[],v=e.children,b=0,x=0,w=v.length,A=e.value;b<w;){u=r-n,l=s-i;do{c=v[x++].value}while(!c&&x<w);for(h=f=c,m=c*c*(g=Math.max(l/u,u/l)/(A*t)),p=Math.max(f/m,m/h);x<w;++x){if(c+=a=v[x].value,a<h&&(h=a),a>f&&(f=a),m=c*c*g,(d=Math.max(f/m,m/h))>p){c-=a;break}p=d}y.push(o={value:c,dice:u<l,children:v.slice(b,x)}),o.dice?tF(o,n,i,r,A?i+=l*c/A:s):gF(o,n,i,A?n+=u*c/A:r,s),A-=c,b=x}return y}const vF=function t(e){function n(t,n,i,r,s){yF(e,t,n,i,r,s)}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(mF),bF=function t(e){function n(t,n,i,r,s){if((o=t._squarify)&&o.ratio===e)for(var o,a,u,l,c,h=-1,f=o.length,d=t.value;++h<f;){for(u=(a=o[h]).children,l=a.value=0,c=u.length;l<c;++l)a.value+=u[l].value;a.dice?tF(a,n,i,r,d?i+=(s-i)*a.value/d:s):gF(a,n,i,d?n+=(r-n)*a.value/d:r,s),d-=a.value}else t._squarify=o=yF(e,t,n,i,r,s),o.ratio=e}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(mF);function xF(t,e,n){const i={};return t.each((t=>{const r=t.data;n(r)&&(i[e(r)]=t)})),t.lookup=i,t}function wF(t){Ou.call(this,null,t)}wF.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const AF=t=>t.values;function _F(){const t=[],e={entries:t=>i(n(t,0),0),key:n=>(t.push(n),e)};function n(e,i){if(i>=t.length)return e;const r=e.length,s=t[i++],o={},a={};let u,l,c,h=-1;for(;++h<r;)u=s(l=e[h])+"",(c=o[u])?c.push(l):o[u]=[l];for(u in o)a[u]=n(o[u],i);return a}function i(e,n){if(++n>t.length)return e;const r=[];for(const t in e)r.push({key:t,values:i(e[t],n)});return r}return e}function kF(t){Ou.call(this,null,t)}Nn(wF,Ou,{transform(t,e){e.source||Le("Nest transform requires an upstream data source.");var n=t.generate,i=t.modified(),r=e.clone(),s=this.value;return(!s||i||e.changed())&&(s&&s.each((t=>{t.children&&Za(t.data)&&r.rem.push(t.data)})),this.value=s=DD({values:mn(t.keys).reduce(((t,e)=>(t.key(e),t)),_F()).entries(r.source)},AF),n&&s.each((t=>{t.children&&(t=tu(t.data),r.add.push(t),r.source.push(t))})),xF(s,Ka,Ka)),r.source.root=s,r}});const CF=(t,e)=>t.parent===e.parent?1:2;Nn(kF,Ou,{transform(t,e){e.source&&e.source.root||Le(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(t.method),i=this.fields,r=e.source.root,s=t.as||i;t.field?r.sum(t.field):r.count(),t.sort&&r.sort(ru(t.sort,(t=>t.data))),function(t,e,n){for(let i,r=0,s=e.length;r<s;++r)i=e[r],i in n&&t[i](n[i])}(n,this.params,t),n.separation&&n.separation(!1!==t.separation?CF:Ve);try{this.value=n(r)}catch(t){Le(t)}return r.each((t=>function(t,e,n){const i=t.data,r=e.length-1;for(let s=0;s<r;++s)i[n[s]]=t[e[s]];i[n[r]]=t.children?t.children.length:0}(t,i,s))),e.reflow(t.modified()).modifies(s).modifies("leaf")}});const EF=["x","y","r","depth","children"];function DF(t){kF.call(this,t)}DF.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:EF.length,default:EF}]},Nn(DF,kF,{layout:function(){var t=null,e=1,n=1,i=GD;function r(r){return r.x=e/2,r.y=n/2,t?r.eachBefore(JD(t)).eachAfter(ZD(i,.5)).eachBefore(KD(1)):r.eachBefore(JD(YD)).eachAfter(ZD(GD,1)).eachAfter(ZD(i,r.r/Math.min(e,n))).eachBefore(KD(Math.min(e,n)/(2*r.r))),r}return r.radius=function(e){return arguments.length?(t=HD(e),r):t},r.size=function(t){return arguments.length?(e=+t[0],n=+t[1],r):[e,n]},r.padding=function(t){return arguments.length?(i="function"==typeof t?t:XD(+t),r):i},r},params:["radius","size","padding"],fields:EF});const FF=["x0","y0","x1","y1","depth","children"];function SF(t){kF.call(this,t)}function OF(t){Ou.call(this,null,t)}SF.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:FF.length,default:FF}]},Nn(SF,kF,{layout:function(){var t=1,e=1,n=0,i=!1;function r(r){var s=r.height+1;return r.x0=r.y0=n,r.x1=t,r.y1=e/s,r.eachBefore(function(t,e){return function(i){i.children&&tF(i,i.x0,t*(i.depth+1)/e,i.x1,t*(i.depth+2)/e);var r=i.x0,s=i.y0,o=i.x1-n,a=i.y1-n;o<r&&(r=o=(r+o)/2),a<s&&(s=a=(s+a)/2),i.x0=r,i.y0=s,i.x1=o,i.y1=a}}(e,s)),i&&r.eachBefore(QD),r}return r.round=function(t){return arguments.length?(i=!!t,r):i},r.size=function(n){return arguments.length?(t=+n[0],e=+n[1],r):[t,e]},r.padding=function(t){return arguments.length?(n=+t,r):n},r},params:["size","round","padding"],fields:FF}),OF.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},Nn(OF,Ou,{transform(t,e){e.source||Le("Stratify transform requires an upstream data source.");let n=this.value;const i=t.modified(),r=e.fork(e.ALL).materialize(e.SOURCE),s=!n||i||e.changed(e.ADD_REM)||e.modified(t.key.fields)||e.modified(t.parentKey.fields);return r.source=r.source.slice(),s&&(n=r.source.length?xF(sF().id(t.key).parentId(t.parentKey)(r.source),t.key,Ge):xF(sF()([{}]),t.key,t.key)),r.source.root=this.value=n,r}});const NF={tidy:function(){var t=oF,e=1,n=1,i=null;function r(r){var u=function(t){for(var e,n,i,r,s,o=new hF(t,0),a=[o];e=a.pop();)if(i=e._.children)for(e.children=new Array(s=i.length),r=s-1;r>=0;--r)a.push(n=e.children[r]=new hF(i[r],r)),n.parent=e;return(o.parent=new hF(null,0)).children=[o],o}(r);if(u.eachAfter(s),u.parent.m=-u.z,u.eachBefore(o),i)r.eachBefore(a);else{var l=r,c=r,h=r;r.eachBefore((function(t){t.x<l.x&&(l=t),t.x>c.x&&(c=t),t.depth>h.depth&&(h=t)}));var f=l===c?1:t(l,c)/2,d=f-l.x,p=e/(c.x+f+d),g=n/(h.depth||1);r.eachBefore((function(t){t.x=(t.x+d)*p,t.y=t.depth*g}))}return r}function s(e){var n=e.children,i=e.parent.children,r=e.i?i[e.i-1]:null;if(n){!function(t){for(var e,n=0,i=0,r=t.children,s=r.length;--s>=0;)(e=r[s]).z+=n,e.m+=n,n+=e.s+(i+=e.c)}(e);var s=(n[0].z+n[n.length-1].z)/2;r?(e.z=r.z+t(e._,r._),e.m=e.z-s):e.z=s}else r&&(e.z=r.z+t(e._,r._));e.parent.A=function(e,n,i){if(n){for(var r,s=e,o=e,a=n,u=s.parent.children[0],l=s.m,c=o.m,h=a.m,f=u.m;a=uF(a),s=aF(s),a&&s;)u=aF(u),(o=uF(o)).a=e,(r=a.z+h-s.z-l+t(a._,s._))>0&&(lF(cF(a,e,i),e,r),l+=r,c+=r),h+=a.m,l+=s.m,f+=u.m,c+=o.m;a&&!uF(o)&&(o.t=a,o.m+=h-c),s&&!aF(u)&&(u.t=s,u.m+=l-f,i=e)}return i}(e,r,e.parent.A||i[0])}function o(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function a(t){t.x*=e,t.y=t.depth*n}return r.separation=function(e){return arguments.length?(t=e,r):t},r.size=function(t){return arguments.length?(i=!1,e=+t[0],n=+t[1],r):i?null:[e,n]},r.nodeSize=function(t){return arguments.length?(i=!0,e=+t[0],n=+t[1],r):i?[e,n]:null},r},cluster:function(){var t=fF,e=1,n=1,i=!1;function r(r){var s,o=0;r.eachAfter((function(e){var n=e.children;n?(e.x=function(t){return t.reduce(dF,0)/t.length}(n),e.y=function(t){return 1+t.reduce(pF,0)}(n)):(e.x=s?o+=t(e,s):0,e.y=0,s=e)}));var a=function(t){for(var e;e=t.children;)t=e[0];return t}(r),u=function(t){for(var e;e=t.children;)t=e[e.length-1];return t}(r),l=a.x-t(a,u)/2,c=u.x+t(u,a)/2;return r.eachAfter(i?function(t){t.x=(t.x-r.x)*e,t.y=(r.y-t.y)*n}:function(t){t.x=(t.x-l)/(c-l)*e,t.y=(1-(r.y?t.y/r.y:1))*n})}return r.separation=function(e){return arguments.length?(t=e,r):t},r.size=function(t){return arguments.length?(i=!1,e=+t[0],n=+t[1],r):i?null:[e,n]},r.nodeSize=function(t){return arguments.length?(i=!0,e=+t[0],n=+t[1],r):i?[e,n]:null},r}},MF=["x","y","depth","children"];function zF(t){kF.call(this,t)}function $F(t){Ou.call(this,[],t)}zF.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:MF.length,default:MF}]},Nn(zF,kF,{layout(t){const e=t||"tidy";if(Fn(NF,e))return NF[e]();Le("Unrecognized Tree layout method: "+e)},params:["size","nodeSize"],fields:MF}),$F.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},Nn($F,Ou,{transform(t,e){const n=this.value,i=e.source&&e.source.root,r=e.fork(e.NO_SOURCE),s={};return i||Le("TreeLinks transform requires a tree data source."),e.changed(e.ADD_REM)?(r.rem=n,e.visit(e.SOURCE,(t=>s[Ka(t)]=1)),i.each((t=>{const e=t.data,n=t.parent&&t.parent.data;n&&s[Ka(e)]&&s[Ka(n)]&&r.add.push(tu({source:n,target:e}))})),this.value=r.add):e.changed(e.MOD)&&(e.visit(e.MOD,(t=>s[Ka(t)]=1)),n.forEach((t=>{(s[Ka(t.source)]||s[Ka(t.target)])&&r.mod.push(t)}))),r}});const TF={binary:function(t,e,n,i,r){var s,o,a=t.children,u=a.length,l=new Array(u+1);for(l[0]=o=s=0;s<u;++s)l[s+1]=o+=a[s].value;!function t(e,n,i,r,s,o,u){if(e>=n-1){var c=a[e];return c.x0=r,c.y0=s,c.x1=o,void(c.y1=u)}for(var h=l[e],f=i/2+h,d=e+1,p=n-1;d<p;){var g=d+p>>>1;l[g]<f?d=g+1:p=g}f-l[d-1]<l[d]-f&&e+1<d&&--d;var m=l[d]-h,y=i-m;if(o-r>u-s){var v=i?(r*y+o*m)/i:o;t(e,d,m,r,s,v,u),t(d,n,y,v,s,o,u)}else{var b=i?(s*y+u*m)/i:u;t(e,d,m,r,s,o,b),t(d,n,y,r,b,o,u)}}(0,u,t.value,e,n,i,r)},dice:tF,slice:gF,slicedice:function(t,e,n,i,r){(1&t.depth?gF:tF)(t,e,n,i,r)},squarify:vF,resquarify:bF},BF=["x0","y0","x1","y1","depth","children"];function jF(t){kF.call(this,t)}function IF(t,e,n,i){const r=t.width,s=t.height,o=n||i,a=_f(r,s).getContext("2d");e.forEach((t=>RF(a,t,o)));const u=new Uint32Array(a.getImageData(0,0,r,s).data.buffer),l=t.bitmap(),c=o&&t.bitmap();let h,f,d,p,g;for(f=0;f<s;++f)for(h=0;h<r;++h)g=4278190080&u[f*r+h],g&&(d=t(h),p=t(f),i||l.set(d,p),o&&268435456^g&&c.set(d,p));return[l,c]}function RF(t,e,n){if(!e.length)return;const i=e[0].mark.marktype;"group"===i?e.forEach((e=>{e.items.forEach((e=>RF(t,e.items,n)))})):Cb[i].draw(t,{items:n?e.map(LF):e})}function LF(t){const e=nu(t,{});return e.stroke&&(e.strokeOpacity=1),e.fill&&(e.fillOpacity=.0625,e.stroke="#000",e.strokeOpacity=1,e.strokeWidth=2),e}jF.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:BF.length,default:BF}]},Nn(jF,kF,{layout(){const t=function(){var t=vF,e=!1,n=1,i=1,r=[0],s=GD,o=GD,a=GD,u=GD,l=GD;function c(t){return t.x0=t.y0=0,t.x1=n,t.y1=i,t.eachBefore(h),r=[0],e&&t.eachBefore(QD),t}function h(e){var n=r[e.depth],i=e.x0+n,c=e.y0+n,h=e.x1-n,f=e.y1-n;h<i&&(i=h=(i+h)/2),f<c&&(c=f=(c+f)/2),e.x0=i,e.y0=c,e.x1=h,e.y1=f,e.children&&(n=r[e.depth+1]=s(e)/2,i+=l(e)-n,c+=o(e)-n,(h-=a(e)-n)<i&&(i=h=(i+h)/2),(f-=u(e)-n)<c&&(c=f=(c+f)/2),t(e,i,c,h,f))}return c.round=function(t){return arguments.length?(e=!!t,c):e},c.size=function(t){return arguments.length?(n=+t[0],i=+t[1],c):[n,i]},c.tile=function(e){return arguments.length?(t=VD(e),c):t},c.padding=function(t){return arguments.length?c.paddingInner(t).paddingOuter(t):c.paddingInner()},c.paddingInner=function(t){return arguments.length?(s="function"==typeof t?t:XD(+t),c):s},c.paddingOuter=function(t){return arguments.length?c.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):c.paddingTop()},c.paddingTop=function(t){return arguments.length?(o="function"==typeof t?t:XD(+t),c):o},c.paddingRight=function(t){return arguments.length?(a="function"==typeof t?t:XD(+t),c):a},c.paddingBottom=function(t){return arguments.length?(u="function"==typeof t?t:XD(+t),c):u},c.paddingLeft=function(t){return arguments.length?(l="function"==typeof t?t:XD(+t),c):l},c}();return t.ratio=e=>{const n=t.tile();n.ratio&&t.tile(n.ratio(e))},t.method=e=>{Fn(TF,e)?t.tile(TF[e]):Le("Unrecognized Treemap layout method: "+e)},t},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:BF});const PF=31,UF=new Uint32Array(33),qF=new Uint32Array(33);qF[0]=0,UF[0]=~qF[0];for(let t=1;t<=32;++t)qF[t]=qF[t-1]<<1|1,UF[t]=~qF[t];function WF(t,e,n,i,r,s){let o=n/2;return t-o<0||t+o>r||e-(o=i/2)<0||e+o>s}function HF(t,e,n,i,r,s,o,a){const u=r*s/(2*i),l=t(e-u),c=t(e+u),h=t(n-(s/=2)),f=t(n+s);return o.outOfBounds(l,h,c,f)||o.getRange(l,h,c,f)||a&&a.getRange(l,h,c,f)}const VF=[-1,-1,1,1],GF=[-1,1,-1,1],XF=["right","center","left"],YF=["bottom","middle","top"];function JF(t,e,n,i,r,s,o,a,u,l,c,h){return!(r.outOfBounds(t,n,e,i)||(h&&s?s.getRange(t,n,e,i)||!function(t,e,n,i,r){return r[0]<=t&&n<=r[2]&&r[3]<=e&&i<=r[5]}(o,u,a,l,c):r.getRange(t,n,e,i)))}const ZF={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},KF={naive:function(t,e,n,i){const r=t.width,s=t.height;return function(t){const e=t.datum.datum.items[i].items,n=e.length,o=t.datum.fontSize,a=ab.width(t.datum,t.datum.text);let u,l,c,h,f,d,p,g=0;for(let i=0;i<n;++i)u=e[i].x,c=e[i].y,l=void 0===e[i].x2?u:e[i].x2,h=void 0===e[i].y2?c:e[i].y2,f=(u+l)/2,d=(c+h)/2,p=Math.abs(l-u+h-c),p>=g&&(g=p,t.x=f,t.y=d);return f=a/2,d=o/2,u=t.x-f,l=t.x+f,c=t.y-d,h=t.y+d,t.align="center",u<0&&l<=r?t.align="left":0<=u&&r<l&&(t.align="right"),t.baseline="middle",c<0&&h<=s?t.baseline="top":0<=c&&s<h&&(t.baseline="bottom"),!0}},"reduced-search":function(t,e,n,i){const r=t.width,s=t.height,o=e[0],a=e[1];function u(e,n,i,u,l){const c=t.invert(e),h=t.invert(n);let f,d=i,p=s;if(!WF(c,h,u,l,r,s)&&!HF(t,c,h,l,u,d,o,a)&&!HF(t,c,h,l,u,l,o,null)){for(;p-d>=1;)f=(d+p)/2,HF(t,c,h,l,u,f,o,a)?p=f:d=f;if(d>i)return[c,h,d,!0]}}return function(e){const a=e.datum.datum.items[i].items,l=a.length,c=e.datum.fontSize,h=ab.width(e.datum,e.datum.text);let f,d,p,g,m,y,v,b,x,w,A,_,k,C,E,D,F,S=n?c:0,O=!1,N=!1,M=0;for(let i=0;i<l;++i){for(f=a[i].x,p=a[i].y,d=void 0===a[i].x2?f:a[i].x2,g=void 0===a[i].y2?p:a[i].y2,f>d&&(F=f,f=d,d=F),p>g&&(F=p,p=g,g=F),x=t(f),A=t(d),w=~~((x+A)/2),_=t(p),C=t(g),k=~~((_+C)/2),v=w;v>=x;--v)for(b=k;b>=_;--b)D=u(v,b,S,h,c),D&&([e.x,e.y,S,O]=D);for(v=w;v<=A;++v)for(b=k;b<=C;++b)D=u(v,b,S,h,c),D&&([e.x,e.y,S,O]=D);O||n||(E=Math.abs(d-f+g-p),m=(f+d)/2,y=(p+g)/2,E>=M&&!WF(m,y,h,c,r,s)&&!HF(t,m,y,c,h,c,o,null)&&(M=E,e.x=m,e.y=y,N=!0))}return!(!O&&!N||(m=h/2,y=c/2,o.setRange(t(e.x-m),t(e.y-y),t(e.x+m),t(e.y+y)),e.align="center",e.baseline="middle",0))}},floodfill:function(t,e,n,i){const r=t.width,s=t.height,o=e[0],a=e[1],u=t.bitmap();return function(e){const l=e.datum.datum.items[i].items,c=l.length,h=e.datum.fontSize,f=ab.width(e.datum,e.datum.text),d=[];let p,g,m,y,v,b,x,w,A,_,k,C,E=n?h:0,D=!1,F=!1,S=0;for(let i=0;i<c;++i){for(p=l[i].x,m=l[i].y,g=void 0===l[i].x2?p:l[i].x2,y=void 0===l[i].y2?m:l[i].y2,d.push([t((p+g)/2),t((m+y)/2)]);d.length;)if([x,w]=d.pop(),!(o.get(x,w)||a.get(x,w)||u.get(x,w))){u.set(x,w);for(let t=0;t<4;++t)v=x+VF[t],b=w+GF[t],u.outOfBounds(v,b,v,b)||d.push([v,b]);if(v=t.invert(x),b=t.invert(w),A=E,_=s,!WF(v,b,f,h,r,s)&&!HF(t,v,b,h,f,A,o,a)&&!HF(t,v,b,h,f,h,o,null)){for(;_-A>=1;)k=(A+_)/2,HF(t,v,b,h,f,k,o,a)?_=k:A=k;A>E&&(e.x=v,e.y=b,E=A,D=!0)}}D||n||(C=Math.abs(g-p+y-m),v=(p+g)/2,b=(m+y)/2,C>=S&&!WF(v,b,f,h,r,s)&&!HF(t,v,b,h,f,h,o,null)&&(S=C,e.x=v,e.y=b,F=!0))}return!(!D&&!F||(v=f/2,b=h/2,o.setRange(t(e.x-v),t(e.y-b),t(e.x+v),t(e.y+b)),e.align="center",e.baseline="middle",0))}}};function QF(t,e,n,i,r,s,o,a,u,l,c){if(!t.length)return t;const h=Math.max(i.length,r.length),f=function(t,e){const n=new Float64Array(e),i=t.length;for(let e=0;e<i;++e)n[e]=t[e]||0;for(let t=i;t<e;++t)n[t]=n[i-1];return n}(i,h),d=function(t,e){const n=new Int8Array(e),i=t.length;for(let e=0;e<i;++e)n[e]|=ZF[t[e]];for(let t=i;t<e;++t)n[t]=n[i-1];return n}(r,h),p=(x=t[0].datum)&&x.mark&&x.mark.marktype,g="group"===p&&t[0].datum.items[u].marktype,m="area"===g,y=function(t,e,n,i){const r=t=>[t.x,t.x,t.x,t.y,t.y,t.y];return t?"line"===t||"area"===t?t=>r(t.datum):"line"===e?t=>{const e=t.datum.items[i].items;return r(e.length?e["start"===n?0:e.length-1]:{x:NaN,y:NaN})}:t=>{const e=t.datum.bounds;return[e.x1,(e.x1+e.x2)/2,e.x2,e.y1,(e.y1+e.y2)/2,e.y2]}:r}(p,g,a,u),v=function(t,e,n){const i=Math.max(1,Math.sqrt(t*e/1e6)),r=~~((t+2*n+i)/i),s=~~((e+2*n+i)/i),o=t=>~~((t+n)/i);return o.invert=t=>t*i-n,o.bitmap=()=>function(t,e){const n=new Uint32Array(~~((t*e+32)/32));function i(t,e){n[t]|=e}function r(t,e){n[t]&=e}return{array:n,get:(e,i)=>{const r=i*t+e;return n[r>>>5]&1<<(r&PF)},set:(e,n)=>{const r=n*t+e;i(r>>>5,1<<(r&PF))},clear:(e,n)=>{const i=n*t+e;r(i>>>5,~(1<<(i&PF)))},getRange:(e,i,r,s)=>{let o,a,u,l,c=s;for(;c>=i;--c)if(o=c*t+e,a=c*t+r,u=o>>>5,l=a>>>5,u===l){if(n[u]&UF[o&PF]&qF[1+(a&PF)])return!0}else{if(n[u]&UF[o&PF])return!0;if(n[l]&qF[1+(a&PF)])return!0;for(let t=u+1;t<l;++t)if(n[t])return!0}return!1},setRange:(e,n,r,s)=>{let o,a,u,l,c;for(;n<=s;++n)if(o=n*t+e,a=n*t+r,u=o>>>5,l=a>>>5,u===l)i(u,UF[o&PF]&qF[1+(a&PF)]);else for(i(u,UF[o&PF]),i(l,qF[1+(a&PF)]),c=u+1;c<l;++c)i(c,4294967295)},clearRange:(e,n,i,s)=>{let o,a,u,l,c;for(;n<=s;++n)if(o=n*t+e,a=n*t+i,u=o>>>5,l=a>>>5,u===l)r(u,qF[o&PF]|UF[1+(a&PF)]);else for(r(u,qF[o&PF]),r(l,UF[1+(a&PF)]),c=u+1;c<l;++c)r(c,0)},outOfBounds:(n,i,r,s)=>n<0||i<0||s>=e||r>=t}}(r,s),o.ratio=i,o.padding=n,o.width=t,o.height=e,o}(e[0],e[1],l),b=m&&"naive"===c;var x;const w=t.map((t=>({datum:t,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(t)})));let A;if(!b){n&&w.sort(((t,e)=>n(t.datum,e.datum)));let e=!1;for(let t=0;t<d.length&&!e;++t)e=5===d[t]||f[t]<0;p&&(o||m)&&(s=[t.map((t=>t.datum))].concat(s)),A=s.length?IF(v,s,e,m):function(t,e){const n=t.bitmap();return(e||[]).forEach((e=>n.set(t(e.boundary[0]),t(e.boundary[3])))),[n,void 0]}(v,o&&w)}const _=m?KF[c](v,A,o,u):function(t,e,n,i){const r=t.width,s=t.height,o=e[0],a=e[1],u=i.length;return function(e){const l=e.boundary,c=e.datum.fontSize;if(l[2]<0||l[5]<0||l[0]>r||l[3]>s)return!1;let h,f,d,p,g,m,y,v,b,x,w,A,_,k,C,E=0;for(let r=0;r<u;++r){if(h=(3&n[r])-1,f=(n[r]>>>2&3)-1,d=0===h&&0===f||i[r]<0,p=h&&f?Math.SQRT1_2:1,g=i[r]<0?-1:1,m=l[1+h]+i[r]*h*p,w=l[4+f]+g*c*f/2+i[r]*f*p,v=w-c/2,b=w+c/2,A=t(m),k=t(v),C=t(b),!E){if(!JF(A,A,k,C,o,a,m,m,v,b,l,d))continue;E=ab.width(e.datum,e.datum.text)}if(x=m+g*E*h/2,m=x-E/2,y=x+E/2,A=t(m),_=t(y),JF(A,_,k,C,o,a,m,y,v,b,l,d))return e.x=h?h*g<0?y:m:x,e.y=f?f*g<0?b:v:w,e.align=XF[h*g+1],e.baseline=YF[f*g+1],o.setRange(A,k,_,C),!0}return!1}}(v,A,d,f);return w.forEach((t=>t.opacity=+_(t))),w}const tS=["x","y","opacity","align","baseline"],eS=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function nS(t){Ou.call(this,null,t)}function iS(t,e){var n,i,r,s,o,a,u=[],l=function(t){return t(s)};if(null==e)u.push(t);else for(n={},i=0,r=t.length;i<r;++i)s=t[i],(a=n[o=e.map(l)])||(n[o]=a=[],a.dims=o,u.push(a)),a.push(s);return u}function rS(t){Ou.call(this,null,t)}nS.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:eS},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:tS.length,default:tS}]},Nn(nS,Ou,{transform(t,e){const n=t.modified();if(!(n||e.changed(e.ADD_REM)||function(n){const i=t.sort;return yn(i)&&e.modified(i.fields)}()))return;t.size&&2===t.size.length||Le("Size parameter should be specified as a [width, height] array.");const i=t.as||tS;return QF(e.materialize(e.SOURCE).source,t.size,t.sort,mn(t.offset||1),mn(t.anchor||eS),t.avoidMarks||[],!1!==t.avoidBaseMark,t.lineAnchor||"end",t.markIndex||0,t.padding||0,t.method||"naive").forEach((t=>{const e=t.datum;e[i[0]]=t.x,e[i[1]]=t.y,e[i[2]]=t.opacity,e[i[3]]=t.align,e[i[4]]=t.baseline})),e.reflow(n).modifies(i)}}),rS.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},Nn(rS,Ou,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=iS(e.materialize(e.SOURCE).source,t.groupby),r=(t.groupby||[]).map(Te),s=r.length,o=t.as||[Te(t.x),Te(t.y)],a=[];i.forEach((e=>{Ol(e,t.x,t.y,t.bandwidth||.3).forEach((t=>{const n={};for(let t=0;t<s;++t)n[r[t]]=e.dims[t];n[o[0]]=t[0],n[o[1]]=t[1],a.push(tu(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=a}return n}});const sS={linear:_l,log:kl,exp:Cl,pow:El,quad:Dl,poly:Fl};function oS(t){Ou.call(this,null,t)}oS.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(sS)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},Nn(oS,Ou,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=iS(e.materialize(e.SOURCE).source,t.groupby),r=(t.groupby||[]).map(Te),s=t.method||"linear",o=t.order||3,a=((t,e)=>"poly"===t?e:"quad"===t?2:1)(s,o),u=t.as||[Te(t.x),Te(t.y)],l=sS[s],c=[];let h=t.extent;Fn(sS,s)||Le("Invalid regression method: "+s),null!=h&&"log"===s&&h[0]<=0&&(e.dataflow.warn("Ignoring extent with values <= 0 for log regression."),h=null),i.forEach((n=>{if(n.length<=a)return void e.dataflow.warn("Skipping regression with more parameters than data points.");const i=l(n,t.x,t.y,o);if(t.params)return void c.push(tu({keys:n.dims,coef:i.coef,rSquared:i.rSquared}));const f=h||En(n,t.x),d=t=>{const e={};for(let t=0;t<r.length;++t)e[r[t]]=n.dims[t];e[u[0]]=t[0],e[u[1]]=t[1],c.push(tu(e))};"linear"===s?f.forEach((t=>d([t,i.predict(t)]))):$l(i.predict,f,25,200).forEach(d)})),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});const aS=Math.pow(2,-52),uS=new Uint32Array(512);class lS{static from(t,e=yS,n=vS){const i=t.length,r=new Float64Array(2*i);for(let s=0;s<i;s++){const i=t[s];r[2*s]=e(i),r[2*s+1]=n(i)}return new lS(r)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:i,_hullHash:r}=this,s=t.length>>1;let o=1/0,a=1/0,u=-1/0,l=-1/0;for(let e=0;e<s;e++){const n=t[2*e],i=t[2*e+1];n<o&&(o=n),i<a&&(a=i),n>u&&(u=n),i>l&&(l=i),this._ids[e]=e}const c=(o+u)/2,h=(a+l)/2;let f,d,p,g=1/0;for(let e=0;e<s;e++){const n=cS(c,h,t[2*e],t[2*e+1]);n<g&&(f=e,g=n)}const m=t[2*f],y=t[2*f+1];g=1/0;for(let e=0;e<s;e++){if(e===f)continue;const n=cS(m,y,t[2*e],t[2*e+1]);n<g&&n>0&&(d=e,g=n)}let v=t[2*d],b=t[2*d+1],x=1/0;for(let e=0;e<s;e++){if(e===f||e===d)continue;const n=pS(m,y,v,b,t[2*e],t[2*e+1]);n<x&&(p=e,x=n)}let w=t[2*p],A=t[2*p+1];if(x===1/0){for(let e=0;e<s;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];gS(this._ids,this._dists,0,s-1);const e=new Uint32Array(s);let n=0;for(let t=0,i=-1/0;t<s;t++){const r=this._ids[t];this._dists[r]>i&&(e[n++]=r,i=this._dists[r])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(fS(m,y,v,b,w,A)){const t=d,e=v,n=b;d=p,v=w,b=A,p=t,w=e,A=n}const _=function(t,e,n,i,r,s){const o=n-t,a=i-e,u=r-t,l=s-e,c=o*o+a*a,h=u*u+l*l,f=.5/(o*l-a*u);return{x:t+(l*c-a*h)*f,y:e+(o*h-u*c)*f}}(m,y,v,b,w,A);this._cx=_.x,this._cy=_.y;for(let e=0;e<s;e++)this._dists[e]=cS(t[2*e],t[2*e+1],_.x,_.y);gS(this._ids,this._dists,0,s-1),this._hullStart=f;let k=3;n[f]=e[p]=d,n[d]=e[f]=p,n[p]=e[d]=f,i[f]=0,i[d]=1,i[p]=2,r.fill(-1),r[this._hashKey(m,y)]=f,r[this._hashKey(v,b)]=d,r[this._hashKey(w,A)]=p,this.trianglesLen=0,this._addTriangle(f,d,p,-1,-1,-1);for(let s,o,a=0;a<this._ids.length;a++){const u=this._ids[a],l=t[2*u],c=t[2*u+1];if(a>0&&Math.abs(l-s)<=aS&&Math.abs(c-o)<=aS)continue;if(s=l,o=c,u===f||u===d||u===p)continue;let h=0;for(let t=0,e=this._hashKey(l,c);t<this._hashSize&&(h=r[(e+t)%this._hashSize],-1===h||h===n[h]);t++);h=e[h];let g,m=h;for(;g=n[m],!fS(l,c,t[2*m],t[2*m+1],t[2*g],t[2*g+1]);)if(m=g,m===h){m=-1;break}if(-1===m)continue;let y=this._addTriangle(m,u,n[m],-1,-1,i[m]);i[u]=this._legalize(y+2),i[m]=y,k++;let v=n[m];for(;g=n[v],fS(l,c,t[2*v],t[2*v+1],t[2*g],t[2*g+1]);)y=this._addTriangle(v,u,g,i[u],-1,i[v]),i[u]=this._legalize(y+2),n[v]=v,k--,v=g;if(m===h)for(;g=e[m],fS(l,c,t[2*g],t[2*g+1],t[2*m],t[2*m+1]);)y=this._addTriangle(g,u,m,-1,i[m],i[g]),this._legalize(y+2),i[g]=y,n[m]=m,k--,m=g;this._hullStart=e[u]=m,n[m]=e[v]=u,n[u]=v,r[this._hashKey(l,c)]=u,r[this._hashKey(t[2*m],t[2*m+1])]=m}this.hull=new Uint32Array(k);for(let t=0,e=this._hullStart;t<k;t++)this.hull[t]=e,e=n[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:i}=this;let r=0,s=0;for(;;){const o=n[t],a=t-t%3;if(s=a+(t+2)%3,-1===o){if(0===r)break;t=uS[--r];continue}const u=o-o%3,l=a+(t+1)%3,c=u+(o+2)%3,h=e[s],f=e[t],d=e[l],p=e[c];if(dS(i[2*h],i[2*h+1],i[2*f],i[2*f+1],i[2*d],i[2*d+1],i[2*p],i[2*p+1])){e[t]=p,e[o]=h;const i=n[c];if(-1===i){let e=this._hullStart;do{if(this._hullTri[e]===c){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,i),this._link(o,n[s]),this._link(s,c);const a=u+(o+1)%3;r<uS.length&&(uS[r++]=a)}else{if(0===r)break;t=uS[--r]}}return s}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,i,r,s){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=e,this._triangles[o+2]=n,this._link(o,i),this._link(o+1,r),this._link(o+2,s),this.trianglesLen+=3,o}}function cS(t,e,n,i){const r=t-n,s=e-i;return r*r+s*s}function hS(t,e,n,i,r,s){const o=(i-e)*(r-t),a=(n-t)*(s-e);return Math.abs(o-a)>=33306690738754716e-32*Math.abs(o+a)?o-a:0}function fS(t,e,n,i,r,s){return(hS(r,s,t,e,n,i)||hS(t,e,n,i,r,s)||hS(n,i,r,s,t,e))<0}function dS(t,e,n,i,r,s,o,a){const u=t-o,l=e-a,c=n-o,h=i-a,f=r-o,d=s-a,p=c*c+h*h,g=f*f+d*d;return u*(h*g-p*d)-l*(c*g-p*f)+(u*u+l*l)*(c*d-h*f)<0}function pS(t,e,n,i,r,s){const o=n-t,a=i-e,u=r-t,l=s-e,c=o*o+a*a,h=u*u+l*l,f=.5/(o*l-a*u),d=(l*c-a*h)*f,p=(o*h-u*c)*f;return d*d+p*p}function gS(t,e,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const i=t[r],s=e[i];let o=r-1;for(;o>=n&&e[t[o]]>s;)t[o+1]=t[o--];t[o+1]=i}else{let r=n+1,s=i;mS(t,n+i>>1,r),e[t[n]]>e[t[i]]&&mS(t,n,i),e[t[r]]>e[t[i]]&&mS(t,r,i),e[t[n]]>e[t[r]]&&mS(t,n,r);const o=t[r],a=e[o];for(;;){do{r++}while(e[t[r]]<a);do{s--}while(e[t[s]]>a);if(s<r)break;mS(t,r,s)}t[n+1]=t[s],t[s]=o,i-r+1>=s-n?(gS(t,e,r,i),gS(t,e,n,s-1)):(gS(t,e,n,s-1),gS(t,e,r,i))}}function mS(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function yS(t){return t[0]}function vS(t){return t[1]}const bS=1e-6;class xS{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,n){const i=(t=+t)+(n=+n),r=e=+e;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${i},${r}`:(Math.abs(this._x1-i)>bS||Math.abs(this._y1-r)>bS)&&(this._+="L"+i+","+r),n&&(this._+=`A${n},${n},0,1,1,${t-n},${e}A${n},${n},0,1,1,${this._x1=i},${this._y1=r}`)}rect(t,e,n,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+n}v${+i}h${-n}Z`}value(){return this._||null}}class wS{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class AS{constructor(t,[e,n,i,r]=[0,0,960,500]){if(!((i=+i)>=(e=+e)&&(r=+r)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=i,this.xmin=e,this.ymax=r,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:n},vectors:i}=this,r=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let e,i,s=0,o=0,a=n.length;s<a;s+=3,o+=2){const a=2*n[s],u=2*n[s+1],l=2*n[s+2],c=t[a],h=t[a+1],f=t[u],d=t[u+1],p=t[l],g=t[l+1],m=f-c,y=d-h,v=p-c,b=g-h,x=m*m+y*y,w=v*v+b*b,A=2*(m*b-y*v);if(A)if(Math.abs(A)<1e-8)e=(c+p)/2,i=(h+g)/2;else{const t=1/A;e=c+(b*x-y*w)*t,i=h+(m*w-v*x)*t}else e=(c+p)/2-1e8*b,i=(h+g)/2+1e8*v;r[o]=e,r[o+1]=i}let s,o,a,u=e[e.length-1],l=4*u,c=t[2*u],h=t[2*u+1];i.fill(0);for(let n=0;n<e.length;++n)u=e[n],s=l,o=c,a=h,l=4*u,c=t[2*u],h=t[2*u+1],i[s+2]=i[l]=a-h,i[s+3]=i[l+1]=c-o}render(t){const e=null==t?t=new xS:void 0,{delaunay:{halfedges:n,inedges:i,hull:r},circumcenters:s,vectors:o}=this;if(r.length<=1)return null;for(let e=0,i=n.length;e<i;++e){const i=n[e];if(i<e)continue;const r=2*Math.floor(e/3),o=2*Math.floor(i/3),a=s[r],u=s[r+1],l=s[o],c=s[o+1];this._renderSegment(a,u,l,c,t)}let a,u=r[r.length-1];for(let e=0;e<r.length;++e){a=u,u=r[e];const n=2*Math.floor(i[u]/3),l=s[n],c=s[n+1],h=4*a,f=this._project(l,c,o[h+2],o[h+3]);f&&this._renderSegment(l,c,f[0],f[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new xS:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const n=null==e?e=new xS:void 0,i=this._clip(t);if(null===i||!i.length)return;e.moveTo(i[0],i[1]);let r=i.length;for(;i[0]===i[r-2]&&i[1]===i[r-1]&&r>1;)r-=2;for(let t=2;t<r;t+=2)i[t]===i[t-2]&&i[t+1]===i[t-1]||e.lineTo(i[t],i[t+1]);return e.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new wS;return this.renderCell(t,e),e.value()}_renderSegment(t,e,n,i,r){let s;const o=this._regioncode(t,e),a=this._regioncode(n,i);0===o&&0===a?(r.moveTo(t,e),r.lineTo(n,i)):(s=this._clipSegment(t,e,n,i,o,a))&&(r.moveTo(s[0],s[1]),r.lineTo(s[2],s[3]))}contains(t,e,n){return(e=+e)==e&&(n=+n)==n&&this.delaunay._step(t,e,n)===t}*neighbors(t){const e=this._clip(t);if(e)for(const n of this.delaunay.neighbors(t)){const t=this._clip(n);if(t)t:for(let i=0,r=e.length;i<r;i+=2)for(let s=0,o=t.length;s<o;s+=2)if(e[i]==t[s]&&e[i+1]==t[s+1]&&e[(i+2)%r]==t[(s+o-2)%o]&&e[(i+3)%r]==t[(s+o-1)%o]){yield n;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:n,halfedges:i,triangles:r}}=this,s=n[t];if(-1===s)return null;const o=[];let a=s;do{const n=Math.floor(a/3);if(o.push(e[2*n],e[2*n+1]),a=a%3==2?a-2:a+1,r[a]!==t)break;a=i[a]}while(a!==s&&-1!==a);return o}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:n}=this,i=4*t;return n[i]||n[i+1]?this._clipInfinite(t,e,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(t,e)}_clipFinite(t,e){const n=e.length;let i,r,s,o,a,u=null,l=e[n-2],c=e[n-1],h=this._regioncode(l,c);for(let f=0;f<n;f+=2)if(i=l,r=c,l=e[f],c=e[f+1],s=h,h=this._regioncode(l,c),0===s&&0===h)o=a,a=0,u?u.push(l,c):u=[l,c];else{let e,n,f,d,p;if(0===s){if(null===(e=this._clipSegment(i,r,l,c,s,h)))continue;[n,f,d,p]=e}else{if(null===(e=this._clipSegment(l,c,i,r,h,s)))continue;[d,p,n,f]=e,o=a,a=this._edgecode(n,f),o&&a&&this._edge(t,o,a,u,u.length),u?u.push(n,f):u=[n,f]}o=a,a=this._edgecode(d,p),o&&a&&this._edge(t,o,a,u,u.length),u?u.push(d,p):u=[d,p]}if(u)o=a,a=this._edgecode(u[0],u[1]),o&&a&&this._edge(t,o,a,u,u.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return u}_clipSegment(t,e,n,i,r,s){for(;;){if(0===r&&0===s)return[t,e,n,i];if(r&s)return null;let o,a,u=r||s;8&u?(o=t+(n-t)*(this.ymax-e)/(i-e),a=this.ymax):4&u?(o=t+(n-t)*(this.ymin-e)/(i-e),a=this.ymin):2&u?(a=e+(i-e)*(this.xmax-t)/(n-t),o=this.xmax):(a=e+(i-e)*(this.xmin-t)/(n-t),o=this.xmin),r?(t=o,e=a,r=this._regioncode(t,e)):(n=o,i=a,s=this._regioncode(n,i))}}_clipInfinite(t,e,n,i,r,s){let o,a=Array.from(e);if((o=this._project(a[0],a[1],n,i))&&a.unshift(o[0],o[1]),(o=this._project(a[a.length-2],a[a.length-1],r,s))&&a.push(o[0],o[1]),a=this._clipFinite(t,a))for(let e,n=0,i=a.length,r=this._edgecode(a[i-2],a[i-1]);n<i;n+=2)e=r,r=this._edgecode(a[n],a[n+1]),e&&r&&(n=this._edge(t,e,r,a,n),i=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,e,n,i,r){for(;e!==n;){let n,s;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,s=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,s=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,s=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,s=this.ymin}i[r]===n&&i[r+1]===s||!this.contains(t,n,s)||(i.splice(r,0,n,s),r+=2)}if(i.length>4)for(let t=0;t<i.length;t+=2){const e=(t+2)%i.length,n=(t+4)%i.length;(i[t]===i[e]&&i[e]===i[n]||i[t+1]===i[e+1]&&i[e+1]===i[n+1])&&(i.splice(e,2),t-=2)}return r}_project(t,e,n,i){let r,s,o,a=1/0;if(i<0){if(e<=this.ymin)return null;(r=(this.ymin-e)/i)<a&&(o=this.ymin,s=t+(a=r)*n)}else if(i>0){if(e>=this.ymax)return null;(r=(this.ymax-e)/i)<a&&(o=this.ymax,s=t+(a=r)*n)}if(n>0){if(t>=this.xmax)return null;(r=(this.xmax-t)/n)<a&&(s=this.xmax,o=e+(a=r)*i)}else if(n<0){if(t<=this.xmin)return null;(r=(this.xmin-t)/n)<a&&(s=this.xmin,o=e+(a=r)*i)}return[s,o]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const _S=2*Math.PI,kS=Math.pow;function CS(t){return t[0]}function ES(t){return t[1]}function DS(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class FS{static from(t,e=CS,n=ES,i){return new FS("length"in t?function(t,e,n,i){const r=t.length,s=new Float64Array(2*r);for(let o=0;o<r;++o){const r=t[o];s[2*o]=e.call(i,r,o,t),s[2*o+1]=n.call(i,r,o,t)}return s}(t,e,n,i):Float64Array.from(function*(t,e,n,i){let r=0;for(const s of t)yield e.call(i,s,r,t),yield n.call(i,s,r,t),++r}(t,e,n,i)))}constructor(t){this._delaunator=new lS(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){const i=2*e[t],r=2*e[t+1],s=2*e[t+2];if((n[s]-n[i])*(n[r+1]-n[i+1])-(n[r]-n[i])*(n[s+1]-n[i+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},((t,e)=>e)).sort(((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]));const t=this.collinear[0],n=this.collinear[this.collinear.length-1],i=[e[2*t],e[2*t+1],e[2*n],e[2*n+1]],r=1e-8*Math.hypot(i[3]-i[1],i[2]-i[0]);for(let t=0,n=e.length/2;t<n;++t){const n=DS(e[2*t],e[2*t+1],r);e[2*t]=n[0],e[2*t+1]=n[1]}this._delaunator=new lS(e)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,r=this.triangles=this._delaunator.triangles,s=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let t=0,e=n.length;t<e;++t){const e=r[t%3==2?t-2:t+1];-1!==n[t]&&-1!==s[e]||(s[e]=t)}for(let t=0,e=i.length;t<e;++t)o[i[t]]=t;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],s[i[0]]=1,2===i.length&&(s[i[1]]=0))}voronoi(t){return new AS(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:i,halfedges:r,triangles:s,collinear:o}=this;if(o){const e=o.indexOf(t);return e>0&&(yield o[e-1]),void(e<o.length-1&&(yield o[e+1]))}const a=e[t];if(-1===a)return;let u=a,l=-1;do{if(yield l=s[u],u=u%3==2?u-2:u+1,s[u]!==t)return;if(u=r[u],-1===u){const e=n[(i[t]+1)%n.length];return void(e!==l&&(yield e))}}while(u!==a)}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const i=n;let r;for(;(r=this._step(n,t,e))>=0&&r!==n&&r!==i;)n=r;return r}_step(t,e,n){const{inedges:i,hull:r,_hullIndex:s,halfedges:o,triangles:a,points:u}=this;if(-1===i[t]||!u.length)return(t+1)%(u.length>>1);let l=t,c=kS(e-u[2*t],2)+kS(n-u[2*t+1],2);const h=i[t];let f=h;do{let i=a[f];const h=kS(e-u[2*i],2)+kS(n-u[2*i+1],2);if(h<c&&(c=h,l=i),f=f%3==2?f-2:f+1,a[f]!==t)break;if(f=o[f],-1===f){if(f=r[(s[t]+1)%r.length],f!==i&&kS(e-u[2*f],2)+kS(n-u[2*f+1],2)<c)return f;break}}while(f!==h);return l}render(t){const e=null==t?t=new xS:void 0,{points:n,halfedges:i,triangles:r}=this;for(let e=0,s=i.length;e<s;++e){const s=i[e];if(s<e)continue;const o=2*r[e],a=2*r[s];t.moveTo(n[o],n[o+1]),t.lineTo(n[a],n[a+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e=2){const n=null==t?t=new xS:void 0,{points:i}=this;for(let n=0,r=i.length;n<r;n+=2){const r=i[n],s=i[n+1];t.moveTo(r+e,s),t.arc(r,s,e,0,_S)}return n&&n.value()}renderHull(t){const e=null==t?t=new xS:void 0,{hull:n,points:i}=this,r=2*n[0],s=n.length;t.moveTo(i[r],i[r+1]);for(let e=1;e<s;++e){const r=2*n[e];t.lineTo(i[r],i[r+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new wS;return this.renderHull(t),t.value()}renderTriangle(t,e){const n=null==e?e=new xS:void 0,{points:i,triangles:r}=this,s=2*r[t*=3],o=2*r[t+1],a=2*r[t+2];return e.moveTo(i[s],i[s+1]),e.lineTo(i[o],i[o+1]),e.lineTo(i[a],i[a+1]),e.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new wS;return this.renderTriangle(t,e),e.value()}}function SS(t){Ou.call(this,null,t)}SS.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const OS=[-1e5,-1e5,1e5,1e5];function NS(t){const e=t[0][0],n=t[0][1];let i=t.length-1;for(;t[i][0]===e&&t[i][1]===n;--i);return"M"+t.slice(0,i+1).join("L")+"Z"}Nn(SS,Ou,{transform(t,e){const n=t.as||"path",i=e.source;if(!i||!i.length)return e;let r=t.size;r=r?[0,0,r[0],r[1]]:(r=t.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:OS;const s=this.value=FS.from(i,t.x,t.y).voronoi(r);for(let t=0,e=i.length;t<e;++t){const e=s.cellPolygon(t);i[t][n]=e?NS(e):null}return e.reflow(t.modified()).modifies(n)}});var MS=Math.PI/180,zS=2048;function $S(t,e,n,i){if(!e.sprite){var r=t.context,s=t.ratio;r.clearRect(0,0,2048/s,zS/s);var o,a,u,l,c,h=0,f=0,d=0,p=n.length;for(--i;++i<p;){if(e=n[i],r.save(),r.font=e.style+" "+e.weight+" "+~~((e.size+1)/s)+"px "+e.font,o=r.measureText(e.text+"m").width*s,u=e.size<<1,e.rotate){var g=Math.sin(e.rotate*MS),m=Math.cos(e.rotate*MS),y=o*m,v=o*g,b=u*m,x=u*g;o=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,u=~~Math.max(Math.abs(v+b),Math.abs(v-b))}else o=o+31>>5<<5;if(u>d&&(d=u),h+o>=2048&&(h=0,f+=d,d=0),f+u>=zS)break;r.translate((h+(o>>1))/s,(f+(u>>1))/s),e.rotate&&r.rotate(e.rotate*MS),r.fillText(e.text,0,0),e.padding&&(r.lineWidth=2*e.padding,r.strokeText(e.text,0,0)),r.restore(),e.width=o,e.height=u,e.xoff=h,e.yoff=f,e.x1=o>>1,e.y1=u>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,h+=o}for(var w=r.getImageData(0,0,2048/s,zS/s).data,A=[];--i>=0;)if((e=n[i]).hasText){for(a=(o=e.width)>>5,u=e.y1-e.y0,l=0;l<u*a;l++)A[l]=0;if(null==(h=e.xoff))return;f=e.yoff;var _=0,k=-1;for(c=0;c<u;c++){for(l=0;l<o;l++){var C=a*c+(l>>5),E=w[2048*(f+c)+(h+l)<<2]?1<<31-l%32:0;A[C]|=E,_|=E}_?k=c:(e.y0++,u--,c--,f++)}e.y1=e.y0+k,e.sprite=A.slice(0,(e.y1-e.y0)*a)}}}function TS(t,e,n){n>>=5;for(var i,r=t.sprite,s=t.width>>5,o=t.x-(s<<4),a=127&o,u=32-a,l=t.y1-t.y0,c=(t.y+t.y0)*n+(o>>5),h=0;h<l;h++){i=0;for(var f=0;f<=s;f++)if((i<<u|(f<s?(i=r[h*s+f])>>>a:0))&e[c+f])return!0;c+=n}return!1}function BS(t,e){var n=t[0],i=t[1];e.x+e.x0<n.x&&(n.x=e.x+e.x0),e.y+e.y0<n.y&&(n.y=e.y+e.y0),e.x+e.x1>i.x&&(i.x=e.x+e.x1),e.y+e.y1>i.y&&(i.y=e.y+e.y1)}function jS(t,e){return t.x+t.x1>e[0].x&&t.x+t.x0<e[1].x&&t.y+t.y1>e[0].y&&t.y+t.y0<e[1].y}function IS(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function RS(t){return"function"==typeof t?t:function(){return t}}var LS={archimedean:IS,rectangular:function(t){var e=4*t[0]/t[1],n=0,i=0;return function(t){var r=t<0?-1:1;switch(Math.sqrt(1+4*r*t)-r&3){case 0:n+=e;break;case 1:i+=4;break;case 2:n-=e;break;default:i-=4}return[n,i]}}};const PS=["x","y","font","fontSize","fontStyle","fontWeight","angle"],US=["text","font","rotate","fontSize","fontStyle","fontWeight"];function qS(t){Ou.call(this,function(){var t,e,n,i,r,s,o,a=[256,256],u=IS,l=[],c=Math.random,h={};function f(t,e,n){for(var i,r,s,o=e.x,l=e.y,h=Math.sqrt(a[0]*a[0]+a[1]*a[1]),f=u(a),d=c()<.5?1:-1,p=-d;(i=f(p+=d))&&(r=~~i[0],s=~~i[1],!(Math.min(Math.abs(r),Math.abs(s))>=h));)if(e.x=o+r,e.y=l+s,!(e.x+e.x0<0||e.y+e.y0<0||e.x+e.x1>a[0]||e.y+e.y1>a[1])&&(!n||!TS(e,t,a[0]))&&(!n||jS(e,n))){for(var g,m=e.sprite,y=e.width>>5,v=a[0]>>5,b=e.x-(y<<4),x=127&b,w=32-x,A=e.y1-e.y0,_=(e.y+e.y0)*v+(b>>5),k=0;k<A;k++){g=0;for(var C=0;C<=y;C++)t[_+C]|=g<<w|(C<y?(g=m[k*y+C])>>>x:0);_+=v}return e.sprite=null,!0}return!1}return h.layout=function(){for(var u=function(t){t.width=t.height=1;var e=Math.sqrt(t.getContext("2d").getImageData(0,0,1,1).data.length>>2);t.width=2048/e,t.height=zS/e;var n=t.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:e}}(_f()),h=function(t){for(var e=[],n=-1;++n<t;)e[n]=0;return e}((a[0]>>5)*a[1]),d=null,p=l.length,g=-1,m=[],y=l.map((a=>({text:t(a),font:e(a),style:i(a),weight:r(a),rotate:s(a),size:~~(n(a)+1e-14),padding:o(a),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:a}))).sort(((t,e)=>e.size-t.size));++g<p;){var v=y[g];v.x=a[0]*(c()+.5)>>1,v.y=a[1]*(c()+.5)>>1,$S(u,v,y,g),v.hasText&&f(h,v,d)&&(m.push(v),d?BS(d,v):d=[{x:v.x+v.x0,y:v.y+v.y0},{x:v.x+v.x1,y:v.y+v.y1}],v.x-=a[0]>>1,v.y-=a[1]>>1)}return m},h.words=function(t){return arguments.length?(l=t,h):l},h.size=function(t){return arguments.length?(a=[+t[0],+t[1]],h):a},h.font=function(t){return arguments.length?(e=RS(t),h):e},h.fontStyle=function(t){return arguments.length?(i=RS(t),h):i},h.fontWeight=function(t){return arguments.length?(r=RS(t),h):r},h.rotate=function(t){return arguments.length?(s=RS(t),h):s},h.text=function(e){return arguments.length?(t=RS(e),h):t},h.spiral=function(t){return arguments.length?(u=LS[t]||t,h):u},h.fontSize=function(t){return arguments.length?(n=RS(t),h):n},h.padding=function(t){return arguments.length?(o=RS(t),h):o},h.random=function(t){return arguments.length?(c=t,h):c},h}(),t)}qS.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:PS}]},Nn(qS,Ou,{transform(t,e){!t.size||t.size[0]&&t.size[1]||Le("Wordcloud size dimensions must be non-zero.");const n=t.modified();if(!(n||e.changed(e.ADD_REM)||US.some((function(n){const i=t[n];return yn(i)&&e.modified(i.fields)}))))return;const i=e.materialize(e.SOURCE).source,r=this.value,s=t.as||PS;let o,a=t.fontSize||14;if(yn(a)?o=t.fontSizeRange:a=_n(a),o){const t=a,e=Xg("sqrt")().domain(En(i,t)).range(o);a=n=>e(t(n))}i.forEach((t=>{t[s[0]]=NaN,t[s[1]]=NaN,t[s[3]]=0}));const u=r.words(i).text(t.text).size(t.size||[500,500]).padding(t.padding||1).spiral(t.spiral||"archimedean").rotate(t.rotate||0).font(t.font||"sans-serif").fontStyle(t.fontStyle||"normal").fontWeight(t.fontWeight||"normal").fontSize(a).random(Gu).layout(),l=r.size(),c=l[0]>>1,h=l[1]>>1,f=u.length;for(let t,e,n=0;n<f;++n)t=u[n],e=t.datum,e[s[0]]=t.x+c,e[s[1]]=t.y+h,e[s[2]]=t.font,e[s[3]]=t.size,e[s[4]]=t.style,e[s[5]]=t.weight,e[s[6]]=t.rotate;return e.reflow(n).modifies(s)}});const WS=t=>new Uint8Array(t),HS=t=>new Uint16Array(t),VS=t=>new Uint32Array(t);function GS(t,e,n){const i=(e<257?WS:e<65537?HS:VS)(t);return n&&i.set(n),i}function XS(t,e,n){const i=1<<e;return{one:i,zero:~i,range:n.slice(),bisect:t.bisect,index:t.index,size:t.size,onAdd(t,e){const n=this,r=n.bisect(n.range,t.value),s=t.index,o=r[0],a=r[1],u=s.length;let l;for(l=0;l<o;++l)e[s[l]]|=i;for(l=a;l<u;++l)e[s[l]]|=i;return n}}}function YS(){let t=VS(0),e=[],n=0;return{insert:function(i,r,s){if(!r.length)return[];const o=n,a=r.length,u=VS(a);let l,c,h,f=Array(a);for(h=0;h<a;++h)f[h]=i(r[h]),u[h]=h;if(f=function(t,e){return t.sort.call(e,((e,n)=>{const i=t[e],r=t[n];return i<r?-1:i>r?1:0})),function(t,e){return Array.from(e,(e=>t[e]))}(t,e)}(f,u),o)l=e,c=t,e=Array(o+a),t=VS(o+a),function(t,e,n,i,r,s,o,a,u){let l,c=0,h=0;for(l=0;c<i&&h<o;++l)e[c]<r[h]?(a[l]=e[c],u[l]=n[c++]):(a[l]=r[h],u[l]=s[h++]+t);for(;c<i;++c,++l)a[l]=e[c],u[l]=n[c];for(;h<o;++h,++l)a[l]=r[h],u[l]=s[h]+t}(s,l,c,o,f,u,a,e,t);else{if(s>0)for(h=0;h<a;++h)u[h]+=s;e=f,t=u}return n=o+a,{index:u,value:f}},remove:function(i,r){const s=n;let o,a,u;for(a=0;!r[t[a]]&&a<s;++a);for(u=a;a<s;++a)r[o=t[a]]||(t[u]=o,e[u]=e[a],++u);n=s-i},bisect:function(t,i){let r;return i?r=i.length:(i=e,r=n),[Df(i,t[0],0,r),Ef(i,t[1],0,r)]},reindex:function(e){for(let i=0,r=n;i<r;++i)t[i]=e[t[i]]},index:()=>t,size:()=>n}}function JS(t){Ou.call(this,function(){let t=8,e=[],n=VS(0),i=GS(0,t),r=GS(0,t);return{data:()=>e,seen:()=>n=function(t,e,n){return t.length>=e?t:((n=n||new t.constructor(e)).set(t),n)}(n,e.length),add(t){for(let n,i=0,r=e.length,s=t.length;i<s;++i)n=t[i],n._index=r++,e.push(n)},remove(t,n){const s=e.length,o=Array(s-t),a=e;let u,l,c;for(l=0;!n[l]&&l<s;++l)o[l]=e[l],a[l]=l;for(c=l;l<s;++l)u=e[l],n[l]?a[l]=-1:(a[l]=c,i[c]=i[l],r[c]=r[l],o[c]=u,u._index=c++),i[l]=0;return e=o,a},size:()=>e.length,curr:()=>i,prev:()=>r,reset:t=>r[t]=i[t],all:()=>t<257?255:t<65537?65535:4294967295,set(t,e){i[t]|=e},clear(t,e){i[t]&=~e},resize(e,n){(e>i.length||n>t)&&(t=Math.max(n,t),i=GS(e,t,i),r=GS(e,t))}}}(),t),this._indices=null,this._dims=null}function ZS(t){Ou.call(this,null,t)}JS.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},Nn(JS,Ou,{transform(t,e){return this._dims?t.modified("fields")||t.fields.some((t=>e.modified(t.fields)))?this.reinit(t,e):this.eval(t,e):this.init(t,e)},init(t,e){const n=t.fields,i=t.query,r=this._indices={},s=this._dims=[],o=i.length;let a,u,l=0;for(;l<o;++l)a=n[l].fname,u=r[a]||(r[a]=YS()),s.push(XS(u,l,i[l]));return this.eval(t,e)},reinit(t,e){const n=e.materialize().fork(),i=t.fields,r=t.query,s=this._indices,o=this._dims,a=this.value,u=a.curr(),l=a.prev(),c=a.all(),h=n.rem=n.add,f=n.mod,d=r.length,p={};let g,m,y,v,b,x,w,A,_;if(l.set(u),e.rem.length&&(b=this.remove(t,e,n)),e.add.length&&a.add(e.add),e.mod.length)for(x={},v=e.mod,w=0,A=v.length;w<A;++w)x[v[w]._index]=1;for(w=0;w<d;++w)_=i[w],(!o[w]||t.modified("fields",w)||e.modified(_.fields))&&(y=_.fname,(g=p[y])||(s[y]=m=YS(),p[y]=g=m.insert(_,e.source,0)),o[w]=XS(m,w,r[w]).onAdd(g,u));for(w=0,A=a.data().length;w<A;++w)b[w]||(l[w]!==u[w]?h.push(w):x[w]&&u[w]!==c&&f.push(w));return a.mask=(1<<d)-1,n},eval(t,e){const n=e.materialize().fork(),i=this._dims.length;let r=0;return e.rem.length&&(this.remove(t,e,n),r|=(1<<i)-1),t.modified("query")&&!t.modified("fields")&&(r|=this.update(t,e,n)),e.add.length&&(this.insert(t,e,n),r|=(1<<i)-1),e.mod.length&&(this.modify(e,n),r|=(1<<i)-1),this.value.mask=r,n},insert(t,e,n){const i=e.add,r=this.value,s=this._dims,o=this._indices,a=t.fields,u={},l=n.add,c=r.size()+i.length,h=s.length;let f,d,p,g=r.size();r.resize(c,h),r.add(i);const m=r.curr(),y=r.prev(),v=r.all();for(f=0;f<h;++f)d=a[f].fname,p=u[d]||(u[d]=o[d].insert(a[f],i,g)),s[f].onAdd(p,m);for(;g<c;++g)y[g]=v,m[g]!==v&&l.push(g)},modify(t,e){const n=e.mod,i=this.value,r=i.curr(),s=i.all(),o=t.mod;let a,u,l;for(a=0,u=o.length;a<u;++a)l=o[a]._index,r[l]!==s&&n.push(l)},remove(t,e,n){const i=this._indices,r=this.value,s=r.curr(),o=r.prev(),a=r.all(),u={},l=n.rem,c=e.rem;let h,f,d,p;for(h=0,f=c.length;h<f;++h)d=c[h]._index,u[d]=1,o[d]=p=s[d],s[d]=a,p!==a&&l.push(d);for(d in i)i[d].remove(f,u);return this.reindex(e,f,u),u},reindex(t,e,n){const i=this._indices,r=this.value;t.runAfter((()=>{const t=r.remove(e,n);for(const e in i)i[e].reindex(t)}))},update(t,e,n){const i=this._dims,r=t.query,s=e.stamp,o=i.length;let a,u,l=0;for(n.filters=0,u=0;u<o;++u)t.modified("query",u)&&(a=u,++l);if(1===l)l=i[a].one,this.incrementOne(i[a],r[a],n.add,n.rem);else for(u=0,l=0;u<o;++u)t.modified("query",u)&&(l|=i[u].one,this.incrementAll(i[u],r[u],s,n.add),n.rem=n.add);return l},incrementAll(t,e,n,i){const r=this.value,s=r.seen(),o=r.curr(),a=r.prev(),u=t.index(),l=t.bisect(t.range),c=t.bisect(e),h=c[0],f=c[1],d=l[0],p=l[1],g=t.one;let m,y,v;if(h<d)for(m=h,y=Math.min(d,f);m<y;++m)v=u[m],s[v]!==n&&(a[v]=o[v],s[v]=n,i.push(v)),o[v]^=g;else if(h>d)for(m=d,y=Math.min(h,p);m<y;++m)v=u[m],s[v]!==n&&(a[v]=o[v],s[v]=n,i.push(v)),o[v]^=g;if(f>p)for(m=Math.max(h,p),y=f;m<y;++m)v=u[m],s[v]!==n&&(a[v]=o[v],s[v]=n,i.push(v)),o[v]^=g;else if(f<p)for(m=Math.max(d,f),y=p;m<y;++m)v=u[m],s[v]!==n&&(a[v]=o[v],s[v]=n,i.push(v)),o[v]^=g;t.range=e.slice()},incrementOne(t,e,n,i){const r=this.value.curr(),s=t.index(),o=t.bisect(t.range),a=t.bisect(e),u=a[0],l=a[1],c=o[0],h=o[1],f=t.one;let d,p,g;if(u<c)for(d=u,p=Math.min(c,l);d<p;++d)g=s[d],r[g]^=f,n.push(g);else if(u>c)for(d=c,p=Math.min(u,h);d<p;++d)g=s[d],r[g]^=f,i.push(g);if(l>h)for(d=Math.max(u,h),p=l;d<p;++d)g=s[d],r[g]^=f,n.push(g);else if(l<h)for(d=Math.max(c,l),p=h;d<p;++d)g=s[d],r[g]^=f,i.push(g);t.range=e.slice()}}),ZS.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},Nn(ZS,Ou,{transform(t,e){const n=~(t.ignore||0),i=t.filter,r=i.mask;if(0==(r&n))return e.StopPropagation;const s=e.fork(e.ALL),o=i.data(),a=i.curr(),u=i.prev(),l=t=>a[t]&n?null:o[t];return s.filter(s.MOD,l),r&r-1?(s.filter(s.ADD,(t=>{const e=a[t]&n;return!e&&e^u[t]&n?o[t]:null})),s.filter(s.REM,(t=>{const e=a[t]&n;return!e||e^e^u[t]&n?null:o[t]}))):(s.filter(s.ADD,l),s.filter(s.REM,(t=>(a[t]&n)===r?o[t]:null))),s.filter(s.SOURCE,(t=>l(t._index)))}});const KS="Literal",QS="CallExpression";function tO(t){this.type=t}var eO,nO,iO,rO,sO;tO.prototype.visit=function(t){let e,n,i;if(t(this))return 1;for(e=function(t){switch(t.type){case"ArrayExpression":return t.elements;case"BinaryExpression":case"LogicalExpression":return[t.left,t.right];case QS:return[t.callee].concat(t.arguments);case"ConditionalExpression":return[t.test,t.consequent,t.alternate];case"MemberExpression":return[t.object,t.property];case"ObjectExpression":return t.properties;case"Property":return[t.key,t.value];case"UnaryExpression":return[t.argument];case"Identifier":case KS:case"RawCode":default:return[]}}(this),n=0,i=e.length;n<i;++n)if(e[n].visit(t))return 1},(eO={})[1]="Boolean",eO[2]="<end>",eO[3]="Identifier",eO[4]="Keyword",eO[5]="Null",eO[6]="Numeric",eO[7]="Punctuator",eO[8]="String",eO[9]="RegularExpression";var oO="Identifier",aO="Unexpected token %0",uO="Invalid regular expression",lO="Invalid regular expression: missing /",cO="Octal literals are not allowed in strict mode.",hO="ILLEGAL",fO="Disabled.",dO=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),pO=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function gO(t,e){if(!t)throw new Error("ASSERT: "+e)}function mO(t){return t>=48&&t<=57}function yO(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function vO(t){return"01234567".indexOf(t)>=0}function bO(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function xO(t){return 10===t||13===t||8232===t||8233===t}function wO(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&dO.test(String.fromCharCode(t))}function AO(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&pO.test(String.fromCharCode(t))}const _O={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function kO(){for(;iO<rO;){const t=nO.charCodeAt(iO);if(!bO(t)&&!xO(t))break;++iO}}function CO(t){var e,n,i,r=0;for(n="u"===t?4:2,e=0;e<n;++e)iO<rO&&yO(nO[iO])?(i=nO[iO++],r=16*r+"0123456789abcdef".indexOf(i.toLowerCase())):RO({},aO,hO);return String.fromCharCode(r)}function EO(){var t,e,n,i;for(e=0,"}"===(t=nO[iO])&&RO({},aO,hO);iO<rO&&yO(t=nO[iO++]);)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||"}"!==t)&&RO({},aO,hO),e<=65535?String.fromCharCode(e):(n=55296+(e-65536>>10),i=56320+(e-65536&1023),String.fromCharCode(n,i))}function DO(){var t,e;for(t=nO.charCodeAt(iO++),e=String.fromCharCode(t),92===t&&(117!==nO.charCodeAt(iO)&&RO({},aO,hO),++iO,(t=CO("u"))&&"\\"!==t&&wO(t.charCodeAt(0))||RO({},aO,hO),e=t);iO<rO&&AO(t=nO.charCodeAt(iO));)++iO,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==nO.charCodeAt(iO)&&RO({},aO,hO),++iO,(t=CO("u"))&&"\\"!==t&&AO(t.charCodeAt(0))||RO({},aO,hO),e+=t);return e}function FO(){var t,e,n,i,r=iO,s=nO.charCodeAt(iO),o=nO[iO];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++iO,{type:7,value:String.fromCharCode(s),start:r,end:iO};default:if(61===(t=nO.charCodeAt(iO+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return iO+=2,{type:7,value:String.fromCharCode(s)+String.fromCharCode(t),start:r,end:iO};case 33:case 61:return iO+=2,61===nO.charCodeAt(iO)&&++iO,{type:7,value:nO.slice(r,iO),start:r,end:iO}}}return">>>="===(i=nO.substr(iO,4))?{type:7,value:i,start:r,end:iO+=4}:">>>"===(n=i.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:r,end:iO+=3}:o===(e=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===e?{type:7,value:e,start:r,end:iO+=2}:("//"===e&&RO({},aO,hO),"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:r,end:++iO}:void RO({},aO,hO))}function SO(){var t,e,n;if(gO(mO((n=nO[iO]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),e=iO,t="","."!==n){if(t=nO[iO++],n=nO[iO],"0"===t){if("x"===n||"X"===n)return++iO,function(t){let e="";for(;iO<rO&&yO(nO[iO]);)e+=nO[iO++];return 0===e.length&&RO({},aO,hO),wO(nO.charCodeAt(iO))&&RO({},aO,hO),{type:6,value:parseInt("0x"+e,16),start:t,end:iO}}(e);if(vO(n))return function(t){let e="0"+nO[iO++];for(;iO<rO&&vO(nO[iO]);)e+=nO[iO++];return(wO(nO.charCodeAt(iO))||mO(nO.charCodeAt(iO)))&&RO({},aO,hO),{type:6,value:parseInt(e,8),octal:!0,start:t,end:iO}}(e);n&&mO(n.charCodeAt(0))&&RO({},aO,hO)}for(;mO(nO.charCodeAt(iO));)t+=nO[iO++];n=nO[iO]}if("."===n){for(t+=nO[iO++];mO(nO.charCodeAt(iO));)t+=nO[iO++];n=nO[iO]}if("e"===n||"E"===n)if(t+=nO[iO++],"+"!==(n=nO[iO])&&"-"!==n||(t+=nO[iO++]),mO(nO.charCodeAt(iO)))for(;mO(nO.charCodeAt(iO));)t+=nO[iO++];else RO({},aO,hO);return wO(nO.charCodeAt(iO))&&RO({},aO,hO),{type:6,value:parseFloat(t),start:e,end:iO}}function OO(){if(kO(),iO>=rO)return{type:2,start:iO,end:iO};const t=nO.charCodeAt(iO);return wO(t)?function(){var t,e;return t=iO,{type:1===(e=92===nO.charCodeAt(iO)?DO():function(){var t,e;for(t=iO++;iO<rO;){if(92===(e=nO.charCodeAt(iO)))return iO=t,DO();if(!AO(e))break;++iO}return nO.slice(t,iO)}()).length?3:_O.hasOwnProperty(e)?4:"null"===e?5:"true"===e||"false"===e?1:3,value:e,start:t,end:iO}}():40===t||41===t||59===t?FO():39===t||34===t?function(){var t,e,n,i,r="",s=!1;for(gO("'"===(t=nO[iO])||'"'===t,"String literal must starts with a quote"),e=iO,++iO;iO<rO;){if((n=nO[iO++])===t){t="";break}if("\\"===n)if((n=nO[iO++])&&xO(n.charCodeAt(0)))"\r"===n&&"\n"===nO[iO]&&++iO;else switch(n){case"u":case"x":"{"===nO[iO]?(++iO,r+=EO()):r+=CO(n);break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:vO(n)?(0!==(i="01234567".indexOf(n))&&(s=!0),iO<rO&&vO(nO[iO])&&(s=!0,i=8*i+"01234567".indexOf(nO[iO++]),"0123".indexOf(n)>=0&&iO<rO&&vO(nO[iO])&&(i=8*i+"01234567".indexOf(nO[iO++]))),r+=String.fromCharCode(i)):r+=n}else{if(xO(n.charCodeAt(0)))break;r+=n}}return""!==t&&RO({},aO,hO),{type:8,value:r,octal:s,start:e,end:iO}}():46===t?mO(nO.charCodeAt(iO+1))?SO():FO():mO(t)?SO():FO()}function NO(){const t=sO;return iO=t.end,sO=OO(),iO=t.end,t}function MO(){const t=iO;sO=OO(),iO=t}function zO(t,e,n){const i=new tO("||"===t||"&&"===t?"LogicalExpression":"BinaryExpression");return i.operator=t,i.left=e,i.right=n,i}function $O(t,e){const n=new tO("CallExpression");return n.callee=t,n.arguments=e,n}function TO(t){const e=new tO(oO);return e.name=t,e}function BO(t){const e=new tO("Literal");return e.value=t.value,e.raw=nO.slice(t.start,t.end),t.regex&&("//"===e.raw&&(e.raw="/(?:)/"),e.regex=t.regex),e}function jO(t,e,n){const i=new tO("MemberExpression");return i.computed="["===t,i.object=e,i.property=n,i.computed||(n.member=!0),i}function IO(t,e,n){const i=new tO("Property");return i.key=e,i.value=n,i.kind=t,i}function RO(t,e){var n,i=Array.prototype.slice.call(arguments,2),r=e.replace(/%(\d)/g,((t,e)=>(gO(e<i.length,"Message reference must be in range"),i[e])));throw(n=new Error(r)).index=iO,n.description=r,n}function LO(t){2===t.type&&RO(t,"Unexpected end of input"),6===t.type&&RO(t,"Unexpected number"),8===t.type&&RO(t,"Unexpected string"),3===t.type&&RO(t,"Unexpected identifier"),4===t.type&&RO(t,"Unexpected reserved word"),RO(t,aO,t.value)}function PO(t){const e=NO();7===e.type&&e.value===t||LO(e)}function UO(t){return 7===sO.type&&sO.value===t}function qO(t){return 4===sO.type&&sO.value===t}function WO(){iO=sO.start;const t=NO();return 8===t.type||6===t.type?(t.octal&&RO(t,cO),BO(t)):TO(t.value)}function HO(){var t,e,n;return iO=sO.start,3===(t=sO).type?(n=WO(),PO(":"),IO("init",n,QO())):2!==t.type&&7!==t.type?(e=WO(),PO(":"),IO("init",e,QO())):void LO(t)}const VO={if:1};function GO(){var t,e,n;if(UO("("))return function(){PO("(");const t=tN();return PO(")"),t}();if(UO("["))return function(){const t=[];for(iO=sO.start,PO("[");!UO("]");)UO(",")?(NO(),t.push(null)):(t.push(QO()),UO("]")||PO(","));return NO(),function(t){const e=new tO("ArrayExpression");return e.elements=t,e}(t)}();if(UO("{"))return function(){var t,e,n=[],i={},r=String;for(iO=sO.start,PO("{");!UO("}");)e="$"+((t=HO()).key.type===oO?t.key.name:r(t.key.value)),Object.prototype.hasOwnProperty.call(i,e)?RO({},"Duplicate data property in object literal not allowed in strict mode"):i[e]=!0,n.push(t),UO("}")||PO(",");return PO("}"),function(t){const e=new tO("ObjectExpression");return e.properties=t,e}(n)}();if(t=sO.type,iO=sO.start,3===t||VO[sO.value])n=TO(NO().value);else if(8===t||6===t)sO.octal&&RO(sO,cO),n=BO(NO());else{if(4===t)throw new Error(fO);1===t?((e=NO()).value="true"===e.value,n=BO(e)):5===t?((e=NO()).value=null,n=BO(e)):UO("/")||UO("/=")?(n=BO(function(){var t,e,n,i;return sO=null,kO(),t=iO,e=function(){var t,e,n,i;for(gO("/"===(t=nO[iO]),"Regular expression literal must start with a slash"),e=nO[iO++],n=!1,i=!1;iO<rO;)if(e+=t=nO[iO++],"\\"===t)xO((t=nO[iO++]).charCodeAt(0))&&RO({},lO),e+=t;else if(xO(t.charCodeAt(0)))RO({},lO);else if(n)"]"===t&&(n=!1);else{if("/"===t){i=!0;break}"["===t&&(n=!0)}return i||RO({},lO),{value:e.substr(1,e.length-2),literal:e}}(),n=function(){var t,e,n;for(e="",n="";iO<rO&&AO((t=nO[iO]).charCodeAt(0));)++iO,"\\"===t&&iO<rO?RO({},aO,hO):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&RO({},uO,n),{value:n,literal:e}}(),i=function(t,e){let n=t;e.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((t,e)=>{if(parseInt(e,16)<=1114111)return"x";RO({},uO)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(t){RO({},uO)}try{return new RegExp(t,e)}catch(t){return null}}(e.value,n.value),{literal:e.literal+n.literal,value:i,regex:{pattern:e.value,flags:n.value},start:t,end:iO}}()),MO()):LO(NO())}return n}function XO(){const t=[];if(PO("("),!UO(")"))for(;iO<rO&&(t.push(QO()),!UO(")"));)PO(",");return PO(")"),t}function YO(){PO("[");const t=tN();return PO("]"),t}function JO(){const t=function(){var t;for(t=GO();;)if(UO("."))t=jO(".",t,(PO("."),function(){iO=sO.start;const t=NO();return function(t){return 3===t.type||4===t.type||1===t.type||5===t.type}(t)||LO(t),TO(t.value)}()));else if(UO("("))t=$O(t,XO());else{if(!UO("["))break;t=jO("[",t,YO())}return t}();if(7===sO.type&&(UO("++")||UO("--")))throw new Error(fO);return t}function ZO(){var t,e;if(7!==sO.type&&4!==sO.type)e=JO();else{if(UO("++")||UO("--"))throw new Error(fO);if(UO("+")||UO("-")||UO("~")||UO("!"))t=NO(),e=ZO(),e=function(t,e){const n=new tO("UnaryExpression");return n.operator=t,n.argument=e,n.prefix=!0,n}(t.value,e);else{if(qO("delete")||qO("void")||qO("typeof"))throw new Error(fO);e=JO()}}return e}function KO(t){let e=0;if(7!==t.type&&4!==t.type)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11}return e}function QO(){var t,e;return t=function(){var t,e,n,i,r,s,o,a,u,l;if(t=sO,u=ZO(),0===(r=KO(i=sO)))return u;for(i.prec=r,NO(),e=[t,sO],s=[u,i,o=ZO()];(r=KO(sO))>0;){for(;s.length>2&&r<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),e.pop(),n=zO(a,u,o),s.push(n);(i=NO()).prec=r,s.push(i),e.push(sO),n=ZO(),s.push(n)}for(n=s[l=s.length-1],e.pop();l>1;)e.pop(),n=zO(s[l-1].value,s[l-2],n),l-=2;return n}(),UO("?")&&(NO(),e=QO(),PO(":"),t=function(t,e,n){const i=new tO("ConditionalExpression");return i.test=t,i.consequent=e,i.alternate=n,i}(t,e,QO())),t}function tN(){const t=QO();if(UO(","))throw new Error(fO);return t}var eN={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function nN(t){function e(e,n,i){return r=>function(e,n,i,r){let s=t(n[0]);return i&&(s=i+"("+s+")",0===i.lastIndexOf("new ",0)&&(s="("+s+")")),s+"."+e+(r<0?"":0===r?"()":"("+n.slice(1).map(t).join(",")+")")}(e,r,n,i)}const n="new Date",i="String",r="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(e){e.length<3&&Le("Missing arguments to clamp function."),e.length>3&&Le("Too many arguments to clamp function.");const n=e.map(t);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:e("getDate",n,0),day:e("getDay",n,0),year:e("getFullYear",n,0),month:e("getMonth",n,0),hours:e("getHours",n,0),minutes:e("getMinutes",n,0),seconds:e("getSeconds",n,0),milliseconds:e("getMilliseconds",n,0),time:e("getTime",n,0),timezoneoffset:e("getTimezoneOffset",n,0),utcdate:e("getUTCDate",n,0),utcday:e("getUTCDay",n,0),utcyear:e("getUTCFullYear",n,0),utcmonth:e("getUTCMonth",n,0),utchours:e("getUTCHours",n,0),utcminutes:e("getUTCMinutes",n,0),utcseconds:e("getUTCSeconds",n,0),utcmilliseconds:e("getUTCMilliseconds",n,0),length:e("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:e("toUpperCase",i,0),lower:e("toLowerCase",i,0),substring:e("substring",i),split:e("split",i),trim:e("trim",i,0),regexp:r,test:e("test",r),if:function(e){e.length<3&&Le("Missing arguments to if function."),e.length>3&&Le("Too many arguments to if function.");const n=e.map(t);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}var iN,rN,sN,oN,aN,uN,lN,cN,hN,fN,dN,pN,gN,mN,yN,vN,bN=new JA,xN=new JA,wN={point:x_,lineStart:x_,lineEnd:x_,polygonStart:function(){bN=new JA,wN.lineStart=AN,wN.lineEnd=_N},polygonEnd:function(){var t=+bN;xN.add(t<0?n_+t:t),this.lineStart=this.lineEnd=this.point=x_},sphere:function(){xN.add(n_)}};function AN(){wN.point=kN}function _N(){CN(iN,rN)}function kN(t,e){wN.point=CN,iN=t,rN=e,sN=t*=r_,oN=u_(e=(e*=r_)/2+e_),aN=p_(e)}function CN(t,e){var n=(t*=r_)-sN,i=n>=0?1:-1,r=i*n,s=u_(e=(e*=r_)/2+e_),o=p_(e),a=aN*o,u=oN*s+a*u_(r),l=a*i*p_(r);bN.add(a_(l,u)),sN=t,oN=s,aN=o}var EN,DN,FN,SN,ON,NN,MN,zN,$N,TN,BN,jN,IN,RN,LN,PN,UN={point:qN,lineStart:HN,lineEnd:VN,polygonStart:function(){UN.point=GN,UN.lineStart=XN,UN.lineEnd=YN,mN=new JA,wN.polygonStart()},polygonEnd:function(){wN.polygonEnd(),UN.point=qN,UN.lineStart=HN,UN.lineEnd=VN,bN<0?(uN=-(cN=180),lN=-(hN=90)):mN>ZA?hN=90:mN<-1e-6&&(lN=-90),vN[0]=uN,vN[1]=cN},sphere:function(){uN=-(cN=180),lN=-(hN=90)}};function qN(t,e){yN.push(vN=[uN=t,cN=t]),e<lN&&(lN=e),e>hN&&(hN=e)}function WN(t,e){var n=Fk([t*r_,e*r_]);if(gN){var i=Ok(gN,n),r=Ok([i[1],-i[0],0],i);zk(r),r=Dk(r);var s,o=t-fN,a=o>0?1:-1,u=r[0]*i_*a,l=s_(o)>180;l^(a*fN<u&&u<a*t)?(s=r[1]*i_)>hN&&(hN=s):l^(a*fN<(u=(u+360)%360-180)&&u<a*t)?(s=-r[1]*i_)<lN&&(lN=s):(e<lN&&(lN=e),e>hN&&(hN=e)),l?t<fN?JN(uN,t)>JN(uN,cN)&&(cN=t):JN(t,cN)>JN(uN,cN)&&(uN=t):cN>=uN?(t<uN&&(uN=t),t>cN&&(cN=t)):t>fN?JN(uN,t)>JN(uN,cN)&&(cN=t):JN(t,cN)>JN(uN,cN)&&(uN=t)}else yN.push(vN=[uN=t,cN=t]);e<lN&&(lN=e),e>hN&&(hN=e),gN=n,fN=t}function HN(){UN.point=WN}function VN(){vN[0]=uN,vN[1]=cN,UN.point=qN,gN=null}function GN(t,e){if(gN){var n=t-fN;mN.add(s_(n)>180?n+(n>0?360:-360):n)}else dN=t,pN=e;wN.point(t,e),WN(t,e)}function XN(){wN.lineStart()}function YN(){GN(dN,pN),wN.lineEnd(),s_(mN)>ZA&&(uN=-(cN=180)),vN[0]=uN,vN[1]=cN,gN=null}function JN(t,e){return(e-=t)<0?e+360:e}function ZN(t,e){return t[0]-e[0]}function KN(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var QN={sphere:x_,point:tM,lineStart:nM,lineEnd:sM,polygonStart:function(){QN.lineStart=oM,QN.lineEnd=aM},polygonEnd:function(){QN.lineStart=nM,QN.lineEnd=sM}};function tM(t,e){t*=r_;var n=u_(e*=r_);eM(n*u_(t),n*p_(t),p_(e))}function eM(t,e,n){++EN,FN+=(t-FN)/EN,SN+=(e-SN)/EN,ON+=(n-ON)/EN}function nM(){QN.point=iM}function iM(t,e){t*=r_;var n=u_(e*=r_);RN=n*u_(t),LN=n*p_(t),PN=p_(e),QN.point=rM,eM(RN,LN,PN)}function rM(t,e){t*=r_;var n=u_(e*=r_),i=n*u_(t),r=n*p_(t),s=p_(e),o=a_(m_((o=LN*s-PN*r)*o+(o=PN*i-RN*s)*o+(o=RN*r-LN*i)*o),RN*i+LN*r+PN*s);DN+=o,NN+=o*(RN+(RN=i)),MN+=o*(LN+(LN=r)),zN+=o*(PN+(PN=s)),eM(RN,LN,PN)}function sM(){QN.point=tM}function oM(){QN.point=uM}function aM(){lM(jN,IN),QN.point=tM}function uM(t,e){jN=t,IN=e,t*=r_,e*=r_,QN.point=lM;var n=u_(e);RN=n*u_(t),LN=n*p_(t),PN=p_(e),eM(RN,LN,PN)}function lM(t,e){t*=r_;var n=u_(e*=r_),i=n*u_(t),r=n*p_(t),s=p_(e),o=LN*s-PN*r,a=PN*i-RN*s,u=RN*r-LN*i,l=h_(o,a,u),c=b_(l),h=l&&-c/l;$N.add(h*o),TN.add(h*a),BN.add(h*u),DN+=c,NN+=c*(RN+(RN=i)),MN+=c*(LN+(LN=r)),zN+=c*(PN+(PN=s)),eM(RN,LN,PN)}const cM="intersect",hM="union",fM="index:unit";function dM(t,e){for(var n,i,r=e.fields,s=e.values,o=r.length,a=0;a<o;++a)if((i=r[a]).getter=Ue.getter||Ue(i.field),zn(n=i.getter(t))&&(n=rn(n)),zn(s[a])&&(s[a]=rn(s[a])),zn(s[a][0])&&(s[a]=s[a].map(rn)),"E"===i.type){if(Ze(s[a])?s[a].indexOf(n)<0:n!==s[a])return!1}else if("R"===i.type){if(!Mn(n,s[a]))return!1}else if("R-RE"===i.type){if(!Mn(n,s[a],!0,!1))return!1}else if("R-E"===i.type){if(!Mn(n,s[a],!1,!1))return!1}else if("R-LE"===i.type&&!Mn(n,s[a],!1,!0))return!1;return!0}const pM=Ue("_vgsid_"),gM=function(t){let e=t,n=t;function i(t,e,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){const s=i+r>>>1;n(t[s],e)<0?i=s+1:r=s}return i}return 1===t.length&&(e=(e,n)=>t(e)-n,n=function(t){return(e,n)=>function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}(t(e),n)}(t)),{left:i,center:function(t,n,r,s){null==r&&(r=0),null==s&&(s=t.length);const o=i(t,n,r,s-1);return o>r&&e(t[o-1],n)>-e(t[o],n)?o-1:o},right:function(t,e,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){const s=i+r>>>1;n(t[s],e)>0?r=s:i=s+1}return i}}}(pM),mM=gM.left,yM=gM.right;var vM={E_union:function(t,e){if(!t.length)return e;for(var n=0,i=e.length;n<i;++n)t.indexOf(e[n])<0&&t.push(e[n]);return t},E_intersect:function(t,e){return t.length?t.filter((t=>e.indexOf(t)>=0)):e},R_union:function(t,e){var n=rn(e[0]),i=rn(e[1]);return n>i&&(n=e[1],i=e[0]),t.length?(t[0]>n&&(t[0]=n),t[1]<i&&(t[1]=i),t):[n,i]},R_intersect:function(t,e){var n=rn(e[0]),i=rn(e[1]);return n>i&&(n=e[1],i=e[0]),t.length?i<t[0]||t[1]<n?[]:(t[0]<n&&(t[0]=n),t[1]>i&&(t[1]=i),t):[n,i]}};function bM(t,e,n,i){e[0].type!==KS&&Le("First argument to selection functions must be a string literal.");const r=e[0].value,s=":"+r;(e.length>=2&&nn(e).value)!==cM||Fn(i,"@unit")||(i["@unit"]=n.getData(r).indataRef(n,"unit")),Fn(i,s)||(i[s]=n.getData(r).tuplesRef())}function xM(t){const e=this.context.data[t];return e?e.values.value:[]}const wM=t=>function(e,n){return this.context.dataflow.locale()[t](n)(e)},AM=wM("format"),_M=wM("timeFormat"),kM=wM("utcFormat"),CM=wM("timeParse"),EM=wM("utcParse"),DM=new Date(2e3,0,1);function FM(t,e,n){return Number.isInteger(t)&&Number.isInteger(e)?(DM.setYear(2e3),DM.setMonth(t),DM.setDate(e),_M.call(this,DM,n)):""}function SM(t,e,n,i){e[0].type!==KS&&Le("First argument to data functions must be a string literal.");const r=e[0].value,s=":"+r;if(!Fn(s,i))try{i[s]=n.getData(r).tuplesRef()}catch(t){}}function OM(t,e,n,i){if(e[0].type===KS)NM(n,i,e[0].value);else for(t in n.scales)NM(n,i,t)}function NM(t,e,n){const i="%"+n;if(!Fn(e,i))try{e[i]=t.scaleRef(n)}catch(t){}}function MM(t,e){let n;return yn(t)?t:Tn(t)?(n=e.scales[t])&&n.value:void 0}function zM(t,e){return function(n,i,r){if(n){const e=MM(n,(r||this).context);return e&&e.path[t](i)}return e(i)}}const $M=zM("area",(function(t){return xN=new JA,YA(t,wN),2*xN})),TM=zM("bounds",(function(t){var e,n,i,r,s,o,a;if(hN=cN=-(uN=lN=1/0),yN=[],YA(t,UN),n=yN.length){for(yN.sort(ZN),e=1,s=[i=yN[0]];e<n;++e)KN(i,(r=yN[e])[0])||KN(i,r[1])?(JN(i[0],r[1])>JN(i[0],i[1])&&(i[1]=r[1]),JN(r[0],i[1])>JN(i[0],i[1])&&(i[0]=r[0])):s.push(i=r);for(o=-1/0,e=0,i=s[n=s.length-1];e<=n;i=r,++e)r=s[e],(a=JN(i[1],r[0]))>o&&(o=a,uN=r[0],cN=i[1])}return yN=vN=null,uN===1/0||lN===1/0?[[NaN,NaN],[NaN,NaN]]:[[uN,lN],[cN,hN]]})),BM=zM("centroid",(function(t){EN=DN=FN=SN=ON=NN=MN=zN=0,$N=new JA,TN=new JA,BN=new JA,YA(t,QN);var e=+$N,n=+TN,i=+BN,r=h_(e,n,i);return r<KA&&(e=NN,n=MN,i=zN,DN<ZA&&(e=FN,n=SN,i=ON),(r=h_(e,n,i))<KA)?[NaN,NaN]:[a_(n,e)*i_,b_(i/r)*i_]}));function jM(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(e){t.warn(e)}return n[n.length-1]}function IM(t){const e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function RM(t){const e=nd(t);return.2126*IM(e.r)+.7152*IM(e.g)+.0722*IM(e.b)}function LM(t,e){return t===e||t!=t&&e!=e||(Ze(t)?!(!Ze(e)||t.length!==e.length)&&function(t,e){for(let n=0,i=t.length;n<i;++n)if(!LM(t[n],e[n]))return!1;return!0}(t,e):!(!Ke(t)||!Ke(e))&&PM(t,e))}function PM(t,e){for(const n in t)if(!LM(t[n],e[n]))return!1;return!0}function UM(t){return e=>PM(t,e)}const qM={};function WM(t){return Ze(t)||ArrayBuffer.isView(t)?t:null}function HM(t){return WM(t)||(Tn(t)?t:null)}const VM=t=>t.data;function GM(t,e){const n=xM.call(e,t);return n.root&&n.root.lookup||{}}const XM=()=>"undefined"!=typeof window&&window||null,YM={random:()=>Gu(),cumulativeNormal:rl,cumulativeLogNormal:cl,cumulativeUniform:ml,densityNormal:il,densityLogNormal:ll,densityUniform:gl,quantileNormal:sl,quantileLogNormal:hl,quantileUniform:yl,sampleNormal:nl,sampleLogNormal:ul,sampleUniform:pl,isArray:Ze,isBoolean:function(t){return"boolean"==typeof t},isDate:zn,isDefined:t=>void 0!==t,isNumber:$n,isObject:Ke,isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},isString:Tn,isTuple:Za,isValid:t=>null!=t&&t==t,toBoolean:Ln,toDate:Un,toNumber:rn,toString:qn,indexof:function(t,...e){return HM(t).indexOf(...e)},join:function(t,...e){return WM(t).join(...e)},lastindexof:function(t,...e){return HM(t).lastIndexOf(...e)},replace:function(t,e,n){return yn(n)&&Le("Function argument passed to replace."),String(t).replace(e,n)},reverse:function(t){return WM(t).slice().reverse()},slice:function(t,...e){return HM(t).slice(...e)},flush:function(t,e,n,i,r,s){if(!n&&0!==n)return s;const o=+n;let a,u=t[0],l=nn(t);l<u&&(a=u,u=l,l=a),a=Math.abs(e-u);const c=Math.abs(l-e);return a<c&&a<=o?i:c<=o?r:s},lerp:function(t,e){const n=t[0],i=nn(t),r=+e;return r?1===r?i:n+r*(i-n):n},merge:function(){const t=[].slice.call(arguments);return t.unshift({}),Cn(...t)},pad:function(t,e,n,i){const r=n||" ",s=t+"",o=e-s.length;return o<=0?s:"left"===i?jn(r,o)+s:"center"===i?jn(r,~~(o/2))+s+jn(r,Math.ceil(o/2)):s+jn(r,o)},peek:nn,pluck:function(t,e){const n=qM[e]||(qM[e]=Ue(e));return Ze(t)?t.map(n):n(t)},span:In,inrange:Mn,truncate:function(t,e,n,i){const r=null!=i?i:"",s=t+"",o=s.length,a=Math.max(0,e-r.length);return o<=e?s:"left"===n?r+s.slice(o-a):"center"===n?s.slice(0,Math.ceil(a/2))+r+s.slice(o-~~(a/2)):s.slice(0,a)+r},rgb:nd,lab:Wp,hcl:Zp,hsl:ld,luminance:RM,contrast:function(t,e){const n=RM(t),i=RM(e);return(Math.max(n,i)+.05)/(Math.min(n,i)+.05)},sequence:Bl,format:AM,utcFormat:kM,utcParse:EM,utcOffset:ys,utcSequence:xs,timeFormat:_M,timeParse:CM,timeOffset:ms,timeSequence:bs,timeUnitSpecifier:Ur,monthFormat:function(t){return FM.call(this,t,1,"%B")},monthAbbrevFormat:function(t){return FM.call(this,t,1,"%b")},dayFormat:function(t){return FM.call(this,0,2+t,"%A")},dayAbbrevFormat:function(t){return FM.call(this,0,2+t,"%a")},quarter:function(t){return 1+~~(new Date(t).getMonth()/3)},utcquarter:function(t){return 1+~~(new Date(t).getUTCMonth()/3)},week:Vr,utcweek:Kr,dayofyear:Hr,utcdayofyear:Zr,warn:function(){return jM(this.context.dataflow,"warn",arguments)},info:function(){return jM(this.context.dataflow,"info",arguments)},debug:function(){return jM(this.context.dataflow,"debug",arguments)},extent:En,inScope:function(t){const e=this.context.group;let n=!1;if(e)for(;t;){if(t===e){n=!0;break}t=t.mark.group}return n},intersect:function(t,e,n){if(!t)return[];const[i,r]=t,s=(new Oy).set(i[0],i[1],r[0],r[1]);return tw(n||this.context.dataflow.scenegraph().root,s,function(t){let e=null;if(t){const n=mn(t.marktype),i=mn(t.markname);e=t=>(!n.length||n.some((e=>t.marktype===e)))&&(!i.length||i.some((e=>t.name===e)))}return e}(e))},clampRange:function(t,e,n){let i,r=t[0],s=t[1];return s<r&&(i=s,s=r,r=i),i=s-r,i>=n-e?[e,n]:[r=Math.min(Math.max(r,e),n-i),r+i]},pinchDistance:function(t){const e=t.touches,n=e[0].clientX-e[1].clientX,i=e[0].clientY-e[1].clientY;return Math.sqrt(n*n+i*i)},pinchAngle:function(t){const e=t.touches;return Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)},screen:function(){const t=XM();return t?t.screen:{}},containerSize:function(){const t=this.context.dataflow,e=t.container&&t.container();return e?[e.clientWidth,e.clientHeight]:[void 0,void 0]},windowSize:function(){const t=XM();return t?[t.innerWidth,t.innerHeight]:[void 0,void 0]},bandspace:function(t,e,n){return bg(t||0,e||0,n||0)},setdata:function(t,e){const n=this.context.dataflow,i=this.context.data[t].input;return n.pulse(i,n.changeset().remove(Ge).insert(e)),1},pathShape:function(t){let e=null;return function(n){return n?Qm(n,e=e||Um(t)):t}},panLinear:function(t,e){return cn(t,e,rn,We)},panLog:function(t,e){var n=Math.sign(t[0]);return cn(t,e,on(n),sn(n))},panPow:function(t,e,n){return cn(t,e,ln(n),ln(1/n))},panSymlog:function(t,e,n){return cn(t,e,an(n),un(n))},zoomLinear:fn,zoomLog:dn,zoomPow:pn,zoomSymlog:gn,encode:function(t,e,n){if(t){const n=this.context.dataflow,i=t.mark.source;n.pulse(i,n.changeset().encode(t,e))}return void 0!==n?n:t},modify:function(t,e,n,i,r,s){const o=this.context.dataflow,a=this.context.data[t],u=a.input,l=o.stamp();let c,h,f=a.changes;if(!1===o._trigger||!(u.value.length||e||i))return 0;if((!f||f.stamp<l)&&(a.changes=f=o.changeset(),f.stamp=l,o.runAfter((()=>{a.modified=!0,o.pulse(u,f).run()}),!0,1)),n&&(c=!0===n?Ge:Ze(n)||Za(n)?n:UM(n),f.remove(c)),e&&f.insert(e),i&&(c=UM(i),u.value.some(c)?f.remove(c):f.insert(i)),r)for(h in s)f.modify(r,h,s[h]);return 1}},JM=["view","item","group","xy","x","y"],ZM="this.",KM={},QM={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:t=>`_[${Rn("$"+t)}]`,functions:function(t){const e=nN(t);JM.forEach((t=>e[t]="event.vega."+t));for(const t in YM)e[t]=ZM+t;return Cn(e,function(t,e,n){e.__bandwidth=t=>t&&t.bandwidth?t.bandwidth():0,n._bandwidth=OM,n._range=OM,n._scale=OM;const i=e=>"_["+(e.type===KS?Rn("%"+e.value):Rn("%")+"+"+t(e))+"]";return{_bandwidth:t=>`this.__bandwidth(${i(t[0])})`,_range:t=>`${i(t[0])}.range()`,_scale:e=>`${i(e[0])}(${t(e[1])})`}}(t,YM,KM)),e},constants:eN,visitors:KM},tz=function(t){const e=(t=t||{}).allowed?Wn(t.allowed):{},n=t.forbidden?Wn(t.forbidden):{},i=t.constants||eN,r=(t.functions||nN)(h),s=t.globalvar,o=t.fieldvar,a=yn(s)?s:t=>`${s}["${t}"]`;let u={},l={},c=0;function h(t){if(Tn(t))return t;const e=f[t.type];return null==e&&Le("Unsupported type: "+t.type),e(t)}const f={Literal:t=>t.raw,Identifier:t=>{const r=t.name;return c>0?r:Fn(n,r)?Le("Illegal identifier: "+r):Fn(i,r)?i[r]:Fn(e,r)?r:(u[r]=1,a(r))},MemberExpression:t=>{const e=!t.computed,n=h(t.object);e&&(c+=1);const i=h(t.property);return n===o&&(l[function(t){const e=t&&t.length-1;return e&&('"'===t[0]&&'"'===t[e]||"'"===t[0]&&"'"===t[e])?t.slice(1,-1):t}(i)]=1),e&&(c-=1),n+(e?"."+i:"["+i+"]")},CallExpression:t=>{"Identifier"!==t.callee.type&&Le("Illegal callee type: "+t.callee.type);const e=t.callee.name,n=t.arguments,i=Fn(r,e)&&r[e];return i||Le("Unrecognized function: "+e),yn(i)?i(n):i+"("+n.map(h).join(",")+")"},ArrayExpression:t=>"["+t.elements.map(h).join(",")+"]",BinaryExpression:t=>"("+h(t.left)+" "+t.operator+" "+h(t.right)+")",UnaryExpression:t=>"("+t.operator+h(t.argument)+")",ConditionalExpression:t=>"("+h(t.test)+"?"+h(t.consequent)+":"+h(t.alternate)+")",LogicalExpression:t=>"("+h(t.left)+t.operator+h(t.right)+")",ObjectExpression:t=>"{"+t.properties.map(h).join(",")+"}",Property:t=>{c+=1;const e=h(t.key);return c-=1,e+":"+h(t.value)}};function d(t){const e={code:h(t),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},e}return d.functions=r,d.constants=i,d}(QM);function ez(t,e,n){return 1===arguments.length?YM[t]:(YM[t]=e,n&&(KM[t]=n),tz&&(tz.functions[t]=ZM+t),this)}function nz(t,e){const n={};let i;try{i=function(t){iO=0,rO=(nO=t).length,sO=null,MO();const e=tN();if(2!==sO.type)throw new Error("Unexpect token after expression.");return e}(t=Tn(t)?t:Rn(t)+"")}catch(e){Le("Expression parse error: "+t)}i.visit((t=>{if(t.type!==QS)return;const i=t.callee.name,r=QM.visitors[i];r&&r(i,t.arguments,e,n)}));const r=tz(i);return r.globals.forEach((t=>{const i="$"+t;!Fn(n,i)&&e.getSignal(t)&&(n[i]=e.signalRef(t))})),{$expr:Cn({code:r.code},e.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}ez("bandwidth",(function(t,e){const n=MM(t,(e||this).context);return n&&n.bandwidth?n.bandwidth():0}),OM),ez("copy",(function(t,e){const n=MM(t,(e||this).context);return n?n.copy():void 0}),OM),ez("domain",(function(t,e){const n=MM(t,(e||this).context);return n?n.domain():[]}),OM),ez("range",(function(t,e){const n=MM(t,(e||this).context);return n&&n.range?n.range():[]}),OM),ez("invert",(function(t,e,n){const i=MM(t,(n||this).context);return i?Ze(e)?(i.invertRange||i.invert)(e):(i.invert||i.invertExtent)(e):void 0}),OM),ez("scale",(function(t,e,n){const i=MM(t,(n||this).context);return i?i(e):void 0}),OM),ez("gradient",(function(t,e,n,i,r){t=MM(t,(r||this).context);const s=jm(e,n);let o=t.domain(),a=o[0],u=nn(o),l=We;return u-a?l=am(t,a,u):t=(t.interpolator?Xg("sequential")().interpolator(t.interpolator()):Xg("linear")().interpolate(t.interpolate()).range(t.range())).domain([a=0,u=1]),t.ticks&&(o=t.ticks(+i||15),a!==o[0]&&o.unshift(a),u!==nn(o)&&o.push(u)),o.forEach((e=>s.stop(l(e),t(e)))),s}),OM),ez("geoArea",$M,OM),ez("geoBounds",TM,OM),ez("geoCentroid",BM,OM),ez("geoShape",(function(t,e,n){const i=MM(t,(n||this).context);return function(t){return i?i.path.context(t)(e):""}}),OM),ez("indata",(function(t,e,n){const i=this.context.data[t]["index:"+e],r=i?i.value.get(n):void 0;return r?r.count:r}),(function(t,e,n,i){e[0].type!==KS&&Le("First argument to indata must be a string literal."),e[1].type!==KS&&Le("Second argument to indata must be a string literal.");const r=e[0].value,s=e[1].value,o="@"+s;Fn(o,i)||(i[o]=n.getData(r).indataRef(n,s))})),ez("data",xM,SM),ez("treePath",(function(t,e,n){const i=GM(t,this),r=i[e],s=i[n];return r&&s?r.path(s).map(VM):void 0}),SM),ez("treeAncestors",(function(t,e){const n=GM(t,this)[e];return n?n.ancestors().map(VM):void 0}),SM),ez("vlSelectionTest",(function(t,e,n){for(var i,r,s,o,a,u=this.context.data[t],l=u?u.values.value:[],c=u?u[fM]&&u[fM].value:void 0,h=n===cM,f=l.length,d=0;d<f;++d)if(i=l[d],c&&h){if(-1===(s=(r=r||{})[o=i.unit]||0))continue;if(a=dM(e,i),r[o]=a?-1:++s,a&&1===c.size)return!0;if(!a&&s===c.get(o).count)return!1}else if(h^(a=dM(e,i)))return a;return f&&h}),bM),ez("vlSelectionIdTest",(function(t,e,n){const i=this.context.data[t],r=i?i.values.value:[],s=i?i[fM]&&i[fM].value:void 0,o=n===cM,a=pM(e),u=mM(r,a);if(u===r.length)return!1;if(pM(r[u])!==a)return!1;if(s&&o){if(1===s.size)return!0;if(yM(r,a)-u<s.size)return!1}return!0}),bM),ez("vlSelectionResolve",(function(t,e,n,i){for(var r,s,o,a,u,l,c,h,f,d,p,g=this.context.data[t],m=g?g.values.value:[],y={},v={},b={},x=m.length,w=0;w<x;++w){for(a=(r=m[w]).unit,s=r.fields,o=r.values,d=0,p=s.length;d<p;++d)u=s[d],c=(l=y[u.field]||(y[u.field]={}))[a]||(l[a]=[]),b[u.field]=h=u.type.charAt(0),f=vM[h+"_union"],l[a]=f(c,mn(o[d]));n&&(c=v[a]||(v[a]=[])).push(mn(o).reduce(((t,e,n)=>(t[s[n].field]=e,t)),{}))}return e=e||hM,Object.keys(y).forEach((t=>{y[t]=Object.keys(y[t]).map((e=>y[t][e])).reduce(((n,i)=>void 0===n?i:vM[b[t]+"_"+e](n,i)))})),m=Object.keys(v),n&&m.length&&(y[i?"vlPoint":"vlMulti"]=e===hM?{or:m.reduce(((t,e)=>(t.push(...v[e]),t)),[])}:{and:m.map((t=>({or:v[t]})))}),y}),bM),ez("vlSelectionTuples",(function(t,e){return t.map((t=>Cn({values:e.fields.map((e=>(e.getter||(e.getter=Ue(e.field)))(t.datum)))},e)))}));const iz=Wn(["rule"]),rz=Wn(["group","image","rect"]);function sz(t){return(t+"").toLowerCase()}function oz(t,e,n){";"!==n[n.length-1]&&(n="return("+n+");");const i=Function(...e.concat(n));return t&&t.functions?i.bind(t.functions):i}var az={operator:(t,e)=>oz(t,["_"],e.code),parameter:(t,e)=>oz(t,["datum","_"],e.code),event:(t,e)=>oz(t,["event"],e.code),handler:(t,e)=>oz(t,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(e.code,";")),encode:(t,e)=>{const{marktype:n,channels:i}=e;let r="var o=item,datum=o.datum,m=0,$;";for(const t in i){const e="o["+Rn(t)+"]";r+="$=".concat(i[t].code,";if(").concat(e,"!==$)").concat(e,"=$,m=1;")}return r+=function(t,e){let n="";return iz[e]||(t.x2&&(t.x?(rz[e]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),t.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),t.y2&&(t.y?(rz[e]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),t.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(i,n),r+="return m;",oz(t,["item","_"],r)},codegen:{get(t){const e="[".concat(t.map(Rn).join("]["),"]"),n=Function("_","return _".concat(e,";"));return n.path=e,n},comparator(t,e){let n;const i=Function("a","b","var u, v; return "+t.map(((t,i)=>{const r=e[i];let s,o;return t.path?(s="a".concat(t.path),o="b".concat(t.path)):((n=n||{})["f"+i]=t,s="this.f".concat(i,"(a)"),o="this.f".concat(i,"(b)")),function(t,e,n,i){return"((u = ".concat(t,") < (v = ").concat(e,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(i,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(i," : ")}(s,o,-r,r)})).join("")+"0;");return n?i.bind(n):i}}};function uz(t,e,n){if(!t||!Ke(t))return t;for(let i,r=0,s=lz.length;r<s;++r)if(i=lz[r],Fn(t,i.key))return i.parse(t,e,n);return t}var lz=[{key:"$ref",parse:function(t,e){return e.get(t.$ref)||Le("Operator not defined: "+t.$ref)}},{key:"$key",parse:function(t,e){const n="k:"+t.$key+"_"+!!t.$flat;return e.fn[n]||(e.fn[n]=Bn(t.$key,t.$flat,e.expr.codegen))}},{key:"$expr",parse:function(t,e,n){t.$params&&e.parseParameters(t.$params,n);const i="e:"+t.$expr.code+"_"+t.$name;return e.fn[i]||(e.fn[i]=$e(e.parameterExpression(t.$expr),t.$fields,t.$name))}},{key:"$field",parse:function(t,e){if(!t.$field)return null;const n="f:"+t.$field+"_"+t.$name;return e.fn[n]||(e.fn[n]=Ue(t.$field,t.$name,e.expr.codegen))}},{key:"$encode",parse:function(t,e){const n=t.$encode,i={};for(const t in n){const r=n[t];i[t]=$e(e.encodeExpression(r.$expr),r.$fields),i[t].output=r.$output}return i}},{key:"$compare",parse:function(t,e){const n="c:"+t.$compare+"_"+t.$order,i=mn(t.$compare).map((t=>t&&t.$tupleid?Ka:t));return e.fn[n]||(e.fn[n]=vn(i,t.$order,e.expr.codegen))}},{key:"$context",parse:function(t,e){return e}},{key:"$subflow",parse:function(t,e){const n=t.$subflow;return function(t,i,r){const s=e.fork().parse(n),o=s.get(n.operators[0].id),a=s.signals.parent;return a&&a.set(r),o.detachSubflow=()=>e.detach(s),o}}},{key:"$tupleid",parse:function(){return Ka}}];const cz={skip:!0};function hz(t,e,n,i){return new fz(t,e,n,i)}function fz(t,e,n,i){this.dataflow=t,this.transforms=e,this.events=t.events.bind(t),this.expr=i||az,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function dz(t){this.dataflow=t.dataflow,this.transforms=t.transforms,this.events=t.events,this.expr=t.expr,this.signals=Object.create(t.signals),this.scales=Object.create(t.scales),this.nodes=Object.create(t.nodes),this.data=Object.create(t.data),this.fn=Object.create(t.fn),t.functions&&(this.functions=Object.create(t.functions),this.functions.context=this)}function pz(t,e){t&&(null==e?t.removeAttribute("aria-label"):t.setAttribute("aria-label",e))}fz.prototype=dz.prototype={fork(){const t=new dz(this);return(this.subcontext||(this.subcontext=[])).push(t),t},detach(t){this.subcontext=this.subcontext.filter((e=>e!==t));const e=Object.keys(t.nodes);for(const n of e)t.nodes[n]._targets=null;for(const n of e)t.nodes[n].detach();t.nodes=null},get(t){return this.nodes[t]},set(t,e){return this.nodes[t]=e},add(t,e){const n=this,i=n.dataflow,r=t.value;if(n.set(t.id,e),"collect"===sz(t.type)&&r&&(r.$ingest?i.ingest(e,r.$ingest,r.$format):r.$request?i.preload(e,r.$request,r.$format):i.pulse(e,i.changeset().insert(r))),t.root&&(n.root=e),t.parent){let r=n.get(t.parent.$ref);r?(i.connect(r,[e]),e.targets().add(r)):(n.unresolved=n.unresolved||[]).push((()=>{r=n.get(t.parent.$ref),i.connect(r,[e]),e.targets().add(r)}))}if(t.signal&&(n.signals[t.signal]=e),t.scale&&(n.scales[t.scale]=e),t.data)for(const i in t.data){const r=n.data[i]||(n.data[i]={});t.data[i].forEach((t=>r[t]=e))}},resolve(){return(this.unresolved||[]).forEach((t=>t())),delete this.unresolved,this},operator(t,e){this.add(t,this.dataflow.add(t.value,e))},transform(t,e){this.add(t,this.dataflow.add(this.transforms[sz(e)]))},stream(t,e){this.set(t.id,e)},update(t,e,n,i,r){this.dataflow.on(e,n,i,r,t.options)},operatorExpression(t){return this.expr.operator(this,t)},parameterExpression(t){return this.expr.parameter(this,t)},eventExpression(t){return this.expr.event(this,t)},handlerExpression(t){return this.expr.handler(this,t)},encodeExpression(t){return this.expr.encode(this,t)},parse:function(t){const e=this,n=t.operators||[];return t.background&&(e.background=t.background),t.eventConfig&&(e.eventConfig=t.eventConfig),t.locale&&(e.locale=t.locale),n.forEach((t=>e.parseOperator(t))),n.forEach((t=>e.parseOperatorParameters(t))),(t.streams||[]).forEach((t=>e.parseStream(t))),(t.updates||[]).forEach((t=>e.parseUpdate(t))),e.resolve()},parseOperator:function(t){const e=this;"operator"!==sz(t.type)&&t.type?e.transform(t,t.type):e.operator(t,t.update?e.operatorExpression(t.update):null)},parseOperatorParameters:function(t){const e=this;if(t.params){const n=e.get(t.id);n||Le("Invalid operator id: "+t.id),e.dataflow.connect(n,n.parameters(e.parseParameters(t.params),t.react,t.initonly))}},parseParameters:function(t,e){e=e||{};const n=this;for(const i in t){const r=t[i];e[i]=Ze(r)?r.map((t=>uz(t,n,e))):uz(r,n,e)}return e},parseStream:function(t){var e,n=this,i=null!=t.filter?n.eventExpression(t.filter):void 0,r=null!=t.stream?n.get(t.stream):void 0;t.source?r=n.events(t.source,t.type,i):t.merge&&(r=(e=t.merge.map((t=>n.get(t))))[0].merge.apply(e[0],e.slice(1))),t.between&&(e=t.between.map((t=>n.get(t))),r=r.between(e[0],e[1])),t.filter&&(r=r.filter(i)),null!=t.throttle&&(r=r.throttle(+t.throttle)),null!=t.debounce&&(r=r.debounce(+t.debounce)),null==r&&Le("Invalid stream definition: "+JSON.stringify(t)),t.consume&&r.consume(!0),n.stream(t,r)},parseUpdate:function(t){var e,n=this,i=Ke(i=t.source)?i.$ref:i,r=n.get(i),s=t.update,o=void 0;r||Le("Source not defined: "+t.source),e=t.target&&t.target.$expr?n.eventExpression(t.target.$expr):n.get(t.target),s&&s.$expr&&(s.$params&&(o=n.parseParameters(s.$params)),s=n.handlerExpression(s.$expr)),n.update(t,r,e,s,o)},getState:function(t){var e=this,n={};if(t.signals){var i=n.signals={};Object.keys(e.signals).forEach((n=>{const r=e.signals[n];t.signals(n,r)&&(i[n]=r.value)}))}if(t.data){var r=n.data={};Object.keys(e.data).forEach((n=>{const i=e.data[n];t.data(n,i)&&(r[n]=i.input.value)}))}return e.subcontext&&!1!==t.recurse&&(n.subcontext=e.subcontext.map((e=>e.getState(t)))),n},setState:function(t){var e=this,n=e.dataflow,i=t.data,r=t.signals;Object.keys(r||{}).forEach((t=>{n.update(e.signals[t],r[t],cz)})),Object.keys(i||{}).forEach((t=>{n.pulse(e.data[t].input,n.changeset().remove(Ge).insert(i[t]))})),(t.subcontext||[]).forEach(((t,n)=>{const i=e.subcontext[n];i&&i.setState(t)}))}};const gz="default";function mz(t,e){const n=t.globalCursor()?"undefined"!=typeof document&&document.body:t.container();if(n)return null==e?n.style.removeProperty("cursor"):n.style.cursor=e}function yz(t,e){var n=t._runtime.data;return Fn(n,e)||Le("Unrecognized data set: "+e),n[e]}function vz(t,e){su(e)||Le("Second argument to changes must be a changeset.");const n=yz(this,t);return n.modified=!0,this.pulse(n.input,e)}function bz(t){var e=t.padding();return Math.max(0,t._viewWidth+e.left+e.right)}function xz(t){var e=t.padding();return Math.max(0,t._viewHeight+e.top+e.bottom)}function wz(t){var e=t.padding(),n=t._origin;return[e.left+n[0],e.top+n[1]]}const Az="view",_z={trap:!1};function kz(t,e,n,i){t._eventListeners.push({type:n,sources:mn(e),handler:i})}function Cz(t,e,n){const i=t._eventConfig&&t._eventConfig[e];return!(!1===i||Ke(i)&&!i[n])||(t.warn(`Blocked ${e} ${n} event listener.`),!1)}function Ez(t){return t.item}function Dz(t){return t.item.mark.source}function Fz(t){return function(e,n){return n.vega.view().changeset().encode(n.item,t)}}function Sz(t,e,n){const i=document.createElement(t);for(const t in e)i.setAttribute(t,e[t]);return null!=n&&(i.textContent=n),i}function Oz(t,e,n,i){const r=n.event||"input",s=()=>t.update(e.value);i.signal(n.signal,e.value),e.addEventListener(r,s),kz(i,e,r,s),t.set=t=>{e.value=t,e.dispatchEvent(function(t){return"undefined"!=typeof Event?new Event(t):{type:t}}(r))}}function Nz(t,e,n,i){const r=i.signal(n.signal),s=Sz("div",{class:"vega-bind"}),o="radio"===n.input?s:s.appendChild(Sz("label"));o.appendChild(Sz("span",{class:"vega-bind-name"},n.name||n.signal)),e.appendChild(s);let a=Mz;switch(n.input){case"checkbox":a=zz;break;case"select":a=$z;break;case"radio":a=Tz;break;case"range":a=Bz}a(t,o,n,r)}function Mz(t,e,n,i){const r=Sz("input");for(const t in n)"signal"!==t&&"element"!==t&&r.setAttribute("input"===t?"type":t,n[t]);r.setAttribute("name",n.signal),r.value=i,e.appendChild(r),r.addEventListener("input",(()=>t.update(r.value))),t.elements=[r],t.set=t=>r.value=t}function zz(t,e,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const s=Sz("input",r);e.appendChild(s),s.addEventListener("change",(()=>t.update(s.checked))),t.elements=[s],t.set=t=>s.checked=!!t||null}function $z(t,e,n,i){const r=Sz("select",{name:n.signal}),s=n.labels||[];n.options.forEach(((t,e)=>{const n={value:t};jz(t,i)&&(n.selected=!0),r.appendChild(Sz("option",n,(s[e]||t)+""))})),e.appendChild(r),r.addEventListener("change",(()=>{t.update(n.options[r.selectedIndex])})),t.elements=[r],t.set=t=>{for(let e=0,i=n.options.length;e<i;++e)if(jz(n.options[e],t))return void(r.selectedIndex=e)}}function Tz(t,e,n,i){const r=Sz("span",{class:"vega-bind-radio"}),s=n.labels||[];e.appendChild(r),t.elements=n.options.map(((e,o)=>{const a={type:"radio",name:n.signal,value:e};jz(e,i)&&(a.checked=!0);const u=Sz("input",a);u.addEventListener("change",(()=>t.update(e)));const l=Sz("label",{},(s[o]||e)+"");return l.prepend(u),r.appendChild(l),u})),t.set=e=>{const n=t.elements,i=n.length;for(let t=0;t<i;++t)jz(n[t].value,e)&&(n[t].checked=!0)}}function Bz(t,e,n,i){i=void 0!==i?i:(+n.max+ +n.min)/2;const r=null!=n.max?n.max:Math.max(100,+i)||100,s=n.min||Math.min(0,r,+i)||0,o=n.step||hi(s,r,100),a=Sz("input",{type:"range",name:n.signal,min:s,max:r,step:o});a.value=i;const u=Sz("span",{},+i);e.appendChild(a),e.appendChild(u);const l=()=>{u.textContent=a.value,t.update(+a.value)};a.addEventListener("input",l),a.addEventListener("change",l),t.elements=[a],t.set=t=>{a.value=t,u.textContent=t}}function jz(t,e){return t===e||t+""==e+""}function Iz(t,e,n,i,r,s){return(e=e||new i(t.loader())).initialize(n,bz(t),xz(t),wz(t),r,s).background(t.background())}function Rz(t,e){return e?function(){try{e.apply(this,arguments)}catch(e){t.error(e)}}:null}function Lz(t,e,n){if("string"==typeof e){if("undefined"==typeof document)return t.error("DOM document instance not found."),null;if(!(e=document.querySelector(e)))return t.error("Signal bind element not found: "+e),null}if(e&&n)try{e.innerHTML=""}catch(n){e=null,t.error(n)}return e}const Pz=t=>+t||0;function Uz(t){return Ke(t)?{top:Pz(t.top),bottom:Pz(t.bottom),left:Pz(t.left),right:Pz(t.right)}:(t=>({top:t,bottom:t,left:t,right:t}))(Pz(t))}async function qz(t,e,n,i){const r=Qx(e),s=r&&r.headless;return s||Le("Unrecognized renderer type: "+e),await t.runAsync(),Iz(t,null,null,s,n,i).renderAsync(t._scenegraph.root)}var Wz="padding",Hz={skip:!0};function Vz(t,e){var n=t.autosize(),i=t.padding();return e-(n&&n.contains===Wz?i.left+i.right:0)}function Gz(t,e){var n=t.autosize(),i=t.padding();return e-(n&&n.contains===Wz?i.top+i.bottom:0)}function Xz(t,e){return e.modified&&Ze(e.input.value)&&t.indexOf("_:vega:_")}function Yz(t,e){return!("parent"===t||e instanceof Nu.proxy)}function Jz(t,e,n,i){const r=t.element();r&&r.setAttribute("title",function(t){return null==t?"":Ze(t)?Zz(t):Ke(t)&&!zn(t)?(e=t,Object.keys(e).map((t=>{const n=e[t];return t+": "+(Ze(n)?Zz(n):Kz(n))})).join("\n")):t+"";var e}(i))}function Zz(t){return"["+t.map(Kz).join(", ")+"]"}function Kz(t){return Ze(t)?"[]":Ke(t)&&!zn(t)?"{}":t}function Qz(t,e){const n=this;if(e=e||{},Fu.call(n),e.loader&&n.loader(e.loader),e.logger&&n.logger(e.logger),null!=e.logLevel&&n.logLevel(e.logLevel),e.locale||t.locale){const i=Cn({},t.locale,e.locale);n.locale(ya(i.number,i.time))}n._el=null,n._elBind=null,n._renderType=e.renderer||Zx.Canvas,n._scenegraph=new zb;const i=n._scenegraph.root;n._renderer=null,n._tooltip=e.tooltip||Jz,n._redraw=!0,n._handler=(new sx).scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(t){const e=Cn({defaults:{}},t),n=(t,e)=>{e.forEach((e=>{Ze(t[e])&&(t[e]=Wn(t[e]))}))};return n(e.defaults,["prevent","allow"]),n(e,["view","window","selector"]),e}(t.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=function(t,e,n){return hz(t,Nu,YM,n).parse(e)}(n,t,e.expr);n._runtime=r,n._signals=r.signals,n._bind=(t.bindings||[]).map((t=>({state:null,param:Cn({},t)}))),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=Vz(n,n._width),n._viewHeight=Gz(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(t){var e=t._signals,n=e.width,i=e.height,r=e.padding;function s(){t._autosize=t._resize=1}t._resizeWidth=t.add(null,(e=>{t._width=e.size,t._viewWidth=Vz(t,e.size),s()}),{size:n}),t._resizeHeight=t.add(null,(e=>{t._height=e.size,t._viewHeight=Gz(t,e.size),s()}),{size:i});const o=t.add(null,s,{pad:r});t._resizeWidth.rank=n.rank+1,t._resizeHeight.rank=i.rank+1,o.rank=r.rank+1}(n),function(t){t.add(null,(e=>(t._background=e.bg,t._resize=1,e.bg)),{bg:t._signals.background})}(n),function(t){const e=t._signals.cursor||(t._signals.cursor=t.add({user:gz,item:null}));t.on(t.events("view","mousemove"),e,((t,n)=>{const i=e.value,r=i?Tn(i)?i:i.user:gz,s=n.item&&n.item.cursor||null;return i&&r===i.user&&s==i.item?i:{user:r,item:s}})),t.add(null,(function(e){let n=e.cursor,i=this.value;return Tn(n)||(i=n.item,n=n.user),mz(t,n&&n!==gz?n:i||n),i}),{cursor:e})}(n),n.description(t.description),e.hover&&n.hover(),e.container&&n.initialize(e.container,e.bind)}function t$(t,e){return Fn(t._signals,e)?t._signals[e]:Le("Unrecognized signal name: "+Rn(e))}function e$(t,e){const n=(t._targets||[]).filter((t=>t._update&&t._update.handler===e));return n.length?n[0]:null}function n$(t,e,n,i){let r=e$(n,i);return r||(r=Rz(t,(()=>i(e,n.value))),r.handler=i,t.on(n,null,r)),t}function i$(t,e,n){const i=e$(e,n);return i&&e._targets.remove(i),t}Nn(Qz,Fu,{async evaluate(t,e,n){if(await Fu.prototype.evaluate.call(this,t,e),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,r=wz(i=this),s=bz(i),o=xz(i),i._renderer.background(i.background()),i._renderer.resize(s,o,r),i._handler.origin(r),i._resizeListeners.forEach((t=>{try{t(s,o)}catch(t){i.error(t)}}))),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(t){this.error(t)}var i,r,s,o;return n&&Xa(this,n),this},dirty(t){this._redraw=!0,this._renderer&&this._renderer.dirty(t)},description(t){if(arguments.length){const e=null!=t?t+"":null;return e!==this._desc&&pz(this._el,this._desc=e),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(t,e,n){const i=t$(this,t);return 1===arguments.length?i.value:this.update(i,e,n)},width(t){return arguments.length?this.signal("width",t):this.signal("width")},height(t){return arguments.length?this.signal("height",t):this.signal("height")},padding(t){return arguments.length?this.signal("padding",Uz(t)):Uz(this.signal("padding"))},autosize(t){return arguments.length?this.signal("autosize",t):this.signal("autosize")},background(t){return arguments.length?this.signal("background",t):this.signal("background")},renderer(t){return arguments.length?(Qx(t)||Le("Unrecognized renderer type: "+t),t!==this._renderType&&(this._renderType=t,this._resetRenderer()),this):this._renderType},tooltip(t){return arguments.length?(t!==this._tooltip&&(this._tooltip=t,this._resetRenderer()),this):this._tooltip},loader(t){return arguments.length?(t!==this._loader&&(Fu.prototype.loader.call(this,t),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(t$(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(t,e,n,i,r,s){this.runAfter((o=>{let a=0;o._autosize=0,o.width()!==n&&(a=1,o.signal("width",n,Hz),o._resizeWidth.skip(!0)),o.height()!==i&&(a=1,o.signal("height",i,Hz),o._resizeHeight.skip(!0)),o._viewWidth!==t&&(o._resize=1,o._viewWidth=t),o._viewHeight!==e&&(o._resize=1,o._viewHeight=e),o._origin[0]===r[0]&&o._origin[1]===r[1]||(o._resize=1,o._origin=r),a&&o.run("enter"),s&&o.runAfter((t=>t.resize()))}),!1,1)},addEventListener(t,e,n){let i=e;return n&&!1===n.trap||(i=Rz(this,e),i.raw=e),this._handler.on(t,i),this},removeEventListener(t,e){for(var n,i,r=this._handler.handlers(t),s=r.length;--s>=0;)if(i=r[s].type,n=r[s].handler,t===i&&(e===n||e===n.raw)){this._handler.off(i,n);break}return this},addResizeListener(t){const e=this._resizeListeners;return e.indexOf(t)<0&&e.push(t),this},removeResizeListener(t){var e=this._resizeListeners,n=e.indexOf(t);return n>=0&&e.splice(n,1),this},addSignalListener(t,e){return n$(this,t,t$(this,t),e)},removeSignalListener(t,e){return i$(this,t$(this,t),e)},addDataListener(t,e){return n$(this,t,yz(this,t).values,e)},removeDataListener(t,e){return i$(this,yz(this,t).values,e)},globalCursor(t){if(arguments.length){if(this._globalCursor!==!!t){const e=mz(this,null);this._globalCursor=!!t,e&&mz(this,e)}return this}return this._globalCursor},preventDefault(t){return arguments.length?(this._preventDefault=t,this):this._preventDefault},timer:function(t,e){this._timers.push(function(t,e,n){var i=new sD,r=e;return null==e?(i.restart(t,e,n),i):(i._restart=i.restart,i.restart=function(t,e,n){e=+e,n=null==n?iD():+n,i._restart((function s(o){o+=r,i._restart(s,r+=e,n),t(o)}),e,n)},i.restart(t,e,n),i)}((function(e){t({timestamp:Date.now(),elapsed:e})}),e))},events:function(t,e,n){var i,r=this,s=new pu(n),o=function(n,i){r.runAsync(null,(()=>{t===Az&&function(t,e){var n=t._eventConfig.defaults,i=n.prevent,r=n.allow;return!1!==i&&!0!==r&&(!0===i||!1===r||(i?i[e]:r?!r[e]:t.preventDefault()))}(r,e)&&n.preventDefault(),s.receive(function(t,e,n){var i,r,s=t._renderer,o=s&&s.canvas();return o&&(r=wz(t),(i=Lb(e.changedTouches?e.changedTouches[0]:e,o))[0]-=r[0],i[1]-=r[1]),e.dataflow=t,e.item=n,e.vega=function(t,e,n){const i=e?"group"===e.mark.marktype?e:e.mark.group:null;function r(t){var n,r=i;if(t)for(n=e;n;n=n.mark.group)if(n.mark.name===t){r=n;break}return r&&r.mark&&r.mark.interactive?r:{}}function s(t){if(!t)return n;Tn(t)&&(t=r(t));const e=n.slice();for(;t;)e[0]-=t.x||0,e[1]-=t.y||0,t=t.mark&&t.mark.group;return e}return{view:_n(t),item:_n(e||{}),group:r,xy:s,x:t=>s(t)[0],y:t=>s(t)[1]}}(t,n,i),e}(r,n,i))}))};if("timer"===t)Cz(r,"timer",e)&&r.timer(o,e);else if(t===Az)Cz(r,"view",e)&&r.addEventListener(e,o,_z);else if("window"===t?Cz(r,"window",e)&&"undefined"!=typeof window&&(i=[window]):"undefined"!=typeof document&&Cz(r,"selector",e)&&(i=document.querySelectorAll(t)),i){for(var a=0,u=i.length;a<u;++a)i[a].addEventListener(e,o);kz(r,i,e,o)}else r.warn("Can not resolve event source: "+t);return s},finalize:function(){var t,e,n,i=this._tooltip,r=this._timers,s=this._eventListeners;for(t=r.length;--t>=0;)r[t].stop();for(t=s.length;--t>=0;)for(e=(n=s[t]).sources.length;--e>=0;)n.sources[e].removeEventListener(n.type,n.handler);return i&&i.call(this,this._handler,null,null,null),this},hover:function(t,e){return e=[e||"update",(t=[t||"hover"])[0]],this.on(this.events("view","mouseover",Ez),Dz,Fz(t)),this.on(this.events("view","mouseout",Ez),Dz,Fz(e)),this},data:function(t,e){return arguments.length<2?yz(this,t).values.value:vz.call(this,t,ou().remove(Ge).insert(e))},change:vz,insert:function(t,e){return vz.call(this,t,ou().insert(e))},remove:function(t,e){return vz.call(this,t,ou().remove(e))},scale:function(t){var e=this._runtime.scales;return Fn(e,t)||Le("Unrecognized scale or projection: "+t),e[t].value},initialize:function(t,e){const n=this,i=n._renderType,r=n._eventConfig.bind,s=Qx(i);t=n._el=t?Lz(n,t,!0):null,function(t){const e=t.container();e&&(e.setAttribute("role","graphics-document"),e.setAttribute("aria-roleDescription","visualization"),pz(e,t.description()))}(n),s||n.error("Unrecognized renderer type: "+i);const o=s.handler||sx,a=t?s.renderer:s.headless;return n._renderer=a?Iz(n,n._renderer,t,a):null,n._handler=function(t,e,n,i){const r=new i(t.loader(),Rz(t,t.tooltip())).scene(t.scenegraph().root).initialize(n,wz(t),t);return e&&e.handlers().forEach((t=>{r.on(t.type,t.handler)})),r}(n,n._handler,t,o),n._redraw=!0,t&&"none"!==r&&(e=e?n._elBind=Lz(n,e,!0):t.appendChild(Sz("form",{class:"vega-bindings"})),n._bind.forEach((t=>{t.param.element&&"container"!==r&&(t.element=Lz(n,t.param.element,!!t.param.input))})),n._bind.forEach((t=>{!function(t,e,n){if(!e)return;const i=n.param;let r=n.state;r||(r=n.state={elements:null,active:!1,set:null,update:e=>{e!=t.signal(i.signal)&&t.runAsync(null,(()=>{r.source=!0,t.signal(i.signal,e)}))}},i.debounce&&(r.update=kn(i.debounce,r.update))),(null==i.input&&i.element?Oz:Nz)(r,e,i,t),r.active||(t.on(t._signals[i.signal],null,(()=>{r.source?r.source=!1:r.set(t.signal(i.signal))})),r.active=!0)}(n,t.element||e,t)}))),n},toImageURL:async function(t,e){t!==Zx.Canvas&&t!==Zx.SVG&&t!==Zx.PNG&&Le("Unrecognized image type: "+t);const n=await qz(this,t,e);return t===Zx.SVG?function(t,e){const n=new Blob([t],{type:"image/svg+xml"});return window.URL.createObjectURL(n)}(n.svg()):n.canvas().toDataURL("image/png")},toCanvas:async function(t,e){return(await qz(this,Zx.Canvas,t,e)).canvas()},toSVG:async function(t){return(await qz(this,Zx.SVG,t)).svg()},getState:function(t){return this._runtime.getState(t||{data:Xz,signals:Yz,recurse:!0})},setState:function(t){return this.runAsync(null,(e=>{e._trigger=!1,e._runtime.setState(t)}),(t=>{t._trigger=!0})),this}});const r$=/[[\]{}]/,s$={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let o$,a$;function u$(t,e,n,i,r){const s=t.length;let o,a=0;for(;e<s;++e){if(o=t[e],!a&&o===n)return e;r&&r.indexOf(o)>=0?--a:i&&i.indexOf(o)>=0&&++a}return e}function l$(t){const e=[],n=t.length;let i=0,r=0;for(;r<n;)r=u$(t,r,",","[{","]}"),e.push(t.substring(i,r).trim()),i=++r;if(0===e.length)throw"Empty event selector: "+t;return e}function c$(t){return"["===t[0]?function(t){const e=t.length;let n,i=1;if(i=u$(t,i,"]","[","]"),i===e)throw"Empty between selector: "+t;if(n=l$(t.substring(1,i)),2!==n.length)throw"Between selector must have two elements: "+t;if(">"!==(t=t.slice(i+1).trim())[0])throw"Expected '>' after between selector: "+t;n=n.map(c$);const r=c$(t.slice(1).trim());return r.between?{between:n,stream:r}:(r.between=n,r)}(t):function(t){const e={source:o$},n=[];let i,r,s=[0,0],o=0,a=0,u=t.length,l=0;if("}"===t[u-1]){if(l=t.lastIndexOf("{"),!(l>=0))throw"Unmatched right brace: "+t;try{s=function(t){const e=t.split(",");if(!t.length||e.length>2)throw t;return e.map((e=>{const n=+e;if(n!=n)throw t;return n}))}(t.substring(l+1,u-1))}catch(e){throw"Invalid throttle specification: "+t}u=(t=t.slice(0,l).trim()).length,l=0}if(!u)throw t;if("@"===t[0]&&(o=++l),i=u$(t,l,":"),i<u&&(n.push(t.substring(a,i).trim()),a=l=++i),l=u$(t,l,"["),l===u)n.push(t.substring(a,u).trim());else if(n.push(t.substring(a,l).trim()),r=[],a=++l,a===u)throw"Unmatched left bracket: "+t;for(;l<u;){if(l=u$(t,l,"]"),l===u)throw"Unmatched left bracket: "+t;if(r.push(t.substring(a,l).trim()),l<u-1&&"["!==t[++l])throw"Expected left bracket: "+t;a=++l}if(!(u=n.length)||r$.test(n[u-1]))throw"Invalid event selector: "+t;var c;return u>1?(e.type=n[1],o?e.markname=n[0].slice(1):(c=n[0],a$[c]?e.marktype=n[0]:e.source=n[0])):e.type=n[0],"!"===e.type.slice(-1)&&(e.consume=!0,e.type=e.type.slice(0,-1)),null!=r&&(e.filter=r),s[0]&&(e.throttle=s[0]),s[1]&&(e.debounce=s[1]),e}(t)}function h$(t){return Ke(t)?t:{type:t||"pad"}}const f$=t=>+t||0;function d$(t){return Ke(t)?t.signal?t:{top:f$(t.top),bottom:f$(t.bottom),left:f$(t.left),right:f$(t.right)}:{top:e=f$(t),bottom:e,left:e,right:e};var e}const p$=t=>Ke(t)&&!Ze(t)?Cn({},t):{value:t};function g$(t,e,n,i){return null!=n?(Ke(n)&&!Ze(n)||Ze(n)&&n.length&&Ke(n[0])?t.update[e]=n:t[i||"enter"][e]={value:n},1):0}function m$(t,e,n){for(const n in e)g$(t,n,e[n]);for(const e in n)g$(t,e,n[e],"update")}function y$(t,e,n){for(const i in e)n&&Fn(n,i)||(t[i]=Cn(t[i]||{},e[i]));return t}function v$(t,e){return e&&(e.enter&&e.enter[t]||e.update&&e.update[t])}const b$="mark",x$="frame",w$="scope",A$="legend-label";function _$(t,e,n){t[e]=n&&n.signal?{signal:n.signal}:{value:n}}const k$=t=>Tn(t)?Rn(t):t.signal?`(${t.signal})`:F$(t);function C$(t){if(null!=t.gradient)return function(t){const e=[t.start,t.stop,t.count].map((t=>null==t?null:Rn(t)));for(;e.length&&null==nn(e);)e.pop();return e.unshift(k$(t.gradient)),`gradient(${e.join(",")})`}(t);let e=t.signal?`(${t.signal})`:t.color?function(t){return t.c?E$("hcl",t.h,t.c,t.l):t.h||t.s?E$("hsl",t.h,t.s,t.l):t.l||t.a?E$("lab",t.l,t.a,t.b):t.r||t.g||t.b?E$("rgb",t.r,t.g,t.b):null}(t.color):null!=t.field?F$(t.field):void 0!==t.value?Rn(t.value):void 0;return null!=t.scale&&(e=function(t,e){const n=k$(t.scale);return null!=t.range?e=`lerp(_range(${n}), ${+t.range})`:(void 0!==e&&(e=`_scale(${n}, ${e})`),t.band&&(e=(e?e+"+":"")+`_bandwidth(${n})`+(1==+t.band?"":"*"+D$(t.band)),t.extra&&(e=`(datum.extra ? _scale(${n}, datum.extra.value) : ${e})`)),null==e&&(e="0")),e}(t,e)),void 0===e&&(e=null),null!=t.exponent&&(e=`pow(${e},${D$(t.exponent)})`),null!=t.mult&&(e+=`*${D$(t.mult)}`),null!=t.offset&&(e+=`+${D$(t.offset)}`),t.round&&(e=`round(${e})`),e}const E$=(t,e,n,i)=>`(${t}(${[e,n,i].map(C$).join(",")})+'')`;function D$(t){return Ke(t)?"("+C$(t)+")":t}function F$(t){return S$(Ke(t)?t:{datum:t})}function S$(t){let e,n,i;if(t.signal)e="datum",i=t.signal;else if(t.group||t.parent){for(n=Math.max(1,t.level||1),e="item";n-- >0;)e+=".mark.group";t.parent?(i=t.parent,e+=".datum"):i=t.group}else t.datum?(e="datum",i=t.datum):Le("Invalid field reference: "+Rn(t));return t.signal||(i=Tn(i)?Pe(i).map(Rn).join("]["):S$(i)),e+"["+i+"]"}function O$(t,e,n,i,r,s){const o={};(s=s||{}).encoders={$encode:o},t=function(t,e,n,i,r){const s={},o={};let a,u,l,c;for(u in u="lineBreak","text"!==e||null==r[u]||v$(u,t)||_$(s,u,r[u]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c=n===x$?r.group:n===b$?Cn({},r.mark,r[e]):null,c)l=v$(u,t)||("fill"===u||"stroke"===u)&&(v$("fill",t)||v$("stroke",t)),l||_$(s,u,c[u]);for(u in mn(i).forEach((e=>{const n=r.style&&r.style[e];for(const e in n)v$(e,t)||_$(s,e,n[e])})),t=Cn({},t),s)c=s[u],c.signal?(a=a||{})[u]=c:o[u]=c;return t.enter=Cn(o,t.enter),a&&(t.update=Cn(a,t.update)),t}(t,e,n,i,r.config);for(const n in t)o[n]=N$(t[n],e,s,r);return s}function N$(t,e,n,i){const r={},s={};for(const e in t)null!=t[e]&&(r[e]=M$((o=t[e],Ze(o)?function(t){let e="";return t.forEach((t=>{const n=C$(t);e+=t.test?`(${t.test})?${n}:`:n})),":"===nn(e)&&(e+="null"),e}(o):C$(o)),i,n,s));var o;return{$expr:{marktype:e,channels:r},$fields:Object.keys(s),$output:Object.keys(t)}}function M$(t,e,n,i){const r=nz(t,e);return r.$fields.forEach((t=>i[t]=1)),Cn(n,r.$params),r.$expr}const z$=["value","update","init","react","bind"];function $$(t,e){Le(t+' for "outer" push: '+Rn(e))}function T$(t,e){const n=t.name;if("outer"===t.push)e.signals[n]||$$("No prior signal definition",n),z$.forEach((e=>{void 0!==t[e]&&$$("Invalid property ",e)}));else{const i=e.addSignal(n,t.value);!1===t.react&&(i.react=!1),t.bind&&e.addBinding(n,t.bind)}}function B$(t,e,n,i){this.id=-1,this.type=t,this.value=e,this.params=n,i&&(this.parent=i)}function j$(t,e,n,i){return new B$(t,e,n,i)}function I$(t,e){return j$("operator",t,e)}function R$(t){const e={$ref:t.id};return t.id<0&&(t.refs=t.refs||[]).push(e),e}function L$(t,e){return e?{$field:t,$name:e}:{$field:t}}const P$=L$("key");function U$(t,e){return{$compare:t,$order:e}}function q$(t,e){return(t&&t.signal?"$"+t.signal:t||"")+(t&&e?"_":"")+(e&&e.signal?"$"+e.signal:e||"")}const W$="scope",H$="view";function V$(t){return t&&t.signal}function G$(t){if(V$(t))return!0;if(Ke(t))for(const e in t)if(G$(t[e]))return!0;return!1}function X$(t,e){return null!=t?t:e}function Y$(t){return t&&t.signal||t}const J$="timer";function Z$(t,e){return(t.merge?K$:t.stream?Q$:t.type?tT:Le("Invalid stream specification: "+Rn(t)))(t,e)}function K$(t,e){const n=eT({merge:t.merge.map((t=>Z$(t,e)))},t,e);return e.addStream(n).id}function Q$(t,e){const n=eT({stream:Z$(t.stream,e)},t,e);return e.addStream(n).id}function tT(t,e){let n;var i;t.type===J$?(n=e.event(J$,t.throttle),t={between:t.between,filter:t.filter}):n=e.event((i=t.source)===W$?H$:i||H$,t.type);const r=eT({stream:n},t,e);return 1===Object.keys(r).length?n:e.addStream(r).id}function eT(t,e,n){let i=e.between;return i&&(2!==i.length&&Le('Stream "between" parameter must have 2 entries: '+Rn(e)),t.between=[Z$(i[0],n),Z$(i[1],n)]),i=e.filter?[].concat(e.filter):[],(e.marktype||e.markname||e.markrole)&&i.push(function(t,e,n){const i="event.item";return i+(t&&"*"!==t?"&&"+i+".mark.marktype==='"+t+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(e?"&&"+i+".mark.name==='"+e+"'":"")}(e.marktype,e.markname,e.markrole)),e.source===W$&&i.push("inScope(event.item)"),i.length&&(t.filter=nz("("+i.join(")&&(")+")",n).$expr),null!=(i=e.throttle)&&(t.throttle=+i),null!=(i=e.debounce)&&(t.debounce=+i),e.consume&&(t.consume=!0),t}const nT={code:"_.$value",ast:{type:"Identifier",value:"value"}};function iT(t){return{signal:"["+t.map((t=>t.scale?'scale("'+t.scale+'")':t.signal))+"]"}}const rT=t=>(e,n,i)=>j$(t,n,e||void 0,i),sT=rT("aggregate"),oT=rT("axisticks"),aT=rT("bound"),uT=rT("collect"),lT=rT("compare"),cT=rT("datajoin"),hT=rT("encode"),fT=rT("expression"),dT=rT("facet"),pT=rT("field"),gT=rT("key"),mT=rT("legendentries"),yT=rT("load"),vT=rT("mark"),bT=rT("multiextent"),xT=rT("multivalues"),wT=rT("overlap"),AT=rT("params"),_T=rT("prefacet"),kT=rT("projection"),CT=rT("proxy"),ET=rT("relay"),DT=rT("render"),FT=rT("scale"),ST=rT("sieve"),OT=rT("sortitems"),NT=rT("viewlayout"),MT=rT("values");let zT=0;const $T={min:"min",max:"max",count:"sum"};function TT(t,e){const n=e.getScale(t.name).params;let i;for(i in n.domain=RT(t.domain,t,e),null!=t.range&&(n.range=GT(t,e,n)),null!=t.interpolate&&function(t,e){e.interpolate=BT(t.type||t),null!=t.gamma&&(e.interpolateGamma=BT(t.gamma))}(t.interpolate,n),null!=t.nice&&(n.nice=function(t){return Ke(t)?{interval:BT(t.interval),step:BT(t.step)}:BT(t)}(t.nice)),null!=t.bins&&(n.bins=function(t,e){return t.signal||Ze(t)?jT(t,e):e.objectProperty(t)}(t.bins,e)),t)Fn(n,i)||"name"===i||(n[i]=BT(t[i],e))}function BT(t,e){return Ke(t)?t.signal?e.signalRef(t.signal):Le("Unsupported object: "+Rn(t)):t}function jT(t,e){return t.signal?e.signalRef(t.signal):t.map((t=>BT(t,e)))}function IT(t){Le("Can not find data set: "+Rn(t))}function RT(t,e,n){if(t)return t.signal?n.signalRef(t.signal):(Ze(t)?LT:t.fields?UT:PT)(t,e,n);null==e.domainMin&&null==e.domainMax||Le("No scale domain defined for domainMin/domainMax to override.")}function LT(t,e,n){return t.map((t=>BT(t,n)))}function PT(t,e,n){const i=n.getData(t.data);return i||IT(t.data),Kg(e.type)?i.valuesRef(n,t.field,WT(t.sort,!1)):nm(e.type)?i.domainRef(n,t.field):i.extentRef(n,t.field)}function UT(t,e,n){const i=t.data,r=t.fields.reduce(((t,e)=>(e=Tn(e)?{data:i,field:e}:Ze(e)||e.signal?function(t,e){const n="_:vega:_"+zT++,i=uT({});if(Ze(t))i.value={$ingest:t};else if(t.signal){const r="setdata("+Rn(n)+","+t.signal+")";i.params.input=e.signalRef(r)}return e.addDataPipeline(n,[i,ST({})]),{data:n,field:"data"}}(e,n):e,t.push(e),t)),[]);return(Kg(e.type)?qT:nm(e.type)?HT:VT)(t,n,r)}function qT(t,e,n){const i=WT(t.sort,!0);let r,s;const o=n.map((t=>{const n=e.getData(t.data);return n||IT(t.data),n.countsRef(e,t.field,i)})),a={groupby:P$,pulse:o};i&&(r=i.op||"count",s=i.field?q$(r,i.field):"count",a.ops=[$T[r]],a.fields=[e.fieldRef(s)],a.as=[s]),r=e.add(sT(a));const u=e.add(uT({pulse:R$(r)}));return s=e.add(MT({field:P$,sort:e.sortRef(i),pulse:R$(u)})),R$(s)}function WT(t,e){return t&&(t.field||t.op?t.field||"count"===t.op?e&&t.field&&t.op&&!$T[t.op]&&Le("Multiple domain scales can not be sorted using "+t.op):Le("No field provided for sort aggregate op: "+t.op):Ke(t)?t.field="key":t={field:"key"}),t}function HT(t,e,n){const i=n.map((t=>{const n=e.getData(t.data);return n||IT(t.data),n.domainRef(e,t.field)}));return R$(e.add(xT({values:i})))}function VT(t,e,n){const i=n.map((t=>{const n=e.getData(t.data);return n||IT(t.data),n.extentRef(e,t.field)}));return R$(e.add(bT({extents:i})))}function GT(t,e,n){const i=e.config.range;let r=t.range;if(r.signal)return e.signalRef(r.signal);if(Tn(r)){if(i&&Fn(i,r))return GT(t=Cn({},t,{range:i[r]}),e,n);"width"===r?r=[0,{signal:"width"}]:"height"===r?r=Kg(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]:Le("Unrecognized scale range value: "+Rn(r))}else{if(r.scheme)return n.scheme=Ze(r.scheme)?jT(r.scheme,e):BT(r.scheme,e),r.extent&&(n.schemeExtent=jT(r.extent,e)),void(r.count&&(n.schemeCount=BT(r.count,e)));if(r.step)return void(n.rangeStep=BT(r.step,e));if(Kg(t.type)&&!Ze(r))return RT(r,t,e);Ze(r)||Le("Unsupported range type: "+Rn(r))}return r.map((t=>(Ze(t)?jT:BT)(t,e)))}function XT(t,e,n){return Ze(t)?t.map((t=>XT(t,e,n))):Ke(t)?t.signal?n.signalRef(t.signal):"fit"===e?t:Le("Unsupported parameter object: "+Rn(t)):t}const YT="top",JT="left",ZT="right",KT="bottom",QT="label",tB="perc",eB="value",nB="guide-label",iB="guide-title",rB="symbol",sB="gradient",oB="discrete",aB="size",uB=[aB,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],lB={name:1,style:1,interactive:1},cB={value:0},hB={value:1},fB="group",dB="rect",pB="rule",gB="text";function mB(t){return t.type=fB,t.interactive=t.interactive||!1,t}function yB(t,e){const n=(n,i)=>X$(t[n],X$(e[n],i));return n.isVertical=n=>"vertical"===X$(t.direction,e.direction||(n?e.symbolDirection:e.gradientDirection)),n.gradientLength=()=>X$(t.gradientLength,e.gradientLength||e.gradientWidth),n.gradientThickness=()=>X$(t.gradientThickness,e.gradientThickness||e.gradientHeight),n.entryColumns=()=>X$(t.columns,X$(e.columns,+n.isVertical(!0))),n}function vB(t,e){const n=e&&(e.update&&e.update[t]||e.enter&&e.enter[t]);return n&&n.signal?n:n?n.value:null}function bB(t,e,n){return`item.anchor === 'start' ? ${t} : item.anchor === 'end' ? ${e} : ${n}`}const xB=bB(Rn(JT),Rn(ZT),Rn("center"));function wB(t,e){return e?t?Ke(t)?Object.assign({},t,{offset:wB(t.offset,e)}):{value:t,offset:e}:e:t}function AB(t,e){return e?(t.name=e.name,t.style=e.style||t.style,t.interactive=!!e.interactive,t.encode=y$(t.encode,e,lB)):t.interactive=!1,t}function _B(t,e,n,i){const r=yB(t,n),s=r.isVertical(),o=r.gradientThickness(),a=r.gradientLength();let u,l,c,h,f;s?(l=[0,1],c=[0,0],h=o,f=a):(l=[0,0],c=[1,0],h=a,f=o);const d={enter:u={opacity:cB,x:cB,y:cB,width:p$(h),height:p$(f)},update:Cn({},u,{opacity:hB,fill:{gradient:e,start:l,stop:c}}),exit:{opacity:cB}};return m$(d,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),AB({type:dB,role:"legend-gradient",encode:d},i)}function kB(t,e,n,i,r){const s=yB(t,n),o=s.isVertical(),a=s.gradientThickness(),u=s.gradientLength();let l,c,h,f,d="";o?(l="y",h="y2",c="x",f="width",d="1-"):(l="x",h="x2",c="y",f="height");const p={opacity:cB,fill:{scale:e,field:eB}};p[l]={signal:d+"datum."+tB,mult:u},p[c]=cB,p[h]={signal:d+"datum.perc2",mult:u},p[f]=p$(a);const g={enter:p,update:Cn({},p,{opacity:hB}),exit:{opacity:cB}};return m$(g,{stroke:s("gradientStrokeColor"),strokeWidth:s("gradientStrokeWidth")},{opacity:s("gradientOpacity")}),AB({type:dB,role:"legend-band",key:eB,from:r,encode:g},i)}function CB(t,e,n,i){const r=yB(t,e),s=r.isVertical(),o=p$(r.gradientThickness()),a=r.gradientLength();let u,l,c,h,f=r("labelOverlap"),d="";const p={enter:u={opacity:cB},update:l={opacity:hB,text:{field:QT}},exit:{opacity:cB}};return m$(p,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:X$(t.labelLimit,e.gradientLabelLimit)}),s?(u.align={value:"left"},u.baseline=l.baseline={signal:'datum.perc<=0?"bottom":datum.perc>=1?"top":"middle"'},c="y",h="x",d="1-"):(u.align=l.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},u.baseline={value:"top"},c="x",h="y"),u[c]=l[c]={signal:d+"datum."+tB,mult:a},u[h]=l[h]=o,o.offset=X$(t.labelOffset,e.gradientLabelOffset)||0,f=f?{separation:r("labelSeparation"),method:f,order:"datum.index"}:void 0,AB({type:gB,role:A$,style:nB,key:eB,from:i,encode:p,overlap:f},n)}function EB(t,e,n,i,r){const s=yB(t,e),o=n.entries,a=!(!o||!o.interactive),u=o?o.name:void 0,l=s("clipHeight"),c=s("symbolOffset"),h={data:"value"},f=`(${r}) ? datum.offset : datum.size`,d=l?p$(l):{field:aB},p="datum.index",g=`max(1, ${r})`;let m,y,v,b,x;d.mult=.5,m={enter:y={opacity:cB,x:{signal:f,mult:.5,offset:c},y:d},update:v={opacity:hB,x:y.x,y:y.y},exit:{opacity:cB}};let w=null,A=null;t.fill||(w=e.symbolBaseFillColor,A=e.symbolBaseStrokeColor),m$(m,{fill:s("symbolFillColor",w),shape:s("symbolType"),size:s("symbolSize"),stroke:s("symbolStrokeColor",A),strokeDash:s("symbolDash"),strokeDashOffset:s("symbolDashOffset"),strokeWidth:s("symbolStrokeWidth")},{opacity:s("symbolOpacity")}),uB.forEach((e=>{t[e]&&(v[e]=y[e]={scale:t[e],field:eB})}));const _=AB({type:"symbol",role:"legend-symbol",key:eB,from:h,clip:!!l||void 0,encode:m},n.symbols),k=p$(c);k.offset=s("labelOffset"),m={enter:y={opacity:cB,x:{signal:f,offset:k},y:d},update:v={opacity:hB,text:{field:QT},x:y.x,y:y.y},exit:{opacity:cB}},m$(m,{align:s("labelAlign"),baseline:s("labelBaseline"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontStyle:s("labelFontStyle"),fontWeight:s("labelFontWeight"),limit:s("labelLimit")});const C=AB({type:gB,role:A$,style:nB,key:eB,from:h,encode:m},n.labels);return m={enter:{noBound:{value:!l},width:cB,height:l?p$(l):cB,opacity:cB},exit:{opacity:cB},update:v={opacity:hB,row:{signal:null},column:{signal:null}}},s.isVertical(!0)?(b=`ceil(item.mark.items.length / ${g})`,v.row.signal=`${p}%${b}`,v.column.signal=`floor(${p} / ${b})`,x={field:["row",p]}):(v.row.signal=`floor(${p} / ${g})`,v.column.signal=`${p} % ${g}`,x={field:p}),v.column.signal=`(${r})?${v.column.signal}:${p}`,mB({role:w$,from:i={facet:{data:i,name:"value",groupby:"index"}},encode:y$(m,o,lB),marks:[_,C],name:u,interactive:a,sort:x})}const DB='item.orient === "left"',FB='item.orient === "right"',SB=`(${DB} || ${FB})`,OB=`datum.vgrad && ${SB}`,NB=bB('"top"','"bottom"','"middle"'),MB=`datum.vgrad && ${FB} ? (${bB('"right"','"left"','"center"')}) : (${SB} && !(datum.vgrad && ${DB})) ? "left" : ${xB}`,zB=`item._anchor || (${SB} ? "middle" : "start")`,$B=`${OB} ? (${DB} ? -90 : 90) : 0`,TB=`${SB} ? (datum.vgrad ? (${FB} ? "bottom" : "top") : ${NB}) : "top"`;function BB(t,e){let n;return Ke(t)&&(t.signal?n=t.signal:t.path?n="pathShape("+jB(t.path)+")":t.sphere&&(n="geoShape("+jB(t.sphere)+', {type: "Sphere"})')),n?e.signalRef(n):!!t}function jB(t){return Ke(t)&&t.signal?t.signal:Rn(t)}function IB(t){const e=t.role||"";return e.indexOf("axis")&&e.indexOf("legend")&&e.indexOf("title")?t.type===fB?w$:e||b$:e}function RB(t){return{marktype:t.type,name:t.name||void 0,role:t.role||IB(t),zindex:+t.zindex||void 0,aria:t.aria,description:t.description}}function LB(t,e){return t&&t.signal?e.signalRef(t.signal):!1!==t}function PB(t,e){const n=Mu(t.type);n||Le("Unrecognized transform type: "+Rn(t.type));const i=j$(n.type.toLowerCase(),null,UB(n,t,e));return t.signal&&e.addSignal(t.signal,e.proxy(i)),i.metadata=n.metadata||{},i}function UB(t,e,n){const i={},r=t.params.length;for(let s=0;s<r;++s){const r=t.params[s];i[r.name]=qB(r,e,n)}return i}function qB(t,e,n){const i=t.type,r=e[t.name];return"index"===i?function(t,e,n){return Tn(e.from)||Le('Lookup "from" parameter must be a string literal.'),n.getData(e.from).lookupRef(n,e.key)}(0,e,n):void 0!==r?"param"===i?function(t,e,n){const i=e[t.name];return t.array?(Ze(i)||Le("Expected an array of sub-parameters. Instead: "+Rn(i)),i.map((e=>HB(t,e,n)))):HB(t,i,n)}(t,e,n):"projection"===i?n.projectionRef(e[t.name]):t.array&&!V$(r)?r.map((e=>WB(t,e,n))):WB(t,r,n):void(t.required&&Le("Missing required "+Rn(e.type)+" parameter: "+Rn(t.name)))}function WB(t,e,n){const i=t.type;if(V$(e))return YB(i)?Le("Expression references can not be signals."):JB(i)?n.fieldRef(e):ZB(i)?n.compareRef(e):n.signalRef(e.signal);{const r=t.expr||JB(i);return r&&VB(e)?n.exprRef(e.expr,e.as):r&&GB(e)?L$(e.field,e.as):YB(i)?nz(e,n):XB(i)?R$(n.getData(e).values):JB(i)?L$(e):ZB(i)?n.compareRef(e):e}}function HB(t,e,n){const i=t.params.length;let r;for(let n=0;n<i;++n){r=t.params[n];for(const t in r.key)if(r.key[t]!==e[t]){r=null;break}if(r)break}r||Le("Unsupported parameter: "+Rn(e));const s=Cn(UB(r,e,n),r.key);return R$(n.add(AT(s)))}const VB=t=>t&&t.expr,GB=t=>t&&t.field,XB=t=>"data"===t,YB=t=>"expr"===t,JB=t=>"field"===t,ZB=t=>"compare"===t;function KB(t,e){return t.$ref?t:t.data&&t.data.$ref?t.data:R$(e.getData(t.data).output)}function QB(t,e,n,i,r){this.scope=t,this.input=e,this.output=n,this.values=i,this.aggregate=r,this.index={}}function tj(t){return Tn(t)?t:null}function ej(t,e,n){const i=q$(n.op,n.field);let r;if(e.ops){for(let t=0,n=e.as.length;t<n;++t)if(e.as[t]===i)return}else e.ops=["count"],e.fields=[null],e.as=["count"];n.op&&(e.ops.push((r=n.op.signal)?t.signalRef(r):n.op),e.fields.push(t.fieldRef(n.field)),e.as.push(i))}function nj(t,e,n,i,r,s,o){const a=e[n]||(e[n]={}),u=function(t){return Ke(t)?("descending"===t.order?"-":"+")+q$(t.op,t.field):""}(s);let l,c,h=tj(r);if(null!=h&&(t=e.scope,h+=u?"|"+u:"",l=a[h]),!l){const n=s?{field:P$,pulse:e.countsRef(t,r,s)}:{field:t.fieldRef(r),pulse:R$(e.output)};u&&(n.sort=t.sortRef(s)),c=t.add(j$(i,void 0,n)),o&&(e.index[r]=c),l=R$(c),null!=h&&(a[h]=l)}return l}function ij(t,e,n){const i=t.remove,r=t.insert,s=t.toggle,o=t.modify,a=t.values,u=e.add(I$()),l=nz("if("+t.trigger+',modify("'+n+'",'+[r,i,s,o,a].map((t=>null==t?"null":t)).join(",")+"),0)",e);u.update=l.$expr,u.params=l.$params}function rj(t,e){const n=IB(t),i=t.type===fB,r=t.from&&t.from.facet,s=t.overlap;let o,a,u,l,c,h,f,d=t.layout||n===w$||n===x$;const p=n===b$||d||r,g=function(t,e,n){let i,r,s,o,a;return t?(i=t.facet)&&(e||Le("Only group marks can be faceted."),null!=i.field?o=a=KB(i,n):(t.data?a=R$(n.getData(t.data).aggregate):(s=PB(Cn({type:"aggregate",groupby:mn(i.groupby)},i.aggregate),n),s.params.key=n.keyRef(i.groupby),s.params.pulse=KB(i,n),o=a=R$(n.add(s))),r=n.keyRef(i.groupby,!0))):o=R$(n.add(uT(null,[{}]))),o||(o=KB(t,n)),{key:r,pulse:o,parent:a}}(t.from,i,e);a=e.add(cT({key:g.key||(t.key?L$(t.key):void 0),pulse:g.pulse,clean:!i}));const m=R$(a);a=u=e.add(uT({pulse:m})),a=e.add(vT({markdef:RB(t),interactive:LB(t.interactive,e),clip:BB(t.clip,e),context:{$context:!0},groups:e.lookup(),parent:e.signals.parent?e.signalRef("parent"):null,index:e.markpath(),pulse:R$(a)}));const y=R$(a);a=l=e.add(hT(O$(t.encode,t.type,n,t.style,e,{mod:!1,pulse:y}))),a.params.parent=e.encode(),t.transform&&t.transform.forEach((t=>{const n=PB(t,e),i=n.metadata;(i.generates||i.changes)&&Le("Mark transforms should not generate new data."),i.nomod||(l.params.mod=!0),n.params.pulse=R$(a),e.add(a=n)})),t.sort&&(a=e.add(OT({sort:e.compareRef(t.sort),pulse:R$(a)})));const v=R$(a);(r||d)&&(d=e.add(NT({layout:e.objectProperty(t.layout),legends:e.legends,mark:y,pulse:v})),h=R$(d));const b=e.add(aT({mark:y,pulse:h||v}));f=R$(b),i&&(p&&(o=e.operators,o.pop(),d&&o.pop()),e.pushState(v,h||f,m),r?function(t,e,n){const i=t.from.facet,r=i.name,s=KB(i,e);let o;i.name||Le("Facet must have a name: "+Rn(i)),i.data||Le("Facet must reference a data set: "+Rn(i)),i.field?o=e.add(_T({field:e.fieldRef(i.field),pulse:s})):i.groupby?o=e.add(dT({key:e.keyRef(i.groupby),group:R$(e.proxy(n.parent)),pulse:s})):Le("Facet must specify groupby or field: "+Rn(i));const a=e.fork(),u=a.add(uT()),l=a.add(ST({pulse:R$(u)}));a.addData(r,new QB(a,u,u,l)),a.addSignal("parent",null),o.params.subflow={$subflow:a.parse(t).toRuntime()}}(t,e,g):p?function(t,e,n){const i=e.add(_T({pulse:n.pulse})),r=e.fork();r.add(ST()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(t).toRuntime()}}(t,e,g):e.parse(t),e.popState(),p&&(d&&o.push(d),o.push(b))),s&&(f=function(t,e,n){const i=t.method,r=t.bound,s=t.separation,o={separation:V$(s)?n.signalRef(s.signal):s,method:V$(i)?n.signalRef(i.signal):i,pulse:e};if(t.order&&(o.sort=n.compareRef({field:t.order})),r){const t=r.tolerance;o.boundTolerance=V$(t)?n.signalRef(t.signal):+t,o.boundScale=n.scaleRef(r.scale),o.boundOrient=r.orient}return R$(n.add(wT(o)))}(s,f,e));const x=e.add(DT({pulse:f})),w=e.add(ST({pulse:R$(x)},void 0,e.parent()));null!=t.name&&(c=t.name,e.addData(c,new QB(e,u,x,w)),t.on&&t.on.forEach((t=>{(t.insert||t.remove||t.toggle)&&Le("Marks only support modify triggers."),ij(t,e,c)})))}function sj(t,e,n){const i={enter:{},update:{}};return m$(i,{orient:t("orient"),offset:t("offset"),padding:t("padding"),titlePadding:t("titlePadding"),cornerRadius:t("cornerRadius"),fill:t("fillColor"),stroke:t("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:t("legendX"),y:t("legendY"),format:e.format,formatType:e.formatType}),i}function oj(t,e,n){return e[t]?`scale("${e[t]}",datum)`:vB(t,n[0].encode)}function aj(t,e){const n={enter:{},update:{}};return m$(n,{orient:t("orient"),anchor:t("anchor"),align:{signal:xB},angle:{signal:'item.orient==="left"?-90:item.orient==="right"?90:0'},limit:t("limit"),frame:t("frame"),offset:t("offset")||0,padding:t("subtitlePadding")}),y$(n,e,lB)}function uj(t){const e=uT({},t);return e.metadata={source:!0},e}function lj(t,e){return yT({url:e.url?t.property(e.url):void 0,async:e.async?t.property(e.async):void 0,values:e.values?t.property(e.values):void 0,format:t.objectProperty(e.format)})}QB.fromEntries=function(t,e){const n=e.length,i=e[n-1],r=e[n-2];let s=e[0],o=null,a=1;for(s&&"load"===s.type&&(s=e[1]),t.add(e[0]);a<n;++a)e[a].params.pulse=R$(e[a-1]),t.add(e[a]),"aggregate"===e[a].type&&(o=e[a]);return new QB(t,s,r,i,o)},QB.prototype={countsRef(t,e,n){const i=this,r=i.counts||(i.counts={}),s=tj(e);let o,a,u;return null!=s&&(t=i.scope,o=r[s]),o?n&&n.field&&ej(t,o.agg.params,n):(u={groupby:t.fieldRef(e,"key"),pulse:R$(i.output)},n&&n.field&&ej(t,u,n),a=t.add(sT(u)),o=t.add(uT({pulse:R$(a)})),o={agg:a,ref:R$(o)},null!=s&&(r[s]=o)),o.ref},tuplesRef(){return R$(this.values)},extentRef(t,e){return nj(t,this,"extent","extent",e,!1)},domainRef(t,e){return nj(t,this,"domain","values",e,!1)},valuesRef(t,e,n){return nj(t,this,"vals","values",e,n||!0)},lookupRef(t,e){return nj(t,this,"lookup","tupleindex",e,!1)},indataRef(t,e){return nj(t,this,"indata","tupleindex",e,!0,!0)}};const cj=t=>t===KT||t===YT,hj=(t,e,n)=>V$(t)?yj(t.signal,e,n):t===JT||t===YT?e:n,fj=(t,e,n)=>V$(t)?gj(t.signal,e,n):cj(t)?e:n,dj=(t,e,n)=>V$(t)?mj(t.signal,e,n):cj(t)?n:e,pj=(t,e,n)=>V$(t)?vj(t.signal,e,n):t===YT?{value:e}:{value:n},gj=(t,e,n)=>bj(`${t} === 'top' || ${t} === 'bottom'`,e,n),mj=(t,e,n)=>bj(`${t} !== 'top' && ${t} !== 'bottom'`,e,n),yj=(t,e,n)=>wj(`${t} === 'left' || ${t} === 'top'`,e,n),vj=(t,e,n)=>wj(`${t} === 'top'`,e,n),bj=(t,e,n)=>(e=null!=e?p$(e):e,n=null!=n?p$(n):n,xj(e)&&xj(n)?{signal:`${t} ? (${e=e?e.signal||Rn(e.value):null}) : (${n=n?n.signal||Rn(n.value):null})`}:[Cn({test:t},e)].concat(n||[])),xj=t=>null==t||1===Object.keys(t).length,wj=(t,e,n)=>({signal:`${t} ? (${_j(e)}) : (${_j(n)})`}),Aj=(t,e,n,i,r)=>({signal:(null!=i?`${t} === 'left' ? (${_j(i)}) : `:"")+(null!=n?`${t} === 'bottom' ? (${_j(n)}) : `:"")+(null!=r?`${t} === 'right' ? (${_j(r)}) : `:"")+(null!=e?`${t} === 'top' ? (${_j(e)}) : `:"")+"(null)"}),_j=t=>V$(t)?t.signal:null==t?null:Rn(t),kj=(t,e)=>{const n=t.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+e.signal}:t};function Cj(t,e,n,i){let r;if(e&&Fn(e,t))return e[t];if(Fn(n,t))return n[t];if(t.startsWith("title")){switch(t){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=t[5].toLowerCase()+t.slice(6)}return i["guide-title"][r]}if(t.startsWith("label")){switch(t){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=t[5].toLowerCase()+t.slice(6)}return i["guide-label"][r]}return null}function Ej(t){const e={};for(const n of t)if(n)for(const t in n)e[t]=1;return Object.keys(e)}function Dj(t,e){return{scale:t.scale,range:e}}function Fj(t,e,n,i,r){return{signal:'flush(range("'+t+'"), scale("'+t+'", datum.value), '+e+","+n+","+i+","+r+")"}}function Sj(t,e,n,i,r,s){const o=yB(t,e),a=t.orient,u=t.scale,l=hj(a,-1,1),c=Y$(o("labelFlush")),h=Y$(o("labelFlushOffset")),f=o("labelAlign"),d=o("labelBaseline");let p,g=0===c||!!c;const m=p$(r);m.mult=l,m.offset=p$(o("labelPadding")||0),m.offset.mult=l;const y={scale:u,field:eB,band:.5,offset:wB(s.offset,o("labelOffset"))},v=fj(a,g?Fj(u,c,'"left"','"right"','"center"'):{value:"center"},((t,e,n)=>V$(t)?((t,e,n)=>wj(`${t} === 'right'`,e,n))(t.signal,e,n):t===ZT?{value:e}:{value:n})(a,"left","right")),b=fj(a,pj(a,"bottom","top"),g?Fj(u,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=Fj(u,c,`-(${h})`,h,0);g=g&&h;const w={opacity:cB,x:fj(a,y,m),y:dj(a,y,m)},A={enter:w,update:p={opacity:hB,text:{field:QT},x:w.x,y:w.y,align:v,baseline:b},exit:{opacity:cB,x:w.x,y:w.y}};m$(A,{dx:!f&&g?fj(a,x):null,dy:!d&&g?dj(a,x):null}),m$(A,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:f,baseline:d});const _=o("labelBound");let k=o("labelOverlap");return k=k||_?{separation:o("labelSeparation"),method:k,order:"datum.index",bound:_?{scale:u,orient:a,tolerance:_}:null}:void 0,p.align!==v&&(p.align=kj(p.align,v)),p.baseline!==b&&(p.baseline=kj(p.baseline,b)),AB({type:gB,role:"axis-label",style:nB,key:eB,from:i,encode:A,overlap:k},n)}function Oj(t,e){const n=function(t,e){var n,i,r,s=e.config,o=s.style,a=s.axis,u="band"===e.scaleType(t.scale)&&s.axisBand,l=t.orient;if(V$(l)){const t=Ej([s.axisX,s.axisY]),e=Ej([s.axisTop,s.axisBottom,s.axisLeft,s.axisRight]);for(r of(n={},t))n[r]=fj(l,Cj(r,s.axisX,a,o),Cj(r,s.axisY,a,o));for(r of(i={},e))i[r]=Aj(l.signal,Cj(r,s.axisTop,a,o),Cj(r,s.axisBottom,a,o),Cj(r,s.axisLeft,a,o),Cj(r,s.axisRight,a,o))}else n=l===YT||l===KT?s.axisX:s.axisY,i=s["axis"+l[0].toUpperCase()+l.slice(1)];return n||i||u?Cn({},a,n,i,u):a}(t,e),i=t.encode||{},r=i.axis||{},s=r.name||void 0,o=r.interactive,a=r.style,u=yB(t,n),l=function(t){const e=t("tickBand");let n,i,r=t("tickOffset");return e?e.signal?(n={signal:`(${e.signal}) === 'extent' ? 1 : 0.5`},i={signal:`(${e.signal}) === 'extent'`},Ke(r)||(r={signal:`(${e.signal}) === 'extent' ? 0 : ${r}`})):"extent"===e?(n=1,i=!0,r=0):(n=.5,i=!1):(n=t("bandPosition"),i=t("tickExtra")),{extra:i,band:n,offset:r}}(u),c={scale:t.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:null!=t.title},h=R$(e.add(uT({},[c]))),f=R$(e.add(oT({scale:e.scaleRef(t.scale),extra:e.property(l.extra),count:e.objectProperty(t.tickCount),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)}))),d=[];let p;return c.grid&&d.push(function(t,e,n,i,r){const s=yB(t,e),o=t.orient,a=t.gridScale,u=hj(o,1,-1),l=function(t,e){if(1===e);else if(Ke(t)){let n=t=Cn({},t);for(;null!=n.mult;){if(!Ke(n.mult))return n.mult=V$(e)?{signal:`(${n.mult}) * (${e.signal})`}:n.mult*e,t;n=n.mult=Cn({},n.mult)}n.mult=e}else t=V$(e)?{signal:`(${e.signal}) * (${t||0})`}:e*(t||0);return t}(t.offset,u);let c,h,f;const d={enter:c={opacity:cB},update:f={opacity:hB},exit:h={opacity:cB}};m$(d,{stroke:s("gridColor"),strokeCap:s("gridCap"),strokeDash:s("gridDash"),strokeDashOffset:s("gridDashOffset"),strokeOpacity:s("gridOpacity"),strokeWidth:s("gridWidth")});const p={scale:t.scale,field:eB,band:r.band,extra:r.extra,offset:r.offset,round:s("tickRound")},g=fj(o,{signal:"height"},{signal:"width"}),m=a?{scale:a,range:0,mult:u,offset:l}:{value:0,offset:l},y=a?{scale:a,range:1,mult:u,offset:l}:Cn(g,{mult:u,offset:l});return c.x=f.x=fj(o,p,m),c.y=f.y=dj(o,p,m),c.x2=f.x2=dj(o,y),c.y2=f.y2=fj(o,y),h.x=fj(o,p),h.y=dj(o,p),AB({type:pB,role:"axis-grid",key:eB,from:i,encode:d},n)}(t,n,i.grid,f,l)),c.ticks&&(p=u("tickSize"),d.push(function(t,e,n,i,r,s){const o=yB(t,e),a=t.orient,u=hj(a,-1,1);let l,c,h;const f={enter:l={opacity:cB},update:h={opacity:hB},exit:c={opacity:cB}};m$(f,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const d=p$(r);d.mult=u;const p={scale:t.scale,field:eB,band:s.band,extra:s.extra,offset:s.offset,round:o("tickRound")};return h.y=l.y=fj(a,cB,p),h.y2=l.y2=fj(a,d),c.x=fj(a,p),h.x=l.x=dj(a,cB,p),h.x2=l.x2=dj(a,d),c.y=dj(a,p),AB({type:pB,role:"axis-tick",key:eB,from:i,encode:f},n)}(t,n,i.ticks,f,p,l))),c.labels&&(p=c.ticks?p:0,d.push(Sj(t,n,i.labels,f,p,l))),c.domain&&d.push(function(t,e,n,i){const r=yB(t,e),s=t.orient;let o,a;const u={enter:o={opacity:cB},update:a={opacity:hB},exit:{opacity:cB}};m$(u,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const l=Dj(t,0),c=Dj(t,1);return o.x=a.x=fj(s,l,cB),o.x2=a.x2=fj(s,c),o.y=a.y=dj(s,l,cB),o.y2=a.y2=dj(s,c),AB({type:pB,role:"axis-domain",from:i,encode:u},n)}(t,n,i.domain,h)),c.title&&d.push(function(t,e,n,i){const r=yB(t,e),s=t.orient,o=hj(s,-1,1);let a,u;const l={enter:a={opacity:cB,anchor:p$(r("titleAnchor",null)),align:{signal:xB}},update:u=Cn({},a,{opacity:hB,text:p$(t.title)}),exit:{opacity:cB}},c={signal:`lerp(range("${t.scale}"), ${bB(0,1,.5)})`};return u.x=fj(s,c),u.y=dj(s,c),a.angle=fj(s,cB,((t,e)=>V$(t)?{signal:`(${t.signal}) * 90`}:{value:90*t})(o)),a.baseline=fj(s,pj(s,KT,YT),{value:KT}),u.angle=a.angle,u.baseline=a.baseline,m$(l,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),function(t,e,n,i){const r=(t,e)=>null!=t?(n.update[e]=kj(p$(t),n.update[e]),!1):!v$(e,i),s=r(t("titleX"),"x"),o=r(t("titleY"),"y");n.enter.auto=o===s?p$(o):fj(e,p$(o),p$(s))}(r,s,l,n),l.update.align=kj(l.update.align,a.align),l.update.angle=kj(l.update.angle,a.angle),l.update.baseline=kj(l.update.baseline,a.baseline),AB({type:gB,role:"axis-title",style:iB,from:i,encode:l},n)}(t,n,i.title,h)),rj(mB({role:"axis",from:h,encode:y$(Nj(u,t),r,lB),marks:d,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:s,interactive:o,style:a}),e)}function Nj(t,e){const n={enter:{},update:{}};return m$(n,{orient:t("orient"),offset:t("offset")||0,position:X$(e.position,0),titlePadding:t("titlePadding"),minExtent:t("minExtent"),maxExtent:t("maxExtent"),range:{signal:`abs(span(range("${e.scale}")))`},translate:t("translate"),format:e.format,formatType:e.formatType}),n}function Mj(t,e,n){const i=mn(t.signals),r=mn(t.scales);return n||i.forEach((t=>T$(t,e))),mn(t.projections).forEach((t=>function(t,e){const n=e.config.projection||{},i={};for(const n in t)"name"!==n&&(i[n]=XT(t[n],n,e));for(const t in n)null==i[t]&&(i[t]=XT(n[t],t,e));e.addProjection(t.name,i)}(t,e))),r.forEach((t=>function(t,e){const n=t.type||"linear";Yg(n)||Le("Unrecognized scale type: "+Rn(n)),e.addScale(t.name,{type:n,domain:void 0})}(t,e))),mn(t.data).forEach((t=>function(t,e){const n=[];t.transform&&t.transform.forEach((t=>{n.push(PB(t,e))})),t.on&&t.on.forEach((n=>{ij(n,e,t.name)})),e.addDataPipeline(t.name,function(t,e,n){const i=[];let r,s,o,a,u,l=null,c=!1,h=!1;for(t.values?V$(t.values)||G$(t.format)?(i.push(lj(e,t)),i.push(l=uj())):i.push(l=uj({$ingest:t.values,$format:t.format})):t.url?G$(t.url)||G$(t.format)?(i.push(lj(e,t)),i.push(l=uj())):i.push(l=uj({$request:t.url,$format:t.format})):t.source&&(l=r=mn(t.source).map((t=>R$(e.getData(t).output))),i.push(null)),s=0,o=n.length;s<o;++s)a=n[s],u=a.metadata,l||u.source||i.push(l=uj()),i.push(a),u.generates&&(h=!0),u.modifies&&!h&&(c=!0),u.source?l=a:u.changes&&(l=null);return r&&(o=r.length-1,i[0]=ET({derive:c,pulse:o?r:r[0]}),(c||o)&&i.splice(1,0,uj())),l||i.push(uj()),i.push(ST({})),i}(t,e,n))}(t,e))),r.forEach((t=>TT(t,e))),(n||i).forEach((t=>function(t,e){const n=e.getSignal(t.name);let i=t.update;t.init&&(i?Le("Signals can not include both init and update expressions."):(i=t.init,n.initonly=!0)),i&&(i=nz(i,e),n.update=i.$expr,n.params=i.$params),t.on&&t.on.forEach((t=>function(t,e,n){const i=t.encode,r={target:n};let s=t.events,o=t.update,a=[];var u,l;s||Le("Signal update missing events specification."),Tn(s)&&(u=s,l=e.isSubscope()?W$:H$,o$=l||"view",a$=s$,s=l$(u.trim()).map(c$)),s=mn(s).filter((t=>t.signal||t.scale?(a.push(t),0):1)),a.length>1&&(a=[iT(a)]),s.length&&a.push(s.length>1?{merge:s}:s[0]),null!=i&&(o&&Le("Signal encode and update are mutually exclusive."),o="encode(item(),"+Rn(i)+")"),r.update=Tn(o)?nz(o,e):null!=o.expr?nz(o.expr,e):null!=o.value?o.value:null!=o.signal?{$expr:nT,$params:{$value:e.signalRef(o.signal)}}:Le("Invalid signal update specification."),t.force&&(r.options={force:!0}),a.forEach((t=>e.addUpdate(Cn(function(t,e){return{source:t.signal?e.signalRef(t.signal):t.scale?e.scaleRef(t.scale):Z$(t,e)}}(t,e),r))))}(t,e,n.id)))}(t,e))),mn(t.axes).forEach((t=>Oj(t,e))),mn(t.marks).forEach((t=>rj(t,e))),mn(t.legends).forEach((t=>function(t,e){const n=e.config.legend,i=t.encode||{},r=yB(t,n),s=i.legend||{},o=s.name||void 0,a=s.interactive,u=s.style,l={};let c,h,f,d=0;uB.forEach((e=>t[e]?(l[e]=t[e],d=d||t[e]):0)),d||Le("Missing valid scale for legend.");const p=function(t,e){let n=t.type||rB;return t.type||1!==function(t){return uB.reduce(((e,n)=>e+(t[n]?1:0)),0)}(t)||!t.fill&&!t.stroke||(n=Zg(e)?sB:Qg(e)?oB:rB),n!==sB?n:Qg(e)?oB:sB}(t,e.scaleType(d)),g={title:null!=t.title,scales:l,type:p,vgrad:"symbol"!==p&&r.isVertical()},m=R$(e.add(uT(null,[g]))),y=R$(e.add(mT(h={type:p,scale:e.scaleRef(d),count:e.objectProperty(r("tickCount")),limit:e.property(r("symbolLimit")),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)})));return p===sB?(f=[_B(t,d,n,i.gradient),CB(t,n,i.labels,y)],h.count=h.count||e.signalRef(`max(2,2*floor((${Y$(r.gradientLength())})/100))`)):p===oB?f=[kB(t,d,n,i.gradient,y),CB(t,n,i.labels,y)]:(c=function(t,e){const n=yB(t,e);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(t,n),f=[EB(t,n,i,y,Y$(c.columns))],h.size=function(t,e,n){return nz(`max(ceil(sqrt(${Y$(oj("size",t,n))})+${Y$(oj("strokeWidth",t,n))}),${Y$(function(t,e,n){return vB("fontSize",t)||function(t,e,n){const i=e.config.style["guide-label"];return i&&i.fontSize}(0,e)}(n[1].encode,e))})`,e)}(t,e,f[0].marks)),f=[mB({role:"legend-entry",from:m,encode:{enter:{x:{value:0},y:{value:0}}},marks:f,layout:c,interactive:a})],g.title&&f.push(function(t,e,n,i){const r=yB(t,e),s={enter:{opacity:cB},update:{opacity:hB,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:cB}};return m$(s,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:zB},angle:{signal:$B},align:{signal:MB},baseline:{signal:TB},text:t.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),AB({type:gB,role:"legend-title",style:iB,from:i,encode:s},n)}(t,n,i.title,m)),rj(mB({role:"legend",from:m,encode:y$(sj(r,t,n),s,lB),marks:f,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:o,interactive:a,style:u}),e)}(t,e))),t.title&&function(t,e){const n=yB(t=Tn(t)?{text:t}:t,e.config.title),i=t.encode||{},r=i.group||{},s=r.name||void 0,o=r.interactive,a=r.style,u=[],l=R$(e.add(uT(null,[{}])));u.push(function(t,e,n,i){const r={value:0},s={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return m$(s,{text:t.text,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("color"),font:e("font"),fontSize:e("fontSize"),fontStyle:e("fontStyle"),fontWeight:e("fontWeight"),lineHeight:e("lineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),AB({type:gB,role:"title-text",style:"group-title",from:i,encode:s},n)}(t,n,function(t){const e=t.encode;return e&&e.title||Cn({name:t.name,interactive:t.interactive,style:t.style},e)}(t),l)),t.subtitle&&u.push(function(t,e,n,i){const r={value:0},s={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return m$(s,{text:t.subtitle,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("subtitleColor"),font:e("subtitleFont"),fontSize:e("subtitleFontSize"),fontStyle:e("subtitleFontStyle"),fontWeight:e("subtitleFontWeight"),lineHeight:e("subtitleLineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),AB({type:gB,role:"title-subtitle",style:"group-subtitle",from:i,encode:s},n)}(t,n,i.subtitle,l)),rj(mB({role:"title",from:l,encode:aj(n,r),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:s,interactive:o,style:a}),e)}(t.title,e),e.parseLambdas(),e}function zj(t,e){return e&&e.signal?{name:t,update:e.signal}:{name:t,value:e}}function $j(t,e){this.config=t||{},this.options=e||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function Tj(t){this.config=t.config,this.options=t.options,this.legends=t.legends,this.field=Object.create(t.field),this.signals=Object.create(t.signals),this.lambdas=Object.create(t.lambdas),this.scales=Object.create(t.scales),this.events=Object.create(t.events),this.data=Object.create(t.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++t._nextsub[0],this._nextsub=t._nextsub,this._parent=t._parent.slice(),this._encode=t._encode.slice(),this._lookup=t._lookup.slice(),this._markpath=t._markpath}function Bj(t){return(Ze(t)?jj:Ij)(t)}function jj(t){const e=t.length;let n="[";for(let i=0;i<e;++i){const e=t[i];n+=(i>0?",":"")+(Ke(e)?e.signal||Bj(e):Rn(e))}return n+"]"}function Ij(t){let e,n,i="{",r=0;for(e in t)n=t[e],i+=(++r>1?",":"")+Rn(e)+":"+(Ke(n)?n.signal||Bj(n):Rn(n));return i+"}"}function Rj(t,e,n){return Ke(t)||Le("Input Vega specification must be an object."),function(t,e){const n=e.config,i=R$(e.root=e.add(I$())),r=function(t,e){const n=n=>X$(t[n],e[n]),i=[zj("background",n("background")),zj("autosize",h$(n("autosize"))),zj("padding",d$(n("padding"))),zj("width",n("width")||0),zj("height",n("height")||0)],r=i.reduce(((t,e)=>(t[e.name]=e,t)),{}),s={};return mn(t.signals).forEach((t=>{Fn(r,t.name)?t=Cn(r[t.name],t):i.push(t),s[t.name]=t})),mn(e.signals).forEach((t=>{Fn(s,t.name)||Fn(r,t.name)||i.push(t)})),i}(t,n);r.forEach((t=>T$(t,e))),e.description=t.description||n.description,e.eventConfig=n.events,e.legends=e.objectProperty(n.legend&&n.legend.layout),e.locale=n.locale;const s=e.add(uT()),o=e.add(hT(O$((t=>y$({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},t))(t.encode),fB,x$,t.style,e,{pulse:R$(s)}))),a=e.add(NT({layout:e.objectProperty(t.layout),legends:e.legends,autosize:e.signalRef("autosize"),mark:i,pulse:R$(o)}));e.operators.pop(),e.pushState(R$(o),R$(a),null),Mj(t,e,r),e.operators.push(a);let u=e.add(aT({mark:i,pulse:R$(a)}));return u=e.add(DT({pulse:R$(u)})),u=e.add(ST({pulse:R$(u)})),e.addData("root",new QB(e,s,s,u)),e}(t,new $j(e=function(...t){return t.reduce(((t,e)=>{for(const n in e)if("signals"===n)t.signals=en(t.signals,e.signals);else{const i="legend"===n?{layout:1}:"style"===n||null;tn(t,n,e[n],i)}return t}),{})}(function(){const t="sans-serif",e="#4c78a8",n="#000",i="#888",r="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:e},area:{fill:e},image:null,line:{stroke:e,strokeWidth:2},path:{stroke:e},rect:{fill:e},rule:{stroke:n},shape:{stroke:e},symbol:{fill:e,size:64},text:{fill:n,font:t,fontSize:11},trail:{fill:e,size:2},style:{"guide-label":{fill:n,font:t,fontSize:10},"guide-title":{fill:n,font:t,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:t,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:t,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:r}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:i,grid:!1,gridWidth:1,gridColor:r,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:i,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:r,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:i,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),e,t.config),n)).toRuntime()}function Lj(t,e,n){return t.fields=e||[],t.fname=n,t}function Pj(t){return 1===t.length?Uj(t[0]):qj(t)}$j.prototype=Tj.prototype={parse(t){return Mj(t,this)},fork(){return new Tj(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(t){return this.operators.push(t),t.id=this.id(),t.refs&&(t.refs.forEach((e=>{e.$ref=t.id})),t.refs=null),t},proxy(t){const e=t instanceof B$?R$(t):t;return this.add(CT({value:e}))},addStream(t){return this.streams.push(t),t.id=this.id(),t},addUpdate(t){return this.updates.push(t),t},finish(){let t,e;for(t in this.root&&(this.root.root=!0),this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;function n(t,e,n){let i,r;t&&(i=t.data||(t.data={}),r=i[e]||(i[e]=[]),r.push(n))}for(t in this.data){e=this.data[t],n(e.input,t,"input"),n(e.output,t,"output"),n(e.values,t,"values");for(const i in e.index)n(e.index[i],t,"index:"+i)}return this},pushState(t,e,n){this._encode.push(R$(this.add(ST({pulse:t})))),this._parent.push(e),this._lookup.push(n?R$(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return nn(this._parent)},encode(){return nn(this._encode)},lookup(){return nn(this._lookup)},markpath(){const t=this._markpath;return++t[t.length-1]},fieldRef(t,e){if(Tn(t))return L$(t,e);t.signal||Le("Unsupported field reference: "+Rn(t));const n=t.signal;let i=this.field[n];if(!i){const t={name:this.signalRef(n)};e&&(t.as=e),this.field[n]=i=R$(this.add(pT(t)))}return i},compareRef(t){let e=!1;const n=t=>V$(t)?(e=!0,this.signalRef(t.signal)):function(t){return t&&t.expr}(t)?(e=!0,this.exprRef(t.expr)):t,i=mn(t.field).map(n),r=mn(t.order).map(n);return e?R$(this.add(lT({fields:i,orders:r}))):U$(i,r)},keyRef(t,e){let n=!1;const i=this.signals;return t=mn(t).map((t=>V$(t)?(n=!0,R$(i[t.signal])):t)),n?R$(this.add(gT({fields:t,flat:e}))):function(t,e){const n={$key:t};return e&&(n.$flat=!0),n}(t,e)},sortRef(t){if(!t)return t;const e=q$(t.op,t.field),n=t.order||"ascending";return n.signal?R$(this.add(lT({fields:e,orders:this.signalRef(n.signal)}))):U$(e,n)},event(t,e){const n=t+":"+e;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:t,type:e}),this.events[n]=i}return this.events[n]},hasOwnSignal(t){return Fn(this.signals,t)},addSignal(t,e){this.hasOwnSignal(t)&&Le("Duplicate signal name: "+Rn(t));const n=e instanceof B$?e:this.add(I$(e));return this.signals[t]=n},getSignal(t){return this.signals[t]||Le("Unrecognized signal name: "+Rn(t)),this.signals[t]},signalRef(t){return this.signals[t]?R$(this.signals[t]):(Fn(this.lambdas,t)||(this.lambdas[t]=this.add(I$(null))),R$(this.lambdas[t]))},parseLambdas(){const t=Object.keys(this.lambdas);for(let e=0,n=t.length;e<n;++e){const n=t[e],i=nz(n,this),r=this.lambdas[n];r.params=i.$params,r.update=i.$expr}},property(t){return t&&t.signal?this.signalRef(t.signal):t},objectProperty(t){return t&&Ke(t)?this.signalRef(t.signal||Bj(t)):t},exprRef(t,e){const n={expr:nz(t,this)};return e&&(n.expr.$name=e),R$(this.add(fT(n)))},addBinding(t,e){this.bindings||Le("Nested signals do not support binding: "+Rn(t)),this.bindings.push(Cn({signal:t},e))},addScaleProj(t,e){Fn(this.scales,t)&&Le("Duplicate scale or projection name: "+Rn(t)),this.scales[t]=this.add(e)},addScale(t,e){this.addScaleProj(t,FT(e))},addProjection(t,e){this.addScaleProj(t,kT(e))},getScale(t){return this.scales[t]||Le("Unrecognized scale name: "+Rn(t)),this.scales[t]},scaleRef(t){return R$(this.getScale(t))},scaleType(t){return this.getScale(t).params.type},projectionRef(t){return this.scaleRef(t)},projectionType(t){return this.scaleType(t)},addData(t,e){return Fn(this.data,t)&&Le("Duplicate data set name: "+Rn(t)),this.data[t]=e},getData(t){return this.data[t]||Le("Undefined data set name: "+Rn(t)),this.data[t]},addDataPipeline(t,e){return Fn(this.data,t)&&Le("Duplicate data set name: "+Rn(t)),this.addData(t,QB.fromEntries(this,e))}};const Uj=t=>function(e){return e[t]},qj=t=>{const e=t.length;return function(n){for(let i=0;i<e;++i)n=n[t[i]];return n}};function Wj(t){throw Error(t)}function Hj(t){return"function"==typeof t}(function(t,e,n){const i=function(t){const e=[],n=t.length;let i,r,s,o=null,a=0,u="";function l(){e.push(u+t.substring(i,r)),u="",i=r+1}for(t+="",i=r=0;r<n;++r)if(s=t[r],"\\"===s)u+=t.substring(i,r),u+=t.substring(++r,++r),i=r;else if(s===o)l(),o=null,a=-1;else{if(o)continue;i===a&&'"'===s||i===a&&"'"===s?(i=r+1,o=s):"."!==s||a?"["===s?(r>i&&l(),a=i=r+1):"]"===s&&(a||Wj("Access path missing open bracket: "+t),a>0&&l(),a=0,i=r+1):r>i?l():i=r+1}return a&&Wj("Access path missing closing bracket: "+t),o&&Wj("Access path missing closing quote: "+t),r>i&&(r++,l()),e}(t);t=1===i.length?i[0]:t,Lj((n&&n.get||Pj)(i),[t],e||t)})("id"),Lj((t=>t),[],"identity"),Lj((()=>0),[],"zero"),Lj((()=>1),[],"one"),Lj((()=>!0),[],"true"),Lj((()=>!1),[],"false"),Array.isArray;const Vj=Object.prototype.hasOwnProperty;function Gj(t,e){return Vj.call(t,e)}function Xj(t){const e={},n=t.length;for(let i=0;i<n;++i)e[t[i]]=!0;return e}function Yj(t){this.type=t}var Jj,Zj,Kj,Qj,tI;Yj.prototype.visit=function(t){let e,n,i;if(t(this))return 1;for(e=function(t){switch(t.type){case"ArrayExpression":return t.elements;case"BinaryExpression":case"LogicalExpression":return[t.left,t.right];case"CallExpression":return[t.callee].concat(t.arguments);case"ConditionalExpression":return[t.test,t.consequent,t.alternate];case"MemberExpression":return[t.object,t.property];case"ObjectExpression":return t.properties;case"Property":return[t.key,t.value];case"UnaryExpression":return[t.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this),n=0,i=e.length;n<i;++n)if(e[n].visit(t))return 1},(Jj={})[1]="Boolean",Jj[2]="<end>",Jj[3]="Identifier",Jj[4]="Keyword",Jj[5]="Null",Jj[6]="Numeric",Jj[7]="Punctuator",Jj[8]="String",Jj[9]="RegularExpression";var eI="Identifier",nI="Unexpected token %0",iI="Invalid regular expression",rI="Invalid regular expression: missing /",sI="Octal literals are not allowed in strict mode.",oI="ILLEGAL",aI="Disabled.",uI=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),lI=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function cI(t,e){if(!t)throw new Error("ASSERT: "+e)}function hI(t){return t>=48&&t<=57}function fI(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function dI(t){return"01234567".indexOf(t)>=0}function pI(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function gI(t){return 10===t||13===t||8232===t||8233===t}function mI(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&uI.test(String.fromCharCode(t))}function yI(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&lI.test(String.fromCharCode(t))}const vI={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function bI(){for(;Kj<Qj;){const t=Zj.charCodeAt(Kj);if(!pI(t)&&!gI(t))break;++Kj}}function xI(t){var e,n,i,r=0;for(n="u"===t?4:2,e=0;e<n;++e)Kj<Qj&&fI(Zj[Kj])?(i=Zj[Kj++],r=16*r+"0123456789abcdef".indexOf(i.toLowerCase())):$I({},nI,oI);return String.fromCharCode(r)}function wI(){var t,e,n,i;for(e=0,"}"===(t=Zj[Kj])&&$I({},nI,oI);Kj<Qj&&fI(t=Zj[Kj++]);)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||"}"!==t)&&$I({},nI,oI),e<=65535?String.fromCharCode(e):(n=55296+(e-65536>>10),i=56320+(e-65536&1023),String.fromCharCode(n,i))}function AI(){var t,e;for(t=Zj.charCodeAt(Kj++),e=String.fromCharCode(t),92===t&&(117!==Zj.charCodeAt(Kj)&&$I({},nI,oI),++Kj,(t=xI("u"))&&"\\"!==t&&mI(t.charCodeAt(0))||$I({},nI,oI),e=t);Kj<Qj&&yI(t=Zj.charCodeAt(Kj));)++Kj,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==Zj.charCodeAt(Kj)&&$I({},nI,oI),++Kj,(t=xI("u"))&&"\\"!==t&&yI(t.charCodeAt(0))||$I({},nI,oI),e+=t);return e}function _I(){var t,e,n,i,r=Kj,s=Zj.charCodeAt(Kj),o=Zj[Kj];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Kj,{type:7,value:String.fromCharCode(s),start:r,end:Kj};default:if(61===(t=Zj.charCodeAt(Kj+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Kj+=2,{type:7,value:String.fromCharCode(s)+String.fromCharCode(t),start:r,end:Kj};case 33:case 61:return Kj+=2,61===Zj.charCodeAt(Kj)&&++Kj,{type:7,value:Zj.slice(r,Kj),start:r,end:Kj}}}return">>>="===(i=Zj.substr(Kj,4))?{type:7,value:i,start:r,end:Kj+=4}:">>>"===(n=i.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:r,end:Kj+=3}:o===(e=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===e?{type:7,value:e,start:r,end:Kj+=2}:("//"===e&&$I({},nI,oI),"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:r,end:++Kj}:void $I({},nI,oI))}function kI(){var t,e,n;if(cI(hI((n=Zj[Kj]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),e=Kj,t="","."!==n){if(t=Zj[Kj++],n=Zj[Kj],"0"===t){if("x"===n||"X"===n)return++Kj,function(t){let e="";for(;Kj<Qj&&fI(Zj[Kj]);)e+=Zj[Kj++];return 0===e.length&&$I({},nI,oI),mI(Zj.charCodeAt(Kj))&&$I({},nI,oI),{type:6,value:parseInt("0x"+e,16),start:t,end:Kj}}(e);if(dI(n))return function(t){let e="0"+Zj[Kj++];for(;Kj<Qj&&dI(Zj[Kj]);)e+=Zj[Kj++];return(mI(Zj.charCodeAt(Kj))||hI(Zj.charCodeAt(Kj)))&&$I({},nI,oI),{type:6,value:parseInt(e,8),octal:!0,start:t,end:Kj}}(e);n&&hI(n.charCodeAt(0))&&$I({},nI,oI)}for(;hI(Zj.charCodeAt(Kj));)t+=Zj[Kj++];n=Zj[Kj]}if("."===n){for(t+=Zj[Kj++];hI(Zj.charCodeAt(Kj));)t+=Zj[Kj++];n=Zj[Kj]}if("e"===n||"E"===n)if(t+=Zj[Kj++],"+"!==(n=Zj[Kj])&&"-"!==n||(t+=Zj[Kj++]),hI(Zj.charCodeAt(Kj)))for(;hI(Zj.charCodeAt(Kj));)t+=Zj[Kj++];else $I({},nI,oI);return mI(Zj.charCodeAt(Kj))&&$I({},nI,oI),{type:6,value:parseFloat(t),start:e,end:Kj}}function CI(){if(bI(),Kj>=Qj)return{type:2,start:Kj,end:Kj};const t=Zj.charCodeAt(Kj);return mI(t)?function(){var t,e;return t=Kj,{type:1===(e=92===Zj.charCodeAt(Kj)?AI():function(){var t,e;for(t=Kj++;Kj<Qj;){if(92===(e=Zj.charCodeAt(Kj)))return Kj=t,AI();if(!yI(e))break;++Kj}return Zj.slice(t,Kj)}()).length?3:vI.hasOwnProperty(e)?4:"null"===e?5:"true"===e||"false"===e?1:3,value:e,start:t,end:Kj}}():40===t||41===t||59===t?_I():39===t||34===t?function(){var t,e,n,i,r="",s=!1;for(cI("'"===(t=Zj[Kj])||'"'===t,"String literal must starts with a quote"),e=Kj,++Kj;Kj<Qj;){if((n=Zj[Kj++])===t){t="";break}if("\\"===n)if((n=Zj[Kj++])&&gI(n.charCodeAt(0)))"\r"===n&&"\n"===Zj[Kj]&&++Kj;else switch(n){case"u":case"x":"{"===Zj[Kj]?(++Kj,r+=wI()):r+=xI(n);break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:dI(n)?(0!==(i="01234567".indexOf(n))&&(s=!0),Kj<Qj&&dI(Zj[Kj])&&(s=!0,i=8*i+"01234567".indexOf(Zj[Kj++]),"0123".indexOf(n)>=0&&Kj<Qj&&dI(Zj[Kj])&&(i=8*i+"01234567".indexOf(Zj[Kj++]))),r+=String.fromCharCode(i)):r+=n}else{if(gI(n.charCodeAt(0)))break;r+=n}}return""!==t&&$I({},nI,oI),{type:8,value:r,octal:s,start:e,end:Kj}}():46===t?hI(Zj.charCodeAt(Kj+1))?kI():_I():hI(t)?kI():_I()}function EI(){const t=tI;return Kj=t.end,tI=CI(),Kj=t.end,t}function DI(){const t=Kj;tI=CI(),Kj=t}function FI(t,e,n){const i=new Yj("||"===t||"&&"===t?"LogicalExpression":"BinaryExpression");return i.operator=t,i.left=e,i.right=n,i}function SI(t,e){const n=new Yj("CallExpression");return n.callee=t,n.arguments=e,n}function OI(t){const e=new Yj(eI);return e.name=t,e}function NI(t){const e=new Yj("Literal");return e.value=t.value,e.raw=Zj.slice(t.start,t.end),t.regex&&("//"===e.raw&&(e.raw="/(?:)/"),e.regex=t.regex),e}function MI(t,e,n){const i=new Yj("MemberExpression");return i.computed="["===t,i.object=e,i.property=n,i.computed||(n.member=!0),i}function zI(t,e,n){const i=new Yj("Property");return i.key=e,i.value=n,i.kind=t,i}function $I(t,e){var n,i=Array.prototype.slice.call(arguments,2),r=e.replace(/%(\d)/g,((t,e)=>(cI(e<i.length,"Message reference must be in range"),i[e])));throw(n=new Error(r)).index=Kj,n.description=r,n}function TI(t){2===t.type&&$I(t,"Unexpected end of input"),6===t.type&&$I(t,"Unexpected number"),8===t.type&&$I(t,"Unexpected string"),3===t.type&&$I(t,"Unexpected identifier"),4===t.type&&$I(t,"Unexpected reserved word"),$I(t,nI,t.value)}function BI(t){const e=EI();7===e.type&&e.value===t||TI(e)}function jI(t){return 7===tI.type&&tI.value===t}function II(t){return 4===tI.type&&tI.value===t}function RI(){Kj=tI.start;const t=EI();return 8===t.type||6===t.type?(t.octal&&$I(t,sI),NI(t)):OI(t.value)}function LI(){var t,e,n;return Kj=tI.start,3===(t=tI).type?(n=RI(),BI(":"),zI("init",n,XI())):2!==t.type&&7!==t.type?(e=RI(),BI(":"),zI("init",e,XI())):void TI(t)}const PI={if:1};function UI(){var t,e,n;if(jI("("))return function(){BI("(");const t=YI();return BI(")"),t}();if(jI("["))return function(){const t=[];for(Kj=tI.start,BI("[");!jI("]");)jI(",")?(EI(),t.push(null)):(t.push(XI()),jI("]")||BI(","));return EI(),function(t){const e=new Yj("ArrayExpression");return e.elements=t,e}(t)}();if(jI("{"))return function(){var t,e,n=[],i={},r=String;for(Kj=tI.start,BI("{");!jI("}");)e="$"+((t=LI()).key.type===eI?t.key.name:r(t.key.value)),Object.prototype.hasOwnProperty.call(i,e)?$I({},"Duplicate data property in object literal not allowed in strict mode"):i[e]=!0,n.push(t),jI("}")||BI(",");return BI("}"),function(t){const e=new Yj("ObjectExpression");return e.properties=t,e}(n)}();if(t=tI.type,Kj=tI.start,3===t||PI[tI.value])n=OI(EI().value);else if(8===t||6===t)tI.octal&&$I(tI,sI),n=NI(EI());else{if(4===t)throw new Error(aI);1===t?((e=EI()).value="true"===e.value,n=NI(e)):5===t?((e=EI()).value=null,n=NI(e)):jI("/")||jI("/=")?(n=NI(function(){var t,e,n,i;return tI=null,bI(),t=Kj,e=function(){var t,e,n,i;for(cI("/"===(t=Zj[Kj]),"Regular expression literal must start with a slash"),e=Zj[Kj++],n=!1,i=!1;Kj<Qj;)if(e+=t=Zj[Kj++],"\\"===t)gI((t=Zj[Kj++]).charCodeAt(0))&&$I({},rI),e+=t;else if(gI(t.charCodeAt(0)))$I({},rI);else if(n)"]"===t&&(n=!1);else{if("/"===t){i=!0;break}"["===t&&(n=!0)}return i||$I({},rI),{value:e.substr(1,e.length-2),literal:e}}(),n=function(){var t,e,n;for(e="",n="";Kj<Qj&&yI((t=Zj[Kj]).charCodeAt(0));)++Kj,"\\"===t&&Kj<Qj?$I({},nI,oI):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&$I({},iI,n),{value:n,literal:e}}(),i=function(t,e){let n=t;e.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((t,e)=>{if(parseInt(e,16)<=1114111)return"x";$I({},iI)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(t){$I({},iI)}try{return new RegExp(t,e)}catch(t){return null}}(e.value,n.value),{literal:e.literal+n.literal,value:i,regex:{pattern:e.value,flags:n.value},start:t,end:Kj}}()),DI()):TI(EI())}return n}function qI(){const t=[];if(BI("("),!jI(")"))for(;Kj<Qj&&(t.push(XI()),!jI(")"));)BI(",");return BI(")"),t}function WI(){BI("[");const t=YI();return BI("]"),t}function HI(){const t=function(){var t;for(t=UI();;)if(jI("."))t=MI(".",t,(BI("."),function(){Kj=tI.start;const t=EI();return function(t){return 3===t.type||4===t.type||1===t.type||5===t.type}(t)||TI(t),OI(t.value)}()));else if(jI("("))t=SI(t,qI());else{if(!jI("["))break;t=MI("[",t,WI())}return t}();if(7===tI.type&&(jI("++")||jI("--")))throw new Error(aI);return t}function VI(){var t,e;if(7!==tI.type&&4!==tI.type)e=HI();else{if(jI("++")||jI("--"))throw new Error(aI);if(jI("+")||jI("-")||jI("~")||jI("!"))t=EI(),e=VI(),e=function(t,e){const n=new Yj("UnaryExpression");return n.operator=t,n.argument=e,n.prefix=!0,n}(t.value,e);else{if(II("delete")||II("void")||II("typeof"))throw new Error(aI);e=HI()}}return e}function GI(t){let e=0;if(7!==t.type&&4!==t.type)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11}return e}function XI(){var t,e;return t=function(){var t,e,n,i,r,s,o,a,u,l;if(t=tI,u=VI(),0===(r=GI(i=tI)))return u;for(i.prec=r,EI(),e=[t,tI],s=[u,i,o=VI()];(r=GI(tI))>0;){for(;s.length>2&&r<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),e.pop(),n=FI(a,u,o),s.push(n);(i=EI()).prec=r,s.push(i),e.push(tI),n=VI(),s.push(n)}for(n=s[l=s.length-1],e.pop();l>1;)e.pop(),n=FI(s[l-1].value,s[l-2],n),l-=2;return n}(),jI("?")&&(EI(),e=XI(),BI(":"),t=function(t,e,n){const i=new Yj("ConditionalExpression");return i.test=t,i.consequent=e,i.alternate=n,i}(t,e,XI())),t}function YI(){const t=XI();if(jI(","))throw new Error(aI);return t}function JI(t){Kj=0,Qj=(Zj=t).length,tI=null,DI();const e=YI();if(2!==tI.type)throw new Error("Unexpect token after expression.");return e}var ZI={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function KI(t){function e(e,n,i){return r=>function(e,n,i,r){let s=t(n[0]);return i&&(s=i+"("+s+")",0===i.lastIndexOf("new ",0)&&(s="("+s+")")),s+"."+e+(r<0?"":0===r?"()":"("+n.slice(1).map(t).join(",")+")")}(e,r,n,i)}const n="new Date",i="String",r="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(e){e.length<3&&Wj("Missing arguments to clamp function."),e.length>3&&Wj("Too many arguments to clamp function.");const n=e.map(t);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:e("getDate",n,0),day:e("getDay",n,0),year:e("getFullYear",n,0),month:e("getMonth",n,0),hours:e("getHours",n,0),minutes:e("getMinutes",n,0),seconds:e("getSeconds",n,0),milliseconds:e("getMilliseconds",n,0),time:e("getTime",n,0),timezoneoffset:e("getTimezoneOffset",n,0),utcdate:e("getUTCDate",n,0),utcday:e("getUTCDay",n,0),utcyear:e("getUTCFullYear",n,0),utcmonth:e("getUTCMonth",n,0),utchours:e("getUTCHours",n,0),utcminutes:e("getUTCMinutes",n,0),utcseconds:e("getUTCSeconds",n,0),utcmilliseconds:e("getUTCMilliseconds",n,0),length:e("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:e("toUpperCase",i,0),lower:e("toLowerCase",i,0),substring:e("substring",i),split:e("split",i),trim:e("trim",i,0),regexp:r,test:e("test",r),if:function(e){e.length<3&&Wj("Missing arguments to if function."),e.length>3&&Wj("Too many arguments to if function.");const n=e.map(t);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function QI(t){const e=(t=t||{}).allowed?Xj(t.allowed):{},n=t.forbidden?Xj(t.forbidden):{},i=t.constants||ZI,r=(t.functions||KI)(h),s=t.globalvar,o=t.fieldvar,a=Hj(s)?s:t=>"".concat(s,'["').concat(t,'"]');let u={},l={},c=0;function h(t){if("string"==typeof t)return t;const e=f[t.type];return null==e&&Wj("Unsupported type: "+t.type),e(t)}const f={Literal:t=>t.raw,Identifier:t=>{const r=t.name;return c>0?r:Gj(n,r)?Wj("Illegal identifier: "+r):Gj(i,r)?i[r]:Gj(e,r)?r:(u[r]=1,a(r))},MemberExpression:t=>{const e=!t.computed,n=h(t.object);e&&(c+=1);const i=h(t.property);return n===o&&(l[function(t){const e=t&&t.length-1;return e&&('"'===t[0]&&'"'===t[e]||"'"===t[0]&&"'"===t[e])?t.slice(1,-1):t}(i)]=1),e&&(c-=1),n+(e?"."+i:"["+i+"]")},CallExpression:t=>{"Identifier"!==t.callee.type&&Wj("Illegal callee type: "+t.callee.type);const e=t.callee.name,n=t.arguments,i=Gj(r,e)&&r[e];return i||Wj("Unrecognized function: "+e),Hj(i)?i(n):i+"("+n.map(h).join(",")+")"},ArrayExpression:t=>"["+t.elements.map(h).join(",")+"]",BinaryExpression:t=>"("+h(t.left)+" "+t.operator+" "+h(t.right)+")",UnaryExpression:t=>"("+t.operator+h(t.argument)+")",ConditionalExpression:t=>"("+h(t.test)+"?"+h(t.consequent)+":"+h(t.alternate)+")",LogicalExpression:t=>"("+h(t.left)+t.operator+h(t.right)+")",ObjectExpression:t=>"{"+t.properties.map(h).join(",")+"}",Property:t=>{c+=1;const e=h(t.key);return c-=1,e+":"+h(t.value)}};function d(t){const e={code:h(t),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},e}return d.functions=r,d.constants=i,d}const tR=/[[\]{}]/,eR={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let nR,iR;function rR(t,e,n){return nR=e||"view",iR=n||eR,oR(t.trim()).map(aR)}function sR(t,e,n,i,r){const s=t.length;let o,a=0;for(;e<s;++e){if(o=t[e],!a&&o===n)return e;r&&r.indexOf(o)>=0?--a:i&&i.indexOf(o)>=0&&++a}return e}function oR(t){const e=[],n=t.length;let i=0,r=0;for(;r<n;)r=sR(t,r,",","[{","]}"),e.push(t.substring(i,r).trim()),i=++r;if(0===e.length)throw"Empty event selector: "+t;return e}function aR(t){return"["===t[0]?function(t){const e=t.length;let n,i=1;if(i=sR(t,i,"]","[","]"),i===e)throw"Empty between selector: "+t;if(n=oR(t.substring(1,i)),2!==n.length)throw"Between selector must have two elements: "+t;if(">"!==(t=t.slice(i+1).trim())[0])throw"Expected '>' after between selector: "+t;n=n.map(aR);const r=aR(t.slice(1).trim());return r.between?{between:n,stream:r}:(r.between=n,r)}(t):function(t){const e={source:nR},n=[];let i,r,s=[0,0],o=0,a=0,u=t.length,l=0;if("}"===t[u-1]){if(l=t.lastIndexOf("{"),!(l>=0))throw"Unmatched right brace: "+t;try{s=function(t){const e=t.split(",");if(!t.length||e.length>2)throw t;return e.map((e=>{const n=+e;if(n!=n)throw t;return n}))}(t.substring(l+1,u-1))}catch(e){throw"Invalid throttle specification: "+t}u=(t=t.slice(0,l).trim()).length,l=0}if(!u)throw t;if("@"===t[0]&&(o=++l),i=sR(t,l,":"),i<u&&(n.push(t.substring(a,i).trim()),a=l=++i),l=sR(t,l,"["),l===u)n.push(t.substring(a,u).trim());else if(n.push(t.substring(a,l).trim()),r=[],a=++l,a===u)throw"Unmatched left bracket: "+t;for(;l<u;){if(l=sR(t,l,"]"),l===u)throw"Unmatched left bracket: "+t;if(r.push(t.substring(a,l).trim()),l<u-1&&"["!==t[++l])throw"Expected left bracket: "+t;a=++l}if(!(u=n.length)||tR.test(n[u-1]))throw"Invalid event selector: "+t;var c;return u>1?(e.type=n[1],o?e.markname=n[0].slice(1):(c=n[0],iR[c]?e.marktype=n[0]:e.source=n[0])):e.type=n[0],"!"===e.type.slice(-1)&&(e.consume=!0,e.type=e.type.slice(0,-1)),null!=r&&(e.filter=r),s[0]&&(e.throttle=s[0]),s[1]&&(e.debounce=s[1]),e}(t)}ie(Nu,s,a,u,l,c,f,h,d,p,g,m);const uR="5.20.0";function lR(t,e,n){return t.fields=e||[],t.fname=n,t}function cR(t){return 1===t.length?hR(t[0]):fR(t)}const hR=t=>function(e){return e[t]},fR=t=>{const e=t.length;return function(n){for(let i=0;i<e;++i)n=n[t[i]];return n}};function dR(t){throw Error(t)}function pR(t){var e,n,i,r=[],s=null,o=0,a=t.length,u="";function l(){r.push(u+t.substring(e,n)),u="",e=n+1}for(t+="",e=n=0;n<a;++n)if("\\"===(i=t[n]))u+=t.substring(e,n),u+=t.substring(++n,++n),e=n;else if(i===s)l(),s=null,o=-1;else{if(s)continue;e===o&&'"'===i||e===o&&"'"===i?(e=n+1,s=i):"."!==i||o?"["===i?(n>e&&l(),o=e=n+1):"]"===i&&(o||dR("Access path missing open bracket: "+t),o>0&&l(),o=0,e=n+1):n>e?l():e=n+1}return o&&dR("Access path missing closing bracket: "+t),s&&dR("Access path missing closing quote: "+t),n>e&&(n++,l()),r}var gR=[],mR=(function(t,e,n){const i=pR(t);t=1===i.length?i[0]:t,lR(cR(i),[t],t)}("id"),lR((function(t){return t}),gR,"identity"));function yR(t,e,n){var i=[e].concat([].slice.call(n));console[t].apply(console,i)}lR((function(){return 0}),gR,"zero"),lR((function(){return 1}),gR,"one"),lR((function(){return!0}),gR,"true"),lR((function(){return!1}),gR,"false");const vR=Array.isArray;function bR(t){return t===Object(t)}const xR=t=>"__proto__"!==t;function wR(...t){return t.reduce(((t,e)=>{for(var n in e)if("signals"===n)t.signals=_R(t.signals,e.signals);else{var i="legend"===n?{layout:1}:"style"===n||null;AR(t,n,e[n],i)}return t}),{})}function AR(t,e,n,i){var r,s;if(xR(e))if(bR(n)&&!vR(n))for(r in s=bR(t[e])?t[e]:t[e]={},n)i&&(!0===i||i[r])?AR(s,r,n[r]):xR(r)&&(s[r]=n[r]);else t[e]=n}function _R(t,e){if(null==t)return e;const n={},i=[];function r(t){n[t.name]||(n[t.name]=1,i.push(t))}return e.forEach(r),t.forEach(r),i}function kR(t){return null!=t?vR(t)?t:[t]:[]}const CR=Object.prototype.hasOwnProperty;function ER(t,e){return CR.call(t,e)}function DR(t){return"boolean"==typeof t}function FR(t){return"number"==typeof t}function SR(t){return"string"==typeof t}function OR(t){return vR(t)?"["+t.map(OR)+"]":bR(t)||SR(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function NR(t){for(var e={},n=0,i=t.length;n<i;++n)e[t[n]]=!0;return e}function MR(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}Object.create,Object.create,Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function t(){var e=isNaN(arguments[0])?1:Number(arguments[0]);return e?Array.prototype.reduce.call(this,(function(n,i){return Array.isArray(i)?n.push.apply(n,t.call(i,e-1)):n.push(i),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(t){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var zR=n(8138),$R=n.n(zR),TR=n(9378),BR=n.n(TR),jR=n(5695),IR=n.n(jR);function RR(t){return!!t.or}function LR(t){return!!t.and}function PR(t){return!!t.not}function UR(t,e){if(PR(t))UR(t.not,e);else if(LR(t))for(const n of t.and)UR(n,e);else if(RR(t))for(const n of t.or)UR(n,e);else e(t)}function qR(t,e){return PR(t)?{not:qR(t.not,e)}:LR(t)?{and:t.and.map((t=>qR(t,e)))}:RR(t)?{or:t.or.map((t=>qR(t,e)))}:e(t)}const WR=BR(),HR=$R();function VR(t,e){const n={};for(const i of e)ER(t,i)&&(n[i]=t[i]);return n}function GR(t,e){const n=Object.assign({},t);for(const t of e)delete n[t];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map((t=>IR()(t))).join(",")})`};const XR=IR();function YR(t){if(FR(t))return t;const e=SR(t)?t:IR()(t);if(e.length<250)return e;let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n&=n;return n}function JR(t){return!1===t||null===t}function ZR(t,e){return t.indexOf(e)>-1}function KR(t,e){let n=0;for(const[i,r]of t.entries())if(e(r,i,n++))return!0;return!1}function QR(t,e){let n=0;for(const[i,r]of t.entries())if(!e(r,i,n++))return!1;return!0}function tL(t,e){for(const n of oL(e))AR(t,n,e[n],!0)}function eL(t,e){const n=[],i={};let r;for(const s of t)r=e(s),r in i||(i[r]=1,n.push(s));return n}function nL(t,e){for(const n of t)if(e.has(n))return!0;return!1}function iL(t){const e=new Set;for(const n of t){const t=pR(n).map(((t,e)=>0===e?t:`[${t}]`)),i=t.map(((e,n)=>t.slice(0,n+1).join("")));for(const t of i)e.add(t)}return e}function rL(t,e){return void 0===t||void 0===e||nL(iL(t),iL(e))}function sL(t){return 0===oL(t).length}const oL=Object.keys,aL=Object.values;function uL(t){const e=[];for(const n in t)ER(t,n)&&e.push({key:n,value:t[n]});return e}function lL(t){return!0===t||!1===t}function cL(t){const e=t.replace(/\W/g,"_");return(t.match(/^\d+/)?"_":"")+e}function hL(t,e){return PR(t)?"!("+hL(t.not,e)+")":LR(t)?"("+t.and.map((t=>hL(t,e))).join(") && (")+")":RR(t)?"("+t.or.map((t=>hL(t,e))).join(") || (")+")":e(t)}function fL(t,e){if(0===e.length)return!0;const n=e.shift();return n in t&&fL(t[n],e)&&delete t[n],sL(t)}function dL(t){return t.charAt(0).toUpperCase()+t.substr(1)}function pL(t,e="datum"){const n=pR(t),i=[];for(let t=1;t<=n.length;t++){const r=`[${n.slice(0,t).map(OR).join("][")}]`;i.push(`${e}${r}`)}return i.join(" && ")}function gL(t){return t.replace(/(\[|\]|\.|'|")/g,"\\$1")}function mL(t){return`${pR(t).map(gL).join("\\.")}`}function yL(t,e,n){return t.replace(new RegExp(e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function vL(t){return`${pR(t).join(".")}`}function bL(t){return t?pR(t).length:0}function xL(...t){for(const e of t)if(void 0!==e)return e}let wL=42;function AL(t){if(void 0!==t)return(t%360+360)%360}function _L(t){return!!FR(t)||!isNaN(t)&&!isNaN(parseFloat(t))}const kL={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function CL(t){return t&&t.condition}const EL=["domain","grid","labels","ticks","title"],DL={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},FL={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},SL=Object.assign(Object.assign({},FL),{style:1,labelExpr:1,encoding:1});function OL(t){return!!SL[t]}oL(SL);const NL={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},ML=NL.arc,zL=NL.area,$L=NL.bar,TL=NL.image,BL=NL.line,jL=NL.point,IL=NL.rect,RL=NL.rule,LL=NL.text,PL=NL.tick,UL=NL.trail,qL=NL.circle,WL=NL.square,HL=NL.geoshape;function VL(t){return ZR(["line","area","trail"],t)}function GL(t){return ZR(["rect","bar","image","arc"],t)}const XL=oL(NL);function YL(t){return t.type}NR(XL);const JL=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],ZL=oL({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),KL={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]};function QL(t){return"mark"in t}class tP{constructor(t,e){this.name=t,this.run=e}hasMatchingType(t){return!!QL(t)&&function(t){return YL(t)?t.type:t}(t.mark)===this.name}}const eP={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},nP={count:1,min:1,max:1};function iP(t){return!!t&&!!t.argmin}function rP(t){return!!t&&!!t.argmax}function sP(t){return SR(t)&&!!eP[t]}oL(eP);const oP=["count","valid","missing","distinct"];function aP(t){return SR(t)&&ZR(oP,t)}const uP=["count","sum","distinct","valid","missing"],lP=NR(["mean","average","median","q1","q3","min","max"]),cP="row",hP="column",fP="facet",dP="x",pP="y",gP="x2",mP="y2",yP="radius",vP="radius2",bP="theta",xP="theta2",wP="latitude",AP="longitude",_P="latitude2",kP="longitude2",CP="color",EP="fill",DP="stroke",FP="shape",SP="size",OP="angle",NP="opacity",MP="fillOpacity",zP="strokeOpacity",$P="strokeWidth",TP="strokeDash",BP="text",jP="order",IP="detail",RP="key",LP="tooltip",PP="href",UP="url",qP="description",WP={theta:1,theta2:1,radius:1,radius2:1};function HP(t){return t in WP}const VP={longitude:1,longitude2:1,latitude:1,latitude2:1},GP=oL(VP),XP=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),WP),VP),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function YP(t){return t===CP||t===EP||t===DP}const JP={row:1,column:1,facet:1},ZP=oL(JP),KP=Object.assign(Object.assign({},XP),JP),QP=oL(KP),{order:tU,detail:eU,tooltip:nU}=KP,iU=MR(KP,["order","detail","tooltip"]),{row:rU,column:sU,facet:oU}=iU,aU=MR(iU,["row","column","facet"]);function uU(t){return!!KP[t]}oL(iU),oL(aU);const lU=[gP,mP,_P,kP,xP,vP];function cU(t){return hU(t)!==t}function hU(t){switch(t){case gP:return dP;case mP:return pP;case _P:return wP;case kP:return AP;case xP:return bP;case vP:return yP}return t}function fU(t){if(HP(t))switch(t){case bP:return"startAngle";case xP:return"endAngle";case yP:return"outerRadius";case vP:return"innerRadius"}return t}function dU(t){switch(t){case dP:return gP;case pP:return mP;case wP:return _P;case AP:return kP;case bP:return xP;case yP:return vP}}function pU(t){switch(t){case dP:case gP:return"width";case pP:case mP:return"height"}}oL(XP);const{x:gU,y:mU,x2:yU,y2:vU,latitude:bU,longitude:xU,latitude2:wU,longitude2:AU,theta:_U,theta2:kU,radius:CU,radius2:EU}=XP,DU=MR(XP,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),FU=oL(DU),SU={x:1,y:1},OU=oL(SU);function NU(t){return t in SU}const MU={theta:1,radius:1},zU=oL(MU);function $U(t){return"width"===t?dP:pP}const{text:TU,tooltip:BU,href:jU,url:IU,description:RU,detail:LU,key:PU,order:UU}=DU,qU=MR(DU,["text","tooltip","href","url","description","detail","key","order"]),WU=oL(qU),HU=Object.assign(Object.assign(Object.assign({},SU),MU),qU),VU=oL(HU);function GU(t){return!!HU[t]}const XU={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:YU}=XU,JU=MR(XU,["geoshape"]);function ZU(t){switch(t){case dP:case pP:case bP:case yP:case SP:case OP:case $P:case NP:case MP:case zP:case gP:case mP:case xP:case vP:return;case fP:case cP:case hP:case FP:case TP:case BP:case LP:case PP:case UP:case qP:return"discrete";case CP:case EP:case DP:return"flexible";case wP:case AP:case _P:case kP:case IP:case RP:case jP:return}}function KU(t){return DR(t)&&(t=sV(t,void 0)),"bin"+oL(t).map((e=>nq(t[e])?cL(`_${e}_${Object.entries(t[e])}`):cL(`_${e}_${t[e]}`))).join("")}function QU(t){return!0===t||eq(t)&&!t.binned}function tq(t){return"binned"===t||eq(t)&&!0===t.binned}function eq(t){return bR(t)}function nq(t){return null==t?void 0:t.selection}function iq(t){switch(t){case cP:case hP:case SP:case CP:case EP:case DP:case $P:case NP:case MP:case zP:case FP:return 6;case TP:return 4;default:return 10}}function rq(t){return`Invalid specification ${JSON.stringify(t)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}function sq(t){return("width"==t?"Width":"Height")+' "container" only works for single views and layered views.'}function oq(t){return`${"width"==t?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==t?"x":"y"}".`}function aq(t){return t?`Dropping "fit-${t}" because spec has discrete ${pU(t)}.`:'Dropping "fit" because spec has discrete size.'}function uq(t){return`Cannot project a selection on encoding channel "${t}", which has no field.`}function lq(t,e){return`Cannot project a selection on encoding channel "${t}" as it uses an aggregate function ("${e}").`}function cq(t){return`Selection not supported for ${t} yet.`}function hq(t){return`The "columns" property cannot be used when "${t}" has nested row/column.`}function fq(t,e,n){return`An ancestor parsed field "${t}" as ${n} but a child wants to parse the field as ${e}.`}function dq(t){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${t} are dropped.`}function pq(t){return`Invalid field type "${t}".`}function gq(t,e){const{fill:n,stroke:i}=e;return`Dropping color ${t} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function mq(t,e){return`Dropping ${XR(t)} from channel "${e}" since it does not contain any data field, datum, value, or signal.`}function yq(t,e,n){return`${t} dropped as it is incompatible with "${e}"${n?` when ${n}`:""}.`}function vq(t){return`${t} encoding should be discrete (ordinal / nominal / binned).`}function bq(t,e){return`Using discrete channel "${t}" to encode "${e}" field can be misleading as it does not encode ${"ordinal"===e?"order":"magnitude"}.`}function xq(t){return`Using unaggregated domain with raw field has no effect (${XR(t)}).`}function wq(t){return`Unaggregated domain not applicable for "${t}" since it produces values outside the origin domain of the source data.`}function Aq(t){return`Unaggregated domain is currently unsupported for log scale (${XR(t)}).`}function _q(t,e,n){return`${n}-scale's "${e}" is dropped as it does not work with ${t} scale.`}function kq(t){return`The step for "${t}" is dropped because the ${"width"===t?"x":"y"} is continuous.`}const Cq="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function Eq(t,e){return`Invalid ${t}: ${XR(e)}.`}function Dq(t){return`1D error band does not support ${t}.`}function Fq(t){return`Channel ${t} is required for "binned" bin.`}const Sq=(Oq=2,{level:function(t){return arguments.length?(Oq=+t,this):Oq},error:function(){return Oq>=1&&yR("error","ERROR",arguments),this},warn:function(){return Oq>=2&&yR("warn","WARN",arguments),this},info:function(){return Oq>=3&&yR("log","INFO",arguments),this},debug:function(){return Oq>=4&&yR("log","DEBUG",arguments),this}});var Oq;let Nq=Sq;function Mq(...t){Nq.warn(...t)}function zq(t){if(t&&bR(t))for(const e of Pq)if(e in t)return!0;return!1}const $q=["january","february","march","april","may","june","july","august","september","october","november","december"],Tq=$q.map((t=>t.substr(0,3))),Bq=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],jq=Bq.map((t=>t.substr(0,3)));function Iq(t,e){const n=[];if(e&&void 0!==t.day&&oL(t).length>1&&(Mq(function(t){return`Dropping day from datetime ${XR(t)} as day cannot be combined with other units.`}(t)),delete(t=HR(t)).day),void 0!==t.year?n.push(t.year):n.push(2012),void 0!==t.month){const i=e?function(t){if(_L(t)&&(t=+t),FR(t))return t-1;{const e=t.toLowerCase(),n=$q.indexOf(e);if(-1!==n)return n;const i=e.substr(0,3),r=Tq.indexOf(i);if(-1!==r)return r;throw new Error(Eq("month",t))}}(t.month):t.month;n.push(i)}else if(void 0!==t.quarter){const i=e?function(t){if(_L(t)&&(t=+t),FR(t))return t>4&&Mq(Eq("quarter",t)),t-1;throw new Error(Eq("quarter",t))}(t.quarter):t.quarter;n.push(FR(i)?3*i:i+"*3")}else n.push(0);if(void 0!==t.date)n.push(t.date);else if(void 0!==t.day){const i=e?function(t){if(_L(t)&&(t=+t),FR(t))return t%7;{const e=t.toLowerCase(),n=Bq.indexOf(e);if(-1!==n)return n;const i=e.substr(0,3),r=jq.indexOf(i);if(-1!==r)return r;throw new Error(Eq("day",t))}}(t.day):t.day;n.push(FR(i)?i+1:i+"+1")}else n.push(1);for(const e of["hours","minutes","seconds","milliseconds"]){const i=t[e];n.push(void 0===i?0:i)}return n}function Rq(t){const e=Iq(t,!0).join(", ");return t.utc?`utc(${e})`:`datetime(${e})`}const Lq={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Pq=oL(Lq);function Uq(t){return t.startsWith("utc")}const qq={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Wq(t){const e=[];for(const n of Pq)Hq(t,n)&&e.push(n);return e}function Hq(t,e){const n=t.indexOf(e);return!(n<0||n>0&&"seconds"===e&&"i"===t.charAt(n-1)||t.length>n+3&&"day"===e&&"o"===t.charAt(n+3)||n>0&&"year"===e&&"f"===t.charAt(n-1))}function Vq(t){if(!t)return;const e=Wq(t);return`timeUnitSpecifier(${IR()(e)}, ${IR()(qq)})`}function Gq(t){if(!t)return;let e;return SR(t)?e={unit:t}:bR(t)&&(e=Object.assign(Object.assign({},t),t.unit?{unit:t.unit}:{})),Uq(e.unit)&&(e.utc=!0,e.unit=e.unit.substr(3)),e}function Xq(t){return t&&!!t.signal}function Yq(t){return!!t.step}function Jq(t){return!vR(t)&&"field"in t&&"data"in t}const Zq=oL({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),Kq={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Qq=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function tW(t){return t&&!!t.field&&void 0!==t.equal}function eW(t){return t&&!!t.field&&void 0!==t.lt}function nW(t){return t&&!!t.field&&void 0!==t.lte}function iW(t){return t&&!!t.field&&void 0!==t.gt}function rW(t){return t&&!!t.field&&void 0!==t.gte}function sW(t){if(t&&t.field){if(vR(t.range)&&2===t.range.length)return!0;if(Xq(t.range))return!0}return!1}function oW(t){return t&&!!t.field&&(vR(t.oneOf)||vR(t.in))}function aW(t){return oW(t)||tW(t)||sW(t)||eW(t)||iW(t)||nW(t)||rW(t)}function uW(t,e){return uV(t,{timeUnit:e,wrapTime:!0})}function lW(t,e=!0){var n;const{field:i}=t,r=null===(n=Gq(t.timeUnit))||void 0===n?void 0:n.unit,s=r?"time("+function(t,e,{end:n}={end:!1}){const i=pL(e),r=Uq(t)?"utc":"";let s;const o={};for(const e of Pq)Hq(t,e)&&(o[e]="quarter"===(a=e)?`(${r}quarter(${i})-1)`:`${r}${a}(${i})`,s=e);var a;return n&&(o[s]+="+1"),function(t){const e=Iq(t,!1).join(", ");return t.utc?`utc(${e})`:`datetime(${e})`}(o)}(r,i)+")":WH(t,{expr:"datum"});if(tW(t))return s+"==="+uW(t.equal,r);if(eW(t))return`${s}<${uW(t.lt,r)}`;if(iW(t))return`${s}>${uW(t.gt,r)}`;if(nW(t))return`${s}<=${uW(t.lte,r)}`;if(rW(t))return`${s}>=${uW(t.gte,r)}`;if(oW(t))return`indexof([${function(t,e){return t.map((t=>uW(t,e)))}(t.oneOf,r).join(",")}], ${s}) !== -1`;if(function(t){return t&&!!t.field&&void 0!==t.valid}(t))return cW(s,t.valid);if(sW(t)){const{range:n}=t,i=Xq(n)?{signal:`${n.signal}[0]`}:n[0],o=Xq(n)?{signal:`${n.signal}[1]`}:n[1];if(null!==i&&null!==o&&e)return"inrange("+s+", ["+uW(i,r)+", "+uW(o,r)+"])";const a=[];return null!==i&&a.push(`${s} >= ${uW(i,r)}`),null!==o&&a.push(`${s} <= ${uW(o,r)}`),a.length>0?a.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(t)}`)}function cW(t,e=!0){return e?`isValid(${t}) && isFinite(+${t})`:`!isValid(${t}) || !isFinite(+${t})`}function hW(t){var e;return aW(t)&&t.timeUnit?Object.assign(Object.assign({},t),{timeUnit:null===(e=Gq(t.timeUnit))||void 0===e?void 0:e.unit}):t}const fW={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},dW=fW.quantitative,pW=fW.ordinal,gW=fW.temporal,mW=fW.nominal,yW=fW.geojson,vW=oL(fW),bW="linear",xW="time",wW="utc",AW="point",_W={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},kW=oL(_W);function CW(t,e){const n=_W[t],i=_W[e];return n===i||"ordinal-position"===n&&"time"===i||"ordinal-position"===i&&"time"===n}const EW={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function DW(t){return EW[t]}const FW=["linear","log","pow","sqrt","symlog","time","utc"],SW=NR(FW),OW=NR(["linear","log","pow","sqrt","symlog"]),NW=NR(["quantile","quantize","threshold"]),MW=NR(FW.concat(["quantile","quantize","threshold","sequential","identity"])),zW=NR(["ordinal","bin-ordinal","point","band"]);function $W(t){return t in zW}function TW(t){return t in MW}function BW(t){return t in SW}function jW(t){return t in NW}function IW(t){return null==t?void 0:t.selection}const RW={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:LW,domain:PW,range:UW,scheme:qW}=(oL(RW),RW),WW=MR(RW,["type","domain","range","scheme"]),HW=oL(WW);function VW(t,e){switch(e){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!ZR(["point","band","identity"],t);case"bins":return!ZR(["point","band","identity","ordinal"],t);case"round":return BW(t)||"band"===t||"point"===t;case"padding":return BW(t)||ZR(["point","band"],t);case"paddingOuter":case"align":return ZR(["point","band"],t);case"paddingInner":return"band"===t;case"domainMid":case"clamp":return BW(t);case"nice":return BW(t)||"quantize"===t||"threshold"===t;case"exponent":return"pow"===t;case"base":return"log"===t;case"constant":return"symlog"===t;case"zero":return TW(t)&&!ZR(["log","time","utc","threshold","quantile"],t)}}function GW(t,e){switch(e){case"interpolate":case"scheme":case"domainMid":return YP(t)?void 0:`Cannot use the scale property "${t}" with non-color channel.`;case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function XW(t,e){return ZR([pW,mW],e)?void 0===t||$W(t):e===gW?ZR([xW,wW,void 0],t):e!==dW||ZR(["log","pow","sqrt","symlog","quantile","quantize","threshold",bW,void 0],t)}function YW(t,e){if(!GU(t))return!1;switch(t){case dP:case pP:case bP:case yP:return BW(e)||ZR(["band","point"],e);case SP:case $P:case NP:case MP:case zP:case OP:return BW(e)||jW(e)||ZR(["band","point","ordinal"],e);case CP:case EP:case DP:return"band"!==e;case TP:return"ordinal"===e||jW(e);case FP:return"ordinal"===e}}function JW(t,e){return t+"_"+e}function ZW(t){const{channel:e,channelDef:n,markDef:i,scale:r,config:s}=t,o=iH(t);return MH(n)&&!aP(n.aggregate)&&r&&BW(r.get("type"))&&!1===r.get("zero")?KW({fieldDef:n,channel:e,markDef:i,ref:o,config:s}):o}function KW({fieldDef:t,channel:e,markDef:n,ref:i,config:r}){return VL(n.type)||null===yV("invalid",n,r)?i:[QW(t,e),i]}function QW(t,e){const n=tH(t,!0),i="y"===hU(e)?{field:{group:"height"}}:{value:0};return Object.assign({test:n},i)}function tH(t,e=!0){return cW(SR(t)?t:WH(t,{expr:"datum"}),!e)}function eH(t,e,n,i){const r={};if(e&&(r.scale=e),$H(t)){const{datum:e}=t;zq(e)?r.signal=Rq(e):Xq(e)?r.signal=e.signal:r.value=e}else r.field=WH(t,n);if(i){const{offset:t,band:e}=i;t&&(r.offset=t),e&&(r.band=e)}return r}function nH({scaleName:t,fieldOrDatumDef:e,fieldOrDatumDef2:n,offset:i,startSuffix:r,band:s=.5}){const o=0<s&&s<1?"datum":void 0,a=WH(e,{expr:o,suffix:r}),u=void 0!==n?WH(n,{expr:o}):WH(e,{suffix:"end",expr:o}),l={};if(0===s||1===s){l.scale=t;const e=0===s?a:u;l.field=e}else{const e=`${s} * ${a} + ${1-s} * ${u}`;l.signal=`scale("${t}", ${e})`}return i&&(l.offset=i),l}function iH({channel:t,channelDef:e,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:u,defaultRef:l,band:c}){var h;if(e){if(jH(e)){if(IH(e)){c=null!=c?c:DH({channel:t,fieldDef:e,fieldDef2:n,markDef:i,stack:a,config:r,isMidPoint:!0});const{bin:o,timeUnit:l,type:h}=e;if(QU(o)||c&&l&&h===gW)return a&&a.impute?eH(e,s,{binSuffix:"mid"},{offset:u}):c?nH({scaleName:s,fieldOrDatumDef:e,band:c,offset:u}):eH(e,s,cV(e,t)?{binSuffix:"range"}:{},{offset:u});if(tq(o)){if(MH(n))return nH({scaleName:s,fieldOrDatumDef:e,fieldOrDatumDef2:n,band:c,offset:u});Mq(Fq(t===dP?gP:mP))}}const l=null==o?void 0:o.get("type");return eH(e,s,$W(l)?{binSuffix:"range"}:{},{offset:u,band:"band"===l?null!==(h=null!=c?c:e.band)&&void 0!==h?h:.5:void 0})}if(RH(e)){const n=e.value,i=u?{offset:u}:{};return Object.assign(Object.assign({},rH(t,n)),i)}}return"function"==typeof l&&(l=l()),l?Object.assign(Object.assign({},l),u?{offset:u}:{}):l}function rH(t,e){return ZR(["x","x2"],t)&&"width"===e?{field:{group:"width"}}:ZR(["y","y2"],t)&&"height"===e?{field:{group:"height"}}:dV(e)}function sH(t){return t&&"number"!==t&&"time"!==t}function oH(t,e,n){return`${t}(${e}${n?`, ${JSON.stringify(n)}`:""})`}function aH({fieldOrDatumDef:t,format:e,formatType:n,expr:i,normalizeStack:r,config:s}){var o,a;if(sH(n))return lH({fieldOrDatumDef:t,format:e,formatType:n,expr:i,config:s});const u=uH(t,i,r);if(aV(t)){const n=function(t,e,n,i,r){return!e||n?`${r?"utc":"time"}Format(${t}, '${n=SR(n)?n:i}')`:function(t,e,n){if(!t)return;const i=Vq(t);return`${n||Uq(t)?"utc":"time"}Format(${e}, ${i})`}(e,t,r)}(u,MH(t)?null===(o=Gq(t.timeUnit))||void 0===o?void 0:o.unit:void 0,e,s.timeFormat,LH(t)&&(null===(a=t.scale)||void 0===a?void 0:a.type)===wW);return n?{signal:n}:void 0}return e=fH(zH(t),e,s),MH(t)&&QU(t.bin)?{signal:gH(u,WH(t,{expr:i,binSuffix:"end"}),e,n,s)}:e||"quantitative"===zH(t)?{signal:`${dH(u,e)}`}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function uH(t,e,n){return MH(t)?n?`${WH(t,{expr:e,suffix:"end"})}-${WH(t,{expr:e,suffix:"start"})}`:WH(t,{expr:e}):function(t){const{datum:e}=t;return zq(e)?Rq(e):`${JSON.stringify(e)}`}(t)}function lH({fieldOrDatumDef:t,format:e,formatType:n,expr:i,normalizeStack:r,config:s,field:o}){return o=null!=o?o:uH(t,i,r),MH(t)&&QU(t.bin)?{signal:gH(o,WH(t,{expr:i,binSuffix:"end"}),e,n,s)}:{signal:oH(n,o,e)}}function cH(t,e,n,i,r,s){var o;if(!sH(i))return aV(t)?function(t,e,n,i){return t||(e?{signal:Vq(e)}:i?void 0:n.timeFormat)}(n,MH(t)?null===(o=Gq(t.timeUnit))||void 0===o?void 0:o.unit:void 0,r,s):fH(e,n,r)}function hH(t,e,n){return t&&(Xq(t)||"number"===t||"time"===t)?t:aV(e)&&"time"!==n&&"utc"!==n?"time":void 0}function fH(t,e,n){return SR(e)?e:t===dW?n.numberFormat:void 0}function dH(t,e){return`format(${t}, "${e||""}")`}function pH(t,e,n,i){var r;return sH(n)?oH(n,t,e):dH(t,null!==(r=SR(e)?e:void 0)&&void 0!==r?r:i.numberFormat)}function gH(t,e,n,i,r){const s=pH(t,n,i,r),o=pH(e,n,i,r);return`${cW(t,!1)} ? "null" : ${s} + "  " + ${o}`}!function(){var t;const e={};for(const n of QP)for(const i of vW)for(const r of kW){const s=JW(n,i);YW(n,r)&&XW(r,i)&&(e[s]=null!==(t=e[s])&&void 0!==t?t:[],e[s].push(r))}}();const mH="min",yH={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function vH(t){return t in yH}function bH(t){return!!t&&!!t.encoding}function xH(t){return!(!t||"count"!==t.op&&!t.field)}function wH(t){return!!t&&vR(t)}function AH(t){return"row"in t||"column"in t}function _H(t){return!!t&&"header"in t}function kH(t){return"facet"in t}function CH(t){const{field:e,timeUnit:n,bin:i,aggregate:r}=t;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:e})}function EH(t){return IH(t)&&"sort"in t}function DH({channel:t,fieldDef:e,fieldDef2:n,markDef:i,stack:r,config:s,isMidPoint:o}){if(jH(e)&&void 0!==e.band)return e.band;if(MH(e)){const{timeUnit:t,bin:r}=e;if(t&&!n)return o?vV("timeUnitBandPosition",i,s):GL(i.type)?vV("timeUnitBand",i,s):0;if(QU(r))return GL(i.type)&&!o?1:.5}return(null==r?void 0:r.fieldChannel)===t&&o?.5:void 0}function FH(t,e,n,i,r,s){return!!(QU(e.bin)||e.timeUnit&&IH(e)&&"temporal"===e.type)&&!!DH({channel:t,fieldDef:e,fieldDef2:n,stack:i,markDef:r,config:s})}function SH(t){return!!t&&"condition"in t}function OH(t){const e=t&&t.condition;return!!e&&!vR(e)&&MH(e)}function NH(t){const e=t&&t.condition;return!!e&&!vR(e)&&jH(e)}function MH(t){return!(!t||!t.field&&"count"!==t.aggregate)}function zH(t){return t&&t.type}function $H(t){return!!t&&"datum"in t}function TH(t){return IH(t)&&VH(t)||BH(t)}function BH(t){return $H(t)&&FR(t.datum)}function jH(t){return MH(t)||$H(t)}function IH(t){return!!t&&("field"in t&&"type"in t||"count"===t.aggregate)}function RH(t){return t&&"value"in t&&"value"in t}function LH(t){return!!t&&("scale"in t||"sort"in t)}function PH(t){return t&&("axis"in t||"stack"in t||"impute"in t)}function UH(t){return!!t&&"legend"in t}function qH(t){return!!t&&("format"in t||"formatType"in t)}function WH(t,e={}){var n,i,r;let s=t.field;const o=e.prefix;let a=e.suffix,u="";if(function(t){return"count"===t.aggregate}(t))s=function(t){return 0===t.indexOf("__")}(l="count")?l:"__count";else{let o;if(!e.nofn)if(function(t){return"op"in t}(t))o=t.op;else{const{bin:l,aggregate:c,timeUnit:h}=t;QU(l)?(o=KU(l),a=(null!==(n=e.binSuffix)&&void 0!==n?n:"")+(null!==(i=e.suffix)&&void 0!==i?i:"")):c?rP(c)?(u=`["${s}"]`,s=`argmax_${c.argmax}`):iP(c)?(u=`["${s}"]`,s=`argmin_${c.argmin}`):o=String(c):h&&(o=function(t){const e=Gq(t),{utc:n}=e,i=MR(e,["utc"]);return i.unit?(n?"utc":"")+oL(i).map((t=>cL(`${"unit"===t?"":`_${t}_`}${i[t]}`))).join(""):(n?"utc":"")+"timeunit"+oL(i).map((t=>cL(`_${t}_${i[t]}`))).join("")}(h),a=(!ZR(["range","mid"],e.binSuffix)&&e.binSuffix||"")+(null!==(r=e.suffix)&&void 0!==r?r:""))}o&&(s=s?`${o}_${s}`:o)}var l;return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),e.forAs?vL(s):e.expr?function(t,e="datum"){return`${e}[${OR(pR(t).join("."))}]`}(s,e.expr)+u:mL(s)+u}function HH(t){switch(t.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return MH(t)&&!!t.bin;case"temporal":return!1}throw new Error(pq(t.type))}function VH(t){return!HH(t)}const GH=(t,e)=>{switch(e.fieldTitle){case"plain":return t.field;case"functional":return function(t){const{aggregate:e,bin:n,timeUnit:i,field:r}=t;if(rP(e))return`${r} for argmax(${e.argmax})`;if(iP(e))return`${r} for argmin(${e.argmin})`;const s=Gq(i),o=e||(null==s?void 0:s.unit)||(null==s?void 0:s.maxbins)&&"timeunit"||QU(n)&&"bin";return o?o.toUpperCase()+"("+r+")":r}(t);default:return function(t,e){var n;const{field:i,bin:r,timeUnit:s,aggregate:o}=t;if("count"===o)return e.countTitle;if(QU(r))return`${i} (binned)`;if(s){const t=null===(n=Gq(s))||void 0===n?void 0:n.unit;if(t)return`${i} (${Wq(t).join("-")})`}else if(o)return rP(o)?`${i} for max ${o.argmax}`:iP(o)?`${i} for min ${o.argmin}`:`${dL(o)} of ${i}`;return i}(t,e)}};let XH=GH;function YH(t){XH=t}function JH(t,e,{allowDisabling:n,includeDefault:i=!0}){var r,s;const o=(null!==(r=ZH(t))&&void 0!==r?r:{}).title;if(!MH(t))return o;const a=t,u=i?KH(a,e):void 0;return n?xL(o,a.title,u):null!==(s=null!=o?o:a.title)&&void 0!==s?s:u}function ZH(t){return PH(t)&&t.axis?t.axis:UH(t)&&t.legend?t.legend:_H(t)&&t.header?t.header:void 0}function KH(t,e){return XH(t,e)}function QH(t){var e;if(qH(t)){const{format:e,formatType:n}=t;return{format:e,formatType:n}}{const n=null!==(e=ZH(t))&&void 0!==e?e:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function tV(t){return MH(t)?t:OH(t)?t.condition:void 0}function eV(t){return jH(t)?t:NH(t)?t.condition:void 0}function nV(t,e,n){return SR(t)||FR(t)||DR(t)?(Mq(function(t,e,n){return`Channel ${t} is a ${e}. Converted to {value: ${XR(n)}}.`}(e,SR(t)?"string":FR(t)?"number":"boolean",t)),{value:t}):jH(t)?iV(t,e,n):NH(t)?Object.assign(Object.assign({},t),{condition:iV(t.condition,e,n)}):t}function iV(t,e,n){if(qH(t)){const{format:i,formatType:r}=t,s=MR(t,["format","formatType"]);if(sH(r)&&!n.customFormatTypes)return Mq(dq(e)),iV(s,e,n)}else{const i=PH(t)?"axis":UH(t)?"legend":_H(t)?"header":null;if(i&&t[i]){const r=t[i],{format:s,formatType:o}=r,a=MR(r,["format","formatType"]);if(sH(o)&&!n.customFormatTypes)return Mq(dq(e)),iV(Object.assign(Object.assign({},t),{[i]:a}),e,n)}}return MH(t)?rV(t,e):function(t){let e=t.type;if(e)return t;const{datum:n}=t;return e=FR(n)?"quantitative":SR(n)?"nominal":zq(n)?"temporal":void 0,Object.assign(Object.assign({},t),{type:e})}(t)}function rV(t,e){const{aggregate:n,timeUnit:i,bin:r,field:s}=t,o=Object.assign({},t);if(!n||sP(n)||rP(n)||iP(n)||(Mq(function(t){return`Invalid aggregation operator "${t}".`}(n)),delete o.aggregate),i&&(o.timeUnit=Gq(i)),s&&(o.field=`${s}`),QU(r)&&(o.bin=sV(r,e)),tq(r)&&!NU(e)&&Mq(`Channel ${e} should not be used with "binned" bin.`),IH(o)){const{type:t}=o,e=function(t){if(t)switch(t=t.toLowerCase()){case"q":case dW:return"quantitative";case"t":case gW:return"temporal";case"o":case pW:return"ordinal";case"n":case mW:return"nominal";case yW:return"geojson"}}(t);t!==e&&(o.type=e),"quantitative"!==t&&aP(n)&&(Mq(function(t,e){return`Invalid field type "${t}" for aggregate: "${e}", using "quantitative" instead.`}(t,n)),o.type="quantitative")}else if(!cU(e)){const t=function(t,e){if(t.timeUnit)return"temporal";if(QU(t.bin))return"quantitative";switch(ZU(e)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}(o,e);Mq(function(t,e){return`Missing type for channel "${t}", using "${e}" instead.`}(e,t)),o.type=t}if(IH(o)){const{compatible:t,warning:n}=function(t,e){const n=t.type;if("geojson"===n&&"shape"!==e)return{compatible:!1,warning:`Channel ${e} should not be used with a geojson data.`};switch(e){case cP:case hP:case fP:return VH(t)?{compatible:!1,warning:vq(e)}:oV;case dP:case pP:case CP:case EP:case DP:case BP:case IP:case RP:case LP:case PP:case UP:case OP:case bP:case yP:case qP:return oV;case AP:case kP:case wP:case _P:return n!==dW?{compatible:!1,warning:`Channel ${e} should be used with a quantitative field only, not ${t.type} field.`}:oV;case NP:case MP:case zP:case $P:case SP:case xP:case vP:case gP:case mP:return"nominal"!==n||t.sort?oV:{compatible:!1,warning:`Channel ${e} should not be used with an unsorted discrete field.`};case TP:return ZR(["ordinal","nominal"],t.type)?oV:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case FP:return ZR(["ordinal","nominal","geojson"],t.type)?oV:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case jP:return"nominal"!==t.type||"sort"in t?oV:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(o,e);t||Mq(n)}if(EH(o)&&SR(o.sort)){const{sort:t}=o;if(vH(t))return Object.assign(Object.assign({},o),{sort:{encoding:t}});const e=t.substr(1);if("-"===t.charAt(0)&&vH(e))return Object.assign(Object.assign({},o),{sort:{encoding:e,order:"descending"}})}if(_H(o)){const{header:t}=o,{orient:e}=t,n=MR(t,["orient"]);if(e)return Object.assign(Object.assign({},o),{header:Object.assign(Object.assign({},n),{labelOrient:t.labelOrient||e,titleOrient:t.titleOrient||e})})}return o}function sV(t,e){return DR(t)?{maxbins:iq(e)}:"binned"===t?{binned:!0}:t.maxbins||t.step?t:Object.assign(Object.assign({},t),{maxbins:iq(e)})}const oV={compatible:!0};function aV(t){const{formatType:e}=QH(t);return"time"===e||!e&&function(t){return t&&("temporal"===t.type||MH(t)&&!!t.timeUnit)}(t)}function uV(t,{timeUnit:e,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var s;const o=e&&(null===(s=Gq(e))||void 0===s?void 0:s.unit);let a,u=o||"temporal"===n;return Xq(t)?a=t.signal:zq(t)?(u=!0,a=Rq(t)):(SR(t)||FR(t))&&u&&(a=`datetime(${JSON.stringify(t)})`,function(t){return!!Lq[t]}(o)&&(FR(t)&&t<1e4||SR(t)&&isNaN(Date.parse(t)))&&(a=Rq({[o]:t}))),a?i&&u?`time(${a})`:a:r?void 0:JSON.stringify(t)}function lV(t,e){const{type:n}=t;return e.map((e=>{const i=uV(e,{timeUnit:MH(t)?t.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==i?{signal:i}:e}))}function cV(t,e){return QU(t.bin)?GU(e)&&ZR(["ordinal","nominal"],t.type):(console.warn("Only call this method for binned field defs."),!1)}function hV(t){const{anchor:e,frame:n,offset:i,orient:r,color:s,subtitleColor:o,subtitleFont:a,subtitleFontSize:u,subtitleFontStyle:l,subtitleFontWeight:c,subtitleLineHeight:h,subtitlePadding:f}=t,d=MR(t,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},d),s?{fill:s}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign({},e?{anchor:e}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),a?{subtitleFont:a}:{}),u?{subtitleFontSize:u}:{}),l?{subtitleFontStyle:l}:{}),c?{subtitleFontWeight:c}:{}),h?{subtitleLineHeight:h}:{}),f?{subtitlePadding:f}:{});return{titleMarkConfig:p,subtitleMarkConfig:VR(p,["align","baseline","dx","dy","limit"]),nonMark:g,subtitle:m}}function fV(t){return SR(t)||vR(t)&&SR(t[0])}function dV(t){return Xq(t)?t:void 0!==t?{value:t}:void 0}function pV(t){return Xq(t)?t.signal:OR(t.value)}function gV(t){return Xq(t)?t.signal:null==t?null:OR(t)}function mV(t){var e;return[].concat(t.type,null!==(e=t.style)&&void 0!==e?e:[])}function yV(t,e,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&void 0!==e[r]?e[r]:void 0!==e[t]?e[t]:!s||r&&r!==t?vV(t,e,n,i):void 0}function vV(t,e,n,{vgChannel:i}={}){return xL(i?bV(t,e,n.style):void 0,bV(t,e,n.style),i?n[e.type][i]:void 0,n[e.type][t],i?n.mark[i]:n.mark[t])}function bV(t,e,n){return xV(t,mV(e),n)}function xV(t,e,n){let i;e=kR(e);for(const r of e){const e=n[r];e&&void 0!==e[t]&&(i=e[t])}return i}function wV(t,e){return kR(t).reduce(((t,n)=>{var i;return t.field.push(WH(n,e)),t.order.push(null!==(i=n.sort)&&void 0!==i?i:"ascending"),t}),{field:[],order:[]})}function AV(t,e){const n=[...t];return e.forEach((t=>{for(const e of n)if(WR(e,t))return;n.push(t)})),n}function _V(t,e){return WR(t,e)||!e?t:t?[...kR(t),...kR(e)].join(", "):e}function kV(t,e){const n=t.value,i=e.value;if(null==n||null===i)return{explicit:t.explicit,value:null};if((fV(n)||Xq(n))&&(fV(i)||Xq(i)))return{explicit:t.explicit,value:_V(n,i)};if(fV(n)||Xq(n))return{explicit:t.explicit,value:n};if(fV(i)||Xq(i))return{explicit:t.explicit,value:i};if(!(fV(n)||Xq(n)||fV(i)||Xq(i)))return{explicit:t.explicit,value:AV(n,i)};throw new Error("It should never reach here")}function CV(t,e){const n=t&&t[e];return!!n&&(vR(n)?KR(n,(t=>!!t.field)):MH(n)||OH(n))}function EV(t){return KR(QP,(e=>{if(CV(t,e)){const n=t[e];if(vR(n))return KR(n,(t=>!!t.aggregate));{const t=tV(n);return t&&!!t.aggregate}}return!1}))}function DV(t,e){const n=[],i=[],r=[],s=[],o={};return OV(t,((a,u)=>{if(MH(a)){const{field:l,aggregate:c,bin:h,timeUnit:f}=a,d=MR(a,["field","aggregate","bin","timeUnit"]);if(c||f||h){const t=ZH(a),p=t&&t.title;let g=WH(a,{forAs:!0});const m=Object.assign(Object.assign(Object.assign({},p?[]:{title:JH(a,e,{allowDisabling:!0})}),d),{field:g});if(c){let t;if(rP(c)?(t="argmax",g=WH({op:"argmax",field:c.argmax},{forAs:!0}),m.field=`${g}.${l}`):iP(c)?(t="argmin",g=WH({op:"argmin",field:c.argmin},{forAs:!0}),m.field=`${g}.${l}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(t=c),t){const e={op:t,as:g};l&&(e.field=l),s.push(e)}}else if(n.push(g),IH(a)&&QU(h)){if(i.push({bin:h,field:l,as:g}),n.push(WH(a,{binSuffix:"end"})),cV(a,u)&&n.push(WH(a,{binSuffix:"range"})),NU(u)){const t={field:g+"_end"};o[u+"2"]=t}m.bin="binned",cU(u)||(m.type=dW)}else if(f){r.push({timeUnit:f,field:l,as:g});const t=IH(a)&&a.type!==gW&&"time";t&&(u===BP||u===LP?m.formatType=t:function(t){return!!DU[t]}(u)?m.legend=Object.assign({formatType:t},m.legend):NU(u)&&(m.axis=Object.assign({formatType:t},m.axis)))}o[u]=m}else n.push(l),o[u]=t[u]}else o[u]=t[u]})),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:o}}function FV(t,e,n){const i=e.type;return oL(t).reduce(((r,s)=>{if(!uU(s))return Mq(function(t){return`${t}-encoding is dropped as ${t} is not a valid encoding channel.`}(s)),r;const o=t[s];if("angle"!==s||"arc"!==i||t.theta||(Mq("Arc marks uses theta channel rather than angle, replacing angle with theta."),s=bP),!function(t,e,n){const i=function(t,e){return function(t){switch(t){case CP:case EP:case DP:case qP:case IP:case RP:case LP:case PP:case jP:case NP:case MP:case zP:case $P:case fP:case cP:case hP:return XU;case dP:case pP:case wP:case AP:return JU;case gP:case mP:case _P:case kP:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case SP:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case TP:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case FP:return{point:"always",geoshape:"always"};case BP:return{text:"always"};case OP:return{point:"always",square:"always",text:"always"};case UP:return{image:"always"};case bP:case yP:return{text:"always",arc:"always"};case xP:case vP:return{arc:"always"}}}(t)[e]}(e,n);if(!i)return!1;if("binned"===i){const n=t[e===gP?dP:pP];return!!(MH(n)&&MH(t[e])&&tq(n.bin))}return!0}(t,s,i))return Mq(yq(s,i)),r;if(s===SP&&"line"===i){const e=tV(t[s]);if(null==e?void 0:e.aggregate)return Mq("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),r}if(s===CP&&(e.filled?"fill"in t:"stroke"in t))return Mq(gq("encoding",{fill:"fill"in t,stroke:"stroke"in t})),r;if(s===IP||s===jP&&!vR(o)&&!RH(o)||s===LP&&vR(o))o&&(r[s]=kR(o).reduce(((t,e)=>(MH(e)?t.push(rV(e,s)):Mq(mq(e,s)),t)),[]));else{if(s===LP&&null===o)r[s]=null;else if(!(MH(o)||$H(o)||RH(o)||SH(o)||Xq(o)))return Mq(mq(o,s)),r;r[s]=nV(o,s,n)}return r}),{})}function SV(t){const e=[];for(const n of oL(t))if(CV(t,n)){const i=kR(t[n]);for(const t of i)MH(t)?e.push(t):OH(t)&&e.push(t.condition)}return e}function OV(t,e,n){if(t)for(const i of oL(t)){const r=t[i];if(vR(r))for(const t of r)e.call(n,t,i);else e.call(n,r,i)}}function NV(t,e,n,i){return t?oL(t).reduce(((n,r)=>{const s=t[r];return vR(s)?s.reduce(((t,n)=>e.call(i,t,n,r)),n):e.call(i,n,s,r)}),n):n}function MV(t,e){return oL(e).reduce(((n,i)=>{switch(i){case dP:case pP:case PP:case qP:case UP:case gP:case mP:case bP:case xP:case yP:case vP:case wP:case AP:case _P:case kP:case BP:case FP:case OP:case LP:return n;case jP:if("line"===t||"trail"===t)return n;case IP:case RP:{const t=e[i];if(vR(t)||MH(t))for(const e of kR(t))e.aggregate||n.push(WH(e,{}));return n}case SP:if("trail"===t)return n;case CP:case EP:case DP:case NP:case MP:case zP:case TP:case $P:{const t=tV(e[i]);return t&&!t.aggregate&&n.push(WH(t,{})),n}}}),[])}function zV(t,e,n,i=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...t.map((({fieldPrefix:t,titlePrefix:n})=>{const r=i?` of ${e.field}`:"";return{field:t+e.field,type:e.type,title:Xq(n)?{signal:n+`"${escape(r)}"`}:n+r}})),...SV(n)]}}function $V(t){const{axis:e,title:n,field:i}=t;return e&&void 0!==e.title?void 0:xL(n,i)}function TV(t,e,n,i,r){const{scale:s,axis:o}=n;return({partName:a,mark:u,positionPrefix:l,endPositionPrefix:c,aria:h,extraEncoding:f={}})=>{const d=$V(n);return BV(t,a,r,h,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[e]:Object.assign(Object.assign(Object.assign({field:l+"_"+n.field,type:n.type},void 0!==d?{title:d}:{}),void 0!==s?{scale:s}:{}),void 0!==o?{axis:o}:{})},SR(c)?{[e+"2"]:{field:c+"_"+n.field}}:{}),i),f)})}}function BV(t,e,n,i,r){const{clip:s,color:o,opacity:a}=t,u=t.type;return t[e]||void 0===t[e]&&n[e]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[e]),s?{clip:s}:{}),o?{color:o}:{}),a?{opacity:a}:{}),YL(r.mark)?r.mark:{type:r.mark}),{style:`${u}-${e}`}),DR(t[e])?{}:t[e]),!1===i?{aria:i}:{})})]:[]}function jV(t,e,n){const{encoding:i}=t,r="vertical"===e?"y":"x",s=i[r],o=i[r+"2"],a=i[r+"Error"],u=i[r+"Error2"];return{continuousAxisChannelDef:IV(s,n),continuousAxisChannelDef2:IV(o,n),continuousAxisChannelDefError:IV(a,n),continuousAxisChannelDefError2:IV(u,n),continuousAxis:r}}function IV(t,e){if(t&&t.aggregate){const{aggregate:n}=t,i=MR(t,["aggregate"]);return n!==e&&Mq(function(t,e){return`Continuous axis should not have customized aggregation function ${t}; ${e} already agregates the axis.`}(n,e)),i}return t}function RV(t,e){const{mark:n,encoding:i}=t,{x:r,y:s}=i;if(TH(r)){if(TH(s)){const t=MH(r)&&r.aggregate,i=MH(s)&&s.aggregate;if(t||i!==e){if(i||t!==e){if(t===e&&i===e)throw new Error("Both x and y cannot have aggregate");return YL(n)&&n.orient?n.orient:"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(TH(s))return"vertical";throw new Error("Need a valid continuous axis for "+e+"s")}const LV="boxplot",PV=new tP(LV,qV);function UV(t){return FR(t)?"tukey":t}function qV(t,{config:e}){var n,i;const{mark:r,encoding:s,selection:o,projection:a}=t,u=MR(t,["mark","encoding","selection","projection"]),l=YL(r)?r:{type:r};o&&Mq(cq("boxplot"));const c=null!==(n=l.extent)&&void 0!==n?n:e.boxplot.extent,h=yV("size",l,e),f=UV(c),{transform:d,continuousAxisChannelDef:p,continuousAxis:g,groupby:m,aggregate:y,encodingWithoutContinuousAxis:v,ticksOrient:b,boxOrient:x,customTooltipWithoutAggregatedField:w}=function(t,e,n){const i=RV(t,LV),{continuousAxisChannelDef:r,continuousAxis:s}=jV(t,i,LV),o=r.field,a=UV(e),u=[...WV(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:("min-max"===a?"lower_whisker_":"min_")+o},{op:"max",field:o,as:("min-max"===a?"upper_whisker_":"max_")+o}],l="min-max"===a||"tukey"===a?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${e}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${e}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=t.encoding,h=s,f=(c[h],MR(c,["symbol"==typeof h?h:h+""])),{customTooltipWithoutAggregatedField:d,filteredEncoding:p}=function(t){const{tooltip:e}=t,n=MR(t,["tooltip"]);if(!e)return{filteredEncoding:t};let i,r;if(vR(e)){for(const t of e)t.aggregate?(i||(i=[]),i.push(t)):(r||(r=[]),r.push(t));i&&(n.tooltip=i)}else e.aggregate?n.tooltip=e:r=e;return vR(r)&&1===r.length&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}(f),{bins:g,timeUnits:m,aggregate:y,groupby:v,encoding:b}=DV(p,n),x="vertical"===i?"horizontal":"vertical",w=i;return{transform:[...g,...m,{aggregate:[...y,...u],groupby:v},...l],groupby:v,aggregate:y,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:w,customTooltipWithoutAggregatedField:d}}(t,c,e),{color:A,size:_}=v,k=MR(v,["color","size"]),C=t=>TV(l,g,p,t,e.boxplot),E=C(k),D=C(v),F=C(Object.assign(Object.assign({},k),_?{size:_}:{})),S=zV([{fieldPrefix:"min-max"===f?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===f?"lower_whisker_":"min_",titlePrefix:"Min"}],p,v),O={type:"tick",color:"black",opacity:1,orient:b,invalid:null},N="min-max"===f?S:zV([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,v),M=[...E({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:N}),...E({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:N}),...E({partName:"ticks",mark:O,positionPrefix:"lower_whisker",aria:!1,extraEncoding:N}),...E({partName:"ticks",mark:O,positionPrefix:"upper_whisker",aria:!1,extraEncoding:N})],z=[..."tukey"!==f?M:[],...D({partName:"box",mark:Object.assign(Object.assign({type:"bar"},h?{size:h}:{}),{orient:x,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:S}),...F({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},bR(e.boxplot.median)&&e.boxplot.median.color?{color:e.boxplot.median.color}:{}),h?{size:h}:{}),{orient:b,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:S})];let $;if("min-max"!==f){const t=`datum["lower_box_${p.field}"]`,n=`datum["upper_box_${p.field}"]`,i=`(${n} - ${t})`,r=`${t} - ${c} * ${i}`,s=`${n} + ${c} * ${i}`,o=`datum["${p.field}"]`,a={joinaggregate:WV(p.field),groupby:m};let u;"tukey"===f&&(u={transform:[{filter:`(${r} <= ${o}) && (${o} <= ${s})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...y],groupby:m}],layer:M});const{tooltip:h}=k,d=MR(k,["tooltip"]),{scale:v,axis:b}=p,x=$V(p),A=BV(l,"outliers",e.boxplot,!0,{transform:[{filter:`(${o} < ${r}) || (${o} > ${s})`}],mark:"point",encoding:Object.assign(Object.assign({[g]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},void 0!==x?{title:x}:{}),void 0!==v?{scale:v}:{}),void 0!==b?{axis:b}:{})},d),w?{tooltip:w}:{})})[0];A&&u?$={transform:[a],layer:[A,u]}:A?($=A,$.transform.unshift(a)):u&&($=u,$.transform.unshift(a))}return $?Object.assign(Object.assign({},u),{layer:[$,{transform:d,layer:z}]}):Object.assign(Object.assign({},u),{transform:(null!==(i=u.transform)&&void 0!==i?i:[]).concat(d),layer:z})}function WV(t){return[{op:"q1",field:t,as:"lower_box_"+t},{op:"q3",field:t,as:"upper_box_"+t}]}const HV="errorbar",VV=new tP(HV,GV);function GV(t,{config:e}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:u,tooltipEncoding:l}=XV(t,HV,e),c=TV(a,r,i,s,e.errorbar),h={type:"tick",orient:o},f=[...c({partName:"ticks",mark:h,positionPrefix:"lower",aria:!1,extraEncoding:l}),...c({partName:"ticks",mark:h,positionPrefix:"upper",aria:!1,extraEncoding:l}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),f.length>1?{layer:f}:Object.assign({},f[0]))}function XV(t,e,n){var i;const{mark:r,encoding:s,selection:o,projection:a}=t,u=MR(t,["mark","encoding","selection","projection"]),l=YL(r)?r:{type:r};o&&Mq(cq(e));const{orient:c,inputType:h}=function(t,e){const{encoding:n}=t;if(function(t){return(jH(t.x)||jH(t.y))&&!jH(t.x2)&&!jH(t.y2)&&!jH(t.xError)&&!jH(t.xError2)&&!jH(t.yError)&&!jH(t.yError2)}(n))return{orient:RV(t,e),inputType:"raw"};const i=function(t){return jH(t.x2)||jH(t.y2)}(n),r=function(t){return jH(t.xError)||jH(t.xError2)||jH(t.yError)||jH(t.yError2)}(n),s=n.x,o=n.y;if(i){if(r)throw new Error(`${e} cannot be both type aggregated-upper-lower and aggregated-error`);const t=n.x2,i=n.y2;if(jH(t)&&jH(i))throw new Error(`${e} cannot have both x2 and y2`);if(jH(t)){if(TH(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${e}`)}if(jH(i)){if(TH(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${e}`)}throw new Error("No ranged axis")}{const t=n.xError,i=n.xError2,r=n.yError,a=n.yError2;if(jH(i)&&!jH(t))throw new Error(`${e} cannot have xError2 without xError`);if(jH(a)&&!jH(r))throw new Error(`${e} cannot have yError2 without yError`);if(jH(t)&&jH(r))throw new Error(`${e} cannot have both xError and yError with both are quantiative`);if(jH(t)){if(TH(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(jH(r)){if(TH(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}(t,e),{continuousAxisChannelDef:f,continuousAxisChannelDef2:d,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:g,continuousAxis:m}=jV(t,c,e),{errorBarSpecificAggregate:y,postAggregateCalculates:v,tooltipSummary:b,tooltipTitleWithFieldName:x}=function(t,e,n,i,r,s,o,a){let u=[],l=[];const c=e.field;let h,f=!1;if("raw"===s){const e=t.center?t.center:t.extent?"iqr"===t.extent?"median":"mean":a.errorbar.center,n=t.extent?t.extent:"mean"===e?"stderr":"iqr";if("median"===e!=("iqr"===n)&&Mq(function(t,e,n){return`${t} is not usually used with ${e} for ${n}.`}(e,n,o)),"stderr"===n||"stdev"===n)u=[{op:n,field:c,as:"extent_"+c},{op:e,field:c,as:"center_"+c}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],h=[{fieldPrefix:"center_",titlePrefix:dL(e)},{fieldPrefix:"upper_",titlePrefix:YV(e,n,"+")},{fieldPrefix:"lower_",titlePrefix:YV(e,n,"-")}],f=!0;else{let e,i,r;t.center&&t.extent&&Mq(function(t,e){return`Center is not needed to be specified in ${e} when extent is ${t}.`}(t.extent,o)),"ci"===n?(e="mean",i="ci0",r="ci1"):(e="median",i="q1",r="q3"),u=[{op:i,field:c,as:"lower_"+c},{op:r,field:c,as:"upper_"+c},{op:e,field:c,as:"center_"+c}],h=[{fieldPrefix:"upper_",titlePrefix:JH({field:c,aggregate:r,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:JH({field:c,aggregate:i,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:JH({field:c,aggregate:e,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(t.center||t.extent)&&Mq(function(t,e){return`${e?"extent ":""}${e&&t?"and ":""}${t?"center ":""}${e&&t?"are ":"is "}not needed when data are aggregated.`}(t.center,t.extent)),"aggregated-upper-lower"===s?(h=[],l=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===s&&(h=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:"upper_"+c}],r?l.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:"lower_"+c}):l.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:"lower_"+c}));for(const t of l)h.push({fieldPrefix:t.as.substring(0,6),titlePrefix:yL(yL(t.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:h,tooltipTitleWithFieldName:f}}(l,f,d,p,g,h,e,n),w=s,A=m,_=(w[A],"x"===m?"x2":"y2"),k=(w[_],"x"===m?"xError":"yError"),C=(w[k],"x"===m?"xError2":"yError2"),E=(w[C],MR(w,["symbol"==typeof A?A:A+"","symbol"==typeof _?_:_+"","symbol"==typeof k?k:k+"","symbol"==typeof C?C:C+""])),{bins:D,timeUnits:F,aggregate:S,groupby:O,encoding:N}=DV(E,n),M=[...S,...y],z="raw"!==h?[]:O,$=zV(b,f,N,x);return{transform:[...null!==(i=u.transform)&&void 0!==i?i:[],...D,...F,...0===M.length?[]:[{aggregate:M,groupby:z}],...v],groupby:z,continuousAxisChannelDef:f,continuousAxis:m,encodingWithoutContinuousAxis:N,ticksOrient:"vertical"===c?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:$}}function YV(t,e,n){return dL(t)+" "+n+" "+e}const JV="errorband",ZV=new tP(JV,KV);function KV(t,{config:e}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:u}=XV(t,JV,e),l=o,c=TV(l,r,i,s,e.errorband),h=void 0!==t.encoding.x&&void 0!==t.encoding.y;let f={type:h?"area":"rect"},d={type:h?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return h?(f=Object.assign(Object.assign(Object.assign({},f),p),{ariaRoleDescription:"errorband"}),d=Object.assign(Object.assign({},d),p)):l.interpolate?Mq(Dq("interpolate")):l.tension&&Mq(Dq("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...c({partName:"band",mark:f,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"lower",aria:!1,extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"upper",aria:!1,extraEncoding:u})]})}const QV={};function tG(t,e,n){const i=new tP(t,e);QV[t]={normalizer:i,parts:n}}tG(LV,qV,["box","median","outliers","rule","ticks"]),tG(HV,GV,["ticks","rule"]),tG(JV,KV,["band","borders"]);const eG=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],nG=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],iG={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},rG={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},sG=(oL(rG),"_vgsid_"),oG={single:{on:"click",fields:[sG],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[sG],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function aG(t){return!(!t||"legend"!==t&&!t.legend)}function uG(t){return aG(t)&&bR(t)}function lG(t){return"concat"in t}function cG(t){return"vconcat"in t}function hG(t){return"hconcat"in t}function fG(t){return bR(t)&&void 0!==t.step}function dG(t){return t.view||t.width||t.height}const pG=oL({align:1,bounds:1,center:1,columns:1,spacing:1});function gG(t,e){var n;return null!==(n=t[e])&&void 0!==n?n:t["width"===e?"continuousWidth":"continuousHeight"]}function mG(t,e){const n=yG(t,e);return fG(n)?n.step:vG}function yG(t,e){var n;return xL(null!==(n=t[e])&&void 0!==n?n:t["width"===e?"discreteWidth":"discreteHeight"],{step:t.step})}const vG=20,bG={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:vG},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:{binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},circle:{},geoshape:{},image:{},line:{},point:{},rect:{binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5},rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:oG,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},xG=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],wG={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},AG={blue:xG[0],orange:xG[1],red:xG[2],teal:xG[3],green:xG[4],yellow:xG[5],purple:xG[6],pink:xG[7],brown:xG[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function _G(t={}){const{color:e,font:n,fontSize:i}=t,r=MR(t,["color","font","fontSize"]);return wR({},bG,n?function(t){return{text:{font:t},style:{"guide-label":{font:t},"guide-title":{font:t},"group-title":{font:t},"group-subtitle":{font:t}}}}(n):{},e?function(t={}){return{signals:[{name:"color",value:bR(t)?Object.assign(Object.assign({},AG),t):AG}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(e):{},i?function(t){return{signals:[{name:"fontSize",value:bR(t)?Object.assign(Object.assign({},wG),t):wG}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(i):{},r||{})}const kG=["view",...XL],CG=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],EG=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function DG(t,e,n,i){const r=i?t[e][i]:t[e];"view"===e&&(n="cell");const s=Object.assign(Object.assign({},r),t.style[null!=n?n:e]);sL(s)||(t.style[null!=n?n:e]=s),i||delete t[e]}function FG(t){return"layer"in t}class SG{map(t,e){return kH(t)?this.mapFacet(t,e):function(t){return"repeat"in t}(t)?this.mapRepeat(t,e):hG(t)?this.mapHConcat(t,e):cG(t)?this.mapVConcat(t,e):lG(t)?this.mapConcat(t,e):this.mapLayerOrUnit(t,e)}mapLayerOrUnit(t,e){if(FG(t))return this.mapLayer(t,e);if(QL(t))return this.mapUnit(t,e);throw new Error(rq(t))}mapLayer(t,e){return Object.assign(Object.assign({},t),{layer:t.layer.map((t=>this.mapLayerOrUnit(t,e)))})}mapHConcat(t,e){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map((t=>this.map(t,e)))})}mapVConcat(t,e){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map((t=>this.map(t,e)))})}mapConcat(t,e){const{concat:n}=t,i=MR(t,["concat"]);return Object.assign(Object.assign({},i),{concat:n.map((t=>this.map(t,e)))})}mapFacet(t,e){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,e)})}mapRepeat(t,e){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,e)})}}const OG={zero:1,center:1,normalize:1},NG=new Set([ML,$L,zL,RL,jL,qL,WL,BL,LL,PL]),MG=new Set([$L,zL,ML]);function zG(t,e){var n,i;const r="x"===e?"y":"radius",s=t[e],o=t[r];if(MH(s)&&MH(o))if("quantitative"===zH(s)&&"quantitative"===zH(o)){if(s.stack)return e;if(o.stack)return r;const t=MH(s)&&!!s.aggregate;if(t!==(MH(o)&&!!o.aggregate))return t?e:r;{const t=null===(n=s.scale)||void 0===n?void 0:n.type,a=null===(i=o.scale)||void 0===i?void 0:i.type;if(t&&"linear"!==t)return r;if(a&&"linear"!==a)return e}}else{if("quantitative"===zH(s))return e;if("quantitative"===zH(o))return r}else{if("quantitative"===zH(s))return e;if("quantitative"===zH(o))return r}}function $G(t,e,n={}){const i=YL(t)?t.type:t;if(!NG.has(i))return null;const r=zG(e,"x")||zG(e,"theta");if(!r)return null;const s=e[r],o=MH(s)?WH(s,{}):void 0;let a=function(t){switch(t){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(r),u=e[a],l=MH(u)?WH(u,{}):void 0;l===o&&(l=void 0,u=void 0,a=void 0);const c=FU.reduce(((t,n)=>{if("tooltip"!==n&&CV(e,n)){const i=e[n];for(const e of kR(i)){const i=tV(e);if(i.aggregate)continue;const r=WH(i,{});r&&r===l||t.push({channel:n,fieldDef:i})}}return t}),[]);let h;if(void 0!==s.stack?h=DR(s.stack)?s.stack?"zero":null:s.stack:c.length>0&&MG.has(i)&&(h="zero"),!h||!(h in OG))return null;var f;if(EV(e)&&0===c.length)return null;if(s.scale&&s.scale.type&&s.scale.type!==bW){if(n.disallowNonLinearStack)return null;Mq(function(t){return`Cannot stack non-linear scale (${t}).`}(s.scale.type))}return jH(e[dU(r)])?(void 0!==s.stack&&Mq(`Cannot stack "${f=r}" if there is already "${f}2".`),null):(MH(s)&&s.aggregate&&!ZR(uP,s.aggregate)&&Mq(`Stacking is applied even though the aggregate function is non-summative ("${s.aggregate}").`),{groupbyChannel:u?a:void 0,groupbyField:l,fieldChannel:r,impute:null!==s.impute&&VL(i),stackBy:c,offset:h})}function TG(t){const{point:e,line:n}=t,i=MR(t,["point","line"]);return oL(i).length>1?i:i.type}function BG(t){for(const e of["line","area","rule","trail"])t[e]&&(t=Object.assign(Object.assign({},t),{[e]:GR(t[e],["point","line"])}));return t}function jG(t,e={},n){return"transparent"===t.point?{opacity:0}:t.point?bR(t.point)?t.point:{}:void 0!==t.point?null:e.point||n.shape?bR(e.point)?e.point:{}:void 0}function IG(t,e={}){return t.line?!0===t.line?{}:t.line:void 0!==t.line?null:e.line?!0===e.line?{}:e.line:void 0}class RG{constructor(){this.name="path-overlay"}hasMatchingType(t,e){if(QL(t)){const{mark:n,encoding:i}=t,r=YL(n)?n:{type:n};switch(r.type){case"line":case"rule":case"trail":return!!jG(r,e[r.type],i);case"area":return!!jG(r,e[r.type],i)||!!IG(r,e[r.type])}}return!1}run(t,e,n){const{config:i}=e,{selection:r,projection:s,encoding:o,mark:a}=t,u=MR(t,["selection","projection","encoding","mark"]),l=YL(a)?a:{type:a},c=jG(l,i[l.type],o),h="area"===l.type&&IG(l,i[l.type]),f=[Object.assign(Object.assign({},r?{selection:r}:{}),{mark:TG(Object.assign(Object.assign({},"area"===l.type&&void 0===l.opacity&&void 0===l.fillOpacity?{opacity:.7}:{}),l)),encoding:GR(o,["shape"])})],d=$G(l,o);let p=o;if(d){const{fieldChannel:t,offset:e}=d;p=Object.assign(Object.assign({},o),{[t]:Object.assign(Object.assign({},o[t]),e?{stack:e}:{})})}return h&&f.push(Object.assign(Object.assign({},s?{projection:s}:{}),{mark:Object.assign(Object.assign({type:"line"},VR(l,["clip","interpolate","tension","tooltip"])),h),encoding:p})),c&&f.push(Object.assign(Object.assign({},s?{projection:s}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},VR(l,["clip","tooltip"])),c),encoding:p})),n(Object.assign(Object.assign({},u),{layer:f}),Object.assign(Object.assign({},e),{config:BG(i)}))}}class LG{constructor(){this.name="RangeStep"}hasMatchingType(t){var e;if(QL(t)&&t.encoding)for(const n of OU){const i=t.encoding[n];if(i&&jH(i)&&(null===(e=null==i?void 0:i.scale)||void 0===e?void 0:e.rangeStep))return!0}return!1}run(t){var e;const n={};let i=Object.assign({},t.encoding);for(const t of OU){const r=pU(t),s=i[t];if(s&&jH(s)&&(null===(e=null==s?void 0:s.scale)||void 0===e?void 0:e.rangeStep)){const{scale:e}=s,o=MR(s,["scale"]),a=e,{rangeStep:u}=a,l=MR(a,["rangeStep"]);n[r]={step:e.rangeStep},Mq('Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.'),i=Object.assign(Object.assign({},i),{[t]:Object.assign(Object.assign({},o),sL(l)?{}:{scale:l})})}}return Object.assign(Object.assign(Object.assign({},n),t),{encoding:i})}}function PG(t,e){return e?AH(t)?GG(t,e):WG(t,e):t}function UG(t,e){return e?GG(t,e):t}function qG(t,e,n){const i=e[t];return(r=i)&&!SR(r)&&"repeat"in r?i.repeat in n?Object.assign(Object.assign({},e),{[t]:n[i.repeat]}):void Mq(function(t){return`Unknown repeated value "${t}".`}(i.repeat)):e;var r}function WG(t,e){if(void 0!==(t=qG("field",t,e))){if(null===t)return null;if(EH(t)&&xH(t.sort)){const n=qG("field",t.sort,e);t=Object.assign(Object.assign({},t),n?{sort:n}:{})}return t}}function HG(t,e){if(MH(t))return WG(t,e);{const n=qG("datum",t,e);return n===t||n.type||(n.type="nominal"),n}}function VG(t,e){if(!jH(t)){if(NH(t)){const n=HG(t.condition,e);if(n)return Object.assign(Object.assign({},t),{condition:n});{const{condition:e}=t;return MR(t,["condition"])}}return t}{const n=HG(t,e);if(n)return n;if(SH(t))return{condition:t.condition}}}function GG(t,e){const n={};for(const i in t)if(ER(t,i)){const r=t[i];if(vR(r))n[i]=r.map((t=>VG(t,e))).filter((t=>t));else{const t=VG(r,e);void 0!==t&&(n[i]=t)}}return n}class XG{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(QL(t)){const{encoding:e,mark:n}=t;if("line"===n)for(const t of lU){const n=e[hU(t)];if(e[t]&&(MH(n)&&!tq(n.bin)||$H(n)))return!0}}return!1}run(t,e,n){const{encoding:i}=t;var r,s;return Mq((r=!!i.x2,s=!!i.y2,`Line mark is for continuous lines and thus cannot be used with ${r&&s?"x2 and y2":r?"x2":"y2"}. We will use the rule mark (line segments) instead.`)),n(Object.assign(Object.assign({},t),{mark:"rule"}),e)}}function YG(t){const{parentEncoding:e,encoding:n}=t;if(e&&n){const t=oL(e).reduce(((t,e)=>(n[e]&&t.push(e),t)),[]);t.length>0&&Mq(`Layer's shared ${(i=t).join(",")} channel ${1===i.length?"is":"are"} overriden.`)}var i;const r=Object.assign(Object.assign({},null!=e?e:{}),null!=n?n:{});return sL(r)?void 0:r}function JG(t){const{parentProjection:e,projection:n}=t;return e&&n&&Mq(function(t){const{parentProjection:e,projection:n}=t;return`Layer's shared projection ${XR(e)} is overridden by a child projection ${XR(n)}.`}({parentProjection:e,projection:n})),null!=n?n:e}function ZG(t,e){void 0===e&&(e=_G(t.config));const n=function(t,e={}){return KG.map(t,{config:e})}(t,e),{width:i,height:r}=t,s=function(t,e,n){let{width:i,height:r}=e;const s=QL(t)||FG(t),o={};s?"container"==i&&"container"==r?(o.type="fit",o.contains="padding"):"container"==i?(o.type="fit-x",o.contains="padding"):"container"==r&&(o.type="fit-y",o.contains="padding"):("container"==i&&(Mq(sq("width")),i=void 0),"container"==r&&(Mq(sq("height")),r=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?QG(n.autosize):{}),QG(t.autosize));if("fit"!==a.type||s||(Mq('Autosize "fit" only works for single views and layered views.'),a.type="pad"),"container"==i&&"fit"!=a.type&&"fit-x"!=a.type&&Mq(oq("width")),"container"==r&&"fit"!=a.type&&"fit-y"!=a.type&&Mq(oq("height")),!WR(a,{type:"pad"}))return a}(n,{width:i,height:r,autosize:t.autosize},e);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const KG=new class extends SG{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[PV,VV,ZV,new RG,new XG,new LG]}map(t,e){if(QL(t)){const n=CV(t.encoding,cP),i=CV(t.encoding,hP),r=CV(t.encoding,fP);if(n||i||r)return this.mapFacetedUnit(t,e)}return super.map(t,e)}mapUnit(t,e){const{parentEncoding:n,parentProjection:i}=e,r=Object.assign(Object.assign({},t),{encoding:UG(t.encoding,e.repeater)});if(n||i)return this.mapUnitWithParentEncodingOrProjection(r,e);const s=this.mapLayerOrUnit.bind(this);for(const t of this.nonFacetUnitNormalizers)if(t.hasMatchingType(r,e.config))return t.run(r,e,s);return r}mapRepeat(t,e){return function(t){return!vR(t.repeat)&&t.repeat.layer}(t)?this.mapLayerRepeat(t,e):this.mapNonLayerRepeat(t,e)}mapLayerRepeat(t,e){const{repeat:n,spec:i}=t,r=MR(t,["repeat","spec"]),{row:s,column:o,layer:a}=n,{repeater:u={},repeaterPrefix:l=""}=e;return s||o?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},s?{row:s}:{}),o?{column:o}:{}),spec:{repeat:{layer:a},spec:i}}),e):Object.assign(Object.assign({},r),{layer:a.map((t=>{const n=Object.assign(Object.assign({},u),{layer:t}),r=(i.name||"")+l+`child__layer_${cL(t)}`,s=this.mapLayerOrUnit(i,Object.assign(Object.assign({},e),{repeater:n,repeaterPrefix:r}));return s.name=r,s}))})}mapNonLayerRepeat(t,e){var n;const{repeat:i,spec:r,data:s}=t,o=MR(t,["repeat","spec","data"]);!vR(i)&&t.columns&&(t=GR(t,["columns"]),Mq(hq("repeat")));const a=[],{repeater:u={},repeaterPrefix:l=""}=e,c=!vR(i)&&i.row||[u?u.row:null],h=!vR(i)&&i.column||[u?u.column:null],f=vR(i)&&i||[u?u.repeat:null];for(const t of f)for(const n of c)for(const s of h){const o={repeat:t,row:n,column:s,layer:u.layer},c=(r.name||"")+l+"child__"+(vR(i)?`${cL(t)}`:(i.row?`row_${cL(n)}`:"")+(i.column?`column_${cL(s)}`:"")),h=this.map(r,Object.assign(Object.assign({},e),{repeater:o,repeaterPrefix:c}));h.name=c,a.push(GR(h,["data"]))}const d=vR(i)?t.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:null!==(n=r.data)&&void 0!==n?n:s,align:"all"},o),{columns:d,concat:a})}mapFacet(t,e){const{facet:n}=t;return AH(n)&&t.columns&&(t=GR(t,["columns"]),Mq(hq("facet"))),super.mapFacet(t,e)}mapUnitWithParentEncodingOrProjection(t,e){const{encoding:n,projection:i}=t,{parentEncoding:r,parentProjection:s,config:o}=e,a=JG({parentProjection:s,projection:i}),u=YG({parentEncoding:r,encoding:UG(n,e.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),a?{projection:a}:{}),u?{encoding:u}:{}),{config:o})}mapFacetedUnit(t,e){const n=t.encoding,{row:i,column:r,facet:s}=n,o=MR(n,["row","column","facet"]),{mark:a,width:u,projection:l,height:c,view:h,selection:f,encoding:d}=t,p=MR(t,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:g,layout:m}=this.getFacetMappingAndLayout({row:i,column:r,facet:s},e),y=UG(o,e.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),m),{facet:g,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},u?{width:u}:{}),c?{height:c}:{}),h?{view:h}:{}),l?{projection:l}:{}),{mark:a,encoding:y}),f?{selection:f}:{})}),e)}getFacetMappingAndLayout(t,e){var n;const{row:i,column:r,facet:s}=t;if(i||r){s&&Mq(`Facet encoding dropped as ${(o=[...i?[cP]:[],...r?[hP]:[]]).join(" and ")} ${o.length>1?"are":"is"} also specified.`);const e={},a={};for(const i of[cP,hP]){const r=t[i];if(r){const{align:t,center:s,spacing:o,columns:u}=r,l=MR(r,["align","center","spacing","columns"]);e[i]=l;for(const t of["align","center","spacing"])void 0!==r[t]&&(a[t]=null!==(n=a[t])&&void 0!==n?n:{},a[t][i]=r[t])}}return{facetMapping:e,layout:a}}{const{align:t,center:n,spacing:i,columns:r}=s;return{facetMapping:PG(MR(s,["align","center","spacing","columns"]),e.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},t?{align:t}:{}),n?{center:n}:{}),i?{spacing:i}:{}),r?{columns:r}:{})}}var o}mapLayer(t,e){var{parentEncoding:n,parentProjection:i}=e,r=MR(e,["parentEncoding","parentProjection"]);const{encoding:s,projection:o}=t,a=MR(t,["encoding","projection"]),u=Object.assign(Object.assign({},r),{parentEncoding:YG({parentEncoding:n,encoding:s}),parentProjection:JG({parentProjection:i,projection:o})});return super.mapLayer(a,u)}};function QG(t){return SR(t)?{type:t}:null!=t?t:{}}const tX=["background","padding"];function eX(t){return tX.reduce(((e,n)=>(t&&void 0!==t[n]&&(e[n]=t[n]),e)),{})}class nX{constructor(t={},e={}){this.explicit=t,this.implicit=e}clone(){return new nX(HR(this.explicit),HR(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return xL(this.explicit[t],this.implicit[t])}getWithExplicit(t){return void 0!==this.explicit[t]?{explicit:!0,value:this.explicit[t]}:void 0!==this.implicit[t]?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,e){void 0!==e.value&&this.set(t,e.value,e.explicit)}set(t,e,n){return delete this[n?"implicit":"explicit"][t],this[n?"explicit":"implicit"][t]=e,this}copyKeyFromSplit(t,e){void 0!==e.explicit[t]?this.set(t,e.explicit[t],!0):void 0!==e.implicit[t]&&this.set(t,e.implicit[t],!1)}copyKeyFromObject(t,e){void 0!==e[t]&&this.set(t,e[t],!0)}copyAll(t){for(const e of oL(t.combine())){const n=t.getWithExplicit(e);this.setWithExplicit(e,n)}}}function iX(t){return{explicit:!0,value:t}}function rX(t){return{explicit:!1,value:t}}function sX(t){return(e,n,i,r)=>{const s=t(e.value,n.value);return s>0?e:s<0?n:oX(e,n,i,r)}}function oX(t,e,n,i){return t.explicit&&e.explicit&&Mq(function(t,e,n,i){return`Conflicting ${e.toString()} property "${t.toString()}" (${XR(n)} and ${XR(i)}). Using ${XR(n)}.`}(n,i,t.value,e.value)),t}function aX(t,e,n,i,r=oX){return void 0===t||void 0===t.value?e:t.explicit&&!e.explicit?t:e.explicit&&!t.explicit?e:WR(t.value,e.value)?t:r(t,e,n,i)}class uX extends nX{constructor(t={},e={},n=!1){super(t,e),this.explicit=t,this.implicit=e,this.parseNothing=n}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function lX(t){return"url"in t}function cX(t){return"values"in t}function hX(t){return"name"in t&&!lX(t)&&!cX(t)&&!fX(t)}function fX(t){return t&&(dX(t)||pX(t)||gX(t))}function dX(t){return"sequence"in t}function pX(t){return"sphere"in t}function gX(t){return"graticule"in t}const mX="main",yX="raw";function vX(t){return"filter"in t}function bX(t){return"lookup"in t}function xX(t){return"pivot"in t}function wX(t){return"density"in t}function AX(t){return"quantile"in t}function _X(t){return"regression"in t}function kX(t){return"loess"in t}function CX(t){return"sample"in t}function EX(t){return"window"in t}function DX(t){return"joinaggregate"in t}function FX(t){return"flatten"in t}function SX(t){return"calculate"in t}function OX(t){return"bin"in t}function NX(t){return"impute"in t}function MX(t){return"timeUnit"in t}function zX(t){return"aggregate"in t}function $X(t){return"stack"in t}function TX(t){return"fold"in t}function BX(t,e,n,i){const r=SH(e)&&e.condition,s=i(e);return r?{[n]:[...kR(r).map((e=>{const n=i(e),r=function(t){return t.selection}(e)?rZ(t,e.selection):oZ(t,e.test);return Object.assign({test:r},n)})),...void 0!==s?[s]:[]]}:void 0!==s?{[n]:s}:{}}function jX(t,e="text"){const n=t.encoding[e];return BX(t,n,e,(e=>IX(e,t.config)))}function IX(t,e,n="datum"){if(t){if(RH(t))return dV(t.value);if(jH(t)){const{format:i,formatType:r}=QH(t);return aH({fieldOrDatumDef:t,format:i,formatType:r,expr:n,config:e})}}}function RX(t,e={}){const{encoding:n,markDef:i,config:r,stack:s}=t,o=n.tooltip;if(vR(o))return{tooltip:PX({tooltip:o},s,r,e)};{const a=e.reactiveGeom?"datum.datum":"datum";return BX(t,o,"tooltip",(t=>{const o=IX(t,r,a);if(o)return o;if(null===t)return;let u=yV("tooltip",i,r);return!0===u&&(u={content:"encoding"}),SR(u)?{value:u}:bR(u)?"encoding"===u.content?PX(n,s,r,e):{signal:a}:void 0}))}}function LX(t,e,n,{reactiveGeom:i}={}){const r={},s=i?"datum.datum":"datum",o=[];function a(i,a){const u=hU(a),l=IH(i)?i:Object.assign(Object.assign({},i),{type:t[u].type}),c=kR(JH(l,n,{allowDisabling:!1})).join(", ");let h;if(NU(a)){const i="x"===a?"x2":"y2",o=tV(t[i]);if(tq(l.bin)&&o){const t=WH(l,{expr:s}),e=WH(o,{expr:s}),{format:a,formatType:u}=QH(l);h=gH(t,e,a,u,n),r[i]=!0}else if(e&&e.fieldChannel===a&&"normalize"===e.offset){const{format:t,formatType:e}=QH(l);h=aH({fieldOrDatumDef:l,format:t,formatType:e,expr:s,config:n,normalizeStack:!0}).signal}}h=null!=h?h:IX(l,n,s).signal,o.push({channel:a,key:c,value:h})}OV(t,((t,e)=>{MH(t)?a(t,e):OH(t)&&a(t.condition,e)}));const u={};for(const{channel:t,key:e,value:n}of o)r[t]||u[e]||(u[OR(e)]=n);return u}function PX(t,e,n,{reactiveGeom:i}={}){const r=uL(LX(t,e,n,{reactiveGeom:i})).map((({key:t,value:e})=>`${t}: ${e}`));return r.length>0?{signal:`{${r.join(", ")}}`}:void 0}function UX(t,e,n={}){const{markDef:i,encoding:r,config:s}=e,{vgChannel:o}=n;let{defaultRef:a,defaultValue:u}=n;void 0===a&&(u=null!=u?u:yV(t,i,s,{vgChannel:o,ignoreVgConfig:!0}),void 0!==u&&(a=dV(u)));const l=r[t];return BX(e,l,null!=o?o:t,(n=>iH({channel:t,channelDef:n,markDef:i,config:s,scaleName:e.scaleName(t),scale:e.getScaleComponent(t),stack:null,defaultRef:a})))}function qX(t,e={filled:void 0}){var n,i,r,s;const{markDef:o,encoding:a,config:u}=t,{type:l}=o,c=null!==(n=e.filled)&&void 0!==n?n:yV("filled",o,u),h=ZR(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,f=null!==(r=null!==(i=yV(!0===c?"color":void 0,o,u,{vgChannel:"fill"}))&&void 0!==i?i:u.mark[!0===c&&"color"])&&void 0!==r?r:h,d=null!==(s=yV(!1===c?"color":void 0,o,u,{vgChannel:"stroke"}))&&void 0!==s?s:u.mark[!1===c&&"color"],p=c?"fill":"stroke",g=Object.assign(Object.assign({},f?{fill:dV(f)}:{}),d?{stroke:dV(d)}:{});return o.color&&(c?o.fill:o.stroke)&&Mq(gq("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},g),UX("color",t,{vgChannel:p,defaultValue:c?f:d})),UX("fill",t,{defaultValue:a.fill?f:void 0})),UX("stroke",t,{defaultValue:a.stroke?d:void 0}))}function WX(t,e){const n=e[function(t){switch(t){case dP:return"xOffset";case pP:return"yOffset";case gP:return"x2Offset";case mP:return"y2Offset";case bP:return"thetaOffset";case yP:return"radiusOffset";case xP:return"theta2Offset";case vP:return"radius2Offset"}}(t)];if(n)return n}function HX(t,e,{defaultPos:n,vgChannel:i,isMidPoint:r}){const{encoding:s,markDef:o,config:a,stack:u}=e,l=s[t],c=s[dU(t)],h=e.scaleName(t),f=e.getScaleComponent(t),d=WX(t,o),p=VX({model:e,defaultPos:n,channel:t,scaleName:h,scale:f}),g=!l&&NU(t)&&(s.latitude||s.longitude)?{field:e.getName(t)}:function(t){const{channel:e,channelDef:n,isMidPoint:i,scaleName:r,stack:s,offset:o,markDef:a,config:u}=t;if(jH(n)&&s&&e===s.fieldChannel){if(MH(n)){const t=DH({channel:e,fieldDef:n,isMidPoint:i,markDef:a,stack:s,config:u});if(void 0!==t)return nH({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",band:t,offset:o})}return eH(n,r,{suffix:"end"},{offset:o})}return ZW(t)}({channel:t,channelDef:l,channel2Def:c,markDef:o,config:a,isMidPoint:r,scaleName:h,scale:f,stack:u,offset:d,defaultRef:p});return g?{[i||t]:g}:void 0}function VX({model:t,defaultPos:e,channel:n,scaleName:i,scale:r}){const{markDef:s,config:o}=t;return()=>{const a=hU(n),u=fU(n),l=yV(n,s,o,{vgChannel:u});if(void 0!==l)return rH(n,l);switch(e){case"zeroOrMin":case"zeroOrMax":if(i){const t=r.get("type");if(ZR(["log",xW,wW],t));else if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}if("zeroOrMin"===e)return"y"===a?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${t.width.signal},${t.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const e=t[pU(n)];return Object.assign(Object.assign({},e),{mult:.5})}}}}const GX={left:"x",center:"xc",right:"x2"},XX={top:"y",middle:"yc",bottom:"y2"};function YX(t,e,n,i="middle"){if("radius"===t||"theta"===t)return fU(t);const r=yV("x"===t?"align":"baseline",e,n);return"x"===t?GX[r||("top"===i?"left":"center")]:XX[r||i]}function JX(t,e,{defaultPos:n,defaultPos2:i,range:r}){return r?ZX(t,e,{defaultPos:n,defaultPos2:i}):HX(t,e,{defaultPos:n})}function ZX(t,e,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=e,o=dU(t),a=pU(t),u=function(t,e,n){const{encoding:i,mark:r,markDef:s,stack:o,config:a}=t,u=hU(n),l=pU(n),c=fU(n),h=i[u],f=t.scaleName(u),d=t.getScaleComponent(u),p=WX(n in i||n in s?n:u,t.markDef);if(!h&&("x2"===n||"y2"===n)&&(i.latitude||i.longitude))return{[c]:{field:t.getName(n)}};const g=function({channel:t,channelDef:e,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:u,defaultRef:l}){return jH(e)&&a&&t.charAt(0)===a.fieldChannel.charAt(0)?eH(e,s,{suffix:"start"},{offset:u}):ZW({channel:t,channelDef:n,scaleName:s,scale:o,stack:a,markDef:i,config:r,offset:u,defaultRef:l})}({channel:n,channelDef:h,channel2Def:i[n],markDef:s,config:a,scaleName:f,scale:d,stack:o,offset:p,defaultRef:void 0});return void 0!==g?{[c]:g}:KX(n,s)||KX(n,{[n]:bV(n,s,a.style),[l]:bV(l,s,a.style)})||KX(n,a[r])||KX(n,a.mark)||{[c]:VX({model:t,defaultPos:e,channel:n,scaleName:f,scale:d})()}}(e,i,o),l=u[a]?YX(t,r,s):fU(t);return Object.assign(Object.assign({},HX(t,e,{defaultPos:n,vgChannel:l})),u)}function KX(t,e){const n=pU(t),i=fU(t);return void 0!==e[i]?{[i]:rH(t,e[i])}:void 0!==e[t]?{[i]:rH(t,e[t])}:e[n]?{[n]:rH(t,e[n])}:void 0}function QX(t,e,n){var i,r,s,o;const{config:a,encoding:u,markDef:l,stack:c}=t,h=dU(e),f=pU(e),d=u[e],p=u[h],g=t.getScaleComponent(e),m=g?g.get("type"):void 0,y=t.scaleName(e),v=l.orient,b=null!==(r=null!==(i=u[f])&&void 0!==i?i:u.size)&&void 0!==r?r:yV("size",l,a,{vgChannel:f}),x="bar"===n&&("x"===e?"vertical"===v:"horizontal"===v);if(MH(d)&&(QU(d.bin)||tq(d.bin)||d.timeUnit&&!p)&&!b&&!$W(m)){const n=DH({channel:e,fieldDef:d,stack:c,markDef:l,config:a}),i=null===(s=t.component.axes[e])||void 0===s?void 0:s[0];return function({fieldDef:t,fieldDef2:e,channel:n,band:i,scaleName:r,markDef:s,spacing:o=0,axisTranslate:a,reverse:u,config:l}){const c=dU(n),h=fU(n),f=fU(c),d=WX(n,s);if(QU(t.bin)||t.timeUnit)return{[f]:nY({channel:n,fieldDef:t,scaleName:r,markDef:s,band:(1-i)/2,offset:eY(c,o,u,a,d),config:l}),[h]:nY({channel:n,fieldDef:t,scaleName:r,markDef:s,band:1-(1-i)/2,offset:eY(n,o,u,a,d),config:l})};if(tq(t.bin)){const i=eH(t,r,{},{offset:eY(c,o,u,a,d)});if(MH(e))return{[f]:i,[h]:eH(e,r,{},{offset:eY(n,o,u,a,d)})};if(eq(t.bin)&&t.bin.step)return{[f]:i,[h]:{signal:`scale("${r}", ${WH(t,{expr:"datum"})} + ${t.bin.step})`,offset:eY(n,o,u,a,d)}}}Mq(Fq(c))}({fieldDef:d,fieldDef2:p,channel:e,markDef:l,scaleName:y,band:n,axisTranslate:null!==(o=null==i?void 0:i.get("translate"))&&void 0!==o?o:.5,spacing:NU(e)?yV("binSpacing",l,a):void 0,reverse:g.get("reverse"),config:a})}return(jH(d)&&$W(m)||x)&&!p?function(t,e,n,i){var r;const{markDef:s,encoding:o,config:a,stack:u}=i,l=s.orient,c=i.scaleName(n),h=i.getScaleComponent(n),f=pU(n),d=dU(n),p="horizontal"===l&&"y"===n||"vertical"===l&&"x"===n,g=yV(p?"size":f,s,a,{vgChannel:f});let m;(o.size||void 0!==g)&&(p?m=UX("size",i,{vgChannel:f,defaultValue:g}):Mq(function(t){return`Cannot apply size to non-oriented mark "${t}".`}(s.type)));const y=null!==(r=jH(e)?DH({channel:n,fieldDef:e,markDef:s,stack:u,config:a}):void 0)&&void 0!==r?r:1;m=m||{[f]:tY(t,f,c,h,a,y)};const v="band"!==(null==h?void 0:h.get("type"))||!("band"in m[f]),b=YX(n,s,a,v?"middle":"top"),x=WX(n,s),w=ZW({channel:n,channelDef:e,markDef:s,config:a,scaleName:c,scale:h,stack:u,offset:x,defaultRef:VX({model:i,defaultPos:"mid",channel:n,scaleName:c,scale:h}),band:v?.5:(1-y)/2});if(f)return Object.assign({[b]:w},m);{const t=fU(d),e=m[f],n=x?Object.assign(Object.assign({},e),{offset:x}):e;return{[b]:w,[t]:vR(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,d,e,t):ZX(e,t,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function tY(t,e,n,i,r,s){if(i){const e=i.get("type");if("point"===e||"band"===e){if(void 0!==r[t].discreteBandSize)return{value:r[t].discreteBandSize};if(e===AW){const t=i.get("range");return Yq(t)&&FR(t.step)?{value:t.step-2}:{value:vG-2}}return{scale:n,band:s}}return{value:r[t].continuousBandSize}}const o=mG(r.view,e),a=xL(r[t].discreteBandSize,o-2);return void 0!==a?{value:a}:void 0}function eY(t,e,n,i,r){if(HP(t))return 0;const s="x"===t||"y2"===t?-e/2:e/2;if(Xq(n)){const t=gV(r);return{signal:`${n.signal} ? ${i-s}${t?"-"+t:""} : ${i+s}${t?"+"+t:""}`}}if(Xq(r)){const t=i+(n?-s:s);return{signal:`${t||""}${n?" - ":t?" + ":""}${r.signal}`}}return r=r||0,i+(n?-r-s:+r+s)}function nY({channel:t,fieldDef:e,scaleName:n,markDef:i,band:r,offset:s,config:o}){return KW({fieldDef:e,channel:t,markDef:i,ref:nH({scaleName:n,fieldOrDatumDef:e,band:r,offset:s}),config:o})}const iY=new Set(["aria"]);function rY(t,e){const{fill:n,stroke:i}="include"===e.color?qX(t):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(t,e){return Zq.reduce(((n,i)=>(iY.has(i)||void 0===t[i]||"ignore"===e[i]||(n[i]=dV(t[i])),n)),{})}(t.markDef,e)),sY(t,"fill",n)),sY(t,"stroke",i)),UX("opacity",t)),UX("fillOpacity",t)),UX("strokeOpacity",t)),UX("strokeWidth",t)),UX("strokeDash",t)),RX(t)),jX(t,"href")),function(t){const{markDef:e,config:n}=t,i=yV("aria",e,n);return!1===i?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),function(t){const{mark:e,markDef:n,config:i}=t;if(!1===i.aria)return{};const r=yV("ariaRoleDescription",n,i);return null!=r?{ariaRoleDescription:{value:r}}:e in Kq?{}:{ariaRoleDescription:{value:e}}}(t)),function(t){const{encoding:e,markDef:n,config:i,stack:r}=t,s=e.description;if(s)return BX(t,s,"description",(e=>IX(e,t.config)));const o=yV("description",n,i);if(null!=o)return{description:dV(o)};if(!1===i.aria)return{};const a=LX(e,r,i);return sL(a)?void 0:{description:{signal:uL(a).map((({key:t,value:e})=>`${t} + ": " + (${e})`)).join(' + "; " + ')}}}(t))}(t))}function sY(t,e,n){const{config:i,mark:r,markDef:s}=t;if("hide"===yV("invalid",s,i)&&n&&!VL(r)){const i=function(t,{invalid:e=!1,channels:n}){const i=n.reduce(((e,n)=>{const i=t.getScaleComponent(n);if(i){const r=i.get("type"),s=t.vgField(n,{expr:"datum"});s&&TW(r)&&(e[s]=!0)}return e}),{}),r=oL(i);if(r.length>0){const t=e?"||":"&&";return r.map((t=>tH(t,e))).join(` ${t} `)}}(t,{invalid:!0,channels:VU});if(i)return{[e]:[{test:i,value:null},...kR(n)]}}return n?{[e]:n}:{}}function oY(t){const{config:e,markDef:n}=t;if(yV("invalid",n,e)){const e=function(t,{invalid:e=!1,channels:n}){const i=n.reduce(((e,n)=>{const i=t.getScaleComponent(n);if(i){const r=i.get("type"),s=t.vgField(n,{expr:"datum"});s&&TW(r)&&(e[s]=!0)}return e}),{}),r=oL(i);if(r.length>0){const t=e?"||":"&&";return r.map((t=>tH(t,e))).join(` ${t} `)}}(t,{channels:OU});if(e)return{defined:{signal:e}}}return{}}function aY(t,e){if(void 0!==e)return{[t]:dV(e)}}const uY="voronoi",lY={has:t=>"interval"!==t.type&&t.nearest,parse:(t,e)=>{if(e.events)for(const n of e.events)n.markname=t.getName(uY)},marks:(t,e,n)=>{const{x:i,y:r}=e.project.hasChannel,s=t.mark;if(VL(s))return Mq(`The "nearest" transform is not supported for ${s} marks.`),n;const o={name:t.getName(uY),type:"path",interactive:!0,from:{data:t.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},RX(t,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]}]};let a=0,u=!1;return n.forEach(((e,n)=>{var i;const r=null!==(i=e.name)&&void 0!==i?i:"";r===t.component.mark[0].name?a=n:r.indexOf(uY)>=0&&(u=!0)})),u||n.splice(a+1,0,o),n}};class cY{constructor(t,e){this.debugName=e,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,e){this._children.indexOf(t)>-1?console.warn("Attempt to add the same child twice."):void 0!==e?this._children.splice(e,0,t):this._children.push(t)}removeChild(t){const e=this._children.indexOf(t);return this._children.splice(e,1),e}remove(){let t=this._parent.removeChild(this);for(const e of this._children)e._parent=this._parent,this._parent.addChild(e,t++)}insertAsParentOf(t){const e=t.parent;e.removeChild(this),this.parent=e,t.parent=this}swapWithParent(){const t=this._parent,e=t.parent;for(const e of this._children)e.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=e,t.parent=this}}class hY extends cY{constructor(t,e,n,i){super(t,e),this.type=n,this.refCounts=i,this._source=this._name=e,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash=`Output ${function(t){const e=++wL;return e}()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}class fY extends cY{constructor(t,e){super(t),this.formula=e}clone(){return new fY(null,HR(this.formula))}static makeFromEncoding(t,e){const n=e.reduceFieldDef(((t,n,i)=>{const{field:r,timeUnit:s}=n,o=FQ(e)?e.encoding[dU(i)]:void 0,a=FQ(e)&&FH(i,n,o,e.stack,e.markDef,e.config);if(s){const e=WH(n,{forAs:!0});t[YR({as:e,field:r,timeUnit:s})]=Object.assign({as:e,field:r,timeUnit:s},a?{band:!0}:{})}return t}),{});return sL(n)?null:new fY(t,n)}static makeFromTransform(t,e){const n=Object.assign({},e),{timeUnit:i}=n,r=MR(n,["timeUnit"]),s=Gq(i),o=Object.assign(Object.assign({},r),{timeUnit:s});return new fY(t,{[YR(o)]:o})}merge(t){this.formula=Object.assign({},this.formula);for(const e in t.formula)this.formula[e]&&!t.formula[e].band||(this.formula[e]=t.formula[e]);for(const e of t.children)t.removeChild(e),e.parent=this;t.remove()}producedFields(){return new Set(aL(this.formula).map((t=>t.as)))}dependentFields(){return new Set(aL(this.formula).map((t=>t.field)))}hash(){return`TimeUnit ${YR(this.formula)}`}assemble(){const t=[];for(const e of aL(this.formula)){const{field:n,as:i,timeUnit:r}=e,s=Gq(r),{unit:o,utc:a}=s,u=MR(s,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:mL(n),type:"timeunit"},o?{units:Wq(o)}:{}),a?{timezone:"utc"}:{}),u),{as:[i,`${i}_end`]}))}return t}}const dY="_tuple_fields";class pY{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}const gY={has:t=>"single"===t.type&&"global"===t.resolve&&t.bind&&"scales"!==t.bind&&!aG(t.bind),parse:(t,e,n,i)=>{i.on||delete e.events,i.clear||delete e.clear},topLevelSignals:(t,e,n)=>{const i=e.name,r=e.project,s=e.bind,o=e.init&&e.init[0],a=lY.has(e)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach(((t,r)=>{var u,l;const c=cL(`${i}_${t.field}`);n.filter((t=>t.name===c)).length||n.unshift(Object.assign(Object.assign({name:c},o?{init:MY(o[r])}:{value:null}),{on:e.events?[{events:e.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${OR(t.field)}] : null`}]:[],bind:null!==(l=null!==(u=s[t.field])&&void 0!==u?u:s[t.channel])&&void 0!==l?l:s}))})),n},signals:(t,e,n)=>{const i=e.name,r=e.project,s=n.filter((t=>t.name===i+qY))[0],o=i+dY,a=r.items.map((t=>cL(`${i}_${t.field}`))),u=a.map((t=>`${t} !== null`)).join(" && ");return a.length&&(s.update=`${u} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},mY="_toggle",yY={has:t=>"multi"===t.type&&!!t.toggle,signals:(t,e,n)=>n.concat({name:e.name+mY,value:!1,on:[{events:e.events,update:e.toggle}]}),modifyExpr:(t,e)=>{const n=e.name+qY,i=e.name+mY;return`${i} ? null : ${n}, `+("global"===e.resolve?`${i} ? null : true, `:`${i} ? null : {unit: ${GY(t)}}, `)+`${i} ? ${n} : null`}},vY={has:t=>void 0!==t.clear&&!1!==t.clear,parse:(t,e,n)=>{n.clear&&(e.clear=SR(n.clear)?rR(n.clear,"scope"):n.clear)},topLevelSignals:(t,e,n)=>{if(gY.has(e))for(const t of e.project.items){const i=n.findIndex((n=>n.name===cL(`${e.name}_${t.field}`)));-1!==i&&n[i].on.push({events:e.clear,update:"null"})}return n},signals:(t,e,n)=>{function i(t,i){-1!==t&&n[t].on&&n[t].on.push({events:e.clear,update:i})}if("interval"===e.type)for(const t of e.project.items){const e=n.findIndex((e=>e.name===t.signals.visual));i(e,"[0, 0]"),-1===e&&i(n.findIndex((e=>e.name===t.signals.data)),"null")}else{let t=n.findIndex((t=>t.name===e.name+qY));i(t,"null"),yY.has(e)&&(t=n.findIndex((t=>t.name===e.name+mY)),i(t,"false"))}return n}},bY={has:t=>"interval"===t.type&&"global"===t.resolve&&t.bind&&"scales"===t.bind,parse:(t,e)=>{const n=e.scales=[];for(const i of e.project.items){const r=i.channel;if(!GU(r))continue;const s=t.getScaleComponent(r),o=s?s.get("type"):void 0;if(!s||!TW(o)){Mq("Scale bindings are currently only supported for scales with unbinned, continuous domains.");continue}const a={selection:e.name,field:i.field};s.set("selectionExtent",a,!0),n.push(i)}},topLevelSignals:(t,e,n)=>{const i=e.scales.filter((t=>0===n.filter((e=>e.name===t.signals.data)).length));if(!t.parent||wY(t)||0===i.length)return n;const r=n.filter((t=>t.name===e.name))[0];let s=r.update;if(s.indexOf(WY)>=0)r.update=`{${i.map((t=>`${OR(t.field)}: ${t.signals.data}`)).join(", ")}}`;else{for(const t of i){const e=`${OR(t.field)}: ${t.signals.data}`;s.indexOf(e)<0&&(s=`${s.substring(0,s.length-1)}, ${e}}`)}r.update=s}return n.concat(i.map((t=>({name:t.signals.data}))))},signals:(t,e,n)=>{if(t.parent&&!wY(t))for(const t of e.scales){const e=n.filter((e=>e.name===t.signals.data))[0];e.push="outer",delete e.value,delete e.update}return n}};function xY(t,e){return`domain(${OR(t.scaleName(e))})`}function wY(t){var e;return t.parent&&NQ(t.parent)&&(null!==(e=!t.parent.parent)&&void 0!==e?e:wY(t.parent.parent))}const AY={has:t=>{const e="global"===t.resolve&&t.bind&&aG(t.bind),n=1===t.project.items.length&&t.project.items[0].field!==sG;return e&&!n&&Mq("Legend bindings are only supported for selections over an individual field or encoding channel."),e&&n},parse:(t,e,n,i)=>{var r;if(i.on||delete e.events,i.clear||delete e.clear,i.on||i.clear){const t='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of e.events)n.filter=kR(null!==(r=n.filter)&&void 0!==r?r:[]),n.filter.indexOf(t)<0&&n.filter.push(t)}const s=uG(e.bind)?e.bind.legend:"click",o=SR(s)?rR(s,"view"):kR(s);e.bind={legend:{merge:o}}},topLevelSignals:(t,e,n)=>{const i=e.name,r=uG(e.bind)&&e.bind.legend,s=t=>e=>{const n=HR(e);return n.markname=t,n};for(const t of e.project.items){if(!t.hasLegend)continue;const o=`${cL(t.field)}_legend`,a=`${i}_${o}`;if(0===n.filter((t=>t.name===a)).length){const t=r.merge.map(s(`${o}_symbols`)).concat(r.merge.map(s(`${o}_labels`))).concat(r.merge.map(s(`${o}_entries`)));n.unshift(Object.assign(Object.assign({name:a},e.init?{}:{value:null}),{on:[{events:t,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${a}`,force:!0}]}))}}return n},signals:(t,e,n)=>{const i=e.name,r=e.project,s=n.find((t=>t.name===i+qY)),o=i+dY,a=r.items.filter((t=>t.hasLegend)).map((t=>cL(`${i}_${cL(t.field)}_legend`))),u=`${a.map((t=>`${t} !== null`)).join(" && ")} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;e.events&&a.length>0?s.on.push({events:a.map((t=>({signal:t}))),update:u}):a.length>0&&(s.update=u,delete s.value,delete s.on);const l=n.find((t=>t.name===i+mY)),c=uG(e.bind)&&e.bind.legend;return l&&(e.events?l.on.push(Object.assign(Object.assign({},l.on[0]),{events:c})):l.on[0].events=c),n}},_Y="_translate_anchor",kY="_translate_delta",CY={has:t=>"interval"===t.type&&t.translate,signals:(t,e,n)=>{const i=e.name,r=bY.has(e),s=i+_Y,{x:o,y:a}=e.project.hasChannel;let u=rR(e.translate,"scope");return r||(u=u.map((t=>(t.between[0].markname=i+TY,t)))),n.push({name:s,value:{},on:[{events:u.map((t=>t.between[0])),update:"{x: x(unit), y: y(unit)"+(void 0!==o?", extent_x: "+(r?xY(t,dP):`slice(${o.signals.visual})`):"")+(void 0!==a?", extent_y: "+(r?xY(t,pP):`slice(${a.signals.visual})`):"")+"}"}]},{name:i+kY,value:{},on:[{events:u,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),void 0!==o&&EY(t,e,o,"width",n),void 0!==a&&EY(t,e,a,"height",n),n}};function EY(t,e,n,i,r){var s;const o=e.name,a=o+_Y,u=o+kY,l=n.channel,c=bY.has(e),h=r.filter((t=>t.name===n.signals[c?"data":"visual"]))[0],f=t.getSizeSignalRef(i).signal,d=t.getScaleComponent(l),p=d.get("type"),g=`${a}.extent_${l}`,m=`${c?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear"}(${g}, ${`${c&&l===dP?"-":""}${u}.${l} / `+(c?`${f}`:`span(${g})`)}`+(c&&"pow"===p?`, ${null!==(s=d.get("exponent"))&&void 0!==s?s:1}`:"")+")";h.on.push({events:{signal:u},update:c?m:`clampRange(${m}, 0, ${f})`})}const DY="_zoom_delta",FY={has:t=>"interval"===t.type&&t.zoom,signals:(t,e,n)=>{const i=e.name,r=bY.has(e),s=i+DY,{x:o,y:a}=e.project.hasChannel,u=OR(t.scaleName(dP)),l=OR(t.scaleName(pP));let c=rR(e.zoom,"scope");return r||(c=c.map((t=>(t.markname=i+TY,t)))),n.push({name:i+"_zoom_anchor",on:[{events:c,update:r?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter((t=>!!t)).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==o&&SY(t,e,o,"width",n),void 0!==a&&SY(t,e,a,"height",n),n}};function SY(t,e,n,i,r){var s;const o=e.name,a=n.channel,u=bY.has(e),l=r.filter((t=>t.name===n.signals[u?"data":"visual"]))[0],c=t.getSizeSignalRef(i).signal,h=t.getScaleComponent(a),f=h.get("type"),d=u?xY(t,a):l.name,p=o+DY,g=`${u?"log"===f?"zoomLog":"pow"===f?"zoomPow":"zoomLinear":"zoomLinear"}(${d}, ${o}_zoom_anchor.${a}, ${p}`+(u&&"pow"===f?`, ${null!==(s=h.get("exponent"))&&void 0!==s?s:1}`:"")+")";l.on.push({events:{signal:p},update:u?g:`clampRange(${g}, 0, ${c})`})}const OY=[{has:()=>!0,parse:(t,e,n)=>{var i,r,s;const o=e.name,a=null!==(i=e.project)&&void 0!==i?i:e.project=new pY,u={},l={},c=new Set,h=(t,e)=>{const n="visual"===e?t.channel:t.field;let i=cL(`${o}_${n}`);for(let t=1;c.has(i);t++)i=cL(`${o}_${n}_${t}`);return c.add(i),{[e]:i}};if(!n.fields&&!n.encodings){const e=t.config.selection[n.type];if(n.init)for(const t of kR(n.init))for(const i of oL(t))aU[i]?(n.encodings||(n.encodings=[])).push(i):"interval"===n.type?(Mq('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=e.encodings):(n.fields||(n.fields=[])).push(i);else n.encodings=e.encodings,n.fields=e.fields}for(const t of null!==(r=n.fields)&&void 0!==r?r:[]){const e={type:"E",field:t};e.signals=Object.assign({},h(e,"data")),a.items.push(e),a.hasField[t]=e}for(const i of null!==(s=n.encodings)&&void 0!==s?s:[]){const n=t.fieldDef(i);if(n){let r=n.field;if(n.aggregate){Mq(lq(i,n.aggregate));continue}if(!r){Mq(uq(i));continue}if(n.timeUnit){r=t.vgField(i);const e={timeUnit:n.timeUnit,as:r,field:n.field};l[YR(e)]=e}if(!u[r]){let s="E";"interval"===e.type?TW(t.getScaleComponent(i).get("type"))&&(s="R"):n.bin&&(s="R-RE");const o={field:r,channel:i,type:s};o.signals=Object.assign(Object.assign({},h(o,"data")),h(o,"visual")),a.items.push(u[r]=o),a.hasField[r]=a.hasChannel[i]=u[r]}}else Mq(uq(i))}if(n.init){const t=t=>a.items.map((e=>void 0!==t[e.channel]?t[e.channel]:t[e.field]));if("interval"===n.type)e.init=t(n.init);else{const i=kR(n.init);e.init=i.map(t)}}sL(l)||(a.timeUnit=new fY(null,l))},signals:(t,e,n)=>{const i=e.name+dY;return n.filter((t=>t.name===i)).length>0?n:n.concat({name:i,value:e.project.items.map((t=>{const{signals:e,hasLegend:n}=t,i=MR(t,["signals","hasLegend"]);return i.field=mL(i.field),i}))})}},yY,bY,AY,CY,FY,gY,lY,vY];function NY(t,e){for(const n of OY)n.has(t)&&e(n)}function MY(t,e=!0,n=mR){if(vR(t)){const i=t.map((t=>MY(t,e,n)));return e?`[${i.join(", ")}]`:i}return zq(t)?n(e?Rq(t):function(t){const e=Iq(t,!0);return t.utc?+new Date(Date.UTC(...e)):+new Date(...e)}(t)):e?n(JSON.stringify(t)):t}function zY(t,e){return VY(t,((n,i)=>{e=i.marks?i.marks(t,n,e):e,NY(n,(i=>{i.marks&&(e=i.marks(t,n,e))}))})),e}function $Y(t){return t.map((t=>(t.on&&!t.on.length&&delete t.on,t)))}const TY="_brush",BY="_scale_trigger",jY={signals:(t,e)=>{const n=e.name,i=n+dY,r=bY.has(e),s=[],o=[],a=[];if(e.translate&&!r){const t=`!event.item || event.item.mark.name !== ${OR(n+TY)}`;IY(e,((e,n)=>{var i;const r=kR(null!==(i=n.between[0].filter)&&void 0!==i?i:n.between[0].filter=[]);return r.indexOf(t)<0&&r.push(t),e}))}e.project.items.forEach(((n,i)=>{const r=n.channel;if(r!==dP&&r!==pP)return void Mq("Interval selections only support x and y encoding channels.");const u=e.init?e.init[i]:null,l=function(t,e,n,i){const r=n.channel,s=n.signals.visual,o=n.signals.data,a=bY.has(e),u=OR(t.scaleName(r)),l=t.getScaleComponent(r),c=l?l.get("type"):void 0,h=t=>`scale(${u}, ${t})`,f=t.getSizeSignalRef(r===dP?"width":"height").signal,d=`${r}(unit)`,p=IY(e,((t,e)=>[...t,{events:e.between[0],update:`[${d}, ${d}]`},{events:e,update:`[${s}[0], clamp(${d}, 0, ${f})]`}]));return p.push({events:{signal:e.name+BY},update:TW(c)?`[${h(`${o}[0]`)}, ${h(`${o}[1]`)}]`:"[0, 0]"}),a?[{name:o,on:[]}]:[Object.assign(Object.assign({name:s},i?{init:MY(i,!0,h)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},i?{init:MY(i)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${u}, ${s})`}]})]}(t,e,n,u),c=n.signals.data,h=n.signals.visual,f=OR(t.scaleName(r)),d=TW(t.getScaleComponent(r).get("type"))?"+":"";s.push(...l),o.push(c),a.push({scaleName:t.scaleName(r),expr:`(!isArray(${c}) || (${d}invert(${f}, ${h})[0] === ${d}${c}[0] && ${d}invert(${f}, ${h})[1] === ${d}${c}[1]))`})})),r||s.push({name:n+BY,value:{},on:[{events:a.map((t=>({scale:t.scaleName}))),update:a.map((t=>t.expr)).join(" && ")+` ? ${n+BY} : {}`}]});const u=e.init,l=`unit: ${GY(t)}, fields: ${i}, values`;return s.concat(Object.assign(Object.assign({name:n+qY},u?{init:`{${l}: ${MY(u)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${l}: [${o}]} : null`}]}))},modifyExpr:(t,e)=>e.name+qY+", "+("global"===e.resolve?"true":`{unit: ${GY(t)}}`),marks:(t,e,n)=>{const i=e.name,{x:r,y:s}=e.project.hasChannel,o=r&&r.signals.visual,a=s&&s.signals.visual,u=`data(${OR(e.name+UY)})`;if(bY.has(e))return n;const l={x:void 0!==r?{signal:`${o}[0]`}:{value:0},y:void 0!==s?{signal:`${a}[0]`}:{value:0},x2:void 0!==r?{signal:`${o}[1]`}:{field:{group:"width"}},y2:void 0!==s?{signal:`${a}[1]`}:{field:{group:"height"}}};if("global"===e.resolve)for(const e of oL(l))l[e]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${GY(t)}`},l[e]),{value:0}];const c=e.mark,{fill:h,fillOpacity:f,cursor:d}=c,p=MR(c,["fill","fillOpacity","cursor"]),g=oL(p).reduce(((t,e)=>(t[e]=[{test:[void 0!==r&&`${o}[0] !== ${o}[1]`,void 0!==s&&`${a}[0] !== ${a}[1]`].filter((t=>t)).join(" && "),value:p[e]},{value:null}],t)),{});return[{name:i+TY+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:h},fillOpacity:{value:f}},update:l}},...n,{name:i+TY,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},d?{cursor:{value:d}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),g)}}]}};function IY(t,e){return t.events.reduce(((t,n)=>n.between?e(t,n):(Mq(`${n} is not an ordered event stream for interval selections.`),t)),[])}function RY(t,e){const n=e.name,i=n+dY,r=e.project,s="(item().isVoronoi ? datum.datum : datum)",o=r.items.map((e=>{const n=t.fieldDef(e.channel);return n&&n.bin?`[${s}[${OR(t.vgField(e.channel,{}))}], ${s}[${OR(t.vgField(e.channel,{binSuffix:"end"}))}]]`:`${s}[${OR(e.field)}]`})).join(", "),a=`unit: ${GY(t)}, fields: ${i}, values`,u=e.events;return[{name:n+qY,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${a}: [${o}]} : null`,force:!0}]:[]}]}const LY={signals:RY,modifyExpr:(t,e)=>e.name+qY+", "+("global"===e.resolve?"null":`{unit: ${GY(t)}}`)},PY={signals:RY,modifyExpr:(t,e)=>e.name+qY+", "+("global"===e.resolve?"true":`{unit: ${GY(t)}}`)},UY="_store",qY="_tuple",WY="vlSelectionResolve",HY={single:PY,multi:LY,interval:jY};function VY(t,e){const n=t.component.selection;if(n)for(const t of aL(n))if(!0===e(t,HY[t.type]))break}function GY(t,{escape:e}={escape:!0}){let n=e?OR(t.name):t.name;const i=function(t){let e=t.parent;for(;e&&!SQ(e);)e=e.parent;return e}(t);if(i){const{facet:t}=i;for(const e of ZP)t[e]&&(n+=` + '__facet_${e}_' + (facet[${OR(i.vgField(e))}])`)}return n}function XY(t){let e=!1;return VY(t,(t=>{e=e||t.project.items.some((t=>t.field===sG))})),e}function YY(t){this.type=t}var JY,ZY,KY,QY,tJ;YY.prototype.visit=function(t){let e,n,i;if(t(this))return 1;for(e=function(t){switch(t.type){case"ArrayExpression":return t.elements;case"BinaryExpression":case"LogicalExpression":return[t.left,t.right];case"CallExpression":return[t.callee].concat(t.arguments);case"ConditionalExpression":return[t.test,t.consequent,t.alternate];case"MemberExpression":return[t.object,t.property];case"ObjectExpression":return t.properties;case"Property":return[t.key,t.value];case"UnaryExpression":return[t.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this),n=0,i=e.length;n<i;++n)if(e[n].visit(t))return 1},(JY={})[1]="Boolean",JY[2]="<end>",JY[3]="Identifier",JY[4]="Keyword",JY[5]="Null",JY[6]="Numeric",JY[7]="Punctuator",JY[8]="String",JY[9]="RegularExpression";var eJ="Identifier",nJ="Unexpected token %0",iJ="Invalid regular expression",rJ="Invalid regular expression: missing /",sJ="Octal literals are not allowed in strict mode.",oJ="ILLEGAL",aJ="Disabled.",uJ=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),lJ=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function cJ(t,e){if(!t)throw new Error("ASSERT: "+e)}function hJ(t){return t>=48&&t<=57}function fJ(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function dJ(t){return"01234567".indexOf(t)>=0}function pJ(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function gJ(t){return 10===t||13===t||8232===t||8233===t}function mJ(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&uJ.test(String.fromCharCode(t))}function yJ(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&lJ.test(String.fromCharCode(t))}var vJ={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function bJ(){for(var t;KY<QY&&(pJ(t=ZY.charCodeAt(KY))||gJ(t));)++KY}function xJ(t){var e,n,i,r=0;for(n="u"===t?4:2,e=0;e<n;++e)KY<QY&&fJ(ZY[KY])?(i=ZY[KY++],r=16*r+"0123456789abcdef".indexOf(i.toLowerCase())):zJ({},nJ,oJ);return String.fromCharCode(r)}function wJ(){var t,e,n,i;for(e=0,"}"===(t=ZY[KY])&&zJ({},nJ,oJ);KY<QY&&fJ(t=ZY[KY++]);)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||"}"!==t)&&zJ({},nJ,oJ),e<=65535?String.fromCharCode(e):(n=55296+(e-65536>>10),i=56320+(e-65536&1023),String.fromCharCode(n,i))}function AJ(){var t,e;for(t=ZY.charCodeAt(KY++),e=String.fromCharCode(t),92===t&&(117!==ZY.charCodeAt(KY)&&zJ({},nJ,oJ),++KY,(t=xJ("u"))&&"\\"!==t&&mJ(t.charCodeAt(0))||zJ({},nJ,oJ),e=t);KY<QY&&yJ(t=ZY.charCodeAt(KY));)++KY,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==ZY.charCodeAt(KY)&&zJ({},nJ,oJ),++KY,(t=xJ("u"))&&"\\"!==t&&yJ(t.charCodeAt(0))||zJ({},nJ,oJ),e+=t);return e}function _J(){var t,e,n,i,r=KY,s=ZY.charCodeAt(KY),o=ZY[KY];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++KY,{type:7,value:String.fromCharCode(s),start:r,end:KY};default:if(61===(t=ZY.charCodeAt(KY+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return KY+=2,{type:7,value:String.fromCharCode(s)+String.fromCharCode(t),start:r,end:KY};case 33:case 61:return KY+=2,61===ZY.charCodeAt(KY)&&++KY,{type:7,value:ZY.slice(r,KY),start:r,end:KY}}}return">>>="===(i=ZY.substr(KY,4))?{type:7,value:i,start:r,end:KY+=4}:">>>"===(n=i.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:r,end:KY+=3}:o===(e=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===e?{type:7,value:e,start:r,end:KY+=2}:"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:r,end:++KY}:void zJ({},nJ,oJ)}function kJ(){var t,e,n;if(cJ(hJ((n=ZY[KY]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),e=KY,t="","."!==n){if(t=ZY[KY++],n=ZY[KY],"0"===t){if("x"===n||"X"===n)return++KY,function(t){for(var e="";KY<QY&&fJ(ZY[KY]);)e+=ZY[KY++];return 0===e.length&&zJ({},nJ,oJ),mJ(ZY.charCodeAt(KY))&&zJ({},nJ,oJ),{type:6,value:parseInt("0x"+e,16),start:t,end:KY}}(e);if(dJ(n))return function(t){for(var e="0"+ZY[KY++];KY<QY&&dJ(ZY[KY]);)e+=ZY[KY++];return(mJ(ZY.charCodeAt(KY))||hJ(ZY.charCodeAt(KY)))&&zJ({},nJ,oJ),{type:6,value:parseInt(e,8),octal:!0,start:t,end:KY}}(e);n&&hJ(n.charCodeAt(0))&&zJ({},nJ,oJ)}for(;hJ(ZY.charCodeAt(KY));)t+=ZY[KY++];n=ZY[KY]}if("."===n){for(t+=ZY[KY++];hJ(ZY.charCodeAt(KY));)t+=ZY[KY++];n=ZY[KY]}if("e"===n||"E"===n)if(t+=ZY[KY++],"+"!==(n=ZY[KY])&&"-"!==n||(t+=ZY[KY++]),hJ(ZY.charCodeAt(KY)))for(;hJ(ZY.charCodeAt(KY));)t+=ZY[KY++];else zJ({},nJ,oJ);return mJ(ZY.charCodeAt(KY))&&zJ({},nJ,oJ),{type:6,value:parseFloat(t),start:e,end:KY}}function CJ(){var t;return bJ(),KY>=QY?{type:2,start:KY,end:KY}:mJ(t=ZY.charCodeAt(KY))?function(){var t,e;return t=KY,{type:1===(e=92===ZY.charCodeAt(KY)?AJ():function(){var t,e;for(t=KY++;KY<QY;){if(92===(e=ZY.charCodeAt(KY)))return KY=t,AJ();if(!yJ(e))break;++KY}return ZY.slice(t,KY)}()).length?3:vJ.hasOwnProperty(e)?4:"null"===e?5:"true"===e||"false"===e?1:3,value:e,start:t,end:KY}}():40===t||41===t||59===t?_J():39===t||34===t?function(){var t,e,n,i,r="",s=!1;for(cJ("'"===(t=ZY[KY])||'"'===t,"String literal must starts with a quote"),e=KY,++KY;KY<QY;){if((n=ZY[KY++])===t){t="";break}if("\\"===n)if((n=ZY[KY++])&&gJ(n.charCodeAt(0)))"\r"===n&&"\n"===ZY[KY]&&++KY;else switch(n){case"u":case"x":"{"===ZY[KY]?(++KY,r+=wJ()):r+=xJ(n);break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:dJ(n)?(0!==(i="01234567".indexOf(n))&&(s=!0),KY<QY&&dJ(ZY[KY])&&(s=!0,i=8*i+"01234567".indexOf(ZY[KY++]),"0123".indexOf(n)>=0&&KY<QY&&dJ(ZY[KY])&&(i=8*i+"01234567".indexOf(ZY[KY++]))),r+=String.fromCharCode(i)):r+=n}else{if(gJ(n.charCodeAt(0)))break;r+=n}}return""!==t&&zJ({},nJ,oJ),{type:8,value:r,octal:s,start:e,end:KY}}():46===t?hJ(ZY.charCodeAt(KY+1))?kJ():_J():hJ(t)?kJ():_J()}function EJ(){var t;return KY=(t=tJ).end,tJ=CJ(),KY=t.end,t}function DJ(){var t;t=KY,tJ=CJ(),KY=t}function FJ(t,e,n){var i=new YY("||"===t||"&&"===t?"LogicalExpression":"BinaryExpression");return i.operator=t,i.left=e,i.right=n,i}function SJ(t){var e=new YY(eJ);return e.name=t,e}function OJ(t){var e=new YY("Literal");return e.value=t.value,e.raw=ZY.slice(t.start,t.end),t.regex&&("//"===e.raw&&(e.raw="/(?:)/"),e.regex=t.regex),e}function NJ(t,e,n){var i=new YY("MemberExpression");return i.computed="["===t,i.object=e,i.property=n,i.computed||(n.member=!0),i}function MJ(t,e,n){var i=new YY("Property");return i.key=e,i.value=n,i.kind=t,i}function zJ(t,e){var n,i=Array.prototype.slice.call(arguments,2),r=e.replace(/%(\d)/g,(function(t,e){return cJ(e<i.length,"Message reference must be in range"),i[e]}));throw(n=new Error(r)).index=KY,n.description=r,n}function $J(t){2===t.type&&zJ(t,"Unexpected end of input"),6===t.type&&zJ(t,"Unexpected number"),8===t.type&&zJ(t,"Unexpected string"),3===t.type&&zJ(t,"Unexpected identifier"),4===t.type&&zJ(t,"Unexpected reserved word"),zJ(t,nJ,t.value)}function TJ(t){var e=EJ();7===e.type&&e.value===t||$J(e)}function BJ(t){return 7===tJ.type&&tJ.value===t}function jJ(t){return 4===tJ.type&&tJ.value===t}function IJ(){var t;return KY=tJ.start,8===(t=EJ()).type||6===t.type?(t.octal&&zJ(t,sJ),OJ(t)):SJ(t.value)}function RJ(){var t,e,n;return KY=tJ.start,3===(t=tJ).type?(n=IJ(),TJ(":"),MJ("init",n,GJ())):2!==t.type&&7!==t.type?(e=IJ(),TJ(":"),MJ("init",e,GJ())):void $J(t)}var LJ={if:1};function PJ(){var t,e,n;if(BJ("("))return function(){var t;return TJ("("),t=XJ(),TJ(")"),t}();if(BJ("["))return function(){var t=[];for(KY=tJ.start,TJ("[");!BJ("]");)BJ(",")?(EJ(),t.push(null)):(t.push(GJ()),BJ("]")||TJ(","));return EJ(),function(t){var e=new YY("ArrayExpression");return e.elements=t,e}(t)}();if(BJ("{"))return function(){var t,e,n=[],i={},r=String;for(KY=tJ.start,TJ("{");!BJ("}");)e="$"+((t=RJ()).key.type===eJ?t.key.name:r(t.key.value)),Object.prototype.hasOwnProperty.call(i,e)?zJ({},"Duplicate data property in object literal not allowed in strict mode"):i[e]=!0,n.push(t),BJ("}")||TJ(",");return TJ("}"),function(t){var e=new YY("ObjectExpression");return e.properties=t,e}(n)}();if(t=tJ.type,KY=tJ.start,3===t||LJ[tJ.value])n=SJ(EJ().value);else if(8===t||6===t)tJ.octal&&zJ(tJ,sJ),n=OJ(EJ());else{if(4===t)throw new Error(aJ);1===t?((e=EJ()).value="true"===e.value,n=OJ(e)):5===t?((e=EJ()).value=null,n=OJ(e)):BJ("/")||BJ("/=")?(n=OJ(function(){var t,e,n,i;return tJ=null,bJ(),t=KY,e=function(){var t,e,n,i;for(cJ("/"===(t=ZY[KY]),"Regular expression literal must start with a slash"),e=ZY[KY++],n=!1,i=!1;KY<QY;)if(e+=t=ZY[KY++],"\\"===t)gJ((t=ZY[KY++]).charCodeAt(0))&&zJ({},rJ),e+=t;else if(gJ(t.charCodeAt(0)))zJ({},rJ);else if(n)"]"===t&&(n=!1);else{if("/"===t){i=!0;break}"["===t&&(n=!0)}return i||zJ({},rJ),{value:e.substr(1,e.length-2),literal:e}}(),n=function(){var t,e,n;for(e="",n="";KY<QY&&yJ((t=ZY[KY]).charCodeAt(0));)++KY,"\\"===t&&KY<QY?zJ({},nJ,oJ):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&zJ({},iJ,n),{value:n,literal:e}}(),i=function(t,e){var n=t;e.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(t,e){if(parseInt(e,16)<=1114111)return"x";zJ({},iJ)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(t){zJ({},iJ)}try{return new RegExp(t,e)}catch(t){return null}}(e.value,n.value),{literal:e.literal+n.literal,value:i,regex:{pattern:e.value,flags:n.value},start:t,end:KY}}()),DJ()):$J(EJ())}return n}function UJ(){var t=[];if(TJ("("),!BJ(")"))for(;KY<QY&&(t.push(GJ()),!BJ(")"));)TJ(",");return TJ(")"),t}function qJ(){var t;return TJ("["),t=XJ(),TJ("]"),t}function WJ(){var t=function(){var t,e,n,i,r;for(t=PJ();;)if(BJ("."))t=NJ(".",t,(r=void 0,TJ("."),KY=tJ.start,function(t){return 3===t.type||4===t.type||1===t.type||5===t.type}(r=EJ())||$J(r),SJ(r.value)));else if(BJ("("))e=t,n=UJ(),i=void 0,(i=new YY("CallExpression")).callee=e,i.arguments=n,t=i;else{if(!BJ("["))break;t=NJ("[",t,qJ())}return t}();if(7===tJ.type&&(BJ("++")||BJ("--")))throw new Error(aJ);return t}function HJ(){var t,e;if(7!==tJ.type&&4!==tJ.type)e=WJ();else{if(BJ("++")||BJ("--"))throw new Error(aJ);if(BJ("+")||BJ("-")||BJ("~")||BJ("!"))t=EJ(),e=HJ(),e=function(t,e){var n=new YY("UnaryExpression");return n.operator=t,n.argument=e,n.prefix=!0,n}(t.value,e);else{if(jJ("delete")||jJ("void")||jJ("typeof"))throw new Error(aJ);e=WJ()}}return e}function VJ(t){var e=0;if(7!==t.type&&4!==t.type)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11}return e}function GJ(){var t,e;return t=function(){var t,e,n,i,r,s,o,a,u,l;if(t=tJ,u=HJ(),0===(r=VJ(i=tJ)))return u;for(i.prec=r,EJ(),e=[t,tJ],s=[u,i,o=HJ()];(r=VJ(tJ))>0;){for(;s.length>2&&r<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),e.pop(),n=FJ(a,u,o),s.push(n);(i=EJ()).prec=r,s.push(i),e.push(tJ),n=HJ(),s.push(n)}for(n=s[l=s.length-1],e.pop();l>1;)e.pop(),n=FJ(s[l-1].value,s[l-2],n),l-=2;return n}(),BJ("?")&&(EJ(),e=GJ(),TJ(":"),t=function(t,e,n){var i=new YY("ConditionalExpression");return i.test=t,i.consequent=e,i.alternate=n,i}(t,e,GJ())),t}function XJ(){var t=GJ();if(BJ(","))throw new Error(aJ);return t}function YJ(t,e,n){return t.fields=e||[],t.fname=n,t}function JJ(t){return 1===t.length?ZJ(t[0]):KJ(t)}const ZJ=t=>function(e){return e[t]},KJ=t=>{const e=t.length;return function(n){for(let i=0;i<e;++i)n=n[t[i]];return n}};function QJ(t){throw Error(t)}function tZ(t){const e=[];return"Identifier"===t.type?[t.name]:"Literal"===t.type?[t.value]:("MemberExpression"===t.type&&(e.push(...tZ(t.object)),e.push(...tZ(t.property))),e)}function eZ(t){return"MemberExpression"===t.object.type?eZ(t.object):"datum"===t.object.name}function nZ(t){const e=function(t){KY=0,QY=(ZY=t).length,tJ=null,DJ();var e=XJ();if(2!==tJ.type)throw new Error("Unexpect token after expression.");return e}(t),n=new Set;return e.visit((t=>{"MemberExpression"===t.type&&eZ(t)&&n.add(tZ(t).slice(1).join("."))})),n}(function(t,e,n){const i=function(t){const e=[],n=t.length;let i,r,s,o=null,a=0,u="";function l(){e.push(u+t.substring(i,r)),u="",i=r+1}for(t+="",i=r=0;r<n;++r)if(s=t[r],"\\"===s)u+=t.substring(i,r),u+=t.substring(++r,++r),i=r;else if(s===o)l(),o=null,a=-1;else{if(o)continue;i===a&&'"'===s||i===a&&"'"===s?(i=r+1,o=s):"."!==s||a?"["===s?(r>i&&l(),a=i=r+1):"]"===s&&(a||QJ("Access path missing open bracket: "+t),a>0&&l(),a=0,i=r+1):r>i?l():i=r+1}return a&&QJ("Access path missing closing bracket: "+t),o&&QJ("Access path missing closing quote: "+t),r>i&&(r++,l()),e}(t);t=1===i.length?i[0]:t,YJ((n&&n.get||JJ)(i),[t],e||t)})("id"),YJ((t=>t),[],"identity"),YJ((()=>0),[],"zero"),YJ((()=>1),[],"one"),YJ((()=>!0),[],"true"),YJ((()=>!1),[],"false"),Array.isArray,Object.prototype.hasOwnProperty;class iZ extends cY{constructor(t,e,n){super(t),this.model=e,this.filter=n,this.expr=oZ(this.model,this.filter,this),this._dependentFields=nZ(this.expr)}clone(){return new iZ(null,this.model,HR(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function rZ(t,e,n,i="datum"){const r=[],s=hL(e,(function(e){const s=cL(e),o=t.getSelectionComponent(s,e),a=OR(s+UY);if(o.project.timeUnit){const e=null!=n?n:t.component.data.raw,i=o.project.timeUnit.clone();e.parent?i.insertAsParentOf(e):e.parent=i}return"none"!==o.empty&&r.push(a),`vlSelectionTest(${a}, ${i}`+("global"===o.resolve?")":`, ${OR(o.resolve)})`)}));return(r.length?"!("+r.map((t=>`length(data(${t}))`)).join(" || ")+") || ":"")+`(${s})`}function sZ(t,e){const n=e.encoding;let i=e.field;if(n||i){if(n&&!i){const r=t.project.items.filter((t=>t.channel===n));!r.length||r.length>1?(i=t.project.items[0].field,Mq((r.length?"Multiple ":"No ")+`matching ${OR(n)} encoding found for selection ${OR(e.selection)}. `+`Using "field": ${OR(i)}.`)):i=r[0].field}}else i=t.project.items[0].field,t.project.items.length>1&&Mq(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${OR(i)}.`);return`${t.name}[${OR(i)}]`}function oZ(t,e,n){return hL(e,(e=>SR(e)?e:function(t){return null==t?void 0:t.selection}(e)?rZ(t,e.selection,n):lW(e)))}function aZ(t,e,n,i){var r,s,o;t.encode=null!==(r=t.encode)&&void 0!==r?r:{},t.encode[e]=null!==(s=t.encode[e])&&void 0!==s?s:{},t.encode[e].update=null!==(o=t.encode[e].update)&&void 0!==o?o:{},t.encode[e].update[n]=i}function uZ(t,e,n,i={header:!1}){var r,s;const o=t.combine(),{disable:a,orient:u,scale:l,labelExpr:c,title:h,zindex:f}=o,d=MR(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!a){for(const t in d){const n=DL[t],i=d[t];if(n&&n!==e&&"both"!==n)delete d[t];else if(CL(i)){const{condition:e}=i,n=MR(i,["condition"]),r=kR(e),s=kL[t];if(s){const{vgProp:e,part:i}=s;aZ(d,i,e,[...r.map((t=>{const{test:e}=t,n=MR(t,["test"]);return Object.assign({test:oZ(null,e)},n)})),n]),delete d[t]}else if(null===s){const e={signal:r.map((t=>{const{test:e}=t,n=MR(t,["test"]);return`${oZ(null,e)} ? ${pV(n)} : `})).join("")+pV(n)};d[t]=e}}else if(Xq(i)){const e=kL[t];if(e){const{vgProp:n,part:r}=e;aZ(d,r,n,i),delete d[t]}}}if("grid"===e){if(!d.grid)return;if(d.encode){const{grid:t}=d.encode;d.encode=Object.assign({},t?{grid:t}:{}),sL(d.encode)&&delete d.encode}return Object.assign(Object.assign({scale:l,orient:u},d),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:xL(f,0)})}{if(!i.header&&t.mainExtracted)return;if(void 0!==c){let t=c;(null===(s=null===(r=d.encode)||void 0===r?void 0:r.labels)||void 0===s?void 0:s.update)&&Xq(d.encode.labels.update.text)&&(t=yL(c,"datum.label",d.encode.labels.update.text.signal)),aZ(d,"labels","text",{signal:t})}if(null===d.labelAlign&&delete d.labelAlign,d.encode){for(const e of EL)t.hasAxisPart(e)||delete d.encode[e];sL(d.encode)&&delete d.encode}const e=function(t,e){if(t)return vR(t)&&!fV(t)?t.map((t=>KH(t,e))).join(", "):t}(h,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:u,grid:!1},e?{title:e}:{}),d),!1===n.aria?{aria:!1}:{}),{zindex:xL(f,0)})}}}function lZ(t){const{axes:e}=t.component,n=[];for(const i of OU)if(e[i])for(const r of e[i])if(!r.get("disable")&&!r.get("gridScale")){const e="x"===i?"height":"width",r=t.getSizeSignalRef(e).signal;e!==r&&n.push({name:e,update:r})}return n}const cZ={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},hZ={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},fZ=oL(cZ),dZ=oL(hZ);function pZ(t,e,n,i){return Object.assign.apply(null,[{},...t.map((t=>{if("axisOrient"===t){const t="x"===n?"bottom":"left",r=e["x"===n?"axisBottom":"axisLeft"]||{},s=e["x"===n?"axisTop":"axisRight"]||{},o=new Set([...oL(r),...oL(s)]),a={};for(const e of o.values())a[e]={signal:`${i.signal} === "${t}" ? ${gV(r[e])} : ${gV(s[e])}`};return a}return e[t]}))])}function gZ(t,e){var n;const i=[{}];for(const r of t){let t=null===(n=e[r])||void 0===n?void 0:n.style;if(t){t=kR(t);for(const n of t)i.push(e.style[n])}}return Object.assign.apply(null,i)}function mZ(t,e,n,i={}){var r;const s=xV(t,n,e.style);if(void 0!==s)return{configFrom:"style",configValue:s};for(const e of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(r=i[e])||void 0===r?void 0:r[t]))return{configFrom:e,configValue:i[e][t]};return{}}const yZ={scale:({model:t,channel:e})=>t.scaleName(e),format:({fieldOrDatumDef:t,config:e,axis:n})=>{const{format:i,formatType:r}=n;return cH(t,t.type,i,r,e,!0)},formatType:({axis:t,fieldOrDatumDef:e,scaleType:n})=>{const{formatType:i}=t;return hH(i,e,n)},grid:({fieldOrDatumDef:t,axis:e,scaleType:n})=>{var i;return(!MH(t)||!tq(t.bin))&&(null!==(i=e.grid)&&void 0!==i?i:function(t,e){return!$W(t)&&MH(e)&&!QU(null==e?void 0:e.bin)}(n,t))},gridScale:({model:t,channel:e})=>function(t,e){const n="x"===e?"y":"x";if(t.getScaleComponent(n))return t.scaleName(n)}(t,e),labelAlign:({axis:t,labelAngle:e,orient:n,channel:i})=>t.labelAlign||xZ(e,n,i),labelAngle:({labelAngle:t})=>t,labelBaseline:({axis:t,labelAngle:e,orient:n,channel:i})=>t.labelBaseline||bZ(e,n,i),labelFlush:({axis:t,fieldOrDatumDef:e,channel:n})=>{var i;return null!==(i=t.labelFlush)&&void 0!==i?i:function(t,e){if("x"===e&&ZR(["quantitative","temporal"],t))return!0}(e.type,n)},labelOverlap:({axis:t,fieldOrDatumDef:e,scaleType:n})=>{var i;return null!==(i=t.labelOverlap)&&void 0!==i?i:function(t,e){if("nominal"!==t)return"log"!==e||"greedy"}(e.type,n)},orient:({orient:t})=>t,tickCount:({channel:t,model:e,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var s;const o="x"===t?"width":"y"===t?"height":void 0,a=o?e.getSizeSignalRef(o):void 0;return null!==(s=n.tickCount)&&void 0!==s?s:function({fieldOrDatumDef:t,scaleType:e,size:n,values:i}){var r;if(!i&&!$W(e)&&"log"!==e){if(MH(t)){if(QU(t.bin))return{signal:`ceil(${n.signal}/10)`};if(t.timeUnit&&ZR(["month","hours","day","quarter"],null===(r=Gq(t.timeUnit))||void 0===r?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}}({fieldOrDatumDef:i,scaleType:r,size:a,values:n.values})},title:({axis:t,model:e,channel:n})=>{if(void 0!==t.title)return t.title;const i=wZ(e,n);if(void 0!==i)return i;const r=e.typedFieldDef(n),s="x"===n?"x2":"y2",o=e.fieldDef(s);return AV(r?[CH(r)]:[],MH(o)?[CH(o)]:[])},values:({axis:t,fieldOrDatumDef:e})=>function(t,e){const n=t.values;return vR(n)?lV(e,n):Xq(n)?n:void 0}(t,e),zindex:({axis:t,fieldOrDatumDef:e,mark:n})=>{var i;return null!==(i=t.zindex)&&void 0!==i?i:function(t,e){return"rect"===t&&HH(e)?1:0}(n,e)}};function vZ(t){return`(((${t.signal} % 360) + 360) % 360)`}function bZ(t,e,n,i){if(void 0!==t){if("x"===n){if(Xq(t)){const n=vZ(t);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${Xq(e)?`(${e.signal} === "top")`:"top"===e} ? "bottom" : "top"`}}if(45<t&&t<135||225<t&&t<315)return"middle";if(Xq(e)){const n=t<=45||315<=t?"===":"!==";return{signal:`${e.signal} ${n} "top" ? "bottom" : "top"`}}return(t<=45||315<=t)==("top"===e)?"bottom":"top"}if(Xq(t)){const n=vZ(t);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${Xq(e)?`(${e.signal} === "left")`:"left"===e} ? "top" : "bottom"`}}if(t<=45||315<=t||135<=t&&t<=225)return i?"middle":null;if(Xq(e)){const n=45<=t&&t<=135?"===":"!==";return{signal:`${e.signal} ${n} "left" ? "top" : "bottom"`}}return(45<=t&&t<=135)==("left"===e)?"top":"bottom"}}function xZ(t,e,n){if(void 0===t)return;const i="x"===n,r=i?0:90,s=i?"bottom":"left";if(Xq(t)){const n=vZ(t);return{signal:`(${r?"("+n+" + 90)":n} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${n} && ${n} < ${180+r}) === ${Xq(e)?`(${e.signal} === "${s}")`:e===s} ? "left" : "right"`}}if((t+r)%180==0)return i?null:"center";if(Xq(e)){const n=r<t&&t<180+r?"===":"!==";return{signal:`${e.signal} ${n} "${s}" ? "left" : "right"`}}return(r<t&&t<180+r)==(e===s)?"left":"right"}function wZ(t,e){const n="x"===e?"x2":"y2",i=t.fieldDef(e),r=t.fieldDef(n),s=i?i.title:void 0,o=r?r.title:void 0;return s&&o?_V(s,o):s||o||(void 0!==s?s:void 0!==o?o:void 0)}class AZ extends cY{constructor(t,e){super(t),this.transform=e,this._dependentFields=nZ(this.transform.calculate)}clone(){return new AZ(null,HR(this.transform))}static parseAllForSortIndex(t,e){return e.forEachFieldDef(((e,n)=>{if(LH(e)&&wH(e.sort)){const{field:i,timeUnit:r}=e,s=e.sort,o=s.map(((t,e)=>`${lW({field:i,timeUnit:r,equal:t})} ? ${e} : `)).join("")+s.length;t=new AZ(t,{calculate:o,as:_Z(e,n,{forAs:!0})})}})),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${YR(this.transform)}`}}function _Z(t,e,n){return WH(t,Object.assign({prefix:e,suffix:"sort_index"},null!=n?n:{}))}function kZ(t,e){return ZR(["top","bottom"],e)?"column":ZR(["left","right"],e)||"row"===t?"row":"column"}function CZ(t,e,n,i){const r="row"===i?n.headerRow:"column"===i?n.headerColumn:n.headerFacet;return xL(((null==e?void 0:e.header)||{})[t],r[t],n.header[t])}function EZ(t,e,n,i){const r={};for(const s of t){const t=CZ(s,e,n,i);void 0!==t&&(r[s]=t)}return r}const DZ=["row","column"],FZ=["header","footer"];function SZ(t,e){const n=t.component.layoutHeaders[e].title,i=t.config?t.config:void 0,r=t.component.layoutHeaders[e].facetFieldDef?t.component.layoutHeaders[e].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=EZ(["titleAnchor","titleAngle","titleOrient"],r,i,e),u=kZ(e,a),l=AL(o);return{name:`${e}-title`,type:"group",role:`${u}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===e?{orient:"left"}:{}),{style:"guide-title"}),NZ(l,u)),OZ(u,l,s)),IZ(i,r,e,fZ,cZ))}}function OZ(t,e,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=xZ(e,"row"===t?"left":"top","row"===t?"y":"x");return i?{align:i}:{}}function NZ(t,e){const n=bZ(t,"row"===e?"left":"top","row"===e?"y":"x",!0);return n?{baseline:n}:{}}function MZ(t,e){const n=t.component.layoutHeaders[e],i=[];for(const r of FZ)if(n[r])for(const s of n[r]){const o=TZ(t,e,r,n,s);null!=o&&i.push(o)}return i}function zZ(t,e){var n;const{sort:i}=t;return xH(i)?{field:WH(i,{expr:"datum"}),order:null!==(n=i.order)&&void 0!==n?n:"ascending"}:vR(i)?{field:_Z(t,e,{expr:"datum"}),order:"ascending"}:{field:WH(t,{expr:"datum"}),order:null!=i?i:"ascending"}}function $Z(t,e,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:u}=EZ(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],t,n,e),l=aH({fieldOrDatumDef:t,format:i,formatType:r,expr:"parent",config:n}).signal,c=kZ(e,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?yL(yL(u,"datum.label",l),"datum.value",WH(t,{expr:"parent"})):l}},"row"===e?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),NZ(s,c)),OZ(c,s,o)),IZ(n,t,e,dZ,hZ))}function TZ(t,e,n,i,r){if(r){let s=null;const{facetFieldDef:o}=i,a=t.config?t.config:void 0;if(o&&r.labels){const{labelOrient:t}=EZ(["labelOrient"],o,a,e);("row"===e&&!ZR(["top","bottom"],t)||"column"===e&&!ZR(["left","right"],t))&&(s=$Z(o,e,a))}const u=SQ(t)&&!AH(t.facet),l=r.axes,c=(null==l?void 0:l.length)>0;if(s||c){const a="row"===e?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:t.getName(`${e}_${n}`),type:"group",role:`${e}-${n}`},i.facetFieldDef?{from:{data:t.getName(e+"_domain")},sort:zZ(o,e)}:{}),c&&u?{from:{data:t.getName(`facet_domain_${e}`)}}:{}),s?{title:s}:{}),r.sizeSignal?{encode:{update:{[a]:r.sizeSignal}}}:{}),c?{axes:l}:{})}}return null}const BZ={column:{start:0,end:1},row:{start:1,end:0}};function jZ(t,e){return BZ[e][t]}function IZ(t,e,n,i,r){const s={};for(const o of i){if(!r[o])continue;const i=CZ(o,e,t,n);void 0!==i&&(s[r[o]]=i)}return s}function RZ(t){return[...LZ(t,"width"),...LZ(t,"height"),...LZ(t,"childWidth"),...LZ(t,"childHeight")]}function LZ(t,e){const n="width"===e?"x":"y",i=t.component.layoutSize.get(e);if(!i||"merged"===i)return[];const r=t.getSizeSignalRef(e).signal;if("step"===i){const e=t.getScaleComponent(n);if(e){const i=e.get("type"),s=e.get("range");if($W(i)&&Yq(s)){const i=t.scaleName(n);return SQ(t.parent)&&"independent"===t.parent.component.resolve.scale[n]?[PZ(i,s)]:[PZ(i,s),{name:r,update:UZ(i,e,`domain('${i}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==i){const e=r.endsWith("width"),n=e?"containerSize()[0]":"containerSize()[1]",i=`isFinite(${n}) ? ${n} : ${gG(t.config.view,e?"width":"height")}`;return[{name:r,init:i,on:[{update:i,events:"window:resize"}]}]}return[{name:r,value:i}]}function PZ(t,e){return{name:t+"_step",value:e.step}}function UZ(t,e,n){const i=e.get("type"),r=e.get("padding"),s=xL(e.get("paddingOuter"),r);let o=e.get("paddingInner");return o="band"===i?void 0!==o?o:r:1,`bandspace(${n}, ${o}, ${s}) * ${t}_step`}function qZ(t){return"childWidth"===t?"width":"childHeight"===t?"height":t}function WZ(t,e){return oL(t).reduce(((n,i)=>{const r=t[i];return Object.assign(Object.assign({},n),BX(e,r,i,(t=>Xq(t)?t:{value:t.value})))}),{})}function HZ(t,e){if(NQ(e)||SQ(e))return"shared";if(OQ(e))return NU(t)?"independent":"shared";throw new Error("invalid model type for resolve")}function VZ(t,e){const n=t.scale[e],i=NU(e)?"axis":"legend";return"independent"===n?("shared"===t[i][e]&&Mq(function(t){return`Setting the scale to be independent for "${t}" means we also have to set the guide (axis or legend) to be independent.`}(e)),"independent"):t[i][e]||"shared"}const GZ=Object.assign(Object.assign({},rG),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),XZ=oL(GZ);class YZ extends nX{}const JZ={symbols:function(t,{fieldOrDatumDef:e,model:n,channel:i,legendCmpt:r,legendType:s}){var o,a,u,l,c;if("symbol"!==s)return;const{markDef:h,encoding:f,config:d,mark:p}=n,g=h.filled&&"trail"!==p;let m=Object.assign(Object.assign({},function(t,e,n){for(const i of n){const n=vV(i,e.markDef,e.config);void 0!==n&&(t[i]=dV(n))}return t}({},n,JL)),qX(n,{filled:g}));const y=null!==(o=ZZ(f.opacity))&&void 0!==o?o:h.opacity;if(m.fill)if("fill"===i||g&&i===CP)delete m.fill;else if(m.fill.field)r.get("symbolFillColor")?delete m.fill:(m.fill=dV(null!==(a=d.legend.symbolBaseFillColor)&&void 0!==a?a:"black"),m.fillOpacity=dV(null!=y?y:1));else if(vR(m.fill)){const t=null!==(c=null!==(l=KZ(null!==(u=f.fill)&&void 0!==u?u:f.color))&&void 0!==l?l:h.fill)&&void 0!==c?c:g&&h.color;t&&(m.fill=dV(t))}if(m.stroke)if("stroke"===i||!g&&i===CP)delete m.stroke;else if(m.stroke.field)delete m.stroke;else if(vR(m.stroke)){const t=xL(KZ(f.stroke||f.color),h.stroke,g?h.color:void 0);t&&(m.stroke={value:t})}if(i!==NP){const t=MH(e)&&tK(0,r,e);t?m.opacity=[Object.assign({test:t},dV(null!=y?y:1)),dV(d.legend.unselectedOpacity)]:y&&(m.opacity=dV(y))}return m=Object.assign(Object.assign({},m),t),sL(m)?void 0:m},gradient:function(t,{model:e,legendType:n}){if("gradient"!==n)return;let i={};const r=ZZ(e.encoding.opacity)||e.markDef.opacity;return r&&(i.opacity=dV(r)),i=Object.assign(Object.assign({},i),t),sL(i)?void 0:i},labels:function(t,{fieldOrDatumDef:e,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},o=n.config,a=MH(e)?tK(0,r,e):void 0,u=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=s,h=sH(c)?lH({fieldOrDatumDef:e,field:"datum.value",format:l,formatType:c,config:o}):void 0,f=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),h?{text:h}:{}),t);return sL(f)?void 0:f},entries:function(t,{legendCmpt:e}){const n=e.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},t),{fill:{value:"transparent"}}):t}};function ZZ(t){return QZ(t,((t,e)=>Math.max(t,e.value)))}function KZ(t){return QZ(t,((t,e)=>xL(t,e.value)))}function QZ(t,e){return function(t){const e=t&&t.condition;return!!e&&(vR(e)||RH(e))}(t)?kR(t.condition).reduce(e,t.value):RH(t)?t.value:void 0}function tK(t,e,n){const i=e.get("selections");if(!(null==i?void 0:i.length))return;const r=OR(n.field);return i.map((t=>`(!length(data(${OR(cL(t)+UY)})) || (${t}[${r}] && indexof(${t}[${r}], datum.value) >= 0))`)).join(" || ")}const eK={direction:({direction:t})=>t,format:({fieldOrDatumDef:t,legend:e,config:n})=>{const{format:i,formatType:r}=e;return cH(t,t.type,i,r,n,!1)},formatType:({legend:t,fieldOrDatumDef:e,scaleType:n})=>{const{formatType:i}=t;return hH(i,e,n)},gradientLength:t=>{var e,n;const{legend:i,legendConfig:r}=t;return null!==(n=null!==(e=i.gradientLength)&&void 0!==e?e:r.gradientLength)&&void 0!==n?n:function({legendConfig:t,model:e,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:u}=t;if(BW(r))return"horizontal"===n?"top"===i||"bottom"===i?iK(e,"width",o,s):o:iK(e,"height",u,a)}(t)},labelOverlap:({legend:t,legendConfig:e,scaleType:n})=>{var i,r;return null!==(r=null!==(i=t.labelOverlap)&&void 0!==i?i:e.labelOverlap)&&void 0!==r?r:function(t){if(ZR(["quantile","threshold","log"],t))return"greedy"}(n)},symbolType:({legend:t,markDef:e,channel:n,encoding:i})=>{var r;return null!==(r=t.symbolType)&&void 0!==r?r:function(t,e,n,i){var r;if("shape"!==e){const t=null!==(r=KZ(n))&&void 0!==r?r:i;if(t)return t}switch(t){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(e.type,n,i.shape,e.shape)},title:({fieldOrDatumDef:t,config:e})=>JH(t,e,{allowDisabling:!0}),type:({legendType:t,scaleType:e,channel:n})=>{if(YP(n)&&BW(e)){if("gradient"===t)return}else if("symbol"===t)return;return t},values:({fieldOrDatumDef:t,legend:e})=>function(t,e){const n=t.values;return vR(n)?lV(e,n):Xq(n)?n:void 0}(e,t)};function nK({legendConfig:t,legendType:e,orient:n,legend:i}){var r,s;return null!==(s=null!==(r=i.direction)&&void 0!==r?r:t[e?"gradientDirection":"symbolDirection"])&&void 0!==s?s:function(t,e){switch(t){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===e?"horizontal":void 0}}(n,e)}function iK(t,e,n,i){return{signal:`clamp(${t.getSizeSignalRef(e).signal}, ${n}, ${i})`}}function rK(t){const e=FQ(t)?function(t){const{encoding:e}=t,n={};for(const i of[CP,...nG]){const r=eV(e[i]);r&&t.getScaleComponent(i)&&(i===FP&&MH(r)&&r.type===yW||(n[i]=oK(t,i)))}return n}(t):function(t){const{legends:e,resolve:n}=t.component;for(const i of t.children){rK(i);for(const r of oL(i.component.legends))n.legend[r]=VZ(t.component.resolve,r),"shared"===n.legend[r]&&(e[r]=aK(e[r],i.component.legends[r]),e[r]||(n.legend[r]="independent",delete e[r]))}for(const i of oL(e))for(const e of t.children)e.component.legends[i]&&"shared"===n.legend[i]&&delete e.component.legends[i];return e}(t);return t.component.legends=e,e}function sK(t,e,n,i){switch(e){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===e&&t===(null==i?void 0:i.title))return!0}return t===(n||{})[e]}function oK(t,e){var n,i,r;let s=t.legend(e);const{markDef:o,encoding:a,config:u}=t,l=u.legend,c=new YZ({},function(t,e){const n=t.scaleName(e);if("trail"===t.mark){if("color"===e)return{stroke:n};if("size"===e)return{strokeWidth:n}}return"color"===e?t.markDef.filled?{fill:n}:{stroke:n}:{[e]:n}}(t,e));!function(t,e,n){var i;const r=null===(i=t.fieldDef(e))||void 0===i?void 0:i.field;VY(t,(t=>{var i,s;const o=null!==(i=t.project.hasField[r])&&void 0!==i?i:t.project.hasChannel[e];if(o&&AY.has(t)){const e=null!==(s=n.get("selections"))&&void 0!==s?s:[];e.push(t.name),n.set("selections",e,!1),o.hasLegend=!0}}))}(t,e,c);const h=void 0!==s?!s:l.disable;if(c.set("disable",h,void 0!==s),h)return c;s=s||{};const f=t.getScaleComponent(e).get("type"),d=eV(a[e]),p=MH(d)?null===(n=Gq(d.timeUnit))||void 0===n?void 0:n.unit:void 0,g=s.orient||u.legend.orient||"right",m=function(t){const{legend:e}=t;return xL(e.type,function({channel:t,timeUnit:e,scaleType:n}){if(YP(t)){if(ZR(["quarter","month","day"],e))return"symbol";if(BW(n))return"gradient"}return"symbol"}(t))}({legend:s,channel:e,timeUnit:p,scaleType:f}),y={legend:s,channel:e,model:t,markDef:o,encoding:a,fieldOrDatumDef:d,legendConfig:l,config:u,scaleType:f,orient:g,legendType:m,direction:nK({legend:s,legendType:m,orient:g,legendConfig:l})};for(const n of XZ){const i=n in eK?eK[n](y):s[n];if(void 0!==i){const r=sK(i,n,s,t.fieldDef(e));(r||void 0===u.legend[n])&&c.set(n,i,r)}}const v=null!==(i=null==s?void 0:s.encoding)&&void 0!==i?i:{},b=c.get("selections"),x={},w={fieldOrDatumDef:d,model:t,channel:e,legendCmpt:c,legendType:m};for(const e of["labels","legend","title","symbols","gradient","entries"]){const n=WZ(null!==(r=v[e])&&void 0!==r?r:{},t),i=e in JZ?JZ[e](n,w):n;void 0===i||sL(i)||(x[e]=Object.assign(Object.assign(Object.assign({},(null==b?void 0:b.length)&&MH(d)?{name:`${cL(d.field)}_legend_${e}`}:{}),(null==b?void 0:b.length)?{interactive:!!b}:{}),{update:i}))}return sL(x)||c.set("encode",x,!!(null==s?void 0:s.encoding)),c}function aK(t,e){var n,i,r,s;if(!t)return e.clone();const o=t.getWithExplicit("orient"),a=e.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let u=!1;for(const n of XZ){const i=aX(t.getWithExplicit(n),e.getWithExplicit(n),n,"legend",((t,e)=>{switch(n){case"symbolType":return i=t,"circle"===(r=e).value?r:i;case"title":return kV(t,e);case"type":return u=!0,rX("symbol")}var i,r;return oX(t,e,n,"legend")}));t.setWithExplicit(n,i)}return u&&((null===(i=null===(n=t.implicit)||void 0===n?void 0:n.encode)||void 0===i?void 0:i.gradient)&&fL(t.implicit,["encode","gradient"]),(null===(s=null===(r=t.explicit)||void 0===r?void 0:r.encode)||void 0===s?void 0:s.gradient)&&fL(t.explicit,["encode","gradient"])),t}function uK(t,e,n,i){var r,s,o;t.encode=null!==(r=t.encode)&&void 0!==r?r:{},t.encode[e]=null!==(s=t.encode[e])&&void 0!==s?s:{},t.encode[e].update=null!==(o=t.encode[e].update)&&void 0!==o?o:{},t.encode[e].update[n]=i}function lK(t){const e=t.component.legends,n={};for(const i of oL(e)){const r=t.getScaleComponent(i),s=XR(r.get("domains"));if(n[s])for(const t of n[s])aK(t,e[i])||n[s].push(e[i]);else n[s]=[e[i].clone()]}return aL(n).flat().map((e=>function(t,e){var n,i,r;const s=t.combine(),{disable:o,labelExpr:a,selections:u}=s,l=MR(s,["disable","labelExpr","selections"]);if(!o){if(!1===e.aria&&null==l.aria&&(l.aria=!1),null===(n=l.encode)||void 0===n?void 0:n.symbols){const t=l.encode.symbols.update;!t.fill||"transparent"===t.fill.value||t.stroke||l.stroke||(t.stroke={value:"transparent"});for(const e of nG)l[e]&&delete t[e]}if(l.title||delete l.title,void 0!==a){let t=a;(null===(r=null===(i=l.encode)||void 0===i?void 0:i.labels)||void 0===r?void 0:r.update)&&Xq(l.encode.labels.update.text)&&(t=yL(a,"datum.label",l.encode.labels.update.text.signal)),uK(l,"labels","text",{signal:t})}for(const t in l){const e=l[t];if(Xq(e)){const n=iG[t];if(n){const{vgProp:i,part:r}=n;uK(l,r,i,e),delete l[t]}}}return l}}(e,t.config))).filter((t=>void 0!==t))}function cK(t){const e=t.component.projection;if(!e||e.merged)return[];const n=e.combine(),{name:i}=n;if(e.data){const r={signal:`[${e.size.map((t=>t.signal)).join(", ")}]`},s=e.data.reduce(((e,n)=>{const i=Xq(n)?n.signal:`data('${t.lookupDataSource(n)}')`;return ZR(e,i)||e.push(i),e}),[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const hK=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class fK extends nX{constructor(t,e,n,i){super(Object.assign({},e),{name:t}),this.specifiedProjection=e,this.size=n,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function dK(t){t.component.projection=FQ(t)?function(t){var e;if(t.hasProjection){const n=t.specifiedProjection,i=!(n&&(null!=n.scale||null!=n.translate)),r=i?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:void 0,s=i?function(t){const e=[],{encoding:n}=t;for(const i of[[AP,wP],[kP,_P]])(eV(n[i[0]])||eV(n[i[1]]))&&e.push({signal:t.getName(`geojson_${e.length}`)});return t.channelHasField(FP)&&t.typedFieldDef(FP).type===yW&&e.push({signal:t.getName(`geojson_${e.length}`)}),0===e.length&&e.push(t.requestDataName(mX)),e}(t):void 0;return new fK(t.projectionName(!0),Object.assign(Object.assign({},null!==(e=t.config.projection)&&void 0!==e?e:{}),null!=n?n:{}),r,s)}}(t):function(t){if(0===t.children.length)return;let e;for(const e of t.children)dK(e);const n=QR(t.children,(t=>{const n=t.component.projection;if(n){if(e){const t=function(t,e){const n=QR(hK,(n=>!ER(t.explicit,n)&&!ER(e.explicit,n)||!(!ER(t.explicit,n)||!ER(e.explicit,n)||XR(t.get(n))!==XR(e.get(n)))));if(XR(t.size)===XR(e.size)){if(n)return t;if(XR(t.explicit)===XR({}))return e;if(XR(e.explicit)===XR({}))return t}return null}(e,n);return t&&(e=t),!!t}return e=n,!0}return!0}));if(e&&n){const n=t.projectionName(!0),i=new fK(n,e.specifiedProjection,e.size,HR(e.data));for(const e of t.children){const t=e.component.projection;t&&(t.isFit&&i.data.push(...e.component.projection.data),e.renameProjection(t.get("name"),n),t.merged=!0)}return i}}(t)}function pK(t,e){return`${KU(t)}_${e}`}function gK(t,e,n){var i;const r=pK(null!==(i=sV(n,void 0))&&void 0!==i?i:{},e);return t.getName(`${r}_bins`)}function mK(t,e,n){let i,r;i=function(t){return"as"in t}(t)?SR(t.as)?[t.as,`${t.as}_end`]:[t.as[0],t.as[1]]:[WH(t,{forAs:!0}),WH(t,{binSuffix:"end",forAs:!0})];const s=Object.assign({},sV(e,void 0)),o=pK(s,t.field),{signal:a,extentSignal:u}=function(t,e){return{signal:t.getName(`${e}_bins`),extentSignal:t.getName(`${e}_extent`)}}(n,o);if(nq(s.extent)){const t=s.extent,e=t.selection;r=sZ(n.getSelectionComponent(cL(e),e),t),delete s.extent}return{key:o,binComponent:Object.assign(Object.assign(Object.assign({bin:s,field:t.field,as:[i]},a?{signal:a}:{}),u?{extentSignal:u}:{}),r?{span:r}:{})}}class yK extends cY{constructor(t,e){super(t),this.bins=e}clone(){return new yK(null,HR(this.bins))}static makeFromEncoding(t,e){const n=e.reduceFieldDef(((t,n,i)=>{if(IH(n)&&QU(n.bin)){const{key:r,binComponent:s}=mK(n,n.bin,e);t[r]=Object.assign(Object.assign(Object.assign({},s),t[r]),function(t,e,n,i){var r,s;if(cV(e,n)){const o=FQ(t)&&null!==(s=null!==(r=t.axis(n))&&void 0!==r?r:t.legend(n))&&void 0!==s?s:{},a=WH(e,{expr:"datum"}),u=WH(e,{expr:"datum",binSuffix:"end"});return{formulaAs:WH(e,{binSuffix:"range",forAs:!0}),formula:gH(a,u,o.format,o.formatType,i)}}return{}}(e,n,i,e.config))}return t}),{});return sL(n)?null:new yK(t,n)}static makeFromTransform(t,e,n){const{key:i,binComponent:r}=mK(e,e.bin,n);return new yK(t,{[i]:r})}merge(t,e){for(const n of oL(t.bins))n in this.bins?(e(t.bins[n].signal,this.bins[n].signal),this.bins[n].as=eL([...this.bins[n].as,...t.bins[n].as],YR)):this.bins[n]=t.bins[n];for(const e of t.children)t.removeChild(e),e.parent=this;t.remove()}producedFields(){return new Set(aL(this.bins).map((t=>t.as)).flat(2))}dependentFields(){return new Set(aL(this.bins).map((t=>t.field)))}hash(){return`Bin ${YR(this.bins)}`}assemble(){return aL(this.bins).flatMap((t=>{const e=[],[n,...i]=t.as,r=t.bin,{extent:s}=r,o=MR(r,["extent"]),a=Object.assign(Object.assign(Object.assign({type:"bin",field:mL(t.field),as:n,signal:t.signal},nq(s)?{extent:null}:{extent:s}),t.span?{span:{signal:`span(${t.span})`}}:{}),o);!s&&t.extentSignal&&(e.push({type:"extent",field:mL(t.field),signal:t.extentSignal}),a.extent={signal:t.extentSignal}),e.push(a);for(const t of i)for(let i=0;i<2;i++)e.push({type:"formula",expr:WH({field:n[i]},{expr:"datum"}),as:t[i]});return t.formula&&e.push({type:"formula",expr:t.formula,as:t.formulaAs}),e}))}}class vK extends cY{constructor(t){let e;if(super(null),fX(t=null!=t?t:{name:"source"})||(e=t.format?Object.assign({},GR(t.format,["parse"])):{}),cX(t))this._data={values:t.values};else if(lX(t)){if(this._data={url:t.url},!e.type){let n=/(?:\.([^.]+))?$/.exec(t.url)[1];ZR(["json","csv","tsv","dsv","topojson"],n)||(n="json"),e.type=n}}else pX(t)?this._data={values:[{type:"Sphere"}]}:(hX(t)||fX(t))&&(this._data={});this._generator=fX(t),t.name&&(this._name=t.name),e&&!sL(e)&&(this._data.format=e)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function bK(t){for(const e of t){for(const t of e.children)if(t.parent!==e)return console.error("Dataflow graph is inconsistent.",e,t),!1;if(!bK(e.children))return!1}return!0}class xK extends cY{constructor(t,e){super(t),this.params=e}clone(){return new xK(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${YR(this.params)}`}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class wK extends cY{constructor(t,e){super(t),this.params=e}clone(){return new wK(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([null!==(t=this.params.as)&&void 0!==t?t:"data"])}hash(){return`Hash ${YR(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function AK(t){return t instanceof vK||t instanceof xK||t instanceof wK}class _K{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class kK extends _K{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:t,mutatedFlag:e}){t&&this.setContinue(),e&&this.setMutated()}reset(){}optimizeNextFromLeaves(t){if(AK(t))return!1;const e=t.parent,{continueFlag:n}=this.run(t);return n&&this.optimizeNextFromLeaves(e),this.mutatedFlag}}class CK extends _K{}class EK extends cY{constructor(t,e,n){super(t),this.dimensions=e,this.measures=n}clone(){return new EK(null,new Set(this.dimensions),HR(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,e){let n=!1;e.forEachFieldDef((t=>{t.aggregate&&(n=!0)}));const i={},r=new Set;return n?(e.forEachFieldDef(((t,n)=>{var s,o,a,u;const{aggregate:l,field:c}=t;if(l)if("count"===l)i["*"]=null!==(s=i["*"])&&void 0!==s?s:{},i["*"].count=new Set([WH(t,{forAs:!0})]);else{if(iP(l)||rP(l)){const t=iP(l)?"argmin":"argmax",e=l[t];i[e]=null!==(o=i[e])&&void 0!==o?o:{},i[e][t]=new Set([WH({op:t,field:e},{forAs:!0})])}else i[c]=null!==(a=i[c])&&void 0!==a?a:{},i[c][l]=new Set([WH(t,{forAs:!0})]);GU(n)&&"unaggregated"===e.scaleDomain(n)&&(i[c]=null!==(u=i[c])&&void 0!==u?u:{},i[c].min=new Set([WH({field:c,aggregate:"min"},{forAs:!0})]),i[c].max=new Set([WH({field:c,aggregate:"max"},{forAs:!0})]))}else!function(t,e,n,i){const r=FQ(i)?i.encoding[dU(e)]:void 0;if(IH(n)&&FQ(i)&&FH(e,n,r,i.stack,i.markDef,i.config))t.add(WH(n,{})),t.add(WH(n,{suffix:"end"})),n.bin&&cV(n,e)&&t.add(WH(n,{binSuffix:"range"}));else if(e in VP){const n=function(t){switch(t){case wP:return"y";case _P:return"y2";case AP:return"x";case kP:return"x2"}}(e);t.add(i.getName(n))}else t.add(WH(n))}(r,n,t,e)})),r.size+oL(i).length===0?null:new EK(t,r,i)):null}static makeFromTransform(t,e){var n,i,r;const s=new Set,o={};for(const t of e.aggregate){const{op:e,field:r,as:s}=t;e&&("count"===e?(o["*"]=null!==(n=o["*"])&&void 0!==n?n:{},o["*"].count=new Set([s||WH(t,{forAs:!0})])):(o[r]=null!==(i=o[r])&&void 0!==i?i:{},o[r][e]=new Set([s||WH(t,{forAs:!0})])))}for(const t of null!==(r=e.groupby)&&void 0!==r?r:[])s.add(t);return s.size+oL(o).length===0?null:new EK(t,s,o)}merge(t){return function(t,e){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}(this.dimensions,t.dimensions)?(function(t,e){var n;for(const i of oL(e)){const r=e[i];for(const e of oL(r))i in t?t[i][e]=new Set([...null!==(n=t[i][e])&&void 0!==n?n:[],...r[e]]):t[i]={[e]:r[e]}}}(this.measures,t.measures),!0):(function(...t){Nq.debug(...t)}("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...oL(this.measures)])}producedFields(){const t=new Set;for(const e of oL(this.measures))for(const n of oL(this.measures[e])){const i=this.measures[e][n];0===i.size?t.add(`${n}_${e}`):i.forEach(t.add,t)}return t}hash(){return`Aggregate ${YR({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],e=[],n=[];for(const i of oL(this.measures))for(const r of oL(this.measures[i]))for(const s of this.measures[i][r])n.push(s),t.push(r),e.push("*"===i?null:mL(i));return{type:"aggregate",groupby:[...this.dimensions].map(mL),ops:t,fields:e,as:n}}}class DK extends cY{constructor(t,e,n,i){super(t),this.model=e,this.name=n,this.data=i;for(const t of ZP){const n=e.facet[t];if(n){const{bin:i,sort:r}=n;this[t]=Object.assign({name:e.getName(`${t}_domain`),fields:[WH(n),...QU(i)?[WH(n,{binSuffix:"end"})]:[]]},xH(r)?{sortField:r}:vR(r)?{sortIndexField:_Z(n,t)}:{})}}this.childModel=e.child}hash(){let t="Facet";for(const e of ZP)this[e]&&(t+=` ${e.charAt(0)}:${YR(this[e])}`);return t}get fields(){var t;const e=[];for(const n of ZP)(null===(t=this[n])||void 0===t?void 0:t.fields)&&e.push(...this[n].fields);return e}dependentFields(){const t=new Set(this.fields);for(const e of ZP)this[e]&&(this[e].sortField&&t.add(this[e].sortField.field),this[e].sortIndexField&&t.add(this[e].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const e of OU){const n=this.childModel.component.scales[e];if(n&&!n.merged){const i=n.get("type"),r=n.get("range");if($W(i)&&Yq(r)){const n=uQ(lQ(this.childModel,e));n?t[e]=n:Mq(`Unknown field for ${e}. Cannot calculate view size.`)}}}return t}assembleRowColumnHeaderData(t,e,n){const i={row:"y",column:"x"}[t],r=[],s=[],o=[];n&&n[i]&&(e?(r.push(`distinct_${n[i]}`),s.push("max")):(r.push(n[i]),s.push("distinct")),o.push(`distinct_${n[i]}`));const{sortField:a,sortIndexField:u}=this[t];if(a){const{op:t=mH,field:e}=a;r.push(e),s.push(t),o.push(WH(a,{forAs:!0}))}else u&&(r.push(u),s.push("max"),o.push(u));return{name:this[t].name,source:null!=e?e:this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},r.length?{fields:r,ops:s,as:o}:{})]}}assembleFacetHeaderData(t){var e,n;const{columns:i}=this.model.layout,{layoutHeaders:r}=this.model.component,s=[],o={};for(const t of DZ){for(const i of FZ){const s=null!==(e=r[t]&&r[t][i])&&void 0!==e?e:[];for(const e of s)if((null===(n=e.axes)||void 0===n?void 0:n.length)>0){o[t]=!0;break}}if(o[t]){const e=`length(data("${this.facet.name}"))`,n="row"===t?i?{signal:`ceil(${e} / ${i})`}:1:i?{signal:`min(${e}, ${i})`}:{signal:e};s.push({name:`${this.facet.name}_${t}`,transform:[{type:"sequence",start:0,stop:n}]})}}const{row:a,column:u}=o;return(a||u)&&s.unshift(this.assembleRowColumnHeaderData("facet",null,t)),s}assemble(){var t,e;const n=[];let i=null;const r=this.getChildIndependentFieldsWithStep(),{column:s,row:o,facet:a}=this;if(s&&o&&(r.x||r.y)){i=`cross_${this.column.name}_${this.row.name}`;const s=[].concat(null!==(t=r.x)&&void 0!==t?t:[],null!==(e=r.y)&&void 0!==e?e:[]),o=s.map((()=>"distinct"));n.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:s,ops:o}]})}for(const t of[hP,cP])this[t]&&n.push(this.assembleRowColumnHeaderData(t,i,r));if(a){const t=this.assembleFacetHeaderData(r);t&&n.push(...t)}return n}}function FK(t){return"'"===t[0]&&"'"===t[t.length-1]||'"'===t[0]&&'"'===t[t.length-1]?t.slice(1,-1):t}function SK(t){const e={};return UR(t.filter,(t=>{var n;if(aW(t)){let i=null;tW(t)?i=t.equal:sW(t)?i=t.range[0]:oW(t)&&(i=(null!==(n=t.oneOf)&&void 0!==n?n:t.in)[0]),i&&(zq(i)?e[t.field]="date":FR(i)?e[t.field]="number":SR(i)&&(e[t.field]="string")),t.timeUnit&&(e[t.field]="date")}})),e}class OK extends cY{constructor(t,e){super(t),this._parse=e}clone(){return new OK(null,HR(this._parse))}hash(){return`Parse ${YR(this._parse)}`}static makeExplicit(t,e,n){let i={};const r=e.data;return!fX(r)&&r&&r.format&&r.format.parse&&(i=r.format.parse),this.makeWithAncestors(t,i,{},n)}static makeWithAncestors(t,e,n,i){for(const t of oL(n)){const e=i.getWithExplicit(t);void 0!==e.value&&(e.explicit||e.value===n[t]||"derived"===e.value||"flatten"===n[t]?delete n[t]:Mq(fq(t,n[t],e.value)))}for(const t of oL(e)){const n=i.get(t);void 0!==n&&(n===e[t]?delete e[t]:Mq(fq(t,e[t],n)))}const r=new nX(e,n);i.copyAll(r);const s={};for(const t of oL(r.combine())){const e=r.get(t);null!==e&&(s[t]=e)}return 0===oL(s).length||i.parseNothing?null:new OK(t,s)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const e of oL(this._parse)){const n=this._parse[e];1===bL(e)&&(t[e]=n)}return t}producedFields(){return new Set(oL(this._parse))}dependentFields(){return new Set(oL(this._parse))}assembleTransforms(t=!1){return oL(this._parse).filter((e=>!t||bL(e)>1)).map((t=>{const e=function(t,e){const n=pL(t);return"number"===e?`toNumber(${n})`:"boolean"===e?`toBoolean(${n})`:"string"===e?`toString(${n})`:"date"===e?`toDate(${n})`:"flatten"===e?n:0===e.indexOf("date:")?`timeParse(${n},'${FK(e.slice(5,e.length))}')`:0===e.indexOf("utc:")?`utcParse(${n},'${FK(e.slice(4,e.length))}')`:(Mq(`Unrecognized parse "${e}".`),null)}(t,this._parse[t]);return e?{type:"formula",expr:e,as:vL(t)}:null})).filter((t=>null!==t))}}class NK extends cY{clone(){return new NK(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([sG])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:sG}}}class MK extends cY{constructor(t,e){super(t),this.transform=e}clone(){return new MK(null,HR(this.transform))}addDimensions(t){this.transform.groupby=eL(this.transform.groupby.concat(t),(t=>t))}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map((t=>t.field)).filter((t=>void 0!==t)).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var e;return null!==(e=t.as)&&void 0!==e?e:WH(t)}hash(){return`JoinAggregateTransform ${YR(this.transform)}`}assemble(){const t=[],e=[],n=[];for(const i of this.transform.joinaggregate)e.push(i.op),n.push(this.getDefaultName(i)),t.push(void 0===i.field?null:i.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:e,fields:t},void 0!==i?{groupby:i}:{})}}class zK extends cY{constructor(t,e){super(t),this._stack=e}clone(){return new zK(null,HR(this._stack))}static makeFromTransform(t,e){const{stack:n,groupby:i,as:r,offset:s="zero"}=e,o=[],a=[];if(void 0!==e.sort)for(const t of e.sort)o.push(t.field),a.push(xL(t.order,"ascending"));const u={field:o,order:a};let l;return l=function(t){return vR(t)&&t.every((t=>SR(t)))&&t.length>1}(r)?r:SR(r)?[r,r+"_end"]:[e.stack+"_start",e.stack+"_end"],new zK(t,{stackField:n,groupby:i,offset:s,sort:u,facetby:[],as:l})}static makeFromEncoding(t,e){const n=e.stack,{encoding:i}=e;if(!n)return null;const{groupbyChannel:r,fieldChannel:s,offset:o,impute:a}=n;let u;r&&(u=tV(i[r]));const l=function(t){return t.stack.stackBy.reduce(((t,e)=>{const n=WH(e.fieldDef);return n&&t.push(n),t}),[])}(e),c=e.encoding.order;let h;return h=vR(c)||MH(c)?wV(c):l.reduce(((t,e)=>(t.field.push(e),t.order.push("y"===s?"descending":"ascending"),t)),{field:[],order:[]}),new zK(t,{dimensionFieldDef:u,stackField:e.vgField(s),facetby:[],stackby:l,sort:h,offset:o,impute:a,as:[e.vgField(s,{suffix:"start",forAs:!0}),e.vgField(s,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${YR(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:e,groupby:n}=this._stack;return t?t.bin?e?[WH(t,{binSuffix:"mid"})]:[WH(t,{}),WH(t,{binSuffix:"end"})]:[WH(t)]:null!=n?n:[]}assemble(){const t=[],{facetby:e,dimensionFieldDef:n,stackField:i,stackby:r,sort:s,offset:o,impute:a,as:u}=this._stack;if(a&&n){const{band:s=.5,bin:o}=n;o&&t.push({type:"formula",expr:`${s}*`+WH(n,{expr:"datum"})+`+${1-s}*`+WH(n,{expr:"datum",binSuffix:"end"}),as:WH(n,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:i,groupby:[...r,...e],key:WH(n,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...e],field:i,sort:s,as:u,offset:o}),t}}class $K extends cY{constructor(t,e){super(t),this.transform=e}clone(){return new $K(null,HR(this.transform))}addDimensions(t){this.transform.groupby=eL(this.transform.groupby.concat(t),(t=>t))}dependentFields(){var t,e;const n=new Set;return(null!==(t=this.transform.groupby)&&void 0!==t?t:[]).forEach(n.add,n),(null!==(e=this.transform.sort)&&void 0!==e?e:[]).forEach((t=>n.add(t.field))),this.transform.window.map((t=>t.field)).filter((t=>void 0!==t)).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var e;return null!==(e=t.as)&&void 0!==e?e:WH(t)}hash(){return`WindowTransform ${YR(this.transform)}`}assemble(){var t;const e=[],n=[],i=[],r=[];for(const t of this.transform.window)n.push(t.op),i.push(this.getDefaultName(t)),r.push(void 0===t.param?null:t.param),e.push(void 0===t.field?null:t.field);const s=this.transform.frame,o=this.transform.groupby;if(s&&null===s[0]&&null===s[1]&&n.every((t=>sP(t))))return Object.assign({type:"joinaggregate",as:i,ops:n,fields:e},void 0!==o?{groupby:o}:{});const a=[],u=[];if(void 0!==this.transform.sort)for(const e of this.transform.sort)a.push(e.field),u.push(null!==(t=e.order)&&void 0!==t?t:"ascending");const l={field:a,order:u},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:r,as:i,ops:n,fields:e,sort:l},void 0!==c?{ignorePeers:c}:{}),void 0!==o?{groupby:o}:{}),void 0!==s?{frame:s}:{})}}class TK extends kK{run(t){const e=t.parent;if(t instanceof OK){if(AK(e))return this.flags;if(e.numChildren()>1)return this.setContinue(),this.flags;if(e instanceof OK)this.setMutated(),e.merge(t);else{if(rL(e.producedFields(),t.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),t.swapWithParent()}}return this.setContinue(),this.flags}}class BK extends CK{mergeNodes(t,e){const n=e.shift();for(const i of e)t.removeChild(i),i.parent=n,i.remove()}run(t){const e=t.children.map((t=>t.hash())),n={};for(let i=0;i<e.length;i++)void 0===n[e[i]]?n[e[i]]=[t.children[i]]:n[e[i]].push(t.children[i]);for(const e of oL(n))n[e].length>1&&(this.setMutated(),this.mergeNodes(t,n[e]));for(const e of t.children)this.run(e);return this.mutatedFlag}}class jK extends kK{run(t){return t instanceof hY||t.numChildren()>0||t instanceof DK||(this.setMutated(),t.remove()),this.flags}}class IK extends kK{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(t){if(this.setContinue(),t instanceof fY){const e=t.producedFields();nL(e,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...e]),this.prev=t}return this.flags}reset(){this.fields.clear()}}class RK extends kK{run(t){this.setContinue();const e=t.parent.children.filter((t=>t instanceof fY)),n=e.pop();for(const t of e)this.setMutated(),n.merge(t);return this.flags}}function LK(t){if(t instanceof DK)if(1!==t.numChildren()||t.children[0]instanceof hY){const n=t.model.component.data.main;PK(n);const i=(e=t,function t(n){if(!(n instanceof DK)){const i=n.clone();if(i instanceof hY){const t=XK+i.getSource();i.setSource(t),e.model.component.data.outputNodes[t]=i}else(i instanceof EK||i instanceof zK||i instanceof $K||i instanceof MK)&&i.addDimensions(e.fields);for(const e of n.children.flatMap(t))e.parent=i;return[i]}return n.children.flatMap(t)}),r=t.children.map(i).flat();for(const t of r)t.parent=n}else{const e=t.children[0];(e instanceof EK||e instanceof zK||e instanceof $K||e instanceof MK)&&e.addDimensions(t.fields),e.swapWithParent(),LK(t)}else t.children.map(LK);var e}function PK(t){if(t instanceof hY&&t.type===mX&&1===t.numChildren()){const e=t.children[0];e instanceof DK||(e.swapWithParent(),PK(t))}}class UK extends CK{constructor(){super()}run(t){t instanceof hY&&!t.isRequired()&&(this.setMutated(),t.remove());for(const e of t.children)this.run(e);return this.mutatedFlag}}class qK extends CK{constructor(t){super(),this.requiresSelectionId=t&&XY(t)}run(t){t instanceof NK&&(this.requiresSelectionId&&(AK(t.parent)||t.parent instanceof EK||t.parent instanceof OK)||(this.setMutated(),t.remove()));for(const e of t.children)this.run(e);return this.mutatedFlag}}class WK extends kK{run(t){const e=t.parent,n=[...e.children],i=e.children.filter((t=>t instanceof OK));if(e.numChildren()>1&&i.length>=1){const t={},r=new Set;for(const e of i){const n=e.parse;for(const e of oL(n))e in t?t[e]!==n[e]&&r.add(e):t[e]=n[e]}for(const e of r)delete t[e];if(!sL(t)){this.setMutated();const i=new OK(e,t);for(const r of n){if(r instanceof OK)for(const e of oL(t))delete r.parse[e];e.removeChild(r),r.parent=i,r instanceof OK&&0===oL(r.parse).length&&r.remove()}}}return this.setContinue(),this.flags}}class HK extends kK{run(t){const e=t.parent,n=e.children.filter((t=>t instanceof EK)),i={};for(const t of n){const e=YR(t.groupBy);e in i||(i[e]=[]),i[e].push(t)}for(const t of oL(i)){const n=i[t];if(n.length>1){const t=n.pop();for(const i of n)t.merge(i)&&(e.removeChild(i),i.parent=t,i.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class VK extends kK{constructor(t){super(),this.model=t}run(t){const e=t.parent,n=!(AK(e)||e instanceof iZ||e instanceof OK||e instanceof NK),i=[],r=[];for(const t of e.children)t instanceof yK&&(n&&!rL(e.producedFields(),t.dependentFields())?i.push(t):r.push(t));if(i.length>0){const t=i.pop();for(const e of i)t.merge(e,this.model.renameSignal.bind(this.model));this.setMutated(),e instanceof yK?e.merge(t,this.model.renameSignal.bind(this.model)):t.swapWithParent()}if(r.length>1){const t=r.pop();for(const e of r)t.merge(e,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class GK extends kK{run(t){const e=t.parent,n=[...e.children];if(!KR(n,(t=>t instanceof hY))||e.numChildren()<=1)return this.setContinue(),this.flags;const i=[];let r;for(const t of n)if(t instanceof hY){let n=t;for(;1===n.numChildren();){const t=n.children[0];if(!(t instanceof hY))break;n=t}i.push(...n.children),r?(e.removeChild(t),t.parent=r.parent,r.parent.removeChild(r),r.parent=n,this.setMutated()):r=n}else i.push(t);if(i.length){this.setMutated();for(const t of i)t.parent.removeChild(t),t.parent=r}return this.setContinue(),this.flags}}const XK="scale_";function YK(t){const e=[];function n(t){if(0===t.numChildren())e.push(t);else for(const e of t.children)n(e)}for(const e of t)n(e);return e}function JK(t){return t}function ZK(t,e){return e.map((e=>{if(t instanceof kK){const n=t.optimizeNextFromLeaves(e);return t.reset(),n}return t.run(e)})).some(JK)}function KK(t,e){let n=t.sources;const i=new Set;return i.add(ZK(new UK,n)),i.add(ZK(new qK(e),n)),n=n.filter((t=>t.numChildren()>0)),i.add(ZK(new jK,YK(n))),n=n.filter((t=>t.numChildren()>0)),i.add(ZK(new TK,YK(n))),i.add(ZK(new VK(e),YK(n))),i.add(ZK(new IK,YK(n))),i.add(ZK(new WK,YK(n))),i.add(ZK(new HK,YK(n))),i.add(ZK(new RK,YK(n))),i.add(ZK(new BK,n)),i.add(ZK(new GK,YK(n))),t.sources=n,i.has(!0)}class QK{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,e){return new QK((()=>t(e)))}}function tQ(t){FQ(t)?function(t){const e=t.component.scales;for(const n of oL(e)){const i=eQ(t,n);if(e[n].setWithExplicit("domains",i),sQ(t,n),t.component.data.isFaceted){let e=t;for(;!SQ(e)&&e.parent;)e=e.parent;if("shared"===e.component.resolve.scale[n])for(const t of i.value)Jq(t)&&(t.data=XK+t.data.replace(XK,""))}}}(t):function(t){for(const e of t.children)tQ(e);const e=t.component.scales;for(const n of oL(e)){let i,r=null;for(const e of t.children){const t=e.component.scales[n];if(t){i=void 0===i?t.getWithExplicit("domains"):aX(i,t.getWithExplicit("domains"),"domains","scale",aQ);const e=t.get("selectionExtent");r&&e&&r.selection!==e.selection&&Mq("The same selection must be used to override scale domains in a layered view."),r=e}}e[n].setWithExplicit("domains",i),r&&e[n].set("selectionExtent",r,!0)}}(t)}function eQ(t,e){const n=t.getScaleComponent(e).get("type"),{encoding:i}=t,r=function(t,e,n,i){if("unaggregated"===t){const{valid:t,reason:i}=oQ(e,n);if(!t)return void Mq(i)}else if(void 0===t&&i.useUnaggregatedDomain){const{valid:t}=oQ(e,n);if(t)return"unaggregated"}return t}(t.scaleDomain(e),t.typedFieldDef(e),n,t.config.scale);return r!==t.scaleDomain(e)&&(t.specifiedScales[e]=Object.assign(Object.assign({},t.specifiedScales[e]),{domain:r})),"x"===e&&eV(i.x2)?eV(i.x)?aX(iQ(n,r,t,"x"),iQ(n,r,t,"x2"),"domain","scale",aQ):iQ(n,r,t,"x2"):"y"===e&&eV(i.y2)?eV(i.y)?aX(iQ(n,r,t,"y"),iQ(n,r,t,"y2"),"domain","scale",aQ):iQ(n,r,t,"y2"):iQ(n,r,t,e)}function nQ(t,e,n){var i;const r=null===(i=Gq(n))||void 0===i?void 0:i.unit;return"temporal"===e||r?function(t,e,n){return t.map((t=>({signal:`{data: ${uV(t,{timeUnit:n,type:e})}}`})))}(t,e,r):[t]}function iQ(t,e,n,i){const{encoding:r}=n,s=eV(r[i]),{type:o}=s,a=s.timeUnit;if(function(t){return t&&t.unionWith}(e)){const r=iQ(t,void 0,n,i),s=nQ(e.unionWith,o,a);return iX([...r.value,...s])}if(Xq(e))return iX([e]);if(e&&"unaggregated"!==e&&!IW(e))return iX(nQ(e,o,a));const u=n.stack;if(u&&i===u.fieldChannel){if("normalize"===u.offset)return rX([[0,1]]);const t=n.requestDataName(mX);return rX([{data:t,field:n.vgField(i,{suffix:"start"})},{data:t,field:n.vgField(i,{suffix:"end"})}])}const l=GU(i)&&MH(s)?function(t,e,n){if(!$W(n))return;const i=t.fieldDef(e),r=i.sort;if(wH(r))return{op:"min",field:_Z(i,e),order:"ascending"};const{stack:s}=t,o=s?[...s.groupbyField?[s.groupbyField]:[],...s.stackBy.map((t=>t.fieldDef.field))]:void 0;if(xH(r))return rQ(r,s&&!ZR(o,r.field));if(bH(r)){const{encoding:e,order:n}=r,i=t.fieldDef(e),{aggregate:a,field:u}=i,l=s&&!ZR(o,u);if(iP(a)||rP(a))return rQ({field:WH(i),order:n},l);if(sP(a)||!a)return rQ({op:a,field:u,order:n},l)}else{if("descending"===r)return{op:"min",field:t.vgField(e),order:"descending"};if(ZR(["ascending",void 0],r))return!0}}(n,i,t):void 0;if($H(s))return rX(nQ([s.datum],o,a));const c=s;if("unaggregated"===e){const t=n.requestDataName(mX),{field:e}=s;return rX([{data:t,field:WH({field:e,aggregate:"min"})},{data:t,field:WH({field:e,aggregate:"max"})}])}if(QU(c.bin)){if($W(t))return rX("bin-ordinal"===t?[]:[{data:lL(l)?n.requestDataName(mX):n.requestDataName(yX),field:n.vgField(i,cV(c,i)?{binSuffix:"range"}:{}),sort:!0!==l&&bR(l)?l:{field:n.vgField(i,{}),op:"min"}}]);{const{bin:t}=c;if(QU(t)){const e=gK(n,c.field,t);return rX([new QK((()=>{const t=n.getSignalName(e);return`[${t}.start, ${t}.stop]`}))])}return rX([{data:n.requestDataName(mX),field:n.vgField(i,{})}])}}if(c.timeUnit&&ZR(["time","utc"],t)&&FH(i,c,FQ(n)?n.encoding[dU(i)]:void 0,n.stack,n.markDef,n.config)){const t=n.requestDataName(mX);return rX([{data:t,field:n.vgField(i)},{data:t,field:n.vgField(i,{suffix:"end"})}])}return rX(l?[{data:lL(l)?n.requestDataName(mX):n.requestDataName(yX),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(mX),field:n.vgField(i)}])}function rQ(t,e){const{op:n,field:i,order:r}=t;return Object.assign(Object.assign({op:null!=n?n:e?"sum":mH},i?{field:mL(i)}:{}),r?{order:r}:{})}function sQ(t,e){var n;const i=t.component.scales[e],r=t.specifiedScales[e].domain,s=null===(n=t.fieldDef(e))||void 0===n?void 0:n.bin,o=IW(r)&&r,a=eq(s)&&nq(s.extent)&&s.extent;(o||a)&&i.set("selectionExtent",null!=o?o:a,!0)}function oQ(t,e){const{aggregate:n,type:i}=t;return n?SR(n)&&!lP[n]?{valid:!1,reason:wq(n)}:"quantitative"===i&&"log"===e?{valid:!1,reason:Aq(t)}:{valid:!0}:{valid:!1,reason:xq(t)}}function aQ(t,e,n,i){return t.explicit&&e.explicit&&Mq(function(t,e,n,i){return`Conflicting ${e.toString()} property "${t.toString()}" (${XR(n)} and ${XR(i)}). Using the union of the two domains.`}(n,i,t.value,e.value)),{explicit:t.explicit,value:[...t.value,...e.value]}}function uQ(t){if(Jq(t)&&SR(t.field))return t.field;if(function(t){return!vR(t)&&"fields"in t&&!("data"in t)}(t)){let e;for(const n of t.fields)if(Jq(n)&&SR(n.field))if(e){if(e!==n.field)return Mq("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),e}else e=n.field;return Mq("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),e}if(function(t){return!vR(t)&&"fields"in t&&"data"in t}(t)){Mq("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const e=t.fields[0];return SR(e)?e:void 0}}function lQ(t,e){return function(t){const e=eL(t.map((t=>{if(Jq(t)){const{sort:e}=t;return MR(t,["sort"])}return t})),YR),n=eL(t.map((t=>{if(Jq(t)){const e=t.sort;return void 0===e||lL(e)||("op"in e&&"count"===e.op&&delete e.field,"ascending"===e.order&&delete e.order),e}})).filter((t=>void 0!==t)),YR);if(0===e.length)return;if(1===e.length){const e=t[0];if(Jq(e)&&n.length>0){let t=n[0];if(n.length>1)Mq(Cq),t=!0;else if(bR(t)&&"field"in t){const n=t.field;e.field===n&&(t=!t.order||{order:t.order})}return Object.assign(Object.assign({},e),{sort:t})}return e}const i=eL(n.map((t=>lL(t)||!("op"in t)||t.op in nP?t:(Mq(function(t){return`Dropping sort property ${XR(t)} as unioned domains only support boolean or op "count", "min", and "max".`}(t)),!0))),YR);let r;1===i.length?r=i[0]:i.length>1&&(Mq(Cq),r=!0);const s=eL(t.map((t=>Jq(t)?t.data:null)),(t=>t));return 1===s.length&&null!==s[0]?Object.assign({data:s[0],fields:e.map((t=>t.field))},r?{sort:r}:{}):Object.assign({fields:e},r?{sort:r}:{})}(t.component.scales[e].get("domains").map((e=>(Jq(e)&&(e.data=t.lookupDataSource(e.data)),e))))}function cQ(t){return NQ(t)||OQ(t)?t.children.reduce(((t,e)=>t.concat(cQ(e))),hQ(t)):hQ(t)}function hQ(t){return oL(t.component.scales).reduce(((e,n)=>{const i=t.component.scales[n];if(i.merged)return e;const r=i.combine(),{name:s,type:o,selectionExtent:a,domains:u,range:l,reverse:c}=r,h=MR(r,["name","type","selectionExtent","domains","range","reverse"]),f=function(t,e,n){return NU(n)&&Yq(t)?{step:{signal:e+"_step"}}:t}(r.range,s,n);let d;a&&(d=function(t,e){const n=e.selection;return{signal:sZ(t.getSelectionComponent(n,cL(n)),e)}}(t,a));const p=lQ(t,n);return e.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},p?{domain:p}:{}),d?{domainRaw:d}:{}),{range:f}),void 0!==c?{reverse:c}:{}),h)),e}),[])}class fQ extends nX{constructor(t,e){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",e)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||KR(this.get("domains"),(t=>vR(t)&&2===t.length&&t[0]<=0&&t[1]>=0))}}const dQ=["range","scheme"];function pQ(t){return"x"===t?"width":"y"===t?"height":void 0}function gQ(t,e){const n=t.fieldDef(e);if(n&&n.bin&&QU(n.bin)){const i=gK(t,n.field,n.bin),r=pQ(e),s=t.getName(r);return new QK((()=>{const e=t.getSignalName(i),n=`(${e}.stop - ${e}.start) / ${e}.step`;return`${t.getSignalName(s)} / (${n})`}))}}function mQ(t,e){const n=e.specifiedScales[t],{size:i}=e,r=e.getScaleComponent(t).get("type");for(const i of dQ)if(void 0!==n[i]){const s=VW(r,i),o=GW(t,i);if(s)if(o)Mq(o);else switch(i){case"range":return vR(n.range)&&NU(t)?iX(n.range.map((t=>{if("width"===t||"height"===t){const n=e.getName(t),i=e.getSignalName.bind(e);return QK.fromName(i,n)}return t}))):iX(n.range);case"scheme":return iX(yQ(n[i]))}else Mq(_q(r,i,t))}if(t===dP||t===pP){const e=t===dP?"width":"height",n=i[e];if(fG(n)){if($W(r))return iX({step:n.step});Mq(kq(e))}}return rX(function(t,e){const{size:n,config:i,mark:r,encoding:s}=e,o=e.getSignalName.bind(e),{type:a}=eV(s[t]),u=e.getScaleComponent(t).get("type"),{domain:l,domainMid:c}=e.specifiedScales[t];switch(t){case dP:case pP:{if(ZR(["point","band"],u))if(t!==dP||n.width){if(t===pP&&!n.height){const t=yG(i.view,"height");if(fG(t))return t}}else{const t=yG(i.view,"width");if(fG(t))return t}const r=pQ(t),s=e.getName(r);return t===pP&&TW(u)?[QK.fromName(o,s),0]:[0,QK.fromName(o,s)]}case SP:{const s=vQ(r,e.component.scales[t].get("zero"),i),o=function(t,e,n,i){const r={x:gQ(n,"x"),y:gQ(n,"y")};switch(t){case"bar":case"tick":{if(void 0!==i.scale.maxBandSize)return i.scale.maxBandSize;const t=xQ(e,r,i.view);return FR(t)?t-1:new QK((()=>`${t.signal} - 1`))}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const t=xQ(e,r,i.view);return FR(t)?Math.pow(bQ*t,2):new QK((()=>`pow(0.95 * ${t.signal}, 2)`))}}throw new Error(yq("size",t))}(r,n,e,i);return jW(u)?function(t,e,n){const i=()=>{const i=gV(e),r=gV(t),s=`(${i} - ${r}) / (${n} - 1)`;return`sequence(${r}, ${i} + ${s}, ${s})`};return Xq(e)?new QK(i):{signal:i()}}(s,o,function(t,e,n,i){switch(t){case"quantile":return e.scale.quantileCount;case"quantize":return e.scale.quantizeCount;case"threshold":return void 0!==n&&vR(n)?n.length+1:(Mq(function(t){return`Domain for ${t} is required for threshold scale.`}(i)),3)}}(u,i,l,t)):[s,o]}case bP:return[0,2*Math.PI];case OP:return[0,360];case yP:return[0,new QK((()=>`min(${e.getSignalName("width")},${e.getSignalName("height")})/2`))];case $P:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case TP:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case FP:return"symbol";case CP:case EP:case DP:return"ordinal"===u?"nominal"===a?"category":"ordinal":void 0!==c?"diverging":"rect"===r||"geoshape"===r?"heatmap":"ramp";case NP:case MP:case zP:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${t}`)}(t,e))}function yQ(t){return function(t){return!SR(t)&&!!t.name}(t)?Object.assign({scheme:t.name},GR(t,["name"])):{scheme:t}}function vQ(t,e,n){if(e)return Xq(e)?{signal:`${e.signal} ? 0 : ${vQ(t,!1,n)}`}:0;switch(t){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(yq("size",t))}const bQ=.95;function xQ(t,e,n){const i=fG(t.width)?t.width.step:mG(n,"width"),r=fG(t.height)?t.height.step:mG(n,"height");return e.x||e.y?new QK((()=>`min(${[e.x?e.x.signal:i,e.y?e.y.signal:r].join(", ")})`)):Math.min(i,r)}function wQ(t,e){FQ(t)?function(t,e){const n=t.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:o}=t;for(const a of oL(n)){const u=o[a],l=n[a],c=t.getScaleComponent(a),h=eV(r[a]),f=u[e],d=c.get("type"),p=c.get("padding"),g=c.get("paddingInner"),m=VW(d,e),y=GW(a,e);if(void 0!==f&&(m?y&&Mq(y):Mq(_q(d,e,a))),m&&void 0===y)if(void 0!==f)l.copyKeyFromObject(e,u);else{const n=e in AQ?AQ[e]({model:t,channel:a,fieldOrDatumDef:h,scaleType:d,scalePadding:p,scalePaddingInner:g,domain:u.domain,markDef:s,config:i}):i.scale[e];void 0!==n&&l.set(e,n,!1)}}}(t,e):kQ(t,e)}const AQ={bins:({model:t,fieldOrDatumDef:e})=>MH(e)?function(t,e){const n=e.bin;if(QU(n)){const i=gK(t,e.field,n);return new QK((()=>t.getSignalName(i)))}if(tq(n)&&eq(n)&&void 0!==n.step)return{step:n.step}}(t,e):void 0,interpolate:({channel:t,fieldOrDatumDef:e})=>function(t,e){if(ZR([CP,EP,DP],t)&&"nominal"!==e)return"hcl"}(t,e.type),nice:({scaleType:t,channel:e,fieldOrDatumDef:n})=>function(t,e,n){var i;if(!(null===(i=tV(n))||void 0===i?void 0:i.bin)&&!ZR([xW,wW],t))return e in SU||void 0}(t,e,n),padding:({channel:t,scaleType:e,fieldOrDatumDef:n,markDef:i,config:r})=>function(t,e,n,i,r,s){if(t in SU){if(BW(e)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:e,orient:o}=r;if("bar"===e&&(!MH(i)||!i.bin&&!i.timeUnit)&&("vertical"===o&&"x"===t||"horizontal"===o&&"y"===t))return s.continuousBandSize}if(e===AW)return n.pointPadding}}(t,e,r.scale,n,i,r.bar),paddingInner:({scalePadding:t,channel:e,markDef:n,config:i})=>function(t,e,n,i){if(void 0===t&&e in SU){const{bandPaddingInner:t,barBandPaddingInner:e,rectBandPaddingInner:r}=i;return xL(t,"bar"===n?e:r)}}(t,e,n.type,i.scale),paddingOuter:({scalePadding:t,channel:e,scaleType:n,markDef:i,scalePaddingInner:r,config:s})=>function(t,e,n,i,r,s){if(void 0===t&&e in SU&&"band"===n){const{bandPaddingOuter:t}=s;return xL(t,Xq(r)?{signal:`${r.signal}/2`}:r/2)}}(t,e,n,i.type,r,s.scale),reverse:({fieldOrDatumDef:t,scaleType:e,channel:n,config:i})=>function(t,e,n,i){return"x"===n&&void 0!==i.xReverse?TW(t)&&"descending"===e?Xq(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse:!(!TW(t)||"descending"!==e)||void 0}(e,MH(t)?t.sort:void 0,n,i.scale),zero:({channel:t,fieldOrDatumDef:e,domain:n,markDef:i,scaleType:r})=>function(t,e,n,i,r){if(n&&"unaggregated"!==n&&TW(r)){if(vR(n)){const t=n[0],e=n[n.length-1];if(t<=0&&e>=0)return!0}return!1}if("size"===t&&"quantitative"===e.type&&!jW(r))return!0;if((!MH(e)||!e.bin)&&ZR([...OU,...zU],t)){const{orient:e,type:n}=i;return!ZR(["bar","area","line","trail"],n)||!("horizontal"===e&&"y"===t||"vertical"===e&&"x"===t)}return!1}(t,e,n,i,r)};function _Q(t){FQ(t)?function(t){const e=t.component.scales;for(const n of VU){const i=e[n];if(!i)continue;const r=mQ(n,t);i.setWithExplicit("range",r)}}(t):kQ(t,"range")}function kQ(t,e){const n=t.component.scales;for(const n of t.children)"range"===e?_Q(n):wQ(n,e);for(const i of oL(n)){let r;for(const n of t.children){const t=n.component.scales[i];t&&(r=aX(r,t.getWithExplicit(e),e,"scale",sX(((t,n)=>{switch(e){case"range":return t.step&&n.step?t.step-n.step:0}return 0}))))}n[i].setWithExplicit(e,r)}}function CQ(t){FQ(t)?t.component.scales=function(t){const{encoding:e,mark:n}=t;return VU.reduce(((i,r)=>{const s=eV(e[r]);if(s&&n===HL&&r===FP&&s.type===yW)return i;let o=s&&s.scale;if(s&&null!==o&&!1!==o){o=null!=o?o:{};const e=function(t,e,n,i){const r=function(t,e,n){var i;switch(e.type){case"nominal":case"ordinal":if(YP(t)||"discrete"===ZU(t))return"shape"===t&&"ordinal"===e.type&&Mq(bq(t,"ordinal")),"ordinal";if(t in SU){if(ZR(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&t in MU)return"band";return void 0!==e.band||PH(e)&&(null===(i=e.axis)||void 0===i?void 0:i.tickBand)?"band":"point";case"temporal":return YP(t)?"time":"discrete"===ZU(t)?(Mq(bq(t,"temporal")),"ordinal"):MH(e)&&e.timeUnit&&Gq(e.timeUnit).utc?"utc":"time";case"quantitative":return YP(t)?MH(e)&&QU(e.bin)?"bin-ordinal":"linear":"discrete"===ZU(t)?(Mq(bq(t,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(pq(e.type))}(e,n,i),{type:s}=t;return GU(e)?void 0!==s?YW(e,s)?MH(n)&&!XW(s,n.type)?(Mq(function(t,e){return`FieldDef does not work with "${t}" scale. We are using "${e}" scale instead.`}(s,r)),r):s:(Mq(function(t,e,n){return`Channel "${t}" does not work with "${e}" scale. We are using "${n}" scale instead.`}(e,s,r)),r):r:null}(o,r,s,n);i[r]=new fQ(t.scaleName(r+"",!0),{value:e,explicit:o.type===e})}return i}),{})}(t):t.component.scales=function(t){var e;const n=t.component.scales={},i={},r=t.component.resolve;for(const n of t.children){CQ(n);for(const s of oL(n.component.scales))if(r.scale[s]=null!==(e=r.scale[s])&&void 0!==e?e:HZ(s,t),"shared"===r.scale[s]){const t=i[s],e=n.component.scales[s].getWithExplicit("type");t?CW(t.value,e.value)?i[s]=aX(t,e,"type","scale",EQ):(r.scale[s]="independent",delete i[s]):i[s]=e}}for(const e of oL(i)){const r=t.scaleName(e,!0),s=i[e];n[e]=new fQ(r,s);for(const n of t.children){const t=n.component.scales[e];t&&(n.renameScale(t.get("name"),r),t.merged=!0)}}return n}(t)}const EQ=sX(((t,e)=>DW(t)-DW(e)));class DQ{constructor(){this.nameMap={}}rename(t,e){this.nameMap[t]=e}has(t){return void 0!==this.nameMap[t]}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function FQ(t){return"unit"===(null==t?void 0:t.type)}function SQ(t){return"facet"===(null==t?void 0:t.type)}function OQ(t){return"concat"===(null==t?void 0:t.type)}function NQ(t){return"layer"===(null==t?void 0:t.type)}class MQ{constructor(t,e,n,i,r,s,o){var a,u;this.type=e,this.parent=n,this.config=r,this.view=o,this.children=[],this.correctDataNames=t=>(t.from&&t.from.data&&(t.from.data=this.lookupDataSource(t.from.data)),t.from&&t.from.facet&&t.from.facet.data&&(t.from.facet.data=this.lookupDataSource(t.from.facet.data)),t),this.parent=n,this.config=r,this.name=null!==(a=t.name)&&void 0!==a?a:i,this.title=fV(t.title)?{text:t.title}:t.title,this.scaleNameMap=n?n.scaleNameMap:new DQ,this.projectionNameMap=n?n.projectionNameMap:new DQ,this.signalNameMap=n?n.signalNameMap:new DQ,this.data=t.data,this.description=t.description,this.transforms=(null!==(u=t.transform)&&void 0!==u?u:[]).map((t=>vX(t)?{filter:qR(t.filter,hW)}:t)),this.layout="layer"===e||"unit"===e?{}:function(t,e,n){var i,r;const s=n[e],o={},{spacing:a,columns:u}=s;void 0!==a&&(o.spacing=a),void 0!==u&&(kH(t)&&!AH(t.facet)||lG(t))&&(o.columns=u),cG(t)&&(o.columns=1);for(const e of pG)if(void 0!==t[e])if("spacing"===e){const n=t[e];o[e]=FR(n)?n:{row:null!==(i=n.row)&&void 0!==i?i:a,column:null!==(r=n.column)&&void 0!==r?r:a}}else o[e]=t[e];return o}(t,e,r),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:kH(t)||n&&n.component.data.isFaceted&&void 0===t.data},layoutSize:new nX,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},s?HR(s):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(t,{ignoreRange:e}={}){CQ(t),tQ(t);for(const e of HW)wQ(t,e);e||_Q(t)}(this)}parseProjection(){dK(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){rK(this)}assembleGroupStyle(){var t,e;if("unit"===this.type||"layer"===this.type)return null!==(e=null===(t=this.view)||void 0===t?void 0:t.style)&&void 0!==e?e:"cell"}assembleEncodeFromView(t){const{style:e}=t,n=MR(t,["style"]),i={};for(const t of oL(n)){const e=n[t];void 0!==e&&(i[t]=dV(e))}return i}assembleGroupEncodeEntry(t){let e={};return this.view&&(e=this.assembleEncodeFromView(this.view)),t||(this.description&&(e.description=dV(this.description)),"unit"!==this.type&&"layer"!==this.type)?sL(e)?void 0:e:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=e?e:{})}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:e}=t,n=MR(t,["spacing"]),{component:i,config:r}=this,s=function(t,e){const n={};for(const i of ZP){const r=t[i];if(null==r?void 0:r.facetFieldDef){const{titleAnchor:t,titleOrient:s}=EZ(["titleAnchor","titleOrient"],r.facetFieldDef,e,i),o=kZ(i,s),a=jZ(t,o);void 0!==a&&(n[o]=a)}}return sL(n)?void 0:n}(i.layoutHeaders,r);return Object.assign(Object.assign(Object.assign({padding:e},this.assembleDefaultLayout()),n),s?{titleBand:s}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let e=[];for(const n of ZP)t[n].title&&e.push(SZ(this,n));for(const t of DZ)e=e.concat(MZ(this,t));return e}assembleAxes(){return function(t,e){const{x:n=[],y:i=[]}=t;return[...n.map((t=>uZ(t,"grid",e))),...i.map((t=>uZ(t,"grid",e))),...n.map((t=>uZ(t,"main",e))),...i.map((t=>uZ(t,"main",e)))].filter((t=>t))}(this.component.axes,this.config)}assembleLegends(){return lK(this)}assembleProjections(){return NQ(t=this)||OQ(t)?function(t){return t.children.reduce(((t,e)=>t.concat(e.assembleProjections())),cK(t))}(t):cK(t);var t}assembleTitle(){var t,e,n;const i=null!==(t=this.title)&&void 0!==t?t:{},{encoding:r}=i,s=MR(i,["encoding"]),o=Object.assign(Object.assign(Object.assign({},hV(this.config.title).nonMark),s),r?{encode:{update:r}}:{});if(o.text)return ZR(["unit","layer"],this.type)?ZR(["middle",void 0],o.anchor)&&(o.frame=null!==(e=o.frame)&&void 0!==e?e:"group"):o.anchor=null!==(n=o.anchor)&&void 0!==n?n:"start",sL(o)?void 0:o}assembleGroup(t=[]){const e={};(t=t.concat(this.assembleSignals())).length>0&&(e.signals=t);const n=this.assembleLayout();n&&(e.layout=n),e.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||SQ(this.parent)?cQ(this):[];i.length>0&&(e.scales=i);const r=this.assembleAxes();r.length>0&&(e.axes=r);const s=this.assembleLegends();return s.length>0&&(e.legends=s),e}getName(t){return cL((this.name?this.name+"_":"")+t)}requestDataName(t){var e;const n=this.getName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(null!==(e=i[n])&&void 0!==e?e:0)+1,n}getSizeSignalRef(t){if(SQ(this.parent)){const e=$U(qZ(t)),n=this.component.scales[e];if(n&&!n.merged){const t=n.get("type"),i=n.get("range");if($W(t)&&Yq(i)){const t=n.get("name"),i=uQ(lQ(this,e));return i?{signal:UZ(t,n,WH({aggregate:"distinct",field:i},{expr:"datum"}))}:(Mq(`Unknown field for ${e}. Cannot calculate view size.`),null)}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const e=this.component.data.outputNodes[t];return e?e.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,e){this.signalNameMap.rename(t,e)}renameScale(t,e){this.scaleNameMap.rename(t,e)}renameProjection(t,e){this.projectionNameMap.rename(t,e)}scaleName(t,e){return e?this.getName(t):uU(t)&&GU(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const e=this.component.scales[t];return e&&!e.merged?e:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,e){let n=this.component.selection[t];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(t,e)),!n)throw new Error(`Cannot find a selection named "${e}".`);return n}hasAxisOrientSignalRef(){var t,e;return(null===(t=this.component.axes.x)||void 0===t?void 0:t.some((t=>t.hasOrientSignalRef())))||(null===(e=this.component.axes.y)||void 0===e?void 0:e.some((t=>t.hasOrientSignalRef())))}}class zQ extends MQ{vgField(t,e={}){const n=this.fieldDef(t);if(n)return WH(n,e)}reduceFieldDef(t,e){return NV(this.getMapping(),((e,n,i)=>{const r=tV(n);return r?t(e,r,i):e}),e)}forEachFieldDef(t,e){OV(this.getMapping(),((e,n)=>{const i=tV(e);i&&t(i,n)}),e)}}class $Q extends cY{constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=HR(e);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=s[0])&&void 0!==i?i:"value",null!==(r=s[1])&&void 0!==r?r:"density"]}clone(){return new $Q(null,HR(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${YR(this.transform)}`}assemble(){const t=this.transform,{density:e}=t,n=MR(t,["density"]);return Object.assign({type:"kde",field:e},n)}}class TQ extends cY{constructor(t,e){super(t),this.filter=e}clone(){return new TQ(null,Object.assign({},this.filter))}static make(t,e){const{config:n,mark:i,markDef:r}=e;if("filter"!==yV("invalid",r,n))return null;const s=e.reduceFieldDef(((t,n,r)=>{const s=GU(r)&&e.getScaleComponent(r);return s&&TW(s.get("type"))&&"count"!==n.aggregate&&!VL(i)&&(t[n.field]=n),t}),{});return oL(s).length?new TQ(t,s):null}dependentFields(){return new Set(oL(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${YR(this.filter)}`}assemble(){const t=oL(this.filter).reduce(((t,e)=>{const n=this.filter[e],i=WH(n,{expr:"datum"});return null!==n&&("temporal"===n.type?t.push(`(isDate(${i}) || (isValid(${i}) && isFinite(+${i})))`):"quantitative"===n.type&&(t.push(`isValid(${i})`),t.push(`isFinite(+${i})`))),t}),[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class BQ extends cY{constructor(t,e){super(t),this.transform=e,this.transform=HR(e);const{flatten:n,as:i=[]}=this.transform;this.transform.as=n.map(((t,e)=>{var n;return null!==(n=i[e])&&void 0!==n?n:t}))}clone(){return new BQ(this.parent,HR(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${YR(this.transform)}`}assemble(){const{flatten:t,as:e}=this.transform;return{type:"flatten",fields:t,as:e}}}class jQ extends cY{constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=HR(e);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=s[0])&&void 0!==i?i:"key",null!==(r=s[1])&&void 0!==r?r:"value"]}clone(){return new jQ(null,HR(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${YR(this.transform)}`}assemble(){const{fold:t,as:e}=this.transform;return{type:"fold",fields:t,as:e}}}class IQ extends cY{constructor(t,e,n,i){super(t),this.fields=e,this.geojson=n,this.signal=i}clone(){return new IQ(null,HR(this.fields),this.geojson,this.signal)}static parseAll(t,e){if(e.component.projection&&!e.component.projection.isFit)return t;let n=0;for(const i of[[AP,wP],[kP,_P]]){const r=i.map((t=>{const n=eV(e.encoding[t]);return MH(n)?n.field:$H(n)?{expr:`${n.datum}`}:RH(n)?{expr:`${n.value}`}:void 0}));(r[0]||r[1])&&(t=new IQ(t,r,null,e.getName("geojson_"+n++)))}if(e.channelHasField(FP)){const i=e.typedFieldDef(FP);i.type===yW&&(t=new IQ(t,null,i.field,e.getName("geojson_"+n++)))}return t}dependentFields(){var t;const e=(null!==(t=this.fields)&&void 0!==t?t:[]).filter(SR);return new Set([...this.geojson?[this.geojson]:[],...e])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${YR(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class RQ extends cY{constructor(t,e,n,i){super(t),this.projection=e,this.fields=n,this.as=i}clone(){return new RQ(null,this.projection,HR(this.fields),HR(this.as))}static parseAll(t,e){if(!e.projectionName())return t;for(const n of[[AP,wP],[kP,_P]]){const i=n.map((t=>{const n=eV(e.encoding[t]);return MH(n)?n.field:$H(n)?{expr:`${n.datum}`}:RH(n)?{expr:`${n.value}`}:void 0})),r=n[0]===kP?"2":"";(i[0]||i[1])&&(t=new RQ(t,e.projectionName(),i,[e.getName("x"+r),e.getName("y"+r)]))}return t}dependentFields(){return new Set(this.fields.filter(SR))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${YR(this.fields)} ${YR(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class LQ extends cY{constructor(t,e){super(t),this.transform=e}clone(){return new LQ(null,HR(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:e=0,stop:n,step:i}=t;return{signal:`sequence(${[e,n,...i?[i]:[]].join(",")})`}}static makeFromTransform(t,e){return new LQ(t,e)}static makeFromEncoding(t,e){const n=e.encoding,i=n.x,r=n.y;if(MH(i)&&MH(r)){const s=i.impute?i:r.impute?r:void 0;if(void 0===s)return;const o=i.impute?r:r.impute?i:void 0,{method:a,value:u,frame:l,keyvals:c}=s.impute,h=MV(e.mark,n);return new LQ(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:s.field,key:o.field},a?{method:a}:{}),void 0!==u?{value:u}:{}),l?{frame:l}:{}),void 0!==c?{keyvals:c}:{}),h.length?{groupby:h}:{}))}return null}hash(){return`Impute ${YR(this.transform)}`}assemble(){const{impute:t,key:e,keyvals:n,method:i,groupby:r,value:s,frame:o=[null,null]}=this.transform,a=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:e},n?{keyvals:(u=n,void 0!==(null==u?void 0:u.stop)?this.processSequence(n):n)}:{}),{method:"value"}),r?{groupby:r}:{}),{value:i&&"value"!==i?null:s});var u;return i&&"value"!==i?[a,Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[i],fields:[t],frame:o,ignorePeers:!1},r?{groupby:r}:{}),{type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t}]:[a]}}class PQ extends cY{constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=HR(e);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=s[0])&&void 0!==i?i:e.on,null!==(r=s[1])&&void 0!==r?r:e.loess]}clone(){return new PQ(null,HR(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${YR(this.transform)}`}assemble(){const t=this.transform,{loess:e,on:n}=t,i=MR(t,["loess","on"]);return Object.assign({type:"loess",x:n,y:e},i)}}class UQ extends cY{constructor(t,e,n){super(t),this.transform=e,this.secondary=n}clone(){return new UQ(null,HR(this.transform),this.secondary)}static make(t,e,n,i){const r=e.component.data.sources,{from:s}=n;let o=null;if(function(t){return"data"in t}(s)){let t=i0(s.data,r);t||(t=new vK(s.data),r.push(t));const n=e.getName(`lookup_${i}`);o=new hY(t,n,"lookup",e.component.data.outputNodeRefCounts),e.component.data.outputNodes[n]=o}else if(function(t){return"selection"in t}(s)){const t=s.selection;if(n=Object.assign({as:t},n),o=e.getSelectionComponent(cL(t),t).materialized,!o)throw new Error(`Cannot define and lookup the "${t}" selection in the same view. Try moving the lookup into a second, layered view?`)}return new UQ(t,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?kR(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${YR({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:kR(this.transform.as)}:{});else{let e=this.transform.as;SR(e)||(Mq('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),e="_lookup"),t={as:[e]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}class qQ extends cY{constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=HR(e);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=s[0])&&void 0!==i?i:"prob",null!==(r=s[1])&&void 0!==r?r:"value"]}clone(){return new qQ(null,HR(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${YR(this.transform)}`}assemble(){const t=this.transform,{quantile:e}=t,n=MR(t,["quantile"]);return Object.assign({type:"quantile",field:e},n)}}class WQ extends cY{constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=HR(e);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=s[0])&&void 0!==i?i:e.on,null!==(r=s[1])&&void 0!==r?r:e.regression]}clone(){return new WQ(null,HR(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${YR(this.transform)}`}assemble(){const t=this.transform,{regression:e,on:n}=t,i=MR(t,["regression","on"]);return Object.assign({type:"regression",x:n,y:e},i)}}class HQ extends cY{constructor(t,e){super(t),this.transform=e}clone(){return new HQ(null,HR(this.transform))}addDimensions(t){var e;this.transform.groupby=eL((null!==(e=this.transform.groupby)&&void 0!==e?e:[]).concat(t),(t=>t))}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}hash(){return`PivotTransform ${YR(this.transform)}`}assemble(){const{pivot:t,value:e,groupby:n,limit:i,op:r}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:e},void 0!==i?{limit:i}:{}),void 0!==r?{op:r}:{}),void 0!==n?{groupby:n}:{})}}class VQ extends cY{constructor(t,e){super(t),this.transform=e}clone(){return new VQ(null,HR(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${YR(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function GQ(t){let e=0;return function n(i,r){var s;if(i instanceof vK&&!i.isGenerator&&!lX(i.data)&&(t.push(r),r={name:null,source:r.name,transform:[]}),i instanceof OK&&(i.parent instanceof vK&&!r.source?(r.format=Object.assign(Object.assign({},null!==(s=r.format)&&void 0!==s?s:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof DK){r.name||(r.name="data_"+e++),!r.source||r.transform.length>0?(t.push(r),i.data=r.name):i.data=r.source;for(const e of i.assemble())t.push(e)}else switch((i instanceof xK||i instanceof wK||i instanceof TQ||i instanceof iZ||i instanceof AZ||i instanceof RQ||i instanceof IQ||i instanceof EK||i instanceof UQ||i instanceof $K||i instanceof MK||i instanceof jQ||i instanceof BQ||i instanceof $Q||i instanceof PQ||i instanceof qQ||i instanceof WQ||i instanceof NK||i instanceof VQ||i instanceof HQ)&&r.transform.push(i.assemble()),(i instanceof yK||i instanceof fY||i instanceof LQ||i instanceof zK)&&r.transform.push(...i.assemble()),i instanceof hY&&(r.source&&0===r.transform.length?i.setSource(r.source):i.parent instanceof hY?i.setSource(r.name):(r.name||(r.name="data_"+e++),i.setSource(r.name),1===i.numChildren()&&(t.push(r),r={name:null,source:r.name,transform:[]}))),i.numChildren()){case 0:i instanceof hY&&(!r.source||r.transform.length>0)&&t.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name="data_"+e++);let s=r.name;!r.source||r.transform.length>0?t.push(r):s=r.source;for(const t of i.children)n(t,{name:null,source:s,transform:[]});break}}}}function XQ(t){return"top"===t||"left"===t||Xq(t)?"header":"footer"}function YQ(t,e){var n;const{facet:i,config:r,child:s,component:o}=t;if(t.channelHasField(e)){const a=i[e],u=CZ("title",null,r,e);let l=JH(a,r,{allowDisabling:!0,includeDefault:void 0===u||!!u});s.component.layoutHeaders[e].title&&(l=vR(l)?l.join(", "):l,l+=" / "+s.component.layoutHeaders[e].title,s.component.layoutHeaders[e].title=null);const c=CZ("labelOrient",a,r,e),h=xL((null!==(n=a.header)&&void 0!==n?n:{}).labels,r.header.labels,!0),f=ZR(["bottom","right"],c)?"footer":"header";o.layoutHeaders[e]={title:l,facetFieldDef:a,[f]:"facet"===e?[]:[JQ(t,e,h)]}}}function JQ(t,e,n){const i="row"===e?"height":"width";return{labels:n,sizeSignal:t.child.component.layoutSize.get(i)?t.child.getSizeSignalRef(i):void 0,axes:[]}}function ZQ(t,e){var n;const{child:i}=t;if(i.component.axes[e]){const{layoutHeaders:r,resolve:s}=t.component;if(s.axis[e]=VZ(s,e),"shared"===s.axis[e]){const s="x"===e?"column":"row",o=r[s];for(const r of i.component.axes[e]){const e=XQ(r.get("orient"));o[e]=null!==(n=o[e])&&void 0!==n?n:[JQ(t,s,!1)];const i=uZ(r,"main",t.config,{header:!0});i&&o[e][0].axes.push(i),r.mainExtracted=!0}}}}function KQ(t){for(const e of t.children)e.parseLayoutSize()}function QQ(t,e){const n=qZ(e),i=$U(n),r=t.component.resolve,s=t.component.layoutSize;let o;for(const e of t.children){const t=e.component.layoutSize.getWithExplicit(n),s=r.scale[i];if("independent"===s&&"step"===t.value){o=void 0;break}if(o){if("independent"===s&&o.value!==t.value){o=void 0;break}o=aX(o,t,n,"")}else o=t}if(o){for(const i of t.children)t.renameSignal(i.getName(n),t.getName(e)),i.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(e,o)}else s.setWithExplicit(e,{explicit:!1,value:void 0})}function t0(t,e){const n="width"===e?"x":"y",i=t.config,r=t.getScaleComponent(n);if(r){const t=r.get("type"),n=r.get("range");if($W(t)){const t=yG(i.view,e);return Yq(n)||fG(t)?"step":t}return gG(i.view,e)}if(t.hasProjection||"arc"===t.mark)return gG(i.view,e);{const t=yG(i.view,e);return fG(t)?t.step:t}}function e0(t,e,n){return WH(e,Object.assign({suffix:`by_${WH(t)}`},null!=n?n:{}))}class n0 extends zQ{constructor(t,e,n,i){super(t,"facet",e,n,i,t.resolve),this.child=_0(t.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(t.facet,i)}initFacet(t,e){return AH(t)?NV(t,((t,n,i)=>ZR([cP,hP],i)?void 0===n.field?(Mq(mq(n,i)),t):(t[i]=nV(n,i,e),t):(Mq(yq(i,"facet")),t)),{}):{facet:nV(t,"facet",e)}}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=r0(this),this.child.parseData()}parseLayoutSize(){KQ(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(t){for(const e of ZP)YQ(t,e);ZQ(t,"x"),ZQ(t,"y")}(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,e,n;const i={};for(const r of ZP)for(const s of FZ){const o=this.component.layoutHeaders[r],a=o[s],{facetFieldDef:u}=o;if(u){const e=CZ("titleOrient",u,this.config,r);if(ZR(["right","bottom"],e)){const n=kZ(r,e);i.titleAnchor=null!==(t=i.titleAnchor)&&void 0!==t?t:{},i.titleAnchor[n]="end"}}if(null==a?void 0:a[0]){const t="row"===r?"height":"width",a="header"===s?"headerBand":"footerBand";"facet"===r||this.child.component.layoutSize.get(t)||(i[a]=null!==(e=i[a])&&void 0!==e?e:{},i[a][r]=.5),o.title&&(i.offset=null!==(n=i.offset)&&void 0!==n?n:{},i.offset["row"===r?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:t,row:e}=this.facet,n=t?this.columnDistinctSignal():e?1:void 0;let i="all";return(e||"independent"!==this.component.resolve.scale.x)&&(t||"independent"!==this.component.resolve.scale.y)||(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof n0))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(t){return this.parent&&this.parent instanceof n0?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:WH(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],e=[],n=[];if(this.child instanceof n0){if(this.child.channelHasField("column")){const i=WH(this.child.facet.column);t.push(i),e.push("distinct"),n.push(`distinct_${i}`)}}else for(const i of OU){const r=this.child.component.scales[i];if(r&&!r.merged){const s=r.get("type"),o=r.get("range");if($W(s)&&Yq(o)){const r=uQ(lQ(this.child,i));r?(t.push(r),e.push("distinct"),n.push(`distinct_${r}`)):Mq(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:t,ops:e,as:n}}assembleFacet(){const{name:t,data:e}=this.component.data.facetRoot,{row:n,column:i}=this.facet,{fields:r,ops:s,as:o}=this.getCardinalityAggregateForChild(),a=[];for(const t of ZP){const e=this.facet[t];if(e){a.push(WH(e));const{bin:u,sort:l}=e;if(QU(u)&&a.push(WH(e,{binSuffix:"end"})),xH(l)){const{field:t,op:a=mH}=l,u=e0(e,l);n&&i?(r.push(u),s.push("max"),o.push(u)):(r.push(t),s.push(a),o.push(u))}else if(vR(l)){const n=_Z(e,t);r.push(n),s.push("max"),o.push(n)}}}const u=!!n&&!!i;return Object.assign({name:t,data:e,groupby:a},u||r.length>0?{aggregate:Object.assign(Object.assign({},u?{cross:u}:{}),r.length?{fields:r,ops:s,as:o}:{})}:{})}facetSortFields(t){const{facet:e}=this,n=e[t];return n?xH(n.sort)?[e0(n,n.sort,{expr:"datum"})]:vR(n.sort)?[_Z(n,t,{expr:"datum"})]:[WH(n,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:e}=this,n=e[t];if(n){const{sort:t}=n;return[(xH(t)?t.order:!vR(t)&&t)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:e}=this;if(t.facet)return $Z(t.facet,"facet",e);const n={row:["top","bottom"],column:["left","right"]};for(const i of DZ)if(t[i]){const r=CZ("labelOrient",t[i],e,i);if(ZR(n[i],r))return $Z(t[i],i,e)}}assembleMarks(){const{child:t}=this,e=function(t){const e=[],n=GQ(e);for(const e of t.children)n(e,{source:t.name,name:null,transform:[]});return e}(this.component.data.facetRoot),n=t.assembleGroupEncodeEntry(!1),i=this.assembleLabelTitle()||t.assembleTitle(),r=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},i?{title:i}:{}),r?{style:r}:{}),{from:{facet:this.assembleFacet()},sort:{field:ZP.map((t=>this.facetSortFields(t))).flat(),order:ZP.map((t=>this.facetSortOrder(t))).flat()}}),e.length>0?{data:e}:{}),n?{encode:{update:n}}:{}),t.assembleGroup(function(t,e){if(t.component.selection&&oL(t.component.selection).length){const n=OR(t.getName("cell"));e.unshift({name:"facet",value:{},on:[{events:rR("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return $Y(e)}(this,[])))]}getMapping(){return this.facet}}function i0(t,e){var n,i,r,s,o,a,u,l,c,h;for(const f of e){const e=f.data;if(!(t.name&&f.hasName()&&t.name!==f.dataName||(null===(n=t.format)||void 0===n?void 0:n.mesh)&&(null===(i=e.format)||void 0===i?void 0:i.feature)||((null===(r=t.format)||void 0===r?void 0:r.feature)||(null===(s=e.format)||void 0===s?void 0:s.feature))&&(null===(o=t.format)||void 0===o?void 0:o.feature)!==(null===(a=e.format)||void 0===a?void 0:a.feature)||((null===(u=t.format)||void 0===u?void 0:u.mesh)||(null===(l=e.format)||void 0===l?void 0:l.mesh))&&(null===(c=t.format)||void 0===c?void 0:c.mesh)!==(null===(h=e.format)||void 0===h?void 0:h.mesh)))if(cX(t)&&cX(e)){if(WR(t.values,e.values))return f}else if(lX(t)&&lX(e)){if(t.url===e.url)return f}else if(hX(t)&&t.name===f.dataName)return f}return null}function r0(t){var e,n,i,r,s,o,a,u,l,c;let h=function(t,e){if(t.data||!t.parent){if(null===t.data){const t=new vK({values:[]});return e.push(t),t}const n=i0(t.data,e);if(n)return fX(t.data)||(n.data.format=function(t,...e){for(const n of e)tL(t,null!=n?n:{});return t}({},t.data.format,n.data.format)),!n.hasName()&&t.data.name&&(n.dataName=t.data.name),n;{const n=new vK(t.data);return e.push(n),n}}return t.parent.component.data.facetRoot?t.parent.component.data.facetRoot:t.parent.component.data.main}(t,t.component.data.sources);const{outputNodes:f,outputNodeRefCounts:d}=t.component.data,p=t.parent?t.parent.component.data.ancestorParse.clone():new uX,g=t.data;fX(g)?(dX(g)?h=new wK(h,g.sequence):gX(g)&&(h=new xK(h,g.graticule)),p.parseNothing=!0):null===(null===(e=null==g?void 0:g.format)||void 0===e?void 0:e.parse)&&(p.parseNothing=!0),h=null!==(n=OK.makeExplicit(h,t,p))&&void 0!==n?n:h,h=new NK(h);const m=t.parent&&NQ(t.parent);(FQ(t)||SQ(t))&&m&&(h=null!==(i=yK.makeFromEncoding(h,t))&&void 0!==i?i:h),t.transforms.length>0&&(h=function(t,e,n){var i,r;let s=0;for(const o of e.transforms){let a,u;if(SX(o))u=t=new AZ(t,o),a="derived";else if(vX(o)){const r=SK(o);u=t=null!==(i=OK.makeWithAncestors(t,{},r,n))&&void 0!==i?i:t,t=new iZ(t,e,o.filter)}else if(OX(o))u=t=yK.makeFromTransform(t,o,e),a="number";else if(MX(o))a="date",void 0===n.getWithExplicit(o.field).value&&(t=new OK(t,{[o.field]:a}),n.set(o.field,a,!1)),u=t=fY.makeFromTransform(t,o);else if(zX(o))u=t=EK.makeFromTransform(t,o),a="number",XY(e)&&(t=new NK(t));else if(bX(o))u=t=UQ.make(t,e,o,s++),a="derived";else if(EX(o))u=t=new $K(t,o),a="number";else if(DX(o))u=t=new MK(t,o),a="number";else if($X(o))u=t=zK.makeFromTransform(t,o),a="derived";else if(TX(o))u=t=new jQ(t,o),a="derived";else if(FX(o))u=t=new BQ(t,o),a="derived";else if(xX(o))u=t=new HQ(t,o),a="derived";else if(CX(o))t=new VQ(t,o);else if(NX(o))u=t=LQ.makeFromTransform(t,o),a="derived";else if(wX(o))u=t=new $Q(t,o),a="derived";else if(AX(o))u=t=new qQ(t,o),a="derived";else if(_X(o))u=t=new WQ(t,o),a="derived";else{if(!kX(o)){Mq(`Ignoring an invalid transform: ${XR(o)}.`);continue}u=t=new PQ(t,o),a="derived"}if(u&&void 0!==a)for(const t of null!==(r=u.producedFields())&&void 0!==r?r:[])n.set(t,a,!1)}return t}(h,t,p));const y=function(t){const e={};if(FQ(t)&&t.component.selection)for(const n of oL(t.component.selection)){const i=t.component.selection[n];for(const t of i.project.items)!t.channel&&bL(t.field)>1&&(e[t.field]="flatten")}return e}(t),v=function(t){const e={};function n(t){var n;aV(t)?e[t.field]="date":"quantitative"===t.type&&SR(n=t.aggregate)&&ZR(["min","max"],n)?e[t.field]="number":bL(t.field)>1?t.field in e||(e[t.field]="flatten"):LH(t)&&xH(t.sort)&&bL(t.sort.field)>1&&(t.sort.field in e||(e[t.sort.field]="flatten"))}if((FQ(t)||SQ(t))&&t.forEachFieldDef(((e,i)=>{if(IH(e))n(e);else{const r=hU(i),s=t.fieldDef(r);n(Object.assign(Object.assign({},e),{type:s.type}))}})),FQ(t)){const{mark:n,markDef:i,encoding:r}=t;if(VL(n)&&!t.encoding.order){const t=r["horizontal"===i.orient?"y":"x"];MH(t)&&"quantitative"===t.type&&!(t.field in e)&&(e[t.field]="number")}}return e}(t);h=null!==(r=OK.makeWithAncestors(h,{},Object.assign(Object.assign({},y),v),p))&&void 0!==r?r:h,FQ(t)&&(h=IQ.parseAll(h,t),h=RQ.parseAll(h,t)),(FQ(t)||SQ(t))&&(m||(h=null!==(s=yK.makeFromEncoding(h,t))&&void 0!==s?s:h),h=null!==(o=fY.makeFromEncoding(h,t))&&void 0!==o?o:h,h=AZ.parseAllForSortIndex(h,t));const b=t.getName(yX),x=new hY(h,b,yX,d);if(f[b]=x,h=x,FQ(t)){const e=EK.makeFromEncoding(h,t);e&&(h=e,XY(t)&&(h=new NK(h))),h=null!==(a=LQ.makeFromEncoding(h,t))&&void 0!==a?a:h,h=null!==(u=zK.makeFromEncoding(h,t))&&void 0!==u?u:h}FQ(t)&&(h=null!==(l=TQ.make(h,t))&&void 0!==l?l:h);const w=t.getName(mX),A=new hY(h,w,mX,d);f[w]=A,h=A,FQ(t)&&function(t,e){VY(t,(n=>{const i=n.name,r=t.getName(`lookup_${i}`);t.component.data.outputNodes[r]=n.materialized=new hY(new iZ(e,t,{selection:i}),r,"lookup",t.component.data.outputNodeRefCounts)}))}(t,A);let _=null;if(SQ(t)){const e=t.getName("facet");h=null!==(c=function(t,e){const{row:n,column:i}=e;if(n&&i){let e=null;for(const r of[n,i])if(xH(r.sort)){const{field:n,op:i=mH}=r.sort;t=e=new MK(t,{joinaggregate:[{op:i,field:n,as:e0(r,r.sort,{forAs:!0})}],groupby:[WH(r)]})}return e}return null}(h,t.facet))&&void 0!==c?c:h,_=new DK(h,t,e,A.getSource()),f[e]=_}return Object.assign(Object.assign({},t.component.data),{outputNodes:f,outputNodeRefCounts:d,raw:x,main:A,facetRoot:_,ancestorParse:p})}class s0 extends MQ{constructor(t,e,n,i){var r,s,o,a;super(t,"concat",e,n,i,t.resolve),"shared"!==(null===(s=null===(r=t.resolve)||void 0===r?void 0:r.axis)||void 0===s?void 0:s.x)&&"shared"!==(null===(a=null===(o=t.resolve)||void 0===o?void 0:o.axis)||void 0===a?void 0:a.y)||Mq("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(t).map(((t,e)=>_0(t,this,this.getName("concat_"+e),void 0,i)))}parseData(){this.component.data=r0(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const e of oL(t.component.selection))this.component.selection[e]=t.component.selection[e]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return cG(t)?t.vconcat:hG(t)?t.hconcat:t.concat}parseLayoutSize(){!function(t){KQ(t);const e=1===t.layout.columns?"width":"childWidth",n=void 0===t.layout.columns?"height":"childHeight";QQ(t,e),QQ(t,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce(((t,e)=>e.assembleSelectionTopLevelSignals(t)),t)}assembleSignals(){return this.children.forEach((t=>t.assembleSignals())),[]}assembleLayoutSignals(){const t=RZ(this);for(const e of this.children)t.push(...e.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce(((t,e)=>e.assembleSelectionData(t)),t)}assembleMarks(){return this.children.map((t=>{const e=t.assembleTitle(),n=t.assembleGroupStyle(),i=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},e?{title:e}:{}),n?{style:n}:{}),i?{encode:{update:i}}:{}),t.assembleGroup())}))}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},null!=t?{columns:t}:{}),{bounds:"full",align:"each"})}}const o0=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},FL),{labelExpr:1,encode:1}),a0=oL(o0);class u0 extends nX{constructor(t={},e={},n=!1){super(),this.explicit=t,this.implicit=e,this.mainExtracted=n}clone(){return new u0(HR(this.explicit),HR(this.implicit),this.mainExtracted)}hasAxisPart(t){return!("axis"!==t&&("grid"===t||"title"===t?!this.get(t):!1===(e=this.get(t))||null===e));var e}hasOrientSignalRef(){return Xq(this.explicit.orient)}}const l0={bottom:"top",top:"bottom",left:"right",right:"left"};function c0(t,e){if(!t)return e.map((t=>t.clone()));{if(t.length!==e.length)return;const n=t.length;for(let i=0;i<n;i++){const n=t[i],r=e[i];if(!!n!=!!r)return;if(n&&r){const e=n.getWithExplicit("orient"),s=r.getWithExplicit("orient");if(e.explicit&&s.explicit&&e.value!==s.value)return;t[i]=h0(n,r)}}}return t}function h0(t,e){for(const n of a0){const i=aX(t.getWithExplicit(n),e.getWithExplicit(n),n,"axis",((t,e)=>{switch(n){case"title":return kV(t,e);case"gridScale":return{explicit:t.explicit,value:xL(t.value,e.value)}}return oX(t,e,n,"axis")}));t.setWithExplicit(n,i)}return t}function f0(t,e,n,i,r){if("disable"===e)return void 0!==n;switch(n=n||{},e){case"titleAngle":case"labelAngle":return t===(Xq(n.labelAngle)?n.labelAngle:AL(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(t===wZ(i,r))return!0}return t===n[e]}const d0=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function p0(t,e){var n,i,r;let s=e.axis(t);const o=new u0,a=eV(e.encoding[t]),{mark:u,config:l}=e,c=(null==s?void 0:s.orient)||(null===(n=l["x"===t?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(i=l.axis)||void 0===i?void 0:i.orient)||function(t){return"x"===t?"bottom":"left"}(t),h=e.getScaleComponent(t).get("type"),f=function(t,e,n,i){const r="band"===e?["axisDiscrete","axisBand"]:"point"===e?["axisDiscrete","axisPoint"]:e in OW?["axisQuantitative"]:"time"===e||"utc"===e?["axisTemporal"]:[],s="x"===t?"axisX":"axisY",o=Xq(n)?"axisOrient":"axis"+dL(n),a=[...r,...r.map((t=>s+t.substr(4)))],u=["axis",o,s];return{vlOnlyAxisConfig:pZ(a,i,t,n),vgAxisConfig:pZ(u,i,t,n),axisConfigStyle:gZ([...u,...a],i)}}(t,h,c,e.config),d=void 0!==s?!s:mZ("disable",l,null==s?void 0:s.style,f).configValue;if(o.set("disable",d,void 0!==s),d)return o;s=s||{};const p=function(t,e,n,i,r){const s=null==e?void 0:e.labelAngle;if(void 0!==s)return Xq(s)?s:AL(s);{const{configValue:s}=mZ("labelAngle",t.config,null==e?void 0:e.style,r);return void 0!==s?AL(s):n===dP&&ZR([mW,pW],i.type)?270:void 0}}(e,s,t,a,f),g={fieldOrDatumDef:a,axis:s,channel:t,model:e,scaleType:h,orient:c,labelAngle:p,mark:u,config:l};for(const n of a0){const i=n in yZ?yZ[n](g):OL(n)?s[n]:void 0,r=void 0!==i,a=f0(i,n,s,e,t);if(r&&a)o.set(n,i,a);else{const{configValue:t,configFrom:u}=OL(n)&&"values"!==n?mZ(n,e.config,s.style,f):{},l=void 0!==t;r&&!l?o.set(n,i,a):("vgAxisConfig"!==u||d0.has(n)&&l||CL(t)||Xq(t))&&o.set(n,t,!1)}}const m=null!==(r=s.encoding)&&void 0!==r?r:{},y=EL.reduce(((n,i)=>{var r;if(!o.hasAxisPart(i))return n;const s=WZ(null!==(r=m[i])&&void 0!==r?r:{},e),a="labels"===i?function(t,e,n){var i;const{encoding:r,config:s}=t,o=null!==(i=eV(r[e]))&&void 0!==i?i:eV(r[dU(e)]),a=t.axis(e)||{},{format:u,formatType:l}=a;return sH(l)?Object.assign({text:lH({fieldOrDatumDef:o,field:"datum.value",format:u,formatType:l,config:s})},n):n}(e,t,s):s;return void 0===a||sL(a)||(n[i]={update:a}),n}),{});return sL(y)||o.set("encode",y,!!s.encoding||void 0!==s.labelAngle),o}function g0(t,e){const{config:n}=t;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},rY(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),HX("x",t,{defaultPos:"mid"})),HX("y",t,{defaultPos:"mid"})),UX("size",t)),UX("angle",t)),function(t,e,n){return n?{shape:{value:n}}:UX("shape",t)}(t,0,e))}function m0(t){var e;const{config:n,markDef:i}=t,{orient:r}=i,s="horizontal"===r?"width":"height",o=t.getScaleComponent("horizontal"===r?"x":"y"),a=null!==(e=yV("size",i,n,{vgChannel:s}))&&void 0!==e?e:n.tick.bandSize;if(void 0!==a)return a;{const t=o?o.get("range"):void 0;return t&&Yq(t)&&FR(t.step)?3*t.step/4:3*mG(n.view,s)/4}}const y0={arc:{vgMark:"arc",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},rY(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),HX("x",t,{defaultPos:"mid"})),HX("y",t,{defaultPos:"mid"})),QX(t,"radius","arc")),QX(t,"theta","arc"))},area:{vgMark:"area",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign({},rY(t,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),JX("x",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===t.markDef.orient})),JX("y",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===t.markDef.orient})),oY(t))},bar:{vgMark:"rect",encodeEntry:t=>Object.assign(Object.assign(Object.assign({},rY(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),QX(t,"x","bar")),QX(t,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:t=>g0(t,"circle")},geoshape:{vgMark:"shape",encodeEntry:t=>Object.assign({},rY(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:t=>{const{encoding:e}=t,n=e.shape;return[Object.assign({type:"geoshape",projection:t.projectionName()},n&&MH(n)&&n.type===yW?{field:WH(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign({},rY(t,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),QX(t,"x","image")),QX(t,"y","image")),jX(t,"url"))},line:{vgMark:"line",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},rY(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),HX("x",t,{defaultPos:"mid"})),HX("y",t,{defaultPos:"mid"})),UX("size",t,{vgChannel:"strokeWidth"})),oY(t))},point:{vgMark:"symbol",encodeEntry:t=>g0(t)},rect:{vgMark:"rect",encodeEntry:t=>Object.assign(Object.assign(Object.assign({},rY(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),QX(t,"x","rect")),QX(t,"y","rect"))},rule:{vgMark:"rule",encodeEntry:t=>{const{markDef:e}=t,n=e.orient;return t.encoding.x||t.encoding.y||t.encoding.latitude||t.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},rY(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),JX("x",t,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),JX("y",t,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),UX("size",t,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:t=>g0(t,"square")},text:{vgMark:"text",encodeEntry:t=>{const{config:e,encoding:n}=t;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},rY(t,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),HX("x",t,{defaultPos:"mid"})),HX("y",t,{defaultPos:"mid"})),jX(t)),UX("size",t,{vgChannel:"fontSize"})),UX("angle",t)),aY("align",function(t,e,n){if(void 0===yV("align",t,n))return"center"}(t.markDef,0,e))),aY("baseline",function(t,e,n){if(void 0===yV("baseline",t,n))return"middle"}(t.markDef,0,e))),HX("radius",t,{defaultPos:null,isMidPoint:!0})),HX("theta",t,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:t=>{const{config:e,markDef:n}=t,i=n.orient,r="horizontal"===i?"width":"height",s="horizontal"===i?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},rY(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),HX("x",t,{defaultPos:"mid",vgChannel:"xc"})),HX("y",t,{defaultPos:"mid",vgChannel:"yc"})),UX("size",t,{defaultValue:m0(t),vgChannel:r})),{[s]:dV(yV("thickness",n,e))})}},trail:{vgMark:"trail",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},rY(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),HX("x",t,{defaultPos:"mid"})),HX("y",t,{defaultPos:"mid"})),UX("size",t)),oY(t))}};const v0="faceted_path_",b0="stack_group_";function x0(t,e={fromPrefix:""}){const{mark:n,markDef:i,config:r}=t,s=xL(i.clip,function(t){const e=t.getScaleComponent("x"),n=t.getScaleComponent("y");return!!(e&&e.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(t),function(t){const e=t.component.projection;return!(!e||e.isFit)||void 0}(t)),o=mV(i),a=t.encoding.key,u=function(t){const{encoding:e,stack:n,mark:i,markDef:r,config:s}=t,o=e.order;if(!(!vR(o)&&RH(o)&&JR(o.value)||!o&&JR(yV("order",r,s)))){if((vR(o)||MH(o))&&!n)return wV(o,{expr:"datum"});if(VL(i)){const n="horizontal"===r.orient?"y":"x",i=e[n];if(MH(i)){const e=i.sort;return vR(e)?{field:WH(i,{prefix:n,suffix:"sort_index",expr:"datum"})}:xH(e)?{field:WH({aggregate:EV(t.encoding)?e.op:void 0,field:e.field},{expr:"datum"})}:bH(e)?{field:WH(t.fieldDef(e.encoding),{expr:"datum"}),order:e.order}:null===e?void 0:{field:WH(i,{binSuffix:t.stack&&t.stack.impute?"mid":void 0,expr:"datum"})}}}}}(t),l=function(t){if(!t.component.selection)return null;const e=oL(t.component.selection).length;let n=e,i=t.parent;for(;i&&0===n;)n=oL(i.component.selection).length,i=i.parent;return n?{interactive:e>0}:null}(t),c=yV("aria",i,r),h=y0[n].postEncodingTransform?y0[n].postEncodingTransform(t):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:t.getName("marks"),type:y0[n].vgMark},s?{clip:!0}:{}),o?{style:o}:{}),a?{key:a.field}:{}),u?{sort:u}:{}),l||{}),!1===c?{aria:c}:{}),{from:{data:e.fromPrefix+t.requestDataName(mX)},encode:{update:y0[n].encodeEntry(t)}}),h?{transform:h}:{})]}class w0 extends zQ{constructor(t,e,n,i={},r){var s,o;super(t,"unit",e,n,r,void 0,dG(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const a=YL(t.mark)?t.mark.type:t.mark;this.markDef=function(t,e,n,{graticule:i}){const r=YL(t)?Object.assign({},t):{type:t},s=yV("orient",r,n);if(r.orient=function(t,e,n){switch(t){case jL:case qL:case WL:case LL:case IL:case TL:return}const{x:i,y:r,x2:s,y2:o}=e;switch(t){case $L:if(MH(i)&&(tq(i.bin)||MH(r)&&r.aggregate&&!i.aggregate))return"vertical";if(MH(r)&&(tq(r.bin)||MH(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s&&(MH(i)&&i.type===dW&&!QU(i.bin)||BH(i)))return"horizontal";if(!o&&(MH(r)&&r.type===dW&&!QU(r.bin)||BH(r)))return"vertical"}case RL:if(s&&(!MH(i)||!tq(i.bin))&&o&&(!MH(r)||!tq(r.bin)))return;case zL:if(o)return MH(r)&&tq(r.bin)?"horizontal":"vertical";if(s)return MH(i)&&tq(i.bin)?"vertical":"horizontal";if(t===RL){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case BL:case PL:{const e=TH(i),s=TH(r);if(e&&!s)return"tick"!==t?"horizontal":"vertical";if(!e&&s)return"tick"!==t?"vertical":"horizontal";if(e&&s){const e=i,s=r,o=e.type===gW,a=s.type===gW;return o&&!a?"tick"!==t?"vertical":"horizontal":!o&&a?"tick"!==t?"horizontal":"vertical":!e.aggregate&&s.aggregate?"tick"!==t?"vertical":"horizontal":e.aggregate&&!s.aggregate?"tick"!==t?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(r.type,e,s),void 0!==s&&s!==r.orient&&Mq(`Specified orient "${r.orient}" overridden with "${s}".`),"bar"===r.type&&r.orient){const t=yV("cornerRadiusEnd",r,n);if(void 0!==t){const n="horizontal"===r.orient&&e.x2||"vertical"===r.orient&&e.y2?["cornerRadius"]:KL[r.orient];for(const e of n)r[e]=t;void 0!==r.cornerRadiusEnd&&delete r.cornerRadiusEnd}}return void 0===yV("opacity",r,n)&&(r.opacity=function(t,e){if(ZR([jL,PL,qL,WL],t)&&!EV(e))return.7}(r.type,e)),void 0===r.filled&&(r.filled=!i&&function(t,e){const n=vV("filled",t,e),i=t.type;return xL(n,i!==jL&&i!==BL&&i!==RL)}(r,n)),void 0===yV("cursor",r,n)&&(r.cursor=function(t,e,n){return e.href||t.href||yV("href",t,n)?"pointer":t.cursor}(r,e,n)),r}(t.mark,null!==(s=t.encoding)&&void 0!==s?s:{},r,{graticule:t.data&&gX(t.data)});const u=this.encoding=FV(null!==(o=t.encoding)&&void 0!==o?o:{},this.markDef,r);this.size=function({encoding:t,size:e}){for(const n of OU){const i=pU(n);fG(e[i])&&TH(t[n])&&(delete e[i],Mq(kq(i)))}return e}({encoding:u,size:dG(t)?Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):i}),this.stack=$G(a,u),this.specifiedScales=this.initScales(a,u),this.specifiedAxes=this.initAxes(u),this.specifiedLegends=this.initLegend(u),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,e=this.mark===HL,n=t&&GP.some((e=>jH(t[e])));return e||n}scaleDomain(t){const e=this.specifiedScales[t];return e?e.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,e){return VU.reduce(((t,n)=>{var i;const r=eV(e[n]);return r&&(t[n]=null!==(i=r.scale)&&void 0!==i?i:{}),t}),{})}initAxes(t){return OU.reduce(((e,n)=>{const i=t[n];if(jH(i)||n===dP&&jH(t.x2)||n===pP&&jH(t.y2)){const t=jH(i)?i.axis:void 0;e[n]=t?Object.assign({},t):t}return e}),{})}initLegend(t){return WU.reduce(((e,n)=>{const i=eV(t[n]);if(i&&function(t){switch(t){case CP:case EP:case DP:case SP:case FP:case NP:case $P:case TP:return!0;case MP:case zP:case OP:return!1}}(n)){const t=i.legend;e[n]=t?Object.assign({},t):t}return e}),{})}parseData(){this.component.data=r0(this)}parseLayoutSize(){!function(t){const{size:e,component:n}=t;for(const i of OU){const r=pU(i);if(e[r]){const t=e[r];n.layoutSize.set(r,fG(t)?"step":t,!0)}else{const e=t0(t,r);n.layoutSize.set(r,e,!1)}}}(this)}parseSelections(){this.component.selection=function(t,e){var n;const i={},r=t.config.selection;for(const s of oL(null!=e?e:{})){const o=HR(e[s]),a=r[o.type],{fields:u,encodings:l}=a,c=MR(a,["fields","encodings"]);for(const t in c)"encodings"===t&&o.fields||"fields"===t&&o.encodings||("mark"===t&&(o[t]=Object.assign(Object.assign({},c[t]),o[t])),void 0!==o[t]&&!0!==o[t]||(o[t]=null!==(n=c[t])&&void 0!==n?n:o[t]));const h=cL(s),f=i[h]=Object.assign(Object.assign({},o),{name:h,events:SR(o.on)?rR(o.on,"scope"):HR(o.on)});NY(f,(n=>{n.has(f)&&n.parse&&n.parse(t,f,o,e[s])}))}return i}(this,this.selection)}parseMarkGroup(){var t;this.component.mark=ZR([BL,zL,UL],(t=this).mark)?function(t){const e=MV(t.mark,t.encoding),n=x0(t,{fromPrefix:e.length>0?v0:""});return e.length>0?[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:v0+t.requestDataName(mX),data:t.requestDataName(mX),groupby:e}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}(t):ZR([$L],t.mark)?function(t){const e=Qq.some((e=>yV(e,t.markDef,t.config)));if(t.stack&&!t.fieldDef("size")&&e){const[e]=x0(t,{fromPrefix:b0}),n=t.scaleName(t.stack.fieldChannel),i=(e={})=>t.vgField(t.stack.fieldChannel,e),r=(t,e)=>`${t}(${[i({prefix:"min",suffix:"start",expr:e}),i({prefix:"max",suffix:"start",expr:e}),i({prefix:"min",suffix:"end",expr:e}),i({prefix:"max",suffix:"end",expr:e})].map((t=>`scale('${n}',${t})`)).join(",")})`;let s,o;"x"===t.stack.fieldChannel?(s=Object.assign(Object.assign({},VR(e.encode.update,["y","yc","y2","height",...Qq])),{x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},e.encode.update=Object.assign(Object.assign({},GR(e.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(s=Object.assign(Object.assign({},VR(e.encode.update,["x","xc","x2","width"])),{y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},e.encode.update=Object.assign(Object.assign({},GR(e.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const n of Qq){const i=vV(n,t.markDef,t.config);e.encode.update[n]?(s[n]=e.encode.update[n],delete e.encode.update[n]):i&&(s[n]=dV(i)),i&&(e.encode.update[n]={value:0})}const a=t.fieldDef(t.stack.groupbyChannel),u=WH(a)?[WH(a)]:[];return((null==a?void 0:a.bin)||(null==a?void 0:a.timeUnit))&&u.push(WH(a,{binSuffix:"end"})),s=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce(((n,i)=>{if(e.encode.update[i])return Object.assign(Object.assign({},n),{[i]:e.encode.update[i]});{const e=vV(i,t.markDef,t.config);return void 0!==e?Object.assign(Object.assign({},n),{[i]:dV(e)}):n}}),s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:t.requestDataName(mX),name:b0+t.requestDataName(mX),groupby:u,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:o},marks:[e]}]}]}return x0(t)}(t):x0(t)}parseAxesAndHeaders(){var t;this.component.axes=(t=this,OU.reduce(((e,n)=>(t.component.scales[n]&&(e[n]=[p0(n,t)]),e)),{}))}assembleSelectionTopLevelSignals(t){return function(t,e){let n=!1;return VY(t,((i,r)=>{const s=i.name,o=OR(s+UY);if(0===e.filter((t=>t.name===s)).length){const t="global"===i.resolve?"union":i.resolve,n="multi"===i.type?", true)":")";e.push({name:i.name,update:`${WY}(${o}, ${OR(t)}${n}`})}n=!0,r.topLevelSignals&&(e=r.topLevelSignals(t,i,e)),NY(i,(n=>{n.topLevelSignals&&(e=n.topLevelSignals(t,i,e))}))})),n&&0===e.filter((t=>"unit"===t.name)).length&&e.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),$Y(e)}(this,t)}assembleSignals(){return[...lZ(this),...(t=this,e=[],VY(t,((n,i)=>{const r=n.name;let s=i.modifyExpr(t,n);e.push(...i.signals(t,n)),NY(n,(i=>{i.signals&&(e=i.signals(t,n,e)),i.modifyExpr&&(s=i.modifyExpr(t,n,s))})),e.push({name:r+"_modify",on:[{events:{signal:n.name+qY},update:`modify(${OR(n.name+UY)}, ${s})`}]})})),$Y(e))];var t,e}assembleSelectionData(t){return function(t,e){const n=[...e];return VY(t,(e=>{const i={name:e.name+UY};if(e.init){const n=e.project.items.map((t=>{const{signals:e}=t;return MR(t,["signals"])})),r=e.init.map((t=>MY(t,!1)));i.values="interval"===e.type?[{unit:GY(t,{escape:!1}),fields:n,values:r}]:r.map((e=>({unit:GY(t,{escape:!1}),fields:n,values:e})))}n.filter((t=>t.name===e.name+UY)).length||n.push(i)})),n}(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return RZ(this)}assembleMarks(){var t;let e=null!==(t=this.component.mark)&&void 0!==t?t:[];return this.parent&&NQ(this.parent)||(e=zY(this,e)),e.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return CV(this.encoding,t)}fieldDef(t){return tV(this.encoding[t])}typedFieldDef(t){const e=this.fieldDef(t);return IH(e)?e:null}}class A0 extends MQ{constructor(t,e,n,i,r){super(t,"layer",e,n,r,t.resolve,t.view);const s=Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map(((t,e)=>{if(FG(t))return new A0(t,this,this.getName("layer_"+e),s,r);if(QL(t))return new w0(t,this,this.getName("layer_"+e),s,r);throw new Error(rq(t))}))}parseData(){this.component.data=r0(this);for(const t of this.children)t.parseData()}parseLayoutSize(){KQ(this),QQ(this,"width"),QQ(this,"height")}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const e of oL(t.component.selection))this.component.selection[e]=t.component.selection[e]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){!function(t){var e;const{axes:n,resolve:i}=t.component,r={top:0,bottom:0,right:0,left:0};for(const e of t.children){e.parseAxesAndHeaders();for(const r of oL(e.component.axes))i.axis[r]=VZ(t.component.resolve,r),"shared"===i.axis[r]&&(n[r]=c0(n[r],e.component.axes[r]),n[r]||(i.axis[r]="independent",delete n[r]))}for(const s of OU){for(const o of t.children)if(o.component.axes[s]){if("independent"===i.axis[s]){n[s]=(null!==(e=n[s])&&void 0!==e?e:[]).concat(o.component.axes[s]);for(const t of o.component.axes[s]){const{value:e,explicit:n}=t.getWithExplicit("orient");if(!Xq(e)){if(r[e]>0&&!n){const n=l0[e];r[e]>r[n]&&t.set("orient",n,!1)}r[e]++}}}delete o.component.axes[s]}if("independent"===i.axis[s]&&n[s]&&n[s].length>1)for(const t of n[s])t.get("grid")&&!t.explicit.grid&&(t.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce(((t,e)=>e.assembleSelectionTopLevelSignals(t)),t)}assembleSignals(){return this.children.reduce(((t,e)=>t.concat(e.assembleSignals())),lZ(this))}assembleLayoutSignals(){return this.children.reduce(((t,e)=>t.concat(e.assembleLayoutSignals())),RZ(this))}assembleSelectionData(t){return this.children.reduce(((t,e)=>e.assembleSelectionData(t)),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const e of this.children)if(t=e.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return function(t,e){for(const n of t.children)FQ(n)&&(e=zY(n,e));return e}(this,this.children.flatMap((t=>t.assembleMarks())))}assembleLegends(){return this.children.reduce(((t,e)=>t.concat(e.assembleLegends())),lK(this))}}function _0(t,e,n,i,r){if(kH(t))return new n0(t,e,n,r);if(FG(t))return new A0(t,e,n,i,r);if(QL(t))return new w0(t,e,n,i,r);if(function(t){return cG(t)||hG(t)||lG(t)}(t))return new s0(t,e,n,r);throw new Error(rq(t))}function k0(t,e={}){var n;e.logger&&(n=e.logger,Nq=n),e.fieldTitle&&YH(e.fieldTitle);try{const n=_G(wR(e.config,t.config)),i=ZG(t,n),r=_0(i,null,"",void 0,n);return r.parse(),function(t,e){bK(t.sources);let n=0,i=0;for(let i=0;i<5&&KK(t,e);i++)n++;t.sources.map(LK);for(let n=0;n<5&&KK(t,e);n++)i++;bK(t.sources),5===Math.max(n,i)&&Mq("Maximum optimization runs(5) reached.")}(r.component.data,r),{spec:function(t,e,n={},i){const r=t.config?function(t){t=HR(t);for(const e of CG)delete t[e];if(t.axis)for(const e in t.axis)CL(t.axis[e])&&delete t.axis[e];if(t.legend)for(const e of eG)delete t.legend[e];if(t.mark){for(const e of ZL)delete t.mark[e];t.mark.tooltip&&bR(t.mark.tooltip)&&delete t.mark.tooltip}for(const e of kG){for(const n of ZL)delete t[e][n];const n=EG[e];if(n)for(const i of n)delete t[e][i];DG(t,e)}for(const e of oL(QV))delete t[e];!function(t){const{titleMarkConfig:e,subtitleMarkConfig:n,subtitle:i}=hV(t.title);sL(e)||(t.style["group-title"]=Object.assign(Object.assign({},t.style["group-title"]),e)),sL(n)||(t.style["group-subtitle"]=Object.assign(Object.assign({},t.style["group-subtitle"]),n)),sL(i)?delete t.title:t.title=i}(t);for(const e in t)bR(t[e])&&sL(t[e])&&delete t[e];return sL(t)?void 0:t}(t.config):void 0,s=[].concat(t.assembleSelectionData([]),function(t,e){var n,i;const r=[],s=GQ(r);let o=0;for(const e of t.sources){e.hasName()||(e.dataName="source_"+o++);const t=e.assemble();s(e,t)}for(const t of r)0===t.transform.length&&delete t.transform;let a=0;for(const[t,e]of r.entries())0!==(null!==(n=e.transform)&&void 0!==n?n:[]).length||e.source||r.splice(a++,0,r.splice(t,1)[0]);for(const e of r)for(const n of null!==(i=e.transform)&&void 0!==i?i:[])"lookup"===n.type&&(n.from=t.outputNodes[n.from].getSource());for(const t of r)t.name in e&&(t.values=e[t.name]);return r}(t.component.data,n)),o=t.assembleProjections(),a=t.assembleTitle(),u=t.assembleGroupStyle(),l=t.assembleGroupEncodeEntry(!0);let c=t.assembleLayoutSignals();return c=c.filter((t=>"width"!==t.name&&"height"!==t.name||void 0===t.value||(e[t.name]=+t.value,!1))),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},t.description?{description:t.description}:{}),e),a?{title:a}:{}),u?{style:u}:{}),l?{encode:{update:l}}:{}),{data:s}),o.length>0?{projections:o}:{}),t.assembleGroup([...c,...t.assembleSelectionTopLevelSignals([])])),r?{config:r}:{}),i?{usermeta:i}:{})}(r,function(t,e,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(void 0===e?(e={type:"pad"},i.hasAxisOrientSignalRef()&&(e.resize=!0)):SR(e)&&(e={type:e}),r&&s&&("fit"===(o=e.type)||"fit-x"===o||"fit-y"===o))if("step"===r&&"step"===s)Mq(aq()),e.type="pad";else if("step"===r||"step"===s){const t="step"===r?"width":"height";Mq(aq($U(t)));const n="width"===t?"height":"width";e.type=function(t){return t?`fit-${$U(t)}`:"fit"}(n)}var o;return Object.assign(Object.assign(Object.assign({},1===oL(e).length&&e.type?"pad"===e.type?{}:{autosize:e.type}:{autosize:e}),eX(n)),eX(t))}(t,i.autosize,n,r),t.datasets,t.usermeta),normalized:i}}finally{e.logger&&(Nq=Sq),e.fieldTitle&&YH(GH)}}const C0=new class extends SG{mapUnit(t,{config:e}){if(t.encoding){const{encoding:n,transform:i}=t,{bins:r,timeUnits:s,aggregate:o,groupby:a,encoding:u}=DV(n,e),l=[...i||[],...r,...s,...0===o.length?[]:[{aggregate:o,groupby:a}]];return Object.assign(Object.assign(Object.assign({},t),l.length>0?{transform:l}:{}),{encoding:u})}return t}};function E0(t,e){return C0.map(t,{config:e})}const D0="4.13.1",F0=function(t){const[e,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(t).slice(1,3);return{library:e,version:n}},S0="#fff",O0={background:"#333",title:{color:S0,subtitleColor:S0},style:{"guide-label":{fill:S0},"guide-title":{fill:S0}},axis:{domainColor:S0,gridColor:"#888",tickColor:S0}},N0="#4572a7",M0={background:"#fff",arc:{fill:N0},area:{fill:N0},line:{stroke:N0,strokeWidth:2},path:{stroke:N0},rect:{fill:N0},shape:{stroke:N0},symbol:{fill:N0,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},z0="#30a2da",$0="#cbcbcb",T0="#f0f0f0",B0="#333",j0={arc:{fill:z0},area:{fill:z0},axis:{domainColor:$0,grid:!0,gridColor:$0,gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:$0,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:T0,group:{fill:T0},legend:{labelColor:B0,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:B0,titleFontSize:14,titlePadding:10},line:{stroke:z0,strokeWidth:2},path:{stroke:z0,strokeWidth:.5},rect:{fill:z0},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:z0},bar:{binSpacing:2,fill:z0,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},I0="#000",R0={group:{fill:"#e5e5e5"},arc:{fill:I0},area:{fill:I0},line:{stroke:I0},path:{stroke:I0},rect:{fill:I0},shape:{stroke:I0},symbol:{fill:I0,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},L0="Benton Gothic, sans-serif",P0="#82c6df",U0="Benton Gothic Bold, sans-serif",q0="normal",W0={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},H0={background:"#ffffff",title:{anchor:"start",color:"#000000",font:U0,fontSize:22,fontWeight:"normal"},arc:{fill:P0},area:{fill:P0},line:{stroke:P0,strokeWidth:2},path:{stroke:P0},rect:{fill:P0},shape:{stroke:P0},symbol:{fill:P0,size:30},axis:{labelFont:L0,labelFontSize:11.5,labelFontWeight:"normal",titleFont:U0,titleFontSize:13,titleFontWeight:q0},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:L0,labelFontSize:11.5,symbolType:"square",titleFont:U0,titleFontSize:13,titleFontWeight:q0},range:{category:W0["category-6"],diverging:W0["fireandice-6"],heatmap:W0["fire-7"],ordinal:W0["fire-7"],ramp:W0["fire-7"]}},V0="#ab5787",G0="#979797",X0={background:"#f9f9f9",arc:{fill:V0},area:{fill:V0},line:{stroke:V0},path:{stroke:V0},rect:{fill:V0},shape:{stroke:V0},symbol:{fill:V0,size:30},axis:{domainColor:G0,domainWidth:.5,gridWidth:.2,labelColor:G0,tickColor:G0,tickWidth:.2,titleColor:G0},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},Y0="#3e5c69",J0={background:"#fff",arc:{fill:Y0},area:{fill:Y0},line:{stroke:Y0},path:{stroke:Y0},rect:{fill:Y0},shape:{stroke:Y0},symbol:{fill:Y0},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},Z0="#1696d2",K0="#000000",Q0="Lato",t1="Lato",e1={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},n1={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:Q0},axisX:{domain:!0,domainColor:K0,domainWidth:1,grid:!1,labelFontSize:12,labelFont:t1,labelAngle:0,tickColor:K0,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:Q0},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:t1,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:Q0,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:t1,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:Q0,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:e1["six-groups-cat-1"],diverging:e1["diverging-colors"],heatmap:e1["diverging-colors"],ordinal:e1["six-groups-seq"],ramp:e1["shades-blue"]},area:{fill:Z0},rect:{fill:Z0},line:{color:Z0,stroke:Z0,strokeWidth:5},trail:{color:Z0,stroke:Z0,strokeWidth:0,size:1},path:{stroke:Z0,strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:Z0,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:Z0,stroke:null}},arc:{fill:Z0},shape:{stroke:Z0},symbol:{fill:Z0,size:30}},i1="#3366CC",r1="#ccc",s1="Arial, sans-serif",o1={arc:{fill:i1},area:{fill:i1},path:{stroke:i1},rect:{fill:i1},shape:{stroke:i1},symbol:{stroke:i1},circle:{fill:i1},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:s1,fontSize:12},"guide-title":{font:s1,fontSize:12},"group-title":{font:s1,fontSize:12}},title:{font:s1,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:r1,tickColor:r1,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},a1="2.10.0";const u1="vg-tooltip-element",l1={offsetX:10,offsetY:10,id:u1,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function c1(t,e){return JSON.stringify(t,function(t){const e=[];return function(n,i){if("object"!=typeof i||null===i)return i;const r=e.indexOf(this)+1;return e.length=r,e.length>t?"[Object]":e.indexOf(i)>=0?"[Circular]":(e.push(i),i)}}(e))}class h1{constructor(t){this.options=Object.assign(Object.assign({},l1),t);const e=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const t=document.createElement("style");t.setAttribute("id",this.options.styleId),t.innerHTML=function(t){if(!/^[A-Za-z]+[-:.\w]*$/.test(t))throw new Error("Invalid HTML ID");return"#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n".toString().replace(u1,t)}(e);const n=document.head;n.childNodes.length>0?n.insertBefore(t,n.childNodes[0]):n.appendChild(t)}}tooltipHandler(t,e,n,i){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(null!=document.fullscreenElement?document.fullscreenElement:document.body).appendChild(this.el),null==i||""===i)return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=function(t,e,n){if(Ze(t))return`[${t.map((t=>e(Tn(t)?t:c1(t,n)))).join(", ")}]`;if(Ke(t)){let i="";const r=t,{title:s,image:o}=r,a=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}(r,["title","image"]);s&&(i+=`<h2>${e(s)}</h2>`),o&&(i+=`<img src="${e(o)}">`);const u=Object.keys(a);if(u.length>0){i+="<table>";for(const t of u){let r=a[t];void 0!==r&&(Ke(r)&&(r=c1(r,n)),i+=`<tr><td class="key">${e(t)}:</td><td class="value">${e(r)}</td></tr>`)}i+="</table>"}return i||"{}"}return e(t)}(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:r,y:s}=function(t,e,n,i){let r=t.clientX+n;r+e.width>window.innerWidth&&(r=+t.clientX-n-e.width);let s=t.clientY+i;return s+e.height>window.innerHeight&&(s=+t.clientY-i-e.height),{x:r,y:s}}(e,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${s}px; left: ${r}px`)}}function f1(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):function(t){return t instanceof n?t:new n((function(e){e(t)}))}(t.value).then(o,a)}u((i=i.apply(t,e||[])).next())}))}var d1;function p1(t,...e){for(const n of e)g1(t,n);return t}function g1(t,e){for(const n of Object.keys(e))Et(t,n,e[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return this.substr(!e||e<0?0:+e,t.length)===t});const m1=y;let y1=v;const v1="undefined"!=typeof window?window:void 0;void 0===y1&&(null===(d1=null==v1?void 0:v1.vl)||void 0===d1?void 0:d1.compile)&&(y1=v1.vl);const b1={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},x1={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},w1={vega:"Vega","vega-lite":"Vega-Lite"},A1={vega:m1.version,"vega-lite":y1?y1.version:"not available"},_1={vega:t=>t,"vega-lite":(t,e)=>y1.compile(t,{config:e}).spec};function k1(t,e,n,i){const r=`<html><head>${e}</head><body><pre><code class="json">`,s=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(r+t+s),o.document.title=`${w1[i]} JSON Source`}function C1(t,e){var n;if(t.$schema){const i=F0(t.$schema);e&&e!==i.library&&console.warn(`The given visualization spec is written in ${w1[i.library]}, but mode argument sets ${null!==(n=w1[e])&&void 0!==n?n:e}.`);const r=i.library;return(0,Q.satisfies)(A1[r],`^${i.version.slice(1)}`)||console.warn(`The input spec uses ${w1[r]} ${i.version}, but the current version of ${w1[r]} is v${A1[r]}.`),r}return"mark"in t||"encoding"in t||"layer"in t||"hconcat"in t||"vconcat"in t||"facet"in t||"repeat"in t?"vega-lite":"marks"in t||"signals"in t||"scales"in t||"axes"in t?"vega":null!=e?e:"vega"}function E1(t){return(e=t)&&"load"in e?t:m1.loader(t);var e}function D1(t){var e;return null!==(e=t.usermeta&&t.usermeta.embedOptions)&&void 0!==e?e:{}}function F1(t,e){var n;return f1(this,void 0,void 0,(function*(){const i=ve(t.config)?JSON.parse(yield e.load(t.config)):null!==(n=t.config)&&void 0!==n?n:{},r=ve(t.patch)?JSON.parse(yield e.load(t.patch)):t.patch;return Object.assign(Object.assign(Object.assign({},t),r?{patch:r}:{}),i?{config:i}:{})}))}const S1=function(t,e,n={}){var i,r,s;return f1(this,void 0,void 0,(function*(){let o,a;ve(e)?(a=E1(n.loader),o=JSON.parse(yield a.load(e))):o=e;const u=D1(o).loader;a&&!u||(a=E1(null!==(i=n.loader)&&void 0!==i?i:u));const l=yield F1(D1(o),a),c=yield F1(n,a),h=Object.assign(Object.assign({},p1(c,l)),{config:Ct(null!==(r=c.config)&&void 0!==r?r:{},null!==(s=l.config)&&void 0!==s?s:{})});return yield function(t,e,n={},i){var r,s,o,a,u,l;return f1(this,void 0,void 0,(function*(){const c=n.theme?Ct(b[n.theme],null!==(r=n.config)&&void 0!==r?r:{}):n.config,h=de(n.actions)?n.actions:p1({},b1,null!==(s=n.actions)&&void 0!==s?s:{}),f=Object.assign(Object.assign({},x1),n.i18n),d=null!==(o=n.renderer)&&void 0!==o?o:"canvas",p=null!==(a=n.logLevel)&&void 0!==a?a:m1.Warn,g=null!==(u=n.downloadFileName)&&void 0!==u?u:"visualization",m="string"==typeof t?document.querySelector(t):t;if(!m)throw new Error(`${t} does not exist`);if(!1!==n.defaultStyle){const t="vega-embed-style",{root:e,rootContainer:i}=function(t){var e;const n=t.getRootNode?t.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(e=document.head)&&void 0!==e?e:document.body}}(m);if(!e.getElementById(t)){const e=document.createElement("style");e.id=t,e.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?'.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper {\n    width: 100%;\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n'.toString():n.defaultStyle,i.appendChild(e)}}const y=C1(e,n.mode);let v=_1[y](e,c);if("vega-lite"===y&&v.$schema){const t=F0(v.$schema);(0,Q.satisfies)(A1.vega,`^${t.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${t.version}, but current version is v${A1.vega}.`)}m.classList.add("vega-embed"),h&&m.classList.add("has-actions"),m.innerHTML="";let x=m;if(h){const t=document.createElement("div");t.classList.add("chart-wrapper"),m.appendChild(t),x=t}const w=n.patch;w&&(v=w instanceof Function?w(v):I(v,w,!0,!1).newDocument),n.formatLocale&&m1.formatLocale(n.formatLocale),n.timeFormatLocale&&m1.timeFormatLocale(n.timeFormatLocale);const{ast:A}=n,_=m1.parse(v,"vega-lite"===y?{}:c,{ast:A}),k=new(n.viewClass||m1.View)(_,Object.assign({loader:i,logLevel:p,renderer:d},A?{expr:m1.expressionInterpreter}:{}));if(!1!==n.tooltip){let t;t="function"==typeof n.tooltip?n.tooltip:new h1(!0===n.tooltip?{}:n.tooltip).call,k.tooltip(t)}let C,{hover:E}=n;if(void 0===E&&(E="vega"===y),E){const{hoverSet:t,updateSet:e}="boolean"==typeof E?{}:E;k.hover(t,e)}if(n&&(null!=n.width&&k.width(n.width),null!=n.height&&k.height(n.height),null!=n.padding&&k.padding(n.padding)),yield k.initialize(x,n.bind).runAsync(),!1!==h){let t=m;if(!1!==n.defaultStyle){const e=document.createElement("details");e.title=f.CLICK_TO_VIEW_ACTIONS,m.append(e),t=e;const n=document.createElement("summary");n.innerHTML='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',e.append(n),C=t=>{e.contains(t.target)||e.removeAttribute("open")},document.addEventListener("click",C)}const i=document.createElement("div");if(t.append(i),i.classList.add("vega-actions"),!0===h||!1!==h.export)for(const t of["svg","png"])if(!0===h||!0===h.export||h.export[t]){const e=f[`${t.toUpperCase()}_ACTION`],r=document.createElement("a");r.text=e,r.href="#",r.target="_blank",r.download=`${g}.${t}`,r.addEventListener("mousedown",(function(e){return f1(this,void 0,void 0,(function*(){e.preventDefault();const i=yield k.toImageURL(t,n.scaleFactor);this.href=i}))})),i.append(r)}if(!0===h||!1!==h.source){const t=document.createElement("a");t.text=f.SOURCE_ACTION,t.href="#",t.addEventListener("click",(function(t){var i,r;k1(K()(e),null!==(i=n.sourceHeader)&&void 0!==i?i:"",null!==(r=n.sourceFooter)&&void 0!==r?r:"",y),t.preventDefault()})),i.append(t)}if("vega-lite"===y&&(!0===h||!1!==h.compiled)){const t=document.createElement("a");t.text=f.COMPILED_ACTION,t.href="#",t.addEventListener("click",(function(t){var e,i;k1(K()(v),null!==(e=n.sourceHeader)&&void 0!==e?e:"",null!==(i=n.sourceFooter)&&void 0!==i?i:"","vega"),t.preventDefault()})),i.append(t)}if(!0===h||!1!==h.editor){const t=null!==(l=n.editorUrl)&&void 0!==l?l:"https://vega.github.io/editor/",r=document.createElement("a");r.text=f.EDITOR_ACTION,r.href="#",r.addEventListener("click",(function(n){!function(t,e,n){const i=t.open(e),{origin:r}=new URL(e);let s=40;t.addEventListener("message",(function e(n){n.source===i&&(s=0,t.removeEventListener("message",e,!1))}),!1),setTimeout((function t(){s<=0||(i.postMessage(n,r),setTimeout(t,250),s-=1)}),250)}(window,t,{config:c,mode:y,renderer:d,spec:K()(e)}),n.preventDefault()})),i.append(r)}}return{view:k,spec:e,vgSpec:v,finalize:function(){C&&document.removeEventListener("click",C),k.finalize()}}}))}(t,o,h,a)}))}},4206:t=>{"use strict";t.exports=function(t){t.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}},8006:(t,e,n)=>{"use strict";function i(t){var e=this;if(e instanceof i||(e=new i),e.tail=null,e.head=null,e.length=0,t&&"function"==typeof t.forEach)t.forEach((function(t){e.push(t)}));else if(arguments.length>0)for(var n=0,r=arguments.length;n<r;n++)e.push(arguments[n]);return e}function r(t,e,n){var i=e===t.head?new a(n,null,e,t):new a(n,e,e.next,t);return null===i.next&&(t.tail=i),null===i.prev&&(t.head=i),t.length++,i}function s(t,e){t.tail=new a(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function o(t,e){t.head=new a(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function a(t,e,n,i){if(!(this instanceof a))return new a(t,e,n,i);this.list=i,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}t.exports=i,i.Node=a,i.create=i,i.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,n=t.prev;return e&&(e.prev=n),n&&(n.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=n),t.list.length--,t.next=null,t.prev=null,t.list=null,e},i.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}},i.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}},i.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)s(this,arguments[t]);return this.length},i.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)o(this,arguments[t]);return this.length},i.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}},i.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}},i.prototype.forEach=function(t,e){e=e||this;for(var n=this.head,i=0;null!==n;i++)t.call(e,n.value,i,this),n=n.next},i.prototype.forEachReverse=function(t,e){e=e||this;for(var n=this.tail,i=this.length-1;null!==n;i--)t.call(e,n.value,i,this),n=n.prev},i.prototype.get=function(t){for(var e=0,n=this.head;null!==n&&e<t;e++)n=n.next;if(e===t&&null!==n)return n.value},i.prototype.getReverse=function(t){for(var e=0,n=this.tail;null!==n&&e<t;e++)n=n.prev;if(e===t&&null!==n)return n.value},i.prototype.map=function(t,e){e=e||this;for(var n=new i,r=this.head;null!==r;)n.push(t.call(e,r.value,this)),r=r.next;return n},i.prototype.mapReverse=function(t,e){e=e||this;for(var n=new i,r=this.tail;null!==r;)n.push(t.call(e,r.value,this)),r=r.prev;return n},i.prototype.reduce=function(t,e){var n,i=this.head;if(arguments.length>1)n=e;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");i=this.head.next,n=this.head.value}for(var r=0;null!==i;r++)n=t(n,i.value,r),i=i.next;return n},i.prototype.reduceReverse=function(t,e){var n,i=this.tail;if(arguments.length>1)n=e;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");i=this.tail.prev,n=this.tail.value}for(var r=this.length-1;null!==i;r--)n=t(n,i.value,r),i=i.prev;return n},i.prototype.toArray=function(){for(var t=new Array(this.length),e=0,n=this.head;null!==n;e++)t[e]=n.value,n=n.next;return t},i.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,n=this.tail;null!==n;e++)t[e]=n.value,n=n.prev;return t},i.prototype.slice=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new i;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var r=0,s=this.head;null!==s&&r<t;r++)s=s.next;for(;null!==s&&r<e;r++,s=s.next)n.push(s.value);return n},i.prototype.sliceReverse=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new i;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var r=this.length,s=this.tail;null!==s&&r>e;r--)s=s.prev;for(;null!==s&&r>t;r--,s=s.prev)n.push(s.value);return n},i.prototype.splice=function(t,e,...n){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var i=0,s=this.head;null!==s&&i<t;i++)s=s.next;var o=[];for(i=0;s&&i<e;i++)o.push(s.value),s=this.removeNode(s);for(null===s&&(s=this.tail),s!==this.head&&s!==this.tail&&(s=s.prev),i=0;i<n.length;i++)s=r(this,s,n[i]);return o},i.prototype.reverse=function(){for(var t=this.head,e=this.tail,n=t;null!==n;n=n.prev){var i=n.prev;n.prev=n.next,n.next=i}return this.head=e,this.tail=t,this};try{n(4206)(i)}catch(t){}},6058:t=>{"use strict";var e=/("(?:[^\\"]|\\.)*")|[:,]/g;t.exports=function(t,n){var i,r,s;return n=n||{},i=JSON.stringify([1],void 0,void 0===n.indent?2:n.indent).slice(2,-3),r=""===i?1/0:void 0===n.maxLength?80:n.maxLength,s=n.replacer,function t(n,o,a){var u,l,c,h,f,d,p,g,m,y,v,b;if(n&&"function"==typeof n.toJSON&&(n=n.toJSON()),void 0===(v=JSON.stringify(n,s)))return v;if(p=r-o.length-a,v.length<=p&&(m=v.replace(e,(function(t,e){return e||t+" "}))).length<=p)return m;if(null!=s&&(n=JSON.parse(v),s=void 0),"object"==typeof n&&null!==n){if(g=o+i,c=[],l=0,Array.isArray(n))for(y="[",u="]",p=n.length;l<p;l++)c.push(t(n[l],g,l===p-1?0:1)||"null");else for(y="{",u="}",p=(d=Object.keys(n)).length;l<p;l++)h=d[l],f=JSON.stringify(h)+": ",void 0!==(b=t(n[h],g,f.length+(l===p-1?0:1)))&&c.push(f+b);if(c.length>0)return[y,i+c.join(",\n"+g),u].join("\n"+o)}return v}(t,"",0)}}}]);